[
    {
        "author": "demiurgos_23",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "what is supposed to happen when the initcode Eof Container supplied to Create3/Create4 is invalid ?",
        "created_at": "2023-03-28T00:25:57.026000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My question too, does it need to be validated along with the rest of the container or is it random bytes that will cause create3 to fail if not valid?",
        "created_at": "2023-03-28T01:01:04.669000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It will be lazy evaluated: at the moment selected by `CREATE3`, `CREATE4` or after `RETURNCONTAINER`. This is because `RETURNCONTAINER` will potentially modify its data section and we cannot validate it before modification (e.g. `DATALOADN` may be invalid before modification but valid after).",
        "created_at": "2023-03-28T07:35:27.461000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Originally, we wanted to validate subcontainers. This has nice effect that we only need to validate EOF in transactions. All other usage is already valid. But `DATALOADN` has broken it.",
        "created_at": "2023-03-28T07:37:04.782000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We can still validate subcontainers, because if I read the CREATE docs right we take a valid container, add more data, and rewrite the new container with longer data.  The hash is based off of the pre-update container.",
        "created_at": "2023-03-28T16:00:20.936000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But validating subcontainers presents a recursion risk, so I think treating them as opaque payloads to be validated at create time is perfectly fine.  There will be corner cases where payloads that were invalid when deployed and creates were attempted may, on the other side of a fork boundary, have their creates start working.",
        "created_at": "2023-03-28T16:01:21.095000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "such as if we introduce a new opcode and people pre-deploy new contracts using that opcode in the subcontainers.",
        "created_at": "2023-03-28T16:02:05.672000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That's the first risk I see with not validating, and it may be better than the risks of recursive validation.",
        "created_at": "2023-03-28T16:02:41.992000+00:00",
        "attachments": null
    }
]