[
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We also need to add static call to the list.",
        "created_at": "2023-04-27T00:48:37.689000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "One idea (the original one) would be to keep the same opcode and just have operations that take less args.  However I think that is the third best options.  Number one and two (not neccisarily in that order) are three new ops (in the 0xb block) that would be new CALL2, DELEGATECALL2, and STATICCALL2.  The other alternative would be a new CALLX that has one immediate flags operand that has two bits at the moment: delegate and static.",
        "created_at": "2023-04-27T00:50:54.972000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The reason I consider these two to be better is that it gives us room to remove gas observability in EOF, and if we get it wrong we can re-introduce the GAS and CALL opcodes where they were at in a forwards compatible fashion.",
        "created_at": "2023-04-27T00:51:59.023000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e One idea (the original one)\n\nI wouldn't say this is the original, just that we never made a decision which option to take.",
        "created_at": "2023-04-27T00:57:44.262000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And the spec is just ambiguous on this aspect ðŸ™‚",
        "created_at": "2023-04-27T00:58:23.330000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ok,  so I would prefer a new 0xb series (or maybe 0xe0, 0xe1, 0xe2) opcodes or the combo CALLX.  But the argument against CALLX is that there is no value for CALL, so we would need either variable stack based on the immediate or ignore the value.  quickly three new opcodes looks easier.",
        "created_at": "2023-04-27T01:00:57.341000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We'll have a good indication whether variable length opcodes are really messy or not with figuring out all the details about RJUMPV.\n\nBased on that the decision will be simple ðŸ˜…",
        "created_at": "2023-04-27T01:01:46.110000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It's not the variable length, it's the variable stack.  CALL needs a value stack arg, DELEGATECALL and STATICCALL don't",
        "created_at": "2023-04-27T01:02:19.828000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Both are variable length, rjumpv is variable immutable, extcall variable in terms of stack items. For tracing it will be a similar challenge.",
        "created_at": "2023-04-27T01:03:17.925000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The other argument we may run into how many flags for extcall can be mixed and matched, which is a similar discussion we had regarding flags in the header.",
        "created_at": "2023-04-27T01:03:29.557000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think they all could be mixed and matched, but that quickly explodes the testing surface because we would have to verify it.",
        "created_at": "2023-04-27T01:03:59.898000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So callx with 3 flags is 8 opcodes worth of testing.  with 2 flags it's 4, still more than 3,",
        "created_at": "2023-04-27T01:04:35.067000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I personally like extcall (hence I also proposed it initially), but everything considered it may not be the best option on the plate.",
        "created_at": "2023-04-27T01:05:10.333000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We could short list the flags to just a few combos.  I think no-context would also want the static flag as well.",
        "created_at": "2023-04-27T01:05:57.977000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "but I feel unless we yolo the combos there's not much to gain by callx",
        "created_at": "2023-04-27T01:07:03.191000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We could potentially reorder arguments to keep the difference (value) last. That could help the implementations to be closer.",
        "created_at": "2023-04-27T01:08:17.123000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Closer within the new family, not across the old and new.",
        "created_at": "2023-04-27T01:08:46.434000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That would help.  Weakly held opinion on which of the two solutions we go with, strong opinion on not over-writing the 0xf opcodes.",
        "created_at": "2023-04-27T01:08:48.036000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There was also an idea to introduce EOF specific opcodes under the 0xE0..0xEE range (given we have 0xEF).",
        "created_at": "2023-04-27T01:09:49.287000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We've got bunches in 0xb already.  if we go callx I think 0xbf?  and if we go with 3 args 0xe0, 0xe1, and 0xe2, or 0xed, 0xee, 0xef?",
        "created_at": "2023-04-27T01:11:48.098000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Need to go now, but will think about these tomorrow",
        "created_at": "2023-04-27T01:12:37.515000+00:00",
        "attachments": null
    },
    {
        "author": "demiurgos_23",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I like the CALLX idea",
        "created_at": "2023-04-27T03:04:17.459000+00:00",
        "attachments": null
    }
]