[
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "QQ: I have RJUMP as a potentially terminal instruction, but it seems that the EIP says that stopping execution with RJUMP is disallowed",
        "created_at": "2024-05-22T07:03:31.455000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e Invalid cases:\n\u003e RJUMP/RJUMPI/RJUMPV as a final instruction in code section",
        "created_at": "2024-05-22T07:03:55.208000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Weird thing is that this test case was passed by my previous implementation and only breaks on my new one, so the previous implementation allowed this (and it wasn't caught by test cases apparently)",
        "created_at": "2024-05-22T07:07:43.712000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "fixed on eips website now",
        "created_at": "2024-05-22T07:27:16.034000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think `RJUMP` can be the last instruction (because it moves the control flow somewhere else unconditionally). Which EIPs are you reading?",
        "created_at": "2024-05-22T07:30:40.924000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://eips.ethereum.org/EIPS/eip-4200",
        "created_at": "2024-05-22T07:31:33.855000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://eips.ethereum.org/EIPS/eip-4200 (test cases section) it looks like an error in this EIP, this bullet should not include rjump or be dropped altogether?",
        "created_at": "2024-05-22T07:31:36.150000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There is no default \"PC next\" for rjump.  Rjumpi and rjumpv may proceed to the next instruction depending on the stack.",
        "created_at": "2024-05-22T07:31:41.247000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Is it a good idea?  Who knows, but it has the essential characteristics of all other terminal instructions.",
        "created_at": "2024-05-22T07:32:24.697000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Its also not in the megaspec:\nhttps://github.com/ipsilon/eof/blob/main/spec/eof.md\n```\nTerminating instructions:\nending function execution: RETF, JUMPF,\nending whole EVM execution: STOP, RETURN, RETURNCONTRACT, REVERT, INVALID.\n```",
        "created_at": "2024-05-22T07:33:26.440000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Last instruction in code section can only be a terminating one or an RJUMP (unconditional jump), but this is implied by the stack validation rules. It is noted in both formulations. Megaspec \"This implies that the last instruction may be a terminating instruction or RJUMP\", EIP-5450 \"Final instruction in the code section is either terminating instruction or RJUMP\".\n\nI think the entry in Test Cases in EIP-4200 you've cited is there by omission and should be removed. Determining what the last instruction in a code section may be is up to EIP-5450.",
        "created_at": "2024-05-22T07:41:18.569000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(if someone confirms what I wrote I'll make a PR against EIP-4200. And thank you for flagging this, as always üôÇ )",
        "created_at": "2024-05-22T07:43:43.271000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Let's note the issue and I will check it",
        "created_at": "2024-05-22T07:44:10.530000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yeah stack validation supersedes old rules about which instruction can be the last one",
        "created_at": "2024-05-22T08:45:17.604000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@547171287831805972\u003e \u003c@892053833121923094\u003e we have second thoughts about EOF test tracker. It is a lot of manual work and hard to keep it properly maintained. I'm thinking about using `docs` for it? So far it doesn't look very good (e.g. https://ethereum.github.io/execution-spec-tests/v2.1.1/tests/cancun/eip1153_tstore/test_tstorage_execution_contexts/index/test_cases/) but maybe we can improve it by pulling test description to the docs?\n\nThen the tracer can be done by adding \"TODO placeholders\" to the source code (instead of adding an entry in a separate file).",
        "created_at": "2024-05-22T10:03:05.562000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@360491619402776577\u003e \u003c@211091239112671234\u003e can you take a look and voice your option about https://github.com/ipsilon/eof/pull/90 ?",
        "created_at": "2024-05-22T10:25:27.174000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Hmm I don't have a strong opinion on it.\nChanging it would mean that we have two implementations of basically the same opcode.\nWe limit the size for CALLDATACOPY to u64 (which should never be hit, because of gas limit)",
        "created_at": "2024-05-22T10:41:01.565000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Most of the discussion is about: should be modify existing opcode and replace it with a new one.",
        "created_at": "2024-05-22T10:43:37.412000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@408154589494247424\u003e Maybe you could expand on the reason for this change, I guess it would make compilers easier?",
        "created_at": "2024-05-22T10:48:28.194000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "well there is inconsistency with other regions (calldatacopy, codecopy)\n\nif RETURNDATALOAD follows the same semantics as RETURNDATACOPY, it would exceptional halt for any `returndatasize\u003c=31`, which kind of reduces its usefulness",
        "created_at": "2024-05-22T10:51:42.131000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh I think I get it now, sorry for being slow.\nSo without this change we could never copy if a contract returns only one byte of returndata and every contract would need to pad up to 32 bytes before RETURNing?",
        "created_at": "2024-05-22T10:57:39.899000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yea, you would have to do something like `if returndatasize \u003e= 32: returndataload 0; else mstore 0 0; returndatacopy 0 0 returndatasize; mload 0`",
        "created_at": "2024-05-22T11:01:53.576000+00:00",
        "attachments": null
    },
    {
        "author": "poojaranjan",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "**EOF Implementers Call #47**\nMeeting Info: May 22, 2024 , 15:00 UTC\nAgenda: https://github.com/ethereum/pm/issues/1046\n\nRecording: https://www.youtube.com/playlist?list=PLJqWcTqh_zKHu7Z91YVYWy_PSmOc_66-F\n\nZoom: \nhttps://us02web.zoom.us/j/88940506383?pwd=aTdsbHVyMTNDSUFHYmhTWlI2ZEVldz09\n\nMeeting ID: 889 4050 6383\nPasscode: 424973",
        "created_at": "2024-05-22T13:41:03.265000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "are there any drawbacks of eip-663 on native-compilation of evm code? cc \u003c@425274498732916736\u003e",
        "created_at": "2024-05-22T16:08:25.561000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I don't think so. It is the same thing, just the range is extended. I translated the stack-based EVM to LLVM IR (register based) using \"abstract execution\" (heavy name, but simple in practice). I don't see 663 causing issues here, but you are never 100% sure unless you implement it.",
        "created_at": "2024-05-22T16:11:56.828000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What is your issue?",
        "created_at": "2024-05-22T16:12:16.743000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "higher number of addressable registers, it could affect performance",
        "created_at": "2024-05-22T16:15:09.253000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(both compile-time and runtime)",
        "created_at": "2024-05-22T16:15:43.583000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You mean EVM runtime? I don't think it is a big deal here. The EVM stack is exactly L1 CPU cache size and we make only 25% of it directly accessible.",
        "created_at": "2024-05-22T16:17:54.379000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "x86 has 16 registers üôÇ the compiler has to generate code to spill to and from memory",
        "created_at": "2024-05-22T16:18:46.964000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "actually need to check on the # of registers. but it's definitely not 256*4",
        "created_at": "2024-05-22T16:20:20.318000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "16 or 32 based on architecture.",
        "created_at": "2024-05-22T16:21:18.022000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "33 avx registers üò±  https://blog.yossarian.net/2020/11/30/How-many-registers-does-an-x86-64-cpu-have",
        "created_at": "2024-05-22T16:22:18.995000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But EVM interpreter doesn't keep these values in registers but in memory. Are you worries about EVM ‚Üí native compilation?",
        "created_at": "2024-05-22T16:22:26.367000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yep, that's the question",
        "created_at": "2024-05-22T16:22:35.258000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It may be  a small issue here but benefits are much bigger. E.g. if you need more than 16 \"registers\" in EVM but don't have 663 then you need to spill to EVM memory. This makes the whole execution even worse (although also more gas costly).",
        "created_at": "2024-05-22T16:25:35.300000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "right, gas is not accounted for by needing to spill to memory in native code",
        "created_at": "2024-05-22T16:29:00.828000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "like it's more expensive to native-compile code which uses 256 stack items than code which uses top 16 items, but they are costed the same",
        "created_at": "2024-05-22T16:30:08.337000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "How up-to-date are these EOF container tests? https://github.com/ethereum/tests/tree/develop/EOFTests",
        "created_at": "2024-05-22T17:43:38.237000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Use these - https://github.com/ipsilon/execution-spec-tests/releases/tag/eof-20240515",
        "created_at": "2024-05-22T17:44:27.464000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah thanks üôÇ",
        "created_at": "2024-05-22T17:44:49.327000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://github.com/ipsilon/execution-spec-tests has all the pending PRs merged, and that file is the filler from the t8n runs.",
        "created_at": "2024-05-22T17:45:01.306000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The release states that it is not up-to-date yet (so it still has `TXCREATE`)?",
        "created_at": "2024-05-22T17:59:51.827000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, the implementation had `TXCREATE` but I believe there are not tests for it so this maybe hard to notice.",
        "created_at": "2024-05-22T18:29:33.831000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@425274498732916736\u003e want to add some commits to https://github.com/ethereum/execution-spec-tests/pull/502 before merging, but it seems like I don't have write permission to ipsilon, could you mark the PR as \"Allow edits by maintainers\" so I can push pls? üôè  (Or give me write access to ipsilon)",
        "created_at": "2024-05-22T22:59:28.760000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Was just about to start writing tests for EXCHANGE in the same PR and saw #544 is already open, I will take a look at that one tomorrow üëç",
        "created_at": "2024-05-22T23:00:24.059000+00:00",
        "attachments": null
    }
]