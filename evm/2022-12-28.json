[
    {
        "author": "demiurgos_23",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Nethermind does to some degree but we are still verifying correctness of the implementation : https://github.com/NethermindEth/nethermind/pulls?q=is%3Aopen+is%3Apr+assignee%3ADemuirGos+label%3AEof",
        "created_at": "2022-12-28T00:51:45.214000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@403937835956174848\u003e \u003c@393119312350543872\u003e I think for /all/ test cases, if the PR for EOF is updated, it should be mentioned which commit of the EOF EIPs (so in ethereum/eips) it matches ðŸ™‚ Otherwise other clients will not know what \"EOF EIP version\" they are testing against ðŸ™‚\n\n(Is it possible to quickly write and update local test fillers for Besu? It would be super great to locally test against it. (EthereumJS will focus soon on also integrating test fillers for the tests, it would be super helpful I'd say ðŸ™‚ )",
        "created_at": "2022-12-28T03:58:23.507000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Hey \u003c@403707149043105803\u003e I am importing your besu tests to verify that EthJS is also verifying EOF correctly. I have a question about your tests:\n\nThis test: https://github.com/hyperledger/besu/blob/1ae74d0eb06011d0b37e75620b00aa16d27ca4bf/evm/src/test/java/org/hyperledger/besu/evm/code/EOFLayoutTest.java#L236\n\nIt has a type section of size 4, but a code section of size 1024. This is incorrect, right? Each code section should have a type section? So type section should be of size 1024 * 4?",
        "created_at": "2022-12-28T06:29:14.756000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also, many thanks for these tests, they are super helpful ðŸ¤—",
        "created_at": "2022-12-28T06:29:36.795000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Is it intentional that this test: https://github.com/hyperledger/besu/blob/1ae74d0eb06011d0b37e75620b00aa16d27ca4bf/evm/src/test/java/org/hyperledger/besu/evm/code/EOFLayoutTest.java#L252 also has no code (it should have 2 code sections of size 2?)\n\nIt does not seem that the test checks the error string, so it could also throw on having no code section?",
        "created_at": "2022-12-28T06:40:02.534000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Is there any way I can directly comment on some GH files? It is not super handy to keep linking to lines here and then commenting on it ðŸ˜…",
        "created_at": "2022-12-28T06:52:24.962000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Besu can generate testFiller files so it is possible to develop tests on besu.",
        "created_at": "2022-12-28T07:06:50.240000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That would be great ðŸ™‚",
        "created_at": "2022-12-28T07:07:30.636000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In 3540, how do I quickly jump to a code section? If I do not have these offsets saved anywhere, then I should iterate over all previous code sizes in order to find the offset to which offset I should jump\n\nWould it not make sense to instead of encoding code size, encode the code offset (relative to the entire container?) This is possible, since we have 2 bytes to encode it, and the initcode size max is 49152, so all offsets will fit into 2 bytes?",
        "created_at": "2022-12-28T14:50:02.501000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(sorry, 3540 + 4750 of course if I `CALLF`)",
        "created_at": "2022-12-28T14:50:23.584000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Hmm I guess you should then only encode the size of the latest section in order to know at what offset the data section starts",
        "created_at": "2022-12-28T14:51:13.269000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@403707149043105803\u003e how did you implement this, did you save the code sections? (This should thus also be saved to disk?)",
        "created_at": "2022-12-28T14:51:32.236000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And then also thus ensure that there are 1025 max code sections (last section thus encodes the length of the final one)",
        "created_at": "2022-12-28T14:56:40.529000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yep, that test should actually fail on type section size. Will update the test and my code.",
        "created_at": "2022-12-28T14:56:50.461000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'll add code so that the only error is the type section.  You're right, this would be a better test if only one thing is wrong.",
        "created_at": "2022-12-28T14:57:47.987000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "These tests were incredibly helpful, thanks ðŸ™‚",
        "created_at": "2022-12-28T14:58:11.366000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think we've overdone EIP-3860 (meter and limit initcode). Different errors for limit and cost sucks. For `CREATE2` we have following checks:\n- check memory expansion of initcode (possible OOG)\n- check initcode size limit (possible push 0)\n- apply initcode hashing cost (possible OOG)\n- apply initcode cost (possible OOG)\n- check call depth (possible push 0, but after initcode cost applied)\n- check ETH transfer (possible push 0, but after initcode cost applied)\n\nEven before EIP-3860 this order does not make any sense already.",
        "created_at": "2022-12-28T15:08:28.300000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "First test case there looks like invalid code, because it has 1 unreachable `5B`",
        "created_at": "2022-12-28T15:15:12.904000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I should note here that these are 4200 tests only, so not considering 5450. I wrote it on one of the previous specs when it was not yet clear which EIPs would get into EOF",
        "created_at": "2022-12-28T15:16:13.724000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So it only checks 4200 not 4750 / 5450",
        "created_at": "2022-12-28T15:16:21.490000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "5450*",
        "created_at": "2022-12-28T15:16:30.653000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But you are right actually, these tests are not helpful for big EOF",
        "created_at": "2022-12-28T15:16:52.041000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And we are going to add EOF validation rules to the list.",
        "created_at": "2022-12-28T15:30:20.582000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://github.com/shemnon/besu/tree/eof-breakout5 will track this weeks tweaks in Besu",
        "created_at": "2022-12-28T17:48:54.629000+00:00",
        "attachments": null
    }
]