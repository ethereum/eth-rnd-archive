[
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That was just not logged, the gas was deducted correctly I think",
        "created_at": "2024-07-02T08:23:34.194000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What does the spec mean with `and update data size in the header`",
        "created_at": "2024-07-02T09:08:18.859000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "During eof create?",
        "created_at": "2024-07-02T09:08:28.694000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Are we supposed to literally overwrite the data size in the header?",
        "created_at": "2024-07-02T09:12:35.220000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That feels wrong to me?",
        "created_at": "2024-07-02T09:12:41.963000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That's how I interpreted it, i.e. make the header valid after deployment",
        "created_at": "2024-07-02T09:13:14.956000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Otherwise the container has dangling bytes in it (assuming data size \u003e init header data size)",
        "created_at": "2024-07-02T09:13:38.151000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Isn't the validity checked beforehand?",
        "created_at": "2024-07-02T09:14:03.390000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I check the validity on unmarshalling",
        "created_at": "2024-07-02T09:14:22.858000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://github.com/ipsilon/eof/blob/main/spec/eof.md#data-section-lifecycle",
        "created_at": "2024-07-02T09:14:35.078000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So you have pre deploy data (does not change), known data length which gets appended (static aux data, can change) and possibly extra aux data. And the validity of the deployed container checks that data size is at least data length + static aux data length",
        "created_at": "2024-07-02T09:15:56.421000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "weird",
        "created_at": "2024-07-02T09:16:10.925000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But I might have interpreted this wrong though (our EthJS version is not running a lot of tests yet ðŸ˜… )",
        "created_at": "2024-07-02T09:16:32.467000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Do you have two different ways of unmarshalling a container?",
        "created_at": "2024-07-02T09:16:41.811000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes I think I have an initcode flag somewhere which does slightly differnt checks on the container",
        "created_at": "2024-07-02T09:17:30.551000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Which I think only has to do with this data size thing",
        "created_at": "2024-07-02T09:17:46.023000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But maybe I should not get into this discussion too much, someone from EOF will know better ðŸ™‚",
        "created_at": "2024-07-02T09:17:59.956000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "correct",
        "created_at": "2024-07-02T09:18:47.910000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Similar for `evmone`. The data section \"lifecycle\" is a bit complicated, but no alternative approach to tackling the requirements was good enough (and hence the dedicated section in the spec to lay it out). If there's still anything left unclear or ambiguous there, please let us know or file an issue or PR (best to the ipsilon/eof repo).",
        "created_at": "2024-07-02T09:34:16.559000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Okay I found \u0026 fixed it, only 5 tests remaining",
        "created_at": "2024-07-02T09:40:10.140000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Okay, fixed everything. Thanks all for the help",
        "created_at": "2024-07-02T11:06:23.806000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@360491619402776577\u003e which tests did you run? These? https://github.com/ipsilon/execution-spec-tests/releases/tag/eip7692%40v1.0.4%2Bipsilon_bf37249b",
        "created_at": "2024-07-02T12:03:38.847000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://github.com/ethereum/execution-spec-tests/releases/tag/eip7692%40v1.0.4",
        "created_at": "2024-07-02T12:05:15.630000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This one (I think)",
        "created_at": "2024-07-02T12:05:19.645000+00:00",
        "attachments": null
    },
    {
        "author": "raxhvl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ðŸ‘‹ I'm doing research on EVM's gas costs. To understand the history better, I'm reviewing the V1 gas estimates. \n\nThe earliest documented resource I could find is [this excel](https://docs.google.com/spreadsheets/d/1m89CVujrQe5LAFJ8-YAUCcNK950dUzMQPMJBxRtGCqs/edit?gid=0#gid=0) created on Feb 28, 2015.\n\nQuestions:\n1. Is this earliest \"official\" document? Who created it?\n2. What hardware was used for the benchmarks?\n3. Who is the best person to reach out to for clarifications on the formulas used here?",
        "created_at": "2024-07-02T12:50:15.737000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Just woke up. The reason we re-write is to bring some data into the immutable contract storage.  What solidity current does is it re-writes the contract body, inserting the constants into the code, before deploying it.  Now they will reference the data in the data section at those points instead.  This contract bytecode re-writing makes it fairly ZK and AOT unfriendly.",
        "created_at": "2024-07-02T13:57:32.865000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Mega EOF spec does not note the return value changes for EXT*CALLs is this correct? It only specs out the changes in the stack and failure if the address is not 20 bytes",
        "created_at": "2024-07-02T14:47:02.945000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "EIP-7069 has the return codes.",
        "created_at": "2024-07-02T14:47:27.130000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, it has them, but Mega EOF states: \n`Replacement of CALL, DELEGATECALL and STATICCALL instructions, as specced out in EIP-7069, except the runtime operand stack check. In particular`\n\nThis implies that only the runtime operand stack check is changed (and not the return codes). It is not mentioned that the return codes also change",
        "created_at": "2024-07-02T14:50:01.550000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What if the call reverts, but once revert is used it uses all gas? Should I then push 1 or 2 on the stack? ðŸ¤”",
        "created_at": "2024-07-02T14:50:44.537000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So there is *exactly* enough gas left for the revert (so it does not go OOG which would push 2 on stack)",
        "created_at": "2024-07-02T14:51:13.368000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Please, use the releases from `ethereum/execution-spec-tests`, the `ipsilon` fork's ones are  for  internal for `evmone` (maybe I'll mark them as such in the description)",
        "created_at": "2024-07-02T15:02:53.064000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(my above message in reply to this)",
        "created_at": "2024-07-02T15:03:31.422000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ok cool, I will switch ðŸ™‚",
        "created_at": "2024-07-02T15:04:00.253000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So this one I should use? https://github.com/ethereum/execution-spec-tests/releases/tag/eip7692%40v1.0.4",
        "created_at": "2024-07-02T15:04:13.234000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yup!",
        "created_at": "2024-07-02T15:06:00.498000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thanks ðŸ™‚",
        "created_at": "2024-07-02T15:06:40.268000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What the megaspec paragraph is trying to say, is that the spec for `EXT*CALL` is EIP-7069, with the exception of runtime operand stack check. Actually I think EIP-7069 also reiterates that the runtime operand stack check is not done in EOF setting, so the remark in Megaspec is a bit redundant.\n\nAs far as the return codes go, EIP-7069 redefines them for `EXT*CALL`, and they're different from (old) CALL instructions'. This is regardless of whether it is called in EOF code or legacy.\n\n(of course, the legacy-EIP-7069 is a hypothetical scenario, we're not deploying `EXT*CALL` in legacy EVM. At one point, I think we're going to remove all the legacy-EIP-7069 remarks from megaspec and EIP-7069, that is, EIP-7069 will become an exclusively EOF EIP, this should simplify things)",
        "created_at": "2024-07-02T15:14:23.137000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If the gas is exactly enough for the callee frame to call the REVERT, 1 will be returned on the stack in the caller frame. The caller frame still must have had MIN_RETAINED_GAS (5000) left to continue execution, otherwise the call would not have happened (incidentally, if that was the case, it would also return 1 on the caller frame stack)",
        "created_at": "2024-07-02T15:16:18.834000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh right! Sorry - I keep forgetting there are EIPs in the EOF spec which can (theoretically) also be deployed  on legacy contracts",
        "created_at": "2024-07-02T15:16:48.819000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thanks for the comment on the gas ðŸ˜„",
        "created_at": "2024-07-02T15:17:28.447000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "np, I hope that clarifies things. If anything in the spec requires clarification, let us know",
        "created_at": "2024-07-02T15:17:56.134000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think I'm gonna need some help with understanding EIP-7069 here especially this section (I understand the intentions but I think I am confusing things here)",
        "created_at": "2024-07-02T16:20:52.173000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "5483a68aff6020e7985c0e060029cb8b365c3bbd04b88472ed9a4e05cf866340"
            }
        ]
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Fopr step 8 and 9 lets as -",
        "created_at": "2024-07-02T16:21:26.856000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Heh I'm rubber duck debugging again, ok I think I got it",
        "created_at": "2024-07-02T16:21:36.955000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I missed here: \"callerâ€™s remaining gas reduced by\" the words \"reduced by\"",
        "created_at": "2024-07-02T16:21:59.972000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Hi all, Mega EOF specifies that EXTDELEGATECALL cannot call into a legacy contract, however I cannot find this in one of the EIPs (would expect it in 7069). Is it there?",
        "created_at": "2024-07-02T18:51:06.158000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It's in 3540 - https://eips.ethereum.org/EIPS/eip-3540#eof1-contracts-can-only-delegatecall-eof1-contracts - would it make more sense in 7069?",
        "created_at": "2024-07-02T18:59:07.643000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah ok its there. Yes I am seeing 3540 of a deployment / container validation EIP, and 7069 is definitely execution-focused. I would definitely put it there in the semantics of the bullet point list: if we are EXTDELEGATECALL and call into legacy, then also put 1 on stack",
        "created_at": "2024-07-02T19:03:06.624000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "7069 has opcodes that could possibly be used in legacy EVMs, we didn't pitch it to keep the objection surface smaller.  The line about delegate calls also existed in big-eof, which lacked 7069 calls.",
        "created_at": "2024-07-02T19:09:00.849000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Just to clarify I do not have to re-check DATALOADN after I have deployed a contract - right? DATALOADN should be within bounds of my pre-deployed container (it could be valid after deployment, but if it is not before I have to invalidate it)",
        "created_at": "2024-07-02T20:30:11.017000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I guess it's here:\n\n\u003e as indicated in the container header before deployment.\n\nBut wanted just to verify",
        "created_at": "2024-07-02T20:31:13.071000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So I can only read dynamic aux data with DATALOAD and DATACOPY",
        "created_at": "2024-07-02T20:31:28.500000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "~~(or up to 31 bytes with DATALOADN)~~ oh no wait this is not the case",
        "created_at": "2024-07-02T20:31:38.608000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So the extent of dataloadn needs to be within the \"declared\" size of the container.  The container may be truncated, but RETURNCONTRACT must fill it up to be at least the declared size.  If it is longer the data header will be updated to reflect all the aux data added.",
        "created_at": "2024-07-02T20:36:50.528000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So, if the contract is validated and deployed, the DATALOADN should point to a valid data segment.  DATALOAD and DATACOPY, which get runtime sizes, will still need to consider the data section size in their operations.",
        "created_at": "2024-07-02T20:37:47.332000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If I am deploying an initcode container with data size 32, and a DATALOADN\u003c0\u003e this should always be valid if the container is deployed (since it is guaranteed I have 32 bytes of data)\nHowever, if I have an initcode container with data size 32, and DATALOADN\u003c1\u003e, and once I deploy the container the data size is 33, is this possible? Or should I reject the initcontainer (and thus also the parent container with it) beforehand?",
        "created_at": "2024-07-02T20:39:23.956000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Note: the DATALOADN is in the deployed container here, not in the initcode",
        "created_at": "2024-07-02T20:40:21.436000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(so in whatever RETURNCONTRACT returns)",
        "created_at": "2024-07-02T20:40:35.910000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the container to be deployed would need to declare the data size as 33.  That container can have zero actual data, as long as the declared size works out.  auxdata will have to fill up any truncated data.",
        "created_at": "2024-07-02T20:40:57.171000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "aux data first fills up any truncated data before it grows the container.",
        "created_at": "2024-07-02T20:41:25.502000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah ok I might be mixing up the init container here with the actual to-be-deployed container ðŸ¤” Let me re-read the spec",
        "created_at": "2024-07-02T20:43:05.691000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes I did",
        "created_at": "2024-07-02T20:45:10.476000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ok it makes sense, thanks ðŸ™‚",
        "created_at": "2024-07-02T20:45:14.257000+00:00",
        "attachments": null
    }
]