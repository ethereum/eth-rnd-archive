[
    {
        "author": "ben_a_adams",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Would this change for EIP-7702 also work for EOF delegate call to legacy (if also applied there); since that option has been put on the table https://github.com/ethereum/EIPs/pull/8832/files",
        "created_at": "2024-08-28T18:05:57.451000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That would address the main concern, which is an account with an EOF contract disappearing due to a delegate call to a legacy contract.  \n\nAre there any other \"delegate escape hatch\" concerns that would be left with this change?  We can already access all old opodes via a regular call (and standard contracts are starting to materialize - https://x.com/optimizoor/status/1828852770113536337 - I'm not recalling any other sets of altered behavior that were a concern.",
        "created_at": "2024-08-28T19:10:34.789000+00:00",
        "attachments": null
    },
    {
        "author": "frangio_",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Perhaps access to CALLCODE? But CALLCODE is sort of equivalent to CALL+DELEGATECALL so it wouldn't be a new concern",
        "created_at": "2024-08-28T19:35:04.576000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I don't think I follow here. Delegatecall to legacy is not allowed (also not EXTDELEGATECALL). What does said contract do? I am trying to decode it but I do not see what this does, and how it affects EOF?",
        "created_at": "2024-08-28T19:35:36.464000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "For EOF to extcodesize on itself, this would return 2, no?",
        "created_at": "2024-08-28T19:36:20.323000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(via the call to legacy)",
        "created_at": "2024-08-28T19:36:25.900000+00:00",
        "attachments": null
    },
    {
        "author": "frangio_",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That contract is a workaround for EOF contracts to use EXTCODECOPY and EXTCODESIZE. See discussion here: https://hackmd.io/@frangio/S1VvatXiR\n\nYes, extcodesize on itself returns 2 and that's fine for the purposes of implementing an \"ISCONTRACT\" operation.\n\nIMO the existence of this workaround is justification to simply enable the opcodes on EOF, because as I've described it's problematic for library authors to have to hardcode these addresses in libraries",
        "created_at": "2024-08-28T19:42:08.038000+00:00",
        "attachments": null
    },
    {
        "author": "frangio_",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Another \"delegate escape hatch concern\" might be access to CREATE? ~~As far as I can tell EOF contracts don't use their account nonce (I guess it remains 0?) and being able to use CREATE changes that~~",
        "created_at": "2024-08-28T19:45:48.008000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Interesting, I think EthJS bumps the nonce for EOFCREATE",
        "created_at": "2024-08-28T19:46:20.330000+00:00",
        "attachments": null
    },
    {
        "author": "frangio_",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My bad, EOFCREATE does increment the nonce",
        "created_at": "2024-08-28T19:46:51.850000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ahh ok the graph of that bytecode is incomplete, there is a lot of STOPs added",
        "created_at": "2024-08-28T19:50:00.863000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Now it makes some kind of sense",
        "created_at": "2024-08-28T19:50:10.206000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "CALLCODE is dead, won't be showing up in EOF.",
        "created_at": "2024-08-28T19:50:52.901000+00:00",
        "attachments": null
    },
    {
        "author": "frangio_",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I was trying to say that if delegatecall to Legacy is enabled (with the same change as EIP-7702) an EOF contract would be able to execute CALLCODE in its context through a Legacy contract and that might break the assumption that that was impossible -- That said I don't see a concrete problem",
        "created_at": "2024-08-28T19:53:58.279000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Shouldn't it be PUSH1 0x20? ðŸ˜…",
        "created_at": "2024-08-28T19:54:11.683000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh no wait, its the XOR",
        "created_at": "2024-08-28T19:55:48.269000+00:00",
        "attachments": null
    }
]