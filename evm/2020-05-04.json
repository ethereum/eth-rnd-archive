[
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "first",
        "created_at": "2020-05-04T14:07:16.996000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "congratulations",
        "created_at": "2020-05-04T14:07:51.213000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This channel is for discussing proposed EVM changes, including all the ones proposed as EIPs for Eth1.",
        "created_at": "2020-05-04T14:08:11.939000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "First useful message, could be pinned ^",
        "created_at": "2020-05-04T14:08:18.845000+00:00",
        "attachments": null
    },
    {
        "author": "madeof_tin7509",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "üëè",
        "created_at": "2020-05-04T14:08:38.058000+00:00",
        "attachments": null
    },
    {
        "author": "madeof_tin7509",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "",
        "created_at": "2020-05-04T14:08:45.113000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "üôá‚Äç‚ôÇÔ∏è",
        "created_at": "2020-05-04T14:13:40.533000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "",
        "created_at": "2020-05-04T14:15:09.638000+00:00",
        "attachments": [
            {
                "type": "",
                "origin_name": "iu.png",
                "content": "a1e06037b54c94a155e49d104acba8ff1abb88719bdcec8e1e963758a55c9761"
            }
        ]
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "To continue from previous room: I'm analyzing all contract code at block `9666637`. I dumped out all code (22G), and am now doing a filtering: only code containing \n\n- At least one `JUMP` or `JUMPI`,\n- At least one `BEGINSUB` (0xB2)\n- And a `JUMPDEST` _after_ the `BEGINSUB`",
        "created_at": "2020-05-04T14:22:32.965000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "IIUC, these are the contracts that would get bitten if we were to implement the new proposed subroutine-version by axic/pawel",
        "created_at": "2020-05-04T14:23:49.237000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Afaict, the affected contracts are 'data', and the few I've looked at would exit after at most a few steps, due to invalid opcode and/or insufficient stack depth for an operation",
        "created_at": "2020-05-04T14:24:45.245000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "how do we have `BEGINSUB` on the mainnet? I thought it was not activated yet?",
        "created_at": "2020-05-04T14:26:34.144000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Remember: EVM has no validation so random bytes can be considered opcodes\n\nAnd with subroutines we are giving meaning to one of those random bytes.",
        "created_at": "2020-05-04T14:26:57.696000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!211091239112671234\u003e do you have a list of these contracts?",
        "created_at": "2020-05-04T15:09:25.454000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I soon will.. it's still running",
        "created_at": "2020-05-04T15:12:39.794000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "actually, I won't have a list of the addresses, only the `code, codeHash, balance, sha3(address)`",
        "created_at": "2020-05-04T15:14:24.989000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'll plop it into a gist",
        "created_at": "2020-05-04T15:14:41.076000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://gist.github.com/holiman/2cc4ccf268bd45901aec741e06288cc4 (the gist becomes truncated when you view it, but there's a link to the full gist from there)",
        "created_at": "2020-05-04T15:28:11.085000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "On line 41/42 contracts start with `0xff` which is selfdestruct. Are those data contracts?",
        "created_at": "2020-05-04T15:32:18.137000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The ones starting with `60806040` are likely solidity, the others are unlikely solidity üôÇ",
        "created_at": "2020-05-04T15:32:57.119000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Took a random one (line 3) and the only beginsub is in the \"solidity metadata\". A script should help: check if the bytecode ends in solidity metadata and if the begindata falls into that region, consider it \"safe\".",
        "created_at": "2020-05-04T15:37:48.984000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We could probably remove the bulk of them by filtering any which will error out in the first couple of steps",
        "created_at": "2020-05-04T15:40:56.296000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But we can't disregard non-solidity, since, y'know, there are other ways to code üôÇ",
        "created_at": "2020-05-04T15:41:31.568000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sure, but getting rid of these solidity cases should reduce the sample size üôÇ",
        "created_at": "2020-05-04T15:42:14.117000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh I thought you meant that we could ignore the 'data'-contracts and focus on the solidity ones... now I understand",
        "created_at": "2020-05-04T15:48:31.699000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Anyway, it's only `438` contracts, so pretty easy to script/filter on a laptop",
        "created_at": "2020-05-04T15:50:51.811000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Looked at all the non-solidity looking ones on the truncated gist page (~25 of them) and all of them seem to be data contracts (because they have gibberish opcodes at the beginning)",
        "created_at": "2020-05-04T16:05:59.937000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Out of `438`, we can remove `133` as obvious data-contracts which fail at first opcode. Remaining `305` mostly start with a PUSH1",
        "created_at": "2020-05-04T18:14:16.138000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Did you push the reduced list?",
        "created_at": "2020-05-04T18:45:05.253000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://gist.github.com/holiman/bd971272123bd01248f65b2f161bbb1a",
        "created_at": "2020-05-04T18:53:54.692000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Maybe another 10-15 can be discarded by looking at the next op, and filtering a bit more aggressively on the first (a few slipped by me)",
        "created_at": "2020-05-04T18:56:16.254000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But I estimate there's about ~290 solidity contracts",
        "created_at": "2020-05-04T18:56:37.392000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Did a metadata decoding run on these. Fun act: A lot of them are Solidity pre-0.5.0. And a bunch of them have the experimental flag set. There is only two compiled with 0.6.x.",
        "created_at": "2020-05-04T21:30:08.751000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Out of your list, only 167 don't have the BEGINSUB within the solidity metadata. Including 70 which don't have a metadata (so probably not solidity).",
        "created_at": "2020-05-04T21:35:31.784000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "They are actually solidity (at least set the \"free memory\") just are stripped.",
        "created_at": "2020-05-04T21:40:26.206000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://gist.github.com/axic/d03cfa1155554083999e858f375e21b7",
        "created_at": "2020-05-04T21:40:29.502000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "A lot of them may have a valid first opcode (but would halt anyway, such as CODECOPY as first instruction) or have an invalid second opcode. I won't do that filtering now, but suggest it as the next step.",
        "created_at": "2020-05-04T21:54:14.825000+00:00",
        "attachments": null
    }
]