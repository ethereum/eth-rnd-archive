[
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This is not how this is implemented in clients. They don't track EIP dependencies.",
        "created_at": "2022-12-21T08:38:28.707000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My strong preference is to test 6 EIPs together: EOFv1 + 3860.",
        "created_at": "2022-12-21T08:40:14.121000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We can pick 3540 as the indicator for EOFv1. The 3860 may be explicit or not.",
        "created_at": "2022-12-21T08:42:38.384000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We're trying to check the tests, but we have many problems. We see many EOF PRs with tests. One PR is fixing the init code return, but it is not following the spec for other cases, etc. We're debugging the tests and finding that we must comment correct code to pass the tests. Of course, we might have bugs in implementations, but it is hard to verify them. Do we have PR that should pass now across all the clients? Or which PR is the closest to the spec? Which PR/commit is recommended for EL Devs to start checking their implementation? https://github.com/ethereum/tests/pull/1087 this one?",
        "created_at": "2022-12-21T10:13:17.832000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "For the `max_stack_height` the max value is 1024 what is `0x400`. Do you want to cap it to 10 bits: 1023 `0x3FF`?",
        "created_at": "2022-12-21T10:50:27.195000+00:00",
        "attachments": null
    },
    {
        "author": "bobsummerwill",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@393119312350543872\u003e ^^",
        "created_at": "2022-12-21T19:06:43.420000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The tests generated in GeneralStateTests/EIPTests folder, specifically in stEOF, are the latest accepted implementation tests for given eip number.",
        "created_at": "2022-12-21T19:08:29.237000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We aim to cover a specific Eip number one at a time at first. So that we can start making tests for one change (one eip), before waiting for all the changes in one pack to be implemented",
        "created_at": "2022-12-21T19:11:05.098000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thx for answer üôè \nOkay, so for EIP3540 tests - Should we run \u0026 pass all the tests from this PR: https://github.com/ethereum/tests/pull/1112 ? Of course, from this folder: https://github.com/ipsilon/tests/tree/eip-3540-update/GeneralStateTests/EIPTests/stEOF/stEIP3540 \nIf I understood correctly, we should disable all other EIPs (including 3670 \u0026 3860) to try these tests. Do we have any known issues with these tests? We were trying it too, but we might try it again. cc: \u003c@226589605816696832\u003e",
        "created_at": "2022-12-21T19:34:25.997000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Here it gets trickier. By eip page 3540 requires 3541 and 3860 so that implies that pure 3540 is not supposed to exist without 3541 and 3860",
        "created_at": "2022-12-21T19:46:58.533000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yeah, but the tests were generated with the assumption that 3860 is disabled, right? üòâ",
        "created_at": "2022-12-21T20:07:49.263000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "3541 is London EIP so it is not the problem",
        "created_at": "2022-12-21T20:08:04.763000+00:00",
        "attachments": null
    },
    {
        "author": "bobsummerwill",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Made the Vyper change myself.  Was not clear I had access to do so.",
        "created_at": "2022-12-21T20:15:00.631000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You have access since 10 mins.",
        "created_at": "2022-12-21T20:16:08.477000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@758579010027782144\u003e \u003c@393119312350543872\u003e I believe tests need an update because there are some changes to the spec. And this time we should include all EIPs.",
        "created_at": "2022-12-21T20:17:37.840000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Which client implemented all eips for shanghai?",
        "created_at": "2022-12-21T20:22:14.421000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I can generate tests with geth/besu/nimbus/ethereumjs",
        "created_at": "2022-12-21T20:23:11.664000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@275684146658148352\u003e ?",
        "created_at": "2022-12-21T20:23:40.781000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We (Nethermind) implemented, but we don't have test generator üò¶",
        "created_at": "2022-12-21T20:27:36.590000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We use state transition toolhttps://ethereum-tests.readthedocs.io/en/latest/t8ntool-ref.html",
        "created_at": "2022-12-21T20:30:42.867000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Does Nethermind support linux?",
        "created_at": "2022-12-21T20:31:00.514000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yes, but we can't generate tests with Nethermind. I opened the issue today: https://github.com/NethermindEth/nethermind/issues/5044",
        "created_at": "2022-12-21T20:31:51.330000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Here is the test data from geth for transition tool implementation https://github.com/ethereum/go-ethereum/tree/master/cmd/evm/testdata",
        "created_at": "2022-12-21T20:32:46.654000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "With this tool I can run and generate tests, and in the future more infrastructure comes from python test team too for test generation",
        "created_at": "2022-12-21T20:33:29.989000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@543900561460822016\u003e ^^^",
        "created_at": "2022-12-21T20:37:25.372000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There is an issue related to the data section in EOF. See \"Account for constructor arguments during on-chain contract creation\" in https://notes.ethereum.org/@ipsilon/eof1-checklist.\n\nThe thing is that data is used to pass arguments to contract constructors. Traditionally, the ABI-encoded values are appended to the initcode. In the EOF the data size is in the EOF header and it must match the exact number of bytes.\n1. This means all tx tools must be aware of that and not only append the constructor arguments but also patch the EOF header with the correct data size. This issue we were aware of but considered \"acceptable\".\n2. Today we realized the same situation is also for using `CREATE` instruction, i.e. when a contract creates a new contract. The EOF contract must also patch the EOF container with initcode for `CREATE` with the correct data size. This is not horrible but also not trivial considering EVM works with `uint256` and EOF keeps sizes as `uint16`.\n3. It's getting even worse with `CREATE2` for which users may want to predict the address before creating an account. And the address depends on the hash of the EOF initcode. \u003c@427011130318389248\u003e says it may be impossible to keep this use-case working in general case.\n\nOne solution we considered some time ago was to just allow any bytes after the code, without specifying the size. Definitely not very elegant but makes all the use-cases above work and EOF-agnostic.",
        "created_at": "2022-12-21T20:57:15.473000+00:00",
        "attachments": null
    },
    {
        "author": "bobsummerwill",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thanks, Pawel.\nSo I have added a Vyper column and status tracking.\nI also added links in for the notes for all of the meetings, \u003c@642887713246150666\u003e.",
        "created_at": "2022-12-21T20:58:16.666000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "what if we relax the overall size restriction of the container to allow arbitrary bytes _after_ the container? so constructor args would live \"outside\" the eof container?",
        "created_at": "2022-12-21T21:02:26.703000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This is the mentioned solution.",
        "created_at": "2022-12-21T21:02:56.819000+00:00",
        "attachments": null
    },
    {
        "author": "daniel.kirchner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think \u003c@543900561460822016\u003e means still having a sized data section, but allowing arbitrary data after that, versus not specifying the size of the data section at all, right?",
        "created_at": "2022-12-21T21:03:40.036000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "oh sorry,  i misread and was thinking the above solution included removing the data size from the header and just interpreting all bytes after code to be data",
        "created_at": "2022-12-21T21:03:42.813000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Besu implements all EIPs at some state of their history.  But it is not up to the current eips PR changes.",
        "created_at": "2022-12-21T21:04:46.587000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If you can have data outside, why do you want to have them also inside?",
        "created_at": "2022-12-21T21:04:47.613000+00:00",
        "attachments": null
    },
    {
        "author": "daniel.kirchner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Allowing arbitrary data after the sized data section is what an older implementation in evmone we were testing against did, resulting in us only realizing this now, so that solution works for us. But yeah, I'm also not sure if having a sized data section makes much sense at all then.",
        "created_at": "2022-12-21T21:05:07.935000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "what if you could only have arbitrary bytes outside the container in initcode?",
        "created_at": "2022-12-21T21:05:53.044000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that way, all deployed bytecode is a valid eof container",
        "created_at": "2022-12-21T21:06:33.850000+00:00",
        "attachments": null
    },
    {
        "author": "daniel.kirchner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Allowing this for initcode would be enough for solving the issue.",
        "created_at": "2022-12-21T21:07:14.233000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i'm also curious if there are any specific downsides ppl can think of not having the data section being sized - it feels weird for the header to not define the total size of the container in general, but I don't see many concrete issues that arise from it _not_ defining the entire size",
        "created_at": "2022-12-21T21:07:47.365000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "1. You have some kind of meta-param \"total container size\" living outside. You have to take the value from somewhere. E.g. memory buffer size, file size, database field size, etc.\n2. With the current EOF format you can stream EOFs just by concatenating them. After, you need at least tar-like encoding.",
        "created_at": "2022-12-21T21:10:55.010000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "On the other hand we are saving 3 bytes in the header üôÇ",
        "created_at": "2022-12-21T21:11:36.043000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I do like the subtlety of allowing initcode only to have data past the container.",
        "created_at": "2022-12-21T21:12:27.115000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "more radical alternative, modify create opcodes to take constructor arguments separately and introduce opcodes to load the arguments",
        "created_at": "2022-12-21T21:13:01.888000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This is my big-gun solution: brainstorm and design ideal `CREATE` instructions. (not for the current deadline)",
        "created_at": "2022-12-21T21:20:30.513000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Likely to be so. The test explicitly mention only this\n`Merge+3540+3670` and 3860 appeared after",
        "created_at": "2022-12-21T23:43:25.850000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think we noticed some of the `Merge+3540+3670` have 3860 enabled. \u003c@450651770243252225\u003e confirm?",
        "created_at": "2022-12-21T23:45:54.304000+00:00",
        "attachments": null
    }
]