[
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@408154589494247424\u003e I think I'm still unclear about how CALLFI would solve constant stack height restriction for you. If CALLFI acts just like RJUMPI + CALLF macro, then nothing changes for stack validation.",
        "created_at": "2023-07-26T11:07:41.851000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Maybe CALLFI is supposed to automatically pop callee's inputs in case condition is not true and that would solve something somehow?",
        "created_at": "2023-07-26T11:07:45.937000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(that would make CALLFI non-constant-time instruction and for RETF we argued against this)",
        "created_at": "2023-07-26T11:08:10.734000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I will not be able to make it today.",
        "created_at": "2023-07-26T11:35:05.478000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Re CREATEF - one maybe minor concern is it probably would mean that to get new contract address we only hash init_section, unlike hashing entire initcontainer as for CREATE3/4. And in case init_section calls other sections, it would mean not all executed init code is included in hashing",
        "created_at": "2023-07-26T12:58:10.869000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "actually in \u003c@403707149043105803\u003e 's doc \n\u003e calculate new_address as `keccak256(0xff || sender || salt || inicodesection_index || keccak256(container))[12:]`\n\nwhat's `container` here, entire parent container of initsection? seems excessive, what if it's some huge contract?",
        "created_at": "2023-07-26T13:04:02.151000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It does not do anything about stack height but it improves gas and code size",
        "created_at": "2023-07-26T13:17:54.860000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Needing the contract address at creation time didn't cross my mind.  So it will need to switch to two creates instead of two returns... ðŸ˜¦ - container would be the parent container hash, which we should already have handy.",
        "created_at": "2023-07-26T14:09:56.005000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "gas of CALLFI then will be gas of RJUMPI + gas of CALLF\n\ncode size - 3 byte savings to get rid of RJUMPI?",
        "created_at": "2023-07-26T14:36:33.244000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "3-4 bytes, + it's a very common sequence, so codegen for current EOF draft actually produces code that is larger than for current EVM (even after jumpdest removal)",
        "created_at": "2023-07-26T14:38:00.062000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i've posted comments and analysis earlier in this channel",
        "created_at": "2023-07-26T14:38:16.018000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "maybe RJUMPI - RJUMP + CALLF",
        "created_at": "2023-07-26T14:38:29.421000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "EIPEP going into extra innings, will be on the call soon... anyone on it?",
        "created_at": "2023-07-26T15:02:50.889000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "still waiting for ipsilon",
        "created_at": "2023-07-26T15:05:22.693000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@403707149043105803\u003e we are done with the meeting already heh do you want to come on and give your update?",
        "created_at": "2023-07-26T15:13:51.332000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "zoom link",
        "created_at": "2023-07-26T15:14:05.057000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://ethereumfoundation.zoom.us/j/85004720429?pwd=K1hnV1Z4bE1RZW50VEZTQnlCNHNuUT09",
        "created_at": "2023-07-26T15:14:25.950000+00:00",
        "attachments": null
    },
    {
        "author": "demiurgos_23",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@539495253418180618\u003e what balance do we initialize the precompile account to ? Nethermind is using 1 for now",
        "created_at": "2023-07-26T15:26:44.598000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "doesn't it already have a balance on mainnet?",
        "created_at": "2023-07-26T15:30:36.872000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "we wouldn't want to overwrite?",
        "created_at": "2023-07-26T15:30:46.281000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My 3 meta questions to be contemplated before the next meeting:\n1. What checkpoints to do to get to so EOF can be a headliner in Prague\n2. Do we have feedback from all the appropriate communities this will impact (so fare we have data contracts (SSTORE2?), Solidity and Vyper)\n3. What changes do we need to focus on to get to a finalizable spec.",
        "created_at": "2023-07-26T15:32:09.187000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Re EOF constant stack height validation restriction: I have the following idea about making it less restricted.\n\n- We use the old \u003c@403707149043105803\u003e  idea about \"forward code restriction\" (https://github.com/ipsilon/EIPs/pull/1), i.e. we require compilers to order the code blocks (inside a section) in a way that any block after terminating instruction (like e.g. helpers) is referenced by earlier _forward_ jump. This allows to do stack validation in one sequential pass over the code instead of using a worklist and following each jump like we do now.\n\n- Instead of one stack_height value for each code position, we record the range (stack_height_min, stack_height_max) for each position.\n\n- We treat backward and forward jumps differently:\n  -  Backward jump still requires stack height of target to be constant - this should be fine restriction, because backwards jumps are normally used for loops, and loops won't be allowed to grow/shrink stack\n  - Forward jumps to the same target are allowed to be from different stack heights and we update target's (stack_height_min, stack_height_max) on each forward jump.\n\nBecause validation is one sequential pass, by the time we reach jump target we know the real (min, max) stack range for it among all jumps.",
        "created_at": "2023-07-26T18:55:39.272000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What if we backwards jump into a section of code with a stack height range.  Segment one has two forward jumps to the start of segment 2 with a range of 2,3. those ranges would need to carry forward to a point we would do a backwards jump within segment 2  \n* what do we check for?  \n* Are backwards jumps now banned when the stack height is a range? (I think that's what requiring the height of the taret to be constant means)\n* Is there no way to \"narrow\" the range other than a frame terminal operation like invalid, revert, stop, or return or a section terminal jumpf?",
        "created_at": "2023-07-26T19:06:33.252000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "prohibiting backwards jumps when there is a range does sound like what vyper and solidity are asking for: terminal cases like raising reverts and short-curcuit returns, so it's not all bad.",
        "created_at": "2023-07-26T19:07:15.044000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "at backwards jump we check expected_min == min \u0026\u0026 expected_max == max",
        "created_at": "2023-07-26T19:10:21.410000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so the range must match exactly.",
        "created_at": "2023-07-26T19:10:49.455000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And when we increase the stack size the whole range jumps.  PUSH0 on 2,3 becomes 3,4 for the next  op?",
        "created_at": "2023-07-26T19:11:23.805000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "and pop only checks that min \u003e 0?",
        "created_at": "2023-07-26T19:11:30.874000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "potentially could be relaxed to expected_min \u003e=min \u0026\u0026 expected_max \u003c= max, but not sure if useful",
        "created_at": "2023-07-26T19:11:44.729000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yes, exactly",
        "created_at": "2023-07-26T19:12:00.086000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yes",
        "created_at": "2023-07-26T19:12:07.228000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Lets start at exact match then and see if we need to make it wider.",
        "created_at": "2023-07-26T19:12:08.223000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I have a prototype code for this in evmone, but not very convinced yet if it works https://github.com/ethereum/evmone/pull/676",
        "created_at": "2023-07-26T19:16:46.185000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also one implication of this that I realized: RETF will have to auto-clean the stack, because if there's a reused code segment with RETF, it might reach it with different stack heights. \n\nAlternatively we allow RETF only in constant-stack segments.",
        "created_at": "2023-07-26T19:17:36.305000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Since we have a return stack we have the data we need for RETF to clean the stack.",
        "created_at": "2023-07-26T19:18:43.793000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yes, it's possible, we decided against this originally, because then RETF is a non-constant-time operation, some dynamic gas formula needed",
        "created_at": "2023-07-26T19:20:36.492000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Woldn't just moving the SP be constant time?  SP won't move up without a write.",
        "created_at": "2023-07-26T19:21:23.227000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "No, if there're outputs, they must be moved to the bottom of frame, i.e. extra items are between outputs and parent frame",
        "created_at": "2023-07-26T19:25:22.989000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah... there's the nonlinearity.  DEEPPOP has re-entered the chat.  I'm happy keeping RETF on a fixed range stack (min=max)",
        "created_at": "2023-07-26T19:26:33.693000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yeah probably should be sufficient",
        "created_at": "2023-07-26T19:27:16.795000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "thoughts on deploying contracts by copying the code at another address and providing a map of storage slots? e.g. no init code",
        "created_at": "2023-07-26T23:16:16.533000+00:00",
        "attachments": null
    }
]