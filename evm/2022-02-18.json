[
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I still argue that we need clients to be able to parallelize work more so we can keep velocity up.  I'm a fan of modularization of clients to achieve this, sort of like we have done with CL/EL split.  One can similarly imagine extracting the EVM out from all EL clients into a separate service that can then be maintained/upgraded in isolation from the rest of the stuff ELs do.",
        "created_at": "2022-02-18T04:29:02.248000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That only helps if there are actually different people working on that EVM component.  But if we had different people available to work on the EVM component in most clients it's separate enough that they would be already anyway. You don't have to deploy separately to have good modularity and encapsulation.",
        "created_at": "2022-02-18T04:37:07.816000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In my experience, having smaller swappable components encourages new people to participate in development who wouldn't have previously.",
        "created_at": "2022-02-18T04:45:26.294000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "EVMC is already a fully swappable EVM.",
        "created_at": "2022-02-18T04:46:11.441000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is easier to build a new tiny service that matches a well specified API than to dive into a monolithic piece of soft are and engage.  Also, it encourages more competition on smaller sections of code, rather than having to compete on the entire client.",
        "created_at": "2022-02-18T04:46:19.205000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We need clients to support dropping it in still.",
        "created_at": "2022-02-18T04:46:42.703000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Not all clients support interfacing to C, or do it badly.  And I understand most client teams prefer to keep a \"clean\" single-language codebase.  Where EVMC can't be dropped in it's a good example and POC.  But modularity is just good software engineering.\n\nAnyway, I mainly meant the smaller group of people actively doing EVM R\u0026D aren't much involved in CL stuff.  And the actual amount of code involved for these is not actually that much to add to existing VMs when the time comes.  Subroutines we've already done once.\n\nMore selfishly, applying for a grant to support my R\u0026D might be a good idea, but if I'm applying to do \"stuff that might ship someday but who knows when if ever\" I wouldn't expect much response.",
        "created_at": "2022-02-18T05:15:22.324000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e Not all clients support interfacing to C, or do it badly.\nThis is why I advocate for a separate service that communicates over HTTP/WS instead, because every language can do that easily.",
        "created_at": "2022-02-18T05:15:53.318000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That's an idea that should be doable as a wrapper on EVMC.",
        "created_at": "2022-02-18T05:17:14.259000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Although I recall \u003c@456226577798135808\u003e telling there issues with interfacing with Turbogeth that had more to do with (I think) the protocol that the Go/C interface.  \u003c@!425274498732916736\u003e might know better how to do what you suggest.",
        "created_at": "2022-02-18T05:19:29.243000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In the past Alexey has lobbied for pulling transaction management (pending queue) out into a separate service.  I am in support of any extraction.",
        "created_at": "2022-02-18T05:20:24.666000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I've long supported more frequent, more coherent upgrades, which would be easier if they amounted to just swapping out services.",
        "created_at": "2022-02-18T05:22:22.104000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I agree with you here. I think a few of the concerns that I've heard about fully splitting up the EVM work are: \n\n1. It still can cause consensus issues, so even though the implementations can be parallelized, the testing/review/etc. is much harder; \n2. A lot of the edge cases we've added in the EVM have made it harder to fully separate out. \n\nI suspect in practice (1) is more of an issue than (2).",
        "created_at": "2022-02-18T06:31:04.715000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Maybe we can poll the various client teams and ask them what sort of consensus changes would be the biggest help toward increasing their velocity?",
        "created_at": "2022-02-18T06:32:11.888000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e It still can cause consensus issues, so even though the implementations can be parallelized, the testing/review/etc. is much harder\nYeah.  The EVM is at the core of the state transition function.",
        "created_at": "2022-02-18T07:43:50.297000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This is part of why I'd like to see more focused releases.  The parallel lines converge  near the end, at the final testing/review/etc phase, and can be more independent before that.    And that last phase isn't testing multiple unrelated features.",
        "created_at": "2022-02-18T07:50:44.262000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "EVMC is currently used directly by Solidity. The Silkworm (C++ Erigon) is using C++ API which is close to EVMC. Erigon has tried EVMC-Go and evmone as the EVM and they were not satisfied with the EVMC-Go performance because of expensive transition between C and Go runtimes. There are some small changes in C-Go and evmone got faster since then but nobody is keeping the prototype up to date to even monitor the status.",
        "created_at": "2022-02-18T09:50:59.219000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The EVMC operates on EVM calls level (the lowest level practically possible). Therefore the EVM implementation has to exchange a lot of small pieces of data in case of any State access. This defeated EVMC-Go and makes wrapping with any kind of inter-process communication (e.g. HTTP/WS) _totally_ impractical.",
        "created_at": "2022-02-18T09:55:48.859000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I can rise (and plan to) the API boundary for EVMC to transaction level. But above it I _really_ need help from client devs.",
        "created_at": "2022-02-18T09:57:05.772000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There was some interest from other Clients to try EVMC (in particular Nethermind and nimbus) but it never reached \"anything working\" stage.",
        "created_at": "2022-02-18T09:59:40.350000+00:00",
        "attachments": null
    },
    {
        "author": "jlokier",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "EVMC is sort of used by Nimbus - Nimbus uses the EVMC API internally, and can already load 3rd party EVMC-compatible EVMs as a shared library and use them instead of its internal one.",
        "created_at": "2022-02-18T10:38:06.170000+00:00",
        "attachments": null
    },
    {
        "author": "jlokier",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "However, some of the work on Nimbus internals wasn't completed, so the results of calls to an external EVM don't match what they should be.",
        "created_at": "2022-02-18T10:38:34.517000+00:00",
        "attachments": null
    },
    {
        "author": "jlokier",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I took the view that EVMC is a pretty good API that separates concerns well, and that the cost of most types of data transfer across the API boundary is low compared with the database lookup cost associated with each of those.",
        "created_at": "2022-02-18T10:41:47.761000+00:00",
        "attachments": null
    },
    {
        "author": "jlokier",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I haven't examined the real cost of using it over e.g. HTTP/WS but it seems likely that (a) latency is the bigger problem and the data is small, so running 1000s of parallel EVMs, multiplexed is what that would do best, and (b) running at the transaction level rather than individual `CALL` level makes sense, and perhaps running at the sequence-of-transactions level.",
        "created_at": "2022-02-18T10:44:50.511000+00:00",
        "attachments": null
    },
    {
        "author": "jlokier",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Fwiw, Nimbus did reach \"something working\": https://github.com/status-im/nimbus-eth1/pull/909",
        "created_at": "2022-02-18T10:51:16.792000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm sorry, this information is not reaching me often. Glad to hear that.",
        "created_at": "2022-02-18T10:53:28.102000+00:00",
        "attachments": null
    },
    {
        "author": "jlokier",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It was quite recent and the work isn't finished (still gives incorrect results), so it wasn't worth saying much about at that point. That line of development was put on hold to focus on storage-space optimisations.",
        "created_at": "2022-02-18T10:56:07.435000+00:00",
        "attachments": null
    },
    {
        "author": "jlokier",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think the main thing I wanted to say is that Nimbus adopted EVMC more firmly after seeing that it's a well-designed API boundary.  I'm surprised the Go-C overhead got in the way of adopting it in Go implementations; I didn't know about that aspect of Go.",
        "created_at": "2022-02-18T10:58:19.329000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This can be very useful, current EVMC interface feels like it is set at too low level to be usable but having API on level of transaction seems more natural and better. I did something similar in revm and it came out very elegant, i have two inputs:\n Env (tx/block info) https://github.com/bluealloy/revm/blob/dc7d8c8dd89e28f1d44338babea48ebcd13ffd8e/crates/revm/src/models.rs#L125-L156 \nand db trait for runtime: https://github.com/bluealloy/revm/blob/dc7d8c8dd89e28f1d44338babea48ebcd13ffd8e/crates/revm/src/db/traits.rs#L10-L20",
        "created_at": "2022-02-18T12:15:13.030000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm all for this! I do think it would require someone to champion it, work with client teams, etc. and it's likely a year+ effort that person is getting into, but it would be super valuable if you could get it done!",
        "created_at": "2022-02-18T13:24:35.553000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "For what it's worth, I think proposers of EVM changes can speed up the process by implementing the features in one ore more clients. That's why we have been implementing them in geth + evmone.",
        "created_at": "2022-02-18T13:25:59.813000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sorry, but I'm probably not the person to champion this. I like to crank code ðŸ˜‰",
        "created_at": "2022-02-18T14:07:22.653000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!187490121698770945\u003e might have an opinion.  And there is probably a better channel for this.",
        "created_at": "2022-02-18T14:26:47.453000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I recall making this point years ago -- I think most every team is doing continuous integration, so why do we act like an IBM or Oracle, operating on a long schedule?",
        "created_at": "2022-02-18T14:30:27.565000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "because we can't rollback changes ðŸ˜… ?",
        "created_at": "2022-02-18T14:31:53.221000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm thinking that these big upgrades increase the risk.",
        "created_at": "2022-02-18T14:32:45.462000+00:00",
        "attachments": null
    },
    {
        "author": "jlokier",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Changing EVMC to be at transaction level instead of call level has a downside: Currently it's possible to use EVMC with two separate EVMs, selected per contract address, one to handle the precompiles (SHA256 etc), the other which handles bytecodes.",
        "created_at": "2022-02-18T14:32:51.501000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Probably a better channel for this after the meeting.",
        "created_at": "2022-02-18T14:33:26.110000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If you use this in practice we can keep it supported.",
        "created_at": "2022-02-18T16:53:02.215000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!807285075736789062\u003e \u003c@!429719902363058177\u003e Most of EVMC discussion is happening on Erigon discord \u003c#706868829900505180\u003ec-evm1. Drop me any news or issue, I really want to help.",
        "created_at": "2022-02-18T16:57:28.111000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This is conceptually not very different from EVMC. However, so values there are lists. So far I was able to avoid lists in EVMC API ðŸ™‚",
        "created_at": "2022-02-18T17:00:55.698000+00:00",
        "attachments": null
    }
]