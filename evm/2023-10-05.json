[
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I had a new concern about this - given that CREATE3/4 appends data section, it might happen that data section was empty in subcontainer, then creation would need to not only append, but also insert data header, if it's optional. That's kinda messy",
        "created_at": "2023-10-05T12:31:04.251000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If you don't want to copy the contract.  You will have to re-allocate it to new memory with extra bytes at the end anyway.",
        "created_at": "2023-10-05T12:32:14.310000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Memory/computation complexity can be the same I think, but a bit more complexity in implementation",
        "created_at": "2023-10-05T12:39:44.134000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Another idea is for subcontainers instead of expected deploy size in subcontainer header to declare expected data section size inside subcontainer's data section header.\n\nThen subcontainers will need to be validated with a relaxed rule: \"sum of declared in headers section sizes \u003e= full container size\"\n\nThis will avoid \"apending data section needs inserting data header\" problem.\n\n(may be not very future proof because assumes data section is always the last one)",
        "created_at": "2023-10-05T14:03:49.268000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I feel it would be cleaner to not validate subcontainers.  When a subcontaienr is pulled out with CREATE3 it will be validated again post-constrution anyway, right?  And how deeply do we validate? All sub-sub-sub-containers?  I think we are looking at hundreds of layers of nesting.",
        "created_at": "2023-10-05T14:39:52.445000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i don't think containers are typically nested that deep",
        "created_at": "2023-10-05T14:42:57.071000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it's fairly easy to impose a limit on nesting too",
        "created_at": "2023-10-05T14:43:05.545000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "btw, i was looking at the header spec, and it looks like there are 6 bytes of overhead per method? i think this adds up, and compressing header bytes is worth it",
        "created_at": "2023-10-05T14:43:59.508000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The special cases are where consensus failures tend to develop.  It may be easy but I'm concerned that it's still a net negative considering the fuzzing risks.  (and yes, people will troll edge cases just to try and set things on fire)",
        "created_at": "2023-10-05T14:46:14.408000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i mean the concern is some kind of stack depth issue bc of nesting right?",
        "created_at": "2023-10-05T14:50:15.122000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "maybe there should just be an upfront cost to validation (in addition to the existing per-bye/word cost)",
        "created_at": "2023-10-05T14:50:45.804000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so each container charges 100 gas upfront for validation",
        "created_at": "2023-10-05T14:50:56.414000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Stack depth can be avoided with iterative.  It's O(n^2) net validations if each subcontainer is deployed.",
        "created_at": "2023-10-05T14:51:07.573000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Making subcontainer opaque solves many problems elegantly.",
        "created_at": "2023-10-05T14:51:51.700000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ah o(n^2)? i thought andrei said yesterday it was linear",
        "created_at": "2023-10-05T14:52:37.021000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Per container.  But then you deploy the first subcontainer, which gets re-validated, along with it's subcontainers.  so by the time you deploy the bottom container it's been validated N times.",
        "created_at": "2023-10-05T14:53:43.849000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "hm interesting",
        "created_at": "2023-10-05T14:55:34.115000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "do the later deployments even need to be validated again? since they have already been validated",
        "created_at": "2023-10-05T14:55:49.255000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "also, it's not a dos vector, it's just that users will overpay for deployments basically",
        "created_at": "2023-10-05T14:56:11.048000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If we are re-writing the container by appending data and changing the length we should revalidate it.",
        "created_at": "2023-10-05T14:56:36.087000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yea that makes sense",
        "created_at": "2023-10-05T14:58:16.853000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "but in any case, the cost is not borne by clients, but by users/deployers. so if somebody deploys some very deeply nested container, it is the deployers of the child containers that will have to pay",
        "created_at": "2023-10-05T14:58:57.928000+00:00",
        "attachments": null
    }
]