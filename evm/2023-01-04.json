[
    {
        "author": "bobsummerwill",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Awesome progress, everyone.\nKudos.",
        "created_at": "2023-01-04T01:37:35.815000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "... And still going, 114M testcases later\n```\nfuzz: elapsed: 8h33m24s, execs: 114312898 (3280/sec), new interesting: 7 (total: 779)\n```",
        "created_at": "2023-01-04T07:18:42.947000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Is this structured fuzzing? What is \"interesting\"?",
        "created_at": "2023-01-04T08:21:47.104000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This is golang \"native\" fuzzing. The fuzzer is here: https://github.com/holiman/txparse/blob/main/comparer/comparer_test.go#L67 -- it does a round of unmarshal/validate in golang, to create some inputs for the coverage guidance. Then it feeds the vectors (https://github.com/holiman/txparse/blob/main/comparer/comparer_test.go#L69) to the 'comparer', which muxes them into the binaries under test, and compares the outputs. The input is raw bytes, not structured though",
        "created_at": "2023-01-04T08:36:48.693000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So \"interesting\" I suppose is an input that adds new coverage",
        "created_at": "2023-01-04T08:37:20.897000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We will need structured fuzzing at some point because the most of the cases are invalid because of the wrong section size.",
        "created_at": "2023-01-04T08:39:03.080000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sure, making a structured variant of that one is pretty simple, technically. ,The thing that have kept me from doing it so far is that I wasn't sure what to fuzz versus what to not fuzz. Structured fuzzing requires more domain knowledge to know what is interesting and what is not. Perhaps you can guide me a bit there, or if you write one",
        "created_at": "2023-01-04T08:49:34.042000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@211091239112671234\u003e I have a corpus from evmone fuzzing. Will you be able to convert it into the single-file hex form? Or I should do it?",
        "created_at": "2023-01-04T08:50:48.968000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I can do it",
        "created_at": "2023-01-04T08:51:08.819000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Merged now, 5300 cases in total there",
        "created_at": "2023-01-04T09:16:30.990000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Not sure it is worth keeping all of them, just peak \"interesting\"?",
        "created_at": "2023-01-04T09:17:19.492000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Interesting.... \n```\nUsing 4 processes\n  0: /home/user/workspace/txparse/eofparse/eofparse\n  1: /home/user/workspace/besu/ethereum/evmtool/build/install/evmtool/bin/evm code-validate\n  2: /home/user/workspace/EOF-Header-Parser/bin/release/net6.0/linux-x64/EofParser\n  3: /usr/bin/docker run -i evmone /build/bin/evmone-eofparse\n...\n761 input 0xef0001010008020001000402000100050300000000040000045c000000405c0000002e0005\n761: proc 0: err: mismatch of code sections count and type signatures: types 2, code 1)\n761: proc 1: err: layout - Type section length incompatible with code section count - 0x1 * 4 != 0x8\n761: proc 2: err: EIP-3540 : Eof1, Code header is not well formatted\n761: proc 3: OK 5c000000,405c000000\n```\n(and a lot more of the same kind)",
        "created_at": "2023-01-04T09:20:04.377000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "well... ðŸ™‚",
        "created_at": "2023-01-04T09:20:47.395000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(that's pretty difficult, however, because I there's no way that I know of to instrument the golang fuzzing framework to \"suggest\" inputs and use it to determine if the input was interesting or not).",
        "created_at": "2023-01-04T09:24:07.517000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Looks like go-fuzz has libfuzzer support so we can combine C++ and Go guidance. Someday...",
        "created_at": "2023-01-04T09:26:51.508000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Myeah, but \"go-fuzz\" was kind of picked up by the golang team and used as a model for the \"native\" go fuzz as of go 1.18. My fuzzer is based on go fuzz, not go-fuzz. Not sure it has libfuzzer support (?)",
        "created_at": "2023-01-04T09:28:24.825000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We will fix the bug and provide smaller corpus",
        "created_at": "2023-01-04T09:43:25.589000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also don't forget the alnum filtering",
        "created_at": "2023-01-04T09:54:56.095000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "- skip empty lines\n- skip lines starting with #\n- filter alnum\n?",
        "created_at": "2023-01-04T09:57:26.061000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes",
        "created_at": "2023-01-04T10:00:14.856000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "pull evmone",
        "created_at": "2023-01-04T10:47:16.908000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm merging this EIP spec update (rename \"data stack\" to \"operand stack\") within an hour.",
        "created_at": "2023-01-04T11:05:50.484000+00:00",
        "attachments": null
    },
    {
        "author": "smartprogrammer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Do you guys consider `RJUMP` a terminating opcode if it is  the last opcode in a code section or in all cases?",
        "created_at": "2023-01-04T11:26:36.078000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Depending what you mean. I never consider it terminating, but it has special handling in the control-flow analysis.",
        "created_at": "2023-01-04T11:27:49.851000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@211091239112671234\u003e ping me when running.",
        "created_at": "2023-01-04T11:29:13.551000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, afk now, in an hour maybe",
        "created_at": "2023-01-04T11:47:28.867000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There are some new comments to the proposed EIP-3860: https://github.com/ethereum/EIPs/pull/6249. In particular, is anyone familiar with the \"generic contract factory\" pattern?",
        "created_at": "2023-01-04T12:12:26.595000+00:00",
        "attachments": null
    },
    {
        "author": "demiurgos_23",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@425274498732916736\u003e are code sections allowed to not have terminating opcodes ? if so what should be done in the case if a section other than the first one reaches the end without hitting a RETF or a STOP ..., should we just stop ? or throw an exception or fall back to the previous return stack frame ?",
        "created_at": "2023-01-04T12:41:14.068000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This will be detected and rejected by EOF validation, specifically in EIP-5450 part \"operand stack validation\", point 3.1.",
        "created_at": "2023-01-04T12:42:32.665000+00:00",
        "attachments": null
    },
    {
        "author": "demiurgos_23",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so is this valid or invalid ? \n```\nRJUMPV 03 [0000 00000 0000]\nRJUMP fffd\n```",
        "created_at": "2023-01-04T12:43:54.980000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "valid",
        "created_at": "2023-01-04T12:46:46.847000+00:00",
        "attachments": null
    },
    {
        "author": "demiurgos_23",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "even if this in section 1 ?",
        "created_at": "2023-01-04T12:47:36.615000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "execution of this code will never leave it.",
        "created_at": "2023-01-04T12:48:25.143000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ping",
        "created_at": "2023-01-04T13:23:21.871000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Now four out of five pass the 5K tests. ethereum-js is the only one which fails, but it's because it hangs (or doesn't yield output) on some cases",
        "created_at": "2023-01-04T13:24:25.785000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "```\nUsing 4 processes:\n  0: /home/user/workspace/txparse/eofparse/eofparse\n  1: /home/user/workspace/besu/ethereum/evmtool/build/install/evmtool/bin/evm code-validate\n  2: /home/user/workspace/EOF-Header-Parser/bin/release/net6.0/linux-x64/EofParser\n  3: /usr/bin/docker run -i evmone /build/bin/evmone-eofparse\n...\nfuzz: elapsed: 17m59s, minimizing\n--- FAIL: Fuzz (1089.22s)\n    --- FAIL: Fuzz (0.00s)\n        comparer_test.go:72: 477778 input 0xef00010100080200020005000503000000000000010001000161303050b162303030b2\n            477778: proc 0: err: use of undefined opcode opcode 0xb2 not defined\n            477778: proc 1: err: EOF Code Invalid : Invalid Instruction 0xb2\n            477778: proc 2: OK 61303050b1,62303030b2\n            477778: proc 3: err: undefined_instruction\n            \n```\nSo that is `nethermind` accepting `b2` \u003c@1011612262743679036\u003e",
        "created_at": "2023-01-04T13:53:10.385000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it's the removed `JUMPF`",
        "created_at": "2023-01-04T14:02:19.723000+00:00",
        "attachments": null
    },
    {
        "author": "demiurgos_23",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "oh yeah, fixed",
        "created_at": "2023-01-04T16:21:01.298000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Now, for the first time: all five agree on the `all.input` test vectors, and I am running the fuzzer on all five engines",
        "created_at": "2023-01-04T16:33:02.322000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Seems nobody likes `max_stack_height` (except some poeple). How about such middle ground:\n\n- we don't store `max_stack_height`,\n- a EOF function has stack limit 256, this will be validated (by checking `max_stack_height \u003c= 256`),\n- at runtime in `CALLF` we check if current stack height is less than, `1024 - 256`,\n- constants can be adjusted.",
        "created_at": "2023-01-04T18:17:50.825000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i.e. max stack height 768. for a callf.",
        "created_at": "2023-01-04T18:20:03.019000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What do people not like about max stack height?",
        "created_at": "2023-01-04T18:22:44.472000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The thing you need to compute it everywhere ðŸ™‚",
        "created_at": "2023-01-04T18:33:47.870000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Why is this a problem? You only do it once when verifying, and a compiler can take care of the rest (only problem would be if you want to deploy custom contracts from a contract, I guess?)",
        "created_at": "2023-01-04T18:36:16.267000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I don't see the benefit, really. Sure it can be calculated, but for practical purposes, there's zero speed gain to omit one tiny check during block processing, since block processing time is maybe 10% execution, 90% state access and other. \n\nHowever, I am not advocating it's removal. I understand it's useful from other perspectives.",
        "created_at": "2023-01-04T19:01:09.624000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "OK, I do agree that these stack checks will most likely not lead to massive speedups. Especially since IO is indeed the slowest",
        "created_at": "2023-01-04T20:47:38.588000+00:00",
        "attachments": null
    }
]