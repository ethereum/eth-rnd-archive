[
    {
        "author": "poojaranjan",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "**EOF Implementers Call #48**\nMeeting Info: May 29, 2024 , 15:00 UTC\nAgenda: https://github.com/ethereum/pm/issues/1051\nRecording Playlist: https://www.youtube.com/playlist?list=PLJqWcTqh_zKHu7Z91YVYWy_PSmOc_66-F\n\nZoom: https://us02web.zoom.us/j/88940506383?pwd=aTdsbHVyMTNDSUFHYmhTWlI2ZEVldz09",
        "created_at": "2024-05-29T13:22:14.250000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Hey all, this EOF test\n\n```json\n  \"tests/prague/eip7692_eof_v1/eip3540_eof_v1/test_example_valid_invalid.py::test_example_valid_invalid[fork_Prague-eof_test-undersize_data_ok]\": {\n    \"vectors\": {\n      \"0\": {\n        \"code\": \"0xef0001010004020001000304000400008000013050000bad\",\n        \"results\": {\n          \"Prague\": {\n            \"result\": true\n          }\n        }\n      }\n    },\n```\n\nHow should I interpret this test? It seems that this is an initcode container (?) For a deployed container, this is still invalid right, since the data size does not match the actual data size? There is no param in the test which indicates it is an initcode? ðŸ¤”",
        "created_at": "2024-05-29T21:28:55.785000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The outer 3 objects are just wrappers and folders.  \n- `\"code\"` is the hex of an EOF container to be validated.  \n- `\"results\"` has the results, only `\"Prague\"` matters right now.  If validaiton changes in future forks there will be multiple entiries.  \n- `\"result\": true` means the EOF is valid - the container parses properly and the stack and code validations pass.  \n- If `\"result\": false` is false that means something should fail.  The `\"exception\"` field at the same depth as the \"result\" indicates what the parse/validation failure should be.",
        "created_at": "2024-05-29T21:32:53.954000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There is no exdcution as part of this test",
        "created_at": "2024-05-29T21:33:19.438000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes sorry, I am actually talking about this specific test, I think the result is wrong",
        "created_at": "2024-05-29T21:33:29.043000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If this is a deployed container it should be invalid",
        "created_at": "2024-05-29T21:33:36.313000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The data section is 0x0bad and the data size is 0x0004",
        "created_at": "2024-05-29T21:33:44.506000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "*unless* it is an initcode, but I don't see any flag here which indicates it is initcode",
        "created_at": "2024-05-29T21:34:07.678000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This changed in mega-eof.  Containers can, in some instances, not have a full data section.",
        "created_at": "2024-05-29T21:34:08.545000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e data_size in the deployed container header is also updated to be equal len(data_section).",
        "created_at": "2024-05-29T21:34:38.799000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There are no flags so you have to assume it all at the root.  This probably should be re-written as a fully-realzied subcontainer deployment where only the final deployed container has the truncated data.  But it looks like the tests are doing this at the top level.",
        "created_at": "2024-05-29T21:35:20.524000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We discussed it on the call that there should be a flag for tests like this.",
        "created_at": "2024-05-29T21:36:06.202000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ok, so I should assume that this is initcode? Because if it is a deployed code it is invalid - right?",
        "created_at": "2024-05-29T21:36:30.133000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Or well, it can't be deployed ðŸ˜…",
        "created_at": "2024-05-29T21:37:03.502000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Upon thinking about this should I actually assume all these containers are initcodes and not runtime code? ðŸ¤”",
        "created_at": "2024-05-29T21:37:15.303000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it's not initcode either.  This code is actually invalid in both a create transaction and as part of a genesis file, so it is reasonable to say it should fail.",
        "created_at": "2024-05-29T21:37:16.728000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The flag would indicate it is initcode.",
        "created_at": "2024-05-29T21:37:28.710000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Why is it invalid in a create tx? ðŸ¤”",
        "created_at": "2024-05-29T21:37:32.914000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "otherwise we should assume they are runtime.",
        "created_at": "2024-05-29T21:37:35.607000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "create transaction containers must be data-exact.",
        "created_at": "2024-05-29T21:37:55.347000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ahh ok. And as a subcontainer (so a 0x03 type container inside a container) that would be valid, right?",
        "created_at": "2024-05-29T21:38:18.295000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, but only if targeted by a RETURNCONTRACT opcode.  If targeted by a EOFCREATE it is not valid.",
        "created_at": "2024-05-29T21:38:51.158000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That's why it would be better to test this in a full container not top level.",
        "created_at": "2024-05-29T21:39:03.025000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I see",
        "created_at": "2024-05-29T21:39:14.295000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What is the motivation to make the create tx data-exact? If I want to append some deploy-time data to it (for instance the TIMESTAMP where the contract got deployed?) then this is not possible?",
        "created_at": "2024-05-29T21:39:38.676000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Then the appended data would make the EOF container complete.  And excess data would spill over into inputdata",
        "created_at": "2024-05-29T21:40:36.451000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But that's only in the initcode.  I would expect solidity to take the timestamp as input data, or use the TIMESTAMP opcode, then append it to the subcontainer via RETURNDATA and the auxdata.",
        "created_at": "2024-05-29T21:42:22.532000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Hmm I have not yet started implementing the create txs yet so I think I might have misunderstood how it works, will have to re-read it ðŸ™‚",
        "created_at": "2024-05-29T21:45:15.222000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "EEST has EOFCREATE merged, so you can see some examples there.  Ipsilon has some fixtures: https://github.com/ipsilon/execution-spec-tests/releases/tag/eof-20240515",
        "created_at": "2024-05-29T21:47:29.210000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e note a container can be both \"initcode\" and \"runtime\" if it does not contain any of RETURN, STOP or RETURNCONTRACT (for instance, if it is only terminated with REVERT or INVALID).\n\nWhy is this allowed? This implies that running this container will always fail?",
        "created_at": "2024-05-29T22:20:31.826000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(of course this can be checked by any compiler beforehand, but still)",
        "created_at": "2024-05-29T22:21:20.176000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Strange corned case.  It's a container that only ever reverts.  No reason to dismiss it.  However, in deployed systems it will be identified as runtime or initcode beucase of it's use.",
        "created_at": "2024-05-29T22:21:22.467000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh right, it can revert!",
        "created_at": "2024-05-29T22:21:32.438000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Okay yes I forgot about that, good point",
        "created_at": "2024-05-29T22:21:38.314000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i.e. as a subcontainer it will always have a context.  As a top level container it comes in as a create transaction, and hence initcode, or in the genesis, and hence runtime.",
        "created_at": "2024-05-29T22:22:13.999000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes I see",
        "created_at": "2024-05-29T22:22:34.924000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I forgot that revert fills the returndata so yes I agree that this corner case should still be valid",
        "created_at": "2024-05-29T22:22:46.059000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I am reading about EOFCREATE (so not create tx) opcode again, is my following understanding correct?\n\n- If a container has EOFCREATE in it\n- Then it always has at least one subcontainer which is initcode\n- But, this subcontainer itself also has a subcontainer in it (sub-subcontainer ðŸ˜… ) which holds the runtime code to be deployed after initcode? (via RETURNCONTRACT?)",
        "created_at": "2024-05-29T22:24:19.305000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "correct.",
        "created_at": "2024-05-29T22:24:41.589000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Great, thanks",
        "created_at": "2024-05-29T22:24:54.312000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Does this limit the amount of \"how deep\" a contract can deploy (due to the codesize limit at deploy)? Because if I thus have contract A with init-subcontainer B, which holds runtime sub-subcontainer C, then if I want C to also deploy some contract, this means that inside C I need also a sub and sub-subcontainer (which should thus be deployed inside contract A?)",
        "created_at": "2024-05-29T22:26:42.201000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Or, can I do this via EXTDELEGATECALL (?)",
        "created_at": "2024-05-29T22:27:08.310000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes.  I think the max is hundreds of \"stop\" contracts in one call.  Gas is one limiter here.  Codesize is the other.",
        "created_at": "2024-05-29T22:28:01.255000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It's a test case we need to write.  evmone has it in their local tests.",
        "created_at": "2024-05-29T22:28:23.419000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I guess we can still go infinitely deep using EXTDELEGATECALL to then EOFCREATE (?)",
        "created_at": "2024-05-29T22:30:50.988000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "diamond pattern strikes again!",
        "created_at": "2024-05-29T22:31:04.381000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Or just self-call at the bottom!",
        "created_at": "2024-05-29T22:31:25.206000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e Code basic blocks must be ordered in a way that every block is reachable either by a forward jump or sequential flow of instructions. In other words, there is no basic block reachable only by a backward jump.\n\u003e This implies that no instruction may be unreachable, but is a stronger requirement.\n\nI am not sure why it is a stronger requirement that no instruction is unreachable? If all blocks can be reached by forward jumps of sequential flow, this is indeed implied? Why is it a strong requirement that no instruction is unreachable?",
        "created_at": "2024-05-29T22:56:59.480000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is stronger requirement in regards to no basic block is reachable only by a backward jump.",
        "created_at": "2024-05-29T23:12:03.658000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, without the forward flow requirement we would have to use a worklist to check for dead code.  Since there is no good reason for backwards only blocks it's not a burden on the compilers to topoligically sort their code runs.  In fact, I think they get that by accident when they do their own dead code trimming.",
        "created_at": "2024-05-29T23:33:24.510000+00:00",
        "attachments": null
    }
]