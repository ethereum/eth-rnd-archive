[
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Firstly, I've already discussed this with \u003c@211091239112671234\u003e and validating initcode in a create transaction is significantly easier than checking balance and nonce (as the later depends on constantly changing state underneath).\n\nThe main motivation is for Consistencyâ„¢ with how create works on deeper levels. The spec of EOF (not only) distinguishes \"light errors\" (not all gas consumed) and \"heavy errors\" (all gas consumed). My mental model is that light errors are checked on the callers side, heavy errors on the callee (new account) side. However, implementations are not forced to do it this way. Picture:\n\n- call depth n:\n    - CREATE:\n        - validate initcode (light error)\n        - check balance (light error)\n        - check nonce (ligth error)\n        - check call depth limit (light error)\n        - switch context to depth n+1\n- call depth n+1 (new account):\n    - execute initcode (heavy error)\n    - check code deployment cost (heavy error)\n\nIf you adapt this to the create transaction case the light errors should make the transaction invalid (should not be propagated, must not be included in any block). I picture it like this:\n\n- call depth -1 (tx.origin):\n    - create tx:\n        - validate initcode (tx invalid)\n        - check balance (tx invalid)\n        - check nonce (tx invalid)\n        - switch context to depth 0\n- call depth 0 (new account):\n    - execute initcode (heavy error)\n    - check code deployment cost (heavy error)",
        "created_at": "2022-11-23T09:59:17.978000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Clarification: for the happy path, it might be more intense to validate initcode than balance/nonce. But for the DoS-case, where someone wants to dos a node using invalid transactions, determining that an account does not exist is far more expensive than processing a bit of code.",
        "created_at": "2022-11-23T11:00:25.425000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Do you have preference? Including vs not including transactions with invalid initcode.",
        "created_at": "2022-11-23T11:10:34.770000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I guess for including the cost is proposed to be base cost (35k) + initcode length cost.",
        "created_at": "2022-11-23T11:11:38.278000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My pref is doing the check , so rejecting invalid initcode",
        "created_at": "2022-11-23T11:11:41.117000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm not worried about happy path",
        "created_at": "2022-11-23T11:12:11.024000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@543900561460822016\u003e \u003c@275684146658148352\u003e agree? ^^^",
        "created_at": "2022-11-23T17:12:56.770000+00:00",
        "attachments": null
    }
]