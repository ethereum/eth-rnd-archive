[
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@425279588009246720\u003e \u003c@275684146658148352\u003e \u003c@907931206081990666\u003e \u003c@403707149043105803\u003e \n\nI think the new `EXTCODEHASH` logic is not easy to implement efficiently. In the State MTP the code hash is directly in the account node. However, to implement EOF logic you need additionally to reach for the code and read its prefix. This is additional lookup and there probably is not DB API to read a part of the code. Similar issues are for `EXTCODESIZE` except the code size is likely not in the account node.",
        "created_at": "2024-01-09T10:41:15.098000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "EXTCODEHASH, EXTCODESIZE, and EXTCODECOPY are all priced the same, and all include the account warming penalty.  As long as they perform as well as EXTCODECOPY there is no gas arbitrage attack.  Beyond that it's an implementation issue that the gas cost sets a very loose performance requirement for.",
        "created_at": "2024-01-09T12:30:39.133000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i.e. there are two kinds of effecieint, efficient enough to not be a source of a broken meter attack, and as fast as possible efficient.",
        "created_at": "2024-01-09T12:31:31.932000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Still loading whole code from DB for `EXTCODEHASH` seems risky",
        "created_at": "2024-01-09T12:33:23.321000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Is it more risky than EXTCODECOPY?",
        "created_at": "2024-01-09T12:34:07.071000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "No",
        "created_at": "2024-01-09T12:34:27.059000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "When it shifts to Verkle we only need the first chunk anyway,.",
        "created_at": "2024-01-09T12:34:58.074000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And implementations can add a non-hashed \"isEOF\" flag to shortcut the CODEHASH, much like impls cache code size already.  Naive implementation is as efficient as the gas schedule requires, and prioritized implementations are faster.",
        "created_at": "2024-01-09T12:36:24.197000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What is the alternative, full transparency into EOF code?",
        "created_at": "2024-01-09T12:37:23.765000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I guess, but I'm satisfied with the answer",
        "created_at": "2024-01-09T12:44:41.871000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "EXCHANGE opcode `0xE8` conflicts with DATALOAD \u003c@408154589494247424\u003e",
        "created_at": "2024-01-09T15:27:22.019000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "actually entire E range is full, see https://github.com/ethereum/execution-specs/blob/master/lists/evm/pending-opcodes.md",
        "created_at": "2024-01-09T15:27:38.986000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Was the idea to replace SWAPN or to enhance it?",
        "created_at": "2024-01-09T15:28:46.305000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And perhaps we can reconsider it and move some stuff into D block?  E block is for \"Emmediates\" and if it doesn't require an immediate move it to D as _in theory_ it could be used in legacy evm.",
        "created_at": "2024-01-09T15:30:10.078000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think Solidity strongly wanted SWAPN so we decided to have both",
        "created_at": "2024-01-09T15:30:45.232000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That's fine.",
        "created_at": "2024-01-09T15:30:51.772000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "things that don't need immediates: RETF, DATALOAD, DATASIZE, DATACOPY, CREATE4",
        "created_at": "2024-01-09T15:32:38.488000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "hmm what should the opcode be?",
        "created_at": "2024-01-09T15:43:11.290000+00:00",
        "attachments": null
    }
]