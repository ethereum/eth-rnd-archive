[
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Looking at TXCREATE, it pops `tx_initcode_hash` from stack and `loads the initcode EOF container from the transaction initcodes array which hashes to tx_initcode_hash` there can be multiple initcodes, hashing all of them needs to be accounted somewhere.",
        "created_at": "2024-04-07T00:28:16.680000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Is EIP missing `initcontainer_index` that would index the initcode array. Poped from stack similar to `tx_initcode_hash`?",
        "created_at": "2024-04-07T00:29:15.263000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Generally speaking historical transactions are not used in validaiton, it would be a new lookup requirement and run against the intent of EIP-4444, where such TXes may \"fall off\"",
        "created_at": "2024-04-07T00:40:02.365000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The goal of using the hash is to allow smart contract wallets to instantiate new contracts.  If we require the TX to be at a speicific index we make bundling of multiple UserOperations more difficult.  Perhaps we need to increase  the price of initcode sections  since they get hashed twice?",
        "created_at": "2024-04-07T00:41:29.332000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "hash is okay, i get that, but we can add additional index that pops from stack. So you pop `initcode_index` and `initcode_hash`, get initcode from index, hash it and check it agains `initcode_hash`",
        "created_at": "2024-04-07T00:48:40.303000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So we hash only initcode that is intended to be used",
        "created_at": "2024-04-07T00:49:12.624000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There is no way to guess the initcode's hash without hashing it, either as TX verification if part of the payload or at query time.  I keep two lists, one that is initcode and one that is the hash.  When asked for a hash I consult the hash list first, and if empty I hash the initcode for that entry, that way I can memenoto it and only hash it once.",
        "created_at": "2024-04-07T00:51:36.221000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is priced badly, we can have max of 256 initcodes in TX, we are not calculating this into TXCREATE",
        "created_at": "2024-04-07T00:55:26.430000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i do think having index from stack is more cleaner way to fetch right initcode",
        "created_at": "2024-04-07T00:56:20.482000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If it is matched by hash this means all 256 initcodes needs to be hashed.",
        "created_at": "2024-04-07T00:57:29.700000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Or the first one you hit.  If we charge extra for each unit ode byte we limit the DOS surface.  I also think 256 is too many, could be brought down.",
        "created_at": "2024-04-07T01:11:45.865000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Consider a 24k contract costs 6 million gas to create we could probably limit it to 8 or 16.  Or even just 6 and match the blobs.",
        "created_at": "2024-04-07T01:12:40.348000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, just noticed that paying for initcode bytes is a lot higher and makes hashing unnoticable",
        "created_at": "2024-04-07T01:15:52.189000+00:00",
        "attachments": null
    }
]