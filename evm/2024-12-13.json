[
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "what does `!` mean here?",
        "created_at": "2024-12-13T15:08:31.115000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I have one for strings and bitstrings but for the push immediates I use the immediate in-place. I haven't decided on a syntax for the eof immediates yet",
        "created_at": "2024-12-13T15:09:47.269000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So instead of `PUSH2 0x01ff` it's just `0x1ff`",
        "created_at": "2024-12-13T15:10:26.102000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "For SWAPN it can just be `SWAP33`",
        "created_at": "2024-12-13T15:12:50.713000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the next arg is the literal contents of the immediate for he opcode.  So to get `0xe800`  you could us \"EXCHANGE 2, 3\" or \"EXCHANGE !0x00\". and `self: RJUMP $self` could be `RJUMP !0xfffd`",
        "created_at": "2024-12-13T15:13:31.335000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "For RJUMP I'm going to use labels",
        "created_at": "2024-12-13T15:14:42.490000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "exchange is tough",
        "created_at": "2024-12-13T15:15:06.565000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I like how EXHANGE is encoded with nibbles",
        "created_at": "2024-12-13T15:18:09.168000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The byte encoding was optimized for utility, not readability. I think a good assembler would wave hands over the conversion.",
        "created_at": "2024-12-13T15:18:32.554000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Assembler should care about readability",
        "created_at": "2024-12-13T15:18:56.102000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I wonder if exchange can read like `SWAP` but with two numbers instead of one. Like `SWAP[1,2]` for example",
        "created_at": "2024-12-13T15:20:09.986000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My lexer already reads `SWAP` differently",
        "created_at": "2024-12-13T15:20:44.612000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`SWAP2\u00263`",
        "created_at": "2024-12-13T15:21:38.758000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "would encode as `EXCHANGE !0x0100`",
        "created_at": "2024-12-13T15:23:54.088000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "exchange is single byte.",
        "created_at": "2024-12-13T15:24:21.147000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "0x10",
        "created_at": "2024-12-13T15:24:39.874000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "is your stack zero based?  For one based stacks one is also not a legal exchange target as we have swap.",
        "created_at": "2024-12-13T15:25:03.182000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So the smallest possible exchange is 2, 3 on a top=1 based stack",
        "created_at": "2024-12-13T15:25:54.201000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I didn't notice that. Makes sense.",
        "created_at": "2024-12-13T15:28:12.216000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Why does `DUPN` start at 1 tho?",
        "created_at": "2024-12-13T15:28:30.407000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That's the types of encoding rules an assembler should hide.",
        "created_at": "2024-12-13T15:28:32.521000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Shouldn't it start at 17?",
        "created_at": "2024-12-13T15:29:11.625000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "does eof disable regular swap, dup",
        "created_at": "2024-12-13T15:29:58.724000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And SWAPN.  I think the reasoning was what if we get rid of DUPX and SWAPX as a set of opcodes to reclaim space.  Right now we don't but in 5 years we may",
        "created_at": "2024-12-13T15:30:21.699000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "256 was considered \"deep enough\" as we were really targeting the \"stack too deep\" solidity error at 16.  I think we can reasonably say \"rewrite your spaghetti\" or \"not so much unrolling\" at 256",
        "created_at": "2024-12-13T15:31:51.083000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I like those opcodes because they reduce codesize for common stack operations",
        "created_at": "2024-12-13T15:31:59.473000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "They'll be more common than the 200th opcode eip'd into eof",
        "created_at": "2024-12-13T15:32:39.557000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Until we start running out of opcodes I don't expect any movement, as you said it's too useful.",
        "created_at": "2024-12-13T15:33:03.994000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "imo `SELFBALANCE` should have been `3031` instead of `47`",
        "created_at": "2024-12-13T15:33:30.103000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the only possibility I would see may be if we need to get into hardcore vector opcodes and multiple word sizes, and in those cases I think a multi-byte opcode would be how we would address it.  There was an eip  to reserve one of the blocks for multi-byte opcodes but it hasn't been ratified by EVM devs.",
        "created_at": "2024-12-13T15:35:01.144000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "SELFBALANCE was proposed under legacy rules, single byte was the only thing that would work ðŸ˜¦",
        "created_at": "2024-12-13T15:35:46.909000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The only necessary change would have been to reprice `BALANCE` when the operand is equal to`ADDRESS`",
        "created_at": "2024-12-13T15:38:03.852000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Summarized my plans here: https://github.com/wjmelements/evm/issues/71",
        "created_at": "2024-12-13T15:39:14.536000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah... those were two separate opcodes.  That would have worked too",
        "created_at": "2024-12-13T15:39:17.911000+00:00",
        "attachments": null
    },
    {
        "author": "frangio_",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "this notation is nice for authoring code but not great for disassembly if you care about representing the source bytecode faithfully, because it doesn't distinguish SWAP3 and SWAPN 3, so we still need standard notation for the latter and imo an assembler should support that non-sugared notation too",
        "created_at": "2024-12-13T15:54:24.783000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It's unfortunate that there are multiple ways to encode `DUP3`. There was a similar issue for `PUSH` where I disambiguated them via hex notation with leading zeroes. I think it can do similar here; when I disassemble `DUPN 3` I would disambiguate it from `DUP3` by rendering it as `DUPN3`.",
        "created_at": "2024-12-13T16:12:45.955000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "For example I currently do `0x0003` to encode `PUSH2`",
        "created_at": "2024-12-13T16:13:18.832000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://github.com/wjmelements/evm/issues/71#issuecomment-2541790849",
        "created_at": "2024-12-13T16:15:41.081000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This would leave two ways to represent `e621`: DUP33 and DUPN33",
        "created_at": "2024-12-13T16:21:14.563000+00:00",
        "attachments": null
    },
    {
        "author": "frangio_",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that sounds good but the example is wrong, should be `e620`, left a comment in the issue",
        "created_at": "2024-12-13T19:44:18.241000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Gosh 2-indexing is confusing",
        "created_at": "2024-12-13T20:42:21.373000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I appreciate your contribution to the discussion. I'm likely to support the `[,]` syntax for immediates in addition to other syntactic sugar, per our discussion. I want to ensure we agree about the meaning of the representation `EXCHANGE[2,3]` because otherwise there might be some chaos.",
        "created_at": "2024-12-13T20:44:34.785000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://github.com/ipsilon/eof/pull/174#issuecomment-2542389452",
        "created_at": "2024-12-13T21:12:23.543000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If `EXCHANGE` were encoded differently then `SWAPN` would be redundant too.",
        "created_at": "2024-12-13T21:42:44.724000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Eliminatiing SWAPN redundancy was a goal of the EXCHANGE encoding.",
        "created_at": "2024-12-13T21:45:02.178000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "EXCHANGE using nibbles while SWAPN uses bytes means EXCHANGE can do everything that SWAP can currently do. We'd need another opcode to swap things deep in the stack but probably won't need to do that because stack ordering isn't important until you're consuming them and you can only consume off the top anyway. Good to remember tho in case there's an opcode consuming more than 16 items.",
        "created_at": "2024-12-13T21:46:44.956000+00:00",
        "attachments": null
    },
    {
        "author": "frangio_",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e EXCHANGE can do everything that SWAP can currently do\n\nno, they don't have any overlap because EXCHANGE doesn't operate on the top of the stack",
        "created_at": "2024-12-13T22:05:03.697000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I meant thata series of swaps can implement exchange (except when exchange can reach past 17). Whereas exchange canâ€™t reach as far as swapn.",
        "created_at": "2024-12-13T22:33:05.090000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Charles was the biggest advocate for EXCHANGE, theres something about vyper I don't fully understand that makes him really excited about it.",
        "created_at": "2024-12-13T22:34:02.152000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Probably theyâ€™re bad at stack allocation. I rarely ever use swap.",
        "created_at": "2024-12-13T22:34:41.670000+00:00",
        "attachments": null
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Solidityâ€™s stack allocation is the worst tho. They basically dup everything they need, pop everything they donâ€™t, and hope the optimizer saves them.",
        "created_at": "2024-12-13T22:35:34.436000+00:00",
        "attachments": null
    }
]