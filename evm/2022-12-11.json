[
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Do we really want to reject this? If we keep `JUMP` in EOF, then it would make sense that `PC` is also still available.",
        "created_at": "2022-12-11T14:45:23.141000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also regarding the terminating opcodes; if `RJUMP` is at the end of the code container and this jump is valid, then this should also be a valid terminating opcode I'd say?",
        "created_at": "2022-12-11T14:46:16.241000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I am also not sure what happens in `RJUMPV` if `case \u003e 255`. The EIP is not clear about it. Do we do the default branch (so just move to the pc post instruction), or do we throw and consume all gas?",
        "created_at": "2022-12-11T14:47:20.274000+00:00",
        "attachments": null
    },
    {
        "author": "yperbasis",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "EIP-4750 removes `JUMP` \u0026 `JUMPI` from EOF. Anyhow, I don't mind keeping PC valid in EOF, I just find \"Note: EIP-3670 should reject PC\" confusing and advocate its removal from EIP-4200.",
        "created_at": "2022-12-11T14:56:54.470000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, I agree, either you must remove it or not, but not \"should\" remove it",
        "created_at": "2022-12-11T15:00:19.366000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If JUMP and JUMPI get removed I guess that there is no real need for PC anymore, but maybe there are some smart tricks you could use, so I would say do not remove it (an use case I can think of is that if you are at a PUSH opcode, which PUSHs exactly the current `PC` on stack, you can golf the code by replacing the PUSH by PC (this saves code deposit gas) and `PC` is 2 gas, where `PUSH` is 3 gas). So I would say to not remove it",
        "created_at": "2022-12-11T15:02:38.514000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "To deprecate `CALLCODE` (not sure if this is in any of the EOF EIPs) I would agree to it",
        "created_at": "2022-12-11T15:03:20.158000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It was just loosely suggested to drop `PC` to limit the observability of the code position. But this is not a planned change any more. The `PC` stays as a fancy constant push.",
        "created_at": "2022-12-11T15:52:43.702000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This is exactly the case with EIP-5450. And the reason we are removing the \"terminating instruction\" case from EIP-3670.",
        "created_at": "2022-12-11T15:53:45.744000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If your runtime index is out of the number of cases the control flow falls though to the next instruction. This is specified by `PC_post_instruction + ((case \u003e= (count + 1)) ? 0 : relative_offset[case])`.",
        "created_at": "2022-12-11T15:56:34.096000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Although, I'd say `case \u003e count` ðŸ˜‰",
        "created_at": "2022-12-11T15:57:19.274000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Should the \"but it also allows the deprecation of the `PC` instruction.\" stay?",
        "created_at": "2022-12-11T16:00:27.996000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think it should be removed, there might be fancy use cases we are not aware of and I think it should be motivated why it allows for deprecation of PC.",
        "created_at": "2022-12-11T16:01:44.134000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm not sure here because if I have `case` 257 then the code would evaluate to `relative_offset[256]` (zero-indexed table) which is not defined..?",
        "created_at": "2022-12-11T16:02:56.414000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And your equation is not in the EIP currently, it is `PC_post_instruction + ((case \u003e= count) ? 0 : relative_offset[case])` currently",
        "created_at": "2022-12-11T16:03:24.268000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So `256` is a case which should be defined right? Then this would get `relative_offset[255]` (if we use zero-indexed lists)?",
        "created_at": "2022-12-11T16:04:32.733000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://github.com/ethereum/EIPs/pull/6111",
        "created_at": "2022-12-11T16:06:50.147000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah wait I'm reading this one wrong, you are right, this one is correct, now it makes sense ðŸ™‚",
        "created_at": "2022-12-11T16:07:02.212000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But this should be `PC_post_instruction + ((case \u003e= (count + 1)) ? 0 : relative_offset[case - 1]).` right? The reference code seems to be python, and since it is zero indexed then I would argue that the case should thus also be `case - 1`?",
        "created_at": "2022-12-11T16:08:17.199000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "PUSH should cost 2 ðŸ˜‰",
        "created_at": "2022-12-11T16:08:26.624000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`CALLCODE` is deprecated in EIP-3670: https://eips.ethereum.org/EIPS/eip-3670#specification",
        "created_at": "2022-12-11T16:11:06.797000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah cool ðŸ™‚ We should update our implementation of 3670 then because we do not yet have it",
        "created_at": "2022-12-11T16:12:04.160000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sorry, I was looking at the previous version of the EIP. So to clarify `count` is the length of the `relative_offset` array. The array is 0-indexed. And the `case` is the index. So the `case \u003e= count` is the out-of-bounds condition and then control flow just goes to the next instruction: `PC_post_instruction + 0`.",
        "created_at": "2022-12-11T16:16:42.691000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah right sorry, you are again right, I keep reading this `a : b ? c` syntax the wrong way ðŸ™‚",
        "created_at": "2022-12-11T16:18:52.487000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Now I also see the point made about the `ISZERO JUMPI` stuff ðŸ™‚",
        "created_at": "2022-12-11T16:19:19.992000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://github.com/ethereumjs/ethereumjs-monorepo/pull/2446 I'm implementing it here ðŸ™‚",
        "created_at": "2022-12-11T19:14:12.694000+00:00",
        "attachments": null
    }
]