[
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the idea is that the old-style contract would interpret `msg.sender` as being the compressed address",
        "created_at": "2021-03-06T00:00:46.959000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So the old-style contract would save the balance at the storage slot corresponding to the compressed address",
        "created_at": "2021-03-06T00:01:02.221000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And allow transfers out when the msg.sender equals the compressed address",
        "created_at": "2021-03-06T00:01:18.032000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, msg.sender is the compressed one. But due to ABI encoding, any target address submitted by the user would be truncated to 160-bits. So either they can only token transfer to old-style addresses, or new-style addresses which already exists in the translation table.",
        "created_at": "2021-03-06T00:02:11.070000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So basically, addresses coming in to old-style addresses are compressed, and then calls coming out of old-style addresses are decompressed",
        "created_at": "2021-03-06T00:02:12.678000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, that's true",
        "created_at": "2021-03-06T00:02:25.935000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And unavoidable",
        "created_at": "2021-03-06T00:02:28.241000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You'd need a wrapper contract to properly support new addresses",
        "created_at": "2021-03-06T00:02:39.344000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So a simple solution maybe having that \"add me to the translation table\" feature ðŸ™‚",
        "created_at": "2021-03-06T00:02:53.416000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "hmm technically you could just make a contract that just immediately does a call to the msg.sender",
        "created_at": "2021-03-06T00:03:44.071000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So such a feature exists automatically",
        "created_at": "2021-03-06T00:03:49.009000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, that's what I mentioned above. Just having a single such contract may be better then people making up new ones for it.",
        "created_at": "2021-03-06T00:04:11.546000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "sure, we can make a recommended contract, or even hard-fork one into some address",
        "created_at": "2021-03-06T00:04:28.981000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "actually, something like extbalance would be a simpler one to poke the table, wouldn't it be?",
        "created_at": "2021-03-06T00:05:18.771000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yep",
        "created_at": "2021-03-06T00:05:31.862000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So a wrapper could be just doing an extbalance and then invoking the token contract.",
        "created_at": "2021-03-06T00:05:42.856000+00:00",
        "attachments": null
    },
    {
        "author": "underbasic",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "sorry I am just a lurker, but could you solve the \"old style addresses coming out\" to have a \"magic padding\" for old style addresses that the system understands means ignore the \"new bits\" because this address is smaller?",
        "created_at": "2021-03-06T00:06:19.496000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "right but in the long term, moving to more than 80 bits of security is better",
        "created_at": "2021-03-06T00:06:23.001000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that's kinda what my proposal does, in that a new-style address must be \u003e= 2**160",
        "created_at": "2021-03-06T00:06:51.083000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So it can't be in the same space as old-style addresses",
        "created_at": "2021-03-06T00:06:59.126000+00:00",
        "attachments": null
    },
    {
        "author": "underbasic",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so if an old address is 4 bytes and a new one is 8 bytes your proposal says say if you see FF FF XX XX then ignore the FF FF and use the last 4 bytes only? But any other initial value for the first 4 bytes is fair game?",
        "created_at": "2021-03-06T00:08:24.367000+00:00",
        "attachments": null
    },
    {
        "author": "underbasic",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "again sorry just getting up to speed",
        "created_at": "2021-03-06T00:08:33.895000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If you have a contract that accepts 32-byte addresses and you see an address that starts with enough zeroes, then you know it's old style",
        "created_at": "2021-03-06T00:09:11.339000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You can't really make compressed addresses \"special\", because the entire 2**160 space is already taken up",
        "created_at": "2021-03-06T00:09:35.815000+00:00",
        "attachments": null
    },
    {
        "author": "underbasic",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "okay cool, (FF or 00 doesn't really matter to me) you are expanding the address size though right?",
        "created_at": "2021-03-06T00:10:04.838000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "People are lazy, if it is possible to use wrappers, they will. It should be disincentivized by making accessing the translation table expensive.",
        "created_at": "2021-03-06T00:10:15.385000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yeah the whole point here is to expand the address size from 20 to 32 bytes",
        "created_at": "2021-03-06T00:10:19.262000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And it will be",
        "created_at": "2021-03-06T00:10:23.705000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It would require a whole witness read",
        "created_at": "2021-03-06T00:10:27.524000+00:00",
        "attachments": null
    },
    {
        "author": "underbasic",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so why stop at 32bytes?",
        "created_at": "2021-03-06T00:10:33.206000+00:00",
        "attachments": null
    },
    {
        "author": "underbasic",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "why not add some bytes that you can stuff with a \"version\"",
        "created_at": "2021-03-06T00:10:49.161000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "32 bytes is the size of a \"chunk\"; it becomes logistically much harder to expand beyond 32 bytes",
        "created_at": "2021-03-06T00:10:56.559000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And also once you get above 100 bits of security (which you get at 25 bytes) there's little value in going further",
        "created_at": "2021-03-06T00:11:10.753000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, in the state expiry model. Though here you wanted to black box it, so theoretically speaking adding this on current mainnet, one would just need to make old-style poking have an extra charge ðŸ™‚",
        "created_at": "2021-03-06T00:11:11.123000+00:00",
        "attachments": null
    },
    {
        "author": "underbasic",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I mean you only need 1 byte, but to make it 16 byte or 32 byte aligned take more if that makes sense",
        "created_at": "2021-03-06T00:11:12.876000+00:00",
        "attachments": null
    },
    {
        "author": "underbasic",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "most protocols \"save\" a byte at the front, say for version then you can make these switches or some other switch easier in the future",
        "created_at": "2021-03-06T00:11:57.915000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "right, that's what my proposal does",
        "created_at": "2021-03-06T00:12:06.553000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "^^",
        "created_at": "2021-03-06T00:12:12.546000+00:00",
        "attachments": null
    },
    {
        "author": "underbasic",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "fair enough",
        "created_at": "2021-03-06T00:12:32.062000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Only supporting two byte immediate jumps makes bytecode manipulation easier.  That way you don't have to switch between short jump and long jump when you change the code size.",
        "created_at": "2021-03-06T02:27:58.174000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Right. Making the jump locations themselves dependent on bytecode makes the algorithm to actually calculate the jumpdests sequential in an annoying way",
        "created_at": "2021-03-06T02:28:45.512000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "As earlier jumpdest values would affect later ones, so you can have cascades",
        "created_at": "2021-03-06T02:29:03.339000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Still doable in linear time, but very annoying",
        "created_at": "2021-03-06T02:29:12.851000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also, relative jumps are easier than absolute jumps. Though, having a jump table may be easier than either.",
        "created_at": "2021-03-06T02:34:13.060000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Related: https://eips.ethereum.org/EIPS/eip-2677 -- I think we should try to get this in if any more advanced form of jumpdest analysis is on the table in the future.",
        "created_at": "2021-03-06T20:02:08.307000+00:00",
        "attachments": null
    }
]