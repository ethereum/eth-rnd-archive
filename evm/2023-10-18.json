[
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i have a conflict during the EOF call today, if some else could take the lead i would appreciate üôè",
        "created_at": "2023-10-18T13:49:48.932000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "no, you would end up with completely new behavior for existing contracts (unless you had a rule which was like, contracts deployed after X timestamp use a different EVM than contracts deployed before)",
        "created_at": "2023-10-18T15:06:13.351000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "dirty upper bits are disallowed by the spec. a compliant ABI decoder needs to validate (raise an exception of some kind if the upper bits are dirty)",
        "created_at": "2023-10-18T15:07:33.359000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm also on the L2 call.  Will call in when it is over",
        "created_at": "2023-10-18T15:08:39.492000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@403707149043105803\u003e are you running the EOF call today then? could you ping here when you are ready",
        "created_at": "2023-10-18T15:09:19.576000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Wasn't planning on it.  But I will ping here when I'm on the zoom.",
        "created_at": "2023-10-18T15:09:53.619000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "nobody is really in the call rn. will check back in 20",
        "created_at": "2023-10-18T15:10:49.480000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm on now",
        "created_at": "2023-10-18T15:11:30.577000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Maybe we can make it a short update call.",
        "created_at": "2023-10-18T15:11:57.247000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "we also did just have a meeting last week...",
        "created_at": "2023-10-18T15:12:32.074000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm not keen having it,  but people are online so maybe lets just crunch it out.",
        "created_at": "2023-10-18T15:13:05.912000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In order to keep the cadence alternating to ACD.",
        "created_at": "2023-10-18T15:13:22.727000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The issue is that the L2 call will run into it about half the time.  It's 3rd wednesdays.  It will collide in istanbul, then february, march and april, then Aug, Sep, and October",
        "created_at": "2023-10-18T15:15:10.919000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That's our hint at what timeline we need to ship EOF to not have conflicting calls üòÖ",
        "created_at": "2023-10-18T15:16:32.152000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e no, you would end up with completely new behavior for existing contracts\nWell, this is what I'm trying to understand.  I'm just looking for some easy and clear evidence many existing contracts would actually be broken.  I'm assuming this evidence exists, I'm just not sure exactly what it is.  Hence, asking here.  For example, if `solc` puts databytes at arbitrary positions within contracts (e.g. for constants or something) then that's pretty clear.  Likewise, if it constructs jump destinations out-of-thin-air then would also be pretty clear (function pointers are close to this).  Otherwise, if it turned out (by some crazy coincidence) that in all on-chain contracts only had data bytes at the end of the contract ... well that would be a different, and less clear situation.",
        "created_at": "2023-10-18T20:39:59.748000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Here's another twist: if we say \"Immediates activate in cancun\" some troll will post a contract that is broken by the immediate just to cause problems.  That happened with the EIP-3541, someone deployed some contracts that were EF-emoji for the lulz.",
        "created_at": "2023-10-18T20:41:54.876000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We also cannot just turn on code validation because that breaks data segments in solodity (specifically metatata) without enshrining their pattern.",
        "created_at": "2023-10-18T20:42:26.501000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e some troll will post a contract that is broken by the immediate just to cause problems\nHmmm, that is indeed an interesting twist!!!",
        "created_at": "2023-10-18T20:42:27.071000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But, still if we already have on chain evidence ... then no need to worry about that!!",
        "created_at": "2023-10-18T20:43:00.019000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Anyway, maybe I can look into this and scan a bunch of existing contracts.  I just thought the answer would be easy.",
        "created_at": "2023-10-18T20:43:21.503000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There was on-chain evidence for the shanghai attacks. Still a giant PITA",
        "created_at": "2023-10-18T20:43:25.347000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ok, can I find that somewhere?",
        "created_at": "2023-10-18T20:43:50.482000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Just the contracts and transacitons themselves.  For the time a precompile bug split the network the ether cam from tornadocash.  A real troll doesn't care about gensler",
        "created_at": "2023-10-18T20:57:32.998000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it's uncommon to put databytes in the middle of a contract. the reason is that data could have a `PUSH` instruction which 'eats into' succeeding code",
        "created_at": "2023-10-18T21:42:44.698000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "True, you'd need to pad or something when that happened. So like escaping",
        "created_at": "2023-10-18T21:43:24.976000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "like, if you want something like `code | \u003c32 bytes of data\u003e | code2`, that is not really going to work if some byte in the data is like `0x7f`, because then that breaks `code2` bc of push immediate rules",
        "created_at": "2023-10-18T21:44:14.628000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yes, and nobody really does this, they just put the data at the end of the contract where it can't brick any code",
        "created_at": "2023-10-18T21:44:34.949000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Right, but you could have an encoding whereby you check for this and then pad if you needed to at the end",
        "created_at": "2023-10-18T21:44:47.669000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e and nobody really does this\nOk, and this is what I was wondering.  It does feel like there's no good reason to do it, but I just wasn't sure",
        "created_at": "2023-10-18T21:45:22.460000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yea, here is where in vyper, the assembler moves all data things to the end of the bytecode: https://github.com/vyperlang/vyper/blob/5482bbcbed22b856bec6e57c06aeb7e0bee9a1ab/vyper/ir/compile_ir.py#L1075-L1078",
        "created_at": "2023-10-18T21:45:39.855000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ok, great --- that is answering my question.",
        "created_at": "2023-10-18T21:46:05.699000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(and idk what other compilers do, guessing something similar)",
        "created_at": "2023-10-18T21:46:20.326000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "but as danno points out, it's not impossible, like ofc you can have bytecode with data in the middle of it. just that most people/compilers don't do it",
        "created_at": "2023-10-18T21:46:40.598000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Right, so the question: how many contracts actually have data in the middle?  Like none, or like \u003c 1%, or ?",
        "created_at": "2023-10-18T21:47:18.153000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm not expecting an answer to that.  Its just what I'm wondering.",
        "created_at": "2023-10-18T21:47:40.026000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i mean, a similar issue happens whenever we introduce a new opcode",
        "created_at": "2023-10-18T21:50:17.333000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "like, `PUSH0` was previously an invalid opcode, and now it is a valid opcode",
        "created_at": "2023-10-18T21:50:33.335000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Not so much though if it doesn't have immediate operands üôÇ",
        "created_at": "2023-10-18T21:50:44.727000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "we just kind of assume, everybody is using `0xFE` for invalid. but they might not, they might have been using `0x5F`",
        "created_at": "2023-10-18T21:51:13.570000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But, yeah, presumably someone could have been using an `0x5e` byte to cause an exception (i.e. instead of `INVALID` instruction)",
        "created_at": "2023-10-18T21:51:43.841000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And, you can actually scan for it (in theory at least)",
        "created_at": "2023-10-18T21:52:29.799000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so every time we add an opcode, or even change gas semantics, we technically risk breaking contracts",
        "created_at": "2023-10-18T21:52:37.819000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But breaking jumpdests is a new category of breakage.",
        "created_at": "2023-10-18T21:53:04.583000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, fair enough I understand",
        "created_at": "2023-10-18T21:53:05.824000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "actually do the code validation rules of EOF prevent you from deploying contracts with invalid (unallocated) instructions? that might be pretty useful",
        "created_at": "2023-10-18T21:53:10.892000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, I believe so.  No deadcode is allowed.  I don't know how it is being checked though.",
        "created_at": "2023-10-18T21:53:38.255000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Needs a DFS through the control-flow graph",
        "created_at": "2023-10-18T21:53:56.699000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yea, it's first bullet point under https://notes.ethereum.org/@ipsilon/mega-eof-specification#Code-Validation -- no unassigned instructions used",
        "created_at": "2023-10-18T21:54:20.413000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "How to check that though?  Definitely much easier with proper subroutines and static branching.",
        "created_at": "2023-10-18T21:54:55.164000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Code validation includes no dead code, no invalid code, no pointers to bogus things (jumps must land, callfs must land, create3s must reference a subcontainer).",
        "created_at": "2023-10-18T21:55:29.511000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "also all opcodes with immediates must have those opcodes.  So we are safer adding new unallocated opcodes.",
        "created_at": "2023-10-18T21:57:06.700000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, that makes sense.  So how do you plan to check for dead code?  Do you want a linear scan algorithm?  Or happy with something a bit more heavyweight?",
        "created_at": "2023-10-18T21:58:35.196000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We use a work list right now.  If the code has been validated we don't add it to the list.  nets to linear time.  We are considering a \"no backwards-only code sections\".  i.e. there must be one forwards jump into the code.  That way if we get to a terminal instruction we expect the next opcode to have stack height info or it's dead code.",
        "created_at": "2023-10-18T22:00:03.692000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Linear time is needed for JIT compilations.",
        "created_at": "2023-10-18T22:01:12.928000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sounds like something similar to a depth-first search.  To be honest, I don't think you can do it in a single linear scan.",
        "created_at": "2023-10-18T22:01:24.717000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I was skeptical too, but it does it linear.",
        "created_at": "2023-10-18T22:01:40.025000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, but we did announce in 2016 that the guaranteed way is the `INVALID` instruction, see the EIP.",
        "created_at": "2023-10-18T22:01:46.825000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Hmmmm, if every block has at least one forward jump into it .... ok, yeah, maybe that would work.  Yeah I don't know what algorithm the JVM does.  Maybe it uses a linear scan algorithm and then, if that fails, drops back to something more expensive.",
        "created_at": "2023-10-18T22:02:59.299000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Not really very important, tbh.  Am just interested",
        "created_at": "2023-10-18T22:03:55.855000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "They have a two step process.  The runtime part is linear, not sure if the compile time step is linear or worse.",
        "created_at": "2023-10-18T22:04:39.083000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But, hmmmm ... does the JVM even check for unreachable instructions?  Now I think about it, I'm not so sure.  Yes, at compile time, `javac` does an unreachability check.  But, runtime is more like what a client would be doing.",
        "created_at": "2023-10-18T22:05:37.379000+00:00",
        "attachments": null
    },
    {
        "author": "whileydave",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Certainly, the JVM wouldn't allow arbitrary data bytes, or instructions with malformed/missing immediate operands.  That's easy to check for in a linear scan.  That should really be enough no?",
        "created_at": "2023-10-18T22:09:02.414000+00:00",
        "attachments": null
    }
]