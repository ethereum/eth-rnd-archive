[
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that's not much difference with current spec, only using CALLF opcode instead of JUMPF (with all the complications of validaiton), and in current spec JUMPF to returning is also allowed",
        "created_at": "2024-01-17T11:06:13.484000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Hey i still dont understand the benefit of JUMPF. For non-returning function wouldn't that be just ordinary CALLF with zero output,  what are we optimizing with JUMPF and how would alternative without JUMPF look like?",
        "created_at": "2024-01-17T11:08:05.572000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "According to Solidity JUMPF would potentially enable some extra compiler optimizations\n\nWithout it:\n- JUMPF to non-returning will be expressed as CALLF to 0 outputs + STOP - difference is one extra code byte + item pushed to call stack at run-time, same gas\n- JUMPF to returning will be expressed as CALLF RETF - this costs 4 more gas (for RETF), one extra code byte, item pushed to call stack",
        "created_at": "2024-01-17T11:19:19.101000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm not very convinced now it's worth it",
        "created_at": "2024-01-17T11:20:17.808000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My same thought. Who to ping from solidity?",
        "created_at": "2024-01-17T11:21:37.669000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "there's also argument that non-returning flag might be useful for something else, like external static analysis maybe",
        "created_at": "2024-01-17T11:21:38.444000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "At least how i see it (maybe dont have full picture) but overhead of having this doesn't weight on the benefits.",
        "created_at": "2024-01-17T11:22:49.415000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "wdym by external static analysis? Only analysis that EOF does is in bytecode creation right?",
        "created_at": "2024-01-17T11:23:40.642000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I mean external tooling, like maybe when somebody wants to build control-flow graph",
        "created_at": "2024-01-17T11:24:43.448000+00:00",
        "attachments": null
    },
    {
        "author": "gumb00",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I pinged Daniel of Solidity on matrix (he doesn't use discord), he promised to chime in on github issue",
        "created_at": "2024-01-17T11:37:45.172000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I have a question for both PyEVM or Geth EVM:\n\nWhat is the default coinbase of EVM (in purposes of warm coinbase https://eips.ethereum.org/EIPS/eip-3651 )?",
        "created_at": "2024-01-17T12:39:36.260000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i think we can actually avoid the extra code byte with a marker in the code type",
        "created_at": "2024-01-17T15:55:16.539000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "wrt enabling tail calls -- i agree, this is a bit weird for a VM support directly",
        "created_at": "2024-01-17T15:56:05.836000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "normally compilers implement tail call optimization by transforming recursion into a loop",
        "created_at": "2024-01-17T15:56:16.252000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the question here is would you ever use a code section for both CALLF *and* JUMPF style calls. i haven't thought through it too much but my intuition is the answer is \"not really\"",
        "created_at": "2024-01-17T15:57:16.701000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There may be no good reason, but if it would cause problems to do both someone will try it.",
        "created_at": "2024-01-17T15:58:02.395000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "if the answer is \"no\", then it should just be part of the code section type, and that way the behavior is determined by the code section type instead of at the call site.",
        "created_at": "2024-01-17T15:59:10.195000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i think the time when you would do this would be like recursion to self. so you call `foo()` (from `bar()`) and then `foo()` calls itself. but i actually think JUMPF is more useful for termination/stack unwinding operations than for tail recursion",
        "created_at": "2024-01-17T16:25:34.474000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "and for the termination/stack unwinding, i think if a code section is marked as a terminating code section (using some kind of sentinel in the type), then we can avoid the need for adding the extra `STOP`/`INVALID`/`RETF` after `CALLF` -- and the rule is, if you call a terminating code section which ends in a `RETF`, the stack continues to unwind",
        "created_at": "2024-01-17T16:27:43.836000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That is maybe why `POPN 0xffff` that is clear stack can be useful",
        "created_at": "2024-01-17T17:14:46.014000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I would want popn wher n is greater than the stack to fault.",
        "created_at": "2024-01-17T17:15:26.120000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i actually don't get why we would need POPN",
        "created_at": "2024-01-17T17:15:35.957000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "you mean having section/container that when returned would return from cotnract call?",
        "created_at": "2024-01-17T17:15:52.309000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "For 3 pops it's a wash.  For 1 or 2 it's better to chain.  How often will compilers leave large dirty stacks?",
        "created_at": "2024-01-17T17:16:22.420000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "more like, if a code section is marked non returning and it ends with `RETF`, the `CALLF` behaves as if it is itself followed by a `RETF`",
        "created_at": "2024-01-17T17:17:25.442000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i don't think they will? like why are compilers leaving dirty stacks lol",
        "created_at": "2024-01-17T17:18:15.698000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Maybe i am just wrong here for POPN and its usefulness, but wanted to check idea",
        "created_at": "2024-01-17T17:18:31.900000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the issue with POPN is it's a bit weird, like gas needs to be higher for larger N",
        "created_at": "2024-01-17T17:19:11.804000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "why would be, at least in revm it is just setting size of array, it is same action if it is POP1 or POP256.",
        "created_at": "2024-01-17T17:20:08.510000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "wdym by behaves as it is itself? It takes result from child call and passes it through to its parent call?",
        "created_at": "2024-01-17T17:22:43.669000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It's better with vlq üòâ",
        "created_at": "2024-01-17T17:27:38.333000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, bubbles up",
        "created_at": "2024-01-17T17:27:49.858000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Idk if the bubble up behavior is that useful really",
        "created_at": "2024-01-17T17:28:30.435000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I would skip the bubble up and just abruptly return from call",
        "created_at": "2024-01-17T17:31:08.162000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I was just trying to emulate the behavior of jumpf üòÅ",
        "created_at": "2024-01-17T17:31:28.377000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The entire contract call?",
        "created_at": "2024-01-17T17:36:01.824000+00:00",
        "attachments": null
    },
    {
        "author": "big_tech_sux",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Like CALL or CALLF",
        "created_at": "2024-01-17T17:36:16.441000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "entire contract call, like CALL",
        "created_at": "2024-01-17T17:37:30.282000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I started to have different feeling about `POPN`.  Isn't this an indicator something is wrong with codegen? Why are you discarding many items you produced in the first place.",
        "created_at": "2024-01-17T17:50:49.146000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This would make it just ordinary RETURN, nothing new",
        "created_at": "2024-01-17T18:45:22.254000+00:00",
        "attachments": null
    }
]