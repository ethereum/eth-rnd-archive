[
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Valid. \"Required stack height\" means the stack is at least this height. This is a term we use for every instruction, just for `CALLF` the value is not always the same.",
        "created_at": "2022-12-27T08:22:36.950000+00:00",
        "attachments": null
    },
    {
        "author": "demiurgos_23",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so I guess the wording of the rule `1.1.CALLF` should reflect that, instead of saying at `CALLF` sight the ``..required stack height is the number of the inputs of the called function..``, I think it should say ``..the required stack height is at least the number of inputs of the called function..`` (this is in the context of the Revision2 PR)",
        "created_at": "2022-12-27T08:36:32.253000+00:00",
        "attachments": null
    },
    {
        "author": "demiurgos_23",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "another question : when can we expect to have a working set of EthereumTests with then new 3540+3670 changes ?",
        "created_at": "2022-12-27T11:42:41.472000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I second this request, for whole big EOF üòÑüëç",
        "created_at": "2022-12-27T12:48:01.030000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We should implement test filler in JS soon because we have 4200 covered there I think",
        "created_at": "2022-12-27T12:48:35.793000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Can someone give me a high level overview of a program/algorithm which is not possible to implement without dynamic jumps?",
        "created_at": "2022-12-27T13:02:42.880000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Within the constraints of the EVM?  Difficult.  The ones I am thinking of that are not simply more concise with dynamic jumps involve code generation within the same message frame as the caller.  RJUMPV makes a more concise jump table.",
        "created_at": "2022-12-27T17:01:50.172000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah I would love to know which kind of code would compile to this. Isn't this dynamic jumps somewhat the same discussion as what we had in history, where currently the code which we process does not change, but in the past, programs could actually alter the codes it ran (this was like very long ago, the 70s or so? Not super experienced with it)",
        "created_at": "2022-12-27T18:54:10.732000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Anyways, in https://github.com/ethereum/EIPs/blob/4e5cd9fe6dd168165a7a5cfef68ead439ef27f17/EIPS/eip-3540.md#eof-version-1\n\nAm I correct that the data field is now non-optional?",
        "created_at": "2022-12-27T18:54:19.630000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(Note that this commit is the latest version of 3540)",
        "created_at": "2022-12-27T18:54:35.989000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Nvm I should read the EIP better it literally says it",
        "created_at": "2022-12-27T18:55:19.190000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This section is now incorrect",
        "created_at": "2022-12-27T19:02:34.564000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "1ea9235dbf0af442f8633a327daad102a064bc7ddc2bb658ece716efbafd7a2b"
            }
        ]
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It has no code section and the data section marker is now 0x02, it should be 0x03",
        "created_at": "2022-12-27T19:03:03.351000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Programs can still do that.  On the EVM the initcode can dynamically generate different code.  Not sure what \u003c@403707149043105803\u003e has in mind.",
        "created_at": "2022-12-27T19:15:11.485000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I agree here, but you cannot change it at runtime. Sorry the analogy is super off",
        "created_at": "2022-12-27T19:15:53.492000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I am just wondering about a program which would need dynamic jumps instead of static ones üôÇ",
        "created_at": "2022-12-27T19:16:10.167000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But the higher prio is to implement this big EOF üôÇ",
        "created_at": "2022-12-27T19:16:30.813000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I also think this is off..?\n\nShould this not be `magic, version, (section_kind, section_info)+, 0, \u003csection contents\u003e`\n\nHere `section_info` for `type` section is just 2 bytes (type section size), but for `code` it is `(num_code_sections, code_section_length+`)",
        "created_at": "2022-12-27T19:17:51.574000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "d7dad924cef23feee8318b4423381ac8c80eb4f96cf16015a00c6f4ed9c92727"
            }
        ]
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I find it a bit annoying that I cannot just leave this comments on the latest github version or something, like leave a general review of a commit",
        "created_at": "2022-12-27T19:18:26.465000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But once you start executing code you cannot add to that code in the EVM, you add it via other contract addresses.  You can't, for example, code a loader that loads more code into the same code space and then calculate the entry point and dynamically jump into it.  Instead you load a new contract and dynamically call it, where the code lives in separate \"code\" from the loader.  It's not like a 6502 with only one memory block.",
        "created_at": "2022-12-27T19:28:48.730000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Do we think the whole EOF validation logic (3540 + 3670) is now covered by gas costs (as in 3860 and the code deployment cost on CREATE?)\n\nI am implementing it and there are /a lot/ of checks. Certain byte fields can have maximum value X, have to do length checks, have to do the whole stack analysis... my gut says that it is now underpriced..?",
        "created_at": "2022-12-27T19:47:42.793000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What's underpriced is the permanent storage.",
        "created_at": "2022-12-27T19:48:33.707000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ok, that I agree, but is initcode validation covered by data fee + EIP3860?",
        "created_at": "2022-12-27T19:57:04.467000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I believe this fixes it, but I need to verify it. https://github.com/ethereum/EIPs/pull/6222",
        "created_at": "2022-12-27T20:12:18.108000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I will review üôÇ",
        "created_at": "2022-12-27T20:15:13.081000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ahhhh",
        "created_at": "2022-12-27T20:17:10.285000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Could you also update this?",
        "created_at": "2022-12-27T20:17:17.300000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Type size is at least 4",
        "created_at": "2022-12-27T20:17:32.898000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "5f8136a307096200f2c7b41d82884f6834063e31b749ae6d85c359fa1620a520"
            }
        ]
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We should benchmark it once we get some test vectors, but the main question for me is does the KECCAK operation have worse gas economy.  I estimate it's better (32k to start) but what we are really stealing from is the permanent storage cost.",
        "created_at": "2022-12-27T20:19:15.882000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "O(n) analysis is why I am comfortable estimating it is fine to start with.",
        "created_at": "2022-12-27T20:20:00.955000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You are right, I am a bit premature here to start arguing about gas costs if we do not even have a benchmark yet - sorry üôÇ",
        "created_at": "2022-12-27T20:26:41.492000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I reviewed üôÇ",
        "created_at": "2022-12-27T20:26:49.502000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh wait you did not open the PR üòÖ",
        "created_at": "2022-12-27T20:28:05.048000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I believe I fixed the fix.",
        "created_at": "2022-12-27T20:45:14.537000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah right this one is better readable üôÇ",
        "created_at": "2022-12-27T20:56:45.638000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Some comments current EIP3540:\n- It is not verified that type section size is a multiple of 4 (it does not make sense to have type section size 7)\n- Type section size should be at least 4 (not 3)\n- I do not see a check that the code + data section fits exactly in the container (this might be part of the EOF spec itself and not specifically of EOF1 though)",
        "created_at": "2022-12-27T21:21:50.495000+00:00",
        "attachments": null
    },
    {
        "author": "bobsummerwill",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@393119312350543872\u003e",
        "created_at": "2022-12-27T21:21:52.917000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Does any client or evm implementation have an implementation up-to-date to latest specs?",
        "created_at": "2022-12-27T21:22:18.952000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Besu does (or at least one of the more recent specs).  Here's our layout matrix - https://github.com/hyperledger/besu/blob/main/evm/src/test/java/org/hyperledger/besu/evm/code/EOFLayoutTest.java#L33",
        "created_at": "2022-12-27T21:23:27.448000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This is \"only\" 3540, right?",
        "created_at": "2022-12-27T21:24:15.756000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh I see that 5450 is also in there",
        "created_at": "2022-12-27T21:25:05.332000+00:00",
        "attachments": null
    },
    {
        "author": "bobsummerwill",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You are probably thinking of Self-Modifying Code.  In the early days of my videogames career there was a little of that still happening as an optimization technique.  But yeah - we really do not want to do that.  It‚Äôs pretty much the opposite of the static analysis goals of EOF.\n\nhttps://en.m.wikipedia.org/wiki/Self-modifying_code",
        "created_at": "2022-12-27T21:25:12.701000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thanks üôÇ",
        "created_at": "2022-12-27T21:25:28.216000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Stack and code validations (from isolated code runs) live here - https://github.com/hyperledger/besu/blob/main/evm/src/test/java/org/hyperledger/besu/evm/code/CodeV1Test.java",
        "created_at": "2022-12-27T21:26:26.514000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "~~Is this maybe helpful for the 4200 tests? I think this covers all test cases (for validation, but also execution) - https://github.com/ethereumjs/ethereumjs-monorepo/blob/8163a81d0f8aabdc7f633581902d20869e2e9bdc/packages/vm/test/api/EIPs/eip-4200-static-relative.spec.ts#L70~~\n\nNot helpful because most code is invalid -\u003e only EIP 4200 test",
        "created_at": "2022-12-27T21:29:48.384000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Maybe you already have all those cases though, those tests on Besu's side also seem very intensive",
        "created_at": "2022-12-27T21:30:48.713000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I used code coverage to ensure every path was crossed at least once.  That's only valid if we got all the spec cases encoded.",
        "created_at": "2022-12-27T21:32:23.374000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Great üôÇ",
        "created_at": "2022-12-27T21:37:28.282000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ori is now on additional covering of EoF implementation",
        "created_at": "2022-12-27T22:59:24.205000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There are bugs and implementation is not finished in geth branches\n\nDoes besu has more update than geth eof branch?",
        "created_at": "2022-12-27T23:00:01.967000+00:00",
        "attachments": null
    },
    {
        "author": "bobsummerwill",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@403707149043105803\u003e will know best on that ^^",
        "created_at": "2022-12-27T23:39:21.681000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "To answer the question: to have a complete set of tests for eof we must first conclude with all sub eips that to be included in EoF, then have at least one implementation of it to test against.",
        "created_at": "2022-12-27T23:40:07.630000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think Besu has all the sub-eips.  I'm sure we've missed a paragraph or two that may be embarrasing, but it is at the point we should do cross-client testing and fuzzing.",
        "created_at": "2022-12-27T23:46:54.779000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm also starting `t8n` support but I need to get retesteth built locally.",
        "created_at": "2022-12-27T23:47:52.564000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://github.com/shemnon/besu/tree/t8n",
        "created_at": "2022-12-27T23:47:54.500000+00:00",
        "attachments": null
    }
]