[
    {
        "author": "pdobacz",
        "category": "Testing",
        "parent": "",
        "content": "I want to contribute some `execution-spec-tests` to fill gaps in coverage (say, DATACOPY oog errors). Any preferred way to coordinate on this (except letting know in the channel here)?",
        "created_at": "2024-07-02T12:02:51.167000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Testing",
        "parent": "",
        "content": "OOG is one under tested area, gas costing is another.  We will need a new strategy since we are banning gas introspection.  My thought was we do a legacy wrapper around 2 contracts, one is the setup and the teardown (no stack pops, usually just STOP), the other is the setup, the opcode under test, and then the same teardown.  The only difference is the opcode under test from those two.  Then we can use legacy to delta.  We may need to run each leg twice to judge warmed vs cold, or parametrize the addresses.",
        "created_at": "2024-07-02T13:54:52.621000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "gas consumption is reflected in the tx gas cost...",
        "created_at": "2024-07-02T14:46:33.812000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "for me it would be fine to just output gas used in the JSON (easier to detect the difference than state hash mismatch)",
        "created_at": "2024-07-02T14:47:27.124000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "Is https://github.com/ethereum/execution-spec-tests/pull/658 same as https://github.com/ethereum/execution-spec-tests/pull/649 ?",
        "created_at": "2024-07-02T14:48:46.123000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@275684146658148352\u003e in https://github.com/ethereum/execution-spec-tests/pull/647 I had to add \"initcode\" container kind. is this expected?",
        "created_at": "2024-07-02T14:49:49.239000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Testing",
        "parent": "",
        "content": "That does work, but moves the validation out from fill time to become cross-client.",
        "created_at": "2024-07-02T14:51:15.816000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "True. How about being able to assert on the tx gas used in Python?",
        "created_at": "2024-07-02T14:53:57.808000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "(legacy wrapper has the same level of granularity)",
        "created_at": "2024-07-02T14:54:36.893000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Gas cost is both in the miner cost (state root) and receipt trie for blockchain tests (just chiming in here üôÇ )",
        "created_at": "2024-07-02T14:54:52.822000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "(in evmone I never used `GAS` for this, I just set the expected gas used by a call).",
        "created_at": "2024-07-02T14:56:08.113000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "Correct. However, we want to put the expected value in the Python test source so it fails during test filling (instead of by running JSON tests in other EVM implementation)",
        "created_at": "2024-07-02T14:57:15.538000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Testing",
        "parent": "",
        "content": "So make the test \"bingo\" on gas and assert success and gas remaining == 0?",
        "created_at": "2024-07-02T14:59:07.145000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "Something like `state_test(..., expected_gas_used=123)` ?",
        "created_at": "2024-07-02T15:03:19.539000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "Or `r = state_test(...); assert r.gas_used == 123`. Not sure what options are API-wise.",
        "created_at": "2024-07-02T15:04:18.158000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Testing",
        "parent": "",
        "content": "How will that work across forks?  Especially with the impending verkle gaspocalypse impacting many non-target gas costs.",
        "created_at": "2024-07-02T15:08:48.971000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Testing",
        "parent": "",
        "content": "Just note, \"gas bingo\" and `expected_gas_used` work as long as no EXT*CALL is involved. The 63/64 rule and retained gas stuff makes this approach fall apart",
        "created_at": "2024-07-02T15:22:27.505000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@907931206081990666\u003e can you rebase or close? https://github.com/ethereum/execution-spec-tests/pull/658#issuecomment-2203481865",
        "created_at": "2024-07-02T15:26:12.404000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Testing",
        "parent": "",
        "content": "doing this rn, I think Mario is right",
        "created_at": "2024-07-02T15:28:15.094000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Hey \u003c@425274498732916736\u003e this is in draft, should it be or can I review? https://github.com/ethereum/execution-spec-tests/pull/598",
        "created_at": "2024-07-02T15:36:26.045000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "I think migrating EOF tests is not the top priority right now. We want to have a EOF tests release that evmone can pass. So I put this one on hold. https://github.com/ethereum/execution-spec-tests/pull/598#issuecomment-2163010339",
        "created_at": "2024-07-02T15:39:16.669000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "Does the `Container` now add any default sections?",
        "created_at": "2024-07-02T16:37:09.545000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "If you do `Container.Code` it's basically a shortcut to `Container(sections=[Section.Code(...`",
        "created_at": "2024-07-02T18:17:54.250000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "but otherwise it should not",
        "created_at": "2024-07-02T18:18:01.058000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Prague+EOF Fixtures",
        "created_at": "2024-07-02T18:19:53.939000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "it's fine. The issue was something else.",
        "created_at": "2024-07-02T18:47:48.970000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "We are currently passing all EXT*CALL tests\n\nWe have currently implemented such that if 9. fails, it will put 1 on the stack, but it does not clear the return buffer. This does not seem correct to me?",
        "created_at": "2024-07-02T20:59:47.484000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "da1aa946f83a3a3f3959914e979622a7f1a455c3d648f32162b0fef0fd381bea"
            }
        ]
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Also for EOFCREATE we likely want to add the added address into warm?",
        "created_at": "2024-07-02T21:02:50.281000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "The return buffer should be cleared (by common sense). Where have you deduced it shouldn't from?",
        "created_at": "2024-07-02T21:06:31.978000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "It was just not in the spec ü§∑‚Äç‚ôÇÔ∏è We also have a weird way to check for the MIN_CALLEE_GAS (this is somewhat hackish) which is why it did not run into the specific code which we would normally execute via calls (and therefore also empty the return buffer)",
        "created_at": "2024-07-02T21:07:49.662000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Right sorry I should not bring up obvious points",
        "created_at": "2024-07-02T21:09:15.003000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "Ok, I get it. Can you report it? https://github.com/ipsilon/eof/issues/new",
        "created_at": "2024-07-02T21:09:27.999000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Yes I will üôÇ",
        "created_at": "2024-07-02T21:09:40.633000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "No, this is absolutely fine. We want to clarify the spec even if may feel redundant by someone. I was just asking if there is a piece of the spec that suggest the buffer should not be cleared or should be cleared after the mentioned checks. But the omission we can also fix.",
        "created_at": "2024-07-02T21:11:42.419000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Then for EOFCREATE I think it should be added that the behavior on address collission is the same as CREATE2, and that the created address should be added to warm addresses (I do not see this in the spec). This is also obvious, but it might be forgotten in the first iteration when writing the code down\n\n(maybe there is already a test for this, we currently do not pass any EOFCREATE tests)",
        "created_at": "2024-07-02T21:15:33.803000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "Sure. It also point to good test cases",
        "created_at": "2024-07-02T21:18:48.859000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Also implementing EOFCREATE -\u003e I am assuming `salt` gets padded to 32 bytes here too, just like CREATE2?",
        "created_at": "2024-07-02T21:26:52.561000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "yes, always 32 bytes are included.",
        "created_at": "2024-07-02T21:37:13.446000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@892053833121923094\u003e the remainings in https://github.com/ethereum/execution-spec-tests/pull/662 looks fine to me.",
        "created_at": "2024-07-02T22:32:28.407000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "Also it would be nice to have EOF tests release.",
        "created_at": "2024-07-02T22:32:43.256000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "New release for EIP-7692 (EOF) fixtures on top of Cancun: https://github.com/ethereum/execution-spec-tests/releases/tag/eip7692%40v1.0.5",
        "created_at": "2024-07-02T22:55:58.872000+00:00",
        "attachments": null
    }
]