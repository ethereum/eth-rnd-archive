[
    {
        "author": "gurukamath",
        "category": "Testing",
        "parent": "",
        "content": "In version `eip7692@v2.1.0` of the tests, the following test seems to be implying that there is a `value` that the `EXTDELEGATECALL` call sends which I think is not possible as per EIP-7069. Not sure if I have misunderstood something here but the EELS implementation is failing the test for this reason. Appreciate the help!",
        "created_at": "2025-02-03T10:49:09.840000+00:00",
        "attachments": null
    },
    {
        "author": "gurukamath",
        "category": "Testing",
        "parent": "",
        "content": "```\n{\n        'test_file': 'blockchain_tests/eip7692_eof_v1/eip7069_extcall/calls/callee_context.json',\n        'test_key': 'tests/osaka/eip7692_eof_v1/eip7069_extcall/test_calls.py::test_callee_context[fork_Osaka-evm_code_type_EOF_V1-blockchain_test-extdelegatecall_call_value]'\n    }\n```",
        "created_at": "2025-02-03T10:49:32.593000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I just checked, but the \"call_value\" here is actually checking what the `CALLVALUE` is in the test. (the opcode `CALLVALUE`)\n\n```python\n@pytest.mark.parametrize(\n    [\"opcode\", \"destination_code\", \"expected_result\"],\n    [\n        pytest.param(Op.EXTCALL, Op.ADDRESS, \"destination\", id=\"extcall_address\"),\n        pytest.param(Op.EXTDELEGATECALL, Op.ADDRESS, \"caller\", id=\"extdelegatecall_address\"),\n        pytest.param(Op.EXTSTATICCALL, Op.ADDRESS, \"destination\", id=\"extstaticcall_address\"),\n        pytest.param(Op.EXTCALL, Op.CALLER, \"caller\", id=\"extcall_caller\"),\n        pytest.param(Op.EXTDELEGATECALL, Op.CALLER, \"sender\", id=\"extdelegatecall_caller\"),\n        pytest.param(Op.EXTSTATICCALL, Op.CALLER, \"caller\", id=\"extstaticcall_caller\"),\n        pytest.param(Op.EXTCALL, Op.CALLVALUE, 0, id=\"extcall_call_value\"),\n        pytest.param(\n            Op.EXTDELEGATECALL, Op.CALLVALUE, \"tx_value\", id=\"extdelegatecall_call_value\"\n        ),\n        pytest.param(Op.EXTSTATICCALL, Op.CALLVALUE, 0, id=\"extstaticcall_call_value\"),\n        pytest.param(Op.EXTCALL, Op.ORIGIN, \"sender\", id=\"extcall_origin\"),\n        pytest.param(Op.EXTDELEGATECALL, Op.ORIGIN, \"sender\", id=\"extdelegatecall_origin\"),\n        pytest.param(Op.EXTSTATICCALL, Op.ORIGIN, \"sender\", id=\"extstaticcall_origin\"),\n    ],\n)\n``` (in `tests/osaka/eip7692_eof_v1/eip7069_extcall/test_calls.py` line 582, the `test_callee_context`)\n\nIt should check that the callvalue in the initial frame (which executes EXTDELEGATECALL) is propagated to the delegate call frame",
        "created_at": "2025-02-03T10:55:12.255000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "(So the opcode `CALLVALUE` should be put the `tx.value` on stack, just like in legacy `DELEGATECALL`)",
        "created_at": "2025-02-03T10:59:10.402000+00:00",
        "attachments": null
    },
    {
        "author": "gurukamath",
        "category": "Testing",
        "parent": "",
        "content": "Ah. Right!! Thanks",
        "created_at": "2025-02-03T11:05:11.997000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "If you want a trace of a specific test let me know, we pass the state tests üôÇ",
        "created_at": "2025-02-03T11:09:40.973000+00:00",
        "attachments": null
    },
    {
        "author": "gurukamath",
        "category": "Testing",
        "parent": "",
        "content": "Will do! Thanks. üôè",
        "created_at": "2025-02-03T11:10:34.215000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Testing",
        "parent": "",
        "content": "Could you do me a trace of one of the non returning jumpf tests where the input is larger than stack height? \n\ne.g. test_jumpf_stack_non_returning_rules \nfork_Osaka-state_test-h-2-ti-4\n\nNot sure why we are calculating state root wrong; I assume mispriced gas somewhere",
        "created_at": "2025-02-03T16:08:38.713000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "",
        "created_at": "2025-02-03T16:14:14.582000+00:00",
        "attachments": [
            {
                "type": "application/json; charset=utf-8",
                "origin_name": "alloc.json",
                "content": "e83ddc6c7a93022822638243f7554abe08670317ad2c8fa5334690b506624cfd"
            },
            {
                "type": "application/json; charset=utf-8",
                "origin_name": "result.json",
                "content": "50d615b460864c364b59dfa2b01282042bf26a4340c185a79eb202f644409b8a"
            }
        ]
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "If you need any further info let me know. Not sure what this test does, in the end it only pays the miner, so no contract is being created",
        "created_at": "2025-02-03T16:35:55.490000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Testing",
        "parent": "",
        "content": "it fails initcode validation, so doesn't really do much; but we are calculating wrong root which suggests are charging wrong gas for the tx",
        "created_at": "2025-02-03T16:37:14.986000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Testing",
        "parent": "",
        "content": "But I also wasn't sure that was the reason üôÇ",
        "created_at": "2025-02-03T16:37:47.442000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "This runs on top of Prague so maybe the calldata stuff has to do with it? I can check if you want",
        "created_at": "2025-02-03T16:38:19.170000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Testing",
        "parent": "",
        "content": "Yeah we are running on top of devnet-6; but had lots of merge conflicts bringing it up to date; so think something got lost. Just need to find it now üôÇ",
        "created_at": "2025-02-03T16:39:52.240000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Testing",
        "parent": "",
        "content": "You spend 53604 gas, we spend 22500 gas ü§î",
        "created_at": "2025-02-03T16:53:29.953000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "That sounds very wrong, because you need to charge the create contract gas of 32k",
        "created_at": "2025-02-03T16:53:50.840000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Testing",
        "parent": "",
        "content": "ball park of how much we are off by",
        "created_at": "2025-02-03T16:54:24.693000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "So if tx creates a contract then the intrinsic base cost immediately goes up from 21k to 21k+32k",
        "created_at": "2025-02-03T16:54:40.193000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Testing",
        "parent": "",
        "content": "oh that is kinda weird",
        "created_at": "2025-02-03T16:55:41.215000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Also wonder where the 22.5k - 21k = 1500 gas comes from, oddly specific üòÖ",
        "created_at": "2025-02-03T16:56:25.695000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Testing",
        "parent": "",
        "content": "using floor cost not intrinsic cost; looks like EIP-7623 merge issue",
        "created_at": "2025-02-03T16:57:04.529000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Nethermind EOF fixtures thread",
        "created_at": "2025-02-03T17:01:15.132000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Testing",
        "parent": "",
        "content": "Ok all state tests passing; thank you \u003c@508125616940515329\u003e",
        "created_at": "2025-02-03T22:27:30.743000+00:00",
        "attachments": null
    }
]