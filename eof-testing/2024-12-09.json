[
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "What is meant by the exceptional halt behavior here? I don't see it in our current (legacy) code. EDIT: nvm, we have this in our code + the changed EOF behavior",
        "created_at": "2024-12-09T12:53:27.777000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "92c4dc5d3de822ec2034a2514e567a13d56f5b4f91916f29e823d84cecef5119"
            }
        ]
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "From: https://github.com/ipsilon/eof/blob/main/spec/eof.md\n\nIs above still a correct source?",
        "created_at": "2024-12-09T12:53:52.771000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Testing",
        "parent": "",
        "content": "Yes, should be correct, and this point is correct. RETURNDATACOPY behavior changes in EOF contexts (no oob failures, pad with 0s instead)",
        "created_at": "2024-12-09T13:13:40.629000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Right yes I'm just reading about RETURNDATACOPY but it does not seem we have this OOB behavior. Will re-run tests but this should definitely trigger something (does not have to be Osaka test ðŸ˜… )",
        "created_at": "2024-12-09T13:14:20.626000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "https://eips.ethereum.org/EIPS/eip-211",
        "created_at": "2024-12-09T13:14:33.867000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I'm gonna need some help with a EOF container validation test. It is this container:\n\n`0xef0001010004020001000c0300010015040000000080000261201560015560006000ee00ef0001010004020001000104000000008000000099`\n\nThis should fail, I do not see why. Here's the test file\n\n```\n{\n    \"tests/osaka/eip7692_eof_v1/eip7620_eof_create/test_subcontainer_validation.py::test_dangling_initcode_subcontainer_bytes[fork_Osaka-eof_test]\": {\n        \"vectors\": {\n            \"0\": {\n                \"code\": \"0xef0001010004020001000c0300010015040000000080000261201560015560006000ee00ef0001010004020001000104000000008000000099\",\n                \"containerKind\": \"INITCODE\",\n                \"results\": {\n                    \"Osaka\": {\n                        \"exception\": \"EOFException.INVALID_SECTION_BODIES_SIZE\",\n                        \"result\": false\n                    }\n                }\n            }\n        },\n        \"_info\": {\n            \"hash\": \"0xa51fefb40c233fcad35308aa2a73e6e8001e0b8847343a9fe56e5f272cf0e769\",\n            \"comment\": \"`execution-spec-tests` generated test\",\n            \"filling-transition-tool\": \"evmone-t8n 0.13.0+commit.2f79e0dc\",\n            \"description\": \"Test function documentation:\\nInitcode mode EOF Subcontainer test with subcontainer containing dangling bytes.\",\n            \"url\": \"https://github.com/ethereum/execution-spec-tests/blob/eip7692@v2.1.0/tests/osaka/eip7692_eof_v1/eip7620_eof_create/test_subcontainer_validation.py#L794\",\n            \"reference-spec\": \"https://github.com/ethereum/EIPs/blob/master/EIPS/eip-7620.md\",\n            \"reference-spec-version\": \"52ddbcdddcf72dd72427c319f2beddeb468e1737\"\n        }\n    }\n}\n```",
        "created_at": "2024-12-09T13:51:07.732000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Test says subcontainer has dangling bytes, I do not get these dangling bytes, the subcontainer looks valid to me.",
        "created_at": "2024-12-09T13:51:44.960000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Whoops, it has a data section of 1 where it should have a data section of 0",
        "created_at": "2024-12-09T14:02:47.758000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Testing",
        "parent": "",
        "content": "For a subcontainer all of the bytes should be part of the container in each body section, \"dangling bytes\" means there are unused bytes (as you discovered from the data section size issue)",
        "created_at": "2024-12-09T14:21:04.172000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Yup, thanks, for some reason thought that data section size was 1 and not 0 ðŸ˜… \n\nHave only 20 tests failing now related to RJUMP targets, so close to passing all container tests ðŸ˜„",
        "created_at": "2024-12-09T16:01:59.451000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Ok, this might  be somewhat alarming, we had the rules for \"intermediate bytes\" and valid jump targets set over the entire code container, not per code section, this only resulted in 20 tests failing. I would have expected more. \n\nSo if there are two code sections, and section 1 has a RJUMP[0], this will mark in section 2 bytes 1 and 2 thus also as intermediate bytes ðŸ˜…",
        "created_at": "2024-12-09T16:08:36.718000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Anyways, we pass all now ðŸ˜„",
        "created_at": "2024-12-09T16:10:10.530000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "(plus the exec tests in blockchain / state tests ðŸ˜„ )",
        "created_at": "2024-12-09T16:10:21.805000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Testing",
        "parent": "",
        "content": "interesting, which tests triggered that? we recently added some RJUMP/code-section interactions, I'm curious if we should torture this subject a bit more ðŸ™‚",
        "created_at": "2024-12-09T16:13:50.183000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Here are all tests failing from latest release with this intermediates/jump targets on the entire code instead of per-section",
        "created_at": "2024-12-09T16:17:15.432000+00:00",
        "attachments": [
            {
                "type": "text/plain; charset=utf-8",
                "origin_name": "message.txt",
                "content": "9770a425fb3efaebe7a36440baf7c785b0cf9c689de88c97769db4ba52a0c2f2"
            }
        ]
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "The unknown error is \"invalid RJUMP target\" in all cases (changed the error msg to output the validator input so I could isolate them)",
        "created_at": "2024-12-09T16:17:50.518000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "https://github.com/ethereumjs/ethereumjs-monorepo/pull/3568 Here are all fixes we had to do in order to pass all exec+validation tests",
        "created_at": "2024-12-09T16:18:11.077000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I also have another question, are there container test swith Tx initcode mode instead of Initcode mode? There is this extra rule for Tx initcode that the data section should be fully defined IIRC (which is a different rule than \"normal\" initcode (EOFCREATE) where data section can expand)",
        "created_at": "2024-12-09T16:21:57.300000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I think we could also move the eof container tests into blockchain tests, this should work there (also for the tx initcode validation)",
        "created_at": "2024-12-09T16:22:44.991000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Here is a simple test regarding the RJUMP one which failed: \n\n0xef000101000c020003000400060002040000000080000101800001018000015fe50001e00000e500025000\n\nHas RJUMP[0] in the second section, but we marked those bytes as intermediates in the first section ðŸ˜…",
        "created_at": "2024-12-09T16:23:40.778000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Testing",
        "parent": "",
        "content": "Thanks a lot for this, this is helpful!",
        "created_at": "2024-12-09T16:25:55.250000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Testing",
        "parent": "",
        "content": "to your point\n\u003e test swith Tx initcode mode instead of Initcode mode? There is this extra rule for Tx initcode that the data section should be fully defined IIRC (which is a different rule than \"normal\" initcode (EOFCREATE) where data section can expand)\nThis doesn't sound right. Initcode should have fully defined data section in both cases (tx or EOFCREATE). Only code pointed to by RETURNCONTRACT (aka deploy code) can have truncated data section, to be appended by aux_data supplied in RETURNCONTRACT",
        "created_at": "2024-12-09T16:26:58.699000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Sorry - I meant RETURNCONTRACT here",
        "created_at": "2024-12-09T16:28:12.264000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Let me revisit the spec, I might have missed something and overcomplicated my code though",
        "created_at": "2024-12-09T16:28:35.721000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Testing",
        "parent": "",
        "content": "OK, and to answer your question - since there is no distinction between tx and non-tx initcode mode, there are only common container tests for initcode mode in that aspect.",
        "created_at": "2024-12-09T16:31:59.907000+00:00",
        "attachments": null
    },
    {
        "author": "pdobacz",
        "category": "Testing",
        "parent": "",
        "content": "so short answer - yes, there are such tests ðŸ™‚",
        "created_at": "2024-12-09T16:32:17.151000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Revisited the spec, not sure where my idea of extra tx initcode rules came from. But now it's clear - thanks ðŸ˜„",
        "created_at": "2024-12-09T16:43:38.878000+00:00",
        "attachments": null
    }
]