[
    {
        "author": "ben_a_adams",
        "category": "Testing",
        "parent": "",
        "content": "I assume PeerDAS as that seems to be the given for Fusaka; and FOCIL is a maybe?",
        "created_at": "2025-02-07T01:21:47.371000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Testing",
        "parent": "",
        "content": "TBD, but that's the startig position for Fulu negotiations.",
        "created_at": "2025-02-07T01:22:14.139000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Testing",
        "parent": "",
        "content": "I'd say FOCIL starts in Glamsterdam.",
        "created_at": "2025-02-07T01:22:26.065000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@755590043632140352\u003e what PeerDAS CLs would you recommend as most stable; for EOF devnet? (since active on x)",
        "created_at": "2025-02-07T01:23:31.168000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Testing",
        "parent": "",
        "content": "Also asked in https://discord.com/channels/595666850260713488/598292067260825641/1337232496017936437",
        "created_at": "2025-02-07T01:25:32.493000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I only know Prysm is stable, not long ago they were the only client in the devnet. But I think lighthouse is now fully featured? And all other clients are about to? At least they all claimed in the last call that they were devnet4 ready",
        "created_at": "2025-02-07T01:27:31.669000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "That would be my first recommendation for you cause then you don't need to worry about client key allocation. Just start with a single CL and you can add keys as needed later",
        "created_at": "2025-02-07T01:29:29.433000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Testing",
        "parent": "",
        "content": "We only need 1 CL type at this point; as not trying to test CLs in this devnet would be noise; so Prysm sounds like the one if have been running stable for a while",
        "created_at": "2025-02-07T01:30:38.303000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Yeah just start and get the devnet rolling, clients can jump in. I think what we want is to have this rolling now so that if it's stable quickly we can just cut a new fork soon, and if it's not we can always add features we're coding in parallel to it",
        "created_at": "2025-02-07T01:32:06.775000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "So the initial plan was to just use older versions of the CL for EOF testing so they ignore FULU (this is the approach we use in PeerDAS, just in reverse). However, when i tried this with a few clients i got FCU errors (e.g: `\"forkchoiceUpdatedV3 must only be called for cancun payloads\"`). \ne.g of this config, which recognizes FULU but has little peerDAS logic (so technically should work):\n```\nparticipants:\n  - el_type: geth\n    el_image: ethpandaops/geth:osaka-mega-eof\n    cl_type: lighthouse\n    cl_image: ethpandaops/lighthouse:unstable\n    count: 2\nglobal_log_level: info\nnetwork_params:\n  electra_fork_epoch: 1\n  fulu_fork_epoch: 2\n  seconds_per_slot: 4\nadditional_services:\n  - dora\nsnooper_enabled: true\n```\n`kurtosis run github.com/ethpandaops/ethereum-package --args-file=./\u003cfile\u003e --image-download always`\n1. Use PeerDAS branches for EOF testnets: I really dislike this approach, we're still launching peerdas-devnet-4 and it makes co-ordinating changes a lot harder. Irrelevant bugs could pop up and just waste time debugging it. cc prysm/lighthouse, when i tried the `ethpandaops/prysm-beacon-chain:peerDAS-01705d1` or `ethpandaops/lighthouse:peerdas-devnet-4` branches, I still got `\"forkchoiceUpdatedV3 must only be called for cancun payloads\"` even though Fulu was clearly enabled `[cl-2-prysm-geth] time=\"2025-02-07 02:24:46\" level=info msg=\"Upgraded state to\" prefix=state version=fulu`.\ne.g of this config (that should also theoretically work):\n```\nparticipants:\n  - el_type: geth\n    el_image: ethpandaops/geth:osaka-mega-eof\n    cl_type: prysm\n    cl_image: ethpandaops/prysm-beacon-chain:peerDAS-01705d1\n    count: 2\nglobal_log_level: info\nnetwork_params:\n  electra_fork_epoch: 1\n  fulu_fork_epoch: 2\n  seconds_per_slot: 4\nadditional_services:\n  - dora\nsnooper_enabled: true\n```\n`kurtosis run github.com/ethpandaops/ethereum-package --args-file=./\u003cfile\u003e --image-download always`",
        "created_at": "2025-02-07T02:43:02.127000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "2. I modify our genesis generation tool to set Osaka_Time but not FULU_EPOCH. This would just live in a eof fork, i can consume the fork in kurtosis and in our devnet tooling. Eventually when we merge the two features, i can get rid of this. I pushed the changes for this in a branch, so if you use the config with `ethpandaops/lighthouse:unstable`(first one), then run kurtosis with `kurtosis run github.com/ethpandaops/ethereum-package@try-eof-only --args-file=./\u003cfile\u003e --image-download always` then you get a genesis in which FULU_FORK_EPOCH is just hardcoded to 9999999, but osakaTime happens as expected (i.e EOF without PeerDAS). This however led to the same `error: ServerMessage { code: -38005, message: \"Unsupported fork\" }, service: exec` bug as before.",
        "created_at": "2025-02-07T02:43:03.951000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "I'd need some help at this point to figure out if its the EL or the CL causing the forkchoiceUpdatedV3 issue. I would assume its the CL, but in option 2. the CL doesn't even have a fork change from electra.",
        "created_at": "2025-02-07T02:44:16.118000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "Note: All my testing for the EL was on geth, this is mainly due to geth printing out all the genesis info it reads in the logs (so its easier for me to validate changes). I can retry it with nethermind/besu in a few hours in case someone else doesn't do it first. There was also an electra issue when i was trying nethermind + geth, so i reckon there's some spec difference in electra that's on the eof branches that might be adding some issues, but we can get around that by using a single client config for now and deal with it one bug at a time.",
        "created_at": "2025-02-07T02:45:14.950000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I really think you'll be better off with Osaka+Fulu and if you're scared of stability of peer DAS just use a single CL",
        "created_at": "2025-02-07T03:05:08.431000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Having a mixed fork can lead to unforseen debugging that may be subtler than just a straight out CL bug.",
        "created_at": "2025-02-07T03:06:05.400000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "Yeah but I tried all approaches and they all fail. There's a bug that needs fixing.\n\nOption 1. And it's example is what you state should work(and I agree, it should in theory). And it doesn't right now :/",
        "created_at": "2025-02-07T03:09:40.858000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "Whats the bug with prysm \u003c@199561711278227457\u003e , We can't start up ?",
        "created_at": "2025-02-07T03:29:19.021000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@\u0026595685821026271242\u003e ^",
        "created_at": "2025-02-07T03:30:00.643000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "I see this:\n\u003e forkchoiceUpdatedV3 must only be called for cancun payloads",
        "created_at": "2025-02-07T03:30:44.191000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "It's not at startup, so prysm forks through fine until fulu. Once fulu is activated, it fails with the fcu issue.",
        "created_at": "2025-02-07T03:31:31.462000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "ah, ok i see this in geth",
        "created_at": "2025-02-07T03:31:56.814000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "This is after me using a peerdas branch, in which fulu should activate peerdas and theoretically be compatible with eof",
        "created_at": "2025-02-07T03:32:04.249000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "```go\n        if api.eth.BlockChain().Config().LatestFork(params.Timestamp) != forks.Cancun \u0026\u0026 api.eth.BlockChain().Config().LatestFork(params.Timestamp) != forks.Prague {\n            return engine.STATUS_INVALID, engine.UnsupportedFork.With(errors.New(\"forkchoiceUpdatedV3 must only be called for cancun payloads\"))\n        }\n```",
        "created_at": "2025-02-07T03:32:11.743000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "Basically the EL realises its not cancun or prague and complains",
        "created_at": "2025-02-07T03:32:33.359000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "Got it. So Osaka Time isn't configured in geth even though it spits it out as a configured fork in the startup logs?",
        "created_at": "2025-02-07T03:33:08.816000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "well, geth needs to add in an exception in its FCUv3 method",
        "created_at": "2025-02-07T03:33:33.747000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "for osaka",
        "created_at": "2025-02-07T03:33:37.548000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "I haven't tried nethermind, yet, but then it should work?\n \n```\n  - el_type: nethermind\n    el_image: ethpandaops/nethermind:feature-evm-eof\n```",
        "created_at": "2025-02-07T03:33:58.476000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "Thanks!",
        "created_at": "2025-02-07T03:34:06.880000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "yeah, I think nethermind should work if they have the osaka exception",
        "created_at": "2025-02-07T03:34:18.830000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "okie this works ❤️ \nMay the EOF devnet cycle commence! (thank you for the bug find Nishant!)\n\n```\nparticipants:\n  - el_type: nethermind\n    el_image: ethpandaops/nethermind:feature-evm-eof\n    cl_type: prysm\n    cl_image: ethpandaops/prysm-beacon-chain:develop-557c5be\n  - el_type: reth\n    el_image: ethpandaops/reth:main\n    cl_type: prysm\n    cl_image: ethpandaops/prysm-beacon-chain:develop-557c5be\n  - el_type: besu\n    el_image: ethpandaops/besu:main\n    cl_type: prysm\n    cl_image: ethpandaops/prysm-beacon-chain:develop-557c5be\nglobal_log_level: info\nnetwork_params:\n  electra_fork_epoch: 1\n  fulu_fork_epoch: 2\n  seconds_per_slot: 4\nadditional_services:\n  - dora\nsnooper_enabled: true\n```\n\nTo run it: `kurtosis run  github.com/ethpandaops/ethereum-package --args-file=./\u003cfile\u003e --image-download always`\n\nWhat you get:\n- Local devnet with 3 clients, It uses regular electra for the CL and enables EOF for the EL. There is no major PeerDAS component involved, so bugs found should be mostly EOF related. \n- You can add a tx spammer, blob spammer via the `additional_services`\n- If you have external tests/tooling/fuzzers, you can point it to the RPC kurtosis gives you to add a load. You can use the `static_ports` feature if you want to pre-code in endpoints for tests\n- Assertoor can fire off certain EEST tests against a running devnet, have a look at how we do it in pectra. We would need a folder here for EOF-tests (https://github.com/ethpandaops/assertoor/tree/master/playbooks), Have a `all.yaml` test that runs every EOF test and then have a bunch of scenario specific EOF tests separately so we can choose if we want to trigger one scenario or all. Example pectra EEST that needs modifying for EOF: https://github.com/ethpandaops/assertoor/blob/master/playbooks/pectra-dev/execution-spec-tests.yaml . **PRs welcome!** Or we'll try to get to it once pectra stuff subsides.",
        "created_at": "2025-02-07T06:31:04.048000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "and geth is missing due to the bug Nishant mentioned, once they are fixed we can add it to the matrix",
        "created_at": "2025-02-07T06:31:29.436000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Testing",
        "parent": "",
        "content": "Looks like only Nethermind is building blocks and forking to Osaka, Besu and Reth aren't recognizing the config.  So there is some non-EOF plumbing we need to fix in at least these two.  Another quirk is that Besu won't build cancun or prague blocks because of the EngineForkChoiceUpdated version being called pre-cancun. Once we get a clean kurtosis run we can run the devnet.",
        "created_at": "2025-02-07T16:46:54.234000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Testing",
        "parent": "",
        "content": "Update: my besu and reth \"main\" images were very out of data.  Two \"docker pull\"s later and 100% attestations.",
        "created_at": "2025-02-07T19:55:02.480000+00:00",
        "attachments": null
    }
]