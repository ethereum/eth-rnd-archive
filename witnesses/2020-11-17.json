[
    {
        "author": "jason.carver",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "For what it's worth, if there's only a handful of pauses, then it's probably not top priority. But if there are hundreds of missing hashes, then we probably need to figure it out soon.",
        "created_at": "2020-11-17T00:06:30.909000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "changed it",
        "created_at": "2020-11-17T00:31:43.730000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "now all bytecode hashes will be included",
        "created_at": "2020-11-17T00:31:51.377000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I hope it was it",
        "created_at": "2020-11-17T00:32:35.334000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "but because of the way we collect witness it would be really miss anything unless it is cached outside",
        "created_at": "2020-11-17T00:33:00.001000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(and bytecode was a special case because we cache the jump destinations analysis)",
        "created_at": "2020-11-17T00:33:24.336000+00:00",
        "attachments": null
    },
    {
        "author": "jason.carver",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "what about at state root calculation time?",
        "created_at": "2020-11-17T00:33:38.954000+00:00",
        "attachments": null
    },
    {
        "author": "jason.carver",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that's the other one that's easy to miss, I think",
        "created_at": "2020-11-17T00:34:09.058000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it is included",
        "created_at": "2020-11-17T00:34:21.751000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "we simply wrapped the database calls into witnessed calls",
        "created_at": "2020-11-17T00:34:58.461000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "no logic required",
        "created_at": "2020-11-17T00:35:01.240000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "",
        "created_at": "2020-11-17T00:36:19.204000+00:00",
        "attachments": [
            {
                "type": "",
                "origin_name": "unknown.png",
                "content": "e2ac7bc88ea3505232abd17bccbeca0a48ca156b9fe8bb2aa1726ad855db9424"
            }
        ]
    },
    {
        "author": "jason.carver",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yup, similar for us. I guess the collector wasn't the tough part for us. The thing that caught us during the naive implementation was needing to \"pause\" execution at state root calculation when data is missing, compared to the more obvious need to pause during the generic EVM execution.",
        "created_at": "2020-11-17T00:36:29.163000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "oh, do you pause?",
        "created_at": "2020-11-17T00:36:48.001000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "interesting - we have a different approach",
        "created_at": "2020-11-17T00:36:55.590000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "we do not pause the EVM",
        "created_at": "2020-11-17T00:37:00.912000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "but it would be probably better",
        "created_at": "2020-11-17T00:37:10.768000+00:00",
        "attachments": null
    },
    {
        "author": "jason.carver",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yeah, our evm pauses, partly out of necessity, because our Mgas/sec is pretty low",
        "created_at": "2020-11-17T00:37:34.087000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so you shelve the execution environment and switch to beam sync and then go back to evm?",
        "created_at": "2020-11-17T00:38:01.043000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "we have a similar solution to the witness collector -\u003e we have a wrapper around the DB",
        "created_at": "2020-11-17T00:38:30.049000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "BeamDb simply is slow to request some data",
        "created_at": "2020-11-17T00:38:42.297000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "but from the EVM perspective it behaves exactly the same",
        "created_at": "2020-11-17T00:38:57.291000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "just like a very slow database",
        "created_at": "2020-11-17T00:39:01.855000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so evm does not have any code changes for beam sync",
        "created_at": "2020-11-17T00:39:11.507000+00:00",
        "attachments": null
    },
    {
        "author": "jason.carver",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "we patch in at the state accessors underneath the EVM, and catch the exception about missing data. then we don't return until the data is available. So from the EVMs point of view, the data access is just reaaally slow",
        "created_at": "2020-11-17T00:39:15.843000+00:00",
        "attachments": null
    },
    {
        "author": "jason.carver",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yup, sounds basically the same",
        "created_at": "2020-11-17T00:39:23.233000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "cool",
        "created_at": "2020-11-17T00:39:28.195000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think the strangest thing in the entire Nethermind beam sync implementation are the async local states",
        "created_at": "2020-11-17T00:39:51.250000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it is like a global directory of information available for the pariticular Task (and not thread as the task can be assigned to a different thread on IO continuation)",
        "created_at": "2020-11-17T00:41:18.133000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "block-import-logs",
        "created_at": "2020-11-17T07:45:22.919000+00:00",
        "attachments": [
            {
                "type": "",
                "origin_name": "message.txt",
                "content": "a56b77a2315e29646b7221bae4a3f48810fddd9c44e10689599d9e44e98480ee"
            }
        ]
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "now seeing much less missing data, but still enough to prevent my node from keeping up with the tip",
        "created_at": "2020-11-17T07:48:02.445000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!489256758989029405\u003e looks like your node is full again",
        "created_at": "2020-11-17T08:09:50.751000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "no way",
        "created_at": "2020-11-17T23:05:19.433000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "let me check",
        "created_at": "2020-11-17T23:05:21.724000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it seems to be t around 750:",
        "created_at": "2020-11-17T23:06:25.557000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "nethermind\u003e admin.peers().length\nRequest complete in 199241.9µs\n768.0\nnethermind\u003e admin.peers().length\nRequest complete in 159559.7µs\n751.0\nnethermind\u003e admin.peers().length\nRequest complete in 173103.0µs\n754.0\nnethermind\u003e admin.peers().length\nRequest complete in 156177.5µs\n750.0\nnethermind\u003e",
        "created_at": "2020-11-17T23:06:26.122000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!482518216019542016\u003e would you be able to tell which nodes are missing?",
        "created_at": "2020-11-17T23:08:06.537000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "do you reshape the nodes while working with the block?",
        "created_at": "2020-11-17T23:10:11.787000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ooooooo",
        "created_at": "2020-11-17T23:19:04.653000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "we did not think of it",
        "created_at": "2020-11-17T23:19:08.772000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "",
        "created_at": "2020-11-17T23:19:11.069000+00:00",
        "attachments": [
            {
                "type": "",
                "origin_name": "unknown.png",
                "content": "4edc862c1a21ee5d84a05b5ee7ec743f1f0eb6f835b593b06a4dc96951f99409"
            }
        ]
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it seems that we keep caching the accounts, hmmm",
        "created_at": "2020-11-17T23:19:37.564000+00:00",
        "attachments": null
    }
]