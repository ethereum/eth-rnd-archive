[
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "2020-11-16 12:50:01.4799|Persisting 0x7150619152ea24aa72f5045ffdb68737a0e584680d617c3d5b020745f2958ee5 witness (5178)\n2020-11-16 12:50:01.5184|Broadcasting block 11268977 (0x715061...958ee5) to 11 peers.\n2020-11-16 12:50:01.5208|Processed   11268977 |    1,213ms, mgasps   20.55 total    6.16, tps  245.58 total   78.95, bps    0.82 total    0.22, recv queue 0, proc queue 0",
        "created_at": "2020-11-16T12:54:49.336000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!482518216019542016\u003e",
        "created_at": "2020-11-16T12:55:07.152000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "node is ready for serving the mainnet syncs",
        "created_at": "2020-11-16T12:55:18.614000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!489256758989029405\u003e I'm getting a timeout when attempting to connect. did you change the node ID, port or something else?",
        "created_at": "2020-11-16T16:14:20.806000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ah maybe, let me check",
        "created_at": "2020-11-16T16:21:07.866000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\"Network\": {\n    \"ActivePeersMaxCount\": 200,\n    \"DiscoveryPort\": 31305,\n    \"P2PPort\": 31505,\n    \"DiagTracerEnabled\": false\n  },\n  \"JsonRpc\": {\n    \"Enabled\": true,\n    \"TracerTimeout\": 20000,\n    \"Host\": \"0.0.0.0\",\n    \"Port\": 8550\n  },",
        "created_at": "2020-11-16T16:21:44.546000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "nethermind\u003e node.switch(\"94.237.80.80:8550\")\n\"http://94.237.80.80:8550\"\nnethermind\u003e eth.blockNumber\nRequest complete in 142982.1Âµs\n11269940.0\nnethermind\u003e",
        "created_at": "2020-11-16T16:22:50.201000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "works for me",
        "created_at": "2020-11-16T16:22:52.624000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!489256758989029405\u003e and node ID is still the same?",
        "created_at": "2020-11-16T16:23:54.380000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "let me check",
        "created_at": "2020-11-16T16:27:47.401000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "nethermind\u003e node.enode\nRequest complete in 42721.0Âµs\n\"enode://424c920fb33c5322a7a2e40a3449dd53a822b096e8e65f7c7758a3a4fc880db0e68a945c58d9c14ae1775014fee877c98b14c47c173ed923b2c1c53b9bf57df5@94.237.80.80:31505\"",
        "created_at": "2020-11-16T16:28:09.580000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yeah, that's different",
        "created_at": "2020-11-16T16:30:05.446000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!489256758989029405\u003e with the correct node ID we connect but your node disconnects before sending the auth ack. do you see any errors in your logs?",
        "created_at": "2020-11-16T16:33:56.896000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "witnesses are regularly ~5000 nodes",
        "created_at": "2020-11-16T16:34:00.952000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e \u003c@!489256758989029405\u003e with the correct node ID we connect but your node disconnects before sending the auth ack. do you see any errors in your logs?\n\u003c@!482518216019542016\u003e did you switch to mainnet settings?",
        "created_at": "2020-11-16T16:34:24.758000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I have lots and lots of logs so would not see it",
        "created_at": "2020-11-16T16:34:34.920000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!489256758989029405\u003e yep, on mainnet",
        "created_at": "2020-11-16T16:35:07.763000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "well, now it's connected",
        "created_at": "2020-11-16T16:35:11.578000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "oh, we are full",
        "created_at": "2020-11-16T16:35:43.098000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ok",
        "created_at": "2020-11-16T16:35:44.720000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "we probably were sending you TooManyPeers",
        "created_at": "2020-11-16T16:35:51.971000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "200 filled",
        "created_at": "2020-11-16T16:35:55.963000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!489256758989029405\u003e I just realized we are unlikely to get any NewBlock msgs from your node as you're not mining and when you're jost forwarding NewBlock msgs from other nodes you only send it to a subset of your peers, right?",
        "created_at": "2020-11-16T16:40:00.228000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yeah, likely",
        "created_at": "2020-11-16T16:40:25.813000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "currently we only fetch witnesses when we receive a NewBlock msg",
        "created_at": "2020-11-16T16:41:34.252000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "but only from the very node that sent you the NewBlock message?",
        "created_at": "2020-11-16T16:57:54.068000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yes",
        "created_at": "2020-11-16T16:58:29.493000+00:00",
        "attachments": null
    },
    {
        "author": "jason.carver",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!482518216019542016\u003e One option is that we could decouple from `NewBlock` entirely. We could check in `BeamBlockImporter.preview_transactions` if we have a witness yet for the given header. If not, trigger a coro that asks any peers that support `wit` for the hashes. As long as we only receive empty responses, keep trying every few seconds.",
        "created_at": "2020-11-16T16:58:54.426000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!489256758989029405\u003e any way you can reserve a few peer slots on your node for us? I'm having a hard time connecting as your node is maxed out",
        "created_at": "2020-11-16T17:00:04.422000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I can change the peers to 1000 or set you as a static node",
        "created_at": "2020-11-16T17:00:25.477000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "would you please send me the details for the static node (enode)",
        "created_at": "2020-11-16T17:00:34.797000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "enode://9f9f8b2bd6b6de873411358e949efb68b6983cb4e3046083e182a221ac8ef74d06730e27050023a86b5dc4b6969b68da9b5b338fc60624f10642b4db40d57d98@94.63.192.187:30303",
        "created_at": "2020-11-16T17:03:09.864000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "try now",
        "created_at": "2020-11-16T17:04:10.008000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!425615769280315392\u003e another option is to fetch witnesses when we receive NewBlockHashes, as those are supposed to be sent to every peer",
        "created_at": "2020-11-16T17:04:49.519000+00:00",
        "attachments": null
    },
    {
        "author": "jason.carver",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Is `NewBlockHashes` sent before or after importing the block locally?",
        "created_at": "2020-11-16T17:05:47.625000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "after",
        "created_at": "2020-11-16T17:06:31.077000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "we do not send NewBlockHashes to each peer",
        "created_at": "2020-11-16T17:11:35.652000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I would need to change that",
        "created_at": "2020-11-16T17:11:51.099000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ah wait",
        "created_at": "2020-11-16T17:12:03.438000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "we do",
        "created_at": "2020-11-16T17:12:04.563000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "are you connected now?",
        "created_at": "2020-11-16T17:12:57.291000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "with static peer list?",
        "created_at": "2020-11-16T17:13:01.553000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yep",
        "created_at": "2020-11-16T17:16:25.429000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "and I'm getting NewBlockHashes from you ðŸ™‚",
        "created_at": "2020-11-16T17:16:37.813000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "great",
        "created_at": "2020-11-16T17:20:36.809000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so close ðŸ™‚",
        "created_at": "2020-11-16T17:20:44.107000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "6000 nodes is 12 messages to Nethermind or 24 to Geth",
        "created_at": "2020-11-16T17:21:28.223000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "you guys wanna jump in the #witness voice channel?",
        "created_at": "2020-11-16T17:21:35.742000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "should take miliseconds to get the block ready",
        "created_at": "2020-11-16T17:21:41.310000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!364458974906548225\u003e I cannot now - I am on a Starkware workshop in parallel and it is all voice and video there",
        "created_at": "2020-11-16T17:22:12.356000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I can for the next 8 minutes only before the next session starts",
        "created_at": "2020-11-16T17:22:30.228000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "but I think I have disabled microphone in discord",
        "created_at": "2020-11-16T17:22:45.295000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "you wanted to celebrate? ðŸ˜„",
        "created_at": "2020-11-16T17:22:58.309000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "10... 9... 8...",
        "created_at": "2020-11-16T17:23:15.295000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(I'm probably just making things more complicated.  you two seemed to be figuring out things fine, you can ignore me)",
        "created_at": "2020-11-16T17:23:53.182000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "hhaha, yeah, it is all fine",
        "created_at": "2020-11-16T17:24:05.269000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I mean, we took our time",
        "created_at": "2020-11-16T17:24:16.685000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "but it will soon be working, I think",
        "created_at": "2020-11-16T17:24:36.066000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "just wonder how much time it will take us to implement the fetcher on our side",
        "created_at": "2020-11-16T17:24:50.218000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "but should be possible to have it ready by the end of this week too",
        "created_at": "2020-11-16T17:25:01.679000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the cool thing is that witness support seems to be super light on the server",
        "created_at": "2020-11-16T17:25:27.913000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "5000 * 32 bytes is 150k",
        "created_at": "2020-11-16T17:25:43.336000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it is a small message, negligible",
        "created_at": "2020-11-16T17:26:23.431000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!489256758989029405\u003e still can't connect reliably, though ðŸ˜¦",
        "created_at": "2020-11-16T18:15:46.505000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "sometimes it just disconnects from me during the handshake",
        "created_at": "2020-11-16T18:16:49.229000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "let me change the number of peers",
        "created_at": "2020-11-16T18:18:14.656000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "try now",
        "created_at": "2020-11-16T18:18:54.115000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "take it while it is free ðŸ™‚ 105/1024",
        "created_at": "2020-11-16T18:19:46.433000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "```\n   DEBUG  2020-11-16 19:55:03,903     BeamBlockImporter  Beam importing \u003cBlockHeader #11270874 0cdc0d24\u003e (239 txns, 12,451,758 gas) ...\n   DEBUG  2020-11-16 19:55:04,193     BeamBlockImporter  Missing 0 witnesses out of 5729 for block b'\\x0c\\xdc\\r$\\xed\"\\xcd\\xd03\\xc2T#\\x1a \\xc460i-\\xa9\\xa8\\xa6\\xfd\\x135\\xc1;\\xa3\\xff\\x7f(\\xd4'\n    INFO  2020-11-16 19:55:17,778         MuirGlacierVM  Block #11270874-0x0cdc..28d4 reads 5872 unique node hashes, 430 addresses, 184 bytecodes, and 931 storage slots\n```",
        "created_at": "2020-11-16T20:06:21.348000+00:00",
        "attachments": null
    },
    {
        "author": "guilhermesalgado9479",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We seem to be fetching all the trie nodes included in the witness hashes for a block, but when importing the block the VM is still pausing because of missing data. And from the reported reads at the end of the block import, it looks like the witness hashes collected by nethermind are incomplete?",
        "created_at": "2020-11-16T20:09:30.304000+00:00",
        "attachments": null
    },
    {
        "author": "jason.carver",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Hm, interesting, let's see if we can find any more about which pieces are missing. Bytecode? Accounts that are senders/recipients of transactions? Contract storage? Trie refactoring at state root calculation time? Intermediate nodes or leaf nodes?",
        "created_at": "2020-11-16T23:34:57.914000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Generally whatever is touched on the trie should be added:",
        "created_at": "2020-11-16T23:46:48.268000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "",
        "created_at": "2020-11-16T23:46:49.606000+00:00",
        "attachments": [
            {
                "type": "",
                "origin_name": "unknown.png",
                "content": "902021c6417e4dfa8146d1181ac24d3ff09e3ad1b4d9996e8d18df519451e32c"
            }
        ]
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ok, I know what may be missing",
        "created_at": "2020-11-16T23:48:39.251000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I bet it would be bytecodes",
        "created_at": "2020-11-16T23:48:51.790000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think we have an additional bytecode cache inside the EVM",
        "created_at": "2020-11-16T23:49:04.821000+00:00",
        "attachments": null
    }
]