[
    {
        "author": "marekm3498",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@628018527470616606\u003e  bring up an interesting topic about withdrawals during his review\n\nShould EL validate in any way these cases on their side? \nFrom the spec:\n`1. a monotonically increasing index, starting from 0, as a uint64 value that increments by 1 per withdrawal to uniquely identify each withdrawal\n2. a nonzero amount of ether given in wei as a uint256 value.`\nhttps://eips.ethereum.org/EIPS/eip-4895#specification\n\nDo other EL clients validate it in any way? \n\nThe most interesting scenario is amount == 0. The potential issue: we don't have an account, so if there is no validation, we could create the account and break the rules of EIP155. I guess, it is only possible in case of a bug in the CL client or a malicious peer could send it through the network.\n\nWdyt \u003c@425572898787426305\u003e \u003c@539495253418180618\u003e?",
        "created_at": "2023-01-05T12:36:24.478000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "My point of view is that this should be validated on EL side too.",
        "created_at": "2023-01-05T12:42:31.175000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I don't see any likely attack regarding these checks, the CL makes specifically those checks, so if any of these two is violated the block will be invalid anyway. It doesn't hurt to double check this, but I do not see how can an attacker leverage the lack of checking in the EL side",
        "created_at": "2023-01-05T14:29:06.390000+00:00",
        "attachments": null
    },
    {
        "author": "ethdreamer",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "cross-posting this from api's channel because it didn't seem to get eyes there:",
        "created_at": "2023-01-05T18:29:49.153000+00:00",
        "attachments": null
    },
    {
        "author": "ethdreamer",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "For the `engine_api`, the  `V2` methods are backwards compatible and can be called before the `Capella` fork.\n\nHowever for the `4844` fork, the proposal for `ExecutionPayloadV3` is **not** backwards compatible because `baseFeePerGas` is not optional.. this implies we must switch methods AT the fork..\nhttps://github.com/ethereum/execution-apis/blob/main/src/engine/experimental/blob-extension.md#executionpayloadv3",
        "created_at": "2023-01-05T18:30:54.371000+00:00",
        "attachments": null
    },
    {
        "author": "ethdreamer",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Should we aim to make each new method versions compatible with at least 2 forks so that we can always use the latest version available and deprecate old versions?",
        "created_at": "2023-01-05T18:31:25.672000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "During sync we are getting blocks from the network.",
        "created_at": "2023-01-05T19:14:51.296000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "FWIW, we switch AT the fork eitherway, so either system would work for us",
        "created_at": "2023-01-05T19:21:07.605000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "the EIP goes into detail here so that clients can leverage the invariants to help (at least plausibly) optimize storage and handling of the data, BUT there is no need for the EL to verify these conditions and so the EIP does not require that of implementers (the EIP _does_ state where implementers need to verify integrity, e.g. w/ the `withdrawals_root`)",
        "created_at": "2023-01-05T22:03:49.849000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "the EL _could_ check but it is redundant as the engine API is already a trusted endpoint",
        "created_at": "2023-01-05T22:04:12.278000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "you are trusting the CL to feed you verified data here, which is why it is safe to just apply the effects of the withdrawals and not care about the integrity of the data",
        "created_at": "2023-01-05T22:04:36.205000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "even in the syncing scenario, you are trusting the CL to provide some future head hash to target (that sets you up to sync along some chain you don't have yet) so it doesn't change the security model either",
        "created_at": "2023-01-05T22:05:13.018000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "i replied to you over there, i'm confused what you see as breaking w/ `baseFeePerGas`",
        "created_at": "2023-01-05T22:06:46.965000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "well it would change the result of the sync if we had a bad block along the chain, the target we got from CL can be a bad one",
        "created_at": "2023-01-05T22:38:44.506000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "as in you would sync and the heads would not match? or are you worried about the CL feeding you a bad hash in the first place?",
        "created_at": "2023-01-05T22:40:33.728000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "CL cannot be tricked here?",
        "created_at": "2023-01-05T22:40:50.124000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "i believe this is our trust model for the engine API",
        "created_at": "2023-01-05T22:41:04.742000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "otherwise the EL would just be hosed",
        "created_at": "2023-01-05T22:41:13.029000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I was forged in the `never trust your inputs` world ðŸ™‚",
        "created_at": "2023-01-05T22:41:40.657000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "which is fair but a CL could feed you a valid but _non-canonical_ head and the EL would not be able to know",
        "created_at": "2023-01-05T22:42:43.291000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "so you just have to trust it here and the withdrawals design was made under this assumption",
        "created_at": "2023-01-05T22:42:58.063000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "there isn't another way to do it if we have separation of the layers, really",
        "created_at": "2023-01-05T22:43:19.186000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "are there some cross-client tests for those scenarios on CL side? (like hive test on EL clients)",
        "created_at": "2023-01-05T22:44:25.732000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "which scenarios?",
        "created_at": "2023-01-05T22:45:49.781000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "there are tests for the CL that ensure all of the invariants for the withdrawal feature in the CL protocol",
        "created_at": "2023-01-05T22:46:11.509000+00:00",
        "attachments": null
    }
]