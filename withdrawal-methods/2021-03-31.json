[
    {
        "author": "dmitriishmatko",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I think it's a point of discussion how system contract mints money\n1. It transfers money\n2. It just adds balance like coinbase reward works\nWe need to weight up both approaches. In second case you don't need receive function. As it will be pull in both cases, I guess, you get the status of operation and pay all gas when pulling in both cases",
        "created_at": "2021-03-31T10:38:48.606000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "It's difficult to get any beaconstate data from eth1, so withdrawal function will need to verify withdrawal data without actual access to it, so I guess we need input like that https://github.com/zilm13/SerenityPool/blob/b1715455bf8f96a31944f1935c7bb639942ac80e/contracts/SystemContract.sol#L45",
        "created_at": "2021-03-31T10:41:22.608000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "it uses open data from BeaconState and requires only beaconblockroot verification, which is done by appropriate opcode",
        "created_at": "2021-03-31T10:42:28.320000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@!543760088993890334\u003e what's your preference between 2 approaches?",
        "created_at": "2021-03-31T10:47:34.462000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "To keep the accountancy sane, the ETH1 chain should remove 32 Ether from the deposit contract address and mint the rewards.",
        "created_at": "2021-03-31T11:13:29.367000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "If/When we have several options for deposit/withdrawal it could make a mess. Also deposit contract is final.",
        "created_at": "2021-03-31T11:16:19.217000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Anyway it's a good point to keep in mind",
        "created_at": "2021-03-31T11:16:43.013000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I think it will be better to burn deposits on arrival when there is enough trust on all of it",
        "created_at": "2021-03-31T11:22:26.035000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "And it's more clear as these money are in BeaconState just after deposit",
        "created_at": "2021-03-31T11:23:10.820000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "It will be possible after merge when we have eth1 as application shard with single finalized fork",
        "created_at": "2021-03-31T11:53:33.529000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "If we can burn deposits (actually burn, rather than send to an arbitrary address) that would make things easier.",
        "created_at": "2021-03-31T11:57:51.150000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "you mean some opcode instead of deposit contract?",
        "created_at": "2021-03-31T11:58:56.672000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Guess so, yes.  Otherwise we're in the situation where a simple \"total supply\" calculation of summing all of amounts held be each address across mainnet will end up with increases every time someone withdraws.",
        "created_at": "2021-03-31T12:01:26.239000+00:00",
        "attachments": null
    },
    {
        "author": "dkdkdkdkdkdk",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "does \"total supply\" include ETH sent to 0x0000000000000000000000000000000000000000?",
        "created_at": "2021-03-31T13:15:15.592000+00:00",
        "attachments": null
    },
    {
        "author": "tsudmi",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I think the second one is more agnostic to the amount of gas passed to the withdrawal address.\nThe `transfer` call here https://github.com/zilm13/SerenityPool/blob/b1715455bf8f96a31944f1935c7bb639942ac80e/contracts/SystemContract.sol#L69 won't work for the contracts that have some additional logic in `receive` function. It passes only 2300 gas and that's only enough for emitting event.\nIf we want to be able to pass an arbitrary amount of gas to the withdrawal address, it's better to use `call`:\n```\n(bool success, ) = targetPayable.call{ value: _withdrawal.amount * GWEI }(\"\");\nrequire(success, \"Withdrawal has failed\");\n```",
        "created_at": "2021-03-31T14:07:32.106000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yeah, I know about 2300 gas, it's just an option of implementation. Actually with mint by (2) approach there will not be such line anywhere",
        "created_at": "2021-03-31T17:26:35.142000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I'm just trying the simplest solution to mix things together",
        "created_at": "2021-03-31T17:28:20.566000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Actually it will not help much if you have one withdrawal address for several validators",
        "created_at": "2021-03-31T17:42:09.681000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "But transfer can force to keep withdrawal contracts small as you will need dedicated contract for every validator in network",
        "created_at": "2021-03-31T17:43:42.179000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I had a task to think this out and you remembered me",
        "created_at": "2021-03-31T17:49:47.561000+00:00",
        "attachments": null
    }
]