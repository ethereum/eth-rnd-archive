[
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "that bit i get üôÇ if we make it named in that way, then we store the next one due to look at, then we can set it to 0 initially and have it process 0\nbasically the pre-increment vs. post-increment discussion",
        "created_at": "2022-11-10T01:35:18.975000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "yeah I do not like that",
        "created_at": "2022-11-10T01:35:39.740000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "but I won't fight over that",
        "created_at": "2022-11-10T01:35:45.835000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "given its pre-increment vs. post increment im not going ot aruge either way, it's just semantics imo",
        "created_at": "2022-11-10T01:36:07.359000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "well, in this particular case it means the beacon state holds the latest validator that withdrew, vs the next validator that we will try to see if it withdraws.",
        "created_at": "2022-11-10T01:36:44.816000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "literally yep",
        "created_at": "2022-11-10T01:36:55.419000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I believe the former is an epsilon more clear",
        "created_at": "2022-11-10T01:37:09.440000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "but it doesn't really matter",
        "created_at": "2022-11-10T01:37:17.108000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "as long as its named either your way for what we do now, or we use next for the other method, i find it relatively clear",
        "created_at": "2022-11-10T01:37:45.794000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "advantage of latest imo is its what we've actually done, as opposed to expressing a desire for what to do next",
        "created_at": "2022-11-10T01:38:50.941000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "so latest to me is probably better in some ways, as we apply the modulo when we set the loop index, rather than when we figure out the next one... but again, its not something i've got strong opinions on",
        "created_at": "2022-11-10T01:39:45.842000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "i suspect if someone actually has a strong opinion it will win this argument üôÇ",
        "created_at": "2022-11-10T01:41:26.955000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@340345049063882753\u003e is always good with opinions... üòÑ",
        "created_at": "2022-11-10T01:41:49.629000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Eh. Next, last, whatever. It‚Äôs easy to write tests to make sure it‚Äôs handled right so it‚Äôs not something that‚Äôs going to cause issues I don‚Äôt think.",
        "created_at": "2022-11-10T01:57:15.560000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "... if even Adrian doesn't care i'm out of strongly opinionated people to ask üôÇ",
        "created_at": "2022-11-10T01:58:07.385000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "actually looking at the code, it looks like `next_withdrawal_index` is the nonce, which is a little confusing i guess",
        "created_at": "2022-11-10T03:09:13.407000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I'm catching up on the withdrawals devnet plans! I understand there's talks of a new devnet starting soon, I'm wondering if there's hard/firm/soft consensus on (a) when and (b) queued/queueless.\n\nI see a bit of a conundrum where we only have tests for queued (AFAIK), however queued is all but antiquated. It seems like we'd be losing ground by honing our queueless implmentation, just to throw it out. It also seems like a doomed plan to start an interop net without consensus tests (been there, done that).",
        "created_at": "2022-11-10T04:13:21.340000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "we won't be ready to participate in a testnet starting without Potuz's PR... we're moving forward on the basis of it being what is going to be broadly accepted, and haven't got support for 1.3.0-alpha.0 version of withdrawals",
        "created_at": "2022-11-10T04:14:42.256000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "if its not a fair assumption would be worth shouting as we're not far down the rabbit hole thus far üôÇ",
        "created_at": "2022-11-10T04:16:31.802000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "We have 1.3.0-alpha.0 but it never got to the stage of running against consensus tests before it was abandoned in favour of queueless. So, we effectively don't have 1.3.0-alpha.0 either.\n\nWe could be ready for a devnet next week with queueless, however I do recall us consensus devs swearing never again to interop without consensus tests.",
        "created_at": "2022-11-10T04:17:20.826000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "we're possibly not far off that, hard to tell without the state ref tests if i've broken something else üòÑ",
        "created_at": "2022-11-10T04:18:09.090000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "It seems like Prysm is team-queueless as well: https://discord.com/channels/595666850260713488/1031999860997619843/1040112926087979149",
        "created_at": "2022-11-10T04:18:52.526000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "yep i think they're all in, so does seem like we should just press merge already üòÑ",
        "created_at": "2022-11-10T04:19:30.260000+00:00",
        "attachments": null
    },
    {
        "author": "philngo",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@792822129019584562\u003e already implemented the queue, but after the last consensus call we seemed have have consensus on queueless so he started on the queueless implementation here: https://github.com/ChainSafe/lodestar/pull/4730",
        "created_at": "2022-11-10T04:20:18.340000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I understand that \u003c@360491619402776577\u003e has been hungry for a devnet. It seems sensible to me to get spec tests running before we do that. Otherwise we're wasting devops cycles and embarrassing ourselves.\n\nPerhaps \u003c@415109946682769408\u003e has some ideas on when we might see tests? üôè",
        "created_at": "2022-11-10T04:23:03.172000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "it'd certainly give a lot more confidence",
        "created_at": "2022-11-10T04:24:30.560000+00:00",
        "attachments": null
    },
    {
        "author": "terence0083",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "From the 4844 implementer's call, Danny said it's on track to be merged today or tomorrow, I think we are almost there! ü§û",
        "created_at": "2022-11-10T04:33:32.339000+00:00",
        "attachments": null
    },
    {
        "author": "philngo",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I don't know where this message ( https://twitter.com/vdWijden/status/1589931437507379204) from \u003c@360491619402776577\u003e and \u003c@412614104222531604\u003e is located, but a testnet is already in the works for today. \u003c@792822129019584562\u003e already did a small interop with lodestar-nethermind and lodestar-ethereumjs.",
        "created_at": "2022-11-10T05:01:16.384000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yes, we tested interop between lodestar, prysm, geth, nethermind and ethereumjs",
        "created_at": "2022-11-10T07:43:31.992000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "How did you test Nethermind? I've been trying for the last 3 days to do interop with it and I can't merge cause I can't get a single block. I don't know how to configure the genesis state of the clique network or there is some other configuration issue",
        "created_at": "2022-11-10T08:57:32.288000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@758579010027782144\u003e ran my test vector against nethermind",
        "created_at": "2022-11-10T09:03:33.374000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Ah oh, that's a different kind of interop then üôÇ",
        "created_at": "2022-11-10T09:10:52.357000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "lodestar is interoping one o one with geth/ethereumjs/nethermind : check the CI run: https://github.com/ChainSafe/lodestar/actions/runs/3430273795/jobs/5717025529",
        "created_at": "2022-11-10T09:27:39.830000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "this section in particular",
        "created_at": "2022-11-10T09:28:22.674000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "066c6fe073e30ecade6a10e1f2eff976726b997f0d01a54d4785bc1d2017fed6"
            }
        ]
    },
    {
        "author": "marekm3498",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Moreover, \u003c@792822129019584562\u003e ran full interop with Nethermind üòâ \u003c@755590043632140352\u003e I was off, but I hope I will catch with Nethermind \u003c\u003e prysm problems soon",
        "created_at": "2022-11-10T09:28:54.002000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "every test is of two sections : part 1. is api stub part 2: is local interop 1:1",
        "created_at": "2022-11-10T09:29:00.224000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "this is the genesis: https://github.com/ChainSafe/lodestar/pull/4730/files#diff-edfae525f6b358cbc50a415e876dfac294152748a0f5f0916f5a50263502ade0 ( \u003c@758579010027782144\u003e has coded an equivalent genesis in this `nethermindeth/nethermind:withdrawals_yolo` image",
        "created_at": "2022-11-10T09:31:20.843000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "We can't start with a merged state, so I need nevermind to start mining to merge before",
        "created_at": "2022-11-10T09:31:39.840000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "yes these are are post merge genesis tests",
        "created_at": "2022-11-10T09:31:56.259000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Surely this is a configuration issue unrelated to capella",
        "created_at": "2022-11-10T09:31:56.951000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@755590043632140352\u003e whats going on with the next vs latest for validator index? because from the look of current diff of the PR, it looks the same to me",
        "created_at": "2022-11-10T09:36:51.552000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "i.e it would start the first probe from 1 than 0, despite rearranging the validator_index assignment",
        "created_at": "2022-11-10T09:37:26.634000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "( i seem to have missed all the action on this üòÜ )",
        "created_at": "2022-11-10T09:37:58.887000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "oh yeah, I really did think that Danny and Alex were asking to just rename the variables. Starting the sweep from zero requires a semantics change on the beacon state stored index: from \"the last validator that withdrew\", to \"the next validator we will start sweeping from\", which I don't particularly like. The next withdrawal index is really the next one. I guess If I had an order to choose would be",
        "created_at": "2022-11-10T09:40:33.474000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "1- Name them both last (if we really want symmetry) and also start withdrawals from 1 (so withdrawals[0] does not exist, this is not nice)\n2- Name withdrawals next, and validator index last as it was before \n3- name them both next. \nBut whatever choice here is really something that I consider completely irrelevant so we should merge whatever is chosen and that's it. I think Danny is going to write a change for 3)  today, I can do it today too otherwise.",
        "created_at": "2022-11-10T09:42:57.652000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "yea , 3 looks fine to me but as you observed its not really a  big deal",
        "created_at": "2022-11-10T09:44:43.798000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "so lets just choose and go üöÄ",
        "created_at": "2022-11-10T09:45:10.572000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Ok, I'm going to fix tests in my specs branch and push that. I think \u003c@291925846556540928\u003e is doing this on purpose to punish us for changing this while he was on vacations. I'll have to change prysm's implementation that already implemented the \"last_validator_index\" logic and is merged in develop üò¶",
        "created_at": "2022-11-10T11:05:05.581000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "whats the new name?: next_validator_index?",
        "created_at": "2022-11-10T11:07:57.223000+00:00",
        "attachments": null
    },
    {
        "author": "hsiaowei",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yes, I'm keen to merge Potuz's PR asap and rebase 4844 PR  ü•π",
        "created_at": "2022-11-10T12:31:00.528000+00:00",
        "attachments": null
    },
    {
        "author": "hsiaowei",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I can provide test vector tarballs without 4844 clean-ups once the PR#3068 is merged",
        "created_at": "2022-11-10T12:34:18.764000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I think the PR is ready, i pushed the changes that Danny was requesting, I'm not sure if he agrees on the issue of the tests already covering balance changes on epoch transition, perhaps he wants something more explicit",
        "created_at": "2022-11-10T14:04:34.593000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "The testvectors may need to be fixed to check that no validator is in active duties when fully withrawing",
        "created_at": "2022-11-10T14:05:26.140000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "i think it is possible to be in a sync committee while withdrawable",
        "created_at": "2022-11-10T14:18:05.700000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Not fully withrawable",
        "created_at": "2022-11-10T14:35:06.130000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Hmm, need to check the queue sizes and the spec actually üò¶",
        "created_at": "2022-11-10T14:37:31.602000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "nah, I don't think it's possible to be in a committee",
        "created_at": "2022-11-10T14:45:00.689000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "validators in the committee are taken from the active validator set, and the MIN_VALIDATOR_WITHDRAWABILITY_DELAY is 256 epochs",
        "created_at": "2022-11-10T14:46:01.913000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "i will also double-check",
        "created_at": "2022-11-10T14:46:30.166000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "you can't be in a sync comittee once exited...",
        "created_at": "2022-11-10T21:26:48.283000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "You can if you were scheduled to be in the committee before you exited (and if the exit queue is less than 2 days).",
        "created_at": "2022-11-10T21:41:49.072000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "..so basically we're relying on the withdrawal delay, but that's still plenty right?",
        "created_at": "2022-11-10T21:42:55.442000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "i had a quick look, will dig more",
        "created_at": "2022-11-10T21:43:33.284000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Just to keep information in one place: Danny noticed that the next sync committee is decided two periods in advance",
        "created_at": "2022-11-10T22:50:20.853000+00:00",
        "attachments": null
    }
]