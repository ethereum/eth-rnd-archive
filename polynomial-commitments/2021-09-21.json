[
    {
        "author": ".vbuterin",
        "category": "Cross-layer",
        "parent": "",
        "content": "You first figure out (i) how many **branches**, and (ii) how many **leaves** a witness in a block accesses.  Nodes that are in the same **suffix tree** (where the address and tree index are the same; see here https://notes.ethereum.org/@vbuterin/verkle_tree_eip#Header-values for the functions to calculate the address and tree index of different header/code/storage fields) only require a leaf for each node, and for every unique suffix tree you need a branch.\n\nTo convert the (branch count, leaf count) into a witness size, it depends on whether you want the average case or worst case number. In both cases, a leaf is 31 bytes. For average case length, you want:\n\n ```python\nfrom math import log\ndef get_average_case_length(branch_count: int, leaf_count: int, tree_size: int) -\u003e int:\n    return (\n        branch_count * (log(tree_size) - log(branch_count)) / log(256) +\n        leaf_count\n    ) * 32\n```\n\nFor worst case length, you want:\n\n```python\ndef get_worst_case_length(branch_count: int, leaf_count: int, tree_size: int) -\u003e int:\n    return (\n        branch_count * (log(2**160 / branch_count) - log(branch_count)) / log(256) +\n        leaf_count\n    ) * 32\n```",
        "created_at": "2021-09-21T06:50:52.236000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Cross-layer",
        "parent": "",
        "content": "Note that the worst case requires an attacker willing to burn 2**80 computational power, split equally among generating `branch_count` almost-160-bit collisions, to produce a worst case witness, so it's quite unrealistic.",
        "created_at": "2021-09-21T06:55:13.160000+00:00",
        "attachments": null
    }
]