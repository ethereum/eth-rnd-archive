[
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@\u0026602872761743835146\u003e was there a decision on whether to allow custom nonce schemes or to continue using a standard protocol-defined nonce?",
        "created_at": "2020-04-29T19:34:21.540000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Well, protocol-defined nonces limit the functionality (you have to re-send your tx every time someone else interacts with the AA contract before you, using \"your\" nonce)",
        "created_at": "2020-04-29T19:35:36.271000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Agreed, but I'm afraid that it will be difficult to differentiate between free \"nonce calculations\" and free \"dapp-specific\" calculations. The latter of which is definitely unacceptable as you could design a smart contract which runs at no cost by executing in the prologue of the tx.",
        "created_at": "2020-04-29T19:38:36.726000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Why would they be free?",
        "created_at": "2020-04-29T19:38:53.327000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yes, I also don't see why that would be free",
        "created_at": "2020-04-29T19:39:06.373000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The abstracted account still has to pay for gas before `PAYGAS`",
        "created_at": "2020-04-29T19:39:11.333000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Oh disregard then, I was thinking that the SSTOREs before `PAYGAS` wouldn't be reverted",
        "created_at": "2020-04-29T19:39:48.196000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "it counts both towards the gas limit before tx validation is aborted and for the gas consumption you have to pay for if your tx makes it into a block",
        "created_at": "2020-04-29T19:39:48.568000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "They wouldn't be reverted, but they also get paid for.",
        "created_at": "2020-04-29T19:40:16.110000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But they would be reverted in the case of an invalid tx",
        "created_at": "2020-04-29T19:40:31.843000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "in that case it never even makes it into a block",
        "created_at": "2020-04-29T19:40:44.440000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "true, okay I'm on the same page now",
        "created_at": "2020-04-29T19:41:07.850000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So either you pay for the `SSTORE` or it has no observable effects.",
        "created_at": "2020-04-29T19:41:11.571000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The question of protocol-defined nonce vs contract-defined nonce is still relevant in the context of tx hash uniqueness, as a protocol-defined nonce would be the primary way to enforce unique hashes",
        "created_at": "2020-04-29T19:42:50.234000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But I think we agreed to only deal with that question after we have a first working AA prototype.",
        "created_at": "2020-04-29T19:43:32.778000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "üëç",
        "created_at": "2020-04-29T19:44:44.496000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!689161464829050960\u003e what are the inputs to `PAYGAS`?",
        "created_at": "2020-04-29T19:47:04.117000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The gas price, I believe",
        "created_at": "2020-04-29T19:47:22.552000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "if a tx is determined invalid, should it issue a `STOP` or `REVERT`?",
        "created_at": "2020-04-29T19:48:32.144000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think `REVERT` would be more appropriate",
        "created_at": "2020-04-29T19:49:26.055000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But I don't think it matters since the tx doesn't end up in a block either way.",
        "created_at": "2020-04-29T19:49:47.389000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ah, you mean which ones AA contracts should use if they want to reject a tx? We might want to have a canonical way to do that, but in the end anything that does not call `PAYGAS` has that effect it seems.",
        "created_at": "2020-04-29T19:53:15.224000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "```\n00: JUMPDEST\n01: JUMP 00\n```",
        "created_at": "2020-04-29T19:53:55.784000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Definitely the canonical way to revert.",
        "created_at": "2020-04-29T19:54:13.858000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "haha",
        "created_at": "2020-04-29T19:54:17.495000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "see, that raises a question: is there any way to incentivize AA contracts to reject invalid txs as quickly as possible?",
        "created_at": "2020-04-29T19:54:59.157000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That's a scary question. Unask it immediately.",
        "created_at": "2020-04-29T19:55:30.240000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "because for the node potentially being DOSed with invalid txs that can make quite a difference",
        "created_at": "2020-04-29T19:55:57.057000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "even though of course in the worst case contracts might always use up all the validation gas, that's what the limit is for...",
        "created_at": "2020-04-29T19:56:29.987000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "You could add a tiny fee per instruction before `PAYGAS` that doesn't get reverted? :/",
        "created_at": "2020-04-29T19:56:32.370000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "No, actually, you can't.",
        "created_at": "2020-04-29T19:56:46.439000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "haha, I assume that is a joke?",
        "created_at": "2020-04-29T19:56:47.579000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ah",
        "created_at": "2020-04-29T19:56:49.100000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "üòâ",
        "created_at": "2020-04-29T19:56:51.241000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Nope, just me being dumb.",
        "created_at": "2020-04-29T19:56:57.976000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "btw, feels like we could use a hackmd where we collect open questions (and thoughts around them)",
        "created_at": "2020-04-29T19:57:48.303000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "how about `0x3373ffffffffffffffffffffffffffffffffffffffff14601e57600080fd5b60003515602a57600080fd5baa1` for a minimal AA bytecode?",
        "created_at": "2020-04-29T20:00:36.569000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "hm?",
        "created_at": "2020-04-29T20:01:37.616000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "wait hold on",
        "created_at": "2020-04-29T20:02:07.078000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think that's a bit more than minimal",
        "created_at": "2020-04-29T20:02:11.695000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think we should clearly distinguish between the \"canonical AA bytecode\" at the beginning of every AA contract and the bytecode for a minimal example AA contract",
        "created_at": "2020-04-29T20:02:21.363000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "okay `0x3373ffffffffffffffffffffffffffffffffffffffff14601e57600080fd5b60003515602a57600080fd5b60008055aa`",
        "created_at": "2020-04-29T20:03:12.178000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "wouldn't we include the prelude mentioned in vitalik's post?",
        "created_at": "2020-04-29T20:03:29.572000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "wait, so I think we should take a step back and give some context for non-quilt members",
        "created_at": "2020-04-29T20:03:48.903000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "we have designed a prototype of this prefix",
        "created_at": "2020-04-29T20:04:14.246000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "which is\n`0x3373ffffffffffffffffffffffffffffffffffffffff14601e57600080fd5b`",
        "created_at": "2020-04-29T20:05:04.309000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "here an illustration of what that means in opcodes",
        "created_at": "2020-04-29T20:06:29.080000+00:00",
        "attachments": [
            {
                "type": "",
                "origin_name": "Screenshot_2020-04-29_at_22.05.51.png",
                "content": "f96150d03ea2138a8357b02fd5340083830a3392c1a797befbab1f9c6fca8a2e"
            }
        ]
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "basically check if the contract is called from the AA entrypoint, revert if that is not the case",
        "created_at": "2020-04-29T20:06:53.058000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e I that's a bit more than minimal\nimo this includes the 3 things we care about i) verifying it is an AA tx via the prelude ii) validity relying on the user `calldata[0..32] == 0` and iii) performing a state change (updating a nonce) that should be discarded from the state if the transaction does not pay gas",
        "created_at": "2020-04-29T20:07:08.657000+00:00",
        "attachments": null
    },
    {
        "author": "will7466",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\"that should be discarded from the state if the transaction does not pay gas\" - does this need to be defined if the tx wouldn't be included anyways?",
        "created_at": "2020-04-29T20:23:57.236000+00:00",
        "attachments": null
    },
    {
        "author": "will7466",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e \u003c@\u0026602872761743835146\u003e was there a decision on whether to allow custom nonce schemes or to continue using a standard protocol-defined nonce?\n\u003c@!543900561460822016\u003e - fyi custom nonce gives us the cron support defined in the planning doc - https://hackmd.io/y7uhNbeuSziYn1bbSXt4ww?both.  I think we prefer this direction, but lets just get the data and see.",
        "created_at": "2020-04-29T20:28:09.752000+00:00",
        "attachments": null
    }
]