[
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e so in the first version, mempools would simply not keep pending transactions to a contract like this, precisely because that would necessitate this constant re-validation.\n\u003c@!415548822983278593\u003e What about this contract makes in ineligible for the mempool?",
        "created_at": "2020-09-23T02:26:52.146000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!415548822983278593\u003e Hmm, thinking on this more I think that maybe all of the stuff not about consensus should be moved to ## Security Considerations.",
        "created_at": "2020-09-23T03:56:56.559000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This would make the spec much simpler I believe, and there doesn't need to be any consensus on the pending pool stuff really it is just a \"hey, when implementing this be careful of these things\".",
        "created_at": "2020-09-23T03:57:28.018000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e I have a smart wallet that I personally think everyone with large amounts of money should use (or use something with a similar feature set).  It currently won't work with AA due to the lack of access to timestamp, and the inability to call it from another contract castrates some of its usefulness, and it won't be able to do things like Uniswap flash loans, nor receive ERC-223 tokens.\nMoving conversation from https://discordapp.com/channels/595666850260713488/746566142700814426/758194014079549461",
        "created_at": "2020-09-23T05:13:40.800000+00:00",
        "attachments": []
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "How does your wallet use timestamp now?",
        "created_at": "2020-09-23T05:13:54.427000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Wallet has time-delayed recovery from owner to backup address.",
        "created_at": "2020-09-23T05:14:36.429000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The idea is if you lose the primary signer, you can initiate a recovery that uses block.timestamp to enforce a time-delay on recovery.",
        "created_at": "2020-09-23T05:16:13.632000+00:00",
        "attachments": []
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hm... Can you sign a message from the backup address? If so, you could check the signature before paygas and check the timestamp after.",
        "created_at": "2020-09-23T05:16:48.761000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Start Recovery: \u003chttps://github.com/Zoltu/recoverable-wallet/blob/master/contracts/source/recoverable-wallet.sol#L204\u003e\nEnd Recovery: \u003chttps://github.com/Zoltu/recoverable-wallet/blob/master/contracts/source/recoverable-wallet.sol#L225\u003e",
        "created_at": "2020-09-23T05:17:21.512000+00:00",
        "attachments": []
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The wallet would have to pay gas though, so maybe destroy the backup if the expiry hasn't been tripped though",
        "created_at": "2020-09-23T05:17:23.554000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ü§î",
        "created_at": "2020-09-23T05:17:43.404000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I have to assume that anything done prior to checking that timestamp is an *attack*.",
        "created_at": "2020-09-23T05:18:05.926000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That may not be a problem...",
        "created_at": "2020-09-23T05:18:31.189000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Well, it would mean that an attacker could burn all of my ETH via gas spends though.  üò¢",
        "created_at": "2020-09-23T05:18:46.371000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Since the contract pays gas, if an attacker acquires one of my backup keys they could then just spam the network with insane gas price transactions (perhaps they run a miner and benefit from that).",
        "created_at": "2020-09-23T05:19:23.132000+00:00",
        "attachments": []
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah, that's why I said `maybe destroy the backup if the expiry hasn't been tripped though`",
        "created_at": "2020-09-23T05:19:39.342000+00:00",
        "attachments": []
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I don't think I understand the recovery flow though ^^;;",
        "created_at": "2020-09-23T05:20:00.276000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I don't think I want that because one can imagine a legitimate mistake where you called finish recovery too early.",
        "created_at": "2020-09-23T05:20:24.375000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And burning the recovery key could render the account unrecoverable.",
        "created_at": "2020-09-23T05:20:31.566000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Readme here has a high level description of the wallet, a bit verbose but not too bad if you want to understand it better: \u003chttps://github.com/Zoltu/recoverable-wallet\u003e",
        "created_at": "2020-09-23T05:21:01.328000+00:00",
        "attachments": []
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah, okay, I get it now.",
        "created_at": "2020-09-23T05:21:30.137000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I could put the backup key on cooldown, but again I would need a way of releasing that cooldown (which again would require access to timestamp).",
        "created_at": "2020-09-23T05:21:40.863000+00:00",
        "attachments": []
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So if attacker starts the recovery process using a backup key, and the original key cancels the recovery and provides a new backup key, removing the compromised one?",
        "created_at": "2020-09-23T05:22:24.899000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah.",
        "created_at": "2020-09-23T05:22:32.327000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But the primary may not notice the recovery was started for hours/days/weeks/months (plenty of time to drain ETH to gas fees).",
        "created_at": "2020-09-23T05:23:12.547000+00:00",
        "attachments": []
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "You can mark the recovery as in-progress before paygas",
        "created_at": "2020-09-23T05:23:36.532000+00:00",
        "attachments": []
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And check it too",
        "created_at": "2020-09-23T05:23:55.915000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That one transaction to initiate recovery could set gas price to a billion.",
        "created_at": "2020-09-23T05:23:57.845000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ü§î Actually, I guess this is a general problem with this mechanism.",
        "created_at": "2020-09-23T05:24:24.299000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think I *need* someone else to pay for gas for recovery initiation.",
        "created_at": "2020-09-23T05:24:33.414000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Currently, that falls out naturally due to how contract wallets work.  With a switch to AA, I would need to ensure that recovery gas is paid for by *someone else*.",
        "created_at": "2020-09-23T05:25:07.997000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Which means I need recovery to be an internal transaction, not a root AA transaction.",
        "created_at": "2020-09-23T05:25:21.887000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Which brings us back to the block on all internal transactions being problematic for me.  üôÇ",
        "created_at": "2020-09-23T05:25:50.138000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The more I think on this, I think I actually don't need `TIMESTAMP` but I do need internal transactions allowed.",
        "created_at": "2020-09-23T05:26:25.275000+00:00",
        "attachments": []
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We _do_ have a plan for internal transactions, but it's more complicated.",
        "created_at": "2020-09-23T05:26:59.962000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think something that would help sell me personally on AA v1 is providing a list of real world use cases that we think are enabled.  A multisig is one example, but I'm not convinced that it alone is worth the effort of AA.",
        "created_at": "2020-09-23T05:27:52.304000+00:00",
        "attachments": []
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'll think about that a bit. The time based recovery is a problem for sure.",
        "created_at": "2020-09-23T05:28:40.013000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I understand that my personal preferred strategy may not be supported in v1 of AA.  I'm just concerned that with callbacks and such (e.g., ERC-223) we aren't really gaining much.",
        "created_at": "2020-09-23T05:31:16.547000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That is, someone can have a multisig, but they'll need to still have a *separate* contract that stores at least some of their assets.",
        "created_at": "2020-09-23T05:31:28.331000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "At which point I feel like we aren't making much ground with AA in that case.",
        "created_at": "2020-09-23T05:31:48.410000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And you wouldn't be able to do stuff like flash loans directly with your contract, you would again need a *separate* contract for that.",
        "created_at": "2020-09-23T05:32:13.469000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Another factor in my bearish stance on AA is that it is semi-competing with Rich Transactions.  Rich transactions solves most of the same problems that full AA solves, *except* for contract pays gas and alternative signature types.  I am concerned that AA may never get past phase 1 (single tenant, heavily restricted) and if that is the case then I think Rich Transactions are generally a better solution to most of those problems at which point I'm not convinced AA is worth it for contract-pays-gas and alternative signature types on a very small subset of use cases.",
        "created_at": "2020-09-23T05:45:03.215000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Perhaps someone could convince me that there is a clear path to relieving the restrictions on AA?  At the moment I feel like AA only works *because of* those restrictions, and removing them is an as-of-yet unsolved problem which means in my mind AA is still an unsolved problem and this initial release doesn't really get us meaningfully closer to having that problem solved.",
        "created_at": "2020-09-23T05:48:29.254000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e Wallet has time-delayed recovery from owner to backup address.",
        "created_at": "2020-09-23T05:57:03.474000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "You can still use TIMESTAMP in contract wallets!",
        "created_at": "2020-09-23T05:57:11.916000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "You just need to have it be after PAYGAS",
        "created_at": "2020-09-23T05:57:44.994000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If we want to make it be before PAYGAS, there *are* ways of doing it, eg. a `EXPECT_TIMESTAMP_AT_LEAST` opcode that throws if the timestamp is below some value would be secure",
        "created_at": "2020-09-23T05:58:30.013000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "(so basically the same as CLTV in bitcoin üòõ )",
        "created_at": "2020-09-23T06:00:26.249000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "BTW another option we could take is to try to stick AA into RT. Basically, allow two transactions where the second depends on the first, the first does the signature verification, and the second does the operations (perhaps the output of the first could feed into the second, so the signature would only authorize a specific operation)",
        "created_at": "2020-09-23T06:04:51.246000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "though even with that approach, you'd need the same guards to prevent dos issues, ok so nvm I doubt that would be a net simplification",
        "created_at": "2020-09-23T06:05:22.619000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e If we want to make it be before PAYGAS, there *are* ways of doing it, eg. a `EXPECT_TIMESTAMP_AT_LEAST` opcode that throws if the timestamp is below some value would be secure\n\u003c@!273808422753796097\u003e Expanding further on this, any opcode of the form \"unless some environmental condition that once satisfied never becomes un-satisfied is true, throw\" is safe",
        "created_at": "2020-09-23T06:06:33.275000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Because once a transaction has been verified, it stays valid",
        "created_at": "2020-09-23T06:06:41.850000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This is basically the bitcoin philosophy",
        "created_at": "2020-09-23T06:06:46.680000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "btw I do think that we are going to end up grafting some aspects of bitcoin-ism onto ethereum over time; there really are efficiencies that you can get from a dependency-satisfaction coding model",
        "created_at": "2020-09-23T06:12:38.665000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "https://ethresear.ch/t/adding-cross-transaction-bls-signature-aggregation-to-ethereum/7844",
        "created_at": "2020-09-23T06:12:48.461000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "^ is the other big example of this",
        "created_at": "2020-09-23T06:12:52.532000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The \"once valid, cannot become invalid\" is the bit that I think is problematically restricting.",
        "created_at": "2020-09-23T07:50:40.838000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I am eager to be proven wrong and that there are useful contract wallets one could build that can work with that restriction.",
        "created_at": "2020-09-23T07:51:52.878000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Though I really do think there needs to be a way to accept callbacks.  Maybe a flag on storage slots that are \"only mutable when tx.origin == this\" or something?",
        "created_at": "2020-09-23T07:52:37.275000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "What do you mean by callbacks?",
        "created_at": "2020-09-23T08:58:44.499000+00:00",
        "attachments": []
    },
    {
        "author": "rimeissner",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "e.g. the ERC1155TokenReceiver (https://eips.ethereum.org/EIPS/eip-1155)",
        "created_at": "2020-09-23T09:00:01.153000+00:00",
        "attachments": []
    },
    {
        "author": "rimeissner",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the same exists for ERC721 (but there you have the alternative to go around it by using an \"unsafe\" method)",
        "created_at": "2020-09-23T09:00:28.911000+00:00",
        "attachments": []
    },
    {
        "author": "rimeissner",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the safe for example had issues with this in the beginning when using the ENS manager, as the interface uses the `safeTransfer`  method of ERC721 and that requires the callback implementation on the receiver. The safe contracts did not implement this in the beginning and therefore could not receive the ens token.",
        "created_at": "2020-09-23T09:02:56.692000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Anything that does `msg.sender.call(...)` essentially (which is a surprisingly common pattern).",
        "created_at": "2020-09-23T09:05:53.561000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Or anything that does `destination.call(...)`.",
        "created_at": "2020-09-23T09:06:08.275000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ah, so self-calling",
        "created_at": "2020-09-23T09:06:14.092000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "In the latter case, it happens when you are the recipient of some token.",
        "created_at": "2020-09-23T09:06:23.449000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "hmm, that's easy to make an exception for",
        "created_at": "2020-09-23T09:06:24.546000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The *token contract* tries to call into the receiver before executing the transfer.",
        "created_at": "2020-09-23T09:06:42.819000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e The *token contract* tries to call into the receiver before executing the transfer.\n\u003c@!301186049323958275\u003e Oh I definitely think that's a bad pattern",
        "created_at": "2020-09-23T09:06:54.525000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Feels like a re-entrancy minefield at the least",
        "created_at": "2020-09-23T09:07:00.531000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think the `msg.sender.call(...)` pattern can be worked around.  I'm less confident there is a clean workaround for the receiver callback.",
        "created_at": "2020-09-23T09:07:06.128000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e Feels like a re-entrancy minefield at the least\n\u003c@!273808422753796097\u003e It was designed so token semantics matched ETH semantics.  üôÇ",
        "created_at": "2020-09-23T09:07:18.662000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So if you believe ETH transfers are a minefield for re-entrancy, then yes.  üòÅ",
        "created_at": "2020-09-23T09:07:35.276000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Oh I certainly wish the whole \"2300 gas upon receiving ETH\" thing could crash and burn üòÜ",
        "created_at": "2020-09-23T09:07:50.213000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We should have just made an automated log for receiving ETH...",
        "created_at": "2020-09-23T09:08:08.795000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We *could* add an opcode for that.",
        "created_at": "2020-09-23T09:08:20.444000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\"Send ETH to account X without calling account X\".",
        "created_at": "2020-09-23T09:08:28.785000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "`SELFDESTRUCT` üòõ",
        "created_at": "2020-09-23T09:08:37.370000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But yeah, a real one would be nice",
        "created_at": "2020-09-23T09:08:46.901000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ugh... you mean that thing everyone wants to delete?  üòõ",
        "created_at": "2020-09-23T09:08:48.038000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Or just a rule that a zero-gas call does that",
        "created_at": "2020-09-23T09:08:56.603000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I don't think we can do that without breaking a bunch of stuff (0-gas means X).  Lots of stuff uses 0 gas I believe because that is what triggers the EVM stipend IIRC?",
        "created_at": "2020-09-23T09:09:33.247000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Back to AA, so I was troubleshooting a user transaction just now and realized that you can already have a transaction that was valid and no longer is valid (ETH balance change).  Is the idea that this is fine right now because it is so cheap to deal with, but with AA it will no longer be cheap to deal with?",
        "created_at": "2020-09-23T09:11:07.262000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the idea is that a transaction from an account can only be invalidated by other transactions from that account",
        "created_at": "2020-09-23T09:11:32.280000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Aaah, you mean like if you send some account 1 gwei and could that interfere with future transactions if they have weird code?",
        "created_at": "2020-09-23T09:11:53.275000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That's why the AA EIP bans the BALANCE opcode pre-PAYGAS üòÜ",
        "created_at": "2020-09-23T09:12:06.001000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ah, so we want clear conditions on when a transaction needs to be rerun.  Can't we trigger on \"any changes to this account's storage\"?",
        "created_at": "2020-09-23T09:21:07.451000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That would allow us to open up everything except timestamp and external calls I think?",
        "created_at": "2020-09-23T09:22:18.410000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Er, timestamp, external calls, blockhash?",
        "created_at": "2020-09-23T09:23:00.039000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the problem is that changes to an account's storage are too cheap",
        "created_at": "2020-09-23T09:23:07.703000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "only 5k gas",
        "created_at": "2020-09-23T09:23:09.117000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But it would allow internal calls to the contract.",
        "created_at": "2020-09-23T09:23:10.399000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hence why the proposal for how to extend AA this way requires accounts to have a \"burn-and-refund 25k gas\" pre-clause in them",
        "created_at": "2020-09-23T09:23:33.186000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hmm, and you are concerned that you can cheaply trigger reruns as a DoS vector?",
        "created_at": "2020-09-23T09:24:09.783000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "right",
        "created_at": "2020-09-23T09:24:20.536000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "My goal is to maintain a 6:1 ratio, where forcing nodes to re-run 6 gas requires \u003c= 1 gas to be spent on chain",
        "created_at": "2020-09-23T09:24:41.712000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Thereby bounding per-block recomputation to 6x the gas limit (the recomputation is not mandatory; if you can't do it in time you're just a potentially suboptimal proposer, but we still want it bounded)",
        "created_at": "2020-09-23T09:25:25.265000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And what is the tentative pre-paygas limit?",
        "created_at": "2020-09-23T09:26:58.402000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The \"phase 1\" proposal is 90000, but the long term idea is \"whatever X you want, as long as the contract precommits to spending at least X/6 gas in any incoming non-static call\"",
        "created_at": "2020-09-23T09:31:33.315000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Which is really cool because it simultaneously (i) allows flexibility in the gas limit and gets rid of an ugly fixed number, and (ii) it solves the problem of how to safely allow state-changing calls coming in from the outside",
        "created_at": "2020-09-23T09:32:54.701000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If a client receives a new transaction, how long does it execute it before giving up (in the \"ideal future\" model)?",
        "created_at": "2020-09-23T09:42:07.391000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "6x whatever the min gas consumption is that the target commits to",
        "created_at": "2020-09-23T09:51:32.981000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "How is the target commit conveyed?",
        "created_at": "2020-09-23T09:53:04.788000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Oh, future transaction types would include that in the transaction?",
        "created_at": "2020-09-23T09:53:23.925000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It would be in the target's prefix",
        "created_at": "2020-09-23T09:54:26.486000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The prefix would have code that says, like in my proposal, \"burn X gas and add X gas to the refund counter\" (which would be a new opcode), which implicitly commits to spending at least X/2 gas",
        "created_at": "2020-09-23T09:54:54.267000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And if the transaction *doesn't* spend at least X/2 gas then the transaction is invalid and the peer that sent it gets blacklisted?",
        "created_at": "2020-09-23T09:57:49.428000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ah no",
        "created_at": "2020-09-23T09:57:56.497000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hmm, you can't blacklist directly from that, but maybe gets a negative mark?",
        "created_at": "2020-09-23T09:58:03.514000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "so basically the first opcode in the contract says \"burn X gas and add X gas to the refund counter\"",
        "created_at": "2020-09-23T09:58:12.794000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If the contract doesn't do that, then it's not an accepted AA target",
        "created_at": "2020-09-23T09:58:23.684000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Right, but the transaction may end up never making it to PAYGAS (signature isn't valid).",
        "created_at": "2020-09-23T09:58:38.051000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So any incoming call is guaranteed to correspond to at least X/2 gas being spent",
        "created_at": "2020-09-23T09:58:38.979000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e Right, but the transaction may end up never making it to PAYGAS (signature isn't valid).",
        "created_at": "2020-09-23T09:58:44.302000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But if that happens then it's not valid to be included in the block",
        "created_at": "2020-09-23T09:58:59.770000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "(according to latest rules, I think)",
        "created_at": "2020-09-23T09:59:04.292000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm struggling to understand how in AA Phase N we can open up `TIMESTAMP`, external calls, etc.",
        "created_at": "2020-09-23T09:59:41.431000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Or even just allow internal transactions to the contract (with the caveat of constrained gas spending during validity re-checks).",
        "created_at": "2020-09-23T10:00:24.295000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "so I think it is really important to clearly distinguish the two mechanisms our AA proposal uses to restrict what AA txs to allow into the mempool",
        "created_at": "2020-09-23T10:02:27.840000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "because again, the AA tx type itself would allow all of this, the question is: can the mempool safely accept those transactions / transactions to such accounts",
        "created_at": "2020-09-23T10:03:29.109000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "first, we have the contract bytecode prefix, that ensures the mempool only accepts pending AA txs to contracts where it understands under which circumstances its storage changes",
        "created_at": "2020-09-23T10:04:46.267000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "so in the beginning, you would only allow pending AA txs to contracts that start with `if(msg.sender != shr(-1, 12)) { LOG1(msg.sender, msg.value); return };`",
        "created_at": "2020-09-23T10:05:42.170000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "meaning, for contracts like that \"internal transactions\" (we previously called those external calls) are only allowed to transfer in ETH and create a log, but never to change storage",
        "created_at": "2020-09-23T10:06:36.034000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "and the second part of the mempool restrictions is restrictions on \"safe\" opcodes during verification of an AA transaction",
        "created_at": "2020-09-23T10:07:37.668000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "again, in the very first version, that would only be internal opcodes, so things like `TIMESTAMP` would be banned",
        "created_at": "2020-09-23T10:08:07.930000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "combining these restrictions, the first version would give you \"if a tx to a contract with the known prefix passed validation, it remains valid as long as no other AA tx originating at the same contract makes it into the chain\"",
        "created_at": "2020-09-23T10:09:11.938000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "which is nice",
        "created_at": "2020-09-23T10:09:18.750000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but you can then start to think about how you want to relax these restrictions. the only question always is \"what invariants does that leave the mempool with?\"",
        "created_at": "2020-09-23T10:09:59.693000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e Or even just allow internal transactions to the contract (with the caveat of constrained gas spending during validity re-checks).\n\nThe \"prefix must contain burn-and-refund X\" proposal does allow this for all transactions",
        "created_at": "2020-09-23T10:11:03.040000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e but you can then start to think about how you want to relax these restrictions. the only question always is \"what invariants does that leave the mempool with?\"\n\u003c@!415548822983278593\u003e  Right, this is a good point, and it's the core of the thinking here. As I mentioned above, my thinking is the invariant should be \"you must spend 1 gas on-chain to cause 6 gas of txpool recomputation\"",
        "created_at": "2020-09-23T10:11:41.522000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yes. I mean, the first relaxation step would even be to introduce re-computation at all. but then after that, I agree this is the core invariant you want to keep",
        "created_at": "2020-09-23T10:12:53.214000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e 6x whatever the min gas consumption is that the target commits to\n(quick side note: I think the mempool would still have a hard overall gas limit for verification of a single incoming tx, to protect agains DoS attacks. This 6x rule would be for the allowable total verification gas consumption of all txs to the same AA contract, if the mempool starts to allow multiple pending txs)",
        "created_at": "2020-09-23T10:15:28.850000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "you could have advanced dynamic rules for this DoS per-tx limit as well though, where it effectively becomes a per-peer limit (maybe even higher for more trusted peers that have a history of only sending valid txs)",
        "created_at": "2020-09-23T10:16:33.698000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "right, that's fair, it would have to be capped",
        "created_at": "2020-09-23T10:17:13.555000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e again, in the very first version, that would only be internal opcodes, so things like `TIMESTAMP` would be banned\nBut just to illustrate the `TIMESTAMP` example a bit further, because it is a simple one: A relatively easy relaxation on the \"banned opcode\" side would be to allow access to things like `TIMESTAMP` or `BALANCE`, if the returned value is immediately consumed for simple \"greater or equal to\" checks",
        "created_at": "2020-09-23T10:19:22.196000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm still confused about something, but I'm not sure what I'm missing.  When you first get an AA transaction you don't know if it is valid or not.  You read that first pre-condition which makes some promise that you don't yet know whether it will be upheld or not.",
        "created_at": "2020-09-23T10:19:51.336000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "you mean the prefix?",
        "created_at": "2020-09-23T10:20:15.981000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "that is part of the contract, not the transaction, so you know it has to be upheld (by all transaction ever touching that contract). but indeed, for the transaction you do not yet know its validity, before you run it up to `PAYGAS`.",
        "created_at": "2020-09-23T10:21:40.283000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Right, so it seems like we *need* some constraint on how much code can execute before PAYGAS and I don't see a path away from that in the future.",
        "created_at": "2020-09-23T10:22:16.914000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I do think you are right that my brain keeps confusing \"re-execution conditions\" and \"first execution constraints\".",
        "created_at": "2020-09-23T10:22:50.304000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yes, unfortunately I still find the whole topic to be rather confusing myself üòâ",
        "created_at": "2020-09-23T10:24:25.107000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e Right, so it seems like we *need* some constraint on how much code can execute before PAYGAS and I don't see a path away from that in the future.\nbut I agree. there will always be some gas limit to reach `PAYGAS`, both for first validation and for potential re-validations",
        "created_at": "2020-09-23T10:25:21.458000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think that is just in the nature of transactions though - you have to be able to determine their validity within some limits",
        "created_at": "2020-09-23T10:26:51.209000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Right, and that limit is *incredibly* low with current transactions, check nonce, check balance, check ECDSA signature.",
        "created_at": "2020-09-23T10:27:48.708000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Even the simplest AA transactions I believe blow way over that limit, just due to the need to do everything in the EVM rather than native.",
        "created_at": "2020-09-23T10:29:27.163000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "it's actually not!",
        "created_at": "2020-09-23T10:29:42.942000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So even if you are still just validating nonce, checking a single signature, and checking ETH you are already costing way more I would imagine.",
        "created_at": "2020-09-23T10:29:47.586000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "checking a signature is 3000 gas",
        "created_at": "2020-09-23T10:29:48.863000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "nonce checking is baked in",
        "created_at": "2020-09-23T10:30:02.049000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "as is balance checking",
        "created_at": "2020-09-23T10:30:05.025000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Signature checks currently are validated on receipt and *never* rechecked.",
        "created_at": "2020-09-23T10:30:37.254000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "With AA we cannot avoid rechecking the signature every time things change I don't think.",
        "created_at": "2020-09-23T10:30:52.041000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "aah I see you're talking about effort",
        "created_at": "2020-09-23T10:30:55.500000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e With AA we cannot avoid rechecking the signature I don't think.",
        "created_at": "2020-09-23T10:30:58.773000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "potentially we can",
        "created_at": "2020-09-23T10:31:01.667000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "if we cache pure calls",
        "created_at": "2020-09-23T10:31:05.844000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah, sorry.  Talking about actual effort, not \"gas\".",
        "created_at": "2020-09-23T10:31:10.674000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "this can also be done as an extension",
        "created_at": "2020-09-23T10:31:15.478000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e if we cache pure calls\ngood point, and again, in the first version there would be no re-validations at all",
        "created_at": "2020-09-23T10:31:40.716000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "one idea we had around pure calls was to modify the prefix to allow `STATICCALL` to self as the first verification step, you could then save the result of that staticcall together with the pending tx and skip the staticcall (directly set the cached result) on re-validation.",
        "created_at": "2020-09-23T10:33:51.238000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the main thing missing for that currently was a `IS_STATIC` opcode I think, not sure if I am forgetting anything right now though",
        "created_at": "2020-09-23T10:34:28.094000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "hm, not sure you even need `IS_STATIC`, could do the prefix branching via msg.sender. I do think there was something else though",
        "created_at": "2020-09-23T10:35:27.343000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but basically the idea is: identify a use case that the current iteration of AA does not support, make sure it would be safe to support, relax the mempool restrictions to add support while keeping the important invariants.",
        "created_at": "2020-09-23T10:37:10.545000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "we were planning to have a followup post to our explainer doc where we highlight a few of these possible \"extensions\"",
        "created_at": "2020-09-23T10:38:11.020000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Caching pure calls would increase the size-in-memory of each transaction in the pending pool, which potentially creates a new attack vector (blowing up the pending pool size, rather than processing time).",
        "created_at": "2020-09-23T10:38:35.714000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "agreed. so there would be a tradeoff there, but it would be bounded via the general pending txs limit.",
        "created_at": "2020-09-23T10:39:31.563000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the mempool could also have specific parameters for that, e.g. a per-tx and/or total cache size limit",
        "created_at": "2020-09-23T10:40:09.328000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Bounded only by any hard caps on gas limits up to paygas though, right?",
        "created_at": "2020-09-23T10:40:18.025000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We would need to calculate how much cached data one can generate within that gas limit.",
        "created_at": "2020-09-23T10:40:47.575000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And these transactions can totally be valid.  There is *huge* value in being able to flush the global pending queue.",
        "created_at": "2020-09-23T10:41:04.606000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "People will pay a lot of money to achieve that, and if one way to achieve that is to spend $10,000 of gas on pending transactions designed expressly to blow up the pending pool then someone will definitely do it.",
        "created_at": "2020-09-23T10:41:44.399000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "sure, but you could always just not cache return data if its size is above some limit",
        "created_at": "2020-09-23T10:42:54.946000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Then you end up with the problem of re-processing being expensive.",
        "created_at": "2020-09-23T10:43:13.169000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "in general, the idea often is \"it is the contract's responsibility to be compliant if it wants to profit from the advanced functionality\"",
        "created_at": "2020-09-23T10:43:31.998000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We can choose which attack vector we want to allow, but I don't see an option for \"no attack vector\".",
        "created_at": "2020-09-23T10:43:36.231000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hmm, perhaps you are saying that there is an upper bound on how much each transaction can cache, and we operate under the assumption that all transactions use that limit (e.g., when deciding transaction pool size).",
        "created_at": "2020-09-23T10:44:30.652000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And if we can set that limit to \"small\" then we are OK?",
        "created_at": "2020-09-23T10:44:49.722000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "basically",
        "created_at": "2020-09-23T10:44:55.365000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "and if the tx does not adhere to it, it defaults back to having all of its execution counted against the re-validation gas limit",
        "created_at": "2020-09-23T10:45:28.238000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "which is not an issue for the mempool, just means you can have fewer/smaller txs to that contract, which is the contract's responsibility",
        "created_at": "2020-09-23T10:46:02.873000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e Another factor in my bearish stance on AA is that it is semi-competing with Rich Transactions.  Rich transactions solves most of the same problems that full AA solves, *except* for contract pays gas and alternative signature types.  I am concerned that AA may never get past phase 1 (single tenant, heavily restricted) and if that is the case then I think Rich Transactions are generally a better solution to most of those problems at which point I'm not convinced AA is worth it for contract-pays-gas and alternative signature types on a very small subset of use cases.\nbtw, I think this is a fair point. I personally think AA does provide quite a bit more flexibility, but rich transactions definitely bring some of the AA benefits in a simpler form.",
        "created_at": "2020-09-23T10:48:26.656000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "that is why I think it is important to point out how easy it is to extend AA to further use cases with these simple mempool adjustments, because if it would indeed stay in its simplest version forever, I think it would be unclear if it would be worth it.",
        "created_at": "2020-09-23T10:50:19.455000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but I wanted to look into rich transactions a bit more anyway, to better understand synergy / competing functionality",
        "created_at": "2020-09-23T10:51:06.709000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Rich Transactions are *way* simpler IMO, and I see a very clear path to getting them included as early as the HF after Berlin with full feature set (if we were to push for it).",
        "created_at": "2020-09-23T10:51:12.474000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "AA on the other hand I see as being much more complex to implement, much harder to understand, and even if it made it into the HF after Berlin it would be with an *extremely* limited featureset and there isn't a super clear path to extend that featureset over time.",
        "created_at": "2020-09-23T10:52:03.804000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think that overstates the complexity of AA, but overall I agree, I think it is our responsibility to demonstrate how such a clear path could look like.",
        "created_at": "2020-09-23T10:53:29.825000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I do agree that *if* we can fully solve the AA problem and unlock everything, then AA is better.  I just struggle to see that happening on a reasonable timescale.",
        "created_at": "2020-09-23T10:53:35.006000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e I think that overstates the complexity of AA, but overall I agree, I think it is our responsibility to demonstrate how such a clear path could look like.\n\u003c@!415548822983278593\u003e This is why I am pressing on \"what does Phase 2+ look like\", because that is where my holdup is.",
        "created_at": "2020-09-23T10:53:57.734000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "sure, but I think most of the pieces are already there",
        "created_at": "2020-09-23T10:54:21.637000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I see phase 1 as *almost* useless (definitely no use cases I care about), and I'm trying to weigh whether I should help with AA, or continue pushing Rich Transactions through *instead*.",
        "created_at": "2020-09-23T10:54:30.684000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I dislike the idea of having both Rich Transactions and full AA since they overlap almost entirely, and want to avoid backing both horses.",
        "created_at": "2020-09-23T10:54:52.108000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e sure, but I think most of the pieces are already there\n- allowing delegatecall\n- caching pure functions\n- allowing arbitrary static internal transactions\n- allowing re-validations\n- allowing non-static internal transactions via prepay\n- allowing multiple pending txs",
        "created_at": "2020-09-23T10:57:26.846000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think that already brings us close to \"full AA\"",
        "created_at": "2020-09-23T10:57:39.189000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "to be fair, some of these points do require some further research, mainly multiple pending txs",
        "created_at": "2020-09-23T10:58:06.334000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but there is a clear and simple path for all of them",
        "created_at": "2020-09-23T10:58:22.434000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I would even be confident that by the time of the hardfork after Berlin most of these could already be in place",
        "created_at": "2020-09-23T10:58:44.219000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e I dislike the idea of having both Rich Transactions and full AA since they overlap almost entirely, and want to avoid backing both horses.\nfair. I very much appreciate your feedback btw, I think these are indeed the questions we have to convincingly answer for AA to move forward. I am not yet convinced AA and rich transactions are not reconcilable, but as I said haven't looked into it much so far.",
        "created_at": "2020-09-23T11:01:52.191000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Is arbitrary CALL into the account in that list?",
        "created_at": "2020-09-23T11:03:02.304000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Also, is there a path to integrating \"someone else pays gas\" with AA?",
        "created_at": "2020-09-23T11:03:27.614000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e Is arbitrary CALL into the account in that list?\nthat is what I was referring to as \"allowing non-static internal transactions via prepay\", I did word that one poorly though üòâ",
        "created_at": "2020-09-23T11:04:26.874000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e Also, is there a path to integrating \"someone else pays gas\" with AA?\nThis is an interesting one. I am not sure, in some sense of course AA does exactly that. but I could even see this being something that rich transactions could do, where it could then be combined with AA",
        "created_at": "2020-09-23T11:05:24.186000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "again, not yet convinced there is no synergy there",
        "created_at": "2020-09-23T11:05:46.789000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "How does AA do that?",
        "created_at": "2020-09-23T11:16:07.803000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Doesn't AA explicitly *not* do that?",
        "created_at": "2020-09-23T11:16:16.765000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Unless external calls are allowed before paygas, so an AA transaction could go elsewhere to get gas money and then refund at the end.",
        "created_at": "2020-09-23T11:16:47.963000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "For example, if I have an AA account that only has ABC tokens, and I need ETH for gas (e.g., 1559 base fee), I need to be able to make an external call to acquire the ETH from somewhere to cover gas and that has to be done before PAYGAS.",
        "created_at": "2020-09-23T11:17:46.985000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ideally, it would be done in a way that doesn't leave me with ETH at the end.",
        "created_at": "2020-09-23T11:18:23.746000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I was thinking in multi-tenant AA the contract would basically be the entity sponsoring user transactions. But of course that is not the same.",
        "created_at": "2020-09-23T11:45:54.907000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "btw, how would the mempool deal with sponsored transactions? I assume it would only keep one transaction per sponsor? Otherwise you run into the same problems of \"flooding the mempool with sponsored txs, only one of which can ever be paid for\"?",
        "created_at": "2020-09-23T11:51:30.879000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I guess it could have a per-sponsor limit above 1 (but still small)",
        "created_at": "2020-09-23T11:53:27.345000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "You can see https://eips.ethereum.org/EIPS/eip-2711 for an example.  Ignore the transaction array, as that will probably be dropped.",
        "created_at": "2020-09-23T12:03:59.153000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Flow also solves this problem (plus multisigs and multiple signature schemes) in a similar way with enveloping.",
        "created_at": "2020-09-23T12:04:19.851000+00:00",
        "attachments": []
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e Also, is there a path to integrating \"someone else pays gas\" with AA?\n\u003c@!301186049323958275\u003e Would allowing \"non-static internal transactions via prepay\" also allow EOA transactions into AA contracts?",
        "created_at": "2020-09-23T14:23:10.320000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!689161464829050960\u003e What do you mean?",
        "created_at": "2020-09-23T14:25:28.738000+00:00",
        "attachments": []
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!301186049323958275\u003e if some other contract is calling into an AA contract, doesn't that usually mean an EOA is paying for the transaction? If that's allowed, I don't see why an EOA couldn't call directly into an AA contract and pay for its own gas.",
        "created_at": "2020-09-23T14:58:39.254000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ü§î  assuming anyone can call AA contract entrypoints I suppose so.",
        "created_at": "2020-09-23T15:04:49.569000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But then you want the nonce to be part of the contract, not part of the signature.",
        "created_at": "2020-09-23T15:04:58.519000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think in this case the EOA's nonce would be used for replay protection",
        "created_at": "2020-09-23T15:05:54.472000+00:00",
        "attachments": []
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e ü§î  assuming anyone can call AA contract entrypoints I suppose so.\nOf course again with the little caveat that this is one of the \"advanced\" AA features, not available in the most simple version.",
        "created_at": "2020-09-23T15:07:14.416000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e I think in this case the EOA's nonce would be used for replay protection\n\u003c@!415548822983278593\u003e That won't work for sponsored transactions.",
        "created_at": "2020-09-23T15:08:39.375000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The signer of the transaction that does work needs to have a nonce that is controlled by the signer of that nonce.",
        "created_at": "2020-09-23T15:15:54.793000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It can't be signed by the person paying gas (who isn't the person signing the transaction action details).",
        "created_at": "2020-09-23T15:16:41.779000+00:00",
        "attachments": []
    }
]