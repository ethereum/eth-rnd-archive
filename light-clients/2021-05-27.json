[
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Thinking about the issue of the `base_reward` invariant. The issue of the `8/56` was created by insisting in giving rewards for the sync committee in the first place. In fact by moving to penalties the situation simplifies as we can simply use `8/64` and disregard completely the complications of sync_committee rewards. This simplifies further the rewards for attestation inclusions as well. I don't see in fact why this will cause future bugs as long as we don't think of sync committee rewards as rewards",
        "created_at": "2021-05-27T00:33:57.993000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Alright, FWIW, I fixed the penalties proposals by making it invariant with respect of changing the constants. The trick in current altair is to use that the sum of all weights is the denominator and then use expressions like `WEIGHT_DENOMINATOR - PROPOSER_WEIGHT` to actually mean the sum of all other weights. So I simply changed that and I'm using also quadratic expressions for the denominator where the factor above is replaced by `sum(PARTICIPATION_FLAG_WEIGHTS) + SYNC_PENALTY_WEIGHT`. I know \u003c@!273808422753796097\u003e  you're probably set for the reducing constants approach, but still I'd appreciate it if you and \u003c@!144468805697929216\u003e could give it a look. The branch is linked in the issue:\nhttps://github.com/ethereum/eth2.0-specs/issues/2448",
        "created_at": "2021-05-27T01:54:10.295000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "got it!",
        "created_at": "2021-05-27T15:04:09.964000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Here's my alternative PR btw:",
        "created_at": "2021-05-27T15:04:13.633000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "https://github.com/ethereum/eth2.0-specs/pull/2453/files",
        "created_at": "2021-05-27T15:04:14.179000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I'd be happier if the sync committee weight dropped to 1 rather than 2, but I recognise it causes a problem of what to do with the liberated 1.",
        "created_at": "2021-05-27T15:52:54.453000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "~~Even in Vitalik's approach we can use the same denominators than in my proposal and just require that all weights except sync add up to the weight denominator~~",
        "created_at": "2021-05-27T15:54:08.485000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Ah strike that",
        "created_at": "2021-05-27T15:54:32.309000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@!539495253418180618\u003e I saw you're reviewing \u003c@!273808422753796097\u003e's PR, in trying to make the tests pass for my own (even if it is not approved in favor of Vitalik's is a nice excuse for me to look at how the tests work) I realized that all the logic in the tests for sync rewards seem to be wrong. Take a look at \nhttps://github.com/ethereum/eth2.0-specs/blob/dev/tests/core/pyspec/eth2spec/test/altair/block_processing/test_process_sync_committee.py#L118 for example and compare it with `process_sync_committee` in https://github.com/ethereum/eth2.0-specs/blob/dev/specs/altair/beacon-chain.md. The rewards in the specs are independent of the index while these functions are via their effective balances",
        "created_at": "2021-05-27T20:03:09.751000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I can align them with the current specs but since these may change anyway because of the issue my PR or Vitalik's is trying to address, I figured I'd call your attention to it, instead of fixing them right away",
        "created_at": "2021-05-27T20:04:42.325000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "By the way, you'll hit the same problem that I am hitting now that the tests for deposit top ups for example, and others that rely on `build_empty_block` since this  builds blocks with no participation in the sync committee and thus the state transition penalizes some validators (both in my proposal and Vitalik's) hence the tests fail. I fixed the tests for the logic of the sync committee, but the phase0 tests are going to be a little trickier.",
        "created_at": "2021-05-27T21:11:25.464000+00:00",
        "attachments": null
    }
]