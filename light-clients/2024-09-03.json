[
    {
        "author": "claravanstaden",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "In [validate_light_client_update](https://github.com/ethereum/consensus-specs/blob/dev/specs/altair/light-client/sync-protocol.md#validate_light_client_update), why is the condition `update_attested_slot \u003e store.finalized_header.beacon.slot` instead of `update_finalized_slot \u003e store.finalized_header.beacon.slot`?\n\n```\n# Verify update is relevant\nupdate_attested_period = compute_sync_committee_period_at_slot(update_attested_slot)\nupdate_has_next_sync_committee = not is_next_sync_committee_known(store) and (\n    is_sync_committee_update(update) and update_attested_period == store_period\n)\nassert (\n    update_attested_slot \u003e store.finalized_header.beacon.slot\n    or update_has_next_sync_committee\n)\n```\n\nThere is a case where a newer attested header is received but attests to a finalized header already imported in the store, rendering the update essentially irrelevant.",
        "created_at": "2024-09-03T07:34:20.875000+00:00",
        "attachments": []
    },
    {
        "author": "inspector.butters",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "this is correct. it checks if the slot that the update is attesting to, is higher than our already saved finalized slot. which would be true unless it's and old update. \n\n`update_finalized_slot \u003e store.finalized_header.beacon.slot` this would be wrong, because not all updates have a `finalized_header`. (e.g. Optimistic updates)\n\n\u003e There is a case where a newer attested header is received but attests to a finalized header already imported in the store\nThis is a normal case. the attested_header_slot would be higher than the locally saved finalized_header_slot. it's not irrelevant, it's valid.",
        "created_at": "2024-09-03T09:12:38.404000+00:00",
        "attachments": []
    },
    {
        "author": "claravanstaden",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "And in a case where a light client only stores finalized headers, not optimistic updates?",
        "created_at": "2024-09-03T09:15:30.777000+00:00",
        "attachments": []
    },
    {
        "author": "inspector.butters",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "the code is still correct. if the attested_header_slot is not higher than the local finalized_header_slot, then the incoming finalized_header_slot is definitely not higher than the local one. \nyou would just have to add additional logic to only store new updates with finalized headers.",
        "created_at": "2024-09-03T10:31:54.710000+00:00",
        "attachments": []
    },
    {
        "author": "claravanstaden",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yeah but is `update_finalized_slot \u003e store.finalized_header.beacon.slot`  not more correct then? Because otherwise the update could contain a more recent attested header but the finalized header it attests too is the same as a previously imported header?",
        "created_at": "2024-09-03T10:49:43.761000+00:00",
        "attachments": []
    },
    {
        "author": "inspector.butters",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "in your case, yes. but you have to keep in mind that the received update might not have a finalized header. so check that to not get an error. or just listen to the finalityUpdate feed.",
        "created_at": "2024-09-03T10:54:11.052000+00:00",
        "attachments": []
    },
    {
        "author": "claravanstaden",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Thanks for confirming. [Our payload](https://github.com/Snowfork/polkadot-sdk/blob/snowbridge/bridges/snowbridge/primitives/beacon/src/updates.rs#L46) always has a finalized header, so it would not be a concern.",
        "created_at": "2024-09-03T11:09:21.494000+00:00",
        "attachments": []
    }
]