[
    {
        "author": "claravanstaden",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Looking to discuss a light client protocol edge case. Perhaps \u003c@881905303011086387\u003e or \u003c@539495253418180618\u003e  is the best to weigh in here, anyone else welcome. Light client scenario:\n\nLc stored_period = 1\nLc has next sync committee in period 2\nLc receives a header in period 2, without the next sync committee update (for period 3).\nLc will verify header successfully using sync committee in period 2: https://github.com/ethereum/consensus-specs/blob/dev/specs/altair/light-client/sync-protocol.md#validate_light_client_update (using the `next_sync_committee`):\n\n```\n# Verify sync committee aggregate signature\n  if update_signature_period == store_period:\n      sync_committee = store.current_sync_committee\n  else:\n      sync_committee = store.next_sync_committee\n```\n\nLc will effectively advance the `stored_period` by moving the `next_sync_committee` to `current_sync_committee` and setting `next_sync_committee` to an empty value: https://github.com/ethereum/consensus-specs/blob/dev/specs/altair/light-client/sync-protocol.md#apply_light_client_update\n\n```\nelif update_finalized_period == store_period + 1:\n    store.current_sync_committee = store.next_sync_committee\n    store.next_sync_committee = update.next_sync_committee\n    store.previous_max_active_participants = store.current_max_active_participants\n    store.current_max_active_participants = 0\n```\n\nMy questions are:\n- Are these assumptions correct? Ie the light client period should be able to be advanced by a LightClientUpdate without the next sync committee?\n- Would it be incorrect to reject an update in `store_period + 1` and rather only allow updates in `store_period`?",
        "created_at": "2024-05-15T11:45:27.111000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003cJommi\u003e https://twitter.com/onbjerg/status/1790336133433348143",
        "created_at": "2024-05-15T12:07:57.124000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003cJommi\u003e we failed guys",
        "created_at": "2024-05-15T12:07:59.367000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003cJommi\u003e and girls",
        "created_at": "2024-05-15T12:08:03.318000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003cmhaas_eth\u003e Lol",
        "created_at": "2024-05-15T12:08:15.531000+00:00",
        "attachments": null
    },
    {
        "author": "etan_status",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "That seems to be the intended flow, and also what you initially have after doing only the `bootstrap` step. Before the end of the new period, you'll have to obtain at least one update that contains a sync committee. Could you replicate a scenario that triggers a bug?",
        "created_at": "2024-05-15T13:50:56.273000+00:00",
        "attachments": null
    },
    {
        "author": "claravanstaden",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Thanks for the feedback. It doesn't look like a bug on the consensus spec, more something we missed while implementing the spec. The different language constructs come into play, because in the Python spec it wasn't immediately clear that `store.next_sync_committee = update.next_sync_committee` could actually be setting the next sync committee to an empty value.\n\nWe are going to reject `state_period + 1`  updates if it does not contain a sync committee update for now, it seems safer even if more restrictive.",
        "created_at": "2024-05-15T14:04:07.449000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003cetan_status\u003e If you wait for next sync committee to finalize, youâ€™d miss the first 12 minutes of eacch sync committee period, though. without finality, even if its present it would not immediately apply ;-)",
        "created_at": "2024-05-15T17:50:55.530000+00:00",
        "attachments": null
    }
]