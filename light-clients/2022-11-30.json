[
    {
        "author": "robzajac",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Question on this part of the LC spec: https://github.com/ethereum/consensus-specs/blob/dev/specs/altair/light-client/full-node.md#create_light_client_bootstrap\nGiven that `hash_tree_root(state) != state.latest_block_header.state_root`, what exactly is `state.latest_block_header.state_root` referring to or used for?\nEdit: is it the state root we expect from applying the latest block to `state`?",
        "created_at": "2022-11-30T14:43:33.871000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003cetan_status\u003e it is hash_tree_root() of the BeaconState after applying the corresponding BeaconBlock",
        "created_at": "2022-11-30T14:57:00.310000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003cetan_status\u003e it is not the EL block header state_root, but instead the CL BeaconState root",
        "created_at": "2022-11-30T14:57:23.108000+00:00",
        "attachments": []
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "the state root is set in `process_slot` where the state root of the state after applying the previous block (which the `latest_block_header` corresponds to) is written to that location, see code here: https://github.com/ethereum/consensus-specs/blob/dev/specs/phase0/beacon-chain.md#beacon-chain-state-transition-function",
        "created_at": "2022-11-30T15:03:54.795000+00:00",
        "attachments": []
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "there is a circular dependency so the state root has to be written after updating the state",
        "created_at": "2022-11-30T15:04:38.961000+00:00",
        "attachments": []
    },
    {
        "author": "robzajac",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@539495253418180618\u003e I think I see.. but in this case, does this indicate that the most recent `BeaconState` always has `state.latest_block.header.state_root == Bytes32()` ? as you would only update `latest_block_header.state_root` on application of the _next_ block",
        "created_at": "2022-11-30T15:39:41.650000+00:00",
        "attachments": []
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "it is \"cleared\" for each block -- see here: https://github.com/ethereum/consensus-specs/blob/dev/specs/phase0/beacon-chain.md#block-header -- and then at the start of the next slot (regardless of block!) you insert the correct state root",
        "created_at": "2022-11-30T15:43:32.563000+00:00",
        "attachments": []
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "this is done so that the state/block roots that are written to the history accumulator are correct",
        "created_at": "2022-11-30T15:43:50.970000+00:00",
        "attachments": []
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "(see the rest of `process_slot`)",
        "created_at": "2022-11-30T15:44:11.678000+00:00",
        "attachments": []
    },
    {
        "author": "robzajac",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I see.. another way to say it is, for the `state` at slot `n` the `state.latest_block_header`  corresponds to the block with slot `n-1`, and `state.latest_block_header.state_root` is correctly set to `hash_tree_root(state)` only after receiving some block with slot `x \u003e n`?",
        "created_at": "2022-11-30T16:00:38.559000+00:00",
        "attachments": []
    },
    {
        "author": "ralexstokes",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "the `latest_block_header` is for the block at slot `n` (or the last block, whenever that was) -- the only thing missing is the state root bc you can't compute the state root if you need the state root (the circular dep here)",
        "created_at": "2022-11-30T16:07:22.214000+00:00",
        "attachments": []
    },
    {
        "author": "robzajac",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Ah okay right, and the state root will be set on the next call to `process_slot`, which should be when receiving a block with slot `\u003e n`",
        "created_at": "2022-11-30T16:09:44.073000+00:00",
        "attachments": []
    }
]