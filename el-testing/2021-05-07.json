[
    {
        "author": "oripomerantz",
        "category": "Testing",
        "parent": "",
        "content": "Thank you. I'll probably have a suite of tests that do almost everything EIP 1559 tomorrow.",
        "created_at": "2021-05-07T00:12:57.226000+00:00",
        "attachments": null
    },
    {
        "author": "oripomerantz",
        "category": "Testing",
        "parent": "",
        "content": "I think that I found another bug. From what I understand from the EIP,  the restriction is that the gas actually used needs to be no more than twice `gasTarget`. \n\nHere is the relevant part of EIP 1*559 (irrelevant code replaced with ...):\n\n```\nELASTICITY_MULTIPLIER = 2\n...\n    def validate_block(self, block: Block) -\u003e None:\n                ...\n        # check if the block used too much gas\n        assert block.gas_used \u003c= block.gas_target * ELASTICITY_MULTIPLIER, \n                          'invalid block: too much gas used'\n                ...\n        # execute transactions and do gas accounting\n        cumulative_transaction_gas_used = 0\n        for unnormalized_transaction in transactions:\n                        ...\n            gas_used = self.execute_transaction(transaction, effective_gas_price)\n                        ...\n            cumulative_transaction_gas_used += gas_used\n        # check if the block spent too much gas transactions\n        assert cumulative_trans*action_gas_used == block.gas_used, 'invalid block: gas_used \n                            does not equal total gas used in all transactions'\n```\n\nHowever, if the `gasLimit` of a transaction is more than the remaining gas the transaction fails even though it wouldn't actually use that much. It this trace we have two blocks that are nearly identical. Each block contains two transactions that call 0x22..222. That contract spends 6 gas, for a total transaction cost of 21006 gas. `gasTarget` is 100k.\n\nIn the both blocks the gas limit of the first transaction is 200k, and there's no problem. In the first block the gas limit for the second transaction is 200k-21006 = 178994. This second transaction is also not a problem. But in the second block the gas limit for the second transaction is one more, 178995. Even though this transaction only costs 21006 gas, which is well within the remaining block size, it is rejected.",
        "created_at": "2021-05-07T01:28:44.817000+00:00",
        "attachments": [
            {
                "type": "text/plain",
                "origin_name": "trace.txt",
                "content": "ffceea9ea28eef21eb7643eebbb3d313ca62db0d02bf357d992951847a934a0e"
            }
        ]
    },
    {
        "author": "oripomerantz",
        "category": "Testing",
        "parent": "",
        "content": "",
        "created_at": "2021-05-07T01:28:46.169000+00:00",
        "attachments": [
            {
                "type": "text/plain; charset=utf-8",
                "origin_name": "test_yml.txt",
                "content": "0bcf5f250bfeb12d20e23abcc965d324208d565d4d6e039dccb2d16ab76decb1"
            }
        ]
    },
    {
        "author": "lightclient",
        "category": "Testing",
        "parent": "",
        "content": "looking into this",
        "created_at": "2021-05-07T01:42:51.714000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@!439556036647714817\u003e I'm not sure that is allowed. IUC, you want to allow a tx in a block whose gaslimit is greater than the gas limit left in the block, but it doesn't use the whole limit and stays within the block bound. Here is how geth handles this as of Berlin: https://github.com/ethereum/go-ethereum/blob/cc606be74c6f1f05b0b0a6226a400e734b9aac31/core/state_transition.go#L187",
        "created_at": "2021-05-07T01:54:50.308000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Testing",
        "parent": "",
        "content": "it appears return `gas limit reached` error even before 1559 changes",
        "created_at": "2021-05-07T01:55:21.052000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "Yes we have tests about this in pre berlin",
        "created_at": "2021-05-07T09:01:29.509000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "Is this now the most updated implementation?",
        "created_at": "2021-05-07T09:50:16.960000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "https://github.com/ethereum/go-ethereum/pull/22837",
        "created_at": "2021-05-07T09:50:20.119000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "hm. why the transaction gets rejected?",
        "created_at": "2021-05-07T11:09:58.466000+00:00",
        "attachments": [
            {
                "type": "text/plain; charset=utf-8",
                "origin_name": "message.txt",
                "content": "1e4118354e0dd6faa95eb77ef78c0baf20ccfd7dd46ad0059400affa1421c6a2"
            }
        ]
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "/home/wins/.retesteth/default/start.sh --input.alloc /tmp/afab4dfe-ab19-472a-b6e8-d61eb9ccf967/alloc.json --input.txs /tmp/afab4dfe-ab19-472a-b6e8-d61eb9ccf967/txs.json --input.env /tmp/afab4dfe-ab19-472a-b6e8-d61eb9ccf967/env.json --state.fork Aleut --output.basedir /tmp/afab4dfe-ab19-472a-b6e8-d61eb9ccf967 --output.result out.json --output.alloc outAlloc.json --state.reward 2000000000000000000",
        "created_at": "2021-05-07T11:11:57.117000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "from holiman branch",
        "created_at": "2021-05-07T11:12:08.341000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Does this deploy a contract starting with 0xEF?",
        "created_at": "2021-05-07T11:59:59.527000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Should not reject on Aleut though",
        "created_at": "2021-05-07T12:00:08.930000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "No its a simple contract",
        "created_at": "2021-05-07T12:04:44.952000+00:00",
        "attachments": null
    },
    {
        "author": "oripomerantz",
        "category": "Testing",
        "parent": "",
        "content": "Tests about what? gasLimit vs. gasUsed?",
        "created_at": "2021-05-07T15:01:25.741000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Testing",
        "parent": "",
        "content": "Yes, please follow changes on that branch now. Ty",
        "created_at": "2021-05-07T15:07:04.534000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "About transactions with total gas limit \u003e block gas limit, but actual gasUsed \u003c block gas limit",
        "created_at": "2021-05-07T15:11:45.607000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "It is still rejected on initial block check which verifies that totalGasLimit of transactions \u003c header gasLimit as we don't know how actually transaction would work",
        "created_at": "2021-05-07T15:12:42.256000+00:00",
        "attachments": null
    },
    {
        "author": "oripomerantz",
        "category": "Testing",
        "parent": "",
        "content": "You're right. I didn't think that's the way it should work, but it's clearly specified in the yellow paper (https://ethereum.github.io/yellowpaper/paper.pdf, p. 8:",
        "created_at": "2021-05-07T17:46:50.676000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "unknown.png",
                "content": "0a1c96bbe1be363514494db75ed9e874d2b5c1ee1427c5d5884c4cde54c6365b"
            }
        ]
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "This won't be a problem anymore with the recent changes to EIP1559. Now the gasLimit of the block is not changed to gasTarget, it instead stays the gasLimit and we calculate gasTarget from there. So in other words it clear in this case that txs with a gas limit higher than block gas limit are invalid.",
        "created_at": "2021-05-07T18:24:32.979000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "now need to rework back the jsons",
        "created_at": "2021-05-07T23:37:40.546000+00:00",
        "attachments": null
    }
]