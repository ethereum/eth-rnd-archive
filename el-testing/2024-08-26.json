[
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@508125616940515329\u003e \u003c@543900561460822016\u003e can you trace one of the tests? I have state root missmatch and I am assuming it is gas related as bytecode is correctly set.\n\nTest path is: `prague/eip7702_set_code_tx/set_code_txs/set_code_to_log.json`\n\nRevm output is: \n```\n{\"pc\":0,\"op\":97,\"gas\":\"0x97e2d0\",\"gasCost\":\"0x3\",\"stack\":[],\"depth\":1,\"returnData\":\"0x\",\"refund\":\"0x0\",\"memSize\":\"0\",\"opName\":\"PUSH2\"}\n{\"pc\":3,\"op\":96,\"gas\":\"0x97e2cd\",\"gasCost\":\"0x3\",\"stack\":[\"0x1234\"],\"depth\":1,\"returnData\":\"0x\",\"refund\":\"0x0\",\"memSize\":\"0\",\"opName\":\"PUSH1\"}\n{\"pc\":5,\"op\":82,\"gas\":\"0x97e2ca\",\"gasCost\":\"0x6\",\"stack\":[\"0x1234\",\"0x0\"],\"depth\":1,\"returnData\":\"0x\",\"refund\":\"0x0\",\"memSize\":\"0\",\"opName\":\"MSTORE\"}\n{\"pc\":6,\"op\":96,\"gas\":\"0x97e2c4\",\"gasCost\":\"0x3\",\"stack\":[],\"depth\":1,\"returnData\":\"0x\",\"refund\":\"0x0\",\"memSize\":\"32\",\"opName\":\"PUSH1\"}\n{\"pc\":8,\"op\":96,\"gas\":\"0x97e2c1\",\"gasCost\":\"0x3\",\"stack\":[\"0x20\"],\"depth\":1,\"returnData\":\"0x\",\"refund\":\"0x0\",\"memSize\":\"32\",\"opName\":\"PUSH1\"}\n{\"pc\":10,\"op\":160,\"gas\":\"0x97e2be\",\"gasCost\":\"0x277\",\"stack\":[\"0x20\",\"0x0\"],\"depth\":1,\"returnData\":\"0x\",\"refund\":\"0x0\",\"memSize\":\"32\",\"opName\":\"LOG0\"}\n{\"pc\":11,\"op\":0,\"gas\":\"0x97e047\",\"gasCost\":\"0x0\",\"stack\":[],\"depth\":1,\"returnData\":\"0x\",\"refund\":\"0x0\",\"memSize\":\"32\",\"opName\":\"STOP\"}\n\ngas_used: 37320,\ngas_refunded: 9329,\n```",
        "created_at": "2024-08-26T10:50:56.743000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Do you have the exact test name? EthJS does (currently) not support t8n tracing sadly but I will happily take a look at this test ðŸ™‚",
        "created_at": "2024-08-26T10:51:54.581000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Since we filled the tests we could also have a bug ðŸ™‚",
        "created_at": "2024-08-26T10:52:06.920000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "`tests/prague/eip7702_set_code_tx/test_set_code_txs.py::test_set_code_to_log[fork_Prague-evm_code_type_LEGACY-state_test-log_opcode_LOG0]`",
        "created_at": "2024-08-26T10:53:40.708000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Your gas_refunded looks a bit off btw, not super sure how to get an odd number here? I will hack in a trace and check the test though",
        "created_at": "2024-08-26T10:54:04.282000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "It is simpler test that delegated the bytecode and triggers the log",
        "created_at": "2024-08-26T10:54:14.967000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "Hm, there should be a refund here,",
        "created_at": "2024-08-26T10:55:03.909000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Sorry let me not speculate on anything, I'll generate a trace-like object first",
        "created_at": "2024-08-26T10:55:25.733000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "It shoud have refund as balance is present so no new account is created. It is strange as refund is limited to 1/5 of spend gas",
        "created_at": "2024-08-26T10:56:12.902000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Aha! This could be a problem, EthJS does not impose a limit here on the refunded gas",
        "created_at": "2024-08-26T10:56:40.355000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "(for the auth lists)",
        "created_at": "2024-08-26T10:56:46.345000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "If you remove the refund limit check it might pass. But I'm actually not sure if this matches the spec",
        "created_at": "2024-08-26T10:57:12.358000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "It should go in usual flow of gas refund, same as any other refund",
        "created_at": "2024-08-26T10:57:32.671000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Well in this case I am actually not sure. \u003c@543900561460822016\u003e ?",
        "created_at": "2024-08-26T10:57:56.158000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "Here is a question about it: https://discord.com/channels/595666850260713488/718596092828057631/1271054650279198731",
        "created_at": "2024-08-26T10:59:03.829000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "And answer here: https://discord.com/channels/595666850260713488/718596092828057631/1271115495214551120 It is kinda strange as not full amount is returned, but it is usual refund flow that we have",
        "created_at": "2024-08-26T11:00:27.196000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Yes I see. We do credit the refund after the tx, but we do not have the 1/5 limit imposed I think",
        "created_at": "2024-08-26T11:01:07.936000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Let me check ðŸ™‚",
        "created_at": "2024-08-26T11:01:17.916000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "However, I find this a bit strange and I do not think we should do this. We thus have the 1/5 limit based on the execution gas used. So if I only send a tx to delegate an account (which already exists in trie) but it does not execute any code (call to 0x0 for instance), then I thus do get 0 refund because I have not executed anything ðŸ¤”",
        "created_at": "2024-08-26T11:02:42.496000+00:00",
        "attachments": null
    },
    {
        "author": "gurukamath",
        "category": "Testing",
        "parent": "",
        "content": "I'm trying to run the following test on the EELS implementation. The sender and the authority do not seem to resolve to what the test suggests. \n\n```\n{'test_file': 'blockchain_tests/prague/eip7702_eoa_code_tx/eoa_code_txs/set_code_to_self_caller.json', 'test_key': 'tests/prague/eip7702_eoa_code_tx/test_eoa_code_txs.py::test_set_code_to_self_caller[fork_Prague-blockchain_test-value_1000000000000000000-op_CALLCODE]'}\n```\n\nSender resolves to `0x877f2d6fa9aebd6b71d0dad35c7065c96893a5af` instead of `0x8a0a19589531694250d570040a0c4b74576919b8`\n\nAnd the authority resolves to `0x68fe0773837d8e64bd9002003c921497fa5f5a1c` instead of `0xa94f5374fce5edbc8e2a8697c15331677e6ebf0b`. Is this just us?",
        "created_at": "2024-08-26T11:02:42.943000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I will check this after resolving with revm ðŸ™‚",
        "created_at": "2024-08-26T11:07:09.444000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Ok, just checked, we actually have this refund cap, and we report 9329 refund. Will now do a trace",
        "created_at": "2024-08-26T11:07:25.209000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "We also have same gas used",
        "created_at": "2024-08-26T11:08:32.466000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "(37320)",
        "created_at": "2024-08-26T11:08:38.047000+00:00",
        "attachments": null
    },
    {
        "author": "gurukamath",
        "category": "Testing",
        "parent": "",
        "content": "Thanks \u003c@508125616940515329\u003e",
        "created_at": "2024-08-26T11:11:46.972000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "LOG test with Revm thread",
        "created_at": "2024-08-26T11:12:32.113000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Hmm for some reason I do not have this test. On what EELS branch are you on?",
        "created_at": "2024-08-26T11:16:34.606000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Ahh wait a sec",
        "created_at": "2024-08-26T11:16:58.579000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I think you are on an outdated version of EELS",
        "created_at": "2024-08-26T11:17:11.672000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "You should use `eip-7702-devnet-3`. I am rather sure that the `main` branch points to an outdated version of EIP 7702 (devnet-1 / devnet-2). The spec has changed a lot, for instance, the `nonce` field of 7702 authority lists is now not a list, it is a number ðŸ™‚",
        "created_at": "2024-08-26T11:18:11.593000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Wait, sorry, branch of EEST, not EELS",
        "created_at": "2024-08-26T11:18:40.615000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Hey is this the release you are using https://github.com/ethereum/execution-spec-tests/releases/tag/pectra-devnet-3%40v1.1.0 ?\nThe path of the test in the log seems like an outdated test, could you try this one and let me know if this is still failing pls?",
        "created_at": "2024-08-26T14:03:15.855000+00:00",
        "attachments": null
    },
    {
        "author": "gurukamath",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@508125616940515329\u003e Yeah. My bad. I had an older version",
        "created_at": "2024-08-26T14:19:55.465000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Ok cool! Let me know if you have issues with the recent ones (will likely have a new release shortly)",
        "created_at": "2024-08-26T14:29:37.573000+00:00",
        "attachments": null
    }
]