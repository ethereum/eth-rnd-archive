[
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@!393119312350543872\u003e \u003c@!439556036647714817\u003e did you guys by any chance already add statetests with the new failure checks? https://github.com/ethereum/EIPs/pull/3594\n\nEssentially, stateTests that contain one transaction each, which are like these:\n\n```\n[tx with transaction.max_fee_per_gas  \u003c transaction.max_priority_fee_per_gas, so e.g. max_fee_per_gas=2gwei and max_priority_fee_per_gas=1gwei]\n[tx where sender.balance \u003c gasLimit * transaction.max_fee_per_gas. The test should have sender.balance \u003e gasLimit * effective_gasprice]\n```\nThe txs should be rejected with the new rules.",
        "created_at": "2021-05-31T11:00:18.310000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "To check the first 2 we have to adjust our tools. Right now we assume only 2××256-1 as the maximum value. Fo other then that need to develop invalid block construction with over 256 values.",
        "created_at": "2021-05-31T11:10:51.712000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "Rules 3,4 checks are in progress",
        "created_at": "2021-05-31T11:11:26.832000+00:00",
        "attachments": null
    },
    {
        "author": "oripomerantz",
        "category": "Testing",
        "parent": "",
        "content": "Is there a reason to do them as state tests rather than blockchain tests? IIRC state test transactions aren't supposed to fail.",
        "created_at": "2021-05-31T18:50:01.351000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "Since the txs are invalid, they can't be included in a block",
        "created_at": "2021-05-31T19:14:20.999000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "The first two rules doesn't need checking really, if the last two are checked",
        "created_at": "2021-05-31T19:14:58.028000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "What do you mean 'supposed to'? The txs can fail, thus the stateroot doesn't change when applying it, that's fine.",
        "created_at": "2021-05-31T19:46:01.859000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "Those checks can only be done as state-tests, cannot be done as blockchain tests",
        "created_at": "2021-05-31T19:47:07.538000+00:00",
        "attachments": null
    },
    {
        "author": "oripomerantz",
        "category": "Testing",
        "parent": "",
        "content": "Test written in https://github.com/ethereum/tests/pull/862, see https://github.com/ethereum/tests/edit/new-transaction-rules/src/BlockchainTestsFiller/ValidBlocks/bcEIP1559/transFailFiller.yml?pr=%2Fethereum%2Ftests%2Fpull%2F862",
        "created_at": "2021-05-31T20:14:02.814000+00:00",
        "attachments": null
    },
    {
        "author": "oripomerantz",
        "category": "Testing",
        "parent": "",
        "content": "The `retesteth` tool knows how to handle a blockchain test with failed transactions. You just put `invalid: 1` as one of the transaction parameters.\n\nState tests, OTOH, always fail when the transaction in them fail.",
        "created_at": "2021-05-31T20:17:23.356000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "A blockchain cannot contain an invalid block. An invalid block becomes invalid for many reasons, so how do you 'correctly' compute the stateroot on an invalid block? You can only do that if you know exactly what error you want to find, and exactly how that erroneous case works. \n\nA statetest doesn't have to fail, if the stateroot is correct. Rejected tx is fine",
        "created_at": "2021-05-31T20:58:45.986000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "It's not a failed transaction: it's _invalid_ transactions",
        "created_at": "2021-05-31T21:00:03.015000+00:00",
        "attachments": null
    },
    {
        "author": "oripomerantz",
        "category": "Testing",
        "parent": "",
        "content": "You're right on the terminology, but a transaction with `MaxPriorityFeePerGas \u003e MaxFeePerGas`, for example, is invalid.",
        "created_at": "2021-05-31T21:02:00.160000+00:00",
        "attachments": null
    },
    {
        "author": "oripomerantz",
        "category": "Testing",
        "parent": "",
        "content": "Invalid attempted transactions do not end up in the block, so they don't invalidate it.",
        "created_at": "2021-05-31T21:02:46.656000+00:00",
        "attachments": null
    }
]