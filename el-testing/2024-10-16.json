[
    {
        "author": "daniellehrner",
        "category": "Testing",
        "parent": "",
        "content": "Is the following point of 7702 already tested in the execution spec test?\n\n\u003e If transaction execution results in failure (any exceptional condition or code reverting), setting delegation designations is not rolled back.\n\nI have not yet implemented it in Besu and 5 tests are still failing, but none of them seems to be related to keeping an auth after a failed transaction.",
        "created_at": "2024-10-16T13:06:44.612000+00:00",
        "attachments": null
    },
    {
        "author": "danceratopz",
        "category": "Testing",
        "parent": "",
        "content": "Delegation clearing is covered by this test, but as I understand it, it looks like it's not consistent with this point (\"setting delegations is not rolled back\").\n- https://ethereum.github.io/execution-spec-tests/pectra-devnet-4@v1.0.1/tests/prague/eip7702_set_code_tx/test_set_code_txs/test_delegation_clearing_failing_tx/\n\n\u003c@508125616940515329\u003e could you take a look? Have I misinterpreted something here? (Mario's ooo until next week, btw.)",
        "created_at": "2024-10-16T14:27:05.306000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I will check, I am fairly certain that the delegation happens also if the execution fails ðŸ™‚",
        "created_at": "2024-10-16T14:28:53.123000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Could you list the tests which fail?",
        "created_at": "2024-10-16T14:29:30.557000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I just checked:\n\nThis test; `test_delegation_clearing_failing_tx[fork_Prague-blockchain_test-out_of_gas]`\n\nHas 0xa94 delegated to 0x00..001000 pre-state\nHas one tx: sets 0xa94 to 0x00..00 as delegation (so clears delegation)\nThis tx itself runs OOG\nThe post-state has 0xa94 cleared of 0x00.001000 (so code is now empty). Plus the nonce is bumped from 0x01 -\u003e 0x02. This should be included in the fixtures which were released (at least 1.0.0, not sure if 1.0.1 was also filled by EthJS)",
        "created_at": "2024-10-16T14:53:41.729000+00:00",
        "attachments": null
    },
    {
        "author": "danceratopz",
        "category": "Testing",
        "parent": "",
        "content": "All right, thanks! Both `pectra-devnet-4@0v1.0.0` and `pectra-devnet-4@0v1.0.1` were filled with ethjs. There are no differences in the fixtures for this particular test `test_delegation_clearing_failing_tx` across 1.0.0 and 1.0.1.\n\nBtw, if you have the fixtures handy, you can check the `_info` section, which will tell you which `t8n` filled them:\n```json\n        \"_info\": {\n            \"hash\": \"0xc4e7570d49dc12136d4505591b06193d5219f52a290f16cad92a74193604e799\",\n            \"comment\": \"`execution-spec-tests` generated test\",\n            \"filling-transition-tool\": \"ethereumjs t8n v1\",\n            \"description\": \"Test function documentation:\\n\\n    Test clearing the delegation of an account in a transaction that fails, OOGs or reverts.\",\n            \"url\": \"https://github.com/ethereum/execution-spec-tests/blob/pectra-devnet-4@v1.0.1/tests/prague/eip7702_set_code_tx/test_set_code_txs.py#L3055\",\n            \"reference-spec\": \"https://github.com/ethereum/EIPs/blob/master/EIPS/eip-7702.md\",\n            \"reference-spec-version\": \"4334df83395693dc3f629bb43c18320d9e22e8c9\"\n        }\n```",
        "created_at": "2024-10-16T15:02:15.758000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Ah great ðŸ˜„ Yes I have not yet ran 1.0.1 on our side but if we filled them we should pass (although this could be a nice sanity check, if we fill tests also make sure we pass them, since our filler != our test runner ðŸ™‚ )",
        "created_at": "2024-10-16T15:44:30.906000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "We also pass 1.0.1. I should add a EthJS commit to the filler version of t8n / repo (it's now a stub \"v1\" ðŸ™‚ )",
        "created_at": "2024-10-16T23:17:16.253000+00:00",
        "attachments": null
    }
]