[
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@892053833121923094\u003e is there a way to dump files to t8n from execution-spec-tests/fill?",
        "created_at": "2023-07-20T12:03:15.017000+00:00",
        "attachments": []
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "I donÂ´t think we have anything like this yet, but we can implement it to help debugging all the transition tools.\n\nNormally I place breakpoints on the call the call to t8n and verify the information using that, but it's not optimal.\n\nI'll open an issue to track this but feel free to drop in and describe if you have any other ideas that would help debugging",
        "created_at": "2023-07-20T14:07:43.160000+00:00",
        "attachments": []
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "A full command for a failing t8n invocations would be great, but not a priority",
        "created_at": "2023-07-20T14:49:59.100000+00:00",
        "attachments": []
    },
    {
        "author": "_shemnon",
        "category": "Testing",
        "parent": "",
        "content": "When developing the besu t8n server such dumps were invaluable.  Locally I added print statements right after the call to execute.  Currently that would be around line 129 in state_test.py.  There are so many ways a test can fail after that point I just always added them.  Perhaps we gate that with a `--debug` flag in the fill command instead?",
        "created_at": "2023-07-20T15:33:24.642000+00:00",
        "attachments": []
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@892053833121923094\u003e the first t8n call has empty transaction list?",
        "created_at": "2023-07-20T15:40:05.222000+00:00",
        "attachments": []
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Yes that is correct, the reason being that it uses t8n to calculate the state root of the starting alloc, also should not add any rewards to the coinbase",
        "created_at": "2023-07-20T15:41:24.912000+00:00",
        "attachments": []
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "Classic",
        "created_at": "2023-07-20T15:43:52.552000+00:00",
        "attachments": []
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Let me see if I can open up a quick PR just to make this possible",
        "created_at": "2023-07-20T15:50:28.092000+00:00",
        "attachments": []
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Btw \u003c@425274498732916736\u003e evmone mcopy tests will start failing with this PR: https://github.com/ethereum/execution-spec-tests/pull/217\nBecause the python filler will now check the returned header fields from t8n instead of trusting blindly, and evmone using Cancun fork does not seem to return 4844 header fields",
        "created_at": "2023-07-20T15:53:47.821000+00:00",
        "attachments": []
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "No problem, the more checks the better. But I'm also working on 4844 right now",
        "created_at": "2023-07-20T16:01:45.582000+00:00",
        "attachments": []
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Awesome, thanks! ðŸ™‚",
        "created_at": "2023-07-20T16:03:21.481000+00:00",
        "attachments": []
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "Why is t8n getting this? `ShanghaiToCancunAtTime15k`.",
        "created_at": "2023-07-20T17:04:58.309000+00:00",
        "attachments": []
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "It's the transition fork to Cancun, basically it means that blocks with `timestamp \u003c 15_000` are shanghai, and then on `timestamp \u003e= 15_000` Cancun should be activated",
        "created_at": "2023-07-20T17:06:04.559000+00:00",
        "attachments": []
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "It's used to test the start values of `excessDataGas`",
        "created_at": "2023-07-20T17:06:33.133000+00:00",
        "attachments": []
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "Ok, but `t8n` processes one block at a time so you can first invoke it with Shanghai and then with Cancun.",
        "created_at": "2023-07-20T17:09:18.372000+00:00",
        "attachments": []
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "That is true, I don't quite remember at the moment if there was another reason why we could not do this, this is the way retesteth does too.\nHey \u003c@393119312350543872\u003e  , do you remember why do we need the transition forks instead of doing separate calls with each of the appropriate fork names ?",
        "created_at": "2023-07-20T17:14:52.655000+00:00",
        "attachments": []
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "Retesteth doesn't do this. I opened an issue in pyspecs about this fork.\n\nThe forkname is present in tests for the test generation/execution tools. \n\nBut when I generate I do the blockchain logic check manually since we agreed t8n doesn't do blockchain logic other than finalization",
        "created_at": "2023-07-20T17:18:48.325000+00:00",
        "attachments": []
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "There was also an issue in geth t8n to remove this names from help.",
        "created_at": "2023-07-20T17:19:35.666000+00:00",
        "attachments": []
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Yes, I guess we could remove this too from pyspecs, let me finish the debug info dump PR and will see if this can be done simply",
        "created_at": "2023-07-20T17:30:37.895000+00:00",
        "attachments": []
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "The name remains in the test so that other runners could see which transition is happening in the blockchain test",
        "created_at": "2023-07-20T17:56:13.117000+00:00",
        "attachments": []
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "I have one more question: it looks like we need to control block-level values when processing the array of transactions. In particular, data_gas_used not to exceed block's data gas limit. I don't think we had this for legacy gas limit before (at least evmone does not check this). What do you exactly expect from this?",
        "created_at": "2023-07-20T19:26:39.340000+00:00",
        "attachments": []
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "I think that ideally t8n should not care about this, and simply execute the transactions in full, the failure is expected in the client but that's when we execute the full blockchain test",
        "created_at": "2023-07-20T19:31:47.382000+00:00",
        "attachments": []
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "The reason being that if we specifically want to test block failure due to not enough data gas, everything else should be ok, including state root, subtraction of fees of txs, etc, just to properly isolate that specific check",
        "created_at": "2023-07-20T19:33:12.011000+00:00",
        "attachments": []
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Ah, but it seems like we do expect an error on the last tx in the tests' current form: https://github.com/ethereum/execution-spec-tests/blob/e67c6c9ce3ec97768a357a8a8e6fd9696db6a893/tests/cancun/eip4844_blobs/test_blob_txs.py#L269C28-L269C28\n\nI think this is incorrect from our side.",
        "created_at": "2023-07-20T19:35:53.944000+00:00",
        "attachments": []
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "I implemented this and it passes these tests now.",
        "created_at": "2023-07-20T20:13:36.644000+00:00",
        "attachments": []
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "But this is rather a question what the array of transactions actually represent...",
        "created_at": "2023-07-20T20:14:57.624000+00:00",
        "attachments": []
    },
    {
        "author": "chfast",
        "category": "Testing",
        "parent": "",
        "content": "Anyway, current evmone status: only 2 failures remain.\n```\nFAILED tests/cancun/eip4844_blobs/test_blob_txs.py::test_invalid_tx_max_fee_per_data_gas[fork=Cancun-insufficient_max_fee_per_data_gas] - Exception: tx expected to fail succeeded: pos=0, nonce=0\nFAILED tests/cancun/eip4844_blobs/test_blob_txs.py::test_blob_tx_attribute_value_opcode[fork=Cancun-tx_gas=500000-tx_value=0-opcode=CALLVALUE] - Exception: tx unexpectedly failed: insufficient funds for gas * price + value **\n```",
        "created_at": "2023-07-20T20:15:28.544000+00:00",
        "attachments": []
    },
    {
        "author": "_shemnon",
        "category": "Testing",
        "parent": "",
        "content": "Yea, limiting max blobs is a block issue not a transaction issue (except maybe for too many blocks in a single transaction).  So should `b11r`  be enforcing that?",
        "created_at": "2023-07-20T20:21:44.352000+00:00",
        "attachments": []
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "I think it should even get past b11r because we want a seemingly valid block to be delivered, e.g. in hive, via the engine api, so we properly test rejection by the client",
        "created_at": "2023-07-20T21:08:47.525000+00:00",
        "attachments": []
    }
]