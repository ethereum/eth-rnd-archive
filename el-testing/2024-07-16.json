[
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "I figured out the problem. Thank you for support! Bug was that beneficiary gets touched (created) even if gas price is zero and we are not transfering any value. (This was related with state clear that I tried to debug with)",
        "created_at": "2024-07-16T12:02:18.967000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "One of tests that i would to see is authorization on fully empty account that gets its storage changed, all account in tests have at least some balanse. This tests how state clear with a eip7702",
        "created_at": "2024-07-16T12:06:57.333000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Yes! Great test! I think by EIP161 the account should still get cleared even if we write storage to it - right?",
        "created_at": "2024-07-16T12:09:15.099000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "(if it has no balance and zero nonce)",
        "created_at": "2024-07-16T12:09:43.222000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "That is what i want to figure out. And clearing would be my assumed behaviour here",
        "created_at": "2024-07-16T12:11:46.587000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "We have simulated this in an internal test in EthJS, the account should get cleared ðŸ™‚",
        "created_at": "2024-07-16T12:12:20.848000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Let me find the test",
        "created_at": "2024-07-16T12:12:23.987000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "Question is does that storage get saved or not?",
        "created_at": "2024-07-16T12:12:33.591000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Nope, the storage gets wiped",
        "created_at": "2024-07-16T12:12:40.033000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "Would assume same",
        "created_at": "2024-07-16T12:12:53.702000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "The problem is that with EIP 7702 it is now possible (which was not possible before (except before Homestead I think)) to create accounts which are empty by EIP 161, but have storage",
        "created_at": "2024-07-16T12:13:25.558000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "EIP 161 defines accounts as \"empty\" if they have 0 balance, 0 nonce, and no code (but the storage does not matter)",
        "created_at": "2024-07-16T12:13:39.997000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "https://github.com/ethereumjs/ethereumjs-monorepo/blob/4c5d788cf9e25759bf3c650fb9a77b87fd4677a9/packages/vm/test/api/EIPs/eip-7702.spec.ts#L265",
        "created_at": "2024-07-16T12:14:01.190000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Here is the test ðŸ™‚",
        "created_at": "2024-07-16T12:14:04.804000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I have raised this concern on the EIP some times, but I think in the \"new\" version of the EIP this is not a problem anymore (or there was a proposed EIP which actually expands EIP 161 to also mark accounts with storage as non-empty)",
        "created_at": "2024-07-16T12:14:57.495000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Ah, this one was proposed https://github.com/ethereum/pm/issues/1080#issuecomment-2204191782",
        "created_at": "2024-07-16T12:15:48.987000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "Ty for heads up, will check this",
        "created_at": "2024-07-16T12:15:56.217000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Hmm I can't seem to find any proposed changes to 7702 which would mitigate this problem, and the EIP 161 deactivation also seems to be withdrawn. I was at the ACD call but I don't remember why it was withdrawn ðŸ˜…",
        "created_at": "2024-07-16T12:18:45.952000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Nvm, found it",
        "created_at": "2024-07-16T12:21:04.468000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@429719902363058177\u003e in the \"new\" version of 7702 (devnet-2), we have this line:\n\n`6. Increase the nonce of authority by one.`",
        "created_at": "2024-07-16T12:21:29.169000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "So, the account you write storage to will never have zero nonce ðŸ™‚",
        "created_at": "2024-07-16T12:21:40.689000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "That solves it, good solution",
        "created_at": "2024-07-16T12:29:08.556000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "This is because a current issue with geth where the authorization does not work if the balance of the authorizing account is zero, but this will be changed to the default of zero:\nhttps://github.com/ethereum/execution-spec-tests/blob/32f2ebf89075db51c54237c518ed99e784ceee03/tests/prague/eip7702_eoa_code_tx/test_eoa_code_txs.py#L38",
        "created_at": "2024-07-16T14:25:30.861000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Testing",
        "parent": "",
        "content": "fyi i just fixed this ^\n\nbut since we'll be changing 7702 a bit in devnet-2, i don't think we need to focus much on testing the current impl",
        "created_at": "2024-07-16T17:58:35.578000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Yes good point ðŸ™‚",
        "created_at": "2024-07-16T19:32:38.221000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "However, these kind of \"bugs\" might get triggered on devnet-1, and the case of the empty account now getting storage is not really an edge case I think",
        "created_at": "2024-07-16T19:33:01.660000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Testing",
        "parent": "",
        "content": "PSA: donâ€™t send 7702 txs in devnet 1 ðŸ˜‡",
        "created_at": "2024-07-16T19:48:10.217000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "\u003e In case a delegation designator points to another designator, creating a potential chain or loop of designators, clients must retrieve only the first code and then stop following the designator chain.\n\nHow would this work? Would it try to execute `0xEF0100` ?",
        "created_at": "2024-07-16T20:16:58.572000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "(in case of CALL)",
        "created_at": "2024-07-16T20:17:37.358000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "Testing",
        "parent": "",
        "content": "That's why we can never allocate `0xEF`, it's now a defacto \"something is wrong\" op code.",
        "created_at": "2024-07-16T22:46:26.756000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Yes ðŸ™‚ But in the context of the change of 7702, I at this moment do not completely understand what *should* happen in case of multiple designators",
        "created_at": "2024-07-16T23:02:26.046000+00:00",
        "attachments": null
    }
]