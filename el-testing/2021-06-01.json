[
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "Right. But the resulting block is empty. So the blockchain test is moot.",
        "created_at": "2021-06-01T05:17:01.101000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "Trying to update to the most recent tests now, for geth. Q: `GeneralStateTests/VMTests/vmArithmeticTest/add.json`has a london section. What is the `baseFee` for the block? Is it the initial basefee?",
        "created_at": "2021-06-01T07:02:12.745000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "Now I'm trying e.g. `GeneralStateTests/stExtCodeHash/codeCopyZero.json`. WIth basefee of `0x10`, which I've seen in the retesteth code, I get\n```\n            state_test.go:100: post state root mismatch: got a7a08073c2056a211a5ccaccd85b9fad63ae25285552b68b2bb2135fbc29b051, want 7cac3ec110fe9591560520cfb18e4c82409b3326be4d48d58058600d0917584e\n```",
        "created_at": "2021-06-01T07:34:15.664000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "Ok, the `baseFee`, when not specified, seems to be `0xa`.",
        "created_at": "2021-06-01T07:40:42.578000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "Which is exactly what happened here: https://github.com/ethereum/tests/blob/develop/BlockchainTests/ValidBlocks/bcEIP1559/transFail.json",
        "created_at": "2021-06-01T09:54:00.360000+00:00",
        "attachments": null
    },
    {
        "author": "oripomerantz",
        "category": "Testing",
        "parent": "",
        "content": "In a blockchain test usually blocks have multiple transactions, only some of which are invalid. So there is still a block with transactions.\n\n\u003c@!393119312350543872\u003e , why do we sometimes get \"notinit\" in the filled JSON? I assume it's a problem with the filler, but do you know why and how to avoid it?",
        "created_at": "2021-06-01T11:54:17.782000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "Yes its an error during test filling. The message is not descriptive again after update",
        "created_at": "2021-06-01T12:00:27.941000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "The default basefee for legacy state tests env section is 0x0a it is stated in release note",
        "created_at": "2021-06-01T12:01:23.911000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "invalid: 1  in test filler means the transaction is checked to be rejected during the test filling. but it does not end up in the result test. \n\nwhat martin means here is an invalid RLP calculated on a tool that accept such transaction \nor a ttTransaction test that are not supported",
        "created_at": "2021-06-01T12:30:18.346000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "we can extend the state test to ask the client: \n\n\"Do you reject this tr rlp on this inputs (pre,env) ? \" \n\nthe qestion is how can we run it on hive ?",
        "created_at": "2021-06-01T12:33:26.792000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "We don't. We can't. Statetests are the only ones that can catch this.",
        "created_at": "2021-06-01T12:40:56.154000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "No extension needed",
        "created_at": "2021-06-01T12:41:43.007000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "hm we need an extension. state test format assume the transaction is intrinsicly valid",
        "created_at": "2021-06-01T12:42:59.310000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "smth like a field: \n\"make sure this is invalid transaction\" \nor poststate hash 0",
        "created_at": "2021-06-01T12:45:12.490000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "fixed",
        "created_at": "2021-06-01T12:54:07.609000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "what we can do possibly is in blockchain test format \nwhen after client has `genesis -\u003e import block 1 -\u003e import block2 ` for example \nwe can print all the list of transactions for block3 \nand then hive can call send_raw transaction and make sure it is rejected if it is invalid \neth_sendRawTransaction  should report an invalid transaction rlp right?",
        "created_at": "2021-06-01T13:04:51.028000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "it is the same as saying\n`look here we have the pre state of block2  and this transaction t2 on this state is supposed to fail after t1`",
        "created_at": "2021-06-01T13:07:06.402000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "I'm not so sure about that. I'll make one such statetest myself to see how geth behaves with it",
        "created_at": "2021-06-01T13:07:41.630000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "I see it more like, \"prestate is X, now (try to) apply tx A, and post-state should (still) be X (becaues the tx could not be applied)\" -- if we do it as a statetest",
        "created_at": "2021-06-01T13:09:02.283000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "the thing is in blockchain tests there are already scenarious with invalid transactions. I want to use them too",
        "created_at": "2021-06-01T13:09:51.487000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "and validity of transaction changes depending on previous transactions and blockheader",
        "created_at": "2021-06-01T13:10:17.642000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "when filling a test I check this",
        "created_at": "2021-06-01T13:10:36.974000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "but in filled test there is no information about invalid transactions",
        "created_at": "2021-06-01T13:10:54.966000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "(the t8ntool says \"rejected: \"index\")",
        "created_at": "2021-06-01T13:11:30.649000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "Here's a statetest which rejects the tx but passes in geth (after I added some support for the new fields) : https://gist.github.com/holiman/3980a3e2cf140379cfddaa514221b204",
        "created_at": "2021-06-01T13:35:53.542000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@\u0026836981603216654336\u003e \u003c@\u0026595684226221735986\u003e can you also try that test^ -- does it work on your codebases?",
        "created_at": "2021-06-01T13:36:17.562000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "Right. But then you're back at executing the tests via the fillers. And you can only do that on clients which have implemented retesteth support. So the result of the filling, the actual blockchain test artefact, is _not_ an actual test any longer, just a strange empty marker",
        "created_at": "2021-06-01T13:37:40.875000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "So, once again, we _need_ statetests, because they can cover things that blockchain tests cannot. I don't know how many times we need to have this discussion...",
        "created_at": "2021-06-01T13:38:21.010000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "eth_ methods are not supported  on hive?",
        "created_at": "2021-06-01T13:38:32.272000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "Hive can do a lot of things. The consensus-test-runner, which is based on importing rlp blocks, does not have any capability to do that",
        "created_at": "2021-06-01T13:39:06.485000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "there is no difference in state tests to blockchain tests from my point of view. I make state tests the same way I do blockchain tests thats why",
        "created_at": "2021-06-01T13:39:07.418000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "so if we need a custom state test runner then I see no reason why a custom test runner cant do transaction verification in blockchain test as well",
        "created_at": "2021-06-01T13:40:10.558000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "Right, well, if you only use the \"blockchainy\" aspects of statetests, then you have chosen to ignore the extra dimension of expressability which is inherently only present in statetests, and missing in blockchain tests",
        "created_at": "2021-06-01T13:40:13.029000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "We client devs can use statetests to exchange testcases that define how a client should react, on a given prestate, when applying a given transaction. It's a very well-compartmentalized testcase which has cross-client support, and a long historic usage. All clients have it, and we use it as the basis for fuzzing. It's nothing new",
        "created_at": "2021-06-01T13:41:47.610000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "You may call it a custom test-runner, fair, but it's already supported by _all_ clients natively",
        "created_at": "2021-06-01T13:42:15.794000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "we kind of missing the invalid transaction check on those clients that don't do the filling of blockchain tests.",
        "created_at": "2021-06-01T13:42:56.107000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "I can at least export those fields in blockchain test to let other clients know that there was a transaction rejection check in this block.",
        "created_at": "2021-06-01T13:43:51.962000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "cc \u003c@\u0026652918665943056397\u003e ^",
        "created_at": "2021-06-01T13:45:02.842000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "also want to discuss is it ok to remove transaction from state test  or we need it for human read ?",
        "created_at": "2021-06-01T13:46:35.297000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "I don't understand the question. Remove transaction? That only leaves a prestate and a poststate???",
        "created_at": "2021-06-01T14:03:49.854000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "yes. because there is rawBytes field in the post state",
        "created_at": "2021-06-01T14:04:11.026000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "and it is already signed",
        "created_at": "2021-06-01T14:04:18.702000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "and no need to construct vector and calculate indexes",
        "created_at": "2021-06-01T14:04:32.934000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "Why is it in the poststate??",
        "created_at": "2021-06-01T14:04:36.474000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "```\n        \"post\" : {\n            \"Berlin\" : [\n                {\n                    \"indexes\" : {\n                        \"data\" : 0,\n                        \"gas\" : 0,\n                        \"value\" : 0\n                    },\n                    \"hash\" : \"0x92575ea202220f5f34292941b2ed9d6821c29f221d3ea417682b872d18094c55\",\n                    \"txbytes\" : \"0x01f8f901800a83061a8094095e7baea6a6c7c4c2dfeb977efac326af552d87830186a000f893f85994095e7baea6a6c7c4c2dfeb977efac326af552d87f842a00000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000001f794195e7baea6a6c7c4c2dfeb977efac326af552d87e1a0000000000000000000000000000000000000000000000000000000000000000080a011c97e0bb8a356fe4f49b37863d059c6fe8cd3214a6ac06a8387a2f6f0b75f60a0212368a1097da30806edfd13d9c35662e1baee939235eb25de867980bd0eda26\",\n                    \"logs\" : \"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347\"\n                },\n````",
        "created_at": "2021-06-01T14:05:17.510000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "Ah, I see",
        "created_at": "2021-06-01T14:05:53.832000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "but I assume it might break many executors.",
        "created_at": "2021-06-01T14:05:57.507000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "it kind of handy if devs are only using the filled test they can human read the rlp content",
        "created_at": "2021-06-01T14:06:21.408000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "but again the indexes",
        "created_at": "2021-06-01T14:06:40.285000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "I think we should keep the transaction.",
        "created_at": "2021-06-01T14:10:10.050000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "Geth just looks at the key and converts it to an address, it doesn't actually sign a full transaction and derive the sender",
        "created_at": "2021-06-01T14:10:11.184000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "So theoretically it would be super simple to just have an arbitrary sender which we don't have the key for",
        "created_at": "2021-06-01T14:10:37.093000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "ok. I think now too. to keep it is better. it is not so heavy",
        "created_at": "2021-06-01T14:11:39.511000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "like this in blockchain test \n```\n        \"blocks\" : [\n            {\n                \"chainname\" : \"default\",\n                \"blocknumber\" : \"1\",\n                \"uncleHeaders\" : [\n                ],\n                \"blockHeader\" : {\n                    ///header info\n                },\n                \"transactions\" : [\n                ],\n                \"sequence\" : [\n                    {\n                        \"rawBytes\" : \"0xf901fb803282c3508080b901ae60056013565b6101918061001d6000396000f35b3360008190555056006001600060e060020a6000350480630a874df61461003a57806341c0e1b514610058578063a02b161e14610066578063dbbdf0831461007757005b610045600435610149565b80600160a060020a031660005260206000f35b610060610161565b60006000f35b6100716004356100d4565b60006000f35b61008560043560243561008b565b60006000f35b600054600160a060020a031632600160a060020a031614156100ac576100b1565b6100d0565b8060018360005260205260406000208190555081600060005260206000a15b5050565b600054600160a060020a031633600160a060020a031614158015610118575033600160a060020a0316600182600052602052604060002054600160a060020a031614155b61012157610126565b610146565b600060018260005260205260406000208190555080600060005260206000a15b50565b60006001826000526020526040600020549050919050565b600054600160a060020a031633600160a060020a0316146101815761018f565b600054600160a060020a0316ff5b561ba04d2aeb53154952b3a3d4718d8a11476c1165f8b53fad1c16e7c27d2a0df29298a0695d3859403ff7ae34072e8f48f29d603aef37fff7d01e55f32de724c9492239\",\n                        \"valid\" : \"false\"\n                    }\n                ],\n                \"rlp\" : \"//rlpinfo\"\n            },\n```",
        "created_at": "2021-06-01T14:12:27.464000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "I can add a new field sequence  with the transaction rawBytes that are being executed on pre state in this block",
        "created_at": "2021-06-01T14:12:59.323000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "look that transactions section is empty as the transaction is expected to fail",
        "created_at": "2021-06-01T14:13:17.248000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "so the block rlp is empty (does not have the transaction)  but manual test runner can still check that it would reject such and rlp from the sequence",
        "created_at": "2021-06-01T14:13:46.761000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "also easier to extract transaction rlps from the block",
        "created_at": "2021-06-01T14:14:22.402000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "downside - more space",
        "created_at": "2021-06-01T14:14:26.643000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "I plan to move LegacyTest folder in a separate repo as it is 300 mb",
        "created_at": "2021-06-01T14:14:40.934000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "and in StateTests we can add in post state a field that says that transaction rawBytes exec on a preState is expected to be rejected",
        "created_at": "2021-06-01T14:15:38.110000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "such as postHash remains of a preState",
        "created_at": "2021-06-01T14:15:56.497000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "Why not just set the poststate to the poststate? Why do you think it needs any change?",
        "created_at": "2021-06-01T14:16:15.675000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "My testcase above shows that it's already working fine",
        "created_at": "2021-06-01T14:16:43.879000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Testing",
        "parent": "",
        "content": "I think is worth indicating explicitly that a transaction is  expected to be rejected. (the parse is optional)",
        "created_at": "2021-06-01T14:17:24.564000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "\u003e (the parse is optional)\nYeah, then sure, if we can consider it metadata and ignore it",
        "created_at": "2021-06-01T14:17:56.884000+00:00",
        "attachments": null
    }
]