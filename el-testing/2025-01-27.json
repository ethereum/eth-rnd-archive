[
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Hi, the EEST team has to confirm, but I think this specific test tests the behavior if the system contract is NOT deployed at the fork. The reasoning for this is that the system contract is deployed by normal means: i.e. a transaction. The transaction can be found here: https://github.com/ethereum/EIPs/blob/master/EIPS/eip-2935.md#deployment\n\nIf the tx is sent before the fork, all works as expected. If this is not the case, then the system contract is not deployed and we have some additional logic (or actually: \"non-logic\" since nothing happens). From the EIP:\n\n`if no code exists at HISTORY_STORAGE_ADDRESS, the call must fail silently`\n\nSee: https://github.com/ethereum/EIPs/blob/master/EIPS/eip-2935.md#block-processing\n\nHow does Besu handle this system contract? Does it write to the system storage directly? Or does it perform an EVM call into the contract? \n\nEthJS checks if the system contract is present when performing EIP-2935 logic and if it is not there, then it will exit early:\n\n```ts\n  const code = await vm.stateManager.getCode(historyAddress)\n\n  if (code.length === 0) {\n    // Exit early, system contract has no code so no storage is written\n    return\n  }\n```",
        "created_at": "2025-01-27T04:52:37.956000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "Testing",
        "parent": "",
        "content": "This is the exact test `FAILED tests/prague/eip2935_historical_block_hashes_from_state/test_contract_deployment.py::test_system_contract_deployment[fork_CancunToPragueAtTime15k-blockchain_test-deploy_after_fork] - ethereum_test_types.types.Alloc.MissingAccountError: Account missing from allocation 0x0f792be4b0c0cb4dae440ef133e90c0ecd48cccc`\n(and it dumps 4 directories under here, it's the last one that seems to have this issue `./prague-2935-fix/prague__eip2935_historical_block_hashes_from_state__test_contract_deployment__test_system_contract_deployment/fork_CancunToPragueAtTime15k_blockchain_test_deploy_after_fork/3/`)\n\nSo yes it is after the fork as you say.\nBesu does write to the storage directly, not via a contract.\n\nHowever, the test input and output have it like this in alloc.json\n```\n    \"0x0f792be4b0c0cb4dae440ef133e90c0ecd48cccc\": {\n        \"nonce\": \"0x00\",\n        \"balance\": \"0x00\",\n        \"code\": \"0x\",\n        \"storage\": {\n            \"0x02\": \"0x78af9a0fe2366992c84daa5ceac63bff676599fe9a0fcfd085f10ff29301af4e\"\n        }\n    },\n```\nso I think the expectation is it still exists.",
        "created_at": "2025-01-27T05:05:21.822000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Besu EIP-2935 tests failing thread",
        "created_at": "2025-01-27T05:07:16.895000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "Testing",
        "parent": "",
        "content": "just confirming this isn't an EEST issue, rather a besu/me issue ðŸ™‚",
        "created_at": "2025-01-27T08:35:46.456000+00:00",
        "attachments": null
    }
]