[
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "Still not getting it. Tried few alternatives where auth bytecode stays but still getting from hash:\n```\nState root with storage, bytecode reverted (auth cleanup):\n{ got: 0xedb5e3179134e8afe269cdb8eee00f8227f359d367b21e17a88606fafcfd69e2, on expected 0xebf80fe37d75bd3607172e20bdf4beb322e0453b48045fd7a2b15dbd6a29b6ec }\n\nStat root without storage, bytecode reverted (auth cleanup):\n{ got: 0x70cb58568299d4e3ad7a78d04311dd380587cad0adbaafb4bd1bf07dbcee1265, expected: 0xebf80fe37d75bd3607172e20bdf4beb322e0453b48045fd7a2b15dbd6a29b6ec }Ã\n\nstate root without auth cleanup (Bytecode stays at 0xa94f537..) storage present.\nStateRootMismatch { got: 0x9e4df484f93e2c5eb8ed5e1f4ce1a076073a031ef4d5493b351e71b214dae139, expected: 0xebf80fe37d75bd3607172e20bdf4beb322e0453b48045fd7a2b15dbd6a29b6ec }\n```",
        "created_at": "2024-07-12T14:45:37.310000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "Hey, are you matching the state root from tests? Trying to run same tests but can't get expected state root",
        "created_at": "2024-07-12T14:48:02.371000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Yes, I think we match the state tests from the latest release",
        "created_at": "2024-07-12T15:01:44.829000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Let me check ğŸ™‚",
        "created_at": "2024-07-12T15:01:51.193000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I think you might apply other EIPs on top of the state test",
        "created_at": "2024-07-12T15:02:01.580000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "But this one is not applying any modifications to the history contract I think",
        "created_at": "2024-07-12T15:04:11.666000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Nvm, we fail some 7702 tests",
        "created_at": "2024-07-12T15:04:37.592000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Let me check if we fail all",
        "created_at": "2024-07-12T15:04:40.572000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I don't think I ran the 1.0.6 release yet",
        "created_at": "2024-07-12T15:04:54.596000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Try this one: https://github.com/ethereum/execution-spec-tests/releases/tag/devnet-1%40v1.2.0\nThis is the latest one",
        "created_at": "2024-07-12T15:05:22.997000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Sorry, I meant that one ğŸ™‚",
        "created_at": "2024-07-12T15:05:34.253000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I can confirm we fail all 7702 tests",
        "created_at": "2024-07-12T15:05:38.250000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "(state tests)",
        "created_at": "2024-07-12T15:05:40.822000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "blockchain tests are passing?",
        "created_at": "2024-07-12T15:05:50.114000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Just a sec, let me check ğŸ™‚ We fail all state tests in the 7702 state tests dir",
        "created_at": "2024-07-12T15:06:12.865000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "We fail EIP4788 and EIP7702 tests there",
        "created_at": "2024-07-12T15:09:21.866000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "On it ğŸ™‚",
        "created_at": "2024-07-12T15:09:29.533000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Wait, 4788 ğŸ‘€",
        "created_at": "2024-07-12T15:09:54.317000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "geth is failing state_tests too, blockchain tests are passing,",
        "created_at": "2024-07-12T15:10:49.630000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "We fail specifically the prague tests in the cancun dir of 4788",
        "created_at": "2024-07-12T15:11:11.068000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "And 7702 tests in the Cancun dir\n\nAh but wait ğŸ‘€ I now see the error it throws",
        "created_at": "2024-07-12T15:11:52.224000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Heh we have 7702 not enabled ğŸ˜…",
        "created_at": "2024-07-12T15:12:24.763000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "And we have the old AUTHCALL / AUTH enabled",
        "created_at": "2024-07-12T15:12:44.389000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Ok can now confirm we pass 7702 tests in blockchain but not in state",
        "created_at": "2024-07-12T15:14:04.065000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Ok I got geth to pass them now, it was because it was not reading the json field at all (authorizationList)",
        "created_at": "2024-07-12T15:22:26.933000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@543900561460822016\u003e created a PR for this: https://github.com/lightclient/go-ethereum/pull/65 ğŸ™Œ",
        "created_at": "2024-07-12T15:32:42.783000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "The state tests now require processing of the `authorizationList` field, so perhaps this is the reason ethjs is failing state tests but not the blockchain tests.\nThis is how a type-4 tx looks like in the state tests now:\n```json\n\"transaction\": {\n            \"nonce\": \"0x00\",\n            \"maxPriorityFeePerGas\": \"0x00\",\n            \"maxFeePerGas\": \"0x07\",\n            \"gasLimit\": [\n                \"0x989680\"\n            ],\n            \"to\": \"0xa94f5374fce5edbc8e2a8697c15331677e6ebf0b\",\n            \"value\": [\n                \"0x00\"\n            ],\n            \"data\": [\n                \"0x\"\n            ],\n            \"accessLists\": [\n                []\n            ],\n            \"authorizationList\": [\n                {\n                    \"chainId\": \"0x01\",\n                    \"address\": \"0x0000000000000000000000000000000000001000\",\n                    \"nonce\": [\n                        \"0x00\"\n                    ],\n                    \"v\": \"0x01\",\n                    \"r\": \"0x8171c0ded912d4f458b8115618c18f3f430f414919c73b4daa693c47fd325414\",\n                    \"s\": \"0x787741e1621bcb9cb58ece039ad73f41d9422aa259ed53c2b0bd30dc7ff09be7\",\n                    \"signer\": \"0xa94f5374fce5edbc8e2a8697c15331677e6ebf0b\"\n                }\n            ],\n            \"sender\": \"0x8a0a19589531694250d570040a0c4b74576919b8\",\n            \"secretKey\": \"0x9e7645d0cfd9c3a04eb7a9db59a4eb7d359f2e75c9164a9d6b9a7d54e1b6a36f\"\n        },\n```",
        "created_at": "2024-07-12T15:34:36.805000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "`\"signer\"` is just for information/debug purposes though.",
        "created_at": "2024-07-12T15:35:01.704000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "Awesome!",
        "created_at": "2024-07-12T15:43:31.466000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "Does this mean that state root was incorect?",
        "created_at": "2024-07-12T15:43:44.281000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Good point, will inspect! I am meanwhile figuring out why we fail 4788 tests ğŸ˜¦",
        "created_at": "2024-07-12T15:46:08.790000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "They seem to be ok by geth, we were outputting the correct thing in execution-spec-tests, but when executing the test it was not fully reading it back, but the test fixture seems to be ok",
        "created_at": "2024-07-12T15:47:32.691000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "Do you have a state root that you are outputing in state tests?",
        "created_at": "2024-07-12T16:04:01.006000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I will check in a moment if we pass the state tests if we load the authority field ğŸ™‚ In blockchain tests we read from the files' RLP, so the encoding there should not matter (it should just RLP decode the txs) in state tests however we load from the JSON",
        "created_at": "2024-07-12T16:06:34.988000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "We likely have a different field name for thoese authorityLists",
        "created_at": "2024-07-12T16:06:49.958000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I am currently debugging why we fail 4788 tests, it does not make much sense but I have found a way to pass the tests ğŸ™‚",
        "created_at": "2024-07-12T16:07:07.156000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Hey all, found why we found 4788 tests. They have nothing to do with 4788 (ok, well partially) they have to do with EIP 7002 and EIP 7251. We perform a call from the system address `0xff..fe`, but we also **update the nonce** of the system address ğŸ˜…",
        "created_at": "2024-07-12T16:16:51.185000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "We now pass all Prague tests ğŸ™‚",
        "created_at": "2024-07-12T16:19:07.087000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "(on blockchain)",
        "created_at": "2024-07-12T16:19:10.298000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Oh what version of the EIP is 7702 based?",
        "created_at": "2024-07-12T16:26:31.192000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "This one got merged 4 days ago https://github.com/ethereum/EIPs/pull/8677",
        "created_at": "2024-07-12T16:26:44.324000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "I thought that was going into devnet-2?",
        "created_at": "2024-07-12T16:27:13.090000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Oh wait, sorry, I see the test releases have permalinks to the EIPs ğŸ™‚ That's great",
        "created_at": "2024-07-12T16:27:31.058000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "It's not in ğŸ‘€ Could have been since the tests are from 2 days ago",
        "created_at": "2024-07-12T16:27:52.458000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "BTW it seems that we indeed do not support 7702 txs in our state test runner so that likely is what causes our errors",
        "created_at": "2024-07-12T16:28:07.495000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "We still fail the state tests ğŸ˜¦",
        "created_at": "2024-07-12T16:40:35.955000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Do you have an example of a test which uses this type 4 tx? It seems like we either don't instantiate them, or we fail them all",
        "created_at": "2024-07-12T16:41:31+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "We fail tests in the tests folders `./prague/eip7702_eoa_code_txs` (all of them)",
        "created_at": "2024-07-12T16:41:54.577000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "I'm about to release, I just realized this is necessary and didn't push the button yesterday ğŸ˜“",
        "created_at": "2024-07-12T16:42:29.084000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "https://github.com/ethereum/execution-spec-tests/releases/tag/devnet-1%40v1.3.0",
        "created_at": "2024-07-12T16:43:26.248000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@429719902363058177\u003e \u003c@508125616940515329\u003e please give this one a try ğŸ™",
        "created_at": "2024-07-12T16:43:51.834000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Oh no wait, we pass\n`tests/prague/eip7702_eoa_code_tx/test_eoa_code_txs.py::test_set_code_to_account_deployed_in_same_tx[fork_Prague-state_test-create_op_CREATE2]`\n`eoa_code_txs/set_code_to_account_deployed_in_same_tx.json test: tests/prague/eip7702_eoa_code_tx/test_eoa_code_txs.py::test_set_code_to_account_deployed_in_same_tx[fork_Prague-state_test-create_op_CREATE]`",
        "created_at": "2024-07-12T16:44:01.689000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Ah will do ğŸ˜„",
        "created_at": "2024-07-12T16:44:03.774000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Love new releases ğŸ˜„",
        "created_at": "2024-07-12T16:44:10.478000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "We still fail the same state tests it seems",
        "created_at": "2024-07-12T16:46:21.204000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Oh wait nvm I am running on the old fixtures",
        "created_at": "2024-07-12T16:48:36.894000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Now I get a different error ğŸ‘",
        "created_at": "2024-07-12T16:48:41.361000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Ok the encoding in the test uses the `v/r/s` signature scheme, I thought swe wapped this for `yParity/r/s` ?",
        "created_at": "2024-07-12T16:49:41.970000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Which example are you looking at? I see `\"v\": \"0x01\"` or `\"v\": \"0x00\"` in all authorization tuples",
        "created_at": "2024-07-12T16:56:18.012000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I thought this was a  general comment, the EIP itself talks also about yParity and I think since 1559 we have swapped `v` for `yParity`",
        "created_at": "2024-07-12T17:02:01.997000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "But I am currently renaming these vars, we pass all but 4 7702 tests now ğŸ™‚",
        "created_at": "2024-07-12T17:02:10.656000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Yeah, to be honest I don't remember paying attention to this detail in the EIP, it was automatic for me since it has been the default for so long ğŸ˜›",
        "created_at": "2024-07-12T17:03:26.241000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Yes it's not a problem I just convered it, we might also be too strict on our JSON loads for txs ğŸ™‚",
        "created_at": "2024-07-12T17:04:24.624000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "We now pass all state tests ğŸ˜„",
        "created_at": "2024-07-12T17:04:29.831000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "And also all blockchain tests ğŸ˜„",
        "created_at": "2024-07-12T17:07:47.798000+00:00",
        "attachments": null
    }
]