[
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Hey I donâ€™t have a response on hand for this, I need to dig in a bit, maybe \u003c@774033563732541451\u003e",
        "created_at": "2024-12-26T18:51:19.679000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I just realized I can also check the GH actions which released the fixtures to see what's going on there ðŸ˜…",
        "created_at": "2024-12-26T18:56:02.023000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Yes that is one of the advantages of building the fixtures directly in the CI, except for devnet-5 release which produced too many tests (not sure if this is the actual reason) and broke our CI ðŸ˜“",
        "created_at": "2024-12-26T19:10:48.930000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Aha seems like I was on the wrong branch ðŸ™‚",
        "created_at": "2024-12-26T19:15:01.505000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Ok, I still cannot get it to work. I am at the geth commit which filled the fixtures, and have downloaded the EEST source code from that release (commit it points to is outside the main repo). If I build geth and then run the tests, they still fail ðŸ¤” Also checked the CI action to see if there are any additional args used (there arent) ðŸ¤” \n\nWould love to know how to fill the tests so I can also use that geth binary to create local traces ðŸ˜„",
        "created_at": "2024-12-26T19:31:58.754000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@508125616940515329\u003e the `github.com/gballet/go-ethereum` branch to use to fill is the main branch `kaustinen-with-shapella`. In the main branch I created a gh workflow which always fill tests so we know they're never broken (https://github.com/gballet/go-ethereum/blob/kaustinen-with-shapella/.github/workflows/spec-tests-branch.yml#L44-L78).\n\nYour command looks correct. From the error, I feel you might not be pointing the a correct `--evm-bin` binary, which should be the compiled version of `./cmd/evm` from `github.com/gballet/go-ethereum` main branch (i.e: `kaustinen-with-shapella`)?\n\nJust ran `uv run fill --fork Verkle tests/verkle/eip4762_verkle_gas_witness -v -m blockchain_test --evm-bin=/data/kaustinen/go-ethereum/evm -k \"test_extcodehash\"` to verify, and all looks good. (Full output: https://pastebin.com/raw/Y4m3Dj0x)",
        "created_at": "2024-12-26T20:12:20.553000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I just re-tried, I re-built Geth with commit `f0d4c32e9522a672e1ec92cfe84a219a2b579b35`, this should be `gballet/kaustinen-with-shapella`. I explicitly checked that `evm-bin` points to the built binary, but I still get the same error ðŸ˜¦",
        "created_at": "2024-12-26T20:21:29.878000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "I don't get it, even the evm binary seems to be correct:\n\n```\nplatform linux -- Python 3.12.3, pytest-7.4.4, pluggy-1.5.0\nExecuting tests for: Verkle\nevm version 1.12.1-unstable-f0d4c32e-20241210, 0.8.24\n```",
        "created_at": "2024-12-26T20:26:41.961000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Testing",
        "parent": "",
        "content": "Sounds weird yeah. In my full output I'm compiling that exact same commit (apart from the fixtures are generated fine in that commit GH workflow https://github.com/gballet/go-ethereum/actions/runs/12264124411)",
        "created_at": "2024-12-26T20:28:04.872000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Testing",
        "parent": "",
        "content": "Are you sure the `evm` binary is in `~/Documents/ejs/clients/go-ethereum/build/bin/evm` ?",
        "created_at": "2024-12-26T20:28:39.740000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Testing",
        "parent": "",
        "content": "Maybe worth a `uv` clean and start fresh?",
        "created_at": "2024-12-26T20:29:05.948000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "How do I do that? ðŸ˜…",
        "created_at": "2024-12-26T20:29:21.164000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "For EEST is `verkle/main` the right branch?",
        "created_at": "2024-12-26T20:29:30.365000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "try `uv sync --reinstall`",
        "created_at": "2024-12-26T20:30:43.328000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "also if you add `--evm-dump-dir` to the fill command, you will see the exact output from the evm binary in the directory you specify",
        "created_at": "2024-12-26T20:31:52.208000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Testing",
        "parent": "",
        "content": "Yes\n```\n~/code/execution-spec-tests on î‚  verkle/main! âŒš 17:31:55\n$ git rev-parse HEAD                                                                                                                                     \n6e79a747ff200b1797f8279643f7c922b719874e\n```",
        "created_at": "2024-12-26T20:32:12.187000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Huh. I got it passing ... let me dump the working and non-working command",
        "created_at": "2024-12-26T20:36:38.813000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "When doing this, check the output of the t8n, `result.json`, it should contain a key named `state_diff`",
        "created_at": "2024-12-26T20:36:50.899000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Works: (copied from ignacio)\n`uv run fill --fork Verkle tests/verkle/eip4762_verkle_gas_witness -v -m blockchain_test --evm-bin=/home/jochem/Documents/ejs/clients/go-ethereum/evm -k \"test_extcodehash\"`\n\nDoes not work: \n`uv run fill --fork Verkle -k \"test_extcodehash[fork_Verkle-blockchain_test_engine-system_contract]\" --evm-bin=/home/jochem/Documents/ejs/clients/go-ethereum/evm --traces --evm-dump-dir=./dump/ tests/verkle/eip4762_verkle_gas_witness`",
        "created_at": "2024-12-26T20:37:10.668000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Testing",
        "parent": "",
        "content": "I confirmed that if I *don't* remove the square brackets part in `-k` I get your error.",
        "created_at": "2024-12-26T20:39:53.724000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "If you add them to -k right?",
        "created_at": "2024-12-26T20:40:21.512000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Testing",
        "parent": "",
        "content": "Yes",
        "created_at": "2024-12-26T20:40:45.202000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Weird, if I run this\n`uv run fill --fork Verkle tests/verkle/eip4762_verkle_gas_witness -v -m blockchain_test --evm-bin=/home/jochem/Documents/ejs/clients/go-ethereum/evm -k \"test_extcodehash[fork_Verkle-blockchain_test_engine-system_contract]\"`\n\nthen it does not test anything at all\n\nIf I instead do\n`uv run fill --fork Verkle tests/verkle/eip4762_verkle_gas_witness -v -m blockchain_test --evm-bin=/home/jochem/Documents/ejs/clients/go-ethereum/evm -k \"test_extcodehash\"` then it tests 8",
        "created_at": "2024-12-26T20:41:47.307000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "the -k contains `blockchain_test_engine` and that's mutually exclusive with `-m blockchain_test`",
        "created_at": "2024-12-26T20:43:29.653000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Oh whoops sorry indeed I forgot that those have `-m`. Anyways, I can now generate the traces ðŸ˜„ ðŸŽ‰",
        "created_at": "2024-12-26T20:44:07.255000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Testing",
        "parent": "",
        "content": "Thanks all ðŸ˜„",
        "created_at": "2024-12-26T20:44:15.340000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "I can reproduce your error with\n```\nuv run fill --fork Verkle tests/verkle/eip4762_verkle_gas_witness -v -m blockchain_test_engine --\nevm-bin=evm -k \"test_extcodehash[fork_Verkle-blockchain_test_engine-system_contract]\"\n```",
        "created_at": "2024-12-26T20:44:38.548000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "The blockchain engine version crashes while the blockchain version does pass, and checking the t8n commands they are indeed different, the engine version is missing the `--input.vkt=stdin`, so there's definitely a bug somewhere, I'll try to debug",
        "created_at": "2024-12-26T20:49:13.146000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Fix https://github.com/ethereum/execution-spec-tests/pull/1043 \u003c@774033563732541451\u003e",
        "created_at": "2024-12-26T20:55:38.425000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Thanks for finding and raising this! ðŸ™Œ",
        "created_at": "2024-12-26T20:57:06.210000+00:00",
        "attachments": null
    }
]