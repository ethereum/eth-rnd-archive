[
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "yes, devnet 1 seems be cruising along fine `info: Synced - slot: 3850 - head: 3850 0x62d1‚Ä¶b893 - finalized: 0x51c5‚Ä¶8e73:118 - peers: 15`",
        "created_at": "2021-11-23T03:56:39.622000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "I'm hitting a couple of fun problems with Geth.\nFirstly when it's the sealer for Clique pre-merge, when the TTD is reached it keeps crashing with:\n```\npanic runtime error: slice bounds out of range [:-39]\n\ngoroutine 74 [running]:\ngithub.com/ethereum/go-ethereum/consensus/clique.encodeSigHeader({0x857f140, 0xc000d78000}, 0xc000d78000)\n        github.com/ethereum/go-ethereum/consensus/clique/clique.go:736 +0x512\ngithub.com/ethereum/go-ethereum/consensus/clique.SealHash(0x1)\n        github.com/ethereum/go-ethereum/consensus/clique/clique.go:704 +0x7d\ngithub.com/ethereum/go-ethereum/consensus/clique.(*Clique).SealHash(0xc0000468f0, 0xc0000468f8)\n        github.com/ethereum/go-ethereum/consensus/clique/clique.go:682 +0x2e\ngithub.com/ethereum/go-ethereum/consensus/beacon.(*Beacon).SealHash(0x0, 0x1)\n        github.com/ethereum/go-ethereum/consensus/beacon/consensus.go:314 +0x33\ngithub.com/ethereum/go-ethereum/miner.(*worker).commit(0xc0001d4000, {0xc001bc7f20, 0xc001a7cfc0, 0x2}, 0x0, 0x0, {0x40ecfc5, 0x0, 0x5ee43e0})\n        github.com/ethereum/go-ethereum/miner/worker.go:1050 +0x591\ngithub.com/ethereum/go-ethereum/miner.(*worker).commitNewWork(0xc0001d4000, 0xc0000c1c6c, 0x0, 0x619c862b)\n        github.com/ethereum/go-ethereum/miner/worker.go:997 +0xcbe\ngithub.com/ethereum/go-ethereum/miner.(*worker).mainLoop(0xc0001d4000)\n        github.com/ethereum/go-ethereum/miner/worker.go:466 +0x67d\ncreated by github.com/ethereum/go-ethereum/miner.newWorker\n        github.com/ethereum/go-ethereum/miner/worker.go:233 +0x745\n```\n\nThis is with the latest from https://github.com/MariusVanDerWijden/go-ethereum/tree/kintsugi-spec",
        "created_at": "2021-11-23T06:21:26.163000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "yes the latest (on kintsugi-spec) has this issue",
        "created_at": "2021-11-23T06:21:59.194000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "i am using \u003c@!199561711278227457\u003e 's docker image",
        "created_at": "2021-11-23T06:22:07.828000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "`parithoshj/geth:merge-369a2f6`",
        "created_at": "2021-11-23T06:22:27.148000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Secondly, when it is sent a forkchoiceUpdated message with a head block hash it doesn't know (because it had crashed while teku executed that beacon block), it returns `INVALID` status which doesn't appear to be part of the spec.  I'm assuming switching to SYNCING just isn't supported yet?",
        "created_at": "2021-11-23T06:22:31.820000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "ok, will give it a go with that version. Thanks.",
        "created_at": "2021-11-23T06:24:02.030000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "if you are building locally \u003c@!360491619402776577\u003e  recommended to use this branch on his forked repo: `Beacon-ontopof-4399`",
        "created_at": "2021-11-23T06:24:36.766000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "this branch has been used to build `parithoshj/geth:merge-369a2f6` (i think)",
        "created_at": "2021-11-23T06:25:17.899000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "That branch doesn't appear to exist.",
        "created_at": "2021-11-23T06:25:47.711000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "oops b is small `beacon-ontopof-4399`",
        "created_at": "2021-11-23T06:26:52.696000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "ugh, I don't know how I didn't spot that version of it.. Thanks.",
        "created_at": "2021-11-23T06:27:58.502000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "yes \u003c@!425572898787426305\u003e confirmed this yesterday to be the expected response as SYNCING",
        "created_at": "2021-11-23T06:33:26.283000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "over here",
        "created_at": "2021-11-23T06:33:52.819000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "The EL has reached TTD in this case.",
        "created_at": "2021-11-23T06:34:20.722000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "here he adds on to the query ( Even in the case....)",
        "created_at": "2021-11-23T06:35:12.919000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "I was expecting a SYNCING response, but I'm actually getting INVALID. Are you saying that based on those discussions with Mikhail Geth's behaviour will change to return SYNCING in this case?",
        "created_at": "2021-11-23T06:36:32.520000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "if ~~blockhash~~ parentHash is unknown, EL should reply SYNCING is what I understood (and then go searching for it)",
        "created_at": "2021-11-23T06:37:50.070000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Ok great, that matches my expectation as well - just not what I was getting.",
        "created_at": "2021-11-23T06:38:44.276000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "I get the same crash when TTD is reached with `beacon-ontopof-4399` branch btw.",
        "created_at": "2021-11-23T06:39:18.331000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "really? try the docker build. that has been working for me",
        "created_at": "2021-11-23T06:39:58.183000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "crossposting from \u003c#692062809701482577\u003e \n\u003e looking for input on these two tickets:\n\u003e https://github.com/ethereum/consensus-specs/issues/2732\n\u003e https://github.com/ethereum/consensus-specs/issues/2735",
        "created_at": "2021-11-23T06:40:24.901000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Docker would be quite a challenge in this setup unfortunately. I have quite the script to spin up shortlived multi-client testnets. üôÇ",
        "created_at": "2021-11-23T06:41:38.464000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@!199561711278227457\u003e can tell you the commit sha may be",
        "created_at": "2021-11-23T06:43:22.560000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "It's the same git commit as in the docker version you pointed to so I think it's the same version.  Difference may be that I'm using clique not PoW? Or that I'm on a Mac not Linux.  I've just tweaked things for now so that the signer isn't used as one of the EL clients so when it crashes it doesn't matter.",
        "created_at": "2021-11-23T06:44:31.163000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "i was getting clique error in kintsugi-spec latest and has reported that, so that wouldn't be mac or linux issue",
        "created_at": "2021-11-23T06:45:48.554000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cparithoshj\u003e The error very well might be because of clique. I've only tested the setup with pow, so I maybe marius can chime in?",
        "created_at": "2021-11-23T07:14:57.858000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "You guys are up early üòã \nHave you nuked your datadir between switching to the beacon-ontopof branch? That should fix it for the testnets. There's a known issue with clique where geth can not distinguish between clique and post merge blocks and tries to execute them with the wrong engine, resulting in the linked panics. I haven't had the time to fix that. Will do so today",
        "created_at": "2021-11-23T07:19:21.029000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Yep, my scripts start with a fresh data dir every run. I could probably switch to PoW actually - last time I played with it I couldn't get geth \u0026 besu to agree on a chain with low difficulty so mining didn't take too long.  But besu doesn't currently support forkchoiceUpdated call so it's not doing so great anyway (though it does seem to respond correctly to all the executePayload calls which is a good start - just has the wrong head).",
        "created_at": "2021-11-23T08:12:24.917000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Woo! Teku+Geth and Lighthouse+Geth managed to go through the merge together happily. Got a couple of PRs we'll need to land on the teku side to get there and plenty of TODO items we still know about but that's good first step.",
        "created_at": "2021-11-23T08:30:51.956000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "So I think we just hit M3, though we don't actually meet M1 or M2 yet. üôÇ",
        "created_at": "2021-11-23T08:31:07.885000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "üëç üëç",
        "created_at": "2021-11-23T08:34:01.378000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "I think I fixed the issue now, could you check it again (the kintsugi spec branch)",
        "created_at": "2021-11-23T12:15:31.368000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "As you may have heard, `merge-devnet-1` is broken as well (üëÄ  \u003c@!360491619402776577\u003e ), We finalised a wrong chain essentially. \n\nI'm going to wipe all the geth nodes and resync them with a correct state from nethermind (client diverysity FTW). Expect chaos. If nothing works out, you'll hear about `merge-devnet-2` üòõ",
        "created_at": "2021-11-23T16:03:44.685000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "So we can't snap sync from nethermind to geth yet so there isn't much left to save `devnet-1` in its current form, so i'll deploy `merge-devnet-2` tomorrow. But there's three paths forward for `merge-devnet-1`:\n- 1. redeploy geth and let the false chain run till the devnet is killed\n- 2. switch the entire chain to nethermind and run it till the devnet is killed\n- 3. no devnet till like noon cest tomorrow\n\nReact with the number emoji to decide what you want. By default, I will choose 3. \nThe whole point was to give client teams something to test again, so i'd love to hear which is more valuable.",
        "created_at": "2021-11-23T16:31:08.525000+00:00",
        "attachments": null
    },
    {
        "author": "terence0083",
        "category": "Testing",
        "parent": "",
        "content": "Fyi all Prysm cant sync to head, it has state root failure on block at slot 352. State root failure. We'll begin to look into this today",
        "created_at": "2021-11-23T16:31:50.455000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "voted 2 \u0026 3, switch to nethermind till new devnet this week üòõ",
        "created_at": "2021-11-23T18:36:35.862000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Testing",
        "parent": "",
        "content": "Let me know what the issue was. Likely highlights a place we want more cosnensus tests",
        "created_at": "2021-11-23T18:38:51.288000+00:00",
        "attachments": null
    },
    {
        "author": "terence0083",
        "category": "Testing",
        "parent": "",
        "content": "This one was on us, spec tests failed. After we passed M2, we brought in more upsteam changes into `kintsugi` branch and one of them broke merge spec tests. It's fixed and pushed and now we are able to sync further to slot 896. Will holla if there's indeed a spec test gap",
        "created_at": "2021-11-23T18:46:48.624000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "Looks like there was a hidden 4th option! \u003c@!360491619402776577\u003e hacked together something that ended up saving the devnet. Its finalizing again, but since i had to wipe a lot of the geth nodes, i've updated the enodes in the repo + posting it here for visibility. \n\nenode for execution clients: \n```yaml\n  - \"enode://68d3eb775d6c1da735d7584cf7f7a069ad5031ae85613d9bc1723b2d60778e09e9f07734a3c9e5c149ae2c385dca448374064b3d9d0e5b73d0efa65e66039c01@137.184.108.205:30303\"\n  - \"enode://3a514176466fa815ed481ffad09110a2d344f6c9b78c1d14afc351c3a51be33d8072e77939dc03ba44790779b7a1025baf3003f6732430e20cd9b76d953391b3@137.184.97.41:30303\"\n  - \"enode://68d3eb775d6c1da735d7584cf7f7a069ad5031ae85613d9bc1723b2d60778e09e9f07734a3c9e5c149ae2c385dca448374064b3d9d0e5b73d0efa65e66039c01@137.184.108.205:30303\"\n```",
        "created_at": "2021-11-23T21:01:15.811000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "Now that there are geth nodes on the network again, you can also use the `beacon-ontopof-4399` branch again.\nThe problem was that geth defaulted to snap sync (even if asked not to) and was thus unable to sync from nethermind.\nNow that there are snap nodes on the network, the old branch should work fine again.",
        "created_at": "2021-11-23T21:03:15.566000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Fantastic work! I'll get to diagnose the 896 block :)",
        "created_at": "2021-11-23T21:31:45.692000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "No luck unfortunately:\n```\nic: runtime error: slice bounds out of range [:-39]\n\ngoroutine 113 [running]:\ngithub.com/ethereum/go-ethereum/consensus/clique.encodeSigHeader({0xe5f5140, 0xc000ed6380}, 0xc000ed6380)\n        github.com/ethereum/go-ethereum/consensus/clique/clique.go:736 +0x512\ngithub.com/ethereum/go-ethereum/consensus/clique.SealHash(0x1)\n        github.com/ethereum/go-ethereum/consensus/clique/clique.go:704 +0x7d\ngithub.com/ethereum/go-ethereum/consensus/clique.(*Clique).SealHash(0xc0017d3a70, 0xc0017d3a78)\n        github.com/ethereum/go-ethereum/consensus/clique/clique.go:682 +0x2e\ngithub.com/ethereum/go-ethereum/consensus/beacon.(*Beacon).SealHash(0x0, 0x1)\n        github.com/ethereum/go-ethereum/consensus/beacon/consensus.go:314 +0x33\ngithub.com/ethereum/go-ethereum/miner.(*worker).commit(0xc0002a7680, {0xc001b1aa30, 0xc0002a78c0, 0x2}, 0x0, 0x0, {0x203000, 0x203000, 0x5ee43e0})\n        github.com/ethereum/go-ethereum/miner/worker.go:1050 +0x591\ngithub.com/ethereum/go-ethereum/miner.(*worker).commitNewWork(0xc0002a7680, 0xc00037dc6c, 0x0, 0x619d636d)\n        github.com/ethereum/go-ethereum/miner/worker.go:997 +0xcbe\ngithub.com/ethereum/go-ethereum/miner.(*worker).mainLoop(0xc0002a7680)\n        github.com/ethereum/go-ethereum/miner/worker.go:466 +0x67d\ncreated by github.com/ethereum/go-ethereum/miner.newWorker\n        github.com/ethereum/go-ethereum/miner/worker.go:233 +0x745\n```\n\nVersion:   1.10.12-unstable-c124ae96-20211123",
        "created_at": "2021-11-23T21:57:31.583000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "What's the input you pass to geth?",
        "created_at": "2021-11-23T21:58:34.953000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "I'm running the `start.sh` script from https://github.com/ajsutton/merge-scripts/tree/main/localnet So genesis config is https://github.com/ajsutton/merge-scripts/blob/main/localnet/execution/genesis.json\nand geth is run with:\n```\n$GETH \\\n    --catalyst \\\n    --http \\\n    --http.port 8545 \\\n    --http.api \"engine,eth,net,admin,web3\" \\\n    --http.corsdomain=\"*\" \\\n    --http.vhosts=\"*\" \\\n    --allow-insecure-unlock \\\n    --unlock \"0xa94f5374fce5edbc8e2a8697c15331677e6ebf0b\" \\\n    --password \"execution/geth/passfile.txt\" \\\n    --datadir \"${SCRATCH}/localnet/data/geth1\" \\\n    --nodekey \"execution/signer.key\" \\\n    --bootnodes \"$EXECUTION_BOOTNODE\" \\\n    --port 30308 \\\n    --syncmode full \\\n    --mine \\\n    --networkid 2337002 \\\n    console\n```\nthe data dir for all the nodes is deleted prior to every run so always starting from a clean slate.",
        "created_at": "2021-11-23T22:01:30.103000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "`Version:   1.10.12-unstable-c124ae96-20211123` that looks sus to me. isn't the commit hash on `beacon-ontopof-4399` `897b281 `?",
        "created_at": "2021-11-23T22:03:54.912000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "I thought beacon-ontopof-4399 crashed for me earlier this morning as well but I'll try it again. https://discord.com/channels/595666850260713488/892088344438255616/912677745954271263 said the kintsugi spec branch, so this is trying with the kintsugi-spec branch.",
        "created_at": "2021-11-23T22:06:05.683000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "Ah wait you're trying to run a full testnet, then you need beacon-ontopof-4399 I think (as it has sync)",
        "created_at": "2021-11-23T22:07:58.320000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Everything is stepping forward in sync (ie all nodes online for the whole life of the chain).  Both branches are working ok I think in terms of following the chain, it's just the miner crashes which leaves one of the nodes without an EL and then things get a bit messy.",
        "created_at": "2021-11-23T22:09:07.498000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "I'll take a look tomorrow!",
        "created_at": "2021-11-23T22:10:02.879000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "I did managed to get it working with PoW but a chain that besu and geth can both sync takes way too long to find blocks when I'm loading up my CPUs this much. üôÇ",
        "created_at": "2021-11-23T22:13:10.111000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Confirmed beacon-ontopof-4399 also crashes.",
        "created_at": "2021-11-23T22:16:31.333000+00:00",
        "attachments": null
    }
]