[
    {
        "author": "macfarla",
        "category": "Testing",
        "parent": "",
        "content": "Besu devnet6  logs showing a lot of exceptions decoding ENR Response and PING packets - could be that we're not decoding something correctly, or that there's something unexpected in the packets we're receiving - anyone else seeing this or is it just Besu? \n`2023-06-21 04:24:10.707+00:00 | vert.x-worker-thread-14 | DEBUG | ENRResponsePacketData | Exception Unknown node identity scheme, not defined in record`\nand\n`2023-06-22 01:37:03.769+00:00 | vert.x-eventloop-thread-1 | DEBUG | VertxPeerDiscoveryAgent | Discarding invalid peer discovery packet: Malformed packet of type: PING, org.hyperledger.besu.ethereum.p2p.discovery.PeerDiscoveryPacketDecodingException: Malformed packet of type: PING`",
        "created_at": "2023-06-22T03:23:33.337000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "teku is rate limiting",
        "created_at": "2023-06-22T07:12:50.203000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "b5b9375ba2217c1435d2d7fa88e2f313f97ec7429c17c316e38c4fe0d4356297"
            }
        ]
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "How does one disable rate limit in teku?",
        "created_at": "2023-06-22T07:22:10.398000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "also teku is giving the same error: thats why chain isn't progressing from teku as well",
        "created_at": "2023-06-22T07:27:34.194000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "94cef7f2814ac99ce7f4215690fcef203b1753dd2a556da9477992c4df0fb5e4"
            }
        ]
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "wondering whats the possibility of two clients serving data with similar issue",
        "created_at": "2023-06-22T07:28:06.300000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "cc \u003c@504202741933932544\u003e",
        "created_at": "2023-06-22T07:28:42.406000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "make it 3 clients, nimbus as well",
        "created_at": "2023-06-22T07:29:48.448000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "c461b9172feefddff912f805d9711cd86d0a9f213a993d1cdfbf3821dad4beda"
            }
        ]
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "(the line above the error lists the client name with last segment of peerid, and the error shows the error with the data from the matching peerid)",
        "created_at": "2023-06-22T07:31:14.678000+00:00",
        "attachments": null
    },
    {
        "author": "pawandhananjay",
        "category": "Testing",
        "parent": "",
        "content": "are you seeing the same error from LH again? would be helpful to see logs where we know the peer id of the requesting peer.",
        "created_at": "2023-06-22T07:56:04.072000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "yes LH gives the same error, just now i added a hack to lodestar\u003c\u003eethereumjs node to request 2 more slots , and i moved past the problematic epoch , but other lodestar nodes will be stuck in similar fashion",
        "created_at": "2023-06-22T07:57:48.201000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "let me get the  peer id of other stuck nodes (without the hack) for you",
        "created_at": "2023-06-22T07:57:58.346000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "sorry wrong log wait",
        "created_at": "2023-06-22T08:04:05.076000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "```typescript\nJun-22 08:04:32.425[network]       verbose: Req  done method=beacon_blocks_by_range, version=2, encoding=ssz_snappy, client=Lighthouse, peer=16...RGhFwV, requestId=2469\nJun-22 08:04:32.454[sync]          verbose: Batch download error id=Finalized, startEpoch=5, status=Downloading Missing blobSidecars for blockSlot=190 with blobKzgCommitmentsLen=6 blobSidecars=4 peerId=16Uiu2HAmA4FsHBWsgpoe8V7es6UnmJ1fi8C6mnGTBoEw29RGhFwV\nError: Missing blobSidecars for blockSlot=190 with blobKzgCommitmentsLen=6 blobSidecars=4 peerId=16Uiu2HAmA4FsHBWsgpoe8V7es6UnmJ1fi8C6mnGTBoEw29RGhFwV\n    at matchBlockWithBlobs (file:///usr/app/packages/beacon-node/src/network/reqresp/beaconBlocksMaybeBlobsByRange.ts:90:15)\n    at beaconBlocksMaybeBlobsByRange (file:///usr/app/packages/beacon-node/src/network/reqresp/beaconBlocksMaybeBlobsByRange.ts:46:12)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at wrapError (file:///usr/app/packages/beacon-node/src/util/wrapError.ts:18:32)\n    at SyncChain.sendBatch (file:///usr/app/packages/beacon-node/src/sync/range/chain.ts:399:19)\n```",
        "created_at": "2023-06-22T08:05:03.507000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "and peer id of the requesting lodestar node: `16Uiu2HAm5sL3Jma8aroSbeaS1BxyjmQucFWKPQphvbFhaydtUBHA`",
        "created_at": "2023-06-22T08:07:06.030000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Testing",
        "parent": "",
        "content": "--Xpeer-rate-limit  100000 --Xpeer-request-limit 1000. Defaults are respectively 500 and 50",
        "created_at": "2023-06-22T09:15:46.312000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@199561711278227457\u003e could you pls apply these to teku nodes?",
        "created_at": "2023-06-22T09:16:09.471000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "Yup, on it",
        "created_at": "2023-06-22T09:23:15.709000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "`@all`, feel free to direct testnet updates to me as Barnabas is on vacation ðŸ˜„",
        "created_at": "2023-06-22T09:23:43.119000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Testing",
        "parent": "",
        "content": "this is strange... i'll look into it.. but if you have the same problem with all clients, whould it possible that the issue is on your side? just asking ðŸ™‚",
        "created_at": "2023-06-22T09:24:46.136000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "i considered the possibility, but the raw data speaks for itself",
        "created_at": "2023-06-22T09:25:28.355000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "unless peers send more data, and lodestar decoded less, which could n't be , becuase i did a hack on lodestar\u003c\u003eethereumjs to request 2 slots more than the 32 slots per epoch which we try to download",
        "created_at": "2023-06-22T09:26:31.672000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "and lodestar got full data, so lodestar\u003c\u003eethereumjs is syncing aheead",
        "created_at": "2023-06-22T09:26:48.858000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "but other lodestar without the hacks are not",
        "created_at": "2023-06-22T09:27:00.834000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Testing",
        "parent": "",
        "content": "do you get that consistently? if yes I could to some tracing on our side and see",
        "created_at": "2023-06-22T09:27:31.445000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "yes for this particular epcoh `5` , for slot `190`",
        "created_at": "2023-06-22T09:28:04.528000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "this is block by range response",
        "created_at": "2023-06-22T09:28:35.366000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "this is blobs by range",
        "created_at": "2023-06-22T09:28:51.784000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "so last slot 190's blobs aren't fully recieved",
        "created_at": "2023-06-22T09:29:36.779000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Testing",
        "parent": "",
        "content": "ok i'll look into that.",
        "created_at": "2023-06-22T09:29:38.890000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Testing",
        "parent": "",
        "content": "I was assuming as not possible ðŸ™‚",
        "created_at": "2023-06-22T09:30:11.198000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "its weird that 3 clients will behave in same manner, but i don't understand why the magic number of 4 blobs were received against expected 6 (4 was the max  blobs per block last time around)",
        "created_at": "2023-06-22T09:31:23.437000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "and why the problem went away if i request more count",
        "created_at": "2023-06-22T09:31:44.812000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "ok if i try to guess: this epoch has 34 blobs, and the blobs by range request count is 32 , so the peers responding with 32 blobs truncating the last 2?",
        "created_at": "2023-06-22T09:33:55.327000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "and could be reason why increasing `count` resolved the response?",
        "created_at": "2023-06-22T09:34:18.020000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "so `count` here is being interpreted as blob count instead of slot count? cc \u003c@491624610215886849\u003e \u003c@504202741933932544\u003e",
        "created_at": "2023-06-22T09:34:57.759000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "( i have a deja-vu feeling that we have discussed this issue before from may be devnet5/4)",
        "created_at": "2023-06-22T09:37:50.116000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Testing",
        "parent": "",
        "content": "no, we consider count as slot count",
        "created_at": "2023-06-22T10:15:39.465000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Testing",
        "parent": "",
        "content": "I enabled traces and I see\n```\n2023-06-22 10:29:14.483 TRACE - Peer 16Uiu2HAm5sL3Jma8aroSbeaS1BxyjmQucFWKPQphvbFhaydtUBHA requested 32 slots of blob sidecars starting at slot 160.\n2023-06-22 10:29:14.570 TRACE - Sent 34 blob sidecars to peer 16Uiu2HAm5sL3Jma8aroSbeaS1BxyjmQucFWKPQphvbFhaydtUBHA.\n```",
        "created_at": "2023-06-22T10:30:32.120000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "wow ok so may be there is a parsing issue here on lodestar side",
        "created_at": "2023-06-22T10:31:29.233000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "will debug",
        "created_at": "2023-06-22T10:31:36.783000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "ok thanks a ton! i have figured out the issue in lodestar, lodestar\u003c\u003enethermind is now syncing with the in container fix, will update our code",
        "created_at": "2023-06-22T11:51:33.241000+00:00",
        "attachments": null
    }
]