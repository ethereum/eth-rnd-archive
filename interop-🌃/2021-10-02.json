[
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003ctersec\u003e https://github.com/status-im/nimbus-eth2/blob/amphora-merge-interop/docs/interop_merge.md isn't exactly M2 or M3 because it's just using the Geth fork provided, but it otherwise runs through the steps. Not sure how this kind thing is supposed to be categorized",
        "created_at": "2021-10-02T05:35:22.671000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003csigpaul\u003e We're good with M2 Geth. I just started running against Nethermind but found the extraData field is missing in the engine_getPayload response.\nI've opened an issue on the Nethermind themerge PR, I just thought I'd let others know so they don't needlessly reproduce what I just found :)",
        "created_at": "2021-10-02T06:35:20.453000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cvdWijden\u003e @sigpaul I fixed the baseFeePerGas issue (was 64 bit is now 256 bit)",
        "created_at": "2021-10-02T06:40:37.637000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cvdWijden\u003e I've also added a check to make sure the extradata is leq than 32 bytes might be good to check for the nethermind and besu team too",
        "created_at": "2021-10-02T06:45:20.639000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003csigpaul\u003e It's very satisfying that if you sort the team names alphabetically they are also sorted into EL/CL groups ü§§",
        "created_at": "2021-10-02T06:48:01.837000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003csigpaul\u003e Thanks @vdWijden! I might be getting ahead of myself, but I'm having a look at M3. With the current consensus specification we need to have a block *less than* the TTD and a child block *greater than* the TTD. I'm not aware of how to do that with Geth yet, perhaps there's already something there @vdWijden? No worries if not, I can wait ‚ò∫Ô∏è",
        "created_at": "2021-10-02T07:06:02.971000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cvdWijden\u003e Not yet, I'm currently boarding my plane, will take a look later :)",
        "created_at": "2021-10-02T07:08:06.937000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003csigpaul\u003e @yetanotherchatclient, I'm looking at M2 for Besu. I'm wondering if there are any instructions on how to configure it to run for that scenario, please?",
        "created_at": "2021-10-02T07:08:30.858000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003csigpaul\u003e No worries, safe flight! (re @vdWijden: Not yet, I'm currently boarding my plane, will take a look later :))",
        "created_at": "2021-10-02T07:08:41.238000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003czahary_karadjov\u003e /me",
        "created_at": "2021-10-02T07:50:19.433000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cnashatyrev_a\u003e Using those options:\n--genesis-file=./genesis1.json --rpc-http-enabled --rpc-http-api=ADMIN,ETH,NET,DEBUG,TXPOOL,EXECUTION --host-allowlist=\"*\" --rpc-http-cors-origins=\"all\" --Xmerge-support=true --logging=DEBUG --discovery-enabled=false (re @sigpaul: @yetanotherchatclient, I'm looking at M2 for Besu. I'm wondering if there are any instructions on how to configure it to run for that scenario, please?)",
        "created_at": "2021-10-02T08:23:43.014000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cnashatyrev_a\u003e Found a number of issues there, seems like @yetanotherchatclient is fixing them yet",
        "created_at": "2021-10-02T08:24:56.364000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cnashatyrev_a\u003e ./genesis1.json is the same as for Geth",
        "created_at": "2021-10-02T08:25:29.585000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdannyryan\u003e false, fake news (re @sigpaul: It's very satisfying that if you sort the team names alphabetically they are also sorted into EL/CL groups ü§§)",
        "created_at": "2021-10-02T13:02:09.486000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdannyryan\u003e Lighthouse and Lodestar before Nethermind",
        "created_at": "2021-10-02T13:02:57.643000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdannyryan\u003e I‚Äôve added the following to M1\n\u003e - EL/CL: detailed documentation on how to run your merge client",
        "created_at": "2021-10-02T13:10:48.130000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdannyryan\u003e In past similar interop experiences, we spent quite a bit of time trying to figure out how to run eachother‚Äôs software. Do everyone a favor and be more verbose than usual on initial documentation",
        "created_at": "2021-10-02T13:11:20.524000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdannyryan\u003e Actually ‚Äî It‚Äôs ‚ÄúDocs‚Äù",
        "created_at": "2021-10-02T13:11:58.306000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@\u0026836981489430036500\u003e or \u003c@\u0026595683849225240704\u003e how are you interop-ing with geth on M1? Did you hack the `is_valid_terminal_pow_block` and `get_pow_block_at_terminal_total_difficulty` to bypass the parent requirement?",
        "created_at": "2021-10-02T13:29:03.230000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdannyryan\u003e cc: @sigpaul @ajsutton",
        "created_at": "2021-10-02T13:29:50.115000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cbenjaminion\u003e Better to ping @nashatyrev_a and \u003c@504202741933932544\u003e on the Teku side just now üôÇ",
        "created_at": "2021-10-02T13:31:31.466000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003ctbenr\u003e @nashatyrev_a did it, lets wait details from him",
        "created_at": "2021-10-02T13:35:57.136000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdannyryan\u003e The value is that when you create genesis from Merge logic, you want to embed the initial eth1 values from the eth1 genesis block. This signals is_merge_complete and bypasses all of the transition logic (re @sigpaul: I see, so the intention is to supply an Eth1 block hash that is actually a valid hash? Previously we‚Äôve done it as a static value.\nIt‚Äôs definitely possible to use a valid hash, but we don‚Äôt really have the ‚Äúplumbing‚Äù in place to get a dynamic value there.\nIs there immediately visible value in having a non-zero execution header for the genesis state? If not, I‚Äôd suggest just making one function which is all zero.\nAlternatively, we can just ignore that function, start from Altair and fork at epoch 1.\nThe latter option is totally fine by me.)",
        "created_at": "2021-10-02T14:31:01.021000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdannyryan\u003e - If the EE is on the genesis block, there's no parent so get_pow_block_at_terminal_total_difficulty fails.\n- Even if there was a parent block, it wouldn't trigger genesis because the TD in Geth was static so I could never find a parent with a TD less than TTD.\n^ This should just be bypassed because is_merge_complete should return True for the genesis state",
        "created_at": "2021-10-02T14:32:04.164000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdannyryan\u003e so I think the spec as is should work fine. If you have an latest_execution_payload_header in state, it signals merge is already done. And initialize_beacon_state_from_eth1 on merge spec fills in a non-zero latest_execution_payload_header",
        "created_at": "2021-10-02T14:33:31.195000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cnashatyrev_a\u003e Sorry guys, boarding right now. üò¨",
        "created_at": "2021-10-02T14:35:32.132000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdapplion\u003e In the spec base_fee_per_gas: Bytes32, but is may have a small value like 0x07. When serializing a block in the beacon API for the validator to sign, the JSON representation of that value should be padded to 32 bytes or 0x07 is okay?",
        "created_at": "2021-10-02T16:22:10.098000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cvdWijden\u003e For us 0x7 is okay, don't need any paddjng",
        "created_at": "2021-10-02T16:28:02.104000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdapplion\u003e This incompatibility showed up in beacon -\u003e validator comms, just wondering if other consensus clients have any requirement in that regard",
        "created_at": "2021-10-02T16:29:11.140000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdapplion\u003e @vdWijden Do you have any docs or short guide on how to run geth catalyst with clique to test the fork process?",
        "created_at": "2021-10-02T16:30:01.649000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cvdWijden\u003e Not yet, I've been working on that, but I got interrupted by dinner",
        "created_at": "2021-10-02T16:35:54.600000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cvdWijden\u003e There's an issue in geth atm that prevents us from creating clique blocks with the miner (when catalyst is enabled)",
        "created_at": "2021-10-02T16:37:05.184000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003csigpaul\u003e We‚Äôre treating that value as a Hash256 in our consensus code and then converting to a Uint256 when we get to the EL API boundary. This means that it serialises as a QUANTITY for the execution node.\nSo, our BN\u003c\u003eVC will serialise it differently to EL\u003c\u003eCL. (re @dapplion: This incompatibility showed up in beacon -\u003e validator comms, just wondering if other consensus clients have any requirement in that regard)",
        "created_at": "2021-10-02T19:47:07.315000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003csigpaul\u003e It‚Äôs a bit yucky, but not that bad cause we already have to do that for all the u64 values.",
        "created_at": "2021-10-02T19:48:13.639000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003csigpaul\u003e Oh no, I‚Äôm spreading misinformation üò± Exactly what the world doesn‚Äôt need right now (re @dannyryan: Lighthouse and Lodestar before Nethermind)",
        "created_at": "2021-10-02T19:49:12.302000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cprotolambda\u003e Just treat it like bytes32 on consensus layer, but with quantity in JSON rpc.",
        "created_at": "2021-10-02T19:50:03.280000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cprotolambda\u003e What Paul said pretty much",
        "created_at": "2021-10-02T19:50:18.113000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003csigpaul\u003e Yep we‚Äôre setting the terminal block hash to the genesis hash.\nWe‚Äôre also feeding the correct value into init state from Eth1 now, so perhaps we don‚Äôt need to anymore. (re @amphora_interop_bot: \u003cdjrtwo\u003e@teku or @sigmaprime how are you interop-ing with geth on M1? Did you hack the `is_valid_terminal_pow_block` and `get_pow_block_at_terminal_total_difficulty` to bypass the parent requirement?)",
        "created_at": "2021-10-02T19:51:12.270000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdapplion\u003e So could you provide an example of the JSON you send to the validator? If baseFeePerGas is 0xaabb, do you send 0x000000000000000000000000000000000000000000000000000000000000aabb or 0xaabb000000000000000000000000000000000000000000000000000000000000 (excuse the dumb question it's very late here) (re @sigpaul: We‚Äôre treating that value as a Hash256 in our consensus code and then converting to a Uint256 when we get to the EL API boundary. This means that it serialises as a QUANTITY for the execution node.\nSo, our BN\u003c\u003eVC will serialise it differently to EL\u003c\u003eCL.)",
        "created_at": "2021-10-02T21:47:30.872000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003csigpaul\u003e No worries! Assuming 0xaabb is big-endian, I‚Äôd send exactly that to the EL. The JSON RPC docs have a decent section on how to serialise the QUANTITY field wrt padding and stuff (I‚Äôm on my phone and don‚Äôt have a link sorry). \nBetween the VC\u003c\u003eBN, I‚Äôd parse 0xaabb as big-endian into an integer. Then, I‚Äôd serialise that integer as little-endian and right-pad it to make 32 bytes. Just like how we do integers in SSZ. That would be kinda like your second example, but considering the endianness. (re @dapplion: So could you provide an example of the JSON you send to the validator? If baseFeePerGas is 0xaabb, do you send 0x000000000000000000000000000000000000000000000000000000000000aabb or 0xaabb000000000000000000000000000000000000000000000000000000000000 (excuse the dumb question it's very late here))",
        "created_at": "2021-10-02T22:35:09.496000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003csigpaul\u003e This might help: https://github.com/sigp/lighthouse/blob/dc6aa255334b2d6c3d9b1054f8c08c311a63c3ce/beacon_node/execution_layer/src/engine_api/http.rs#L356\nIt‚Äôs not a great example though because the to_little_endian function hides the padding.",
        "created_at": "2021-10-02T22:39:21.502000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003csigpaul\u003e To all the EL devs: the genesis.json that was graciously provided by @vdWijden has a gasLimit that's not compatible with the CL specs. To fix this on Geth, I simply changed the genesis.json to feature \"gasLimit\":\"0x1C9C380\". This was also raised by someone else before me.\nI've noticed that Nethermind also uses a gasLimit that doesn't play well with the CL specs. I've documented how I changed this value for Nethermind here: https://github.com/sigp/lighthouse-merge-f2f/tree/master/m2_nethermind#terminal-1-nethermind (it's the line starting with vim ...).\nIf it's easy enough for the EL devs to just change that gasLimit value, I'd suggest doing that. If that's difficult/weird for some reason, we can look at changing the CL specs.",
        "created_at": "2021-10-02T23:47:00.494000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003csigpaul\u003e Lighthouse and Nethermind are now passing M2 üéâ Thanks for the quick fixes Nethermind!\nThe commands we used to start Nethermind are here: https://github.com/sigp/lighthouse-merge-f2f/tree/master/m2_nethermind#terminal-1-nethermind",
        "created_at": "2021-10-02T23:50:31.597000+00:00",
        "attachments": null
    }
]