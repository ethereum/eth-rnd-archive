[
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "`ACCEPTED` is correct response for non-canonical chains. If a payload would extend canonical chain, e.g. `A \u003c- B: fcU(A) newPayload(B)` where `B` is missing parent state, then `SYNCING` status must be returned",
        "created_at": "2022-05-01T07:35:19.665000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "Testing",
        "parent": "",
        "content": "But how EL gets those missing payloads if previously those payloads were not imported for some reason?",
        "created_at": "2022-05-01T08:36:11.892000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "In this case EL will attempt to pull them from EL network",
        "created_at": "2022-05-01T08:47:39.859000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "Testing",
        "parent": "",
        "content": "But what happens if EL misses the reorg from CL? So EL thinks that it’s (actually) non-canonical chain is canonical. CL keeps pushing payloads to the chain that  EL thinks is not canonical, so EL doesn’t download missing  parent payloads.",
        "created_at": "2022-05-01T09:51:17.641000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "CL would also be calling fcu to tell the EL what the canonical chain is.",
        "created_at": "2022-05-01T10:18:28.474000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "Testing",
        "parent": "",
        "content": "But CL doesn’t get VALID from EL anymore so not much point for CL to fcu",
        "created_at": "2022-05-01T10:35:49.099000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "The CL always keeps sending fcu because that’s how the El knows the chain head.",
        "created_at": "2022-05-01T10:46:24.684000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Just reinforcing what Adrian is saying: the CL drives the EL head, so whenever the consensus head changes, being optimistically or not, it will send fcu to the EL to inform that. This can be optimized in some situations (importing a batch for example) but it's true for the most part",
        "created_at": "2022-05-01T10:50:36.738000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "Testing",
        "parent": "",
        "content": "But in non-optimistic sync head doesn’t move in the situation I described",
        "created_at": "2022-05-01T10:57:29.455000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "Testing",
        "parent": "",
        "content": "I mean fcu is not emited by CL because there is no new fully validated blocks",
        "created_at": "2022-05-01T11:04:42.687000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "There's no need to fully validate a block: fcu is called on every block synced, optimistic or not",
        "created_at": "2022-05-01T11:12:23.303000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "As long as the block becomes the head of the CL",
        "created_at": "2022-05-01T11:12:42.561000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "Testing",
        "parent": "",
        "content": "Oh, seems I missed something. I had understanding that in non-optimistic sync the head can be only blocks with valid payload.",
        "created_at": "2022-05-01T11:18:01.604000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "That’s correct. Not having optimistic sync you’d need to periodically resend fcu even if it didn’t change and periodically retry executing the block. And the EL wouldn’t be able to do an initial sync via fast or snap sync because it needs to know the current chain head to do that. So without optimistic sync you’d have to full sync the EL (or use an alternative like light client sync).",
        "created_at": "2022-05-01T22:47:24.598000+00:00",
        "attachments": null
    }
]