[
    {
        "author": "sproul",
        "category": "Testing",
        "parent": "",
        "content": "Regarding the pool, I'm now thinking we should go with the \"reject BLS to execution changes before the fork\" approach (rather than \u003c@340345049063882753\u003e's suggestion specced here: \u003chttps://github.com/ethereum/consensus-specs/pull/3135\u003e). Lighthouse only subscribes 2 slots in advance of the fork currently, so making spec changes to support message queueing in that 2 slots period doesn't seem worth it.\n\nHow far in advance of the fork are other clients subscribing to the new topics?",
        "created_at": "2022-12-02T00:03:18.260000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "We subscribe an epoch in advance. But in this case we will also reject BLS changes coming from gossip in advance. But I'll hack a one time addition to the pool from a local file at startup. I haven't figured out how to do this yet and probably we want to come up with a standardized file for this. I think a simple JSON with a least of signed messages in JSON form is the best way. The idea is to support those that lost their keys and are on a race against hackers",
        "created_at": "2022-12-02T00:19:34.842000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Testing",
        "parent": "",
        "content": "It looks like we'll subscribe from the capella epoch, so i guess it's a pretty limited problem on gossip, but the api would need to reject before that to close the hole",
        "created_at": "2022-12-02T00:30:19.221000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "We should subscribe an epoch or two before capella actually activates.",
        "created_at": "2022-12-02T00:30:41.380000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "By the way when I say reject I don't want the P2P crowd to jump at me. I'm sure someone will argue about ignore or reject.  I just meant that we won't include them in the pool",
        "created_at": "2022-12-02T00:31:09.345000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Yeah, we subscribe 2 epochs before (`GossipForkManager.EPOCHS_PRIOR_TO_FORK_TO_ACTIVATE` for anyone wanting to follow the code)",
        "created_at": "2022-12-02T00:31:38.957000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Currently the way it's coded it will actually reject it, but it probably should change to ignore, who knows",
        "created_at": "2022-12-02T00:31:42.874000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Yeah I'd definitely be ignoring if your head state is pre-capella. You _could_ reject if the signature is from bellatrix since that's actually invalid, but rejecting and penalising a peer who sent a perfectly valid change operation but before your chain head got updated is a bit mean.",
        "created_at": "2022-12-02T00:32:34.082000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Overall I don't think this is a major issue even if all clients wind up doing it different ways because it does resolve itself pretty quickly, it just bugs me that the p2p spec doesn't actually specify which fork to use when validating signatures and doesn't make sense to me that somehow despite topics being fork specific we go and get the fork info from somewhere else and potentially expect the gossip on a capella topic to not be for the capella fork...",
        "created_at": "2022-12-02T00:49:28.500000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "yea sorry, didn't get the time to work on this week, but lodestar should be able to successfully verify the bls messages as it was part of main PR",
        "created_at": "2022-12-02T04:33:07.850000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "will try closing it out by wednesday",
        "created_at": "2022-12-02T04:33:35.561000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "we dont reject \u003c@755590043632140352\u003e , just ignore messages from that topic",
        "created_at": "2022-12-02T05:28:08.739000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "ok, just saw this lol",
        "created_at": "2022-12-02T05:28:41.715000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Testing",
        "parent": "",
        "content": "i put up a PR to ignore pre-capella for teku, for now they will just stay in the op queue until that merges, but nothing will break",
        "created_at": "2022-12-02T07:36:07.935000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Testing",
        "parent": "",
        "content": "the PR is mostly to make sure the queue doesn't fill up with rubbish basically, because it's probably going to be a heavily used resource for the first little bit ðŸ™‚",
        "created_at": "2022-12-02T07:37:15.355000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "How are you verifying the signature before Capella?",
        "created_at": "2022-12-02T08:54:29.285000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "I think paul is just ignoring it, like we do. We don't process/validate these messages at all",
        "created_at": "2022-12-02T09:01:23.535000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Testing",
        "parent": "",
        "content": "yep if headslot is bellatrix, bin it",
        "created_at": "2022-12-02T09:52:36.315000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Testing",
        "parent": "",
        "content": "so there'll be potentially a few valid ones that happen pre-transition that we might bin, but less bad than having 9998 bellatrix in a 10k queue ðŸ˜„",
        "created_at": "2022-12-02T09:53:39.658000+00:00",
        "attachments": null
    },
    {
        "author": "revittm",
        "category": "Testing",
        "parent": "",
        "content": "Hey all, does anyone know the number of withdrawals per block  - is there any limit?",
        "created_at": "2022-12-02T09:55:34.512000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Testing",
        "parent": "",
        "content": "yep, current plan is 16 per block",
        "created_at": "2022-12-02T09:55:47.026000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Testing",
        "parent": "",
        "content": "for mainnet",
        "created_at": "2022-12-02T09:55:49.699000+00:00",
        "attachments": null
    },
    {
        "author": "revittm",
        "category": "Testing",
        "parent": "",
        "content": "ok great, thanks! ðŸ™‚",
        "created_at": "2022-12-02T09:56:16.707000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Testing",
        "parent": "",
        "content": "https://github.com/ethereum/consensus-specs/tree/dev/presets - if you look at the mainnet preset, at `MAX_WITHDRAWALS_PER_PAYLOAD` (capella one is in `mainnet/capella.yaml`)",
        "created_at": "2022-12-02T09:57:13.199000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Testing",
        "parent": "",
        "content": "it's likely also mentioned in the `beacon-chain.md` but the config item is what's being loaded to limit things",
        "created_at": "2022-12-02T09:58:01.286000+00:00",
        "attachments": null
    },
    {
        "author": "revittm",
        "category": "Testing",
        "parent": "",
        "content": "Thank you",
        "created_at": "2022-12-02T09:58:30.208000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "That doesn't work, I don't understand you just queue them and then verify when you're packing them?",
        "created_at": "2022-12-02T10:09:27.993000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "By the way, currently we do validate them and declare them INVALID, so we reject instead of ignore. I fixed it in my local Capella but haven't pushed yet",
        "created_at": "2022-12-02T10:11:08.926000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "I dont understand your point, why would we queue/verify these messages in bellatrix ? We ignore all messages from gossip, which are coming from the capella topics",
        "created_at": "2022-12-02T10:13:28.491000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Perhaps I misread what Paul is saying here\n\u003e for now they will just stay in the op queue...\nPerhaps that's their current behavior and they'll be switching to our behavior",
        "created_at": "2022-12-02T10:16:26.470000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "ah, yeah . I think currently they will insert them into the pool, but after the PR is merged they will just ignore them altogether",
        "created_at": "2022-12-02T10:18:26.529000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Ah right. So then probably both Teku and Prysm at some point would have been bricked without being able to propose if Bellatrix signed messages got into the pool. These little perks are scary. Perhaps we should add some spectests for this? Or Hive tests? Cc \u003c@415109946682769408\u003e \u003c@686695036733227017\u003e",
        "created_at": "2022-12-02T10:21:32.170000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "i don't think its possible to test this via spectests, as it requires inserting into the execution change pool/queue and then retrieving that when packing into a block.",
        "created_at": "2022-12-02T10:24:54.203000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "instead of the p2p paths we can check the endpoint directly",
        "created_at": "2022-12-02T10:34:48.922000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "The p2p stack can be tested with Hive",
        "created_at": "2022-12-02T10:35:06.555000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "We would have rejected them as we validate before putting them in blocks so it wouldnâ€™t be an issue for us - just wastes space with invalid things in the pool. \n\nWe learnt that trying to be clever and skip validating before putting things in blocks is risky and far too easy to wind up creatingninvalid blocks - particularly around fork boundaries.",
        "created_at": "2022-12-02T12:03:11.500000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "yeah, I'm writing that same check at packing time now, I don't like this, but I don't see anyway around it.",
        "created_at": "2022-12-02T12:10:12.407000+00:00",
        "attachments": null
    },
    {
        "author": "tmiychao",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@892053833121923094\u003e ðŸ™‚",
        "created_at": "2022-12-02T12:57:20.453000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Ooops! thanks!",
        "created_at": "2022-12-02T13:04:08.450000+00:00",
        "attachments": null
    }
]