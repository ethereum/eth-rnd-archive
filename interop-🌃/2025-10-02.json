[
    {
        "author": "ethpandaops-devnet-pulse-v2",
        "category": "Testing",
        "parent": "",
        "content": "",
        "created_at": "2025-10-02T01:00:00.437000+00:00",
        "attachments": null
    },
    {
        "author": "samcm",
        "category": "Testing",
        "parent": "",
        "content": "This is the count of `slow blocks` (first seen \u003e 3s) per entity (NOT cl type) for the last 2d limited to the top 10 entities . The red annotation is roughly the Fusaka fork. The issues started before Fusaka so probably a client issue and unrelated to the fork itself.\n\nI think Lighthouse is tracking around this which might explain it entirely, but I'll keep digging",
        "created_at": "2025-10-02T03:01:35.775000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "Screenshot_2025-10-02_at_12.53.28_pm.png",
                "content": "55761582c3865dd8d155c156f84c51643855b5d7bdb4bd1dd6aa6d5427f7bd6f"
            }
        ]
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "Nimbus hadn't implemented the\n```python\n        + sum(\n            withdrawal.amount\n            for withdrawal in state.builder_pending_withdrawals\n            if withdrawal.builder_index == validator_index\n        )\n        + sum(\n            payment.withdrawal.amount\n            for payment in state.builder_pending_payments\n            if payment.withdrawal.builder_index == validator_index\n        )\n```\npart of https://github.com/ethereum/consensus-specs/blob/v1.6.0-beta.0/specs/gloas/beacon-chain.md#modified-get_pending_balance_to_withdraw and was passing the gloas withdrawal request operations tests; is this expected?",
        "created_at": "2025-10-02T03:09:59.872000+00:00",
        "attachments": null
    },
    {
        "author": "samcm",
        "category": "Testing",
        "parent": "",
        "content": "This is the count of `slow blocks` (",
        "created_at": "2025-10-02T05:47:30.416000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Testing",
        "parent": "",
        "content": "ePBS withdrawal tests",
        "created_at": "2025-10-02T12:24:27.349000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@491624610215886849\u003e \u003c@554799849288105986\u003e \u003c@654267572107083777\u003e we're being isolated in mainnet and we believe it's because of a mismatch in the next fork schedule reported by peers. What does your client report now? Does an Electra client report Fulu?",
        "created_at": "2025-10-02T17:48:57.932000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Cc \u003c@833706406699073536\u003e",
        "created_at": "2025-10-02T17:49:09.037000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Testing",
        "parent": "",
        "content": "To clarify - we were using the fulu version|digest as the last entry in the schedule with epoch==far_future_epoch. I think the correct thing to do is to treat an unscheduled fork as non-existent, so next version|digest should be that of the last scheduled fork (per spec).",
        "created_at": "2025-10-02T17:50:46.148000+00:00",
        "attachments": null
    },
    {
        "author": "pawandhananjay",
        "category": "Testing",
        "parent": "",
        "content": "we haven't set anything for mainnet so that would be weird. let me double check. \nJust to confirm, you're saying that lighthouse nodes are not peering with prysm nodes because of a fork_digest mismatch?",
        "created_at": "2025-10-02T17:59:04.859000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Testing",
        "parent": "",
        "content": "In our latest release we are (I think incorrectly) setting next_fork_version to the fulu version. So we're actually banning other nodes that set it to electra (which is also an issue for unupgraded nodes ofc).",
        "created_at": "2025-10-02T18:00:13.954000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Testing",
        "parent": "",
        "content": "So we're strictly punishing peers for not having the same bug üôÉ",
        "created_at": "2025-10-02T18:01:00.695000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "sounds like you need a new release",
        "created_at": "2025-10-02T18:01:15.345000+00:00",
        "attachments": null
    },
    {
        "author": "pawandhananjay",
        "category": "Testing",
        "parent": "",
        "content": "do you have a prysm version for this release that i can grep for?",
        "created_at": "2025-10-02T18:01:36.263000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Testing",
        "parent": "",
        "content": "v6.1.0|v6.1.1",
        "created_at": "2025-10-02T18:01:58.577000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "NImbus (should be) reporting FAR_FUTURE_EPOCH with forkdigest 0",
        "created_at": "2025-10-02T18:14:33.297000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "which is stated as being due to \"... If no next fork is scheduled, the nfd entry contains the default value for the type (i.e., the SSZ representation of a zero-filled array).\": https://github.com/ethereum/consensus-specs/blob/v1.6.0-beta.0/specs/fulu/p2p-interface.md#next-fork-digest",
        "created_at": "2025-10-02T18:16:02.655000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "and comparing with that, as a result",
        "created_at": "2025-10-02T18:16:47.895000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "but Nimbus isn't supposed to be disconnecting anyone prematurely if _next_ fork differs. the peer is good until it isn't",
        "created_at": "2025-10-02T18:17:21.481000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Testing",
        "parent": "",
        "content": "Our issue was actually `next_fork_version` (not `nfd`) in the `eth2` field ([as per spec](https://github.com/ethereum/consensus-specs/blob/master/specs/fulu/p2p-interface.md#eth2-field))\n```\nIf no future fork is planned, set next_fork_version = current_fork_version to signal this fact.\n```",
        "created_at": "2025-10-02T18:21:35.451000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Testing",
        "parent": "",
        "content": "Our bug was that the code treated known but unscheduled forks as \"planned\". Didn't show up in testnets since fulu always has an epoch set there.",
        "created_at": "2025-10-02T18:22:35.311000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Testing",
        "parent": "",
        "content": "Ah I see. So prysm set `next_fork_version` to `FULU_FORK_VERSION`?",
        "created_at": "2025-10-02T18:24:22.965000+00:00",
        "attachments": null
    },
    {
        "author": "pawandhananjay",
        "category": "Testing",
        "parent": "",
        "content": "yeah our `next_fork_version` should be the electra fork version. But we shouldn't be rejecting you on our outbound discovery requests or when you connect to us on libp2p since we only check the `fork_digest` field to check compatibility",
        "created_at": "2025-10-02T18:24:32.839000+00:00",
        "attachments": null
    },
    {
        "author": "pawandhananjay",
        "category": "Testing",
        "parent": "",
        "content": "so prysm is rejecting peers on the discovery layer that have a different next_fork_version than them?",
        "created_at": "2025-10-02T18:25:37.092000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Testing",
        "parent": "",
        "content": "Yes, only on a very recent release. New release coming asap.",
        "created_at": "2025-10-02T18:28:27.230000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "ok, for reference, Nimbus's logic here is\n```nim\n    next_fork_version = if cfg.nextForkEpochAtEpoch(epoch) == FAR_FUTURE_EPOCH:\n      current_fork_version\n    else:\n      cfg.forkVersionAtEpoch(cfg.nextForkEpochAtEpoch(epoch))\n```",
        "created_at": "2025-10-02T18:31:09.509000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "which is consistent with this",
        "created_at": "2025-10-02T18:31:54.410000+00:00",
        "attachments": null
    },
    {
        "author": "pawandhananjay",
        "category": "Testing",
        "parent": "",
        "content": "just noting that even if we set `next_fork_version` to fulu, we ideally shouldn't be disconnecting from peers that haven't updated. The spec mentions:\n\u003e Clients MAY connect to peers with the same fork_digest but a different next_fork_version/next_fork_epoch. Unless ENRForkID is manually updated to matching prior to the earlier next_fork_epoch of the two clients, these connecting clients will be unable to successfully interact starting at the earlier next_fork_epoch.\n\nThere would be a split between updated and non-updated nodes before the fork if we do that",
        "created_at": "2025-10-02T18:48:07.385000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "can confirm:\n\neth2 values:\n\nLh:\n0xad532ceb05000000ffffffffffffffff\n\nprysm:\n0xad532ceb06000000ffffffffffffffff",
        "created_at": "2025-10-02T18:53:24.360000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Testing",
        "parent": "",
        "content": "Yes, agreed. Prysm shouldn't disconnect because of a different `next_fork_version`.",
        "created_at": "2025-10-02T18:56:42.177000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Testing",
        "parent": "",
        "content": "Has prysm always behaved this way?",
        "created_at": "2025-10-02T18:57:37.381000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Testing",
        "parent": "",
        "content": "only in latest release",
        "created_at": "2025-10-02T18:57:56.876000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Testing",
        "parent": "",
        "content": "What we had in this release: disconnect if next_epoch matches, but next_fork_version does not match\n- I believe this resolves the concern about peers that have not upgraded before scheduled forks (were it not for this bug)\nOur planned patch: disconnect if next_epoch != far_future_epoch, next_epoch matches remote value, but next_fork_version does not match\n- (and ofc we are also fixing the bug in how we set next_fork_version when the upcoming fork is unscheduled)",
        "created_at": "2025-10-02T19:08:50.533000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Testing",
        "parent": "",
        "content": "The patched change makes sense to me üëç will you also disconnect if:\n* `next_fork_version != current_fork_version` and `local_next_epoch != remote_next_epoch`",
        "created_at": "2025-10-02T19:16:08.985000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@833706406699073536\u003e But why are you disconnecting from not-upgraded peers before the fork?",
        "created_at": "2025-10-02T19:41:18.573000+00:00",
        "attachments": null
    },
    {
        "author": "pawandhananjay",
        "category": "Testing",
        "parent": "",
        "content": "i'm confused. Is the condition to disconnect\n```\nif remote.next_fork_epoch != far_future_epoch ||  (local.next_fork_epoch == remote.next_fork_epoch \u0026\u0026 remote.next_fork_version != local.next_fork_version\n```",
        "created_at": "2025-10-02T19:45:39.901000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Testing",
        "parent": "",
        "content": "And to be clear, `next_epoch` here should be `next_fork_epoch`",
        "created_at": "2025-10-02T19:46:33.208000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Testing",
        "parent": "",
        "content": "disconnect condition would be: `if remote.next_fork_epoch != far_future_epoch \u0026\u0026 local.next_fork_epoch == remote.next_fork_epoch \u0026\u0026  \u0026\u0026 remote.next_fork_version != local.next_fork_version`",
        "created_at": "2025-10-02T21:12:20.364000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Testing",
        "parent": "",
        "content": "I think the above pseducode covers all the bases, only disconnecting from peers that are genuinely misconfigurd, but let me know if you think of a scenario I'm missing.",
        "created_at": "2025-10-02T21:19:26.413000+00:00",
        "attachments": null
    },
    {
        "author": "pawandhananjay",
        "category": "Testing",
        "parent": "",
        "content": "does make sense. \nAlthough for us, we just disconnect if `remote.fork_digest != local.fork_digest`.",
        "created_at": "2025-10-02T22:13:33.331000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "Testing",
        "parent": "",
        "content": "Why do we only seem to get 0 or 9 blobs and nothing in between?\nhttps://light-holesky.beaconcha.in/slots/filtered?f=\u0026f.missing=0\u0026f.orphaned=1\u0026c=50\u0026d=1+2+3+4+5+6+7+8+9+10+17+11",
        "created_at": "2025-10-02T23:35:14.422000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "Testing",
        "parent": "",
        "content": "",
        "created_at": "2025-10-02T23:36:06.433000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "Screenshot_2025-10-03_at_9.35.58_am.png",
                "content": "39e067a23c4163da20fb94345b736f0713e8fa49831a91d2d0e9b46ffdbcf1fe"
            }
        ]
    }
]