[
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "I noticed that the engine API spec for Prague refers to the new EIP-6110 field as `DepositRequestV1` and `depositRequests`, while EIP-6110 still refers to these as deposit receipts, is the EIP outdated?",
        "created_at": "2024-05-03T12:59:01.489000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "AFAICS, the EIP refers to receipts mainly in the CL part which hasn't been switched to requests (and shouldn't be from my perspective)",
        "created_at": "2024-05-03T13:10:32.309000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "but the EL part of the EIP has been switched to requests:)?",
        "created_at": "2024-05-03T13:11:18.964000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "sorry, but the CL part of the EIP links to https://github.com/ethereum/consensus-specs/blob/2660af05390aa61f06142e1c6311a3a3c633f720/specs/_features/eip6110/beacon-chain.md which has an `ExecutionPayload` type that matches `ExecutionPayloadV4` in the engine spec, except it lacks the `deposit_requests` field and instead has a `deposit_receipts` field. surely either the EIP or the engine API spec has to change?",
        "created_at": "2024-05-03T13:16:09.996000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "For example LH and prysm follow the EIP, not the engine API spec:\n\nhttps://github.com/sigp/lighthouse/pull/5532/files#diff-47464a41bc2fcf0cd604a97556206082814f22fb843853af5c3074a979193d3f\n\nhttps://github.com/prysmaticlabs/prysm/blob/80bff0dc2d1e9ad655db7287320afca06fbf20cd/proto/engine/v1/execution_engine.proto#L108\n\nSo what do we do for devnet0 EL side? drop the engine API spec?",
        "created_at": "2024-05-03T17:38:39.502000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@\u0026595683609080365088\u003e \u003c@\u0026595683849225240704\u003e just fyi for EIP-6110 ^ engine spec says `depositRequests` (EIP says `depositReceipts`)\n\nboth reth and geth expect `depositRequests` in line with the engine API spec",
        "created_at": "2024-05-03T17:41:37.125000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "i dont see a PR updating the engine APIs so i would assume the following:\n\n- CL ingests a block, and makes a new payload message following the engine APIs as written\n- the EL can parse the data however they want upon receipt of the message\n\nAFAIK the EL has a different encoding w/ the new \"requests\" structure",
        "created_at": "2024-05-03T17:50:14.207000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "i expect to harmonize this across the EL and CL but to facilitate a short turn around of implementation, we elected to keep the CL stuff as is for devnet-0",
        "created_at": "2024-05-03T17:50:46.226000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "it would be a minor change for devnet-1 and onwards to change the message layout",
        "created_at": "2024-05-03T17:51:01.769000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "gotcha, so LH/prysm in that case would need to update since it's not in line with the engine apis? and ELs should expect a `depositRequests` key in the payload, not a `depositReceipts`",
        "created_at": "2024-05-03T17:51:49.059000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "let me go see what they have",
        "created_at": "2024-05-03T17:53:03.078000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Testing",
        "parent": "",
        "content": "Any reason the engine API doesn't follow the EIP?",
        "created_at": "2024-05-03T18:03:29.926000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "that was my original q: https://discord.com/channels/595666850260713488/892088344438255616/1235938669710282883",
        "created_at": "2024-05-03T18:05:41.622000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "i think what we had agreed to was to accept the new requests format on the EL, and then leave the CL and Engine API alone -- with the idea being that it would be less for CL teams to also implement and the Engine API can serve as a (temporary) bridge between them",
        "created_at": "2024-05-03T18:54:29.440000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "that being said, if its easier to update the engine API, lets just do that",
        "created_at": "2024-05-03T18:54:45.552000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "in that case this shouldnt have been merged since it was in line with the eip prior to that: https://github.com/ethereum/execution-apis/pull/535\n\ni dont mind if either way, i just want clarity on if we should use `depositRequests` or `depositReceipts`:)",
        "created_at": "2024-05-03T18:58:11.110000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "it looks like the prysm impl conforms to the engine api, other than the name change",
        "created_at": "2024-05-03T18:59:52.216000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "and aligns w/ what i have above -- that the EL will handle them a bit different once they have them from the engine API",
        "created_at": "2024-05-03T19:00:13.411000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "i would go w/ `depositRequests`",
        "created_at": "2024-05-03T19:01:07.140000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "that PR (#535) is included in the devnet-0 specs and so clients should implement that",
        "created_at": "2024-05-03T19:02:21.772000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "it has `depositRequests`",
        "created_at": "2024-05-03T19:02:26.910000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "looks like lighthouse is in the same boat -- i would guess either the teams missed the change, or haven't gotten around to the update yet",
        "created_at": "2024-05-03T19:03:18.484000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "yep, my main point was: the version of eip-6110 in the devnet-0 specs tells CLs to add `depositReceipts` to `ExecutionPayload`, which it seems they have done, but this conflicts with what the engine API specs we have included in devnet-0 say: they say to add `depositRequests`",
        "created_at": "2024-05-03T19:03:26.017000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "i dont think any CL has a complete devnet-0 branch yet",
        "created_at": "2024-05-03T19:03:38.146000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "the eip is telling you to do one thing, engine specs say another:)",
        "created_at": "2024-05-03T19:03:42.178000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "right, then we may be missing an update to 6110",
        "created_at": "2024-05-03T19:04:12.762000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "let me go see what is linked in the spec",
        "created_at": "2024-05-03T19:04:27.708000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "hmm ok, i think i see the confusion",
        "created_at": "2024-05-03T19:05:03.938000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "the EL payload is structured differently than what is in the Engine API",
        "created_at": "2024-05-03T19:05:18.966000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "the file eip6110/beacon-chain.md at the commit we froze at says`deposit_receipts`, which the eip links to",
        "created_at": "2024-05-03T19:05:29.040000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "that link may be stale",
        "created_at": "2024-05-03T19:05:52.228000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "it also says it here: https://github.com/ethereum/EIPs/blob/08e599b0f4dcf2a5fa90926b99c0612c8997d7f7/EIPS/eip-6110.md#consensus-layer (frozen commit)",
        "created_at": "2024-05-03T19:06:05.375000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "https://notes.ethereum.org/@ethpandaops/pectra-devnet-0\n\ni would go from the links here",
        "created_at": "2024-05-03T19:06:05.809000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "yes, that's where i got the link from:)",
        "created_at": "2024-05-03T19:06:18.027000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "if you click on eip-6110 in that doc, scroll to CL, it says `deposit_receipts` and also links to `beacon-chain.md` which also says `deposit_receipts`",
        "created_at": "2024-05-03T19:06:50.176000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "right",
        "created_at": "2024-05-03T19:07:37.655000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "so `ExecutionPayloadV4` in the engine API labels it `depositRequests` \n\nthe CL grabs that data and puts it into the CL `ExecutionPayload` type as `deposit_receipts` (and so Prysm and LH need no change for those types)",
        "created_at": "2024-05-03T19:09:33.888000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "there are two different names for now",
        "created_at": "2024-05-03T19:11:04.337000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "CL also posts this type to EL, so if they post it with `depositReceipts` and EL's conform to the engine API spec we froze at, then it won't work",
        "created_at": "2024-05-03T19:11:06.505000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "CL's would follow the engine api here -- and so they would take their data from their `ExecutionPayload` `deposit_receipts` field and place it into the `ExecutionPayloadV4` `depositRequests` field",
        "created_at": "2024-05-03T19:11:57.345000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "there's translation at the boundary here",
        "created_at": "2024-05-03T19:12:07.651000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "while it is confusing atm, i don't see an issue",
        "created_at": "2024-05-03T19:12:47.434000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "intention is to unify for devnet-1 and beyond",
        "created_at": "2024-05-03T19:13:09.201000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "are CLs aware of this translation? sifting through https://github.com/sigp/lighthouse/pull/5532 it does not seem to be the case for LH",
        "created_at": "2024-05-03T19:15:44.803000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "grepping for depositRequest in prysm, does also not seem to be the case",
        "created_at": "2024-05-03T19:17:50.421000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "will just follow engine spec then, but still thought i'd flag:)",
        "created_at": "2024-05-03T19:18:27.205000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Testing",
        "parent": "",
        "content": "so in devnet 1 we want to rename all these fields from deposit_receipts to deposit_requests? like deposit_receipts_start_index",
        "created_at": "2024-05-03T19:21:39.893000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Testing",
        "parent": "",
        "content": "but for now we are just doing some remapping?",
        "created_at": "2024-05-03T19:21:56.076000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "i do believe the devnet-0 specs are consistent, even if confusing\n\nso that's what we should all target for devnet-0\n\nagain, not sure if CLs are aware or if they just haven't made the updates yet, as it was a bit of a last minute change",
        "created_at": "2024-05-03T19:27:56.182000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "not too sure about the rest of the fields, but at least deposit_receipts to deposit_requests in the engine api executionpayload",
        "created_at": "2024-05-03T19:28:00.160000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "open question, but i think generally we want to mirror the names across EL and CL",
        "created_at": "2024-05-03T19:28:18.782000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "they do not feel consistent to me, i think most CLs expect that `ExecutionPayload` is what they post over the engine api:) at least it looks like thats how lighthouse is designed, but admittedly it's not my area of expertise",
        "created_at": "2024-05-03T19:28:28.430000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "i meant consistent in the sense that there is no change needed",
        "created_at": "2024-05-03T19:28:47.528000+00:00",
        "attachments": null
    },
    {
        "author": "nordbjerg",
        "category": "Testing",
        "parent": "",
        "content": "ok sg",
        "created_at": "2024-05-03T19:28:59.056000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "this was an intentional tradeoff as we wanted to refactor a la EIP-7685 last minute",
        "created_at": "2024-05-03T19:29:47.040000+00:00",
        "attachments": null
    }
]