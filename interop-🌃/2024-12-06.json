[
    {
        "author": "pawandhananjay",
        "category": "Testing",
        "parent": "",
        "content": "taking down the mekong lighthouse-nimbusel-1 validators for some testing",
        "created_at": "2024-12-06T06:43:08.360000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "Does `calc_excess_blob_gas` (from EIP-4484) in EIP-7742 use `target_blobs_per_block` from current block or from parent block?",
        "created_at": "2024-12-06T19:28:02.077000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "From what I understood, the current block header's target blobs per block, this is how we are coding the tests but anyone else please feel free to correct this",
        "created_at": "2024-12-06T19:30:37.649000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "That is okay, this is more question about calculating `excess` gas",
        "created_at": "2024-12-06T19:32:38.924000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Yes, I meant replacing the `TARGET_BLOB_GAS_PER_BLOCK` with the current value that was received from the CL, which is the same that should be in the header of the current block being processed",
        "created_at": "2024-12-06T19:34:51.447000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "Cool, I assumed the same",
        "created_at": "2024-12-06T19:35:35.682000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "Hm on second thought, if\n* `target_blobs_per_block` got incremented in current block\n* `calc_excess_blob_gas` would return smaller excess as `return parent.excess_blob_gas + parent.blob_gas_used - TARGET_BLOB_GAS_PER_BLOCK`\n* It would decrease its own the `blob_gasprice` as it is calculated as: `e ** (excess_blob_gas / denominator)`",
        "created_at": "2024-12-06T19:54:00.148000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "If it is not parent i could be slightly exploited for its own slight benefit, if we use parent there is no immediate benefit for current block.",
        "created_at": "2024-12-06T19:59:02.442000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "But it's not something that the proposer can modify at will, the CL has to verify this value is correct",
        "created_at": "2024-12-06T20:00:34.227000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "Maybe i am just overthinking. Not sure how bumping to new value happens in CL",
        "created_at": "2024-12-06T20:01:20.634000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Has to be at the very least a CL only hard fork iiuc",
        "created_at": "2024-12-06T20:01:57.849000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "I see, current value works than",
        "created_at": "2024-12-06T20:03:01.864000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Yeah, we are adding tests for variable target blobs per block with many different values anyway, even if this value is not expected to change frequently",
        "created_at": "2024-12-06T20:03:39.258000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "Testing",
        "parent": "",
        "content": "We use parent. Think the 1 block “delay” is ok.",
        "created_at": "2024-12-06T20:31:00.962000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Yeah I'm having second thoughts after reading this bit:\n\u003e For a genesis block with no existing parent, the value should be set according to the agreed specification for the target blob count given by that genesis block's protocol rule set.\n\nBut the rest of the EIP reads to me like it's supposed to be the current block's target the one that should be plugged in the excess blob gas formula\n\ncc \u003c@539495253418180618\u003e",
        "created_at": "2024-12-06T21:03:25.135000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "Testing",
        "parent": "",
        "content": "We discussed this a bit here https://github.com/ethereum/EIPs/pull/8994#discussion_r1823574267 (within the context of a change to the calc that didn't go through)",
        "created_at": "2024-12-06T21:34:30.893000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "Clarification would be awesome. In general it does not matter what we use if changing the value requires CL fork.",
        "created_at": "2024-12-06T21:38:26.923000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "Testing",
        "parent": "",
        "content": "The parent is already used in the 4844 version of the calc so think it makes sense to align rather than mix parent with current - makes impl a bit neater in besu at least",
        "created_at": "2024-12-06T21:43:16.013000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Testing",
        "parent": "",
        "content": "Would agree",
        "created_at": "2024-12-06T22:03:33.757000+00:00",
        "attachments": null
    }
]