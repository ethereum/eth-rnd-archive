[
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "Hey all. I've just set the head of the EL client back by 10K blocks, and my attached nimbus kind of chokes on it",
        "created_at": "2022-08-23T11:13:45.529000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "it keeps feeding me a batch of blocks over and over and over and voer in newpayload",
        "created_at": "2022-08-23T11:14:07.415000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "but does not give me a forkchcoise update at all",
        "created_at": "2022-08-23T11:14:15.188000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "so my execution client can't trigger sync",
        "created_at": "2022-08-23T11:14:25.808000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Have you removed them entirely? What is the response to the `newPayload` messages that Nimbus keeps sending? Is this happening post-Merge?",
        "created_at": "2022-08-23T11:16:22.389000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "mainnet shadowfork",
        "created_at": "2022-08-23T11:17:39.096000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "should be beacon.PayloadStatusV1{Status: beacon.SYNCING}, nil",
        "created_at": "2022-08-23T11:18:24.900000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "but I still need a fcu",
        "created_at": "2022-08-23T11:18:38.300000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "otherwise I can't do anything",
        "created_at": "2022-08-23T11:18:41.561000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Ok, so it's post-Merge and then it shouldn't matter what is the response, should be a bug in Nimbus",
        "created_at": "2022-08-23T11:19:31.605000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "it presumably doesn't think they're optimistically importable, do you have debug logs?",
        "created_at": "2022-08-23T13:41:44.195000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "lighthouse is also stuck in the same situation, but is doing the other way around: it's sending fcu, but no newpayload, so in that case I don't have the header to sync",
        "created_at": "2022-08-23T13:46:37.229000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "the first condition it checks is\n```nim\n  if  blck.slot + self.safeSlotsToImportOptimistically \u003c=\n      self.getBeaconTime().slotOrZero:\n    return true\n```\nwhich implements\n\u003e The current slot (as per the system clock) is at least `SAFE_SLOTS_TO_IMPORT_OPTIMISTICALLY` ahead of the slot of the block being imported.\n\nso it's a bit odd that should happen",
        "created_at": "2022-08-23T13:46:44.378000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "its happening on msf11, so you should have ssh access \u003c@654267572107083777\u003e",
        "created_at": "2022-08-23T13:50:27.204000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "oh, indeed, alright",
        "created_at": "2022-08-23T13:50:52.465000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "i can't unstuck lightouse",
        "created_at": "2022-08-23T13:51:57.346000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "It just refuses to issue a newpayload",
        "created_at": "2022-08-23T13:52:02.256000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "I've restarted in various combinations",
        "created_at": "2022-08-23T13:52:18.513000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "It just sends me a fcu with an unknown hash",
        "created_at": "2022-08-23T13:52:24.437000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "and then does nothing",
        "created_at": "2022-08-23T13:52:28.150000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@491624610215886849\u003e might be awake from lh?",
        "created_at": "2022-08-23T13:53:22.374000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@206016661470314496\u003e mainnet-shadow-fork-11-nimbus-geth-2  or mainnet-shadow-fork-11-nimbus-geth-1?",
        "created_at": "2022-08-23T13:53:44.845000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "nimbus-geth-1 resovled after I restarted nimbus",
        "created_at": "2022-08-23T13:54:16.192000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "but it does have the logs, it's what you're referring to above?",
        "created_at": "2022-08-23T13:54:33.924000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "nimbus-geth-2 keeps sending newPayloads without a fcu",
        "created_at": "2022-08-23T13:55:27.674000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "I need a fco to trigger a sync",
        "created_at": "2022-08-23T13:55:48.319000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "`907e87635608   parithoshj/nimbus:merge-33546f0                                         \"beacon_node --non-i‚Ä¶\"   7 days ago       Up 28 seconds`?",
        "created_at": "2022-08-23T13:59:20.758000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "(the last part specifically)",
        "created_at": "2022-08-23T13:59:57.403000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "I restarted it, hoping it would fix somethin",
        "created_at": "2022-08-23T14:00:48.722000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "nimbus-1 got fixed with a restart",
        "created_at": "2022-08-23T14:01:02.484000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "nimbus-2 just spins, refuses to send a fcu",
        "created_at": "2022-08-23T14:01:10.521000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "lighthouse send 1 fcu, then says screw you, not giving you anything until you figure out how to sync alone",
        "created_at": "2022-08-23T14:01:40.521000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "oh, it's stuck in a loop:\n```\nDBG 2022-08-22 15:25:02.189+00:00 newPayload: succeeded                      parentHash=99cf0fe6 blockHash=cbb1276d blockNumber=15391984 payloadStatus=INVALID\nDBG 2022-08-22 15:25:02.190+00:00 runQueueProcessingLoop: execution payload invalid executionPayloadStatus=INVALID blck=\"(blck: (slot: 43861, proposer_index: 35725, parent_root: \\\"18cee689\\\", state_root: \\\"b3e82c0f\\\", eth1data: (deposit_root: d70a234731285c6804c2a4f56711ddb8c82c99740f207854891028af34e27e5e, deposit_count: 0, block_hash: 8a8b96479f1e185b7502580d6f918fe359d4bec877364dd222c711477f5fc51b), graffiti: \\\"Lighthouse/v2.5.1-e5fc9f2\\\", proposer_slashings_len: 0, attester_slashings_len: 0, attestations_len: 8, deposits_len: 0, voluntary_exits_len: 0, sync_committee_participants: 489), signature: \\\"84693a81\\\")\"\nNOT 2022-08-22 15:25:02.190+00:00 Received invalid sequence of blocks        topics=\"syncman\" request=43860:27@19 peer=16U*Nihduh direction=forward blocks_count=22 blocks_map=xxxxxx.x.xx.xx.xx.xxxxxxxxx sync_ident=main\n```",
        "created_at": "2022-08-23T14:09:42.667000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "it keeps finding different sync peers",
        "created_at": "2022-08-23T14:09:52.285000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "does msf11 have a block explorer?",
        "created_at": "2022-08-23T14:13:53.593000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@199561711278227457\u003e sometimes you used a URL scheme which would create https://explorer.mainnetshadowfork11.ethdevops.io/ but I get 503 Service Unavailable",
        "created_at": "2022-08-23T14:15:37.129000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "beaconchain is up and working, the el one is broken since it was pointed at the unhealthy geth. I can point it elsewhere and it should come back up.",
        "created_at": "2022-08-23T14:15:51.025000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "okay, I basically want to see what ELs thought of that block in general",
        "created_at": "2022-08-23T14:16:22.324000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "checking with other Nimbus-EL pairs",
        "created_at": "2022-08-23T14:18:22.589000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "it should be back up, but it'll take time to sync",
        "created_at": "2022-08-23T14:18:25.910000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "that's useful to have, yeah",
        "created_at": "2022-08-23T14:18:38.525000+00:00",
        "attachments": null
    },
    {
        "author": "ethdreamer",
        "category": "Testing",
        "parent": "",
        "content": "Which machine?",
        "created_at": "2022-08-23T14:32:02.348000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "What is the response of geth to that FCU? If it's anything but a timeout I think we would send the next payload",
        "created_at": "2022-08-23T14:33:51.403000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "oddly, https://explorer.mainnetshadowfork11.ethdevops.io/blocks is stuck on same block number as in Nimbus logs",
        "created_at": "2022-08-23T14:35:44.647000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "",
        "created_at": "2022-08-23T14:37:46.283000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "2022-08-23-163736_946x1048_scrot.png",
                "content": "9cdae136dbb6012b064445addd4849bdddd9e9630d16327f843408b34680f0aa"
            }
        ]
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@199561711278227457\u003e is that a hangover from previous issues or is that based on current indexing?",
        "created_at": "2022-08-23T14:38:21.830000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "logs dont seem healthy, so its probably hung over from the previous issue. ill try pointing at some other node.",
        "created_at": "2022-08-23T14:39:33.744000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "from `nimbus-besu-1`:\n```\nDBG 2022-08-22 15:17:13.539+00:00 newPayload: succeeded                      parentHash=99cf0fe6 blockHash=cbb1276d blockNumber=15391984 payloadStatus=VALID\nDBG 2022-08-22 15:17:13.728+00:00 newPayload: succeeded                      parentHash=99cf0fe6 blockHash=cbb1276d blockNumber=15391984 payloadStatus=VALID\nDBG 2022-08-22 15:25:50.732+00:00 newPayload: succeeded                      parentHash=99cf0fe6 blockHash=26aeddb1 blockNumber=15391984 payloadStatus=VALID\nDBG 2022-08-22 15:32:16.959+00:00 newPayload: succeeded                      parentHash=99cf0fe6 blockHash=26aeddb1 blockNumber=15391984 payloadStatus=VALID\n```",
        "created_at": "2022-08-23T14:41:13.622000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "same payload/block as above",
        "created_at": "2022-08-23T14:41:19.760000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "https://beaconchain.mainnetshadowfork11.ethdevops.io/block/43861 shows same payload",
        "created_at": "2022-08-23T14:48:05.338000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "presumably the EL it's using didn't find that payload `INVALID`",
        "created_at": "2022-08-23T14:48:27.358000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "nimbus-1 is also stuck, no engine api call whatsoever now",
        "created_at": "2022-08-23T15:03:09.207000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "I guess `STATUS_SYNCING`",
        "created_at": "2022-08-23T15:03:46.178000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "also with Nethermind (it explores a couple forks here):\n```\nmainnet-shadow-fork-11-nimbus-nethermind-1 ‚ûú  ~ grep VALID 15391984.txt\nDBG 2022-08-22 15:17:12.977+00:00 newPayload: succeeded                      parentHash=99cf0fe6 blockHash=cbb1276d blockNumber=15391984 payloadStatus=VALID\nDBG 2022-08-22 15:25:49.353+00:00 newPayload: succeeded                      parentHash=99cf0fe6 blockHash=26aeddb1 blockNumber=15391984 payloadStatus=VALID\n```",
        "created_at": "2022-08-23T15:03:57.284000+00:00",
        "attachments": null
    },
    {
        "author": "ethdreamer",
        "category": "Testing",
        "parent": "",
        "content": "hmmm lighthouse isn't receiving any new blocks which would explain why no new payload..",
        "created_at": "2022-08-23T15:04:16.625000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "but one of them is `cbb1276d`",
        "created_at": "2022-08-23T15:04:24.857000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "so same block/payload, Geth says `INVALID`, Besu and Nethermind say `VALID`",
        "created_at": "2022-08-23T15:04:55.004000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "lighthouse-geth-1/2",
        "created_at": "2022-08-23T15:04:57.512000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "CL block explorer shows it implicitly as `VALID`",
        "created_at": "2022-08-23T15:05:27.414000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "I think the question is, what does Geth think is `INVALID` about this payload?",
        "created_at": "2022-08-23T15:06:07.049000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Then I think prysm will always send you both FCU/newpayload. The only way we can be stuck in this scenario is if the EL does not return or returns an error.",
        "created_at": "2022-08-23T15:06:31.573000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "because, yes, if you tell a CL the payload is `INVALID`, and the network keeps feed that payload to them...",
        "created_at": "2022-08-23T15:06:35.472000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "Prysm works",
        "created_at": "2022-08-23T15:06:47.318000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "with with Prysm/Geth, does Geth think the EL block `0xcbb1276df19d02ae2f63bdb04d3b9ff50a7ceec689f89e9421da2dd54425a94b` is valid?",
        "created_at": "2022-08-23T15:07:32.824000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "or does it not come up somehow",
        "created_at": "2022-08-23T15:07:45.553000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "Currently all Geth nodes are corrupted",
        "created_at": "2022-08-23T15:07:57.467000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "We're trying to find which commit broke it",
        "created_at": "2022-08-23T15:08:03.751000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "but I need to be able to run a geth node",
        "created_at": "2022-08-23T15:08:12.396000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "and seems all consensus clients have some issues and just refuse to give us anything",
        "created_at": "2022-08-23T15:08:21.777000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "so a fresh restart of geth and becon-client-x results in s hang",
        "created_at": "2022-08-23T15:08:32.732000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "in various flavors",
        "created_at": "2022-08-23T15:08:35.696000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "but almost no beacon client does what it's supposed to",
        "created_at": "2022-08-23T15:08:42.806000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "nimbus-geth-1, nimbus doesn't send us any request at all, nothing, not even a ttd config exchange",
        "created_at": "2022-08-23T15:09:02.676000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "nimbus-geth-2 keeps feeding us newpayload, but no fcu",
        "created_at": "2022-08-23T15:09:11.581000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "lighthouse-geth-1/2 sends us 1 fcu in total on startup, nothing ever afterwards, no fcu, no newpayload",
        "created_at": "2022-08-23T15:09:30.904000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "in all these scenarios geth returns SYNCING, because we are missing the needed data",
        "created_at": "2022-08-23T15:09:49.556000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "we need a header from newPayload, and a fcu following that to trigger the sync",
        "created_at": "2022-08-23T15:10:10.457000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@206016661470314496\u003e see above, what I've been writing",
        "created_at": "2022-08-23T15:10:16.211000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "the'res no invalid at this point",
        "created_at": "2022-08-23T15:10:33.673000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "there's zero block processing happening",
        "created_at": "2022-08-23T15:10:45.776000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "geth is just waiting idle",
        "created_at": "2022-08-23T15:10:48.102000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "okay, I'll look at nimbus-geth-1, maybe it's different",
        "created_at": "2022-08-23T15:10:54.865000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Testing",
        "parent": "",
        "content": "teku should do the same.",
        "created_at": "2022-08-23T15:11:03.252000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "the teku node we just restarted seems to work",
        "created_at": "2022-08-23T15:11:20.911000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "nimbus-geth-1 is in a restart loop for maybe related reasons at some point, but as far as what's happening right now, it's in a restart loop",
        "created_at": "2022-08-23T15:20:19.859000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "which is definitely a Nimbus issue, but not what's going on with nimbus-geth-2",
        "created_at": "2022-08-23T15:20:40.246000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "interestingly:\n```\nmainnet-shadow-fork-11-nimbus-geth-1 ‚ûú  ~ grep 15391984 nimbus.logs\nDBG 2022-08-22 15:17:12.358+00:00 newPayload: inserting block into execution engine parentHash=99cf0fe6 blockHash=cbb1276d stateRoot=b5618b8a receiptsRoot=96145c27 prevRandao=8668a0d7 blockNumber=15391984 gasLimit=30000000 gasUsed=19063385 timestamp=1661181432 extraDataLen=0 baseFeePerGas=8 numTransactions=219\nDBG 2022-08-22 15:17:12.469+00:00 newPayload: succeeded                      parentHash=99cf0fe6 blockHash=cbb1276d blockNumber=15391984 payloadStatus=VALID\nDBG 2022-08-22 15:25:50.068+00:00 newPayload: inserting block into execution engine parentHash=99cf0fe6 blockHash=26aeddb1 stateRoot=d1d50f95 receiptsRoot=56e81f17 prevRandao=8668a0d7 blockNumber=15391984 gasLimit=30000000 gasUsed=0 timestamp=1661181948 extraDataLen=0 baseFeePerGas=8 numTransactions=0\nDBG 2022-08-22 15:25:50.071+00:00 newPayload: succeeded                      parentHash=99cf0fe6 blockHash=26aeddb1 blockNumber=15391984 payloadStatus=VALID\n```\nsame EL block, but this time says valid",
        "created_at": "2022-08-23T15:22:15.155000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "so depending on ... something, Geth says the same block is `VALID` or `INVALID`?",
        "created_at": "2022-08-23T15:22:30.962000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "nimbus-geth-1 aside (crash, not engine API issue), I'll suggest that maybe this isn't Nimbus being \"completely unable for follow the engine protocol\", per investigation above.",
        "created_at": "2022-08-23T15:29:45.758000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@206016661470314496\u003e does the corruption issue w/ 1.10.22 only happen post-merge?  We've upgraded some of our non-user-facing infra to 1.10.22 on mainnet and are wondering if we need to rollback to an older chain data backup, is the corruption obvious (e.g. the node stops progressing) or more insidious?  We haven't updated any of our testnet infra yet.",
        "created_at": "2022-08-23T15:37:12.410000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "Roll it back",
        "created_at": "2022-08-23T15:48:06.896000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "My guess is that it's a bug in a pruning refactor, leading to data loss",
        "created_at": "2022-08-23T15:48:34.493000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "Please look at today's logs, not yesterday",
        "created_at": "2022-08-23T15:49:22.708000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "I told you, Geth's internal state got fucked up, I rolle dback a ton of blocks but can't convince the consensus client to give me anything to sync to",
        "created_at": "2022-08-23T15:50:30.714000+00:00",
        "attachments": null
    },
    {
        "author": "ethdreamer",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@206016661470314496\u003e we've re-synced on `lighthouse-geth-1` and left `lighthouse-geth-2` in the same state so we can keep debugging. We are seeing `newPayload` messages on `lighthouse-geth-1` but strangely geth still returns `false` to `eth_syncing`",
        "created_at": "2022-08-23T16:20:26.256000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "for now, restarted `nimbus-geth-2` after having gotten relevant logs to let it resync",
        "created_at": "2022-08-23T16:24:42.969000+00:00",
        "attachments": null
    },
    {
        "author": "ethdreamer",
        "category": "Testing",
        "parent": "",
        "content": "we are seeing messages along these lines:\n```\nAug 23 16:25:10.180 DEBG Invalid block received                  outcome: ParentExecutionPayloadInvalid { parent_root: 0xc75ecf58928342f4576db99442264a55bc003ba2e7c9cf127afbd254de1d4067 }, msg: peer sent invalid block\n```\nnot sure how [that block](https://beaconchain.mainnetshadowfork11.ethdevops.io/block/44595) could've been marked invalid unless geth told us it was `INVALID`",
        "created_at": "2022-08-23T17:00:24.067000+00:00",
        "attachments": null
    },
    {
        "author": "ethdreamer",
        "category": "Testing",
        "parent": "",
        "content": "but we don't have the logs to look anymore - only option for now is to re-sync and try to see later if we can cause this again",
        "created_at": "2022-08-23T17:01:12.087000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "nimbus-geth-2 synced again, seems to be running fine, should push participation up a couple %",
        "created_at": "2022-08-23T17:05:24.339000+00:00",
        "attachments": null
    },
    {
        "author": "ethdreamer",
        "category": "Testing",
        "parent": "",
        "content": "okay it looks like geth previously rejected the block with invalid merkle root so we marked it invalid and won't accept any chain that has it:\n```\nAug 22 15:17:12.730 DEBG Invalid gossip beacon block, block slot: 43861, block root: 0xe796163d0e673f9e278baa79332e10e1a37aa0849a56881fcae0fff35425aeb3, outcome: Err(ExecutionPayloadError(RejectedByExecutionEngine { status: Invalid { latest_valid_hash: 0x99cf0fe671937d24f4883be39961683439b155260a6c9b505cfaa509046929c6, validation_error: So\nme(\"invalid merkle root (remote: b5618b8a291a5b957c9efc3d39dfc90187b66274fbc349edfb21906b6550f4b8 local: 7121ded345a21104407e47b0251815452eb29fba6be6b98219d1b9b2754ea4ab)\") } })), module: network::beacon_processor::worker::gossip_methods:956\n```",
        "created_at": "2022-08-23T17:37:07.248000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "https://github.com/ethereum/consensus-specs/blob/dev/sync/optimistic.md#transitioning-from-valid---invalidated-or-invalidated---valid\n\u003e These operations are purposefully omitted. It is outside of the scope of the\n\u003e specification since it's only possible with a faulty EE.\n\u003e \n\u003e Such a scenario requires manual intervention.",
        "created_at": "2022-08-23T17:39:43.627000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "So just so I understand, LightHouse got INVALID from geth on this bug, they can't sync this block and therefore after a while you won't get a single new block since the chain advanced on that one. So you can't send any new payload to geth. This is the right behavior here and Prysm would act the exact same way, so am I assuming we got that block as VALID? Pari do I have access to those nodes to check if we got VALID from geth on the very same block?",
        "created_at": "2022-08-23T17:54:26.655000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "yesir, you have access. \n\nIf you have enough info, you can run `docker logs snooper 2\u003e\u00261 | grep -A 10 -B 10 \"search term\"` to check the json req/resp to the engine api directly",
        "created_at": "2022-08-23T17:59:00.252000+00:00",
        "attachments": null
    },
    {
        "author": "ethdreamer",
        "category": "Testing",
        "parent": "",
        "content": "That is our current working theory - we haven't restarted `lighthouse-geth-2`  so it's still in a broken state. And we constantly see it refuse to sync the same block with `ParentExecutionPayloadInvalid`, which (as far as I'm aware) would only happen if geth told us at some point that the payload was invalid. We don't have the logs because lighthouse was restarted on that node, but on the bootnode where lighthouse was not restarted, we do see that log message posted above that a canonical block is invalid, so we assume something similar happened",
        "created_at": "2022-08-23T18:10:16.209000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "There's no curl in the devops boxes \u003c@199561711278227457\u003e, how are you querying the API?",
        "created_at": "2022-08-23T18:11:34.693000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "You can install it, you have root perms üòÑ\nIts a new base image that must not have it, i installed it manually on some machines üòÖ",
        "created_at": "2022-08-23T18:13:15.937000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "nice, let's see if I understand how Debian works, it's been years üôÇ",
        "created_at": "2022-08-23T18:13:49.818000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "sudo apt install curl should be enough üòÑ",
        "created_at": "2022-08-23T18:14:09.899000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "if you know the payload you are looking for, you can query the snooper for the req/resp. The snooper hasn't been restarted and should hold logs from the initial convo.",
        "created_at": "2022-08-23T18:14:49.156000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I did, but you don't seem to be exposing the 3500 port to that user. How are you launching the beacon, I suppose this is inside of some Docker container",
        "created_at": "2022-08-23T18:15:55.010000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "port 4000",
        "created_at": "2022-08-23T18:17:03.328000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "sorry, i override the default port to keep it the same across clients",
        "created_at": "2022-08-23T18:17:14.151000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "```\nsudo netstat -tulpen | grep beacon\ntcp        0      0 10.21.1.133:9000        0.0.0.0:*               LISTEN      1000       15087835   9659/beacon-chain   \ntcp        0      0 127.0.0.1:6060          0.0.0.0:*               LISTEN      1000       15090082   9659/beacon-chain   \ntcp6       0      0 :::4001                 :::*                    LISTEN      1000       15084376   9659/beacon-chain   \ntcp6       0      0 :::4000                 :::*                    LISTEN      1000       15087837   9659/beacon-chain   \ntcp6       0      0 :::8000                 :::*                    LISTEN      1000       15084378   9659/beacon-chain   \nudp6       0      0 :::9000                 :::*                                1000       15087847   9659/beacon-chain\n```",
        "created_at": "2022-08-23T18:17:15.545000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Ahh thanks",
        "created_at": "2022-08-23T18:17:21.193000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "8545 for EL\n4000 for CL",
        "created_at": "2022-08-23T18:17:28.447000+00:00",
        "attachments": null
    },
    {
        "author": "ethdreamer",
        "category": "Testing",
        "parent": "",
        "content": "the block is from 22 hours ago - didn't find it with grep",
        "created_at": "2022-08-23T18:17:52.883000+00:00",
        "attachments": null
    },
    {
        "author": "ethdreamer",
        "category": "Testing",
        "parent": "",
        "content": "the snooper uses LOADS of disk space so it only retains like an hour worth of logs",
        "created_at": "2022-08-23T18:19:28.376000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Ok so this block is VALID on prysm-geth-1",
        "created_at": "2022-08-23T18:19:39.258000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "so that's why we didn't hang",
        "created_at": "2022-08-23T18:19:45.937000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "but we would be in the exact same scenario as LightHouse if we would have gotten an INVALID response for this block",
        "created_at": "2022-08-23T18:20:04.584000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@206016661470314496\u003e",
        "created_at": "2022-08-23T18:20:08.349000+00:00",
        "attachments": null
    },
    {
        "author": "ethdreamer",
        "category": "Testing",
        "parent": "",
        "content": "omg lol i've been scp'ing a geth binary",
        "created_at": "2022-08-23T18:20:24.774000+00:00",
        "attachments": null
    },
    {
        "author": "ethdreamer",
        "category": "Testing",
        "parent": "",
        "content": "didn't know we had root",
        "created_at": "2022-08-23T18:20:40.980000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "https://tenor.com/view/worst-security-security-check-gif-14764954",
        "created_at": "2022-08-23T18:24:31.679000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "^security once you've ssh-ed into the machine",
        "created_at": "2022-08-23T18:24:40.071000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Testing",
        "parent": "",
        "content": "ditto Nimbus - once a block is marked invalid (by geth or indeed nimbus itself), it gets cached in a list of invalid blocks and rejected - this cache is cleared on restart - this is necessary because otherwise we have to do a lot of work every time a peer gives us the same ostensibly faulty block",
        "created_at": "2022-08-23T18:31:04.384000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "do you persist the invalid block?",
        "created_at": "2022-08-23T18:35:04.758000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Testing",
        "parent": "",
        "content": "no",
        "created_at": "2022-08-23T18:35:08.900000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "LightHouse does, so I presume that a restart will not save it from this",
        "created_at": "2022-08-23T18:35:21.346000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Prysm doesn't so a restart would make it sync",
        "created_at": "2022-08-23T18:35:31.054000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Testing",
        "parent": "",
        "content": "we don't want someone filling up our db with useless blocks, so we clear on restart - the cache is also bounded, but given how small each entry is, it would be _hard_ for an attacker to fill it",
        "created_at": "2022-08-23T18:36:14.557000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I don't know if the block even makes it to lighthouse DB though if they were in lock-step at that time.",
        "created_at": "2022-08-23T18:37:24.164000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "if we are synced that block never touches forkchoice nor db",
        "created_at": "2022-08-23T18:37:42.519000+00:00",
        "attachments": null
    },
    {
        "author": "realbigsean",
        "category": "Testing",
        "parent": "",
        "content": "We must have imported these blocks to fork choice as optimistic and later invalidated them.  We do seem to persist invalidated blocks which it appears we shouldn't.",
        "created_at": "2022-08-23T19:44:39.162000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "Testing",
        "parent": "",
        "content": "I guess the question here is if we want LH to forget things so that it‚Äôs possible to quietly recover (via reboot) from EL consensus faults. It sounds like it would have been useful here, although it also appears that it helped highlight the VALID/INVALID conflict.\n\nAn option might be for us to reset INVALID blocks to SYNCING on startup (we already do this in some scenarios), but also add a flag to disable it. Then, we can run these shadow forks in ‚Äústrict‚Äù mode with the flag on so that issues like this continue to be highlighted.",
        "created_at": "2022-08-23T20:36:23.330000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "Testing",
        "parent": "",
        "content": "Presently Lighthouse keeps a persistent list of INVALID blocks and won‚Äôt try to reimport them. We actually still have the blocks in our DB so if we flipped the status of that block from INVALID to SYNCING then we wouldn‚Äôt even need to reimport it, we could immediately start building on it.",
        "created_at": "2022-08-23T20:55:36.793000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "FYI, Teku will refuse to a follow a chain after getting INVALID too and refuses to later switch back to considering it VALID (we saw this happen with a besu bug at the G√∂rli merge).  However at startup, Teku loads all non-finalized blocks as optimistic again so if the EL has been fixed we'll then be able to mark them VALID and resume syncing the chain.",
        "created_at": "2022-08-23T21:23:31.111000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "In terms of detecting problems, if a CL can't follow the chain without a restart we should treat that as a pretty big problem.",
        "created_at": "2022-08-23T21:24:35.160000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "And finally it's worth noting that Teku will send a newPayload only when a new payload is actually received. We don't keep resending it, so if block production is stalled, we'd only send fCU repeatedly.  ELs should be able to sync from fCU alone per the engine API, otherwise you can't sync while the chain is stalled (that's not an entirely unreasonable requirement but it's not ideal either).",
        "created_at": "2022-08-23T21:27:06.660000+00:00",
        "attachments": null
    }
]