[
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "I think that this was discussed somewhere (possibly even here) but the current devnet has an exited validator that is in a sync committee and so still earning rewards even though it's all the way at `withdrawal_done`:\n\n```\ncurl -s http://localhost:4000/eth/v1/beacon/states/head/validators/3 | jq .\n{\n  \"execution_optimistic\": false,\n  \"finalized\": false,\n  \"data\": {\n    \"index\": \"3\",\n    \"balance\": \"117044\",\n    \"status\": \"withdrawal_done\",\n    \"validator\": {\n      \"pubkey\": \"0xa5e6db7b7ee214e090af8593769f30a8fc1bc9b9290efeeffd53aba50cc1510d224b7a0fa0f3068b8de2a8746745830a\",\n      \"withdrawal_credentials\": \"0x010000000000000000000000388ea662ef2c223ec0b047d41bf3c0f362142ad5\",\n      \"effective_balance\": \"0\",\n      \"slashed\": false,\n      \"activation_eligibility_epoch\": \"0\",\n      \"activation_epoch\": \"0\",\n      \"exit_epoch\": \"20\",\n      \"withdrawable_epoch\": \"21\"\n    }\n  }\n}\n```\n\n(Note 'status' and 'balance' fields).\n\nAre we comfortable with this?  I know it's an edge case and will be relatively unlikely to show up on mainnet, but it's an ugly rough edge.",
        "created_at": "2022-12-11T10:35:32.212000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Yeah consensus seems to be that we’re ok with it. There are reference tests covering it. It did cause a couple of bugs because it’s possible to get an inactivity penalty after funds withdrawn and so the balance is already zero. Even more fun corner cases if the validator is in the sync committee twice and gets penalised and rewarded at the same time - then you have to be sure to apply the operations in the right order to get the right result.",
        "created_at": "2022-12-11T11:05:28.447000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "But all of that is exceptionally unlikely on MainNet and easy to cover with tests. The alternative would be to increase the delay before withdrawals are allowed I believe.",
        "created_at": "2022-12-11T11:06:01.998000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "Yeah, was considering if there would be some way to delay exit if in a sync committee but that would be messier.  My biggest worry was that it opens up potential underflow issues, but if the cases are fully tested I guess we can leave it in the \"ugly but functional\" bucket.",
        "created_at": "2022-12-11T11:08:15.083000+00:00",
        "attachments": null
    }
]