[
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "I do admit that original intention of ACCEPTED was to reflect Erigon's behaviour, i.e. exactly how Danny has described it. Then at some point I messed up with the semantics of ACCEPTED hence my confusion (and probably not only mine).\n\nWe can align the spec to this original intention and have ACCEPTED and SYNCING statuses in response to `newPayload` -- I am pretty fine with this.\n\nI was thinking about potential use case for ACCEPTED on CL side. CL may leverage it in the following way: it does poll `fcU` if it knows that a chain of ACCEPTED blocks has a common ancestor that isn't that far from current head and expected time to execute this chain is relatively low. Though, not sure if it's valuable for CL to have this kind of logic around ACCEPTED.",
        "created_at": "2022-05-05T08:57:34.051000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "I am also curious does Erigon check things not related to execution e.g. gasLimit, baseFee before returning ACCEPTED? cc \u003c@583892532644151312\u003e",
        "created_at": "2022-05-05T09:00:53.041000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "On another topic. There is an idea to make EL validate that `finalized`, `safe` and `head` do belong to the same chain. How big of implementation complexity it would be for your EL client? Related to this convo: https://github.com/ethereum/execution-apis/pull/213#discussion_r862153230\n\ncc \u003c@583892532644151312\u003e \u003c@758579010027782144\u003e \u003c@827653956955406406\u003e",
        "created_at": "2022-05-05T09:12:38.737000+00:00",
        "attachments": null
    },
    {
        "author": "yperbasis",
        "category": "Testing",
        "parent": "",
        "content": "I've recently implemented it in Erigon to fix a Hive test.",
        "created_at": "2022-05-05T09:19:45.064000+00:00",
        "attachments": null
    },
    {
        "author": "yperbasis",
        "category": "Testing",
        "parent": "",
        "content": "Yes, it does",
        "created_at": "2022-05-05T10:01:20.338000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "A PR based on the recent RFC on `INVALID_TERMINAL_BLOCK` replacement: https://github.com/ethereum/execution-apis/pull/217. Please, take a look - if there is no opposition I'd like it to be merged next week, so we will be able to cover this new change with tests sooner",
        "created_at": "2022-05-05T10:40:16.375000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Testing",
        "parent": "",
        "content": "no problem, we can add extra checks ðŸ˜‰",
        "created_at": "2022-05-05T10:41:27.723000+00:00",
        "attachments": null
    },
    {
        "author": "gezero",
        "category": "Testing",
        "parent": "",
        "content": "Hello, sorry for bothering. On our Besu node on shadowfork3 connected to Prysm we can see that Prysm is sending loads of eth_getBlockByNumber and is basically ddossing our poor besu node. We get around 8000 requests in a minute. Is that to be expected?",
        "created_at": "2022-05-05T15:11:57.786000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Testing",
        "parent": "",
        "content": "We observed the same in Nethermind!",
        "created_at": "2022-05-05T15:26:18.813000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Testing",
        "parent": "",
        "content": "but I think prysm team fixed it before shadowfork. The fix hasn't been deployed (cc: \u003c@363800010518822915\u003e )",
        "created_at": "2022-05-05T15:27:15.535000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Testing",
        "parent": "",
        "content": "I will double check on that now",
        "created_at": "2022-05-05T15:29:26.627000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Testing",
        "parent": "",
        "content": "\u003e Prysm is sending loads of eth_getBlockByNumber and is basically ddossing our poor besu node. We get around 8000 requests \nI see this with nethermind too, something is odd on prysm....",
        "created_at": "2022-05-05T15:30:00.607000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Testing",
        "parent": "",
        "content": "our last pull of the prysm docker image was 15 hours ago",
        "created_at": "2022-05-05T15:30:01.205000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Testing",
        "parent": "",
        "content": "I find the code where we are spamming `eth_getBlockByNumber`, and this is most likely because prysm isn't 100% compatible with shadowfork setup (deposit contract related). I'll talk to \u003c@476250636548308992\u003e he will know how to fix this since he was the original author. He will be online in ~8 hours. We'll keep everyone posted here",
        "created_at": "2022-05-05T15:39:34.691000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "Just so you guys know, this time around we used a new deposit contract. So there are no invalid deposits to processðŸ˜ƒ",
        "created_at": "2022-05-05T15:43:04.853000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Testing",
        "parent": "",
        "content": "is there gonna be a wrap up call today?",
        "created_at": "2022-05-05T15:47:15.859000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@360491619402776577\u003e would geth serve blocks by hash while it's syncing?",
        "created_at": "2022-05-05T16:05:47.635000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "I don't know",
        "created_at": "2022-05-05T16:06:25.137000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "Via rpc? or via network?",
        "created_at": "2022-05-05T16:06:36.051000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Testing",
        "parent": "",
        "content": "We figured it out. We didn't set the contract deployment block flag to the correct value so prysm nodes are working really hard for logs...  Could we please add `--contract-deployment-block=14675001` to all prysm beacon nodes? \u003c@199561711278227457\u003e",
        "created_at": "2022-05-05T16:09:36.030000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "RPC, we're evaluating whether we can simply store the blinded block in our DB, but if we're optimistically syincing we are required to serve blocks via RPC, hence we would have to request the payload to the EL  to reassemble them",
        "created_at": "2022-05-05T16:12:19.076000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Figured it would be easier to ask you first, but I guess to implement this we would require that all ELs do this",
        "created_at": "2022-05-05T16:12:44.654000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "to confirm, TTD happened on msf3, correct? (checked Nimbus blockchain explorer and looks fine, but didn't know if that meant anything yet)",
        "created_at": "2022-05-05T16:17:11.215000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "Yes",
        "created_at": "2022-05-05T16:17:20.668000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "Ahh! I'm out right now but I'll set it as soon as I'm back. Thanks for catching that :)",
        "created_at": "2022-05-05T16:23:19.160000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Are you looking into execution payload deduplication? There is still an open PR on this topic https://github.com/ethereum/execution-apis/pull/146\nwith related discussion thread https://github.com/ethereum/execution-apis/issues/137\n\nYou might want to champion this or a similar proposal. I think that `eth_getBlockByHash` isn't a good solution for deduplication as it doesn't support batching and might be more resourceful for EL to process. Also, as you have mentioned it may not be supported during sync, while we can design `engine_` method with more liberty considering trustful relationships between CL and EL",
        "created_at": "2022-05-05T17:48:48.875000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Yeah, we're thinking that this should be part of the execution API, and this is kind of high priority for the merge to avoid otherwise a db migration",
        "created_at": "2022-05-05T17:50:58.088000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "cc \u003c@311971895828283393\u003e",
        "created_at": "2022-05-05T17:51:38.857000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "You should also loop \u003c@449019668296892420\u003e in as he has more ideas on approach to payloads deduplication",
        "created_at": "2022-05-05T17:52:32.361000+00:00",
        "attachments": null
    },
    {
        "author": "raulj",
        "category": "Testing",
        "parent": "",
        "content": "we see no reason why CL should be storing full paylods, and it is definitely a high priority for us",
        "created_at": "2022-05-05T17:53:08.752000+00:00",
        "attachments": null
    },
    {
        "author": "raulj",
        "category": "Testing",
        "parent": "",
        "content": "the only reason we will need to reconstruct a full payload is when responding to p2p requests, and we keep a cache of full beacon blocks to do these anyways. In the event there is a cache miss, we hope we can request the block from EL",
        "created_at": "2022-05-05T17:53:55.608000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "replying your question there: yes, we need to serve blocks if we are optimistically syncing",
        "created_at": "2022-05-05T17:53:58.990000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "hmm, this might be a problem because EL may not have payloads depending on the case, what if EL is pulling blocks from the network but didn't have one that is requested? or it's pulling header chain now and doesn't have bodies yet",
        "created_at": "2022-05-05T17:55:35.781000+00:00",
        "attachments": null
    },
    {
        "author": "raulj",
        "category": "Testing",
        "parent": "",
        "content": "\u003e what if EL is pulling blocks from the network but didn't have one that is requested\nis it sensible that we do not respond to that block request in this case? given the client doesnt have the block that was requested",
        "created_at": "2022-05-05T17:56:55.704000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Bellatrix p2p spec mentions that invalid payloads may be served via RPC but it doesn't say anything about not responding to block requests. Is there any penalty for a node which doesn't respond to RPC block requests when it should respond?",
        "created_at": "2022-05-05T18:19:17.785000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "it gets downscored",
        "created_at": "2022-05-05T19:08:51.360000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "I've added the flag to the prysm besu\u0026nethermind nodes first, please have a look. I can add it to the others in a bit",
        "created_at": "2022-05-05T19:28:47.873000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "That was it! prysm-nethermind is back in the game ðŸ™‚\nGlad to see that was a config issue.",
        "created_at": "2022-05-05T19:51:38.068000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "Screenshot_2022-05-05_at_21.50.59.png",
                "content": "47c719f54f81f13d958e4887efd178754bc978a087849ec274a60f6bb0b67d4d"
            }
        ]
    },
    {
        "author": "marekm3498",
        "category": "Testing",
        "parent": "",
        "content": "Awesome! ðŸ™‚ but I still see lots of eth_getBlockByNumber ðŸ˜¦",
        "created_at": "2022-05-05T20:25:24.756000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Testing",
        "parent": "",
        "content": "cc \u003c@476250636548308992\u003e, that's odd",
        "created_at": "2022-05-05T21:23:06.203000+00:00",
        "attachments": null
    }
]