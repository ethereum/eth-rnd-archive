[
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@\u0026688101493978562687\u003e Have you started implementing withdrawals yet? I'm currently compiling a matrix of all clients and branches, similar to the amphora tracking doc and erigon is the only client where I couldn't find any (preliminary) work",
        "created_at": "2022-10-31T10:11:19.238000+00:00",
        "attachments": null
    },
    {
        "author": "yperbasis",
        "category": "Testing",
        "parent": "",
        "content": "No, we haven't started implementing withdrawals yet.",
        "created_at": "2022-10-31T10:21:01.399000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Testing",
        "parent": "",
        "content": "",
        "created_at": "2022-10-31T10:26:37.060000+00:00",
        "attachments": [
            {
                "type": "image/webp",
                "origin_name": "aNwnNew_460swp.webp",
                "content": "73ea1f39fa18cfa053de323e1904cf372a76572dcd3a62f466e33e9be5be5850"
            }
        ]
    },
    {
        "author": "yperbasis",
        "category": "Testing",
        "parent": "",
        "content": "By the way, do we want to test withdrawals with or without the other 3 EIPs accepted into Shanghai (3651, 3855, 3860)? My preference is to test the 4 EIPs together.",
        "created_at": "2022-10-31T10:30:11.808000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "I don't know, it doesn't matter for the first devnet imo. I want to do a bunch of withdrawal testing and not tough the evm in the beginning",
        "created_at": "2022-10-31T10:32:40.483000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "I'm fine with requiring EL clients to do the 4 eips together",
        "created_at": "2022-10-31T10:33:17.669000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Testing",
        "parent": "",
        "content": "I'm fine with testing all EIPs together.",
        "created_at": "2022-10-31T12:09:55.051000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "Should we do the forking based on timestamps on the devnets already?",
        "created_at": "2022-10-31T12:55:26.760000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "yes please, easier to start testing it from the beginning",
        "created_at": "2022-10-31T13:27:22.825000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "but until things are stable, we can enable the fork at genesis?",
        "created_at": "2022-10-31T13:27:39.376000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "we can do that even with timestamps yes",
        "created_at": "2022-10-31T13:38:00.428000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Testing",
        "parent": "",
        "content": "yes, let's do it by timestamp ðŸ˜‰",
        "created_at": "2022-10-31T15:51:33.207000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "Do cl clients have a way to *initiate* withdrawals already? Is there a spec for this?",
        "created_at": "2022-10-31T17:27:05.824000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "https://github.com/ethereum/execution-apis/pull/195",
        "created_at": "2022-10-31T17:29:49.446000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "not part of spec yet though, no",
        "created_at": "2022-10-31T17:30:04.449000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "No I mean on the cl. How can I tell my validator to add myself to the withdrawal queue?",
        "created_at": "2022-10-31T17:32:07.185000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "oh, a beacon API?",
        "created_at": "2022-10-31T17:32:21.878000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "or similar",
        "created_at": "2022-10-31T17:32:24.197000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "Yes",
        "created_at": "2022-10-31T17:32:26.036000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "Any validator with `0x01` withdrawal credentials will automatically be eligible for withdrawals.  A validator can be set with such credentials at deposit time.",
        "created_at": "2022-10-31T17:32:47.209000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "Thats partial withdrawals, right?",
        "created_at": "2022-10-31T17:33:14.339000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "Yes.  And a full withdrawal is automatic after the validator has exited.",
        "created_at": "2022-10-31T17:33:31.433000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "And there's a beacon api to initiate the exit?",
        "created_at": "2022-10-31T17:33:59.595000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "Yes https://ethereum.github.io/beacon-APIs/#/Beacon/submitPoolVoluntaryExit",
        "created_at": "2022-10-31T17:34:39.920000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "(That's been around since the beginning)",
        "created_at": "2022-10-31T17:34:46.583000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "Very cool! I'll create some tools around it for testnets then",
        "created_at": "2022-10-31T17:35:11.347000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "`ethdo` (https://github.com/wealdtech/ethdo) has this functionality (and is adding in the ability to generate withdrawal credential changes \"soon\")",
        "created_at": "2022-10-31T17:36:07.295000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "(Which reminds me, I should merge that branch.)",
        "created_at": "2022-10-31T17:36:32.011000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Will an API be added for the `BLSToExecutionChange` described here? https://github.com/ethereum/consensus-specs/blob/dev/specs/capella/beacon-chain.md#blstoexecutionchange",
        "created_at": "2022-10-31T17:37:39.173000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "Currently PR at https://github.com/ethereum/beacon-APIs/pull/248",
        "created_at": "2022-10-31T17:38:40.898000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Awesome ðŸ˜„",
        "created_at": "2022-10-31T17:39:31.363000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "love how the withdrawals are automatic in the latest spec",
        "created_at": "2022-10-31T18:59:52.309000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "(provided withdrawal address is set)",
        "created_at": "2022-10-31T19:00:20.936000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Marius, the biggest blocker as far as I can see on withdrawals testnet is a design decision. We currently have a withdrawal queue, and there is a huge simplification in not having one at all in the beaconstate. I think \nhttps://github.com/ethereum/consensus-specs/pull/3068 \nHas enough traction that it may make it to the spec. And if that's the case there's no need in start implementing the spec as it is. As soon as we started implementation of the spec as it is, some issues regarding performance appeared. This was another attempt with which we (mostly) agreed \u003chttps://github.com/ethereum/consensus-specs/pull/3042\u003e. \n\nFrom the point of view of the EL nothing changes. If you want I can hack a branch of prysm that you can use for testing in the EL side of things that withdrawals do work. But I refuse to start implementing and touching state transition and the core logic of prysm if these things are not even discussed before.",
        "created_at": "2022-10-31T19:13:36.885000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "The only real argument that can be considered a con between no-queues and the current design is that full withdrawals are not prioritized and can take up to 5 days to process. Some people (probably including myself) consider this a bad thing. If it's  enough to justify a lot of protocol complexity is a different question",
        "created_at": "2022-10-31T19:15:38.307000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "Note that although full withdrawals will be delayed here, they can already be delayed by there being a large exit queue so it isn't breaking any sort of immediacy guarantee.  Also, it should be possible to calculate at any point in time how long it would take for the final withdrawal to take place if an exit was processed at a given epoch and someone could plan their exit accordingly.  So I don't see this as being such a big issue that it's worth the additional complexity.",
        "created_at": "2022-10-31T19:36:47.332000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Not in this new approach without queues: you do not know if many BLS validators will change their withdrawal credentials immediately before your turn",
        "created_at": "2022-10-31T19:41:56.917000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "The one guarantee that this mechanism does give is that you know after the fact deterministically when a validator did withdraw",
        "created_at": "2022-10-31T19:42:27.166000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "But yeah, I strongly support my own PR as I think the extra complexity is not justifiable",
        "created_at": "2022-10-31T19:44:11.989000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "Okay yeah, but that's a) only a temporary issue and b) bounded.",
        "created_at": "2022-10-31T19:56:51.144000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Not really, there's many other cases you can't foresee, Say you have a a line of validators that have 31.9999ETH (this happens right after a partial withdrawal sweep if the next block is late for example) then these validators attest correctly, they are immediately elligible for partial withdrawal when they weren't before. This is an issue that worried Michael Sproul, but I don't see much trouble with this either",
        "created_at": "2022-10-31T20:02:39.974000+00:00",
        "attachments": null
    },
    {
        "author": "sproul",
        "category": "Testing",
        "parent": "",
        "content": "attestations arenâ€™t actually an issue because theyâ€™re only rewarded on the epoch boundary, itâ€™s just block proposals, sync committee messages and slashings that can change the balance and alter eligibility\n\nbut I think the complexity is manageable, just need a cache thatâ€™s updated after each block (with the ability to revert on re-org)",
        "created_at": "2022-10-31T20:12:18.384000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "yeah right ... oops",
        "created_at": "2022-10-31T20:12:52.537000+00:00",
        "attachments": null
    },
    {
        "author": "sproul",
        "category": "Testing",
        "parent": "",
        "content": "same same though",
        "created_at": "2022-10-31T20:13:03.768000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "for us it will be zero change as we already cache the balances",
        "created_at": "2022-10-31T20:13:19.399000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "and in this case we'll add a new cache for withdrawals right after processing block operations",
        "created_at": "2022-10-31T20:13:36.753000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "It's still bounded, though.  You know that there are _x_ validators between the last processed validator and your validator, which can be turned in to a maximum amount of time* you will have to wait for your withdrawal to take place.\n\n(*Slightly offset by empty slots, but that's historically speaking a small % difference.)",
        "created_at": "2022-10-31T20:21:54.843000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Testing",
        "parent": "",
        "content": "I don't have a ton of context around the prior iterations of the CL withdrawal spec, but is there currently an expectation around what the speed of withdrawals \"should\" be?",
        "created_at": "2022-10-31T20:37:37.224000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I don't think there's any commitments done, there isn't even any consensus as to whether full withdrawals should be prioritized over partial ones (which is the real UX change here)",
        "created_at": "2022-10-31T20:40:05.775000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "a quick poll with very little participation in \u003c#748530848470663208\u003e showed slight advantage to not prioritizing full withdrawals.",
        "created_at": "2022-10-31T20:40:46.526000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Testing",
        "parent": "",
        "content": "Thanks! IMO from a higher level PoV, the question of \"automated\" vs. \"triggered\" partial withdrawals is probably _wayy_ more important than full vs. partial prioritization (because from a staker tax PoV it could have an impact)",
        "created_at": "2022-10-31T20:44:28.594000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "I argued for having fewer withdrawals per epoch (128 or even 64 rather than 256), partly because I think that running an on-chain proof of the withdrawal (useful for smart contract ownership and allocation) could end up burning a lot of the reward in gas.  An alternative would be to have a minimum skim amount (_e.g._ 0.1 ETH), although it would then make life even harder in determining the expected time for the withdrawal.",
        "created_at": "2022-10-31T20:47:04.737000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "Having triggered partial withdrawals would likely produce a lot of \"noise\" operations on the consensus chain, I think that idea was rightly discarded.  If a staker had some sort of tax benefit from making their rewards untouchable they could always translate that directly in to a smart contract that did the same thing except on the execution chain.",
        "created_at": "2022-10-31T20:48:50.962000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Testing",
        "parent": "",
        "content": "Right, and I guess on \"hack\" is not updating to 0x01 credentials, correct? I assume there's no plan to deprecate 0x00 credentials?",
        "created_at": "2022-10-31T20:49:38.400000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "Can't see it being possible to deprecate `0x00`, at least until there are no validators left on the chain using them (and even then someone could always sneak one in during the transition phase).",
        "created_at": "2022-10-31T20:51:22.409000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "I suspect deprecation would look more like changing tools like deposit-cli to not accept 0x00 credentials.  I think that would be quite a reasonable thing to do. They'd always need to be allowed on chain though as there's no validation in the deposit contract to prevent them and it would be unreasonable to burn your 32ETH for using them.",
        "created_at": "2022-10-31T20:52:37.075000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Testing",
        "parent": "",
        "content": "I'd argue against deprecation in tools if it's the only mechanism we have to not trigger automated partial withdrawals, but that's a tangent ðŸ™‚ Sorry for derailing the conversation here!",
        "created_at": "2022-10-31T21:00:26.240000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I think having a minimum skim amount won't change neither code nor the estimative to when your withdrawal will ocurr.  On the other hand, if things go as we expect, every 5 days getting a payout is not so bad.",
        "created_at": "2022-10-31T21:21:42.830000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "Depends on the amount.  If it would flip from \"not eligible\" to \"eligible\" with an average proposal it would make it all a bit more probabilistic.\n\nIt seems I'm alone in worrying about the payout frequency being too high (or more accurately the payout value being too low) to support on-chain proofs for them.  Not sure if people think it's because they don't expect the proofs to be used, or because they expect the amount to be high enough that it doesn't matter.",
        "created_at": "2022-10-31T21:28:36.336000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I am not against having a minimum. My only worry would be about price of ETH growing too much so that smaller payouts could mean weekly spenditure for someone for example",
        "created_at": "2022-10-31T21:31:14.228000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Testing",
        "parent": "",
        "content": "We could decrease the amount in the future though, right?",
        "created_at": "2022-10-31T21:32:28.917000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I tend to think on specification as something that should be as permanent as possible, as any change that requires coordination is hard (you among all people suffer the most ðŸ™‚ ). That's one of the reasons I'm so against the queue.",
        "created_at": "2022-10-31T21:33:46.791000+00:00",
        "attachments": null
    },
    {
        "author": "daniellehrner",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@360491619402776577\u003e Do we need eth/69 for the devnet as well? Or do you think we could test for the time being without it?",
        "created_at": "2022-10-31T21:49:40.798000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "we can def test without it",
        "created_at": "2022-10-31T22:17:43.886000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "eth 68 is entirely optional at tjis point. We might want to forbid blob transactions to be distributed by broadcast in the future, thats what eth/68 is for",
        "created_at": "2022-10-31T22:19:18.614000+00:00",
        "attachments": null
    }
]