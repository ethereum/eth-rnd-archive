[
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "I posted a summary on the acd channel, we're still sorting out the recording",
        "created_at": "2024-08-20T10:01:55.706000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "Are some clients on 1.5.0-alpha.4 and some on 1.5.0-alpha.3 in the branches we use for devnet-2? \ncc \u003c@308223150725005322\u003e \u003c@884836500037066862\u003e \u003c@792822129019584562\u003e",
        "created_at": "2024-08-20T10:04:03.230000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "Asking as pk submitted a consolidation and that seems to have broken the network. But the consolidation as per 1.5.0-alpha.3 should not have worked, but 1.5.0-alpha.4 it should. So the broken network would make sense if we have different spec versions running.",
        "created_at": "2024-08-20T10:05:06.447000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "Consolidated validator: \nhttps://dora.pectra-devnet-2.ethpandaops.io/validator/6610\nhttps://dora.pectra-devnet-2.ethpandaops.io/validator/6611",
        "created_at": "2024-08-20T10:07:42.519000+00:00",
        "attachments": null
    },
    {
        "author": "pk910",
        "category": "Testing",
        "parent": "",
        "content": "The first fork occurred at epoch 4715 -\u003e 4716 transition, prysm pairs forked off there.\nSituation got worse at epoch 4721 -\u003e 4722 transition, lodestar pairs forked off too.\n\nWe've triggered a consolidation for validator 6610 at slot 150693, which was unexpected successful and the balance arrived at the target validator 6611.\nhttps://dora.pectra-devnet-2.ethpandaops.io/slot/150693\n\nWe've also triggered a partial withdrawal for 6611 at slot 150889:\nhttps://dora.pectra-devnet-2.ethpandaops.io/slot/150889",
        "created_at": "2024-08-20T10:24:46.025000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "we are on aplha 3 branch, let me push fixes",
        "created_at": "2024-08-20T10:36:42.946000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "Fix for what exactly? üòõ\nDid you already find the bug?",
        "created_at": "2024-08-20T10:37:17.905000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "alpha 3 =\u003e 4, thats what you require?",
        "created_at": "2024-08-20T10:37:34.759000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "no no, devnet-2 should stay on alpha 3. I wanted to know if we deployed alpha 4 by mistake. If lodestar is on alpha 3, then the question is why its on a fork - we dont know yet",
        "created_at": "2024-08-20T10:38:05.304000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "ahh ok, let me look at second transition where we forked off, are you using the `electra-fork-rebasejul30` branch?",
        "created_at": "2024-08-20T10:39:03.103000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "yessir, ethpandaops/lodestar:electra-fork-rebasejul30-7db51a1",
        "created_at": "2024-08-20T10:40:24.895000+00:00",
        "attachments": null
    },
    {
        "author": "pk910",
        "category": "Testing",
        "parent": "",
        "content": "important side info:\nwe've tested a partial withdrawal in slot 150889.\nthat's a el triggered withdrawal request with a specific amount of ETH set.\nin this case we've requested to withdraw 1 ETH from 6611.\nwe haven't tested that so far,  so it might be related to the forks üòâ",
        "created_at": "2024-08-20T10:42:13.797000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "ok i am seeing this error in lodestar: \n```ts\nAug-20 10:41:50.936[chain]           debug: Call engine api newPayload slot=151104, executionBlock=105849\nAug-20 10:41:50.985[chain]           debug: Block error slot=151104, code=BLOCK_ERROR_BEACON_CHAIN_ERROR, error=Withdrawal mismatch at index=0\nError: Withdrawal mismatch at index=0\n    at processWithdrawals (file:///usr/app/packages/state-transition/src/block/processWithdrawals.ts:46:15)\n    at processBlock (file:///usr/app/packages/state-transition/src/block/index.ts:49:7)\n    at stateTransition (file:///usr/app/packages/state-transition/src/stateTransition.ts:105:3)\n    at verifyBlocksStateTransitionOnly (file:///usr/app/packages/beacon-node/src/chain/blocks/verifyBlocksStateTransitionOnly.ts:46:23)\n    at BeaconChain.verifyBlocksInEpoch (file:///usr/app/packages/beacon-node/src/chain/blocks/verifyBlock.ts:114:7)\n    at BeaconChain.processBlocks (file:///usr/app/packages/beacon-node/src/chain/blocks/index.ts:72:7)\n    at JobItemQueue.runJob (file:///usr/app/packages/beacon-node/src/util/queue/itemQueue.ts:101:22)\nAug-20 10:41:51.039[sync]          verbose: Batch process error id=Head, startEpoch=4722, status=Processing, code=BLOCK_ERROR_BEACON_CHAIN_ERROR, error=Withdrawal mismatch at index=0\nError: Withdrawal mismatch at index=0\n```",
        "created_at": "2024-08-20T10:42:40.541000+00:00",
        "attachments": null
    },
    {
        "author": "pk910",
        "category": "Testing",
        "parent": "",
        "content": "yea, lodestar forked off after the 1 ETH was withdrawn from 6611 here:\nhttps://dora.pectra-devnet-2.ethpandaops.io/slot/151104#withdrawals",
        "created_at": "2024-08-20T10:44:36.627000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "ok, will need to debug this",
        "created_at": "2024-08-20T10:47:10.197000+00:00",
        "attachments": null
    },
    {
        "author": "radekkapka",
        "category": "Testing",
        "parent": "",
        "content": "ah yes, we applied the fix 5 days ago which means that restarted nodes have it",
        "created_at": "2024-08-20T10:56:58.503000+00:00",
        "attachments": null
    },
    {
        "author": "radekkapka",
        "category": "Testing",
        "parent": "",
        "content": "let me push an image with this change reverted",
        "created_at": "2024-08-20T10:57:33.449000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "That'd do it üòÑ\nThanks!",
        "created_at": "2024-08-20T11:01:34.662000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "yea can confirm the withdrawal request doesn't seem to be included",
        "created_at": "2024-08-20T11:02:09.318000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "ok figured out the bug, fix confirmed working on lodestar-geth-1, that node is running synced to head now,\n\nwill commit the fix and trigger image build post which you can rollout",
        "created_at": "2024-08-20T11:22:41.186000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "Could you also check why lodestar passed the spec tests but failed in this bug? üòÑ",
        "created_at": "2024-08-20T11:23:21.879000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "triggered the build, most likely coincidence because there was a bug in getting the balance of the partial withdrawal (`withdrawalIndex` was used instead of `withdrawal.index` üòÖ ) to check if it was withdrawable (so must have passed in test)",
        "created_at": "2024-08-20T11:29:26.991000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "(https://github.com/ChainSafe/lodestar/pull/6986/commits/df05ab5c6855ab521b8bda0b22a0749b7e308d8c)",
        "created_at": "2024-08-20T11:33:35.467000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "interesting, i'd have expected it to fail if the wrong value was used for index",
        "created_at": "2024-08-20T11:37:18.521000+00:00",
        "attachments": null
    },
    {
        "author": "pk910",
        "category": "Testing",
        "parent": "",
        "content": "it checked the balance of validator index 0  because it's been the withdrawal with index 0 within the block? üòÑ",
        "created_at": "2024-08-20T11:37:55.963000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "i think it checked with global index üòÜ",
        "created_at": "2024-08-20T11:38:42.017000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "how come it didn't fail spec test?",
        "created_at": "2024-08-20T11:38:47.414000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "most probably the spec test had a nextWithdrawalIndex which was a valid lookup in validators and that validator had sufficient amount \u003e min activation balance for withdrawal to be included",
        "created_at": "2024-08-20T11:41:08.460000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@1035747431461167125\u003e could you debug and see why we passed spec tests, above is my hypo",
        "created_at": "2024-08-20T11:41:41.641000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "Sounds like spec test needs to be a bit more specific then? if thats a correct hypothesis",
        "created_at": "2024-08-20T11:42:05.799000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "yes some random validator balance distribution should have caught this",
        "created_at": "2024-08-20T11:43:28.297000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "ideally spec test should have a way of isolating the `case` so only one correct processing should `pass` the case, sort of like unit test case",
        "created_at": "2024-08-20T11:45:50.437000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "but yea we need to confirm this first",
        "created_at": "2024-08-20T11:46:14.445000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "the new image is build, may be it can be rolled out \u003c@199561711278227457\u003e \u003c@412614104222531604\u003e",
        "created_at": "2024-08-20T11:46:50.033000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "deploying on all lodestar nodes now",
        "created_at": "2024-08-20T11:48:19.807000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "updated, pls check \u003c@792822129019584562\u003e",
        "created_at": "2024-08-20T11:54:09.679000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "checking... yup looks good üëç",
        "created_at": "2024-08-20T11:54:51.780000+00:00",
        "attachments": null
    },
    {
        "author": "radekkapka",
        "category": "Testing",
        "parent": "",
        "content": "please try gcr.io/prylabs-dev/prysm/beacon-chain:pectra-devnet-2",
        "created_at": "2024-08-20T12:04:24.754000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "and the validator image?",
        "created_at": "2024-08-20T12:08:37.652000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "also is a resync needed?",
        "created_at": "2024-08-20T12:08:43.159000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "its in a bootloop \u003c@308223150725005322\u003e \n```\ntime=\"2024-08-20 12:14:39\" level=fatal msg=\"could not update forkchoice's justified checkpoint: could not update justified balances: could not get justified balances: could not process block: could not process block header: parent root 0x6da9b6da4336cd5fc9b1e4a9ead65eae1d0cd189782c0d89e31f97862b9f593c does not match the latest block header signing root in state 0xf04438d08aeb54e268b60489b554030cf71baa01dda397e38a72ec6cab5ca2dd\" prefix=blockchain\n```",
        "created_at": "2024-08-20T12:15:24.004000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "probably the db is cooked",
        "created_at": "2024-08-20T12:15:48.674000+00:00",
        "attachments": null
    },
    {
        "author": "radekkapka",
        "category": "Testing",
        "parent": "",
        "content": "hmmm",
        "created_at": "2024-08-20T12:15:55.816000+00:00",
        "attachments": null
    },
    {
        "author": "radekkapka",
        "category": "Testing",
        "parent": "",
        "content": "I was expecting this to go away with the `save-full-execution-payload` flag :/",
        "created_at": "2024-08-20T12:17:33.647000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "I have these 3 flags:\n```\n  - --save-full-execution-payloads\n  - --enable-experimental-backfill\n  - --blob-save-fsync\n```",
        "created_at": "2024-08-20T12:18:25.983000+00:00",
        "attachments": null
    },
    {
        "author": "radekkapka",
        "category": "Testing",
        "parent": "",
        "content": "OK looks like we have some unknown bug in that case... The best thing you can do for the time being is resync. I will try to find the cause of this in the meantime",
        "created_at": "2024-08-20T12:20:12.220000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "sure, should i leave one node alone?",
        "created_at": "2024-08-20T12:20:21.904000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "for debugging",
        "created_at": "2024-08-20T12:20:23.578000+00:00",
        "attachments": null
    },
    {
        "author": "radekkapka",
        "category": "Testing",
        "parent": "",
        "content": "nah",
        "created_at": "2024-08-20T12:20:44.266000+00:00",
        "attachments": null
    },
    {
        "author": "radekkapka",
        "category": "Testing",
        "parent": "",
        "content": "I should be able to reproduce this easily locally",
        "created_at": "2024-08-20T12:20:52.896000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "awesome, working on resync then",
        "created_at": "2024-08-20T12:21:03.611000+00:00",
        "attachments": null
    },
    {
        "author": "radekkapka",
        "category": "Testing",
        "parent": "",
        "content": "As for the validator image, there is no need for it",
        "created_at": "2024-08-20T12:21:13.639000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "started up ser \u003c@308223150725005322\u003e",
        "created_at": "2024-08-20T12:29:05.806000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@539495253418180618\u003e can we get some more push on https://github.com/ethereum/consensus-specs/pull/3800 please ?",
        "created_at": "2024-08-20T12:34:50.196000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "we ideally wanna start messing around with non default 6 blob values in the very near future.",
        "created_at": "2024-08-20T12:35:13.798000+00:00",
        "attachments": null
    },
    {
        "author": "nc1234",
        "category": "Testing",
        "parent": "",
        "content": "Weird that it forked off at 151104 and not 150889 since this is a bug related to partial withdrawal and not regular withdrawal",
        "created_at": "2024-08-20T13:07:51.914000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Testing",
        "parent": "",
        "content": "yep, i‚Äôll make a pass on this before thursday‚Äôs call\n\nshould still be able to adjust blob values without it right?",
        "created_at": "2024-08-20T13:18:59.333000+00:00",
        "attachments": null
    },
    {
        "author": "nc1234",
        "category": "Testing",
        "parent": "",
        "content": "Every [test case](https://github.com/ethereum/consensus-specs/blob/dev/tests/core/pyspec/eth2spec/test/electra/block_processing/test_process_withdrawal_request.py) for partial withdrawal uses \n```\nvalidator_index = spec.get_active_validator_indices(state, current_epoch)[0]\n```\nie. the first active validator index. With `@spec_state_test`, validator index will always be 0, which coincides with the default value of `state.next_withdrawal_index`  which is 0 üòÖ . If a test case calls `spec.get_active_validator_indices(state, current_epoch)[-1]` or `spec.get_active_validator_indices(state, current_epoch)[1]` or some other random validator index, Lodestar would have failed the spec test",
        "created_at": "2024-08-20T13:30:49.277000+00:00",
        "attachments": null
    },
    {
        "author": "nc1234",
        "category": "Testing",
        "parent": "",
        "content": "I can add a test case with randomized validator index",
        "created_at": "2024-08-20T13:34:42.199000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@758579010027782144\u003e eth_call to the 2935 contract is broken on devnet-2 as well as local runs of nethermind üòÑ\nthe call works fine on geth for e.g",
        "created_at": "2024-08-20T13:47:03.920000+00:00",
        "attachments": null
    }
]