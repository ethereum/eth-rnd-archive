[
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "Hey folks, I got an error on a lighthouse testnet while it attempted to produce the transition payload, it seems like the forkchoiceUpdated attributes is requesting a payload with the same timestamp as the terminal block and therefore the execution client is returning error:\n```\nJun 17 19:02:42.017 CRIT Error whilst producing block            message: Recoverable(\"All endpoints failed http://172.17.0.4:4000/ =\u003e RequestFailed(Recoverable(\\\"Error from beacon node when producing block: ServerMessage(ErrorMessage { code: 500, message: \\\\\\\"UNHANDLED_ERROR: GetPayloadFailed(EngineErrors([Api { id: \\\\\\\\\\\\\\\"http://172.17.0.2:8552/\\\\\\\\\\\\\\\", error: ServerMessage { code: -38003, message: \\\\\\\\\\\\\\\"Invalid payload attributes\\\\\\\\\\\\\\\" } }, Api { id: \\\\\\\\\\\\\\\"http://172.17.0.2:8552/\\\\\\\\\\\\\\\", error: ServerMessage { code: -38003, message: \\\\\\\\\\\\\\\"Invalid payload attributes\\\\\\\\\\\\\\\" } }]))\\\\\\\", stacktraces: [] })\\\"))\"), service: block\n```\nAnd on geth:\n```\nWARN [06-17|19:02:42.015] Served engine_forkchoiceUpdatedV1        conn=172.17.0.2:57394 reqid=1 duration=\"226.418¬µs\" err=\"Invalid payload attributes\"           errdata=\"{Error:invalid timestamp, parent 1655492562 given 1655492562}\"\n```",
        "created_at": "2022-06-17T19:12:10.833000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdannyryan\u003e nice edge case! that might be a \u003e vs \u003e= bug and definitely something worth testing (if possible) in a controlled manner like hive",
        "created_at": "2022-06-17T19:18:44.693000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "yes, this actually happening in hive, I need to check why the testcase is not failing but definitely can add a simple check üëç",
        "created_at": "2022-06-17T19:20:53.686000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdannyryan\u003e Well I guess you'd need a pow terminal block that happens on the correct second modulo 12 (same as whatever the beacon chains offset is) *and* ask a particular CL client to build a block",
        "created_at": "2022-06-17T19:22:50.199000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdannyryan\u003e I'd expect this to happen time wise, 1 out of every 12, and then expect lighthouse to be the proposer for the conflicting slot 1/5 times on our multi-client testnets. So it might be that we just didn't run into it yet",
        "created_at": "2022-06-17T19:24:04.255000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdannyryan\u003e And correct behavior is for first PoS block to have a slot time that is greater than ttd so this lighthouse node should make a beacon block with empty payload and next slot the proposer should build on terminal pow block",
        "created_at": "2022-06-17T19:24:51.888000+00:00",
        "attachments": null
    },
    {
        "author": "marioevz",
        "category": "Testing",
        "parent": "",
        "content": "yes, it's happening very often in this hive setup because we are reducing the slot time to 6 seconds and all validators are lighthouse",
        "created_at": "2022-06-17T19:27:17.514000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "We‚Äôve hit this in teku before. When using very low difficulty mining rules you can often get PoW blocks that have a timestamp in the future too so you may have to wait a little while before they are valid to create a transition block off.",
        "created_at": "2022-06-17T20:41:50.061000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cdannyryan\u003e right, so future pow timestamps and then == pow timestamp",
        "created_at": "2022-06-17T20:46:35.124000+00:00",
        "attachments": null
    }
]