[
    {
        "author": "sproul",
        "category": "Testing",
        "parent": "",
        "content": "I got an error from `lighthouse-besu-1` about faulty payload reconstruction:\n\n\u003e InconsistentPayloadReconstructed { slot: Slot(208383), exec_block_hash: 0x206bf8274ace483cbe4a133e1603d8f46ac316604e8ce203d12e35a67969848f, canonical_transactions_root: 0x7ffe241ea60187fdb0187bfa22de35d1f9bed7ab061d9401fd47e34a54fbede1, reconstructed_transactions_root: 0x1499c7a46d8abd96b7cfbf6c7497b07fd1bfea30bfd816290d5e86493fce2188 }\n\nThe issue seems to be that Besu returns a bunch of transactions for block number 184132 on the `engine_getPayloadBodiesByRangeV1` endpoint. Geth (correctly) returns an empty list of transactions. Gist here: \u003chttps://gist.github.com/michaelsproul/49dd3d66fb6a3f15af38b38f273b1324\u003e\n\nThe block: \u003chttps://dencun-devnet-8.beaconcha.in/slot/208383\u003e.\n\ncc \u003c@\u0026836981603216654336\u003e (non urgent, I can open an issue if that's better)",
        "created_at": "2023-09-15T03:16:02.872000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "besu main branch has been deployed which was already meant for devnet 9, new besu image for devnet 8 should be deployed soon.",
        "created_at": "2023-09-15T06:15:36.216000+00:00",
        "attachments": null
    },
    {
        "author": "stefanbratanov",
        "category": "Testing",
        "parent": "",
        "content": "can you please test Teku",
        "created_at": "2023-09-15T08:19:27.603000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "Which branch?",
        "created_at": "2023-09-15T08:36:15.183000+00:00",
        "attachments": null
    },
    {
        "author": "stefanbratanov",
        "category": "Testing",
        "parent": "",
        "content": "`master` . The latest `develop` image is based on it.",
        "created_at": "2023-09-15T08:37:04.352000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "Checked Nimbus/Besu. Incorrect `INVALID`. part 1, nimbus/besu newpayload\n```\nSep 14 09:15:24 2023 REQUEST\n{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"engine_newPayloadV3\",\n  \"params\": [\n    {\n      \"parentHash\": \"0x74e0565c9984a41a72122118e727ecbba42af2740a94cbb838caf34725f720d1\",\n      \"feeRecipient\": \"0xf97e180c050e5ab072211ad2c213eb5aee4df134\",\n      \"stateRoot\": \"0x6e9affded01bd528d87e2d368fab2d36fe8c8dc7769bc2c01a10d04afeb1766a\",\n      \"receiptsRoot\": \"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421\",\n      \"logsBloom\": \"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\",\n      \"prevRandao\": \"0xab77d9b4db023424214692be26b642289ab8ca265c1e658f22766a49c98e4cc8\",\n      \"blockNumber\": \"0x2CF40\",\n      \"gasLimit\": \"0x1C9C380\",\n      \"gasUsed\": \"0x0\",\n      \"timestamp\": \"0x6502CF2C\",\n      \"extraData\": \"0xd883010d00846765746888676f312e32312e30856c696e7578\",\n      \"baseFeePerGas\": \"0x7\",\n      \"blockHash\": \"0x50f2348a94e7ba9615cdba46f92353fc7f94d8393a20418e7e42b6d763fbb163\",\n      \"transactions\": [],\n      \"withdrawals\": [],\n      \"blobGasUsed\": \"0x0\",\n      \"excessBlobGas\": \"0x0\"\n    },\n    [],\n    \"0x56b8e58e74816d00aa19f8d8076348d4ecf3e05a4bcb3eded202b84252d1e8ab\"\n  ],\n  \"id\": 294681\n}\n\nSep 14 09:15:24 2023 RESPONSE\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 294681,\n  \"result\": {\n    \"status\": \"SYNCING\",\n    \"latestValidHash\": null,\n    \"validationError\": null\n  }\n}\n```",
        "created_at": "2023-09-15T15:26:51.193000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "`SYNCING`, no verdict yet. so fcU time:\n```\nSep 14 09:15:24 2023 REQUEST\n{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"engine_forkchoiceUpdatedV3\",\n  \"params\": [\n    {\n      \"headBlockHash\": \"0x50f2348a94e7ba9615cdba46f92353fc7f94d8393a20418e7e42b6d763fbb163\",\n      \"safeBlockHash\": \"0x075745606087a13c8221ecf25568062c3a4f09008b4215abdbe6f4a40e7b6e73\",\n      \"finalizedBlockHash\": \"0xf7b3dba11fc57eb74a13330ff1855bdd981186a8954a633b229b7ef70220220c\"\n    },\n    null\n  ],\n  \"id\": 294682\n}\n\nSep 14 09:15:24 2023 RESPONSE\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 294682,\n  \"result\": {\n    \"payloadStatus\": {\n      \"status\": \"INVALID\",\n      \"latestValidHash\": \"0xf23f8ecb2232e9fe01a50b820d0fe91d6d191b2aa24b1a97720ac33d74bf0184\",\n      \"validationError\": \"0x50f2348a94e7ba9615cdba46f92353fc7f94d8393a20418e7e42b6d763fbb163 is an invalid block\"\n    },\n    \"payloadId\": null\n  }\n}\n```\n`INVALID` now. so, per usual, Nimbus gets ... confused",
        "created_at": "2023-09-15T15:27:29.755000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "but https://dencun-devnet-8.beaconcha.in/block/184128 for example, or newpayload between nimbus/geth (also fcu says valid, but newpayload is enough here)\n```\nSep 14 09:15:24 2023 REQUEST\n{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"engine_newPayloadV3\",\n  \"params\": [\n    {\n      \"parentHash\": \"0x74e0565c9984a41a72122118e727ecbba42af2740a94cbb838caf34725f720d1\",\n      \"feeRecipient\": \"0xf97e180c050e5ab072211ad2c213eb5aee4df134\",\n      \"stateRoot\": \"0x6e9affded01bd528d87e2d368fab2d36fe8c8dc7769bc2c01a10d04afeb1766a\",\n      \"receiptsRoot\": \"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421\",\n      \"logsBloom\": \"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\",\n      \"prevRandao\": \"0xab77d9b4db023424214692be26b642289ab8ca265c1e658f22766a49c98e4cc8\",\n      \"blockNumber\": \"0x2CF40\",\n      \"gasLimit\": \"0x1C9C380\",\n      \"gasUsed\": \"0x0\",\n      \"timestamp\": \"0x6502CF2C\",\n      \"extraData\": \"0xd883010d00846765746888676f312e32312e30856c696e7578\",\n      \"baseFeePerGas\": \"0x7\",\n      \"blockHash\": \"0x50f2348a94e7ba9615cdba46f92353fc7f94d8393a20418e7e42b6d763fbb163\",\n      \"transactions\": [],\n      \"withdrawals\": [],\n      \"blobGasUsed\": \"0x0\",\n      \"excessBlobGas\": \"0x0\"\n    },\n    [],\n    \"0x56b8e58e74816d00aa19f8d8076348d4ecf3e05a4bcb3eded202b84252d1e8ab\"\n  ],\n  \"id\": 499210\n}\n\nSep 14 09:15:24 2023 RESPONSE\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 499210,\n  \"result\": {\n    \"status\": \"VALID\",\n    \"latestValidHash\": \"0x50f2348a94e7ba9615cdba46f92353fc7f94d8393a20418e7e42b6d763fbb163\",\n    \"validationError\": null\n  }\n}\n```",
        "created_at": "2023-09-15T15:28:28.046000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "and according to the snooper, Besu and Geth saw exactly the same input from Nimbus, just one said `VALID`, the other `INVALID`:\n```\n--- nimbus_geth_block_0x2CF40_valid.txt    2023-09-15 17:24:05.510617089 +0200\n+++ nimbus_besu_block_0x2CF40_invalid.txt    2023-09-15 17:24:43.438746846 +0200\n@@ -27,3 +27,3 @@\n   ],\n-  \"id\": 499210\n+  \"id\": 294681\n }\n@@ -33,6 +33,6 @@\n   \"jsonrpc\": \"2.0\",\n-  \"id\": 499210,\n+  \"id\": 294681,\n   \"result\": {\n-    \"status\": \"VALID\",\n-    \"latestValidHash\": \"0x50f2348a94e7ba9615cdba46f92353fc7f94d8393a20418e7e42b6d763fbb163\",\n+    \"status\": \"SYNCING\",\n+    \"latestValidHash\": null,\n     \"validationError\": null\n@@ -53,3 +53,3 @@\n   ],\n-  \"id\": 499211\n+  \"id\": 294682\n }\n@@ -59,8 +59,8 @@\n   \"jsonrpc\": \"2.0\",\n-  \"id\": 499211,\n+  \"id\": 294682,\n   \"result\": {\n     \"payloadStatus\": {\n-      \"status\": \"VALID\",\n-      \"latestValidHash\": \"0x50f2348a94e7ba9615cdba46f92353fc7f94d8393a20418e7e42b6d763fbb163\",\n-      \"validationError\": null\n+      \"status\": \"INVALID\",\n+      \"latestValidHash\": \"0xf23f8ecb2232e9fe01a50b820d0fe91d6d191b2aa24b1a97720ac33d74bf0184\",\n+      \"validationError\": \"0x50f2348a94e7ba9615cdba46f92353fc7f94d8393a20418e7e42b6d763fbb163 is an invalid block\"\n     },\n```",
        "created_at": "2023-09-15T15:32:42.768000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "for nimbus/ethereumjs, Nimbus itself is synced, but ethereumjs keeps returning `SYNCING`:\n```\nINF 2023-09-15 15:34:00.000+00:00 Slot start                                 topics=\"beacnde\" slot=217470 epoch=6795 sync=synced/opt peers=28 head=64f67d14:217469 finalized=6793:2c55d4f0 delay=734us787ns\nINF 2023-09-15 15:34:00.001+00:00 Execution client not in sync; skipping validator duties for now topics=\"beacval\" slot=217470 headSlot=217469\nDBG 2023-09-15 15:34:00.001+00:00 Waiting for slot end                       topics=\"beacnde\" slot=217470 endCutoff=9s998ms855us260ns\nDBG 2023-09-15 15:34:00.056+00:00 Block received                             topics=\"beacnde\" delay=56ms739us262ns blockRoot=bb171592 wallSlot=217470 signature=88b1db91 blck=\"(slot: 217470, proposer_index: 14, parent_root: \\\"64f67d14\\\", state_root: \\\"62155b2f\\\", eth1data: (deposit_root: 0ea5a15add1ba8861ec298c5c297177867533d449bc5fad224b30b435dc94e79, deposit_count: 101, block_hash: c138ff6f2429c47b2de34753827ae043423228dc36a82ee413124b2c63f3110d), graffiti: \\\"lighthouse/nethermind\\\", proposer_slashings_len: 0, attester_slashings_len: 0, attestations_len: 1, deposits_len: 0, voluntary_exits_len: 0, sync_committee_participants: 431, block_number: 191450, fee_recipient: \\\"0xf97e180c050e5ab072211ad2c213eb5aee4df134\\\", bls_to_execution_changes_len: 0, blob_kzg_commitments_len: 0)\"\n...\nDBG 2023-09-15 15:34:00.064+00:00 newPayload: succeeded                      topics=\"gossip_blocks\" parentHash=db6c68c0 blockHash=b05dfe4b blockNumber=191450 payloadStatus=SYNCING\nDBG 2023-09-15 15:34:00.068+00:00 Block resolved                             topics=\"gossip_blocks\" blockRoot=bb171592 blck=\"(slot: 2174...\n\n```",
        "created_at": "2023-09-15T15:39:32.347000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "as for nimbus/erigon, well, see fake `INVALID` from a couple days ago",
        "created_at": "2023-09-15T15:50:23.590000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "https://dencun-devnet-8.beaconcha.in/block/184127 \nthe Besu in the Nimbus/Besu node doesn't like this one either:\n```\nSep 14 09:15:24.094 2023 REQUEST\n{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"engine_forkchoiceUpdatedV3\",\n  \"params\": [\n    {\n      \"headBlockHash\": \"0x74e0565c9984a41a72122118e727ecbba42af2740a94cbb838caf34725f720d1\",\n      \"safeBlockHash\": \"0x075745606087a13c8221ecf25568062c3a4f09008b4215abdbe6f4a40e7b6e73\",\n      \"finalizedBlockHash\": \"0xf7b3dba11fc57eb74a13330ff1855bdd981186a8954a633b229b7ef70220220c\"\n    },\n    null\n  ],\n  \"id\": 294683\n}\n\nSep 14 09:15:24.094 2023 RESPONSE\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 294683,\n  \"result\": {\n    \"payloadStatus\": {\n      \"status\": \"INVALID\",\n      \"latestValidHash\": \"0xf23f8ecb2232e9fe01a50b820d0fe91d6d191b2aa24b1a97720ac33d74bf0184\",\n      \"validationError\": \"0x74e0565c9984a41a72122118e727ecbba42af2740a94cbb838caf34725f720d1 is an invalid block\"\n    },\n    \"payloadId\": null\n  }\n}\n```",
        "created_at": "2023-09-15T15:56:30.338000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@\u0026836981603216654336\u003e",
        "created_at": "2023-09-15T19:55:41.325000+00:00",
        "attachments": null
    }
]