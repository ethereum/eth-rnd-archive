[
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "TBH, I have realized the whole problem only during this iteration of our circles",
        "created_at": "2022-07-07T06:20:03.020000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "`null` sounds good to me: return meaningful LVH including `0x00..00` if it's fully validated and deemed `VALID`, otherwise, return `null` which means that only the payload in question is `INVALID` but we don't know for sure about its ancestors",
        "created_at": "2022-07-07T06:22:52.463000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Mind applying suggestions to your PR before ACD?",
        "created_at": "2022-07-07T06:28:02.876000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "oh ok, then we need to skip validating the chain 4).",
        "created_at": "2022-07-07T06:46:31.046000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "but this change would allow us to guarantee 4) üëç  when LVH non null",
        "created_at": "2022-07-07T06:50:26.579000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Yes, on the spec level it will, but not sure if every EL is conforming to the spec. And as I wrote about this would be hard to test on Hive to check the conformance",
        "created_at": "2022-07-07T06:52:01.524000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "understood, thanks, so we will skip the 4) validation for now then, hopefully eventually resolved by VALID responses, easy to add back once every one is onboard",
        "created_at": "2022-07-07T06:54:26.940000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "not at all, but do we have any form of consensus on the last one? 'null' for \"I don't have a good LVH but I know this payload is INVALID\"?",
        "created_at": "2022-07-07T10:59:40.241000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "FWIW, I pushed `null`, but I envision it may be an extra step and logic change at the CL layer, we probably will convert anyway at the entry point `null` to an arbitrary constant value so that later on in forkchoice this can be considered as a non-existent LVH. cc \u003c@363800010518822915\u003e",
        "created_at": "2022-07-07T11:06:05.612000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Yes, I believe CL codebases doesn't use `null` in such components like fork choice, and actually `null` is a JSON specific thing. So, I slightly prefer `0xff..ff`",
        "created_at": "2022-07-07T11:16:14.722000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Teku will handle null without needing any changes. I‚Äôd much rather null than a magic value - we‚Äôd want to change our code to handle the magic value explicitly instead of searching back through the protoarray to try and find it then bailing out",
        "created_at": "2022-07-07T11:17:38.279000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "how is `null` different than magic value in this regard? you still need a check `lvh == null` or `lvh == magic_value` to decide before hand if you are going to run the loop finding it",
        "created_at": "2022-07-07T11:19:06.716000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "It‚Äôs not really except that null is explicitly the value that means ‚Äúthere‚Äôs no value here‚Äù and we happen to already handle it. You could also omit the attribute entirely (which would actually be undefined in JSON since null and undefined are different things in JavaScript)",
        "created_at": "2022-07-07T11:20:31.136000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Btw, I forgot that SSZ supports `null` values. Just in case if we ever want to switch to some binary format, I assume that in this case SSZ would be the format we use. Unlikely this change happens though but I don't like us to be in the position where we can't simply do that because the format doesn't support `null` values and we'd have to replace this `null` value with some magic number",
        "created_at": "2022-07-07T11:21:05.025000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "I‚Äôm not overly concerned either way but using a place holder value to mean null seems silly when null already exists for exactly this purpose.",
        "created_at": "2022-07-07T11:21:12.142000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Yeah either is fine by me as well, and from Marius's reply above I am guessing that this requires ZERO changes to geth since it will not implement `null` at all, and other clients will require probably little changes? I'm guessing Erigon will always reply `null` here?",
        "created_at": "2022-07-07T11:23:54.234000+00:00",
        "attachments": null
    },
    {
        "author": "daniellehrner",
        "category": "Testing",
        "parent": "",
        "content": "What would be the implications of a EL client always returning `null` in this case? From a complexity point of view it is of course much less work for EL clients. And couldn't this incentivize EL clients to just return `null` and not bother looking for LVH?",
        "created_at": "2022-07-07T11:26:59.282000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "btw, should it be `0x` instead of `null`? this is actually how null is specified for `DATA` type IIUC cc \u003c@543900561460822016\u003e",
        "created_at": "2022-07-07T11:30:16.077000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "From the CL side there are some differences. The main thing to realize here is that knowing that the payload is INVALID this already allows the node to stop building and cuts off the invalid branch. This is the most important aspect of the reply. However, having a valid LVH will more accurately reflect the status of the forkchoice tree after removing the invalid branch. That is, if there were many invalid blocks inserted, that carried attestations. If your EL returns `null` always, then you will consider those INVALID blocks and their corresponding weight in support of a given branch, presumaby allowing the attacker to continue building on top of that branch, or even diverting from a completely separated honest branch by continuing to split the vote. This however is a very difficult attack vector and with very little chance of success",
        "created_at": "2022-07-07T11:33:19.565000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "The implication of that is CL invalidating a long chain of invalid blocks block-by-block instead of doing at once. Main LVH scenario is checked in Hive, so, ELs should in general conform to the spec to pass these tests. What we seem we can't verify are edge cases, and the most dangerous one would be to mark as `VALID` what was not actually fully validated",
        "created_at": "2022-07-07T11:33:39.558000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Hm, aren't prysm processing `on_attestation` for attestations that are attesting to and carried by optimistic blocks?",
        "created_at": "2022-07-07T11:37:05.805000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "yes so?",
        "created_at": "2022-07-07T11:40:31.597000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Ah, I see what you mean. As long as block is viable it impacts the fork choice because it holds its weight in there. Attacks that can exploit this are really difficult, because first adversary will have to turn fully synced validating nodes into optimistic mode which is a very big deal. But if that happens, i don't think that EL which does respond `null` will significantly amplify the damage in this already pretty bad situation",
        "created_at": "2022-07-07T11:44:50.182000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003clightclient\u003e \u003e \u003clightclient\u003e  this is correct (re @amphora_interop_bot: \u003cMikhail Kalinin [mkalinin]\u003e btw, should it be `0x` instead of `null`? this is actually how null is specified for `DATA` type IIUC cc @lightclient)",
        "created_at": "2022-07-07T12:17:54.481000+00:00",
        "attachments": null
    },
    {
        "author": "dapplion",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@211091239112671234\u003e  from your auth PR https://github.com/ethereum/execution-apis/pull/167/files#diff-adbf367b861e872d9ad80ed4ebcb2f7c3e465949cdc3fa07af74464cb0862509R47 what's the reasoning to pick +-5s and not say 60s?\n\nDoing a merge devnet, nodes got very busy due to network issues such that the EL could not process most of the requests within the 5 seconds window. That exacerbated the issue further nuking the nodes permanently such that they can't communicate anymore.\n\nCC \u003c@792822129019584562\u003e",
        "created_at": "2022-07-07T13:22:53.216000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Testing",
        "parent": "",
        "content": "Interesting. Well, 5s is obviously a pretty random choice. I'm not opposed to changing it to 60s, to avoid such regressions",
        "created_at": "2022-07-07T14:31:41.703000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "Mainnet-shadow-fork-9 configs are out: https://github.com/eth-clients/merge-testnets/tree/main/mainnet-shadow-fork-9\n\nTTD is planned to be reached on Thursday (14th July) at ~2PM UTC.  \n\nI'll be running a round of updates + TTD override on Wednesday (13th), if there's anything please do reach out.\n\nTooling links:\nhttps://ethstats.mainnetshadowfork9.ethdevops.io/\nhttps://explorer.mainnetshadowfork9.ethdevops.io/\nhttps://beaconchain.mainnetshadowfork9.ethdevops.io/\nhttps://forkmon.mainnetshadowfork9.ethdevops.io/",
        "created_at": "2022-07-07T15:31:06.324000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@504202741933932544\u003e hey! Igor from Erigon here. We just released 2022.07.02 and it looks like it broke Teku on our Ropsten validators. Teku started crashing a lot. So far we rolled back to 2022.07.01, but I would love to debug this issue somehow.\n\n \u003c@199561711278227457\u003e suggested to ping you about it.",
        "created_at": "2022-07-07T16:40:20.885000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "unknown.png",
                "content": "3780c1ffd25ed64c42b206e938c00c79ea31bcbc0d4b0aff426143c63aee18a7"
            }
        ]
    },
    {
        "author": "tbenr",
        "category": "Testing",
        "parent": "",
        "content": "Hey can you share full logs some way?",
        "created_at": "2022-07-07T17:27:48.298000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Testing",
        "parent": "",
        "content": "rolling back without changing anything on teku side solved the issue?",
        "created_at": "2022-07-07T17:29:10.933000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Testing",
        "parent": "",
        "content": "Yeap",
        "created_at": "2022-07-07T17:32:07.390000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Testing",
        "parent": "",
        "content": "I have to drop off, if you could share the logs in an issue on our repo so the first available guy (or tomorrow morning for me) will have a look into it.",
        "created_at": "2022-07-07T17:41:57.758000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Testing",
        "parent": "",
        "content": "it looks like we only stored the exceptions, not the full log",
        "created_at": "2022-07-07T17:51:19.862000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Testing",
        "parent": "",
        "content": "https://github.com/ConsenSys/teku/issues/5902",
        "created_at": "2022-07-07T17:59:15.399000+00:00",
        "attachments": null
    }
]