[
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "By the time of writing this blog post safe block algorithm was WIP, after some time of researching into it it appeared to be not that easy in terms of implementation and we decided to use `justified` block as a temporal solution for it",
        "created_at": "2022-09-13T04:34:05.568000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "I don't this we have such a test. Maybe \u003c@415109946682769408\u003e knows for sure?",
        "created_at": "2022-09-13T04:40:49.414000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "But it still can be reorged out and isn't suitable for transaction confirmation purposes",
        "created_at": "2022-09-13T05:07:17.873000+00:00",
        "attachments": null
    },
    {
        "author": "hsiaowei",
        "category": "Testing",
        "parent": "",
        "content": "No spec tests, but hive has a test to verify if `safe` as the justified beacon block: https://github.com/ethereum/hive/blob/1c2fea53c8b5791eaefbcdc3afb34b4c193c0598/simulators/eth2/engine/verification.go#L246\n\nLast time (Sept 1st), \u003c@892053833121923094\u003e  helped check that in teku/lighthouse/nimbus/prysm, safe is the execution payload contained in the current justified beacon block with hive. Lodestar is not in the hive setup though. ðŸ˜“ \n\nWe can easily extend fork choice test format with `safe` field too. OTOH it is also possible that clients will not use the same safe head algorithm in long term, e.g., user may set flags to determine what type of `safe`  head they want to use.",
        "created_at": "2022-09-13T05:21:58.363000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "I believe the original question was about a fork choice test with a block that can reorg itself (contains enough attestations voting for competing head)",
        "created_at": "2022-09-13T05:23:11.572000+00:00",
        "attachments": null
    },
    {
        "author": "hsiaowei",
        "category": "Testing",
        "parent": "",
        "content": "Oh dear I mixed the two discussions above  ðŸ˜± but also FYI that `safe` head is tested. ðŸ˜…",
        "created_at": "2022-09-13T05:25:04.308000+00:00",
        "attachments": null
    },
    {
        "author": "hsiaowei",
        "category": "Testing",
        "parent": "",
        "content": "What do you mean by \"fork itself\"? We have tests of block contains attestations that are voting for another chain (forked from earlier parent block, not itself)",
        "created_at": "2022-09-13T05:30:44.796000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Testing",
        "parent": "",
        "content": "well, it's still a \"step up\" from the `latest_head` in that someone else than the proposer has looked at it and decided it was decent enough",
        "created_at": "2022-09-13T06:55:36.572000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I mean block D in this proposed example \u003chttps://github.com/ethereum/consensus-spec-tests/issues/30#issuecomment-1244759226\u003e",
        "created_at": "2022-09-13T08:00:11.851000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I want it to extend the canonical chain",
        "created_at": "2022-09-13T08:00:26.858000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I don't think this is merely an implementation detail. There isn't a proof that safe head is safe. And there isn't one because it's not",
        "created_at": "2022-09-13T08:01:44.528000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Testing",
        "parent": "",
        "content": "Hi guys",
        "created_at": "2022-09-13T12:37:03.859000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Testing",
        "parent": "",
        "content": "We have multiple users reporting that their geth + CL pairs do not start syncing on goerli when both clients are started together with an empty database.",
        "created_at": "2022-09-13T12:37:54.197000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Testing",
        "parent": "",
        "content": "The issue seems to be that the CL queries EL to validate the deposit contract, but the EL is at genesis and cannot supply it.",
        "created_at": "2022-09-13T12:38:44.353000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Testing",
        "parent": "",
        "content": "The only way out is for CL to start syncing the beacon chain optimistically and deliver FcU for a recent block.",
        "created_at": "2022-09-13T12:39:24.824000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Testing",
        "parent": "",
        "content": "geth uses the FcU as a sync trigger",
        "created_at": "2022-09-13T12:39:36.501000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Testing",
        "parent": "",
        "content": "What's the condition for optimistic sync across CL implementations?",
        "created_at": "2022-09-13T12:39:57.916000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Testing",
        "parent": "",
        "content": "Is it enabled by default?",
        "created_at": "2022-09-13T12:40:22.909000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Testing",
        "parent": "",
        "content": "\u003cn0ble\u003e \u003e \u003cn0ble\u003e  what CL client do they use? this might be related to an issue when CL requires EL to be in sync (by querying eth_syncing), which i thought has been resolved by affected CLs already. they probably should specify a flag to disable eth1 data poll depending on the CL client they use (re @amphora_interop_bot: \u003cfjl\u003e We have multiple users reporting that their geth + CL pairs do not start syncing on goerli when both clients are started together with an empty database.)",
        "created_at": "2022-09-13T15:08:59.087000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "Testing",
        "parent": "",
        "content": "In Lighthouse, on all major testnets, optimistic sync is enabled by default and none of the deposit contract stuff should prevent sync.\n\nThat is only possible since Lighthose \"bakes in\" the beacon chain genesis state to the binaries. Since the beacon chain genesis state is in fact derived from the deposit contract (i.e., validators are the result of deposits), if a consensus client is trying to generate it's own beacon genesis state at startup then I can see how there would be a deadlock between:\n\n1. The CL waiting for deposit contract logs so it can generate a beacon genesis state and then start (optimistically) syncing forward.\n2. The EL waiting for an fCU before it starts syncing anything (even PoW blocks).\n\nMy understanding is that all CL clients \"bake in\" the genesis state for all known testnets, so I don't see this as an immediate problem. But perhaps there are some clients allowing users to generate their own genesis state and that's causing the problem? Alternatively, maybe it's a separate issue all together.",
        "created_at": "2022-09-13T22:57:49.318000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "Testing",
        "parent": "",
        "content": "If it's the case the ELs are not going to sync anything until the CL is able to give an fcU, then it seems like CLs starting without a known genesis state is infeasible post-merge. Which I must admit makes me a little happy because I've always disliked that functionality ðŸ˜…",
        "created_at": "2022-09-13T23:01:13.489000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I don't think prysm bakes in testnet genesis, only mainnet",
        "created_at": "2022-09-13T23:12:13.669000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Fwiw last week in an internal call we were thinking on ditching support to sync from pre genesis altogether. If it was up to me probably I'd ditch pre Bellatrix code I don't see much reason even for a private network to support previous forks",
        "created_at": "2022-09-13T23:16:34.139000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Note that for goerli it's impossible to create the genesis from the deposit contract - there were no deposits for the genesis validators, they just got put into the genesis state.",
        "created_at": "2022-09-13T23:45:58.717000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "This catches a lot of people out with prysm particularly because it doesn't include the genesis state and so it just doesn't work unless you manually specify it.",
        "created_at": "2022-09-13T23:46:24.717000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "And yes I'm also quite keen to ditch support for calculating the genesis state from Teku - it complicates the code dramatically (and requires a lot more requests to the execution layer than would otherwise be necessary).",
        "created_at": "2022-09-13T23:47:01.043000+00:00",
        "attachments": null
    }
]