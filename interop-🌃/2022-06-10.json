[
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "Yes we are fed these blocks, but they are fed before we can sync their ancestors. So we would have to cache them. Do you cache all the newPayloads you get, so that you can execute them on fcu?",
        "created_at": "2022-06-10T05:40:19.761000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Testing",
        "parent": "",
        "content": "yes if they are post-finalized, when they get finalized we can prune them. We add them to BlockTree with some metadata about their state",
        "created_at": "2022-06-10T07:49:25.637000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "I think this behaviour is client specific and we should make this test work with all clients. I am seeing this test pretty valuable and don't want us to give up on implementing it cc \u003c@892053833121923094\u003e",
        "created_at": "2022-06-10T07:50:46.111000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Testing",
        "parent": "",
        "content": "not sure, maybe we can discuss on Mondays protocol testing call",
        "created_at": "2022-06-10T07:51:59.238000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Testing",
        "parent": "",
        "content": "I will have some conclusions by then",
        "created_at": "2022-06-10T07:52:16.592000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Sure, let's take the discussion there. I can understand why do we need to pull invalid payload from another node and also do understand the complexity of a node deliberately serving an invalid block to a remote peer. Have anything like that been implemented before in Hive?",
        "created_at": "2022-06-10T07:54:29.992000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Testing",
        "parent": "",
        "content": "no",
        "created_at": "2022-06-10T07:55:46.338000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Testing",
        "parent": "",
        "content": "but we only can have a peers that rejected that block and still got it from CL, so we won't get it from the network",
        "created_at": "2022-06-10T07:56:08.033000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "I would like us to come to consensus on this. Any opposition for `latest` to follow \"the head of the chain designated by fcU\" semantics from Erigon and Besu?\n\ncc \u003c@583892532644151312\u003e \u003c@827653956955406406\u003e",
        "created_at": "2022-06-10T07:56:17.407000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "But we need this to happen while `SYNCING` to check how does client serve LVH. If we did this in a lock-step we'd deviate from the original idea of this test",
        "created_at": "2022-06-10T07:57:33.842000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Testing",
        "parent": "",
        "content": "ok but does that invalidate this scenario?",
        "created_at": "2022-06-10T08:07:31.438000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Testing",
        "parent": "",
        "content": "why not both?",
        "created_at": "2022-06-10T08:07:39.254000+00:00",
        "attachments": null
    },
    {
        "author": "yperbasis",
        "category": "Testing",
        "parent": "",
        "content": "Right now Erigon's `latest` actually follows fcU head, but we're still discussing how to make it work w/o performance penalties.",
        "created_at": "2022-06-10T08:42:12.772000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "I believe we have a separate scenario checking `INVALID` payload in a the lock-step mode",
        "created_at": "2022-06-10T09:00:18.045000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "I see. A straightforward solution would be to keep two versions of state, one for `fcU` block and another one for the tip of canonical chain, if it's doable in the RPC daemon.",
        "created_at": "2022-06-10T09:03:06.716000+00:00",
        "attachments": null
    },
    {
        "author": "yperbasis",
        "category": "Testing",
        "parent": "",
        "content": "Yes, but so far in Erigon we by and large have a single state.",
        "created_at": "2022-06-10T09:06:04.506000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "I have re-read Alexey's message about an RPC cache, it caches a *subset* of the current state. Now I see that adding one another state version to it could be complicated",
        "created_at": "2022-06-10T09:13:33.381000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Testing",
        "parent": "",
        "content": "can't you have some in-memory diff that you would hit first and pass-through to main state if its a miss? Thats how we handle some state operations it in Nethermind.",
        "created_at": "2022-06-10T10:14:33.720000+00:00",
        "attachments": null
    },
    {
        "author": "yperbasis",
        "category": "Testing",
        "parent": "",
        "content": "Yes, it's possible, but it adds to code complexity.",
        "created_at": "2022-06-10T10:18:11.253000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Testing",
        "parent": "",
        "content": "this should not be a problem, I have opened an issue here: https://github.com/hyperledger/besu/issues/3957",
        "created_at": "2022-06-10T13:21:05.664000+00:00",
        "attachments": null
    }
]