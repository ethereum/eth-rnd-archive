[
    {
        "author": "yperbasis",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@\u0026836981489430036500\u003e Does teku give EL time to build blocks? We've seen that it immediately (like after 2ms) sends an `engine_getPayloadV1`  after the corresponding `engine_forkchoiceUpdatedV1`, resulting in empty blocks.",
        "created_at": "2022-10-11T10:26:09.805000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Testing",
        "parent": "",
        "content": "In the latest release we fixed an edge case in which we where calling them in sequence (only potentially happening running BN and VC on different machines). There are still physiological cases where it cannot be avoided.",
        "created_at": "2022-10-11T10:33:42.868000+00:00",
        "attachments": null
    },
    {
        "author": "yperbasis",
        "category": "Testing",
        "parent": "",
        "content": "OK, thank you. We'll advise our users to use the latest teku release.",
        "created_at": "2022-10-11T10:34:28.251000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Testing",
        "parent": "",
        "content": "btw, when it was happening EL should have handled the situation by avoid restarting building the block from scratch. For instance Besu recently improved that situation and they where not producing 0 tx blocks anymore when we were behaving that way.",
        "created_at": "2022-10-11T10:40:43.500000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Testing",
        "parent": "",
        "content": "What do you mean by this?  If there is a millisecond or two between requests you cannot build a block in that time.",
        "created_at": "2022-10-11T16:19:00.208000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Testing",
        "parent": "",
        "content": "I mean that we were already sending a previous FcU with attribute as expected, but right at block production time we were sending an FcU with empty attrs, than another FcU with attributes again and then getPayload. So if EL caches the initially built block is able to respond with non-0 txs",
        "created_at": "2022-10-11T17:02:46.833000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Testing",
        "parent": "",
        "content": "Is there a non-buggy situation where caching blocks like this would be valuable?",
        "created_at": "2022-10-11T17:28:15.124000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Testing",
        "parent": "",
        "content": "I don't have a specific case in mind ATM but I'm thinking about a reorg that is reverted back before getPayload",
        "created_at": "2022-10-11T17:50:45.981000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Testing",
        "parent": "",
        "content": "Is this something that can reasonably happen?  What conditions would cause a CL to reorg out a block like this?  I guess a late block in the previous slot maybe?",
        "created_at": "2022-10-11T18:13:05.295000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Testing",
        "parent": "",
        "content": "I am just a bit concerned about adding complexity to the EL to deal with a situation that should never occur.",
        "created_at": "2022-10-11T18:13:40.145000+00:00",
        "attachments": null
    }
]