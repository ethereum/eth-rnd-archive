[
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "For the life of me I can't reproduce this.  Teku is consistently rejecting those aggregates.  It's invalid because of the aggregator signature as well, so that doesn't even depend on picking the right state or which fork etc - you get the public key based on the aggregator index in the message (no conversion of aggregation_bits which can easily go wrong). I'll keep on digging but it's a weird one...",
        "created_at": "2022-08-18T01:38:59.110000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "interesting, some wierd caching potentially ?",
        "created_at": "2022-08-18T01:41:24.480000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "If it was the actual attestation I could see that but the only thing we're getting from cache is the public key. I'm struggling to see how that gets the wrong key *and* winds up being valid.  Might spend some time trying to find what setup the signature is valid for as that may give some hints.",
        "created_at": "2022-08-18T01:43:14.937000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Well, its not valid with any prater public key or any fork. We only log invalid gossip on one of our nodes and I can't find it rejecting these messages but it does reject quite a few other aggregates for having invalid signatures.",
        "created_at": "2022-08-18T02:43:27.797000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "Does teku employ any batch sig verification methods for gossip ?",
        "created_at": "2022-08-18T02:51:25.644000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Yeah it does, so possibly that's gone wrong.",
        "created_at": "2022-08-18T02:54:10.203000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "Could be a case where the aggregators signature is ignored in certain cases",
        "created_at": "2022-08-18T03:04:51.238000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "hm, it's all pretty simple additions to lists so hard to imagine.  But we seem to be well into the \"that can't possibly happen\" territory already... üòÑ",
        "created_at": "2022-08-18T03:09:20.144000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "I looked through my logs and didnt find anything else from teku. If it helps with your debugging, the invalid aggregates came in at almost the same time from different peers. Potentially a trigger could be a  re-org or an epoch transition ?",
        "created_at": "2022-08-18T03:38:33.357000+00:00",
        "attachments": null
    },
    {
        "author": "sproul",
        "category": "Testing",
        "parent": "",
        "content": "There were two transitory re-orgs on Goerli at around 2022-08-18 20:11 UTC and 21:34 UTC. The cause of these re-orgs is a quirk of the fork choice on networks with participation close to 2/3. \n\nClient teams were already aware of this and are preparing test vector to account for this case. This does not affect higher-participation networks (e.g. mainnet).\n\nWe will provide a full post-mortem once we have all the information and it makes sense to do so. Thanks!",
        "created_at": "2022-08-18T03:47:51.590000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Do you happen to have a timestamp for when they actually arrived?",
        "created_at": "2022-08-18T03:51:45.104000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "I am regretting this now, but I removed all the saved logs a few hours back, so I don't have them anymore.",
        "created_at": "2022-08-18T04:16:46.046000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "always the way.  Thanks anyway.  If you catch any more examples please let me know.",
        "created_at": "2022-08-18T04:19:31.105000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "I'll see what I can rig up to increase our monitoring for this kind of thing...",
        "created_at": "2022-08-18T04:19:48.801000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "Sure thing, I will paste here whatever I find üëç",
        "created_at": "2022-08-18T04:20:42.187000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Testing",
        "parent": "",
        "content": "invalid block on MSF11:\n`18 Aug 2022 15:42:00.068\n Suggested block TD: 56652957608838816710535, Suggested block IsPostMerge True, Block TD: 56652957608838816710535, Block IsPostMerge True\n18 Aug 2022 15:42:00.068\n Processed block is not valid 15365337 (0xd0fff0a6561cfec32d0f15a5fafd4cd75b889c948c1df2b77bd327403afd5f35)\n18 Aug 2022 15:42:00.068\n state root 0xeab26b696ba9c6902820aa3b9c27b22c2427edc60ea08735ba27c5fc3480df5e != stated state root 0xf1251c57b05099f1a6fa60e82a7bd3b6184ef3dda48aeadae211d88c3f69a8c0\n18 Aug 2022 15:42:00.068\n hash 0xec3ed57f897654ff7a8778fecc58a86625d36eca5fa06500d0b1294619d722d5 != stated hash 0xd0fff0a6561cfec32d0f15a5fafd4cd75b889c948c1df2b77bd327403afd5f35\n18 Aug 2022 15:42:00.068\n Processed block 15365337 (0xec3ed5...d722d5) is not valid\n18 Aug 2022 15:42:00.065\n Suggested block TD: 56652957608838816710535, Suggested block IsPostMerge True, Block TD: 56652957608838816710535, Block IsPostMerge True\n18 Aug 2022 15:42:00.065\n Processed block is not valid 15365337 (0xd0fff0a6561cfec32d0f15a5fafd4cd75b889c948c1df2b77bd327403afd5f35)\n18 Aug 2022 15:42:00.065\n state root 0xeab26b696ba9c6902820aa3b9c27b22c2427edc60ea08735ba27c5fc3480df5e != stated state root 0xf1251c57b05099f1a6fa60e82a7bd3b6184ef3dda48aeadae211d88c3f69a8c0\n18 Aug 2022 15:42:00.065\n hash 0xec3ed57f897654ff7a8778fecc58a86625d36eca5fa06500d0b1294619d722d5 != stated hash 0xd0fff0a6561cfec32d0f15a5fafd4cd75b889c948c1df2b77bd327403afd5f35\n18 Aug 2022 15:42:00.065\n Processed block 15365337 (0xec3ed5...d722d5) is not valid`",
        "created_at": "2022-08-18T14:13:23.433000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Testing",
        "parent": "",
        "content": "who is the block producer? nimbus has a known issue they are patching that might have caused it",
        "created_at": "2022-08-18T14:16:00.547000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@360491619402776577\u003e did you remove wait in getpayload when there isn't enough time to produce it?",
        "created_at": "2022-08-18T14:21:54.769000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "No I didn't",
        "created_at": "2022-08-18T14:22:14.086000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "Erigon is the producer for these blocks",
        "created_at": "2022-08-18T14:22:23.744000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Testing",
        "parent": "",
        "content": "Are you planing to (this is not related to Erigon)? This was agreed on as a spec.",
        "created_at": "2022-08-18T14:22:54.205000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Testing",
        "parent": "",
        "content": "We at Nethermind were strongly asked to comply to spec",
        "created_at": "2022-08-18T14:23:06.001000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "its validator index 32821, i.e: `mainnet-shadow-fork-11-teku-erigon-1`",
        "created_at": "2022-08-18T14:23:14.904000+00:00",
        "attachments": null
    },
    {
        "author": "yperbasis",
        "category": "Testing",
        "parent": "",
        "content": "Do you have the invalid block serialized?",
        "created_at": "2022-08-18T14:46:35.750000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Does any EL client (except for geth) has a timeout on `getPayload` if the built payload appeared to be empty by the time of the call?",
        "created_at": "2022-08-18T14:47:48.516000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Testing",
        "parent": "",
        "content": "is this what you'd need?",
        "created_at": "2022-08-18T14:58:30.187000+00:00",
        "attachments": [
            {
                "type": "application/json; charset=utf-8",
                "origin_name": "invalid_block__0xea75a7.json",
                "content": "60020be8a587a071c0e458a39644f1389495e3c3c436f4d3b56bbe422467d394"
            }
        ]
    },
    {
        "author": "yperbasis",
        "category": "Testing",
        "parent": "",
        "content": "The format is fine, but it's a different block from the one Marek reported.",
        "created_at": "2022-08-18T15:04:08.341000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Testing",
        "parent": "",
        "content": "found it on Nethermind logs too:\n\n18 Aug 2022 16:27:36.466\n Processed block is not valid 15365543 (0x125ca6ece30d348af6b62bd01fb67cee4233abe19bccecb08fe31c09a70985a6)\n18 Aug 2022 16:27:36.466\n hash 0xc87a5259c54c5ad9f7ad22b772561192ab92828bec88ce6a47c0f6dbffa5d9c1 != stated hash 0x125ca6ece30d348af6b62bd01fb67cee4233abe19bccecb08fe31c09a70985a6",
        "created_at": "2022-08-18T15:06:23.678000+00:00",
        "attachments": null
    },
    {
        "author": "yperbasis",
        "category": "Testing",
        "parent": "",
        "content": "Is it also a state root mismatch?",
        "created_at": "2022-08-18T15:06:57.857000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Testing",
        "parent": "",
        "content": "let me check",
        "created_at": "2022-08-18T15:07:07.336000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Testing",
        "parent": "",
        "content": "",
        "created_at": "2022-08-18T15:08:45.519000+00:00",
        "attachments": [
            {
                "type": "text/plain; charset=utf-8",
                "origin_name": "message.txt",
                "content": "5cabea9533dd59368179c04a2beb78c6371e0b6a9c8a118fbc9ec91a4ed3fb8d"
            }
        ]
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "A deeper thought into having a `500ms` timeout on `getPayload` when `fcU` is too late and no payload has been built, i.e. it is supposed EL returns empty payload.\n\nIf network is healthy this timeout should not have any tangible effect. If network is unhealthy a well behaving CL can send late `fcU` (due to a parent block being late) and the timeout may delay the block dissemination by `500ms` in the worst case which seems to be marginal.\n\nSo, the adverse effect of having such a timeout seems negligible to me (unless I am missing anything important). ELs better not have this timeout at all and follow the spec but if this is what EL client devs think may increase the UX then I am fine with it considering a small size of potential adverse effects.",
        "created_at": "2022-08-18T17:50:50.486000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "A related question. Do we still have CLs that are sending `fcUs` to initiate the build process too late?",
        "created_at": "2022-08-18T18:00:40.563000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "In addition to the above, it is important that if no payload has been built after `500ms` elapsed, an EL must respond with empty payload",
        "created_at": "2022-08-18T18:09:11.588000+00:00",
        "attachments": null
    }
]