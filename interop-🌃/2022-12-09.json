[
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "Would `BLSToExecutionChange` API be enabled after capella only?",
        "created_at": "2022-12-09T09:36:14.517000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "It would exist but every change you submit would be invalid. At least as implemented in teku. Theoretically you could hold it until Capella activates and then send it out but it doesnâ€™t seem worth it.",
        "created_at": "2022-12-09T10:08:50.417000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "There is one application where  I think may make a tiniest difference: to allow a local list of pre-signed changes to be added to the pool pre-capella. So that the node can start broadcasting them immediately on the fork. This is a request of people that got their keys hacked and large pools may want to implement this for people that went through KYC",
        "created_at": "2022-12-09T10:56:57.800000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Yeah I was thinking that but thereâ€™s a high chance they wonâ€™t propagate well because peers may not yet have updated their head to Capella and then the gossip is considered invalid.",
        "created_at": "2022-12-09T10:58:33.672000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "I don't think that's too much of an issue, we can easily write something that can pump out the requests at the time of the fork (and again a few seconds later, for any laggards).  Prioritization of conflicting operations will be more of a problem, where multiple entities have access to the same mnemonic.",
        "created_at": "2022-12-09T11:04:05.806000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Rebroadcasting likely wonâ€™t help. Nodes that found it invalid the first time will treat all duplicates as invalid too. And those that saw it as valid will now ignore it as a duplicate.",
        "created_at": "2022-12-09T11:07:48.341000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I think I'll keep the same implementation we have now: we check with head-state. Except for those that are given in the local node and I think it's safe to assume that the signature is valid and jjust put them on the pool. Anyway the node will verify when packing",
        "created_at": "2022-12-09T11:08:05.938000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I think this is borderline a bug: we added a salvage to this of returning early and ignore the message instead of rejecting them as invalid",
        "created_at": "2022-12-09T11:08:48.432000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "We talked about this with you didn't we?",
        "created_at": "2022-12-09T11:08:58.053000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "So rebroadcasting should work",
        "created_at": "2022-12-09T11:09:19.671000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Iâ€™m not entirely sure to be honest. Our Paul has been doing this work so itâ€™s not all in my head perfectly.",
        "created_at": "2022-12-09T11:09:42.200000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I don't read the P2P specs to be honest, but if this is not there it should: \"if the headstate is prior to the Capella fork, Ignore and do not reject/mark as invalid\"",
        "created_at": "2022-12-09T11:10:16.808000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Thatâ€™s not in the spec.",
        "created_at": "2022-12-09T11:10:32.440000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Spec doesnâ€™t say what fork to use to validate at all",
        "created_at": "2022-12-09T11:10:45.610000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "there's only so much space in my brain to read the spec, the files beacon-chain.md and forkchoice.md are already too big",
        "created_at": "2022-12-09T11:10:50.374000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "but for the record, prysm does implement that above and I think all clients should. cc \u003c@425572898787426305\u003e",
        "created_at": "2022-12-09T11:11:15.592000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Thereâ€™s a spam vector if you ignore and allow duplicates though. Itâ€™s not for a long period but it does exist",
        "created_at": "2022-12-09T11:11:36.646000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Iâ€™m more inclined to just validate with either head state or Capella if head is still bellatrix.",
        "created_at": "2022-12-09T11:11:59.691000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "yeah but it's only for as long as you subscribe in the topic and then the fork hit, which shouldn't be a large set",
        "created_at": "2022-12-09T11:12:10.941000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "yeah this is a valid option",
        "created_at": "2022-12-09T11:12:42.194000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "Itâ€™s a couple of epochs per spec (but that timing isnâ€™t consistently followed by all clients).",
        "created_at": "2022-12-09T11:12:58.389000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I think we register one epoch before the fork",
        "created_at": "2022-12-09T11:13:12.909000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Testing",
        "parent": "",
        "content": "There really is no respect for the p2p spec. ðŸ™ˆ",
        "created_at": "2022-12-09T11:13:16.653000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "I've already learned that developers don't read specs. ðŸ˜€  Anything else that you think I can be useful regarding your conversation?",
        "created_at": "2022-12-09T11:15:17.809000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "this \u003c@425572898787426305\u003e",
        "created_at": "2022-12-09T11:15:48.308000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "so both phrases in that sentence may be useful ðŸ™‚",
        "created_at": "2022-12-09T11:16:20.510000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "The complication I can see with IGNORE is necessity for a node to verify signature of this message with `ForkDigest` computed for after Capella. Otherwise, it can be DoS'ed with tons of messages with invalid sigs. Is this what we want?",
        "created_at": "2022-12-09T12:14:41.160000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Something like: \n```\n- For messages arrived before node's wall clock reached CAPELLA_FORK_EPOCH:\n  - [IGNORE] Signature is valid with respect to the Capella Version value\n```",
        "created_at": "2022-12-09T12:23:11.916000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "first post merge including prysm testnet coming online in 1 minute https://github.com/ethpandaops/withdrawals-testnet/blob/master/withdrawal-devnet-0/inventory/inventory.ini",
        "created_at": "2022-12-09T12:23:53.049000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "Mainly testing basic functionality after capella",
        "created_at": "2022-12-09T12:24:07.903000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "LH-Geth carries 93% validators (ensuring finality)",
        "created_at": "2022-12-09T12:24:41.235000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "Will do a more balanced test shortly after we ensure everything is working.",
        "created_at": "2022-12-09T12:24:51.124000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "LH bootnode seems to be banning a bunch of peer connections",
        "created_at": "2022-12-09T12:27:11.705000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "So an option is what Adrian said: verify the signature against Capella if the head is still Bellatrix (cc \u003c@476250636548308992\u003e we'll have to change this)",
        "created_at": "2022-12-09T12:28:32.307000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "It would be wrong statement though. As Ignoring would happen only when signature would be *invalid* with respect to the Capella Version. With the current notation it seems we can't make this statement correct. Because we only have `[IGNORE UNLESS]`  predicate\n\nThe only way I see is:\n```\n- For messages with signature valid with respect to the Capella Version value:\n  - [IGNORE] Head block's epoch \u003e= CAPELLA_FORK_EPOCH\n```",
        "created_at": "2022-12-09T12:30:26.202000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I have no clue what's the status of the capella branch you're using. It's been in quite some flux lately so I'm glad you're using a majority client. I think we haven't changed the BLS changes endpoints so at least that should work",
        "created_at": "2022-12-09T12:30:51.238000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "Nishant combined something for me, not sure how bulletproof it is",
        "created_at": "2022-12-09T12:31:21.856000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "If we go with validating against Capella then there's no need to ignore",
        "created_at": "2022-12-09T12:31:40.571000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Then I don't see what the problem is",
        "created_at": "2022-12-09T12:31:59.901000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "The point is that we may get a bunch of valid messages that our node deems invalid because it's slightly late. In this case we are just ignoring them instead of making them invalid. We could just validate as if the head state is capella",
        "created_at": "2022-12-09T12:32:58.169000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "If signed with bellatrix they will be rejected and then user will have to resign them with capella. Signed with bellatrix fork these messages won't make their pass on chain, will they?",
        "created_at": "2022-12-09T12:32:59.444000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Yeah that's correct, if the messages are signed with Bellatrix they should be reneged",
        "created_at": "2022-12-09T12:33:29.489000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Rejected",
        "created_at": "2022-12-09T12:33:34.156000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "hmm, why validate this if our head state hasn't caught up to it. Don't see any big issue with dropping it here",
        "created_at": "2022-12-09T12:33:51.292000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "They say that this makes us subject to Dos",
        "created_at": "2022-12-09T12:34:18.435000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "I see. But not validating signature before Capella is a DoS vector, we have to validate it against *some* fork version",
        "created_at": "2022-12-09T12:34:27.921000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Which I think it's minimal but you're the expert",
        "created_at": "2022-12-09T12:34:35.879000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I think it's fine to check by timestamp and if we get dossed for 500ms so be it",
        "created_at": "2022-12-09T12:36:10.716000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Though, this DoS vector might now be the new one. We can imagine one pre-generates ValidatorExit messages with valid sigs and sends a gazillion of those to the network",
        "created_at": "2022-12-09T12:36:18.868000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "But I also think it's fine to validate the signature as if it were Capella",
        "created_at": "2022-12-09T12:36:29.487000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "I like Adrian's suggestion to take fork version from gossipsub topic. What's wrong with it?",
        "created_at": "2022-12-09T12:37:38.994000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "Validating messages before the node has caught up can lead to wierd issues, especially around fork  boundaries. Its the main reason nodes ignore traffic coming in from future fork topics. I don't think this is a big DOS issue, at worse the offending peer basically saturates their queue and all other messages coming from it are dropped",
        "created_at": "2022-12-09T12:41:31.012000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Testing",
        "parent": "",
        "content": "I liked this too, would be nice to have it for other gossip topics",
        "created_at": "2022-12-09T12:42:08.592000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "The only problem I can see is that it might be substantial change to implementations and the spec",
        "created_at": "2022-12-09T12:49:10.363000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@755590043632140352\u003e are you around to assist with some prysm debugging?",
        "created_at": "2022-12-09T14:32:31.596000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Sorry, I don't think I'll be useful today: I'm walking home to watch two back-to-back quarter final games. An Argentinian living in Brazil, you can expect me to be wasted very soon. I'll dm you while I'm sober",
        "created_at": "2022-12-09T14:35:18.608000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "ðŸ˜‚",
        "created_at": "2022-12-09T14:35:49.626000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "Good luck, and don't die this weekend pls",
        "created_at": "2022-12-09T14:35:57.330000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "lol! I am with my friends at my home office, we're about to do the same stuff",
        "created_at": "2022-12-09T14:36:34.800000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "My DM time in a being sober condition is already over for today",
        "created_at": "2022-12-09T14:39:57.192000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@792822129019584562\u003e we have seem to find a bug in lodestar, where the pool content of the BLS changes are not distributed to lodestar nodes. Made a bls change request of 2100 validators (all of them at the same time) and the validator that runs most keys (2000) (lodestar/geth) doesn't submit the bls changes. When its someone else's turn to propose a block, the pool content is being used.",
        "created_at": "2022-12-09T16:53:37.205000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "Explorer http://167.71.60.16:3334/address/0x388Ea662EF2c223eC0B047D41Bf3c0f362142ad5",
        "created_at": "2022-12-09T16:53:58.962000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "Newest inventory: https://github.com/ethpandaops/withdrawals-testnet/blob/master/withdrawal-devnet-0/inventory/inventory.ini",
        "created_at": "2022-12-09T16:54:27.867000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "Key assignment: https://github.com/ethpandaops/withdrawals-testnet/blob/master/withdrawal-devnet-0/generate_keys.sh",
        "created_at": "2022-12-09T16:54:43.743000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "image: `g11tech/lodestar:withdrawals-bls`",
        "created_at": "2022-12-09T16:55:11.517000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "We are currently at 500 blocks and 500 slots, so not a single block proposal missed.",
        "created_at": "2022-12-09T16:55:35.606000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "made the request to non lodestar\u003c\u003egeth node?",
        "created_at": "2022-12-09T16:55:55.845000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "yes.",
        "created_at": "2022-12-09T16:56:01.278000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "was curled on `withdrawal-devnet-0-teku-geth-1`",
        "created_at": "2022-12-09T16:56:11.241000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "other nodes are able to pick them up?",
        "created_at": "2022-12-09T16:56:29.456000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "yes",
        "created_at": "2022-12-09T16:56:33.013000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "will check, though i think we also have gossip topic subscribed for this",
        "created_at": "2022-12-09T16:57:08.499000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "its still an ongoing issue",
        "created_at": "2022-12-09T16:57:23.023000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "so feel free to troubleshoot if can",
        "created_at": "2022-12-09T16:57:32.420000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "k",
        "created_at": "2022-12-09T16:57:37.390000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "if can't anymore tonight, its most likely the pool will be emptied by monday, then we can restart this chain with similar conditions to trigger the same error.",
        "created_at": "2022-12-09T16:57:57.665000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "So looks like the post merge chain is up and running quite nicely, and things seem to be working. So I will be shutting of the pre-merge chain altogether, and lets just continue our findings on the post merge chain.",
        "created_at": "2022-12-09T17:26:39.539000+00:00",
        "attachments": null
    },
    {
        "author": "barnabasbusa",
        "category": "Testing",
        "parent": "",
        "content": "Cleaned up the repo, and removed the old chain stuff. Also merged everything back to master. All withdrawal-devnet-0 related config can be found here: https://github.com/ethpandaops/withdrawals-testnet",
        "created_at": "2022-12-09T18:48:05.026000+00:00",
        "attachments": null
    }
]