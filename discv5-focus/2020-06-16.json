[
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It's slightly non trivial. You have to extract the public key from the multiaddr and then try and establish a discv5 handshake with that public key, once a session is established, you then need to request the Enr of peer to use it in your local routing table",
        "created_at": "2020-06-16T00:33:40.704000+00:00",
        "attachments": []
    },
    {
        "author": "nishant0",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "in theory it should work, but I haven't tested it out yet. Will take a look today or by this week end at the most. Like Age mentioned there are a few edge cases to this to get it to work",
        "created_at": "2020-06-16T00:44:42.600000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the `/v1/network/identity` rest endpoint in teku constructs a multiaddr type format for discovery based on a discussion between \u003c@!476250636548308992\u003e  and \u003c@!340345049063882753\u003e in the apis channel but it wont be actually used anywhere currently",
        "created_at": "2020-06-16T03:06:03.268000+00:00",
        "attachments": []
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Oh yeah. I've assumed we'd use the multiaddr format with the addition of the UDP protocol. I.e /ip4/127.0.0.1/tcp/9000/udp/9000/p2p/...",
        "created_at": "2020-06-16T03:08:40.751000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "i could easily get a sample of what i generated if thats helpful",
        "created_at": "2020-06-16T03:09:25.656000+00:00",
        "attachments": []
    },
    {
        "author": "ajsutton",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think the bigger issue for Teku is adding the support for going the other way - from MultiAddr to ENR and making our discovery layer happy with that.  It's doable but will take some time.",
        "created_at": "2020-06-16T03:10:28.003000+00:00",
        "attachments": []
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah. I had to re-write our discv5 to support it. I was motived to do so because I could improve efficieny in the implementation and were having issues with its performance to begin with. So i added this multiaddr support whilst I was there",
        "created_at": "2020-06-16T03:11:31.206000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "we've got a `/tcp/9000/p2p/` in the p2p_addresses, and a `/udp/9000/p2p/` in the discovery_addresses, so there's not really anything so far we write that has `/tcp/9000/udp/9000/p2p` or similar",
        "created_at": "2020-06-16T03:16:15.475000+00:00",
        "attachments": []
    },
    {
        "author": "nishant0",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "maybe we should just combine them ?",
        "created_at": "2020-06-16T03:16:37.048000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the p2p and discovery arrays?",
        "created_at": "2020-06-16T03:16:57.726000+00:00",
        "attachments": []
    },
    {
        "author": "nishant0",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yeap",
        "created_at": "2020-06-16T03:17:02.180000+00:00",
        "attachments": []
    },
    {
        "author": "nishant0",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "is there any reason they are different now ?",
        "created_at": "2020-06-16T03:17:11.977000+00:00",
        "attachments": []
    },
    {
        "author": "nishant0",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "if we assume all protocols can be represented by a single multiaddress",
        "created_at": "2020-06-16T03:17:30.855000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "so if it doesn't support discovery, just drop the udp... that might work i guess, depends if it makes other things harder...",
        "created_at": "2020-06-16T03:18:22.202000+00:00",
        "attachments": []
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah, so I've been trying my best to disallow any kind of `/tcp/X/p2p/X` addresses being used in lighthouse as users tend to try and connect with these multiaddrs. This often runs into confusion because the peers can only connect via libp2p and not discovery and wont find any new peers. So I've always forced people to use ENR's which have both TCP and UDP ports optionally specified. If we are removing ENR's in favour of multiaddrs, my plan is to require the UDP protocol if you are using a multiaddr to specify a bootnode.",
        "created_at": "2020-06-16T03:20:51.294000+00:00",
        "attachments": []
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think I'll allow just TCP multiaddrs but will display a big warning saying that the peers may connect but will not support disocvery, and that UDP should be added",
        "created_at": "2020-06-16T03:21:22.931000+00:00",
        "attachments": []
    },
    {
        "author": "nishant0",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "if the multiaddress doesn't have `udp` its safe to assume it doesn't support discovery. With everything being multiaddresses now instead of multiaddress or enr,  it may not be needed to separate the p2p/discovery arrays",
        "created_at": "2020-06-16T03:21:44.937000+00:00",
        "attachments": []
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I agree.. but then clients should output \"listening on: multiaddr\" where multiaddr contains the UDP",
        "created_at": "2020-06-16T03:22:16.251000+00:00",
        "attachments": []
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "most clients should support discovery",
        "created_at": "2020-06-16T03:22:23.763000+00:00",
        "attachments": []
    },
    {
        "author": "nishant0",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "agreed, that makes sense",
        "created_at": "2020-06-16T03:22:31.010000+00:00",
        "attachments": []
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "so that users don't accidently grab just a tcp multiaddr",
        "created_at": "2020-06-16T03:22:33.939000+00:00",
        "attachments": []
    },
    {
        "author": "nishant0",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "no reason to not support udp now in the multiaddress",
        "created_at": "2020-06-16T03:22:44.006000+00:00",
        "attachments": []
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I've seen some code, where the p2p is expected to be the last field. I guess we don't want to force the ordering of tcp/udp... I might use udp first just because ðŸ™‚",
        "created_at": "2020-06-16T03:23:47.164000+00:00",
        "attachments": []
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but not require it",
        "created_at": "2020-06-16T03:23:50.877000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "i have to confess i hadn't read any spec and just assumed that `/p2p/key` was the end",
        "created_at": "2020-06-16T03:57:11.940000+00:00",
        "attachments": []
    },
    {
        "author": "deme1744",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e we discussed this at length in a previous eth2 call and they just implemented it in rust\n\u003e curious if this is on anyone elses radar\n\u003c@!291925846556540928\u003e For Nimbus this is tracked as an issue here: https://github.com/status-im/nim-eth/issues/250 . It is not really high on the priority as I see it rather as a nice-to-have as from my understanding  the feature is required mostly for making manual connections to bootstrap nodes  more convenient while testing and such. Not as a consistent way of providing bootstrap node addresses (e.g. in the provided bootstrap files). For those, the ENR format would still be used right? Or are my assumptions wrong?",
        "created_at": "2020-06-16T08:15:20.666000+00:00",
        "attachments": []
    },
    {
        "author": "nishant0",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "From my understanding the plan is to provide bootstrap node addresses through their multiaddress not enr",
        "created_at": "2020-06-16T08:18:08.039000+00:00",
        "attachments": []
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We plan to continue to support both. So will be indifferent to how people want to provide bootnodes.",
        "created_at": "2020-06-16T09:40:18.509000+00:00",
        "attachments": []
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!510413979080720385\u003e It is to allow a more human readable way to manually connect to nodes. You are correct that it is not critical and that ENR works but is a headache once a human has to come in",
        "created_at": "2020-06-16T12:22:23.429000+00:00",
        "attachments": []
    }
]