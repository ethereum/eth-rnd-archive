[
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!194432762315407360\u003e I'm curious if you'd be willing to consider adopting uTP into the base discv5 protocol.  We'd likely begin with it as an independent sub-protocol using `TALKREQ` but as I'm starting to write up the spec, it might be a nice addition to the base protocol as a generic tool that all subprotocols can depend on being able to leverage.",
        "created_at": "2021-03-19T17:24:15.826000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Probably better for me to wait and ask the question once I have a spec I can point you towards (working on that now)",
        "created_at": "2021-03-19T17:24:36.112000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I really want to have a protocol like that, but maybe not specifically in discovery",
        "created_at": "2021-03-19T17:25:25.920000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This is similar to the relationship of HTTP and WebSocket",
        "created_at": "2021-03-19T17:25:56.584000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "You need to make an HTTP request to start a ws session, asking the server to 'upgrade to ws'. Then the server says 'ok lets switch' and from that point onwards, you're in a ws session",
        "created_at": "2021-03-19T17:27:07.381000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "TALKREQ is like that, you can negotiate the session with it",
        "created_at": "2021-03-19T17:27:43.657000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But we don't need to define what the session actually does in discovery itself",
        "created_at": "2021-03-19T17:28:15.812000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "What I did in my POC was just use TALKREQ as the transport and everything else was directly pulled from the uTP spec.  Benefit there was that it got the base benefits of discv5 as transport (encryption, resistance to packet inspection)",
        "created_at": "2021-03-19T17:28:50.579000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And some \"other\" sub-protocol that wants to use it simply needs to communicate a `connection_id` using whatever mechanism they please, and then listen for that connection to be initiated over the `utp` subprotocol.",
        "created_at": "2021-03-19T17:30:01.409000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "so it seems like we're kind of talking about the same thing?  or are you saying you'd want something like uTP but with a completely different packet format (rather than just embedding it in one of the discv5 message types)",
        "created_at": "2021-03-19T17:30:29.231000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think if we make a UDP-based data protocol, it should be in its own spec. We can reuse some stuff from the discv5 spec, but I doubt there will be much overlap",
        "created_at": "2021-03-19T17:43:23.174000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "so it would re-implement handshake, encryption, resistance to packet inspection, etc?",
        "created_at": "2021-03-19T17:43:51.356000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "In discv5 packets, the sender ID is always given. This is very nice for discovery because it is expected that you'll talk to a lot of nodes and there will be many handshakes",
        "created_at": "2021-03-19T17:45:01.911000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "For a data protocol, the expectation is that you handshake once and then send many packets containing the data you want to transfer",
        "created_at": "2021-03-19T17:46:09.256000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It's a different kind of communication flow",
        "created_at": "2021-03-19T17:46:23.408000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But these things can be mixed",
        "created_at": "2021-03-19T17:46:48.978000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If we define a variant of uTP, we can just say that a 'session id' and AES secrets must already exist when the session starts",
        "created_at": "2021-03-19T17:47:40.302000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Then we can define a very simple packet layout that just encrypts with AES/GCM and contains the session ID",
        "created_at": "2021-03-19T17:48:16.019000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We should try to find a time to talk soon because we're leaning heavily towards implementing uTP over TALKREQ for the functionality we're building out for state availability and the other related networks, and I'd like to understand your vision better.",
        "created_at": "2021-03-19T17:48:55.655000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "To create a session, you'd invoke a TALKREQ handler and do all the negotiation there",
        "created_at": "2021-03-19T17:49:19.397000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "IIUC, your suggesting that rather than having a new message type for uTP transport, we might do a different packet type (but still re-use the session/encryption from the base protocol)",
        "created_at": "2021-03-19T17:49:24.192000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We have `WhoAreYou/HandshakeResponse/Message` currently, this might add a 4th (`StreamData`).  And maybe with some rules that say `StreamData` is only valid over an existing session and cannot initiate new sessions.",
        "created_at": "2021-03-19T17:50:55.286000+00:00",
        "attachments": null
    }
]