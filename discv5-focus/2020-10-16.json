[
    {
        "author": "nishant0",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Alright we have catdog up and running for prysm, so we should be able to bake the bootnodes into our next release and have it v5.1 compatible. ENRs for anyone interested:\n```\nv5.0:  enr:-Ku4QLglCMIYAgHd51uFUqejD9DWGovHOseHQy7Od1SeZnHnQ3fSpE4_nbfVs8lsy8uF07ae7IgrOOUFU0NFvZp5D4wBh2F0dG5ldHOIAAAAAAAAAACEZXRoMpAYrkzLAAAAAf__________gmlkgnY0gmlwhBLf22SJc2VjcDI1NmsxoQJxCnE6v_x2ekgY_uoE1rtwzvGy40mq9eD66XfHPBWgIIN1ZHCCD6A\nv5.1:  enr:-Ku4QOnVSyvzS3VbF87J8MubaRuTyfPi6B67XQg6-5eAV_uILAhn9geTTQmfqDIOcIeAxWHUUajQp6lYniAXPWncp6UBh2F0dG5ldHOIAAAAAAAAAACEZXRoMpAYrkzLAAAAAf__________gmlkgnY0gmlwhBLf22SJc2VjcDI1NmsxoQKekYKqUtwbaJKKCct_srE5-g7tBUm68mj_jpeSb7CCqYN1ZHCCC7g\n```\ncc \u003c@!203220829473996800\u003e",
        "created_at": "2020-10-16T09:03:40.855000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hmm, trying the v5.1 endpoint of catdog with rumor (using v5.1) and seeing `err=can't sign: unsupported curve `, not sure what's going wrong. Getting a response at least, but no luck getting nodes",
        "created_at": "2020-10-16T09:58:42.316000+00:00",
        "attachments": []
    },
    {
        "author": "nishant0",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "wierd",
        "created_at": "2020-10-16T09:59:05.937000+00:00",
        "attachments": []
    },
    {
        "author": "nishant0",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "let me run prysm with v5.1 using a v5.1 bootnode",
        "created_at": "2020-10-16T09:59:17.039000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "somehow the curve name of the priv key used in rumor is an empty string, and it fails then when signing",
        "created_at": "2020-10-16T10:02:04.901000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "which library are you using for secp256k1?",
        "created_at": "2020-10-16T10:03:00.473000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "libp2p crypto, which uses btcsuite: `privk, _ := btcec.PrivKeyFromBytes(btcec.S256(), data)` instead of the `.S256()` in geth",
        "created_at": "2020-10-16T10:14:30.046000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yeah",
        "created_at": "2020-10-16T10:14:41.363000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the go-ethereum library expects its own `crypto.S256()`, otherwise it won't work",
        "created_at": "2020-10-16T10:15:22.834000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yea, I read that piece of the code, comparing the curve instance",
        "created_at": "2020-10-16T10:15:48.889000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But why can't it just use it? It's still the same crypto",
        "created_at": "2020-10-16T10:16:09.973000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Making it compatible would be nice",
        "created_at": "2020-10-16T10:16:22.082000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Will implement a work-around for now, serializing/deserializing into geth priv key, before handing it to discv5",
        "created_at": "2020-10-16T10:16:58.152000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Or maybe I can just overwrite the `.Curve`, feels hacky though",
        "created_at": "2020-10-16T10:17:42.900000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm not sure how to make it work best. The go-ethereum `crypto.Sign` always uses its own curve implementation anyway. I need this check because I want to add support for ed25519 soon, and it has a different API for signing.",
        "created_at": "2020-10-16T10:20:20.940000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "hmm, maybe I could add a fallback using `ecdsa.Sign` there",
        "created_at": "2020-10-16T10:27:19.536000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but not sure if it will work, and I don't have a good way to test this, it would never be used except in rumor",
        "created_at": "2020-10-16T10:29:04.760000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Did the `.Curve` thing so it makes it into the `makeIDSignature` switch statement there. But now seeing `invalid ephemeral pubkey\" in catdog logs",
        "created_at": "2020-10-16T10:29:46.799000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "any more specific message there?",
        "created_at": "2020-10-16T10:30:26.962000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Prysm also uses libp2p crypto. Not sure how they deserialize their priv keys, with which type system etc.",
        "created_at": "2020-10-16T10:30:37.315000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "```\nTRACE[10-16|10:26:50.463] [v5.1] \u003c\u003c UNKNOWN/v5            id=1f968f4fb49b1d3f addr=80.110.77.85:20072\nTRACE[10-16|10:26:50.463] [v5.1] \u003e\u003e WHOAREYOU/v5          id=1f968f4fb49b1d3f addr=80.110.77.85:20072\nDEBUG[10-16|10:26:50.665] [v5.1] Bad discv5 packet        id=1f968f4fb49b1d3f addr=80.110.77.85:20072    err=\"invalid ephemeral pubkey\"\n```",
        "created_at": "2020-10-16T10:31:31.864000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "No, this is all I get on the receiving end of the ping",
        "created_at": "2020-10-16T10:31:51.561000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "BTW libsecp256k1 is much faster, and is used for all the decoding/verification unless they explicitly build with nocgo",
        "created_at": "2020-10-16T10:32:03.275000+00:00",
        "attachments": []
    },
    {
        "author": "nishant0",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah we get the same error too",
        "created_at": "2020-10-16T10:32:42.378000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Will keep that in mind, thanks. Just concerned about compatibility here though",
        "created_at": "2020-10-16T10:32:45.158000+00:00",
        "attachments": []
    },
    {
        "author": "nishant0",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "will have to shift it around a bit, shouldn't be too difficult though",
        "created_at": "2020-10-16T10:33:02.506000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "```\n    var priv crypto.PrivKey\n    priv, err = crypto.UnmarshalSecp256k1PrivateKey(privKeyBytes)\n    if err != nil {\n        return nil, fmt.Errorf(\"cannot parse private key, invalid private key (Secp256k1): %v\", err)\n    }\n    key := (priv).(*crypto.Secp256k1PrivateKey)\n    key.Curve = gcrypto.S256()\n```\nIs my priv key loading code now. Libp2p, but with geth params override, so discv5 is happy. Ugly",
        "created_at": "2020-10-16T10:34:20.673000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "probably should just use geth directly, then cast that to libp2p crypto, but don't think it matters. It's just that `.Curve` + two big numbers (and yes, it's on curve and everything)",
        "created_at": "2020-10-16T10:35:23.583000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Why can't you use `crypto.ToECDSA(privKeyBytes)` instead?",
        "created_at": "2020-10-16T10:35:51.774000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Will do that. This was the libp2p way",
        "created_at": "2020-10-16T10:36:08.035000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If you keep the private key as bytes, you can just unmarshal it differently for the different uses.",
        "created_at": "2020-10-16T10:36:25.392000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That feels worse tbh",
        "created_at": "2020-10-16T10:36:49.080000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "hmm, maybe style prefs getting in the way there",
        "created_at": "2020-10-16T10:37:07.862000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I mean, I could ask the same question: does libp2p accept the keys unmarshaled using our library?",
        "created_at": "2020-10-16T10:38:17.624000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "probably not!",
        "created_at": "2020-10-16T10:38:24.604000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So it's like, each system wants the key treated with its own set of libraries",
        "created_at": "2020-10-16T10:38:45.022000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But I agree it's annoying.",
        "created_at": "2020-10-16T10:39:02.521000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Everything will get easier with ed25519 because its in the stdlib",
        "created_at": "2020-10-16T10:39:17.916000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I mean that there already is a `Curve/X/Y` common ground and types. It's just a matter of recognizing the crypto, whoever provided the params and numbers",
        "created_at": "2020-10-16T10:41:08.968000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but you can't recognize it based on the numbers alone, they're only meaningful if you know which curve they're on",
        "created_at": "2020-10-16T10:41:50.070000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Anyway, still getting the same ephemeral key error with .ToECDSA, it's not the priv key that's wrong.",
        "created_at": "2020-10-16T10:41:50.234000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yes",
        "created_at": "2020-10-16T10:41:55.226000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm investigating this",
        "created_at": "2020-10-16T10:42:00.376000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "There's the `Curve.Params().Name`, but that isn't filled properly by every library either.",
        "created_at": "2020-10-16T10:42:21.649000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yes",
        "created_at": "2020-10-16T10:43:03.174000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Oh I think I got it",
        "created_at": "2020-10-16T10:44:50.740000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!203220829473996800\u003e do you know which implementation is sending this ping?",
        "created_at": "2020-10-16T10:45:01.550000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The ephemeral pubkey again uses some switch statement",
        "created_at": "2020-10-16T10:45:02.807000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But other end is not updated yet, still not recognizing the curve params",
        "created_at": "2020-10-16T10:45:16.202000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So I need to copy that hack to the other end, and it should work...",
        "created_at": "2020-10-16T10:45:30.089000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It's the v5wire `DecodePubkey` which has the same switch logic",
        "created_at": "2020-10-16T10:47:30.283000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yes, but that should be fixed as well since your private key now has the right curve instance",
        "created_at": "2020-10-16T10:48:20.212000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I hit the first error on the sending side. Need to fix remote catdog instance, which uses libp2p priv key parsing util",
        "created_at": "2020-10-16T10:48:56.384000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Catdog is updated and can respond to v5.1 pings now",
        "created_at": "2020-10-16T11:14:20.401000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hmm, debugging catdog now, seeing if table is filled and I can get v5.0 records. It appears like some buckets are completely full, and others completely empty, that's weird",
        "created_at": "2020-10-16T11:29:48.540000+00:00",
        "attachments": []
    }
]