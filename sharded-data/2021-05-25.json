[
    {
        "author": ".vbuterin",
        "category": "Cross-layer",
        "parent": "",
        "content": "Actually, wait",
        "created_at": "2021-05-25T13:56:11.277000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Cross-layer",
        "parent": "",
        "content": "One issue",
        "created_at": "2021-05-25T13:56:13.514000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Cross-layer",
        "parent": "",
        "content": "There could be two pending shard headers for one (shard, slot) pair",
        "created_at": "2021-05-25T13:56:24.125000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Cross-layer",
        "parent": "",
        "content": "We can't just adopt a \"accept the first, reject the second\" rule, because then there would be no way to get assurance that some shard header is winning before it gets included into the chain",
        "created_at": "2021-05-25T13:57:03.097000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Cross-layer",
        "parent": "",
        "content": "(which is a ~2x latency increase)",
        "created_at": "2021-05-25T13:57:14.382000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Cross-layer",
        "parent": "",
        "content": "So realistically we would just need lists for the pending section",
        "created_at": "2021-05-25T13:57:54.335000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Cross-layer",
        "parent": "",
        "content": "But it could be a list for each (shard, slot) pair",
        "created_at": "2021-05-25T13:58:01.298000+00:00",
        "attachments": null
    },
    {
        "author": "nashatyrev",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@!273808422753796097\u003e thank for feedback! \nWhat do you think regarding single ring buffer proposal above? \nIt would optimize state storage and make headers available for reference immediately after confirmation",
        "created_at": "2021-05-25T16:17:01.723000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Cross-layer",
        "parent": "",
        "content": "Sorry what's the single ring buffer idea?",
        "created_at": "2021-05-25T16:17:32.265000+00:00",
        "attachments": null
    },
    {
        "author": "nashatyrev",
        "category": "Cross-layer",
        "parent": "",
        "content": "This one (https://discord.com/channels/595666850260713488/595701195843174434/842073979896070175)",
        "created_at": "2021-05-25T16:18:39.400000+00:00",
        "attachments": null
    },
    {
        "author": "nashatyrev",
        "category": "Cross-layer",
        "parent": "",
        "content": "ðŸ‘†",
        "created_at": "2021-05-25T16:32:49.003000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Cross-layer",
        "parent": "",
        "content": "hmm how would that work when the \"previous\" and \"pre-previous\" are two different data structures?",
        "created_at": "2021-05-25T20:09:45.389000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Cross-layer",
        "parent": "",
        "content": "Also, I think we should stick to current/previous because we use current/previous everywhere else too",
        "created_at": "2021-05-25T20:09:58.312000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Cross-layer",
        "parent": "",
        "content": "The other thing is that perhaps pre-previous also needs to be modified (eg. store a rotating array of 1024 of them or something like that) depending on what the opcodes/precompiles for accessing shard header data end up being",
        "created_at": "2021-05-25T20:10:44.991000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Cross-layer",
        "parent": "",
        "content": "I personally am leaning toward a precompile that implements a function `check_header_proof(shard, slot, byte_from, byte_to, data, proof)`",
        "created_at": "2021-05-25T20:11:36.158000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Cross-layer",
        "parent": "",
        "content": "And that function grabs the correct root from the state, checks the Kate proof, etc etc",
        "created_at": "2021-05-25T20:11:52.504000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Cross-layer",
        "parent": "",
        "content": "the idea of the abstraction is so that if we ever upgrade how shard header proving is done, applications can handle that seamlessly as the precompile would just upgrade automatically and it would even handle pre-boundary vs post-boundary correctly depending on the slot",
        "created_at": "2021-05-25T20:12:40.967000+00:00",
        "attachments": null
    }
]