[
    {
        "author": "kevaundray",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@898563924440543283\u003e or \u003c@159152274659082240\u003e Trying to understand this behaviour: \u003chttps://github.com/mdehoog/go-ethereum/blob/eip-4844/signer/core/apitypes/types.go#L154\u003e\n\nCorrect me if I'm wrong; does this mean that if I submit a transaction with two blobs, blobA is valid, but blobB is invalid, then the transaction will be correct and we ignore blobB?",
        "created_at": "2022-11-14T16:20:40.317000+00:00",
        "attachments": null
    },
    {
        "author": "roberto.bayardo",
        "category": "Cross-layer",
        "parent": "",
        "content": "looks that way doesn't it. that's pretty old code though (9 months back) so pershaps it was meant to be revisited. tagging \u003c@203220829473996800\u003elambda who authored it.",
        "created_at": "2022-11-14T16:58:49.941000+00:00",
        "attachments": null
    },
    {
        "author": "kevaundray",
        "category": "Cross-layer",
        "parent": "",
        "content": "Ahh okay, forwarding to proto:\n\nIf this is the case, I was wondering why the transaction is not rejected as a whole, given one of the blobs were incorrect",
        "created_at": "2022-11-14T17:01:08.677000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cprotolambda\u003e \u003e \u003cprotolambda\u003e  See comment in code: the function didn’t have an error return argument, so I made it default to something that can at least be processed, instead of refactoring the tx api flow (re @sharded_data_bot: \u003cRoberto Bayardo\u003e [reply]: looks that way doesn't it. that's pretty old code though (9 months back) so pershaps it was meant to be revisited. tagging @protolambda who authored it.)",
        "created_at": "2022-11-14T17:01:10.254000+00:00",
        "attachments": null
    },
    {
        "author": "roberto.bayardo",
        "category": "Cross-layer",
        "parent": "",
        "content": "thx, yes that comment made me suspect it was a temporary thing. Let me look into propagating the error.",
        "created_at": "2022-11-14T17:02:44.526000+00:00",
        "attachments": null
    },
    {
        "author": "kevaundray",
        "category": "Cross-layer",
        "parent": "",
        "content": "To confirm, the correct behaviour when one of the blobs is incorrect in a tx is to reject the whole tx?",
        "created_at": "2022-11-14T17:09:29.509000+00:00",
        "attachments": null
    },
    {
        "author": "roberto.bayardo",
        "category": "Cross-layer",
        "parent": "",
        "content": "I would think so... if I sent a tx and any of the blobs were silently dropped I'd be really confused!",
        "created_at": "2022-11-14T17:32:37.229000+00:00",
        "attachments": null
    },
    {
        "author": "roberto.bayardo",
        "category": "Cross-layer",
        "parent": "",
        "content": "it's also a little odd that that code isn't just using the commitments and versioned hashes being returned by ComputeCommitmentsAndAggregateProof.  I will clean that up as well.",
        "created_at": "2022-11-14T17:35:14.598000+00:00",
        "attachments": null
    },
    {
        "author": "roberto.bayardo",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@427491045308235776\u003e added the fix \u0026 cleanup for this to my open PR. Thanks for flagging!",
        "created_at": "2022-11-14T18:18:23.473000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cdannyryan\u003e Current beacon_block_and_sidecar gossip conditions are insufficient to prevent arbitrary actors getting a corrupted sidecar gossiped to the network\n\nhttps://github.com/ethereum/consensus-specs/issues/3103",
        "created_at": "2022-11-14T18:26:18.478000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cdannyryan\u003e pretty confident, but maybe I'm missing something",
        "created_at": "2022-11-14T18:27:16.631000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cinphi\u003e \u003e \u003cinphi\u003e  I thought the idea was to use the kzg commitments in the block to verify the blobs sidecar's aggregated proof? (re @dannyryan: Current beacon_block_and_sidecar gossip conditions are insufficient to prevent arbitrary actors getting a corrupted sidecar gossiped to the network\n\nhttps://github.com/ethereum/consensus-specs/issues/3103)",
        "created_at": "2022-11-14T18:50:34.923000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cinphi\u003e This verification essentially confirms that the sidecar is tethered to the beacon block. If someone mutates the sidecar and breaks the tether, then the coupled message will get rejected at gossip",
        "created_at": "2022-11-14T18:52:52.775000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cdannyryan\u003e but those checks are not done as gossip validations",
        "created_at": "2022-11-14T18:54:20.637000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cdannyryan\u003e meaning the block and sidecar can be forwarded prior to doing those",
        "created_at": "2022-11-14T18:54:28.733000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cdannyryan\u003e another example — we forward a block on gossip before executing all TXs and cehcking the state root, but that's okay because at least the TXs and state root committed to by the proposer are (1) cehcked that the proposer committed them due to the signature and (2) can't be mutated by others.. due to the signature",
        "created_at": "2022-11-14T18:55:26.298000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cdannyryan\u003e so it's okay to defer some expensive checks to get the block out but they need a cryptoeconomic commitment if they are to be forwarded pre-checked",
        "created_at": "2022-11-14T18:55:45.679000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cdannyryan\u003e \u003e Once the sidecar and beacon block are received together, validate_blobs_sidecar can unlock the data-availability fork-choice dependency.\n\n`validate_blobs_sidecar` is what actually checks these but this function is not a gossip validation condition",
        "created_at": "2022-11-14T18:56:34.870000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cdannyryan\u003e so we either need `validate_blobs_sidecar` to be a gossip condition or to sign the blobs side car",
        "created_at": "2022-11-14T18:56:51.751000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cdannyryan\u003e `verify_aggregate_kzg_proof` for the sidecar would need to be sufficiently cheap to throw it into the gossip validations. It's a pairing_check so similar to the proposer signature so maybe you can argue that it's cheap enough",
        "created_at": "2022-11-14T18:59:04.511000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cinphi\u003e ah i see. Yeah we need to add blob validation to the gossip condition.",
        "created_at": "2022-11-14T18:59:26.223000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cinphi\u003e i thought it was already there for some reason.",
        "created_at": "2022-11-14T18:59:41.915000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cdannyryan\u003e right so given that it cost the same to do this check vs do anothe r sig check, we should do the sidecar kzg validation here",
        "created_at": "2022-11-14T19:02:04.424000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cterencechain\u003e what are the latest blob validation benchmark numbers? I wonder if it makes sense to prefer signature over",
        "created_at": "2022-11-14T19:02:06.782000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cinphi\u003e tho It's not cheap per se (about 12ms rn) to verify the sidecar proof at gossip.",
        "created_at": "2022-11-14T19:02:10.026000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cdannyryan\u003e should be the same cost roughly as doing a proposer signature check, no?",
        "created_at": "2022-11-14T19:02:46.657000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cterencechain\u003e proposer signature check is typically 1-5ms",
        "created_at": "2022-11-14T19:03:10.022000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cinphi\u003e \u003e \u003cinphi\u003e  no. There's quite a bit of work involved before it does the pairing check. (re @dannyryan: should be the same cost roughly as doing a proposer signature check, no?)",
        "created_at": "2022-11-14T19:03:37.965000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cdannyryan\u003e I see",
        "created_at": "2022-11-14T19:04:20.969000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cinphi\u003e but that number is for 2mb blobs. With 256kb blobs, it's ~4ms",
        "created_at": "2022-11-14T19:06:21.673000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cdannyryan\u003e okay, added this added this to that issue — \nSo we can either sign the payload and do another sig check or we can run the full validate_blobs_sidecar.\n\u003c@159152274659082240\u003e estimates validate_blobs_sidecar as ~12ms @ 2MB (4ms at 256kb) whereas the signature check @terencechain estimates at 1 to 4ms. If we run validate_blobs_sidecar will it be dominant wrt time? If so, we need to be careful here. If not, lets just do that.",
        "created_at": "2022-11-14T19:07:05.027000+00:00",
        "attachments": null
    },
    {
        "author": "kevaundray",
        "category": "Cross-layer",
        "parent": "",
        "content": "Adding onto this, to get an idea of the pure cryptographic numbers, without serialisation costs on my laptop:\n\n```\ngoos: darwin\ngoarch: amd64\npkg: github.com/crate-crypto/go-proto-danksharding-crypto/agg_kzg\ncpu: Intel(R) Core(TM) i9-9980HK CPU @ 2.40GHz\nBenchmarkAggVerify1-16                          2499203 ns/op\nBenchmarkAggVerify2-16                          3278393 ns/op\nBenchmarkAggVerify3-16                          4033615 ns/op\nBenchmarkAggVerify4-16                          4844001 ns/op\nBenchmarkAggVerify5-16                          5763020 ns/op\nBenchmarkAggVerify6-16                          6500817 ns/op\nBenchmarkAggVerify7-16                          7366121 ns/op\nBenchmarkAggVerify8-16                          8267168 ns/op\nBenchmarkAggVerify9-16                          8857999 ns/op\nBenchmarkAggVerify10-16                         9594048 ns/op\nBenchmarkAggVerify11-16                        10273552 ns/op\nBenchmarkAggVerify12-16                        14101749 ns/op\nBenchmarkAggVerify13-16                        13103934 ns/op\nBenchmarkAggVerify14-16                        13431766 ns/op\nBenchmarkAggVerify15-16                        15368090 ns/op\nBenchmarkAggVerify16-16                        14334650 ns/op\n```\n\n\nLegend:\n\nBenchmarkAggVerifyX-K : X denotes the amount of blobs and K denotes the number of cores on my machine",
        "created_at": "2022-11-14T19:31:54.114000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003casn_d6\u003e Hello. Chances are I'm not gonna be able to attend the call tomorrow. @kevaundray can you please summarize the progress on the recent crypto PRs #3097 and #3093 during the call tomorrow?",
        "created_at": "2022-11-14T22:19:37.454000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003ckevaundray\u003e \u003e \u003ckevaundray\u003e  Yep sure (re @asn_d6: Hello. Chances are I'm not gonna be able to attend the call tomorrow. @kevaundray can you please summarize the progress on the recent crypto PRs #3097 and #3093 during the call tomorrow?)",
        "created_at": "2022-11-14T22:20:07.552000+00:00",
        "attachments": null
    }
]