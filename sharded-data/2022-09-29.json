[
    {
        "author": "daniellehrner",
        "category": "Cross-layer",
        "parent": "",
        "content": "Do we know already how much the minimum bandwidth for nodes will increase with 4844? I saw some discussions on Twitter, but I don't know if anybody was yet able to do some real world measurements.",
        "created_at": "2022-09-29T08:31:29.026000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "Why?",
        "created_at": "2022-09-29T09:20:45.287000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003casn_d6\u003e why what?",
        "created_at": "2022-09-29T09:21:34.194000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "It *feels* super trivial to just have `if (block.timestamp \u003e= X) ... else ...`, which feels almost identical to `if (block.number \u003e= X) ... else ...`.",
        "created_at": "2022-09-29T09:21:49.674000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "Hmm, does the bridge not include details of what I replied to?",
        "created_at": "2022-09-29T09:22:05.208000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003casn_d6\u003e oh it doesn't . thought you were questioning the use of metrics wrt bandwidth usage.",
        "created_at": "2022-09-29T09:22:27.633000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "Ah, no.  Was questioning Geth's desire for block number based forking.",
        "created_at": "2022-09-29T09:22:50.854000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003casn_d6\u003e ack ack",
        "created_at": "2022-09-29T09:23:06.358000+00:00",
        "attachments": []
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "The problem is that we won't have `if (block.timestamp \u003e= X) ... else ...`, but rather `if (block.timestamp \u003e= X) ... else if (block.number \u003e= X) ... else if (!config.ismerged \u0026\u0026 block.terminaltotaldifficulty \u003e= X) ...`",
        "created_at": "2022-09-29T09:23:39.233000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "I am pretty strongly in the camp that we should try extremely hard to not require EL/CL forks to happen at the same time.  One of the two should always come first and be compatible with new and old versions of the other, then the other would come second once the first is running smoothly.",
        "created_at": "2022-09-29T09:24:13.255000+00:00",
        "attachments": []
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "We still need to support full syncing as well as testnets/private networks",
        "created_at": "2022-09-29T09:24:17.388000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "Is the difference just that the first of these two is more consistent internally?\n```ts\nif (block.number \u003e= cancun) ...\nelse if (block.number \u003e= shanghai) ...\nelse if (block.number \u003e= merge) ...\nelse if (block.number \u003e= berlin) ...\nelse if (block.number \u003e= london) ...\n...\n```\n```ts\nif (block.timestamp \u003e= cancun) ...\nif (block.timestamp \u003e= shanghai) ...\nelse if (block.number \u003e= merge) ...\nelse if (block.number \u003e= berlin) ...\nelse if (block.number \u003e= london) ...\n```",
        "created_at": "2022-09-29T09:26:19.507000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "You could just update geth to retroactively use timestamps for all past upgrades.  Would be a one time task of collecting all of the upgrade timestamps for all of the currently supported testnets and mainnet and swapping them out in config files.  Of course, this will break anyone with a custom testnet config as they'll need to do the same thing.  Feels like it could be a good one-time-breakage for reduced long term maintenance?",
        "created_at": "2022-09-29T09:27:48.125000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "For example, I would do the same for The Merge so The Merge doesn't have this weird custom fork logic in it and instead it just forks on the first block with timestamp \u003e= X.",
        "created_at": "2022-09-29T09:28:17.516000+00:00",
        "attachments": []
    },
    {
        "author": "inphi",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@301186049323958275\u003e What's your actual argument here against EL and CL forking at the same time?\nI'm not opposed to having one of EL/CL forking first. But like you said, once we commit to a particular upgrade dependency, then future forks must be bound by it. Otherwise, if we later decide to flip the upgrade dependency, the newly dependent network will now have to maintain both backwards and  *forwards* compatibility. Perhaps this will never be a concern (my thinking is that the CL always upgrades first).",
        "created_at": "2022-09-29T14:26:08.058000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "Changing two things at once is more risky than changing one thing at a time.",
        "created_at": "2022-09-29T15:53:32.336000+00:00",
        "attachments": []
    },
    {
        "author": "sauliusgrigaitis",
        "category": "Cross-layer",
        "parent": "",
        "content": "This applies more in the cases where CL and EL hardforks do not introduce features that needs both CL and EL changes. Otherwise it becomes much more complex situation where hardfork actually doesn‚Äôt activate new features until the other side hardforks. At the code level it‚Äôs also ugly. Hardforks are often pretty nicely organised via pattern matching or so, but with CL/EL hardforking at different times we will need to have either PreForkName and PostForkName hardforks instead of ForkName hardfork, either a sea of if/else statements inside ForkName fork code.",
        "created_at": "2022-09-29T16:23:48.277000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think that the risk of changing two things at once is higher than the risk of increased complexity in one of the two clients.",
        "created_at": "2022-09-29T16:48:14.381000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "I also think we likely can often take measures to reduce the complexity risk, while it is much harder to reduce the \"changing two things at once\" risk because it is unknowns.",
        "created_at": "2022-09-29T16:48:42.404000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003ctimbeiko\u003e Is it? In the case of withdrawals, for example, allowing them on the CL side before they activate on the EL means they \"pile up\"  between the CL epoch activation and EL block activation.",
        "created_at": "2022-09-29T16:49:04.678000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003ctimbeiko\u003e For 4844 it's less of a problem because the EL is the side initiating blob txns, so it's fine for the CL to be ready \"before\", but if anything is initiated by the CL, you need to deal with the \"lag\", which also introduces complexities/risks",
        "created_at": "2022-09-29T16:49:51.354000+00:00",
        "attachments": []
    },
    {
        "author": "sauliusgrigaitis",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think that‚Äôs undervaluing the risk that comes from the complexity introduced in the clients. This complexity alone is high enough and  may be higher than the changes itself. Also, the felling of ‚ÄúEL (or CL) hardfork went fine‚Äù will often be false, as most of the features will not be activated until the other side hardforks. So big bang will actually be when the second hardfork activates the features in the first hardfork. So if hardforks are related I would strongly advice to do it at once.",
        "created_at": "2022-09-29T17:01:21.067000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003ctimbeiko\u003e To argue against myself - one thing that was nice with The Merge is that Bellatrix allowed us to see what % of the network validators had upgraded correctly before the actual code changes kicked in. So perhaps if we want to keep things separate with cross-layer functionality, we re-use the same pattern of the CL side waiting for a trigger on the EL before activating new functionality.",
        "created_at": "2022-09-29T17:04:21.899000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003ctimbeiko\u003e So, in the case of withdrawals, you have something like Capella go live on the CL at Epoch X, and ping the EL to see if it's reached the Shanghai fork block Y and only begin to process withdrawals then.",
        "created_at": "2022-09-29T17:05:05.642000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "We can enable withdraws on the EL side first, without any backward compat issues.",
        "created_at": "2022-09-29T17:06:52.601000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "EL adds code to handle withdrawals, but CL doesn't yet send any withdraws.  Then the CL activates and starts sending withdraws.",
        "created_at": "2022-09-29T17:07:29.236000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "API versioning is the bigger issue here I think.",
        "created_at": "2022-09-29T17:07:46.391000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003ctimbeiko\u003e \u003e \u003ctimbeiko\u003e  The challenge with that is if validators are offline, and the CL activation ends up happening before the EL has reached the correct block height (which is fixed by using timestamps on both sides, but that was contentious earlier). If CL is always first, you can keep using Epoch + Blocks (re @sharded_data_bot: \u003cMicah\u003e [reply]: We can enable withdraws on the EL side first, without any backward compat issues.)",
        "created_at": "2022-09-29T17:09:10.830000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "Oh, I'm proposing you don't schedule CL until EL is released.",
        "created_at": "2022-09-29T17:10:04.617000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003ctimbeiko\u003e Ah, right",
        "created_at": "2022-09-29T17:10:15.976000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "1. Schedule EL to accept withdraws.\n2. Hardfork EL.\n3. Verify no problems.\n4. Schedule CL to send withdraws.\n5. Hardfork CL to send withdraws.",
        "created_at": "2022-09-29T17:10:46.777000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "It has a nice clean ordering, with minimal need for backward compatibility code (and the little there is can be removed after the CL fork).  Very minimal complexity risk introduced, and maximal protection against unknowns of changing two things at the same time.",
        "created_at": "2022-09-29T17:11:38.455000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003ctimbeiko\u003e Yeah, the comms/coordination overhead around this is a bit worse, but it's not the end of the world.",
        "created_at": "2022-09-29T17:11:48.296000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003ctimbeiko\u003e I don't like it, but don't dislike it enough to die on the hill against it üòÖ",
        "created_at": "2022-09-29T17:12:08.983000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "It also allows us to test withdraws in mainnet shadow forks that *only* involve CL changes, rather than needing to have shadow forks that change both EL and CL.",
        "created_at": "2022-09-29T17:12:19.764000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cinphi\u003e Just want to point out that with 4844, the CL has to be ready first so that it can handle 4844 payloads provided by the EL.",
        "created_at": "2022-09-29T17:12:21.622000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003ctimbeiko\u003e Right, so that's the \"easy\" case because it's like The Merge",
        "created_at": "2022-09-29T17:13:00.174000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003ctimbeiko\u003e but if it's bundled with Withdrawals in a fork, we need to ensure both \"directions\" work",
        "created_at": "2022-09-29T17:13:10.514000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "CL's next fork can add 4844, EL's next fork can add withdraws.  Then EL's second fork adds 4844, and CL's second fork adds withdraws.  They don't need to be coordinated other than ordering (CL and EL forks can happen mostly in parallel other than scheduling the fork dates).",
        "created_at": "2022-09-29T17:58:16.954000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003ctimbeiko\u003e If those forks happen two weeks apart, sure. If they happen 6 months apart, that seems like a logistical nightmare, and leave users without anything of value until the second fork kicks in.",
        "created_at": "2022-09-29T18:03:33.791000+00:00",
        "attachments": []
    },
    {
        "author": "sauliusgrigaitis",
        "category": "Cross-layer",
        "parent": "",
        "content": "I‚Äôm wondering why we can‚Äôt embrace (virtual) single client concept. Life would be much easier. The idea is to design upgrades assuming that CL/EL is a single client. This should help to avoid a lot of mumbo jumbo that is associated with such dual client approach. This excitement of dual client different forking possibilities should fade out after the first unsuccessful hardfork.",
        "created_at": "2022-09-29T18:25:25.313000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003ctimbeiko\u003e I think we want to retain the possibility of having only one side fork, so that it is easier in case of emergency fixes, but agreed that ideally we hide as much of that complexity in the default case from users. Simultaneous, timestamp based forks seem like the \"cleanest\" option for that, but clearly they come at some costs.",
        "created_at": "2022-09-29T18:39:12.171000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I don't think doing block height is possible if we're doing both upgrades at the same time \u003c@360491619402776577\u003e , at least I don't see how. However if the upgrade is **only withrawals** on the CL side, then I think we can do  EL first and then CL without much more trouble. But I imagine that this will force the EL to consider blocks with missing withrawals as blocks with zero withrawals until the CL upgrades, and that seems to me more problematic than doing timestamp",
        "created_at": "2022-09-29T21:36:29.848000+00:00",
        "attachments": []
    },
    {
        "author": "timbeiko",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003e But I imagine that this will force the EL to consider blocks with missing withrawals as blocks with zero withrawals until the CL upgrades, and that seems to me more problematic than doing timestamp\n\nI don't understand this - the EL can't assume each block has a withdrawal no matter what?",
        "created_at": "2022-09-29T21:39:01.919000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "We won't send withrawals in the blocks between the EL HF height and the CL one. So the EL needs to treat those blocks as having no withrawals",
        "created_at": "2022-09-29T21:44:47.222000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Then when we do fork we will start sending an empty list of withrawals instead",
        "created_at": "2022-09-29T21:45:26.168000+00:00",
        "attachments": []
    },
    {
        "author": "ajsutton",
        "category": "Cross-layer",
        "parent": "",
        "content": "And the CL will have to be updated to handle the EL suddenly returning an empty list of withdrawals before the CL hard fork.",
        "created_at": "2022-09-29T21:46:07.207000+00:00",
        "attachments": []
    },
    {
        "author": "ajsutton",
        "category": "Cross-layer",
        "parent": "",
        "content": "From any get payload body type methods.",
        "created_at": "2022-09-29T21:46:25.964000+00:00",
        "attachments": []
    },
    {
        "author": "inphi",
        "category": "Cross-layer",
        "parent": "",
        "content": "Sounds like we've got the upgrade backwards. Shouldn't the CL upgrade first then to avoid this?",
        "created_at": "2022-09-29T21:47:34.921000+00:00",
        "attachments": []
    },
    {
        "author": "ajsutton",
        "category": "Cross-layer",
        "parent": "",
        "content": "No can‚Äôt do it the other way because the EL has to process withdrawals the CL sends. Otherwise we‚Äôd withdraw and burn validator funds.",
        "created_at": "2022-09-29T21:48:08.717000+00:00",
        "attachments": []
    },
    {
        "author": "timbeiko",
        "category": "Cross-layer",
        "parent": "",
        "content": "Unless we use a timestamp and can assume they happen at the same time üòÖ",
        "created_at": "2022-09-29T21:49:00.383000+00:00",
        "attachments": []
    },
    {
        "author": "ajsutton",
        "category": "Cross-layer",
        "parent": "",
        "content": "Fundamentally you can‚Äôt say wether it‚Äôs simpler and/or safer to do separate or coordinated upgrades until you actually look at the specific changes required for a particular feature.\nI‚Äôm all for decoupling things and doing frequent small releases but there is huge danger in ‚Äúdecoupling‚Äù things that are really coupled.",
        "created_at": "2022-09-29T21:50:13.138000+00:00",
        "attachments": []
    },
    {
        "author": "inphi",
        "category": "Cross-layer",
        "parent": "",
        "content": "I'm thinking, like we have a HF in CL first so it can handle withdrawals, but block that functionality until the EL HFs. Then we have another soft/pseudo fork to unlcok withdrawals.",
        "created_at": "2022-09-29T21:50:24.937000+00:00",
        "attachments": []
    },
    {
        "author": "inphi",
        "category": "Cross-layer",
        "parent": "",
        "content": "but again, this is just convoluted",
        "created_at": "2022-09-29T21:50:34.925000+00:00",
        "attachments": []
    },
    {
        "author": "ajsutton",
        "category": "Cross-layer",
        "parent": "",
        "content": "Now we‚Äôre doing three hard forks - two decoupled and one coupled. Better to do one coupled fork",
        "created_at": "2022-09-29T21:50:57.180000+00:00",
        "attachments": []
    },
    {
        "author": "ajsutton",
        "category": "Cross-layer",
        "parent": "",
        "content": "I‚Äôm all for forks happening by timestamp. So much simpler to reason about.",
        "created_at": "2022-09-29T21:52:17.048000+00:00",
        "attachments": []
    },
    {
        "author": "ajsutton",
        "category": "Cross-layer",
        "parent": "",
        "content": "We still don‚Äôt have to do them at the same time but we can. And everyone knows exactly when the fork will happen",
        "created_at": "2022-09-29T21:52:55.112000+00:00",
        "attachments": []
    },
    {
        "author": "djrtwo",
        "category": "Cross-layer",
        "parent": "",
        "content": "Some quick notes on coupling (or not) BeaconBlocks and Blobs in 4844 networking\nhttps://notes.ethereum.org/RLOGb1hYQ0aWt3hcVgzhgQ?view",
        "created_at": "2022-09-29T22:09:15.580000+00:00",
        "attachments": []
    }
]