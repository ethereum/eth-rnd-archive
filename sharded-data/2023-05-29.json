[
    {
        "author": "timbeiko",
        "category": "Cross-layer",
        "parent": "",
        "content": "4844 Call in 90m (15:30 UTC)\nAgenda: https://github.com/ethereum/pm/issues/782\nZoom: https://ethereumfoundation.zoom.us/j/88332629239?pwd=YmNpVVpaVy93RXhOTS9DYmNtWGtLdz09",
        "created_at": "2023-05-29T14:00:09.229000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "It looks smelly to me that we have to pass `null` value to `versionedHashes` param to reach backwards compatibility. If we add one more check of this kind then we will get one more `null` and so on. I have no strong argument against doing so, at least such additions makes the spec (and probably implementations, not sure) more complicated. Adhering to the single responsibility principle makes more sense to me. cc \u003c@543900561460822016\u003e",
        "created_at": "2023-05-29T16:36:32.515000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "better way to deal would be to add `version` field to V3 ~~onwards~~  (making it fixed) and push the payload and versioned inside data object (and so on future fields)",
        "created_at": "2023-05-29T16:38:45.651000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "i don't see the difference here, method parameter set can be interpreted as a data structure and particular instance of this set as an object",
        "created_at": "2023-05-29T16:43:32.881000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "well version has to be the fork version of the block, method param is backwards compatible",
        "created_at": "2023-05-29T16:44:15.667000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "Extending param set is backwards compatible, likewise, extending a data structure. It's more about making the spec and the validation code more complicated on EL side with a small gain for CLs. As long as at least one CL doesn't leverage on provided backwards compatibility we have to keep all versions of each method",
        "created_at": "2023-05-29T16:58:49.217000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "but the version field will have to be correctly passed (like `capella/shanghai` on v3) so EL can safely assume what fields should be there and not validate for rest... so json rpc call: {method:'engine_newpayloadv3', params:[{version,payload }|{version,payload,versionedhashes}}...\n\nso EL verification code is something like switch(version){...} ... \n\n(removing old methods is a different issue, but this will give us a way to future extend without bumping the version)",
        "created_at": "2023-05-29T17:05:50.111000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "so CL will tell EL what data structure its sending without EL trying to infer it like it currently does by checking which fields have been send",
        "created_at": "2023-05-29T17:07:41.514000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "EL can infer it by parsing the `timestamp` field, this is what clients do today if they need to get this information",
        "created_at": "2023-05-29T17:09:56.710000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "correct, they still check if extra fields have been send and throw errors like in hive tests if withdrawals is send for v1, one is supposed to throw error ( i think), if the CL is sending a V1 version, no need to validate for extra fields (or to send them with null)",
        "created_at": "2023-05-29T17:13:11.895000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "so version instead of fork name, can be here v1,v2,v3 ...which can tell EL what fields to validate for and ignore rest",
        "created_at": "2023-05-29T17:14:51.436000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "why do we need this version to be explicitly send if EL can understand which fields are mandatory by parsing the timestamp?",
        "created_at": "2023-05-29T17:25:18.904000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "to minimize these kind of checks: https://github.com/ethereumjs/ethereumjs-monorepo/blob/master/packages/client/src/rpc/modules/engine.ts#L665:L710",
        "created_at": "2023-05-29T17:30:01.986000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "which i think are incorporated in hive tests as well afaik cc \u003c@686695036733227017\u003e",
        "created_at": "2023-05-29T17:31:07.958000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "but a client will have to check that the passed version corresponds to the hard fork (by parsing timestamp), won't it?",
        "created_at": "2023-05-29T17:33:12.146000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "yes correct, but it won't check if for e.g. withdrawals have been send or not if its v1 with the current expectation of such errors to be thrown",
        "created_at": "2023-05-29T17:34:58.802000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "cc \u003c@892053833121923094\u003e I guess",
        "created_at": "2023-05-29T17:38:30.347000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "its like a confirmation of what structure CL sends, but may be i am trying to solve for a different problem than you originally intended, \n\nbut it also solves the null problem in the sense that EL won't check for null if its for e.g. v2 payload (and yes obviously the versioned hashes move inside the propery of 0th param i.e. {version,payload,versionedHashes}, so null passing is not required as it would be {version,payload}",
        "created_at": "2023-05-29T17:38:38.826000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "a structure version sent by CL looks quite similar to me to 1-1 relationship between method and structure versions",
        "created_at": "2023-05-29T17:56:23.593000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Cross-layer",
        "parent": "",
        "content": "Recording of today's call: https://youtu.be/lZiotV3nNIU",
        "created_at": "2023-05-29T21:29:54.513000+00:00",
        "attachments": null
    }
]