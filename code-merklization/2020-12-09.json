[
    {
        "author": "mrsimicsak",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "What benefit does breaking the contract code into chunks provide over logging the bytecodes executed and taking a hash of the log as proof?",
        "created_at": "2020-12-09T01:58:50.471000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "In a stateless world, a user will need to provide all of the inputs necessary for any state transitions, which includes the code being executed.",
        "created_at": "2020-12-09T02:10:28.257000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The contract input needs to be validated against the state root, and we want to minimize the amount of data required to be supplied.",
        "created_at": "2020-12-09T02:13:17.688000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "By merklizing the code, one can submit *only* the bits that they actually need rather than having to supply the entire contract.",
        "created_at": "2020-12-09T02:13:44.614000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "For example, if you just call one function that reads a single storage variable then you don't need the whole contract, you just need a little sliver of it.",
        "created_at": "2020-12-09T02:14:03.081000+00:00",
        "attachments": null
    },
    {
        "author": "mrsimicsak",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ah, so the user needs a way to prove that the code they are submitting is actually part of the contract",
        "created_at": "2020-12-09T04:54:25.895000+00:00",
        "attachments": null
    },
    {
        "author": "mrsimicsak",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hmn, how branchy is contract code on average?",
        "created_at": "2020-12-09T05:00:26.341000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I believe code materialization doesn't try to do flow analysis.  It just does a dumb chunking.  It is believed this is \"good enough\".",
        "created_at": "2020-12-09T05:03:11.645000+00:00",
        "attachments": null
    },
    {
        "author": "mrsimicsak",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If you assume that contract code is mostly instructions that don't branch the code could be broken up into chunks that end with a branch instruction and do the merklization on those chunks",
        "created_at": "2020-12-09T05:03:43.646000+00:00",
        "attachments": null
    },
    {
        "author": "gichiba",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "flow analysis was discussed and I think (maybe?) tested a little bit by the TeamX folks, but the general sense is that it does not offer witness size reduction proportional to the additional complexity of implementation",
        "created_at": "2020-12-09T05:09:18.134000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Doing any kind of code analysis adds a lot of complexity which comes with high engineering cost and increased risk of consensus failure.",
        "created_at": "2020-12-09T05:09:47.122000+00:00",
        "attachments": null
    },
    {
        "author": "gichiba",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "diminishing returns on engineering effort",
        "created_at": "2020-12-09T05:10:04.384000+00:00",
        "attachments": null
    },
    {
        "author": "mrsimicsak",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I can definitely see how doing code analysis adds complexity and risk of consensus failure, it just seems like there should be some simple rule that works better than simple chunks. I can see how it would be one of those deceptively simple at first glance, turns out to be nearly impossible on closer examination things",
        "created_at": "2020-12-09T05:18:10.188000+00:00",
        "attachments": null
    },
    {
        "author": "mrsimicsak",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Does anybody have a link to TeamX's work? I'd be interested in seeing what approaches they looked at and what the pitfalls are",
        "created_at": "2020-12-09T05:19:49.594000+00:00",
        "attachments": null
    },
    {
        "author": "mrsimicsak",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Has there been any consideration of allowing the chunk sizes to be different contract to contract?",
        "created_at": "2020-12-09T05:27:50.904000+00:00",
        "attachments": null
    },
    {
        "author": "mrsimicsak",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "A fixed chunks seems both almost impossible to change later and something that might end up being a bottleneck later",
        "created_at": "2020-12-09T05:30:52.930000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e Hmn, how branchy is contract code on average?\n\nMy understanding is that it's pretty branchy, an average execution touches code in like 6 places",
        "created_at": "2020-12-09T06:08:11.972000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "(that's \"mental recollection of a ballpark estimate\", not statistical analysis)",
        "created_at": "2020-12-09T06:08:26.862000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This is a big part of why I've been proposing Kate commitments to code as an option alongside (or even as an outright alternative to) the Merkle branches",
        "created_at": "2020-12-09T06:08:48.042000+00:00",
        "attachments": null
    },
    {
        "author": "s1na",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This is based on a few number of mainnet blocks, so not representive, but it seems like most basic blocks (chunks ending with a branch) are fairly small. From here I see two options:\n1. Merkleize those small chunks -\u003e height of the tree and therefore proof hashes go up. This is why Horacio suggested truncating hashes when using small chunk sizes\n2. You merge those small chunks to get bigger ones (in my experiment I merged until they're at least 32 bytes) -\u003e it becomes much more similar to fix-sized chunking and the result I had (again based on 50 blocks or so) is that in this case there's not much of a difference between basic block vs fix-sized",
        "created_at": "2020-12-09T10:19:06.483000+00:00",
        "attachments": null
    },
    {
        "author": "s1na",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the write-up is here: https://ethresear.ch/t/optimal-chunking-size-for-code-merklization/8185\nthey used turbo-geth to generate data: https://github.com/ledgerwatch/turbo-geth/pull/1320/files\nand here's their analysis tool: https://github.com/ConsenSys/code_merklization_of_traces",
        "created_at": "2020-12-09T10:21:12.679000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "cc \u003c@!296630428754771968\u003e who's done at least some investigation into using Kate committments for contract code",
        "created_at": "2020-12-09T15:30:33.820000+00:00",
        "attachments": null
    }
]