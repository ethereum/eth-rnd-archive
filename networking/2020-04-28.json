[
    {
        "author": "donschoe",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Hi everyone, please convince me why ENR is a good idea. From an operational perspective, it only has downsides and wiring two nodes is more complicated than ever. I want to learn more about the design decision to adapt ENR for ETH2.",
        "created_at": "2020-04-28T09:11:34.139000+00:00",
        "attachments": []
    },
    {
        "author": "agemanning",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Is the main issue that you can't manually edit them by hand and read their default base64 encoding via eyeballing them?",
        "created_at": "2020-04-28T10:39:11.178000+00:00",
        "attachments": []
    },
    {
        "author": "agemanning",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Perhaps \u003c@194432762315407360\u003e has some strong opinions here",
        "created_at": "2020-04-28T10:39:42.762000+00:00",
        "attachments": []
    },
    {
        "author": "donschoe",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Issues:\n- ENR does not allow to see the IP/Port without 3rd party tooling\n- ENR does not allow to modify IP/Port or issue a new ENR without going through the client\n- Clients can update ENR at will which invalidates old ENR (apparently?)\n- Clients are unable to get public IP or lack of system knowledge to select proper IP",
        "created_at": "2020-04-28T10:41:53.439000+00:00",
        "attachments": []
    },
    {
        "author": "donschoe",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I've read EIP 778 but cannot seem to undersand what the strong benefit of ENR is compared to the flexible multiaddress format from the operations perspective. I understand there might be benefits from the client developer perspective. I want to learn more about that.",
        "created_at": "2020-04-28T10:43:20.322000+00:00",
        "attachments": []
    },
    {
        "author": "mpetrunic",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I was talking to cayman, we could deploy some website to decode, edit and encode enrs",
        "created_at": "2020-04-28T10:45:21.164000+00:00",
        "attachments": []
    },
    {
        "author": "mpetrunic",
        "category": "Consensus Layer",
        "parent": "",
        "content": "cc \u003c@!534934855113506836\u003e ^^",
        "created_at": "2020-04-28T10:45:34.456000+00:00",
        "attachments": []
    },
    {
        "author": "donschoe",
        "category": "Consensus Layer",
        "parent": "",
        "content": "\u003e I was talking to cayman, we could deploy some website to decode, edit and encode enrs\n\u003c@!545555441518772225\u003e that a nice idea, but it does not address the underlying issue. I want to understand _why_ ENR in first place.",
        "created_at": "2020-04-28T10:46:14.491000+00:00",
        "attachments": []
    },
    {
        "author": "donschoe",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Also, can you easily edit an ENR? Doesn't that involve key management and signing?",
        "created_at": "2020-04-28T10:46:28.442000+00:00",
        "attachments": []
    },
    {
        "author": "agemanning",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Sure. I won't waste your time with my opinions here. I'm sure \u003c@194432762315407360\u003e has thought about all of these in greater detail than myself. A few comments however:\n1 - We could print the ENR like an ennode id if we wanted, (Everytime lighthouse prints an ENR we show the IP/PORT) but we could standardise this\n2 - This is true. We can't just edit it, because they are signed. We need the key to edit, so a generic website wont be able to modify unless we have the key that generated it\n3 - ENR's have a seq no, clients can keep the seq number if they want. If they increase it, then it signifies the enr has changed and the discv5 protocol knows to fetch an updated ENR. \n4 - This seems independent of the ENR. The ENR just stores IP/PORT and signs it... clients can use arbitrary technologies to discover their external IPs and update their ENRs. \n\nI'll leave the \"why\" question to \u003c@!194432762315407360\u003e",
        "created_at": "2020-04-28T10:47:54.705000+00:00",
        "attachments": []
    },
    {
        "author": "mpetrunic",
        "category": "Consensus Layer",
        "parent": "",
        "content": "\u003e Also, can you easily edit an ENR? Doesn't that involve key management and signing?\n\u003c@!557201004060213248\u003e Yeah but you can provide key if you wan't to change your enr to include public IP. I know it's not really safe, but it's cool until clients have better way to determine their public ip. But decoding on it's own should be useful as first step",
        "created_at": "2020-04-28T10:53:19.343000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Consensus Layer",
        "parent": "",
        "content": "\u003c@!557201004060213248\u003e both my ZCLI and Rumor tools have commands to view ENR contents for debugging",
        "created_at": "2020-04-28T10:54:36.139000+00:00",
        "attachments": []
    },
    {
        "author": "nishant0",
        "category": "Consensus Layer",
        "parent": "",
        "content": "\u003e 1 - We could print the ENR like an ennode id if we wanted, (Everytime lighthouse prints an ENR we show the IP/PORT) but we could standardise this\nI think doing this will take a way a lot of the pain of trying to decode enrs",
        "created_at": "2020-04-28T10:55:51.373000+00:00",
        "attachments": []
    },
    {
        "author": "donschoe",
        "category": "Consensus Layer",
        "parent": "",
        "content": "\u003e \u003c@!557201004060213248\u003e both my ZCLI and Rumor tools have commands to view ENR contents for debugging\n\u003c@!203220829473996800\u003e Yes, I use the rust `enr-cli` but as I said, I still need a 3rd tool to verify my bootnode ENR to then just find out it's wrong and then being unable to change the IP easily.",
        "created_at": "2020-04-28T11:00:29.968000+00:00",
        "attachments": []
    },
    {
        "author": "donschoe",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Having a multiaddress, I can just swap out the IP in my records",
        "created_at": "2020-04-28T11:00:51.306000+00:00",
        "attachments": []
    },
    {
        "author": "donschoe",
        "category": "Consensus Layer",
        "parent": "",
        "content": "So the problem is not only decoding but also encoding.",
        "created_at": "2020-04-28T11:01:07.992000+00:00",
        "attachments": []
    },
    {
        "author": "donschoe",
        "category": "Consensus Layer",
        "parent": "",
        "content": "So, wondering why we decided to use ENR in first place. There must be something üòâ",
        "created_at": "2020-04-28T11:01:45.038000+00:00",
        "attachments": []
    },
    {
        "author": "agemanning",
        "category": "Consensus Layer",
        "parent": "",
        "content": "So ENR is not eth2 specific. ENR are required by the discv5 protocol. So we require them for peer discovery. When connected to a new peer we need it's ENR so it can participate discv5. There is a short FAQ which I'm sure you've read: https://github.com/ethereum/eth2.0-specs/blob/dev/specs/phase0/p2p-interface.md#what-is-the-difference-between-an-enr-and-a-multiaddr-and-why-are-we-using-enrs\n\nI think your question is fundamentally why discv5 is using ENR's. I think there may be some history there with maybe some issues in previous discoveries in eth 1. \u003c@!194432762315407360\u003e will know best here. It seems sensible to me that having a signed record for peer identification could prevent various attacks, maybe sybil if the peer_ids are hard to achieve (I think \u003c@194432762315407360\u003e was looking into doing proof of work here).",
        "created_at": "2020-04-28T11:13:42.232000+00:00",
        "attachments": []
    },
    {
        "author": "agemanning",
        "category": "Consensus Layer",
        "parent": "",
        "content": "There is some relevant information here: https://github.com/ethereum/devp2p/blob/master/discv5/discv5-rationale.md",
        "created_at": "2020-04-28T11:16:17.919000+00:00",
        "attachments": []
    },
    {
        "author": "agemanning",
        "category": "Consensus Layer",
        "parent": "",
        "content": "\" Signing records prevents any intermediary node from changing the content of a record. Any node's information is either available in the exact form it was published or not at all.  \"",
        "created_at": "2020-04-28T11:17:56.692000+00:00",
        "attachments": []
    },
    {
        "author": "donschoe",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Thanks, I'll dig through the discv5 rationale",
        "created_at": "2020-04-28T11:28:56.565000+00:00",
        "attachments": []
    },
    {
        "author": "m.kalinin",
        "category": "Consensus Layer",
        "parent": "",
        "content": "\u003c@!557201004060213248\u003e ENRs allows for distinguishing nodes by their capabilities during discovery state, without connecting and requesting the info about subprotocols that we used to have in Eth1. At the current design stage (until topic discovery is in production) ENRs are used by network participants to indicate the subnet they have joined to. These subnets are mostly synthetic atm and are used for attestation aggregation. Since Phase 1 these subnets will distinguish subnets on a shard basis, persistent committee (block producers) of particular shard will have to join to the subnet and update its ENRs to indicate that they are capable of serving data for particular shard.\n\nWhat you're saying looks more like tooling issue rather than the issue with ENR itself. In Eth1 you're able to update TCP port, for example, and it has to be signed by the private key by discovery service, right? How big does it differ from ENRs signature and its seq number? Probably, we need better tooling here?",
        "created_at": "2020-04-28T11:55:47.676000+00:00",
        "attachments": []
    },
    {
        "author": "m.kalinin",
        "category": "Consensus Layer",
        "parent": "",
        "content": "IIRC, IP:PORT pair is tightly coupled with NodeId in Eth1 clients for the sake of DoS protection. We might want to do the same in Eth2 which would restrict updates of IP address in ENR.",
        "created_at": "2020-04-28T12:00:15.642000+00:00",
        "attachments": []
    },
    {
        "author": "donschoe",
        "category": "Consensus Layer",
        "parent": "",
        "content": "\u003e What you're saying looks more like tooling issue rather than the issue with ENR itself. In Eth1 you're able to update TCP port, for example, and it has to be signed by the private key by discovery service, right? How big does it differ from ENRs signature and its seq number? Probably, we need better tooling here?\nSo, ideally, I don't even want to deal with ENR. From what I read this should be something internally not even visble to the end users and node operators.",
        "created_at": "2020-04-28T12:07:16.970000+00:00",
        "attachments": []
    },
    {
        "author": "donschoe",
        "category": "Consensus Layer",
        "parent": "",
        "content": "\u003e IIRC, IP:PORT pair is tightly coupled with NodeId in Eth1 clients for the sake of DoS protection. We might want to do the same in Eth2 which would restrict updates of IP address in ENR.\nYes please üôè",
        "created_at": "2020-04-28T12:07:30.834000+00:00",
        "attachments": []
    },
    {
        "author": "donschoe",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Or, to put it nicely: As a node operator, I want to be able to connect to a node using their public key, ip, and port.",
        "created_at": "2020-04-28T12:07:57.254000+00:00",
        "attachments": []
    },
    {
        "author": "donschoe",
        "category": "Consensus Layer",
        "parent": "",
        "content": "üë®‚Äçüíª",
        "created_at": "2020-04-28T12:08:23.568000+00:00",
        "attachments": []
    },
    {
        "author": "m.kalinin",
        "category": "Consensus Layer",
        "parent": "",
        "content": "It sounds like pretty reasonable feature request. It probably worth to file an issue.",
        "created_at": "2020-04-28T12:16:34.136000+00:00",
        "attachments": []
    },
    {
        "author": "donschoe",
        "category": "Consensus Layer",
        "parent": "",
        "content": "ok",
        "created_at": "2020-04-28T12:32:18.166000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Consensus Layer",
        "parent": "",
        "content": "just saw this discussion now",
        "created_at": "2020-04-28T19:09:15.447000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I think all the questions have already been answered here",
        "created_at": "2020-04-28T19:09:35.905000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Consensus Layer",
        "parent": "",
        "content": "It's true, you cannot edit ENRs, or just type them in",
        "created_at": "2020-04-28T19:10:22.938000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Consensus Layer",
        "parent": "",
        "content": "They're not meant for that",
        "created_at": "2020-04-28T19:10:30.475000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Multiaddr and ENR are not directly comparable because they solve different problems",
        "created_at": "2020-04-28T19:11:39.125000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Consensus Layer",
        "parent": "",
        "content": "ENR is a metadata container format. It's useful to have this format because it gives you all info you could ever need to make a connectivity decision.",
        "created_at": "2020-04-28T19:12:43.204000+00:00",
        "attachments": []
    },
    {
        "author": "jonny.derp",
        "category": "Consensus Layer",
        "parent": "",
        "content": "From the rationale portion of the networking spec.  \n\n```\nWe assume that Eth 1.0 nodes will evolve to support discv5. By sharing the discovery network between Eth 1.0 and 2.0, we benefit from the additive effect on network size that enhances resilience and resistance against certain attacks, to which smaller networks are more vulnerable. It should also help light clients of both networks find nodes with specific capabilities.\n```\nDo we foresee any issues sharing a node table between eth1, eth2 and all the testnets?  My understanding was that topic discovery will not be ready for phase 0 and it seems like this could significantly slow down the search for peers within specific attestation subnets.",
        "created_at": "2020-04-28T20:27:45.018000+00:00",
        "attachments": []
    }
]