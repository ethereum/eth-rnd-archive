[
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "One thing that I thought about today is that we need to have the previous blocks full inclusion lists full transactions when we build our block, so basically at the fcu payload parameters. Should we cache it from the other methods or explicitly add them to fcu?",
        "created_at": "2024-03-20T10:12:22.152000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "We'll include the nonces, you can check against the state directly",
        "created_at": "2024-03-20T10:13:34.811000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "No to build the block",
        "created_at": "2024-03-20T10:16:41.930000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "Not to verify it",
        "created_at": "2024-03-20T10:16:42.353000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "We need the full transactions in our miner",
        "created_at": "2024-03-20T10:17:07.996000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "You need the full transactions in the IL, I don't see why you need the ones from the previous block",
        "created_at": "2024-03-20T10:20:17.623000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Ah sorry this is exactly what you said (still sleepy) yeah you need to keep a few ILs",
        "created_at": "2024-03-20T10:21:12.042000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "It's better if the EL caches them instead of sending them from FCU, the reason is to let the builder decide which summary to include, not change the builder spec and not transfer back and forth those full transactions over RPC just to build the block",
        "created_at": "2024-03-20T10:22:31.502000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "To be fully safe the EL should probably cache all unfinalized ILs txs",
        "created_at": "2024-03-20T10:23:24.797000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e ya so it seems the first call to engine_newInclusionListV1 should cache (on the EL side) the IL transactions needed to build a valid block",
        "created_at": "2024-03-20T12:40:41.231000+00:00",
        "attachments": [
            {
                "type": "image/jpeg",
                "origin_name": "file_17.jpg",
                "content": "32328f1a423d694d078660843387a498a028021adbf6724736051c3cfc6026e6"
            }
        ]
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e then when `engine_newPayloadV3` is called, the IL transactions can be checked, the then when self building the block the remaining txns inserted",
        "created_at": "2024-03-20T12:42:29.410000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "To be more specific, you need to keep a `map[Hash32]InclusionList`  where you key by parent `BlockHash` and the target is the full IL since you need to keep the signed summary to include in the payload along with the full txs.",
        "created_at": "2024-03-20T12:44:43.431000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "This map can be pruned on finalization",
        "created_at": "2024-03-20T12:44:51.487000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e lgtm!",
        "created_at": "2024-03-20T12:45:57.525000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "I wrote down some high-level changes to support blob transactions within the existing inclusion list design (EIP-7457). I might have overlooked something crucial, so feedback is appreciated: https://hackmd.io/@ttsao/ryzAw9PRa.\n\n**This is not part of PoC, nor spec**. I'm just interested to understand how difficult it would be to support blob tx for inclusion list",
        "created_at": "2024-03-20T14:20:00.943000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "So it's a mem leak until finalization ðŸ™ˆ",
        "created_at": "2024-03-20T14:49:20.291000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "Not a big fan of caching the inclusion list. Imo the cl should have it and store it and pass it when it wants to build a block",
        "created_at": "2024-03-20T14:50:23.656000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "You can always forget them just one slot after",
        "created_at": "2024-03-20T14:50:52.984000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "And reconstruct them from the imported blocks",
        "created_at": "2024-03-20T14:51:01.382000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "That should be trivial to do",
        "created_at": "2024-03-20T14:51:06.524000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "Wdym? What happens on reorgs?",
        "created_at": "2024-03-20T14:51:47.498000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "So whenever you import a block N based on M for any N \u003e M then you can always reconstruct the full IL for M from N and the txs in M",
        "created_at": "2024-03-20T14:53:27.780000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "Ah you mean for full sync? Yeah sure, but I can't reconstruct it for N when building on top of N",
        "created_at": "2024-03-20T14:55:22.648000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "It's about block building when you don't have the transactions, not block import",
        "created_at": "2024-03-20T14:55:52.493000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I am pointing that you can't be in this situation",
        "created_at": "2024-03-20T14:56:36.488000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Let's go case by case",
        "created_at": "2024-03-20T14:56:42.988000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "happy case: you get block N with an IL for N, then N+1 based on N with an IL for N+1 and you are requested N+2 based on N+1, you have the IL for N+1 still so you just build. \n- Reorg case",
        "created_at": "2024-03-20T14:57:36.644000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "you get block N with an IL for N, then get N+1 based on N with an IL for N+1 (and you forget the IL for N) then you are requested to reorg N+1 and build N+2 on top of N. In this situation you still have the block N+1 and the block N, from these blocks you can completely reconstruct the full IL for N and you can build on top of it",
        "created_at": "2024-03-20T14:58:44.611000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "Uff so our reorg procedure needs to reorg and spit out the inclusion lists for all the reorged blocks?",
        "created_at": "2024-03-20T15:08:22.964000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "if you forget them ~~yes~~ (no, see below)",
        "created_at": "2024-03-20T15:08:42.892000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "Why is this easier than just sending them again on fcu with the block parameters?",
        "created_at": "2024-03-20T15:08:55.234000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "If CL wants a block build on top of N, they need to have the IL for N available anyway",
        "created_at": "2024-03-20T15:09:32.674000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "perhaps it can be made optional?  changing unconditionally all the builder spec and passing around twice the IL opens a can of worms",
        "created_at": "2024-03-20T15:09:56.970000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The CL doesnÂ´t even store the IL",
        "created_at": "2024-03-20T15:10:10.352000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "the CL only passes them to the EL and doesn't store anything",
        "created_at": "2024-03-20T15:10:19.342000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "if the happy case involves 3 roundtrips with the full list of transactions on the IL that would be a lot of unnecessary traffic",
        "created_at": "2024-03-20T15:10:54.748000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "But also your statement above is not true:",
        "created_at": "2024-03-20T15:11:17.040000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "to build on top of  N you only need N and any direct child of it",
        "created_at": "2024-03-20T15:11:39.607000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "you do not need the full list of blocks you are reorging to reconstruct the full IL",
        "created_at": "2024-03-20T15:11:52.406000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e updated the ACDC agenda issue with this comment: https://github.com/ethereum/pm/issues/987#issuecomment-2009970451\n\nlmk if i missed anything!",
        "created_at": "2024-03-20T16:18:18.817000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "Did we already limit inclusion lists to 1 tx per address? If not, we need to",
        "created_at": "2024-03-20T18:42:48.423000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e do we with the nonce commitment though ? (re @InclusionList_bot: \u003cmariusvanderwijden\u003e Did we already limit inclusion lists to 1 tx per address? If not, we need to)",
        "created_at": "2024-03-20T18:52:16.487000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e need to limit to one addr, nonce pair",
        "created_at": "2024-03-20T18:52:28.513000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cgr3999\u003e tomorrow onwards I target integration with geth and see whats what ðŸ˜„ðŸ˜…",
        "created_at": "2024-03-20T18:55:57.580000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "why is that?, the IL is ordered",
        "created_at": "2024-03-20T18:56:59.069000+00:00",
        "attachments": null
    }
]