[
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e absolutely!",
        "created_at": "2024-03-22T00:00:49.025000+00:00",
        "attachments": []
    },
    {
        "author": "lightclient",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think the issue is a bit more complicated because we're actually abstracting the validity conditions of a transaction. An account could say that if they account balance increases beyond a certain level, txs from the account are invalid. Or maybe on odd blocks, the tx is invalid. EIP-2938 and (afaik) 4337 gets around this by having tx pool validation rules, but the core protocol rules end up being very simple (if the arbitrary validation phase passes, allow tx to continue to execute, spending the senders balance). \n\nTo confidently say in the protocol, we'd need to run the validation both at block N to know the IL was validly constructed with a tx which could be included in N and in the block N+1 the transaction was no longer valid. I don't think that is a huge lift, but I don't think we should enshrine behavior around the balance",
        "created_at": "2024-03-22T12:39:31.545000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Thank you for this, this was my worry and hunch, it seems to me that these issues become a bit of a headache with regards to the current design of ILs",
        "created_at": "2024-03-22T13:13:30.259000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "IMO this mostly becomes a political discussion on whether we should ship ILs as-is and constrain the future AA design space or later adapt ILs if necessary, or to first solve for the most abstract of designs of AA. I don't want to get into that discussion, but \u003c@415548822983278593\u003e already left his oppinion on the matter during the call.",
        "created_at": "2024-03-22T13:15:41.110000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e right. i dmed Yoav for his perspective too!",
        "created_at": "2024-03-22T13:17:32.900000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Been thinking about this and I don't like any filtering option in forkchoice: pruning the nodes without an IL may end up with your head reversing ffg, I am starting to think that the only fully formal method may be reconstructing the IL from the EL. This itself may not be possible to do in a full AA compatible way",
        "created_at": "2024-03-22T13:58:39.698000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e yup, been thinking on it too and i think i agree. one idea (from vitalik):\n\nthe initial version of ILs commits to nonce and balance, thus compatible with baseline aa features of ‚Äúauthorized sending‚Äù. thus the il commits to \n- addr\n- nonce\n- balance\n\nand an entry is valid of \n- nonce is geq summary nonce\n- balance \u003c summary balance\n\nthe more ‚Äúexotic‚Äù AA features (that we aren‚Äôt sure will be enshrined) could be inelligible for IL inclusion (e.g., they have less strong CR guarantees). personally this seems reasonable to me, given we are uncertain about timeline for 4337 enshrinement.",
        "created_at": "2024-03-22T14:08:37.886000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "But this has nothing to do with the issue I'm referring to ü§£",
        "created_at": "2024-03-22T14:14:30.028000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e hehe sorry, i was fully convinced i had caught up to you xD",
        "created_at": "2024-03-22T14:15:48.638000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e you are talking about reconstructing the IL ?",
        "created_at": "2024-03-22T14:15:59.738000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e @fradamt and i were discussing this",
        "created_at": "2024-03-22T14:16:08.603000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e / fork choice filtering generally. \n\nwhat if you didn‚Äôt care about validating/reconstructing the IL except for at the leaf node you are considering for the head ?",
        "created_at": "2024-03-22T14:23:22.049000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "You need to reconstruct the IL for whatever node is your head, this is doable in the current design, not so in an AA compatible way",
        "created_at": "2024-03-22T14:25:19.478000+00:00",
        "attachments": []
    },
    {
        "author": "smartprogrammer",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@750824368438771842\u003e i was thinking about inclusion lists and was wondering if we have thought about blob transactions. Can blob transactions included in inclusion lists (my assumption is yes given nothing prevents it from the spec)? And how can they affect the size of data being transfered on p2p network?",
        "created_at": "2024-03-22T14:46:35.088000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e hi Ahmad! in the PoC, we haven‚Äôt been considering them (would be a check that no type 0x03 transactions are in the list). terence wrote up a small doc considering this (beyond the scope of the EIP): https://hackmd.io/@ttsao/ryzAw9PRa",
        "created_at": "2024-03-22T14:48:17.735000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e which kinda fits with my overall feeling for ILs (and relates nicely to the AA discussion). 7547 feels like a first step. a really good first step that (i) is useful, (ii) helps collect data, (iii) paves the way for the endgame of CR. additional features to: support blobs, work with all types of endgame AA functionality, add committee-based enforcement, can and should be added.",
        "created_at": "2024-03-22T14:51:37.265000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e but we cannot do it all in one swing IMO. ICYMI, basically the argument presented here: https://notes.ethereum.org/@mikeneuder/the-case-for-ilectra",
        "created_at": "2024-03-22T14:52:48.944000+00:00",
        "attachments": []
    },
    {
        "author": "0xevan",
        "category": "Cross-layer",
        "parent": "",
        "content": "where do these bridge-bot messages come from?",
        "created_at": "2024-03-22T17:08:40.847000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e ahh it seems I can't include you nor can I create a link, it's a TG channel, but anyway TG sucks compared to Discord in which everyone has visibility (re @InclusionList_bot: \u003c0xevan\u003e [reply]: where do these bridge-bot messages come from?)",
        "created_at": "2024-03-22T17:10:27.765000+00:00",
        "attachments": []
    },
    {
        "author": "0xevan",
        "category": "Cross-layer",
        "parent": "",
        "content": "ah, sad. I guess I will just participate from discord then üòÜ",
        "created_at": "2024-03-22T17:12:59.056000+00:00",
        "attachments": []
    },
    {
        "author": "0xevan",
        "category": "Cross-layer",
        "parent": "",
        "content": "for an IL endgame, is there a max size that an IL can grow to? E.g. start at a 3m gas limit, but end at a 100% of block (e.g. 30m/40m gas limit + blob gas limit )? Is the endgame goal to end up with an IL that is 100% encompassing? Or too early to say",
        "created_at": "2024-03-22T18:04:29.725000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e that would be my ideal! i really like the idea of the IL being essentially the ‚Äútemplate block‚Äù constructed by the proposer. the builder can arbitrarily reorder and insert, but must include the set of txn specified in the IL. this has the benefit of also making the default IL production path equivalent to the default local block building path (e.g., greedily build max size block based on highest tipping txns)",
        "created_at": "2024-03-22T18:06:56.675000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e but def early to say! i think part of why ILs in electra make sense is that the version we settled on seems fully upgradable to all these endgame gadgets (re @InclusionList_bot: \u003c0xevan\u003e [reply]: for an IL endgame, is there a max size that an IL can grow to? E.g. start at a 3m gas limit, but end at a 100% of block (e.g. 30m/40m gas limit + blob gas limit )? Is the endgame goal to end up with an IL that is 100% encompassing? Or too early to say)",
        "created_at": "2024-03-22T18:11:03.197000+00:00",
        "attachments": []
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e so getting it in derisks future upgrades, allows us to get real prod data, and is a credible commitment to preserving the neutrality of ethereum blockspace!",
        "created_at": "2024-03-22T18:11:43.765000+00:00",
        "attachments": []
    },
    {
        "author": "realbigsean",
        "category": "Cross-layer",
        "parent": "",
        "content": "does this work? https://github.com/ethereum/consensus-specs/pull/3617/commits/37ca0c9ce610c329498a3d17359357d0f4ed309c#r1536270643",
        "created_at": "2024-03-22T22:11:37.398000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Added a reply, I think it's just the same as the situation where we don't have an IL for the last block and the incoming block (the child) does have one. We still shouldn't consider the parent for head. Without guarantees of IL reconstruction",
        "created_at": "2024-03-22T22:20:09.651000+00:00",
        "attachments": []
    },
    {
        "author": "realbigsean",
        "category": "Cross-layer",
        "parent": "",
        "content": "the child would validate the parent,  no? the child should have the summary or the prior block?",
        "created_at": "2024-03-22T22:23:35.623000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "yes, and the fact that the child is valid guarantees that the IL for the parent is available, however, you still don't have it, so if you need to reorg to the parent, you need to reconstruct it to propose",
        "created_at": "2024-03-22T22:26:11.116000+00:00",
        "attachments": []
    },
    {
        "author": "terence0083",
        "category": "Cross-layer",
        "parent": "",
        "content": "Do we need an IL rpc request over p2p? Like what happens if we get a block and it has sufficient weight \u003e70% at 4.5s. Attempting to reorg that might be a hard",
        "created_at": "2024-03-22T22:31:13.861000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "We need that anyway, but you can't rely on that on `get_head`",
        "created_at": "2024-03-22T22:32:20.002000+00:00",
        "attachments": []
    },
    {
        "author": "realbigsean",
        "category": "Cross-layer",
        "parent": "",
        "content": "I see.. but is this really an issue? if you haven't seen *any*¬†IL for that slot you miss your proposal. it'd be the same as not seeing a parent block when the rest of the network has",
        "created_at": "2024-03-22T22:33:02.781000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I agree this is mostly theoretical, however it's a formal statement about forkchoice and we've learned what it does to have holes in it. It is not the same as not seeing a block though: in the latter case you don't even include the children in forkchoice. This was the easiest option to design: you don't include the block in forkchoice if you haven't seen an IL, but this leads to split views",
        "created_at": "2024-03-22T22:34:42.750000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Given the **current** status of affairs the easiest way out is to have an API call that requests the EL to reconstruct the IL, but this is 1) not nice at all and 2) constrains AA and it may become impossible to fulfil.",
        "created_at": "2024-03-22T22:35:46.339000+00:00",
        "attachments": []
    },
    {
        "author": "realbigsean",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003e  it's a formal statement about forkchoice and we've learned what it does to have holes in it\ngood point üòÇ",
        "created_at": "2024-03-22T22:37:20.833000+00:00",
        "attachments": []
    },
    {
        "author": "realbigsean",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003e This was the easiest option to design: you don't include the block in forkchoice if you haven't seen an IL, but this leads to split views\nYea I don't think this works",
        "created_at": "2024-03-22T22:38:30.645000+00:00",
        "attachments": []
    },
    {
        "author": "realbigsean",
        "category": "Cross-layer",
        "parent": "",
        "content": "So, I'm still thinking this isn't a fork choice issue though.. fork choice remains correct and consistent across attestations and proposals. `get_head` returns the right thing, the fact that you can't construct the block on top of this head seems like a separate issue. You could get the IL via RPC as \u003c@363800010518822915\u003e suggested, or via engine API if possible, or download it from another beacon's HTTP API or whatever, the point is the data exists.¬†You probably couldn't do these in time to propose but I'm not sure having this complete in time for proposal should be a requirement.",
        "created_at": "2024-03-22T23:09:28.420000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think head should always be a block you're able to locally attest for and propose on top of it",
        "created_at": "2024-03-22T23:10:42.864000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Requesting it by RPC is something that you would have already done",
        "created_at": "2024-03-22T23:11:06.882000+00:00",
        "attachments": []
    },
    {
        "author": "realbigsean",
        "category": "Cross-layer",
        "parent": "",
        "content": "you can attest to it though, right? cause you've seen a parent?",
        "created_at": "2024-03-22T23:11:08.338000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "By the time you're hit by this issue the RPC call either failed or not",
        "created_at": "2024-03-22T23:11:24.087000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "no you can't attest for these blocks",
        "created_at": "2024-03-22T23:12:10.872000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "and the issue with proposals is not entirely trivial",
        "created_at": "2024-03-22T23:12:20.246000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "because the proposer of N can never broadcast the IL if he wants",
        "created_at": "2024-03-22T23:12:32.264000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "and just send it to the builder of N+1",
        "created_at": "2024-03-22T23:12:37.572000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "so even if you request it by RPC you will not have the IL for N",
        "created_at": "2024-03-22T23:12:48.596000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "therefore you should not consider N for head under any circumstances unless you reconstruct the IL",
        "created_at": "2024-03-22T23:13:07.431000+00:00",
        "attachments": []
    },
    {
        "author": "realbigsean",
        "category": "Cross-layer",
        "parent": "",
        "content": "right..¬†I was thinking this would be resolved by the weight of other attesters. But this essentially boils down to lazy attesting  ü§î",
        "created_at": "2024-03-22T23:18:41.101000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Oh no, in the example above, the block N will have zero attestations for it, but it's colluding with N+1 that builds on top of it anyway",
        "created_at": "2024-03-22T23:23:19.282000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "you cannot recover the IL at all from peers, but you know it's available cause N+1 passes validation. You could reorg both blocks if you want",
        "created_at": "2024-03-22T23:23:58.328000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "but only if N+1 is late",
        "created_at": "2024-03-22T23:24:15.228000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "and somehow that's the key of the matter: in the situation above, if N+1 is late, honest validators should vote for N-1 and not N",
        "created_at": "2024-03-22T23:25:19.623000+00:00",
        "attachments": []
    },
    {
        "author": "realbigsean",
        "category": "Cross-layer",
        "parent": "",
        "content": "right",
        "created_at": "2024-03-22T23:27:40.728000+00:00",
        "attachments": []
    },
    {
        "author": "realbigsean",
        "category": "Cross-layer",
        "parent": "",
        "content": "Huh this is making me think ‚Äúthe time at which it was available to you‚Äù matters.. so my suggestion was to determine this at block import to fork choice but maybe it should be before the attestation deadline of the block‚Äôs slot",
        "created_at": "2024-03-22T23:33:43.264000+00:00",
        "attachments": []
    },
    {
        "author": "realbigsean",
        "category": "Cross-layer",
        "parent": "",
        "content": "So at block import you‚Äôd have to check you were prior to the attestation deadline to give the block a ‚Äútrue‚Äù IL availability bool",
        "created_at": "2024-03-22T23:35:06.542000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Nah, the thing I like the most about decoupling this is that you don't need to do any synchronization: you just have to completely independent handlers in forkchoice `on_block` takes care of checking for block validity. `on_inclusion_list` takes care of inclusion list validity and availability. When your VC calls you to give you a proposal or an attestation your forkchoice should choose head based on a block that is both valid and has an available IL",
        "created_at": "2024-03-22T23:50:47.459000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "that's it",
        "created_at": "2024-03-22T23:50:49.420000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "no synchronization required for the two independent checks",
        "created_at": "2024-03-22T23:51:07.538000+00:00",
        "attachments": []
    }
]