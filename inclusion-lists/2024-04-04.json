[
    {
        "author": "pawandhananjay",
        "category": "Cross-layer",
        "parent": "",
        "content": "sorry I was away for the past couple days moving. \nFrom reading the chat, my feeling also is that we need more time to think about potential edge cases that account abstraction introduces. \nAlso going to start looking into ePBS as it seems to solve both ILs and improve relay related issues that we are seeing on mainnet \nbtw thanks a lot \u003c@755590043632140352\u003e for the post explaining the fork choice issue, it was super helpful!",
        "created_at": "2024-04-04T02:21:51.316000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "won't be able to be at the breakout tomorrow, probably, though I also see some discussion of whether people want ILs separately from ePBS. I'm okay either way (yes or no), conditioned on the other aspects already discussed. But I'm absolutely in favor of ePBS, and my preference is to adopt them rather together",
        "created_at": "2024-04-04T10:00:09.069000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "Could someone walk me through how ePBS solves ILs? I want to understand if the claim is that ePBS solves issues that may be blocking ILs, or if ePBS is viewed as a replacement of ILs, which I don't think it should",
        "created_at": "2024-04-04T10:55:16.310000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I am working as promised on a fully self contained design but the forkchoice issue is solved by (block, slot) voting without affecting head split views. Writing the full contained spec with the design notes is taking more than expected.",
        "created_at": "2024-04-04T11:02:08.956000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e it doesnâ€™t fix the 3074 interaction",
        "created_at": "2024-04-04T12:52:25.909000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "3074 has two problems: it generates a problem in forkchoice by not allowing to rebuild the IL, and it has the validation problem when one receives an IL. The validation problem I agree that one has to resort to methods like keeping the addresses with balance changes, or fallback to reading the balances from the state, or whatever is done for 7457, it must also be done for ePBS. The forkchoice issue is the most important one as it otherwise makes us go backwards months in considerations and bundle everything back together or start dealing with head split views again.",
        "created_at": "2024-04-04T12:55:12.277000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "What ePBS does is makes the forkchoice problem irrelevant: the CL block will be included regardless, and validators will vote for the previous head",
        "created_at": "2024-04-04T12:55:52.797000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@360491619402776577\u003e \u003c@122421399213047814\u003e are you around for a quick back-forth by any chance?",
        "created_at": "2024-04-04T19:39:28.652000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "Nope, its past bedtime ;)",
        "created_at": "2024-04-04T19:40:20.399000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "lol, where are you",
        "created_at": "2024-04-04T19:40:29.178000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "berlin time",
        "created_at": "2024-04-04T19:40:34.619000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "ahh crap it's already that late here too!",
        "created_at": "2024-04-04T19:40:44.038000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "well, I'll ping you tomorrow, will specify this my way then ðŸ˜„",
        "created_at": "2024-04-04T19:40:58.564000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Cross-layer",
        "parent": "",
        "content": "im in EST, but also free tomorrow!",
        "created_at": "2024-04-04T19:42:18.383000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "EST means you're still in working hours?",
        "created_at": "2024-04-04T19:42:34.941000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Cross-layer",
        "parent": "",
        "content": "yep",
        "created_at": "2024-04-04T19:42:39.002000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Ah great so here's a question for you",
        "created_at": "2024-04-04T19:42:46.501000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The issue is about how to send FCU when you are \"building\" rather than proposiing",
        "created_at": "2024-04-04T19:43:24.136000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The proposer sends FCU with payload attributes and in MEV Boost these actually get across the internet to the builder",
        "created_at": "2024-04-04T19:44:08.992000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "so we were skeptical of sending the full inclusion list to the builder in the payload attributes",
        "created_at": "2024-04-04T19:44:31.885000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "now on ePBS the proposer will never send an FCU with payload attributes unless it wants to self-build. The builder will have to send that FCU with payload attributes. The question is, would the EL prefer to have control of the IL or will it rather have the CL deciding these things and requesting. I see two ways of working here: \n\n- The CL receives an IL over the wire, passes it to the EL and the EL validates it and stores it however it wants",
        "created_at": "2024-04-04T19:46:01.801000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Then when the CL sends an FCU it only needs to inform \"Use an IL from this proposer index and this parent hash\"",
        "created_at": "2024-04-04T19:46:26.174000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The other way would be that the CL stores the full IL and then passes it entirely again when they request a block in the payload attributes",
        "created_at": "2024-04-04T19:46:48.690000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Which way is better for the EL?",
        "created_at": "2024-04-04T19:47:05.860000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I have the first one specified already, but I now realized that the second one becomes an option in ePBS",
        "created_at": "2024-04-04T19:47:53.361000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Cross-layer",
        "parent": "",
        "content": "just to make sure im clear on the difference:\n1. EL stores (proposer index, parent hash) -\u003e IL, this is populated from engine calls I assume?\n  * this is a full IL? or summary\n  * payload building FCU contains (proposer index, parent hash)\n2. CL stores\n  * IL contains full txs?\n  * EL would not have this mapping and would just build around the IL",
        "created_at": "2024-04-04T19:56:32.906000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "So on 1) is exactly like this, engine call and it's the full IL. For 2)  yes, the CL would have to store everything  and then pass it twice to the EL, first for validation and then again to request a block proposal because if the EL did not store the EL the EL will have to receive it again over the engine API. This is why I favour 1, but this forces you to store the map (proposer_index, parent_hash) --\u003e IL",
        "created_at": "2024-04-04T19:58:44.505000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Currently my engine API for FCU adds these two parameters to the payload attributes the proposer index and the parent hash",
        "created_at": "2024-04-04T19:59:20.969000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Cross-layer",
        "parent": "",
        "content": "hmmm, well the current engine fcu spec basically says you have to build on top of the `headBlockHash`, not sure what you would do if the head block hash and parent hash are different",
        "created_at": "2024-04-04T20:04:08.260000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Cross-layer",
        "parent": "",
        "content": "and of course the second option is simpler for the EL, you don't have to prune the map",
        "created_at": "2024-04-04T20:05:00.487000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Cross-layer",
        "parent": "",
        "content": "because there is no map",
        "created_at": "2024-04-04T20:05:07.965000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "these two are required to be the same I am not adding an extra parameter repeated, I was not clear above",
        "created_at": "2024-04-04T20:05:20.016000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Cross-layer",
        "parent": "",
        "content": "ah ok, makes sense",
        "created_at": "2024-04-04T20:05:27.868000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "but just to be clear: you need still to build on top of the parent hash, but the `inclusion_list_parent_hash` is a different one, it is the parent of your `head_block_hash`",
        "created_at": "2024-04-04T20:07:41.862000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Cross-layer",
        "parent": "",
        "content": "hmmm, option 2 does seem simpler on the EL side, either option seems basically the same w.r.t. how the payload building routine is done internally",
        "created_at": "2024-04-04T20:11:36.902000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yeah the main question is about sending or not a possibly large list over the wire and doing it twice",
        "created_at": "2024-04-04T20:12:31.562000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Cross-layer",
        "parent": "",
        "content": "I'm thinking it can't be any worse than a big newPayload json which seems fine, but ofc the first option is more efficient, assuming this is all in memory. I still lean towards option no 2 because pruning seems like a pain to implement, but it's definitely possible.",
        "created_at": "2024-04-04T20:17:44.675000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "yeah, someone is going to have to prune",
        "created_at": "2024-04-04T20:18:55.922000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "but we have pruning already on forkchoice so probably is easier for us",
        "created_at": "2024-04-04T20:19:07.518000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Thanks for the feedback, I'll add it to the list of things to revisit, I was hoping to finish by this weekend",
        "created_at": "2024-04-04T20:19:25.444000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Cross-layer",
        "parent": "",
        "content": "ELs do impl pruning as well, for old unfinalized blocks, txpool, etc, so I guess it's just who wants to impl it for the map. So the tradeoff seems clear, max perf payload building -\u003e EL does it, max simplicity El impl -\u003e CL does it",
        "created_at": "2024-04-04T20:20:47.528000+00:00",
        "attachments": null
    }
]