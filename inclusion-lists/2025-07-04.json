[
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Is the premise that the includer can send the list even before the head is chosen (cause it's not available yet for example) and the list is valid even though it may include tx that were already included before? This would be similar as if the includer in the vanilla version of FOCIL sent a tx with a past nonce, it's just ignored and automatically satisfied by any Payload but the list remains right?",
        "created_at": "2025-07-04T00:27:32.723000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "that's the repmise, but I dont know understand why in engine api call to `get_inclusion_list`, we woudl still require `parent_hash` has an input parameter. The head should be irrelevant here. \nThe `inclusion_list` object is right, there's no parent hash nor parent block root field, the only thing we verify before import is the slot is correct and inclusion list committee root is correct",
        "created_at": "2025-07-04T02:12:50.676000+00:00",
        "attachments": null
    },
    {
        "author": "soispoke",
        "category": "Cross-layer",
        "parent": "",
        "content": "yes that's the idea!",
        "created_at": "2025-07-04T07:55:57.805000+00:00",
        "attachments": null
    },
    {
        "author": "soispoke",
        "category": "Cross-layer",
        "parent": "",
        "content": "currently, what we tell includers is to build ILs based on their current local head (to try to minimize the number of invalid txns in ILs) but it doesn't mean ILs are considered invalid if they're not build on the right head.",
        "created_at": "2025-07-04T07:56:15.734000+00:00",
        "attachments": null
    },
    {
        "author": "soispoke",
        "category": "Cross-layer",
        "parent": "",
        "content": "what are the current ePBS candidate timings (e.g., attestation deadline, PTC) for 12 and 6sec slots, I can write a small doc about how ePBS and FOCIL work together for both if useful",
        "created_at": "2025-07-04T07:58:33.509000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "We don't know, specially as they will probably vary with gas limits and blob count. But what I'll specify in the PR when Justin merges #3510 is along the following lines\nAttestation deadline 2\"\nPayload available deadline: 3500--4000ms\nAggregation deadline 6\"\nData available deadline 9\"\nPTC view freeze 11\"",
        "created_at": "2025-07-04T09:38:33.887000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "And all of them can be changed as we see fit",
        "created_at": "2025-07-04T09:39:19.947000+00:00",
        "attachments": null
    },
    {
        "author": "anderselowsson",
        "category": "Cross-layer",
        "parent": "",
        "content": "Some documents include and some do not include a PTC view freeze. What is the most likely specification there, from the DA deadline up to the end of the slot?",
        "created_at": "2025-07-04T12:07:41.380000+00:00",
        "attachments": null
    },
    {
        "author": "anderselowsson",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yeah that is the gist of ABBs. One benefit is that the full attester set gets to ensure censorship resistance instead of the PTC.",
        "created_at": "2025-07-04T12:19:36.074000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Before Fusaka the freeze is unnecessary, but going with the DA signaling with PTC it becomes needed to guarantee the proposers view",
        "created_at": "2025-07-04T12:21:49.409000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Well, it's a little different though cause the attesters do so optimistically while in principle we can force the PTC to do the static check at least. But yeah the bit list approach is much cleaner",
        "created_at": "2025-07-04T12:25:03.340000+00:00",
        "attachments": null
    },
    {
        "author": "soispoke",
        "category": "Cross-layer",
        "parent": "",
        "content": "why wouldn't attesters of slot N+1 do everything, as in validate execution + determine whether the payload satisfied IL conditions",
        "created_at": "2025-07-04T12:34:26.477000+00:00",
        "attachments": null
    },
    {
        "author": "anderselowsson",
        "category": "Cross-layer",
        "parent": "",
        "content": "Then the proposer does not know what to build on.",
        "created_at": "2025-07-04T12:35:15.790000+00:00",
        "attachments": null
    },
    {
        "author": "anderselowsson",
        "category": "Cross-layer",
        "parent": "",
        "content": "Why is that? The proposer's view is not definite even before Fusaka, in that it cannot ascertain the exact release of the payload. It just has a better hunch",
        "created_at": "2025-07-04T12:37:01.077000+00:00",
        "attachments": null
    },
    {
        "author": "soispoke",
        "category": "Cross-layer",
        "parent": "",
        "content": "right, that makes sense",
        "created_at": "2025-07-04T12:37:05.190000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "It gets worse with DA cause the proposer doesn't know if the block satisfied it. So if the PTC is telling it the blobs were or weren't available , the proposer can force that view",
        "created_at": "2025-07-04T12:38:24.829000+00:00",
        "attachments": null
    },
    {
        "author": "anderselowsson",
        "category": "Cross-layer",
        "parent": "",
        "content": "Due to a proposer's ability to break ties on payload timeliness?",
        "created_at": "2025-07-04T12:40:26.161000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "It's the freeze mechanism that allows the proposer to guarantee that everyone has his same view of the PTC. This is specially needed with a system like Francesco's that has an effective reveal boost of infinity",
        "created_at": "2025-07-04T12:41:35.579000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "But notice that it's not much about the timelines of the Payload but about the DA",
        "created_at": "2025-07-04T12:42:15.398000+00:00",
        "attachments": null
    },
    {
        "author": "soispoke",
        "category": "Cross-layer",
        "parent": "",
        "content": "is there rough consensus here that we should probably go with optimistic attesting at e.g., t=2s into the slot rather than having PTC members do the append-to-payload nonce and balance checks?",
        "created_at": "2025-07-04T12:42:25.884000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "My preference here should be irrelevant since I haven't followed closely FOCIL implementation. From outside it seems much cleaner and simple to me. And you get a fast signaling by the full beacon committee",
        "created_at": "2025-07-04T12:43:38.836000+00:00",
        "attachments": null
    },
    {
        "author": "anderselowsson",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yeah what I wanted to understand is why it is not needed to freeze with a PTC, but needed with DA. The only fundamental change is that the proposer can ascertain that the payload is available, albeit that it might have been late.",
        "created_at": "2025-07-04T12:43:50.187000+00:00",
        "attachments": null
    },
    {
        "author": "anderselowsson",
        "category": "Cross-layer",
        "parent": "",
        "content": "In the case of DA, it cannot even ascertain. That's the fundamental difference I see.",
        "created_at": "2025-07-04T12:44:29.918000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think that's irrelevant. Attesters don't need to enforce that the Payload was late at all. If the proposer wants to build on top of a late payload that's fine",
        "created_at": "2025-07-04T12:45:00.791000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "It is even the honest behavior",
        "created_at": "2025-07-04T12:45:17.674000+00:00",
        "attachments": null
    },
    {
        "author": "anderselowsson",
        "category": "Cross-layer",
        "parent": "",
        "content": "Ok but that limits the guaranteed execution time for attesters",
        "created_at": "2025-07-04T12:46:03.964000+00:00",
        "attachments": null
    },
    {
        "author": "anderselowsson",
        "category": "Cross-layer",
        "parent": "",
        "content": "Then they'll have to simply not attest to that payload if they do not have time to execute.",
        "created_at": "2025-07-04T12:46:45.869000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "that is always the case",
        "created_at": "2025-07-04T12:47:37.533000+00:00",
        "attachments": null
    },
    {
        "author": "anderselowsson",
        "category": "Cross-layer",
        "parent": "",
        "content": "But I can see how the PTC gives the proposer an \"off-ramp\" to elect to *not* build on the payload",
        "created_at": "2025-07-04T12:47:44.292000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "you can't even import the CL block if it builds on top of a late payload",
        "created_at": "2025-07-04T12:47:50.033000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "Here is how I think it should work fwiw: https://hackmd.io/@fradamt/H1lyhls5Nel\nHere there's a view freeze on availability, for attesters, but no such thing for the PTC votes",
        "created_at": "2025-07-04T12:47:58.258000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Ahh this is interesting, you're putting a freeze on the view of attesters of N+1 instead on the PTC attestations themselves",
        "created_at": "2025-07-04T12:49:53.675000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "this makes sense as it allows the PTC attestations to come even later",
        "created_at": "2025-07-04T12:50:05.803000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "~~I can't comment on the doc, but perhaps these~~\n\u003e votes are \u003c 50% yes\nCould be transformed also in a statement of the form \"votes are \u003e 50% no\" , so as to have the three status: threshold for yes, threshold for no, not enough attestations.",
        "created_at": "2025-07-04T12:52:49.704000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "yeah not clear to me at this point if this should be a relative threshold or not. Not having a relative threshold is a bit weird because it means that under low participation any payload can be reorged. On the other hand proposer boost is not a relative threshold, so there's already very little guarantees under low participation unless everyone acts honestly",
        "created_at": "2025-07-04T13:20:26.115000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yeah low participation or split scenarios are my concern",
        "created_at": "2025-07-04T13:29:59.476000+00:00",
        "attachments": null
    },
    {
        "author": "soispoke",
        "category": "Cross-layer",
        "parent": "",
        "content": "ok so quick recap after talking with fradamt a bit more about this:\n\n- Using the PTC to signal whether the proposer's IL bitlist included all ILs seen from PTC members might actually make more sense, because ultimately the IL conditions are about the payload, and using the attesters earlier on would mean a beacon block could get reorged because it failed to listen to some ILs and it accepted a non-inclusive bitlist from the builder. \n\nso I'll start from there, but lmk ofc if anyone disagrees",
        "created_at": "2025-07-04T13:30:12.436000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Well, I'm assuming the bit list is still in the bid and visible early on the CL block right?",
        "created_at": "2025-07-04T13:31:47.483000+00:00",
        "attachments": null
    },
    {
        "author": "soispoke",
        "category": "Cross-layer",
        "parent": "",
        "content": "yes yes this doesn't change",
        "created_at": "2025-07-04T13:31:58.394000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Then I think it may depend on timings. If attesters have enough time to freeze their view there's an advantage on having this being a full committee. If timing is an issue I'd agree with Francesco",
        "created_at": "2025-07-04T13:32:50.141000+00:00",
        "attachments": null
    },
    {
        "author": "soispoke",
        "category": "Cross-layer",
        "parent": "",
        "content": "having this be a full committee just because it's more difficult to bribe/control?",
        "created_at": "2025-07-04T13:34:18.160000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "By the way I don't mean relative yes/no but only counting explicit no attestations as no, rather than the lack of yes attestation being counted as a no",
        "created_at": "2025-07-04T13:34:45.442000+00:00",
        "attachments": null
    },
    {
        "author": "soispoke",
        "category": "Cross-layer",
        "parent": "",
        "content": "I don't think timings are tight in any case, just that it might be a tiny bit cleaner to group payload related conditions imo",
        "created_at": "2025-07-04T13:35:16.414000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "And because there's more time to propagate and count those attestations than the PTC that we want to push to the limit cause it's only useful in case of attacks. Honest behavior doesn't care about the PTC attestations",
        "created_at": "2025-07-04T13:35:39.383000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Most nodes are super nodes",
        "created_at": "2025-07-04T13:35:55.458000+00:00",
        "attachments": null
    },
    {
        "author": "soispoke",
        "category": "Cross-layer",
        "parent": "",
        "content": "ok yeah that's a good argument",
        "created_at": "2025-07-04T13:36:38.073000+00:00",
        "attachments": null
    },
    {
        "author": "soispoke",
        "category": "Cross-layer",
        "parent": "",
        "content": "you don't think this matters? the cleaner separation?",
        "created_at": "2025-07-04T13:36:54.425000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "It's not clear if it's a cleaner separation to me. As far as I understand, the optimistic attesting is a matter of forkchoice, not a matter of the payload. The attesters are signalling that the includers match their view. And includers are in the CL, not the EL",
        "created_at": "2025-07-04T13:38:39.768000+00:00",
        "attachments": null
    },
    {
        "author": "anderselowsson",
        "category": "Cross-layer",
        "parent": "",
        "content": "Correct?",
        "created_at": "2025-07-04T13:38:48.922000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "consensus_outcome.png",
                "content": "b05eaf46593b643a8ac42936b348692248749c2ca1b10eb023c96f9a95abdda9"
            }
        ]
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "yes, very nice ðŸ™‚",
        "created_at": "2025-07-04T13:44:48.513000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "about the previous discussion, what I was thinking is that, in a world with separation, it may be nice to have beacon proposers be *less* exposed to the FOCIL mechanism, meaning a beacon block could only be reorged due to FOCIL if it fails the post-check (which is basically deterministic given the bitlist and the associated ILs), versus also being exposed to reorgs due to accepting a \"bad\" (not sufficiently inclusive) bitlist",
        "created_at": "2025-07-04T13:47:33.365000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "But no strong opinion either way",
        "created_at": "2025-07-04T13:47:42.835000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "This is a good point indeed, also not a strong opinion in my side as well, both seem reasonable to me.",
        "created_at": "2025-07-04T14:44:53.995000+00:00",
        "attachments": null
    },
    {
        "author": "soispoke",
        "category": "Cross-layer",
        "parent": "",
        "content": "Does this look right? Decided not to add timings I don't think it adds much value, but we can definitely see the only tension would've appeared if ILs had to be built on the latest head to be considered valid (e.g., using the PTC signal). Since it's not the case I don't really see where we would have conflicts so far",
        "created_at": "2025-07-04T15:29:34.980000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "FOCIL.drawio_7.png",
                "content": "676080f32cb9ec579ee581ecb71f0333d6a3b3367fc094c11e64d2cf0daa94e2"
            }
        ]
    },
    {
        "author": "anderselowsson",
        "category": "Cross-layer",
        "parent": "",
        "content": "I also do not have a very strong opinion. Not yet at least. Need to understand how the PTC design is intended to work without the view-freeze and with the new DA design? In ABBs, the proposer of slot n can always opt to take a block that it is certain about satisfying the ILs. With the PTC, the proposer of slot n+1 does not have the luxury of choice and IL satisfaction can be very uncertain upon late IL release if the builder made a tight choice.",
        "created_at": "2025-07-04T15:41:55.166000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "For PTC, we donâ€™t need to execute the payload to verify IL satisfiability, right? It just compares the bitlist and checks whether the transactions are included. But what if there are IL bits that aren't part of the payload, wouldnâ€™t we need to execute the payload to determine if they *could* have been included or not?\n\nIf no one feels strongly about using attesters or the PTC, then Iâ€™d like to explore both options from an implementation perspective. That gives us the least risky path forward...",
        "created_at": "2025-07-04T17:36:56.587000+00:00",
        "attachments": null
    },
    {
        "author": "anderselowsson",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003e If no one feels strongly about using attesters or the PTC, then Iâ€™d like to explore both options from an implementation perspective. That gives us the least risky path forward...\n\nAgree we should explore both. But first we need a specification for how the proposer and attesters should interpret the PTC vote in terms of the ILs under no freeze. I don't think there is one? There are options such as parties involving their own view in the decision and/or adding a margin within which the proposer gets to decide, etc.",
        "created_at": "2025-07-04T19:15:36.734000+00:00",
        "attachments": null
    }
]