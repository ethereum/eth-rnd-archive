[
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "Otherwise one can sweep the account and the second transaction will not be oncludable anymore",
        "created_at": "2024-03-21T00:57:25.754000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Oh are we making the funds to pay for gas a hard requirement? This is my lack of knowledge of the execution layer. My understanding was that such transaction would revert with not enough gas",
        "created_at": "2024-03-21T01:14:22.549000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Cross-layer",
        "parent": "",
        "content": "A transaction can't be included at all if there are insufficient funds to cover the intrinsic transaction cost (any ETH being sent + gas limit * effective gas price). Otherwise you wind up doing work to process the tx (even if it reverts quickly) without anyone actually getting paid which opens up DoS vectors.  Also things like nonce validation and other tx validity checks have to pass or the tx can't be included at all.",
        "created_at": "2024-03-21T01:20:07.681000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Nonce validation would pass",
        "created_at": "2024-03-21T01:21:02.466000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The question here is about transaction validity itself",
        "created_at": "2024-03-21T01:21:14.233000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I was under the impression that nonce and base fee were the only factors that would make the tx actually invalid and that others would make it revert",
        "created_at": "2024-03-21T01:22:11.018000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "If we need to access accounts and check for balances that's a different game that is not mentioned at all in the original design",
        "created_at": "2024-03-21T01:22:38.830000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yeah you definitely need to check balances to know that a tx can be included. The yellow paper specifies them all and you may actually enjoy that format.  I'm guessing the execution-specs pyspecs also lists them all but I can't find them in it currently.",
        "created_at": "2024-03-21T01:25:07.485000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Balance check is not there in the EE spec",
        "created_at": "2024-03-21T01:25:38.689000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Cross-layer",
        "parent": "",
        "content": "https://github.com/ethereum/execution-specs/blob/master/src/ethereum/frontier/fork.py#L638C7-L638C8 has the key pieces assuming that `InvalidBlock` will invalidate the entire block.",
        "created_at": "2024-03-21T01:26:51.828000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "If this is something that makes the transaction invalid rather than reverting then we need to worry about other issues",
        "created_at": "2024-03-21T01:27:03.159000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Cross-layer",
        "parent": "",
        "content": "nonce, balance and, new to me, checking the account doesn't have code...",
        "created_at": "2024-03-21T01:27:09.580000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "That's not what I'm referring to",
        "created_at": "2024-03-21T01:27:30.282000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The point is that the execution spec for inclusion lists does not check that the account balance has enough to pay the gas limit",
        "created_at": "2024-03-21T01:28:00.300000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "It only checks that the max fee is enough",
        "created_at": "2024-03-21T01:28:14.181000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Cross-layer",
        "parent": "",
        "content": "That is not sufficient to ensure that a transaction can be included in a block.",
        "created_at": "2024-03-21T01:28:26.851000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "That definitely changes the game",
        "created_at": "2024-03-21T01:28:47.155000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Cross-layer",
        "parent": "",
        "content": "If a block includes a transaction where the account does not have sufficient balance to cover the intrisic cost, the account has code or the nonce doesn't match then the entire block is invalid.",
        "created_at": "2024-03-21T01:29:32.288000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Cross-layer",
        "parent": "",
        "content": "And it has to cover the base fee. There may be other checks added in later forks (I'm looking at the frontier part of execution-specs...)",
        "created_at": "2024-03-21T01:30:09.376000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "That's fine then we have to check balances and either execute them in order or just include one per address. Is there any way that a transaction from a different account can reduce balance on a separate account? I assume this can happen with account abstraction",
        "created_at": "2024-03-21T01:31:55.541000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "If that happens then the system is broken even with one address per list",
        "created_at": "2024-03-21T01:33:21.769000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Cross-layer",
        "parent": "",
        "content": "Currently, the native ETH balance can't be reduced except by sending a tx from that account (given that this has to be an account with no code). Account abstraction would let someone pay the native ETH and be reimbursed either out of band or via ERC20.  Not sure if there are future plans to break that invariant as part of introducing something like native account abstraction.",
        "created_at": "2024-03-21T01:33:58.547000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Cross-layer",
        "parent": "",
        "content": "You might want someone who's done serious execution client work in the past 6 years to verify that, but I think I'm right. ðŸ˜„",
        "created_at": "2024-03-21T01:35:16.331000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Account abstraction should be brought them to the next breakout room",
        "created_at": "2024-03-21T01:35:35.150000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Because the current design breaks if a transaction is includable in N where the IL is sent and it's not in N+1",
        "created_at": "2024-03-21T01:36:53.496000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "If there are plans to break this we need to go back to the design board",
        "created_at": "2024-03-21T01:37:21.866000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Also the fact that this is an account with no code is also new to me, but probably it's because of the same",
        "created_at": "2024-03-21T01:38:49.003000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I thought only blob tx were not covered",
        "created_at": "2024-03-21T01:39:36.946000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "Checking that the sender does not have code is kinda theoretical though",
        "created_at": "2024-03-21T02:08:17.261000+00:00",
        "attachments": null
    },
    {
        "author": "abcoathup",
        "category": "Cross-layer",
        "parent": "",
        "content": "Unfortunately \u003c@552133098075193354\u003e's summary at the end of the breakout call for the next phases can't be heard on the YouTube recording.\nhttps://www.youtube.com/watch?v=GVdkDXZTtnw\u0026t=3552s",
        "created_at": "2024-03-21T03:14:04.840000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "Just fyi, inclusion lists also make empty blocks impossible",
        "created_at": "2024-03-21T04:10:50.306000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "How do you mean? If there is no transaction with a max fee high enough to pay the N+1 base fee, the IL could be empty, and so would N+1 be. But otherwise I think it's a feature that ILs force proposers to not propose empty block if they can help it, it's actually a great defence against multi-block MEV. If we move to missed slot penalties (which imo only makes sense in an execution tickets future, not with the current staking landscape), someone controlling multiple slots in a row has to propose sth to not receive the missed slot penalty, and has to propose something non-trivial to satisfy the IL.",
        "created_at": "2024-03-21T09:05:17.225000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "(Assuming non-empty il)",
        "created_at": "2024-03-21T09:08:26.153000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "At the beginning of the slot we build an empty block and update it when a block building cycle finishes. With a non-empty il, we need to apply the il to that initial block as well, if someone found a dos, this would make the affected clients not produce blocks instead of producing empty blocks. Not really an issue in my opinion, just interesting",
        "created_at": "2024-03-21T09:10:47.128000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "Oh, we need to make the validity requirement for the txs in the il that they pass current basefee and the next step up (assuming a max block)",
        "created_at": "2024-03-21T09:14:35.042000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yeah that's already in the spec",
        "created_at": "2024-03-21T10:06:59.409000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e catching up on discussion. i too, like potuz, was under the impression that the only thing that can invalidate a txn that was valid in slot N in slot N+1 was:\n- nonce reuse in slot N\n- gas not being high enough to covered the new base fee.\n\nthis is one of the core assumptions written in https://ethresear.ch/t/no-free-lunch-a-new-inclusion-list-design/16389#h-2-core-mechanics-3 (see observation 2)\n\ni remember explicitly vitalik talking about the AA implications and saying it was fine. ill dm him to confirm again",
        "created_at": "2024-03-21T12:32:21.488000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e",
        "created_at": "2024-03-21T13:08:15.782000+00:00",
        "attachments": [
            {
                "type": "image/jpeg",
                "origin_name": "file_18.jpg",
                "content": "9cb06ac816c45ab7f482ab1363223e09e50e11b0527c847d6b0aca3c351f9fe0"
            }
        ]
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e initial set of thoughts!",
        "created_at": "2024-03-21T13:08:23.343000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cnero_eth\u003e When did the nonce get back into the summary, and why? I was thinking that the nonce-less design makes the no-free-DA property possible in the first place?\nWasn't there agreement that having the nonce inside the summary opens up for strange attacks?",
        "created_at": "2024-03-21T14:40:41.209000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e nonce is to avoid keeping the previous addresses in the state",
        "created_at": "2024-03-21T14:45:42.465000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cnero_eth\u003e I have to check the specs but dealing with nonces initially feels dangerous",
        "created_at": "2024-03-21T15:05:15.994000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "I don't think it is",
        "created_at": "2024-03-21T15:05:29.538000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "It's way better than putting the addresses into the state",
        "created_at": "2024-03-21T15:05:50.061000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "Thats super jank",
        "created_at": "2024-03-21T15:05:56.182000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cnero_eth\u003e Cannot really comment on that but I believe you",
        "created_at": "2024-03-21T15:06:15.105000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e @marius how about the balances though",
        "created_at": "2024-03-21T15:06:15.462000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e you will need to have them",
        "created_at": "2024-03-21T15:06:18.678000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e what's the danger you see? (re @nero_eth: I have to check the specs but dealing with nonces initially feels dangerous)",
        "created_at": "2024-03-21T15:12:50.587000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "I don't need the balances in the inclusion list summary, I have them in the full transactions",
        "created_at": "2024-03-21T15:14:04.130000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e no the point is that you will need the balance decreases in the previous block",
        "created_at": "2024-03-21T15:14:26.825000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e ahh this bot sucks, will be there (re @InclusionList_bot: \u003cmariusvanderwijden\u003e I don't need the balances in the inclusion list summary, I have them in the full transactions)",
        "created_at": "2024-03-21T15:14:50.828000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The issue is that now if you get an IL to verify in the payload of N+1 , and there's an address that is in the summary but not in the payload. Then you need to go and check if that address had a balance decrease in the previous block",
        "created_at": "2024-03-21T15:15:46.690000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "if we wanted to keep this future AA safe",
        "created_at": "2024-03-21T15:16:19.897000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "Ah yeah I don't",
        "created_at": "2024-03-21T15:16:32.869000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": ":D",
        "created_at": "2024-03-21T15:16:34.577000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "lol, I know nothing about execution, seems to me that there are strong fights about it",
        "created_at": "2024-03-21T15:17:01.170000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cnero_eth\u003e things like spamming and skipping a nonce, and individual ways mempools are handled. There were just a bunch of potential attacks leveraging some strange mempool behavior (total limits, limit per address, etc) in the past. \nI was thinking that taking out the nonce was a super nice way to prevent problems with the nonce but if there're none and we have looked into it already, then good :) (re @potuz0: what's the danger you see?)",
        "created_at": "2024-03-21T15:17:24.205000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "This doesn't play well at all with AA",
        "created_at": "2024-03-21T15:17:35.881000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "can you give me a specific attack? I can't see how you spam on the IL",
        "created_at": "2024-03-21T15:18:18.497000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "I'll try to write up some of my thoughts on the shortcomings/pitfalls of the current il spec tomorrow",
        "created_at": "2024-03-21T15:19:12.219000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cnero_eth\u003e idk, more thinking out loud. Maybe putting a tx with nonce 100 in the IL and gossip multiple txs with nonces 1-99. Try to fill caches or push out stuff that shouldn't be pushed out. But ya, I don't have a real opinion on that - have to check the curr. specs first. (re @InclusionList_bot: \u003cpotuz\u003e [reply]: can you give me a specific attack? I can't see how you spam on the IL)",
        "created_at": "2024-03-21T15:22:21.607000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Cross-layer",
        "parent": "",
        "content": "Somewhat orthogonal, but related to allowing more than 1 tx per address: I feel like this is deviating from the \"spirit\" of IL at least how I understand it where it's to unblock individual censored _transactions_ not _accounts_.  By definition a future nonce tx isn't executable, so it can't really have been censored yet right?",
        "created_at": "2024-03-21T15:22:49.872000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "if the tx comes with nonce 100 and the current state has nonce 0, then the IL is invalid",
        "created_at": "2024-03-21T15:30:26.547000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e very keen to hear this! (re @InclusionList_bot: \u003cmariusvanderwijden\u003e I'll try to write up some of my thoughts on the shortcomings/pitfalls of the current il spec tomorrow)",
        "created_at": "2024-03-21T15:32:34.087000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e are these shortcomings independent of AA stuff ? (re @InclusionList_bot: \u003cmariusvanderwijden\u003e I'll try to write up some of my thoughts on the shortcomings/pitfalls of the current il spec tomorrow)",
        "created_at": "2024-03-21T15:33:25.551000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e FYI for those not on the ACD, MAXEB, EIP-7251 was marked as included. and it seems like ILs was given the CFI (candidate for inclusion) label",
        "created_at": "2024-03-21T15:34:00.854000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e the discussion will continue in the ACDE next week and the final call on if ILs get in would come then or at the next ACDC",
        "created_at": "2024-03-21T15:34:38.148000+00:00",
        "attachments": null
    },
    {
        "author": "pawandhananjay",
        "category": "Cross-layer",
        "parent": "",
        "content": "how does the EL decide which txs it wants to put in the IL? is it spec'd out or does everyone have different implementations?",
        "created_at": "2024-03-21T15:37:13.918000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "*considered for Inclusion",
        "created_at": "2024-03-21T15:37:28.844000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think that doesn't need to be specced",
        "created_at": "2024-03-21T15:38:17.753000+00:00",
        "attachments": null
    },
    {
        "author": "pawandhananjay",
        "category": "Cross-layer",
        "parent": "",
        "content": "what's geth's criteria?",
        "created_at": "2024-03-21T15:38:31.728000+00:00",
        "attachments": null
    },
    {
        "author": "mikeneuder",
        "category": "Cross-layer",
        "parent": "",
        "content": "can just greedily build a smol block",
        "created_at": "2024-03-21T15:41:55.029000+00:00",
        "attachments": null
    },
    {
        "author": "mikeneuder",
        "category": "Cross-layer",
        "parent": "",
        "content": "most neutral (select top n million gas txns based on tip)",
        "created_at": "2024-03-21T15:42:29.600000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Cross-layer",
        "parent": "",
        "content": "Right now: all transactions originating from accounts that ever send a transaction over the rpc, or which are manually set as 'local' will be added to the il",
        "created_at": "2024-03-21T16:02:00.519000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "FWIW, I left some comments regarding this a few months back. I think that reorgs are important to consider https://hackmd.io/VBZ4iT_7QTqMMqm52JcUPw",
        "created_at": "2024-03-21T17:10:27.570000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e ty \u003c@504202741933932544\u003e and \u003c@491624610215886849\u003e for comments on the consensus spec! addressed. only one i was unsure on was this:\n\nhttps://github.com/ethereum/consensus-specs/pull/3617#discussion_r1533730641\n\nq: do we need to sign full IL for gossip given we can ignore future ILs (given IL receipt is idempotent)?\n\nmy feeling is it is still nice to sign, so that someone cannot perform the following:\n1. hear a valid IL\n2. copy the signed summary (which has the proposer signature)\n3. insert garbage transactions\n4. flood the network with bad ILs\n\nthis feels annoying and could end up in a situation where most of the network sees an invalid IL first. this could be a dos if i have to check a ton of invalid ILs before finding the valid one. but would love to hear more thoughts on this, @potuz0 @terencechain",
        "created_at": "2024-03-21T17:37:52.343000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e one other small commit based on what @terencechain said in the ACDC: updating the fork-choice filtering to depend on the IL availability: https://github.com/ethereum/consensus-specs/pull/3617/commits/37ca0c9ce610c329498a3d17359357d0f4ed309c",
        "created_at": "2024-03-21T18:47:05.660000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e from an old msg from @fradamt; a convo with Dustin and @potuz0",
        "created_at": "2024-03-21T18:47:45.503000+00:00",
        "attachments": [
            {
                "type": "image/jpeg",
                "origin_name": "file_19.jpg",
                "content": "e906adc6fd570cb553a9fbf229eb85e096eb132491fa7a28205e02fc3d986118"
            }
        ]
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e please lmk if anything else in the spec needs updating! still using this pr: https://github.com/ethereum/consensus-specs/pull/3617/commits/37ca0c9ce610c329498a3d17359357d0f4ed309c",
        "created_at": "2024-03-21T18:48:21.005000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e Left a comment",
        "created_at": "2024-03-21T18:49:28.874000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e It's not that simple",
        "created_at": "2024-03-21T18:49:42.619000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e is this the honest reorg thing you were mentioning earlier ?",
        "created_at": "2024-03-21T18:50:44.419000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e the length 2 reorg",
        "created_at": "2024-03-21T18:51:34.038000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e Kinda, that's a different beast to tackle later. Here the issue is that if you see a block that has an IL that comes and is based on one that doesn't, you should allow it to be head",
        "created_at": "2024-03-21T18:51:46.771000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e Regardless of reorgs",
        "created_at": "2024-03-21T18:51:55.555000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e So you have three blocks 1, 2,3, no reorgs. 2 didn't have an IL, 3 does",
        "created_at": "2024-03-21T18:52:31.451000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e During 2 your head is 1",
        "created_at": "2024-03-21T18:52:38.686000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e During 3 your head is 3",
        "created_at": "2024-03-21T18:52:45.252000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e i see. so maybe only do the IL availability check at a leaf node ?",
        "created_at": "2024-03-21T18:53:38.376000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e thatâ€™s the extra condition ?",
        "created_at": "2024-03-21T18:53:47.183000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e And it's not trivial to do",
        "created_at": "2024-03-21T18:54:24.404000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e Because once you remove the leaf then the parent becomes a leaf",
        "created_at": "2024-03-21T18:54:45.026000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e In the above example, if 3 also doesn't have an IL, then 1 is your head",
        "created_at": "2024-03-21T18:55:10.761000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e how is this handled for blobs ? feels like a similar problem, no ?",
        "created_at": "2024-03-21T18:56:53.135000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e just curious how you were thinking about it",
        "created_at": "2024-03-21T18:57:00.062000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e It's very different for blobs",
        "created_at": "2024-03-21T18:57:15.682000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e For blobs it's a validity condition",
        "created_at": "2024-03-21T18:57:23.967000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e Which is the whole thing we want to avoid",
        "created_at": "2024-03-21T18:57:32.658000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e A block with an unavailable blob never makes it to forkchoice",
        "created_at": "2024-03-21T18:58:07.647000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e right. in your specs, did you have a technique for this ?",
        "created_at": "2024-03-21T18:59:15.906000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e No, because for ePBS it makes sense to make it a validity condition since there are more edge cases to deal with: many consecutive CL  blocks can be \"empty\" and you need to enforce compatibility with ILs",
        "created_at": "2024-03-21T19:00:33.784000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e ok sg! will think on this and consult mr fork choice @fradamt :D",
        "created_at": "2024-03-21T19:01:08.494000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e seems to be the only lingering q. if anything else comes up in the prototyping, please LMK! happy to continue refining the specs as much as is helpful",
        "created_at": "2024-03-21T19:03:16.880000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "There are different options that you can take here, typing on a phone so it may be slow\n- do nothing on filtering, then go backwards on head: loop up until you find a block with an IL (this considers votes for every branch including those without an IL)\n- consider all blocks with or without an IL and then add the condition to recover the full IL from the EL \n- do the filtering completely by first removing all final branches that consist of blocks without ILs\n\n1) The simplest is 1 and it's probably the least safe. \n\n2) has a problem with AA, the EL can no longer recover the full IL by knowing the last two blocks because there are transactions that may have never been included!\n\nI think the AA issue is more serious than what you take it to be",
        "created_at": "2024-03-21T19:08:20.760000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e ok ty, this is very very helpful. let me think on it a bit more",
        "created_at": "2024-03-21T19:10:34.705000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Cross-layer",
        "parent": "",
        "content": "Is the AA issue wrt native account abstraction?",
        "created_at": "2024-03-21T21:46:15.939000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e yes the AA issue is that it restrict it to being impossible for account A to allow account B to spend ETH in its behalf (re @InclusionList_bot: \u003crjected\u003e Is the AA issue wrt native account abstraction?)",
        "created_at": "2024-03-21T22:06:15.296000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Cross-layer",
        "parent": "",
        "content": "What I meant to ask, is which instance of an AA feature? 2938? I understand that the balance checks will be difficult in that case, but that would also have to be solved in mempool rules for whichever AA construction is being referred to. In that case, could the same tx validity checks just apply to ILs as well?",
        "created_at": "2024-03-21T22:11:11.299000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Cross-layer",
        "parent": "",
        "content": "mainly because AA is like, m different features x n implementations of those features rn. and I think each one also has to solve this problem",
        "created_at": "2024-03-21T22:13:24.401000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e Why would you need to do the same check? the situation here is that you receive a payload N+1 that includes a summary and there is no transaction in payload N+1 and N from that address. Now you need to check if during the  previous payload N, the balance in that address decreased. Doesn't seem to me something you need to deal with in your mempool impl (re @InclusionList_bot: \u003crjected\u003e What I meant to ask, is which instance of an AA feature? 2938? I understand that the balance checks will be difficult in that case, but that would also have to be solved in mempool rules for whichever AA construction is being referred to. In that case, could the same tx validity checks just apply to ILs as well?)",
        "created_at": "2024-03-21T22:14:25.709000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e Notice that here you don't even have a transaction",
        "created_at": "2024-03-21T22:15:01.944000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e you only have an address and a nonce",
        "created_at": "2024-03-21T22:15:06.855000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Cross-layer",
        "parent": "",
        "content": "I see, I think I was confused before. To make sure I understand now: you are trying to make sure that the only reason why a tx was not included in a payload (after its address, nonce is in a summary), is because it was made invalid in the previous block. And let's just pick sponsorship, let's say we have some contract that pays for all gas. It's not enough to check balance decreases for senders in the summary. Do you basically need the full tx which you don't have?",
        "created_at": "2024-03-21T22:24:39.843000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Cross-layer",
        "parent": "",
        "content": "or, hmm, not sure if sponsorship is the right failure case",
        "created_at": "2024-03-21T22:29:13.787000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "So the full situation is this.  We live in a world where a transaction with `from` entry, address `B` can modify the ETH balance of address `A`. \n- The proposer of N has sent an IL summary that contains address `A`, nonce 10. \n- You run a validator and haven't even seen any IL (just to make the example easier) \n- The builder of N+1 has sent a payload, he included the summary that contains address `A` but there is no transaction from adress `A`. \n- You check the nonce, and the nonce of address `A` is still `9`. \n\nIn the \"current\" design you will declare this payload as invalid because the transaction from `A` has not been seen neither in `N+1` nor `N`. However, to be fully AA safe we would need to \n- You check that the ETH balance of `A`actually decreased between payload `N` and payload `N+1`, thus you declare that the block is valid.",
        "created_at": "2024-03-21T22:33:25.244000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "hope this clarifies the situation",
        "created_at": "2024-03-21T22:33:33.327000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Cross-layer",
        "parent": "",
        "content": "This makes sense, thx for the explanation!",
        "created_at": "2024-03-21T22:36:11.505000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e could the summary contain a commitment to the sender, nonce, and the pre state balance ?",
        "created_at": "2024-03-21T22:41:56.270000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e so the conditions for the il entry being satisfied are\n- nonce at address is higher/equal to what was in entry, or\n- balance is less than what was in the entry",
        "created_at": "2024-03-21T22:43:55.749000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cpotuz0\u003e I obviously don't know execution to know if these are the only conditions to invalidate a tx... From the combo yesterday I got two relevant things:\n1) I need to read the yellow paper and probably geth implementation.\n2) one example is if tx from B deploys code in A somehow, if this were possible this would also invalidate the IL tx",
        "created_at": "2024-03-21T22:55:19.148000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003cmikeneuder\u003e agree!! super good to get EL expert opinions here",
        "created_at": "2024-03-21T23:04:33.660000+00:00",
        "attachments": null
    },
    {
        "author": "mikeneuder",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@360491619402776577\u003e \u003c@543900561460822016\u003e for geth visibility",
        "created_at": "2024-03-21T23:05:31.372000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Besides geth, I'd say we listen to the people working on different candidates to AA, they may have some strong oppinions on the matter",
        "created_at": "2024-03-21T23:49:54.988000+00:00",
        "attachments": null
    }
]