[
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "el devs -- can i assume the capability that given a timestamp in the execution block header, you can calculate the corresponding CL slot? i was trying to find a recent EIP where this functionality was added and i know in general we want to strive for separation b/t layers but i thought we had discussed adding it somewhere",
        "created_at": "2023-03-31T02:22:52.013000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "(need this to streamline EIP-4877)",
        "created_at": "2023-03-31T02:23:17.422000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "general",
        "parent": "",
        "content": "I've been thinking about this recently in the context of wanting to know which rules should apply for the next block, which is relevant at fork boundaries (building the first block of shanghai for example).\n\nThe problem boils down to being able to predict the next block's timestamp which I don't believe you can, as outlined here: https://github.com/hyperledger/besu/pull/5224#discussion_r1144038031\n\nTL;DR: block numbers don't map to slot numbers because not all slots have blocks. I think that implies that you can't derive the slot from a timestamp, but maybe I'm wrong...it depends on how CLs handle the timestamp after a missed slot. Maybe you can still derive it from a timestamp, just not predict the next timestamp.\n\nHopefully I'm wrong and I've missed something as it would be useful in some cases ðŸ™‚",
        "created_at": "2023-03-31T03:37:21.415000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "right, bc of the possibility of missed slots, we cannot give a deterministic mapping from slot number to block number (otherwise it would just be a static offset we could just go and compute right now)\n\nhowever, given a `timestamp` it is a simple transformation: `timestamp - GENESIS_TIMESTAMP // SECONDS_PER_SLOT`\n\nthe concern is the boundary violation of leaking `GENESIS_TIMESTAMP` and `SECONDS_PER_SLOT` to the EL and i wasn't sure if we have crossed that bridge or not",
        "created_at": "2023-03-31T03:53:42.942000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "re: the fork boundaries point, it is known within the EL which timestamps refer to which forks  (e.g. see EIP-4895) so it should always be clear which rule set a block belongs to",
        "created_at": "2023-03-31T03:54:16.796000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "and re: my point with 4788, i was hoping to rely on the timestamps in the payload header to derive slots to skip sending that information over to the EL, otherwise we will need to send one or two slots over along with the latest root in the engine API -- not a big deal but if we can skip the extra data in the message that would be preferred",
        "created_at": "2023-03-31T03:55:14.966000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "general",
        "parent": "",
        "content": "I don't believe besu has any knowledge of any CL network config values yet, no.",
        "created_at": "2023-03-31T03:57:09.514000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "general",
        "parent": "",
        "content": "Maybe network config could be communicated via engine API on CL startup? I think it would be a new endpoint or change to an existing e.g. engine_exchangeCapabilities",
        "created_at": "2023-03-31T03:59:55.740000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "general",
        "parent": "",
        "content": "Agree, but there's some edge cases where timestamp for next block is not given by CL and we need to predict the next timestamp, for example eth_feeHistory should estimate the baseFee for the next block - not a core protocol scenario so it's kind of a side issue for EL clients I think, and possibly implementation dependent.",
        "created_at": "2023-03-31T04:03:45.270000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "i'd assume we'd just have those two values hard-coded in client config so we don't need to worry about fallible APIs",
        "created_at": "2023-03-31T04:17:40.558000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "general",
        "parent": "",
        "content": "What would be the implications of accidentally configuring different values for EL vs CL then?",
        "created_at": "2023-03-31T04:22:07.152000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "the EL would be on a different version of history -- that being said, these are compact well-known constants so i don't see why they wouldn't just be hard-coded directly into client releases, no need to bother w/ mutable config",
        "created_at": "2023-03-31T05:32:43.181000+00:00",
        "attachments": null
    },
    {
        "author": "joyvoister",
        "category": "general",
        "parent": "",
        "content": "hello can anyone help me?",
        "created_at": "2023-03-31T06:07:49.390000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "general",
        "parent": "",
        "content": "yeh hardcoding probably good enough for public networks. I think devnets could get weird, but as long as they're overridable, not a big issue",
        "created_at": "2023-03-31T06:24:34.670000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "It would be a little bit of a hassle for devnets and testing environments where we change the slots per seconds and the genesis time, so rather than hardcoded would need to be configurable in something like the genesis.json.",
        "created_at": "2023-03-31T06:59:19.858000+00:00",
        "attachments": null
    }
]