[
    {
        "author": "axe1395",
        "category": "general",
        "parent": "",
        "content": "https://ethereum-magicians.org/t/eip-2937-set-indestructible-opcode/4571",
        "created_at": "2020-09-07T09:12:47.722000+00:00",
        "attachments": null
    },
    {
        "author": "axe1395",
        "category": "general",
        "parent": "",
        "content": "proposal to a new OPCODE",
        "created_at": "2020-09-07T09:12:56.643000+00:00",
        "attachments": null
    },
    {
        "author": "axe1395",
        "category": "general",
        "parent": "",
        "content": "important to the discussion of removing SELFDESTROY",
        "created_at": "2020-09-07T09:13:22.746000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "\u003c@!415548822983278593\u003e \u003c@!543900561460822016\u003e \u003c@!386690701343326219\u003e I've spent an hour writing some AA code: https://notes.ethereum.org/@axic/nonce-account-new-aa\n\nAnd found out that some parts of the spec were not clear, up until I've read it several times.",
        "created_at": "2020-09-07T20:01:06.109000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "I have no idea if I grasped any of the concepts well enough, so any feedback is welcome üôÇ",
        "created_at": "2020-09-07T20:02:21.430000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "And it is a messy code because I couldn't decide whether I go for readability or optimisation.",
        "created_at": "2020-09-07T20:03:44.044000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "i believe your chain id and nonce checks should happen before `paygas`",
        "created_at": "2020-09-07T20:04:04.843000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "also, i don't think this AA contract is protected from replays?",
        "created_at": "2020-09-07T20:04:35.075000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "It has the `tx_nonce` and the `nonce()` still increments according to the EIP?",
        "created_at": "2020-09-07T20:05:00.234000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "ah, you're right sorry üôÇ",
        "created_at": "2020-09-07T20:05:21.140000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "chain id though, i believe should be before",
        "created_at": "2020-09-07T20:05:29.692000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Just forgot to write the `let` statement for nonce üôÇ",
        "created_at": "2020-09-07T20:05:32.143000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "My aim was to do the bare minimum needed before paygas to still be within `VERIFICATION_GAS_CAP`. I think you are right, those two should be done prior to paygas.",
        "created_at": "2020-09-07T20:07:28.935000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "And the goal of this was to see how much gas overhead (thinking about the memory expansion overhead mostly) is it to wrap regular transactions into AA. This memory expansion overhead could be eliminated if keccak256/call could access calldata directly.",
        "created_at": "2020-09-07T20:08:41.800000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "in the minimal case, i don't think the nonce needs to be checked since it is already validated by the protocol before launching into the validation",
        "created_at": "2020-09-07T20:10:46.769000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "It is checked that the unsigned transaction RLP has the matching nonce with the account",
        "created_at": "2020-09-07T20:11:07.167000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "So I think *a nonce* must be included in data that is checked against a signature, and that nonce be validated against the account.",
        "created_at": "2020-09-07T20:11:58.737000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "yes i believe that is correct, by verifying the signature over the tx hash (nonce included) you can know that the nonce was not replayed by someone without the ability to construct a valid signature",
        "created_at": "2020-09-07T20:14:00.757000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "there is no way, however, to force AA contracts to calculate the tx hash using the nonce -- so its possible to write a contract with a freely updatable nonce",
        "created_at": "2020-09-07T20:14:48.275000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "By \"tx hash\" you mean the 2718-style complete transaction here, or the `data` field thereof?",
        "created_at": "2020-09-07T20:15:08.320000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "\u003e there is no way, however, to force AA contracts to calculate the tx hash using the nonce -- so its possible to write a contract with a freely updatable nonce\n\nSure, but I kept using `nonce()` as it is cheaper than sload/sstore.",
        "created_at": "2020-09-07T20:15:32.850000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "i don't mean anything specific for \"tx hash\" (different than the tx hash the protocol may know a tx by), i just mean the hash of data that is signed and validated by the AA contract",
        "created_at": "2020-09-07T20:16:30.195000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "this is up to the contract's discretion",
        "created_at": "2020-09-07T20:16:38.669000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "So the naive version of this was to call it a `sequence` and sstore/sload it, but since the EIP provides an incrementing nonce, it was a no brainer to keep using that.",
        "created_at": "2020-09-07T20:18:01.402000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Maybe I'm misunderstanding you?",
        "created_at": "2020-09-07T20:18:23.135000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "\u003e Sure, but I kept using `nonce()` as it is cheaper than sload/sstore.\ni think the thing is, right now the hash you're calculating (i think) is only over the tx payload, so its possible to replay a tx by just updating the tx's nonce",
        "created_at": "2020-09-07T20:18:25.455000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "From the EIP:\n\u003e A new EIP-2718 transaction with type `AA_TX_TYPE` is introduced. Transactions of this type are referred to as \"AA transactions\". Their payload should be interpreted as `rlp([nonce, target, data])`.\n\nLet's call this `rlp(...)` as `raw_tx`. It is not possible to access this `raw_tx` from within the EVM. \n\nThe EIP also states that `tx.nonce` must match `account.nonce` and it is incremented by 1.\n\nLastly the EIP provides a way to inspect `tx.nonce` (or `account.nonce`, given they are equivalent).\n\nMy code expects `tx.data` to contain a signature, followed by transaction parameters, including a nonce field. This nonce field must match `tx.nonce`.",
        "created_at": "2020-09-07T20:21:11.571000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "ah okay i see!",
        "created_at": "2020-09-07T20:22:04.387000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "i was assuming that the nonce was *not* in the `tx.data`",
        "created_at": "2020-09-07T20:22:45.200000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "i guess you do that because it's cheaper?",
        "created_at": "2020-09-07T20:23:11.979000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "The header comments have it explained, albeit possibly in a terrible way (my excuse is I wrote this code while reading the EIP in the last hour):\n\u003e // The input is encoded as:\n\u003e // 0...      32...     64...     96...                        128...           160...                                        192...        224...\n\u003e // v:uint256 r:uint256 s:uint256 nonce:uint32 padding:uint224 gasprice:uint256 chainid:uint32 gaslimit:uint64 target:uint160 value:uint256 data..",
        "created_at": "2020-09-07T20:23:36.179000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "\u003e i was assuming that the nonce was not in the tx.data\n\u003e i guess you do that because it's cheaper?\n\nIn the simple account model there needs to be a nonce. Since `tx.nonce` is not signed I need to have it duplicated. I do not see any other option really?\n\nThe only optimisation here is that instead of keeping a copy of nonce in the contract storage, we can rely on the `nonce()` opcode.",
        "created_at": "2020-09-07T20:25:37.173000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "ah maybe i should've read that before commenting ü§¶‚Äç‚ôÇÔ∏è",
        "created_at": "2020-09-07T20:25:45.827000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "so the AA contract should have complete freedom to define its signing scheme -- it could say that it will sign `keccak(nonce || tx.data)` and that can be recreated in the contract by storing `nonce()` in memory then hashing it with the data",
        "created_at": "2020-09-07T20:31:26.140000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "i could be overlooking something?",
        "created_at": "2020-09-07T20:31:36.076000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "The reason I put it there to make it easy for the code to hash it. No need to load from different parts or to copy memory around.",
        "created_at": "2020-09-07T20:32:41.021000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "But yeah, it could reuse the `nonce()` and reconstruct the data for hashing.",
        "created_at": "2020-09-07T20:33:36.728000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Initially I used https://eips.ethereum.org/EIPS/eip-2098 formatted `r vs` signature as input to save on calldata (memory expansion cost).",
        "created_at": "2020-09-07T20:35:46.565000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "I think one would need to do a couple of experiments depending on which cost is deemed better (memory expansion, memory copying, arithmetics, etc.)",
        "created_at": "2020-09-07T20:36:35.173000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "yep agreed",
        "created_at": "2020-09-07T20:36:49.782000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "By \"better\" I mean \"likely to decrease in cost\".",
        "created_at": "2020-09-07T20:37:00.327000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "where there any other particularly weird things about the EIP that were confusing?",
        "created_at": "2020-09-07T20:39:07.067000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Well, I was reading it on https://github.com/ethereum/EIPs/pull/2938/files which has all these comments displayed :)\n\nI think it is just a large body and one needs to go back and forth a few times. The ordering is written from the client implementer's perspective, and not from the AA-contract writer's perspective.",
        "created_at": "2020-09-07T20:41:22.364000+00:00",
        "attachments": null
    },
    {
        "author": "alita85",
        "category": "general",
        "parent": "",
        "content": "does anyone know the bls12 math pretty well that would be willing to answer some (probably trivial) questions?",
        "created_at": "2020-09-07T21:21:46.068000+00:00",
        "attachments": null
    },
    {
        "author": "0xashish.eth",
        "category": "general",
        "parent": "",
        "content": "probably just shoot the questions? i might know üò¨",
        "created_at": "2020-09-07T21:27:20.476000+00:00",
        "attachments": null
    },
    {
        "author": "alita85",
        "category": "general",
        "parent": "",
        "content": "- does section E.2.1 in the IETF accurately represent the process required to perform pairing on bls12-381 (https://tools.ietf.org/html/draft-irtf-cfrg-hash-to-curve-08#appendix-E.2.1)\n- what's the practical difference between G1 and G2 in the IETF documentation (https://tools.ietf.org/html/draft-irtf-cfrg-hash-to-curve-08#appendix-E.2.1), (https://tools.ietf.org/html/draft-irtf-cfrg-hash-to-curve-08#appendix-E.2.2)\n- what are the variables listed in the definitions of the different BLS12-381 stuff (https://tools.ietf.org/html/draft-irtf-cfrg-hash-to-curve-08#section-8.8.1)\n- do I need to create seperate methods for cofactor clearing? If so is there a very simple explanation like in section E.2.1?",
        "created_at": "2020-09-07T21:32:50.516000+00:00",
        "attachments": null
    },
    {
        "author": "alita85",
        "category": "general",
        "parent": "",
        "content": "thanks üôÇ",
        "created_at": "2020-09-07T21:32:55.441000+00:00",
        "attachments": null
    },
    {
        "author": "0xashish.eth",
        "category": "general",
        "parent": "",
        "content": "to answer the first question\u003e\u003e seems right but i do not hold the power to verify/guarantee anything. sorry üòÑ",
        "created_at": "2020-09-07T22:09:08.763000+00:00",
        "attachments": null
    },
    {
        "author": "alita85",
        "category": "general",
        "parent": "",
        "content": "no worries! (I will verify everything, of course; just looking to see if I'm on teh right track üôÇ",
        "created_at": "2020-09-07T22:10:57.645000+00:00",
        "attachments": null
    },
    {
        "author": "0xashish.eth",
        "category": "general",
        "parent": "",
        "content": "probably kobi Gurkan can help more",
        "created_at": "2020-09-07T22:12:23.892000+00:00",
        "attachments": null
    }
]