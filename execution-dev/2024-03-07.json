[
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Hello, following up on this \u003c@360491619402776577\u003e https://x.com/potuz_eth/status/1765704437228576956?s=20  Do all engines act like this? cc \u003c@758579010027782144\u003e, this would simplify our life quite a bit, we could send FCU blindly and only decide in the last moment which block to produce instead of withholding the late block FCU. This also simplifies the CL spec. FWIW Marius: on geth I see the following behavior:\n1. Block doesn't arrive at 4 seconds, I send an FCU to base on the parent. Geth reports that it started building a block \n2. Some time later (like a second) I see that the block with the given ID has been updated. (So I know the block is continuously being produced)\n3. Later the block for the slot arrives and I send a second FCU with different attributes. Geth reports that it started building this new block.\n4. Some time later I see that this second block is being updated, but I never see any message that the first one is updated. \n\nThis behavior is what prompted my question on Twitter.",
        "created_at": "2024-03-07T11:46:37.300000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "general",
        "parent": "",
        "content": "Hmm that sounds weird, lemme check in a bit",
        "created_at": "2024-03-07T12:06:42.942000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "general",
        "parent": "",
        "content": "It could be that the payload re-building of the first one errors once the building of the second one starts",
        "created_at": "2024-03-07T13:39:24.049000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "general",
        "parent": "",
        "content": "So, in Nethermind, both payloads are being improved concurrently. Of course, it would be great to check with your test cases (or hive tests), as it looks like you found edge cases for Geth, and it is not a common situation on networks.\n\nAs I understood it, being able to improve payloads concurrently is what would simplify the CL spec",
        "created_at": "2024-03-07T14:00:35.112000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "definitely, we have to deal with a lot of edge cases by not updating our head if we want to reorg, but it would be much easier to just update head and send two fcus, let the EL build both payloads and then we simply pick the right one at the start of the next slot",
        "created_at": "2024-03-07T14:02:14.512000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "general",
        "parent": "",
        "content": "In Besu, current behaviour is when we receive a new FCU with different payload params, we cancel the previous FCU's payload creation thread.\n\nNot sure how strongly tied to this impl any of the Besu team are, I will ask.\nOne possible issue is if a CL were to send many different payload params, we could eat up CPU but think it's fine since we can assume a well-behaved CL.",
        "created_at": "2024-03-07T21:23:23.216000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "This would definitely help us, and probably builders too. Not sure about other CLs but I would bet it's better for them too",
        "created_at": "2024-03-07T21:34:26.336000+00:00",
        "attachments": null
    }
]