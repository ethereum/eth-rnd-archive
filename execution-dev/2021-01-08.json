[
    {
        "author": "__lithp__",
        "category": "general",
        "parent": "",
        "content": "Just wrote up an idea for stateless ethereum which should drastically reduce how much we care about witness sizes, which I think gets us pretty close to having a workable stateless ethereum: https://ethresear.ch/t/the-great-alaskan-transaction-pipeline/8472",
        "created_at": "2021-01-08T08:54:20.980000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e Why not just make the delay be a fixed 1 block?",
        "created_at": "2021-01-08T08:55:43.594000+00:00",
        "attachments": null
    },
    {
        "author": "__lithp__",
        "category": "general",
        "parent": "",
        "content": "No particular reason, 1 block might be enough!",
        "created_at": "2021-01-08T08:57:01.625000+00:00",
        "attachments": null
    },
    {
        "author": "__lithp__",
        "category": "general",
        "parent": "",
        "content": "The biggest difficulty is that we can't know how much gas will be used until we actually run the transaction, so a fixed 1 block delay means a block which includes large transactions might be signing up the next miner to do too much work. Going the other direction: a block which includes many transactions with a high gas limit but where each transaction ends up consuming very little gas could effectively DOS the network. This kind of problem is why I decided upon a transaction queue but there could be a better solution",
        "created_at": "2021-01-08T08:59:49.486000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e Aha I see",
        "created_at": "2021-01-08T09:04:48.705000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e I guess EIP 1559 makes this easier, as you can just have the upper limit be on the amount of allocated gas",
        "created_at": "2021-01-08T09:05:08.703000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e While charging only for used gas",
        "created_at": "2021-01-08T09:05:19.108000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e Btw is this intended for fully stateless ethereum including stateless mining?",
        "created_at": "2021-01-08T09:06:00.640000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e As if you just want stateless verification, what's wrong with that verification being delayed by 10 seconds or whatever",
        "created_at": "2021-01-08T09:06:33.225000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e I guess one longer term comment is also that ~4 years from now, I fully expect us to have SNARKed witness capability, which means that witness size will be unambiguously not a problem. So making a big redesign for something that may no longer be a problem in 4 years may not be the best idea",
        "created_at": "2021-01-08T09:08:13.428000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e Unless there are other good reasons to delay state root calculation, which there may be!",
        "created_at": "2021-01-08T09:08:32.895000+00:00",
        "attachments": null
    },
    {
        "author": "__lithp__",
        "category": "general",
        "parent": "",
        "content": "I suspected 1559 was probably relevant! I should go read up on how it works, it would be neat if it gave us a nice solution here",
        "created_at": "2021-01-08T09:13:17.879000+00:00",
        "attachments": null
    },
    {
        "author": "__lithp__",
        "category": "general",
        "parent": "",
        "content": "Should have added a note to the post: this is for stateless ethereum where the miners still hold onto all of the state. I don't think there's a workable way to go fully stateless without some massive tradeoffs in the dynamic state access department",
        "created_at": "2021-01-08T09:14:25.962000+00:00",
        "attachments": null
    },
    {
        "author": "__lithp__",
        "category": "general",
        "parent": "",
        "content": "What do you mean \u003c@!273808422753796097\u003e ? You mean something like keeping things the way they are, but adding some protocol for propagating witnesses, stateless nodes just have to wait to be given a witness before they can verify blocks?",
        "created_at": "2021-01-08T09:17:30.846000+00:00",
        "attachments": null
    },
    {
        "author": "__lithp__",
        "category": "general",
        "parent": "",
        "content": "I think the concern everybody had with that was that nobody has any incentive to create / propagate witnesses",
        "created_at": "2021-01-08T09:18:00.920000+00:00",
        "attachments": null
    },
    {
        "author": "__lithp__",
        "category": "general",
        "parent": "",
        "content": "This seems to also be an argument against switching to binary tries or code merkleization or going for ReGenesis",
        "created_at": "2021-01-08T09:18:50.897000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e \u003e This seems to also be an argument against switching to binary tries or code merkleization or going for ReGenesis",
        "created_at": "2021-01-08T09:34:10.129000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e How so? The SNARKed witnesses would have to be binary too, to make proving faster",
        "created_at": "2021-01-08T09:34:21.829000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e The binary tree reforms have the side effect that they force the tree into a 2-children-to-1-parent 32-byte structure, which is convenient for SNARKing",
        "created_at": "2021-01-08T09:34:45.807000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e \u003e You mean something like keeping things the way they are, but adding some protocol for propagating witnesses, stateless nodes just have to wait to be given a witness before they can verify blocks?",
        "created_at": "2021-01-08T09:35:02.159000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e yeah basically",
        "created_at": "2021-01-08T09:35:04.169000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e \u003eI think the concern everybody had with that was that nobody has any incentive to create / propagate witnesses",
        "created_at": "2021-01-08T09:35:08.064000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e Surely creating witnesses is not hard? While executing a block just keep track of all accounts you access, get the merkle branches for them and then merge them?",
        "created_at": "2021-01-08T09:35:46.140000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e The issue with propagating is that the witnesses are much bigger so you're worried all nodes on the witness-carrying subnet would be selfish and that would make it hard to propagate the witness?",
        "created_at": "2021-01-08T09:36:44.718000+00:00",
        "attachments": null
    },
    {
        "author": "__lithp__",
        "category": "general",
        "parent": "",
        "content": "I agree with you, creating witnesses is not hard, and miners/nodes already show enough altruism that this doesn't seem like a big additional ask! I think the objections came from asking miners/nodes to propagate witnesses. If miners are given no incentive to send witnesses out to the network then anyone running a stateless node is relying on a potentially unstable equilibrium. LES is our current protocol which nobody serves, presumably because clients are too numerous and contribute nothing back",
        "created_at": "2021-01-08T09:43:50.609000+00:00",
        "attachments": null
    },
    {
        "author": "__lithp__",
        "category": "general",
        "parent": "",
        "content": "I should read more about how SNARKs will work",
        "created_at": "2021-01-08T09:46:38.337000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "With account abstraction, transaction validity will be executed against a stale state, and by the time the transaction is processed the transaction may no longer be valid.",
        "created_at": "2021-01-08T10:29:26.680000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e huh? I don't think account abstraction has that effect",
        "created_at": "2021-01-08T10:29:50.640000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e Even at network level, the pre-paygas portion of the execution is guaranteed to be unchanged",
        "created_at": "2021-01-08T10:30:17.181000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Even after v1 AA?",
        "created_at": "2021-01-08T10:30:38.645000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e I.. think so!",
        "created_at": "2021-01-08T10:30:46.704000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e the pre-paygas execution can only depend on that account's own state, and that state can't change except by a transaction from that same account",
        "created_at": "2021-01-08T10:31:21.032000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I'll take your word for it since my brain has repeatedly failed to fully grok AA correctly.  My neural pathways with regards to AA are FUBAR.",
        "created_at": "2021-01-08T10:31:35.800000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Who receives the transaction fees?",
        "created_at": "2021-01-08T10:34:57.452000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e the coinbase?",
        "created_at": "2021-01-08T10:35:08.580000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e that part doesn't need a witness",
        "created_at": "2021-01-08T10:35:14.449000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "The coinbase of the block that update the root, or the block that included the transaction?",
        "created_at": "2021-01-08T10:35:21.582000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e I would guess it should be the block that included the tx?",
        "created_at": "2021-01-08T10:35:39.950000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "We don't \"know\" (at concensus) final fees until the root is updated",
        "created_at": "2021-01-08T10:35:41.878000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Since we don't have consensus on gas used until then.",
        "created_at": "2021-01-08T10:35:59.682000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e right (and on validity for that matter)",
        "created_at": "2021-01-08T10:36:08.599000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e Even without abstraction, you don't know if a transaction's origin has enough eth to pay for gas ahead of time",
        "created_at": "2021-01-08T10:36:32.028000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Oh, you are thinking the included transactions wouldn't be validated *at all*?",
        "created_at": "2021-01-08T10:36:38.405000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "A miner could include complete garbage data for a transaction in a block?",
        "created_at": "2021-01-08T10:36:52.459000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e hmm, account abstraction definitely would lead to a situation close to that",
        "created_at": "2021-01-08T10:37:06.653000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I assumed that the transactions would be validated for validity at inclusion time, and then executed in the future.",
        "created_at": "2021-01-08T10:37:42.805000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "For AA this means that you *would* execute up to PAYGAS just to determine validity (but not actually deduct any gas at inclusion time).",
        "created_at": "2021-01-08T10:38:04.182000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e hmm, I guess you could do that",
        "created_at": "2021-01-08T10:38:25.269000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e But is there any actual harm from allowing blocks to include junk?",
        "created_at": "2021-01-08T10:38:40.696000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "That being said, I suppose I don't see any obvious reason why transactions **MUST** be valid.  The miner presumably is the one most incentivized to not include garbage transactions.",
        "created_at": "2021-01-08T10:38:43.628000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e right",
        "created_at": "2021-01-08T10:38:48.734000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "If we do that then I think we **MUST** have the coinbase who included the transaction be the one who receives the fees, rather than the coinbase who executed the transactons.",
        "created_at": "2021-01-08T10:39:18.331000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "But then we have the problem of miners having no incentive to actually execute when they produce a block.",
        "created_at": "2021-01-08T10:39:29.449000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "They are better off just executing 0 transactions, because it is less work.",
        "created_at": "2021-01-08T10:39:40.235000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "So we would need a \"nephew\" reward or something for the future block that actually executes a given transaction.  Perhaps part of the transaction fee is split between includer and executor?",
        "created_at": "2021-01-08T10:40:22.752000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Would this create any weird incentives for mining a fork to try to execute your own transactions?",
        "created_at": "2021-01-08T10:40:37.918000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "Splitting is definitely a bad idea",
        "created_at": "2021-01-08T13:59:51.799000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "For \"side channel payment\" reasons that we've heard about ad nauseam in EIP 1559 discussions",
        "created_at": "2021-01-08T14:00:16.941000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "What is the one-liner for \"side channel payments\"?",
        "created_at": "2021-01-08T14:20:27.808000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "If the decision-maker of transaction inclusion only gets 50% of the fee, then they will just accept zero-fee transactions and demand the actual fee to be paid through some extra-protocol means so they can claim 100%",
        "created_at": "2021-01-08T14:21:28.969000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "This is why in EIP 1559 there's a fixed basefee and it has to get burned",
        "created_at": "2021-01-08T14:21:43.835000+00:00",
        "attachments": null
    },
    {
        "author": "__lithp__",
        "category": "general",
        "parent": "",
        "content": "\u003c@301186049323958275\u003e current idea (at the bottom of the post) is to not give miners any flexibility in regards to how many transactions they execute. They must execute as many transactions as will fit in the block. So, what should happen is that the miner who includes the transaction gets the full fee. The miner who \"executes\" the transaction by realizing the state root gets nothing for that act. (But they are rewarded with a block reward for having mined a valid block)",
        "created_at": "2021-01-08T18:23:52.076000+00:00",
        "attachments": null
    },
    {
        "author": "__lithp__",
        "category": "general",
        "parent": "",
        "content": "This shouldn't have an impact on AA. Future state roots are entirely predictable so miners will be able to only ever include valid transactions. There's no way to stop them from including invalid transactions but once execution gets to those txns they will be skipped and the including miner will earn no revenue.",
        "created_at": "2021-01-08T18:28:04.870000+00:00",
        "attachments": null
    },
    {
        "author": "__lithp__",
        "category": "general",
        "parent": "",
        "content": "-\nI should clarify in the post: execution happens exactly as if transactions are executed in the block in which they were included.\n\nThe state root is updated later, but for all intents and purposes the transaction has executed at the time it is included. AA will not be running against a \"stale\" state root, but against a live state root which has simply not been committed to a block yet.",
        "created_at": "2021-01-08T18:31:35.102000+00:00",
        "attachments": null
    }
]