[
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "I doubt I can find the goerli history required, but I've switched our test back to running in separate processes so that we get non-deterministic hash map iteration again and made it run more frequently to see if I can find another case.",
        "created_at": "2024-09-30T03:06:29.309000+00:00",
        "attachments": []
    },
    {
        "author": "jwasinger",
        "category": "general",
        "parent": "",
        "content": "was it running a version of geth \u003c1.14.0?  We shipped a [change](https://github.com/ethereum/go-ethereum/commit/58a3e2f1802eb7dd8e893a6a7be7f009edeeffd8) in 1.14.0 which addressed an edge case where trie node access was non-deterministic in a specific case involving deletion.",
        "created_at": "2024-09-30T05:34:52.303000+00:00",
        "attachments": []
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Ah probably. It was from December last year. Excellent that would mean we did understand the problem correctly and you also found it and fixed it so Iâ€™d expect to not see any failures from my test runs and we can continue moving over to use executionWitness to get prestates. Still need to address the difference between geth and reth but a geth to geth prestate transfer would be an excellent first step.",
        "created_at": "2024-09-30T07:16:54.213000+00:00",
        "attachments": []
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Checking release dates it was definitely pre 1.14.",
        "created_at": "2024-09-30T07:19:01.721000+00:00",
        "attachments": []
    },
    {
        "author": "karalabe",
        "category": "general",
        "parent": "",
        "content": "\u003c@340345049063882753\u003e Interestingly, how did you use our witness builder pre-1.14, because it was shipped later. Or are you running some own code that collects the witness?",
        "created_at": "2024-09-30T07:54:34.766000+00:00",
        "attachments": []
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "The current implementation is using `debug_dbGet` to get the world state trie data as its needed by the block execution in op-program.  It can run in both online and offline modes - in online mode it will make the RPC calls required to fetch the data and store it to disk.  In offline mode it only reads from disk.  The test we have processes a section of the chain in online mode and checks that we get the expected result (ie the canonical chain should be valid) and then reruns that same section of the chain in offline mode to confirm all data was stored.",
        "created_at": "2024-09-30T08:21:24.871000+00:00",
        "attachments": []
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "We're very keen to move away from `debug_dbGet` and start using `debug_executionWitness` because dbGet requires a hash scheme node and I'm really hoping the work to support path scheme archive nodes lands (hopefully with a configurable amount of world state history to keep).  But also because we'd like to be able to use either op-geth or op-reth as the source of witness data for client diversity (which can then be used by either the geth based op-program or the revm based kona).",
        "created_at": "2024-09-30T08:24:25.090000+00:00",
        "attachments": []
    },
    {
        "author": "karalabe",
        "category": "general",
        "parent": "",
        "content": "Our witness generator will probably outperform that dbGet by many orders of magnitude. We are using the snapshots for execution and pulling proofs from disk concurrently in the background + there's only one RPC RTT to get the witness vs back and forth on db_get",
        "created_at": "2024-09-30T16:17:29.894000+00:00",
        "attachments": []
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Yeah absolutely. `debug_dbGet` is way better than abusing `eth_getProofs` as the original PoC did (and I think it still missed some cases) but we're very keen for `debug_executionWitness`. Next step is to try and convince RPC providers to support it...",
        "created_at": "2024-09-30T20:41:19.485000+00:00",
        "attachments": []
    }
]