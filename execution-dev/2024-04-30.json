[
    {
        "author": "gakonst",
        "category": "general",
        "parent": "",
        "content": "Bump - anyone? ^^",
        "created_at": "2024-04-30T03:16:08.601000+00:00",
        "attachments": []
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "I have a question regarding EIP 7002. The spec states:\n\n`    sstore(WITHDRAWAL_REQUEST_PREDEPLOY_ADDRESS, queue_storage_slot, msg.sender)` (for `add_withdrawal_request`)\n\nAnd :\n\n`source_address = address(sload(WITHDRAWAL_REQUEST_PREDEPLOY_ADDRESS, queue_storage_slot)[0:20])` (in `dequeue_withdrawal_requests`)\n\nSince EVM is a 256bit/32-byte system should this not be:\n\n\n`source_address = address(sload(WITHDRAWAL_REQUEST_PREDEPLOY_ADDRESS, queue_storage_slot)[12:32])`?\n\nOtherwise you have to LSHIFT the `msg.sender` by 12 bytes when storing it?\n\nNote: bytecode does not LSHIFT it:\n\n```\ncaller\ndup2\nsstore\n```\n\nAlso, this looks wrongly padded?\n\n```\n    sstore(WITHDRAWAL_REQUEST_PREDEPLOY_ADDRESS, queue_storage_slot + 1, validator_pubkey[0:32])\n    sstore(WITHDRAWAL_REQUEST_PREDEPLOY_ADDRESS, queue_storage_slot + 2, validator_pubkey[32:48] ++ amount)\n```\n\nEDIT: ah, ok, wait, by the EVM storage rules on how these values are saved the EVM will actually return the values with the correct offsets",
        "created_at": "2024-04-30T03:37:17.862000+00:00",
        "attachments": []
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Also, the fee price is updated at the end of the block. So it is possible to fill the entire block with requests and pay a minimal amount, then the next block now due to the exponential the price could spike extremely high",
        "created_at": "2024-04-30T03:38:24.673000+00:00",
        "attachments": []
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "And the final question, what if the tx sends too much fee? The excess sent is not returned. Is this fair?",
        "created_at": "2024-04-30T03:38:43.651000+00:00",
        "attachments": []
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Another question ðŸ™‚\n\n`encoded = WITHDRAWAL_REQUEST_TYPE ++ rlp([source_address, validator_pubkey, amount])`\n\nThis is the encoding of the EIP 7685 request type. `amount` is of type `uint64` - I assume this means I strip any leading zero bytes here?",
        "created_at": "2024-04-30T04:10:44.390000+00:00",
        "attachments": []
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Why is `0x049d` put into slot 0 at the deployment of the withdrawals contract of 7002? ( \u003c@543900561460822016\u003e ?)",
        "created_at": "2024-04-30T06:56:03.680000+00:00",
        "attachments": []
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Ah ok found it https://github.com/lightclient/7002asm/pull/12\n\nhttps://github.com/ethereum/EIPs/pull/8477/files\n\nThis is not noted in the EIP anywhere",
        "created_at": "2024-04-30T07:17:09.028000+00:00",
        "attachments": []
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Also, since the queue is empty, the excess withdrawals does not reduce - right? So the payment fee for withdrawals stays extremely high",
        "created_at": "2024-04-30T07:17:27.519000+00:00",
        "attachments": []
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "If I test this myself (my implementation of mocking the system call might be wrong) then this does not seem to reduce it at all",
        "created_at": "2024-04-30T07:18:00.378000+00:00",
        "attachments": []
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Oh right",
        "created_at": "2024-04-30T07:19:27.200000+00:00",
        "attachments": []
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "\u003e Each system call will check excess == 1181 and use 0 in it's place if so. This of course will only be true for the first call following activation of Prague.",
        "created_at": "2024-04-30T07:19:33.897000+00:00",
        "attachments": []
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "This is not part of the spec / EIP (it is not listed in the pseudocode as well)",
        "created_at": "2024-04-30T07:19:36.433000+00:00",
        "attachments": []
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Hmm I did not go super deep into this but this statement: \"This of course will only be true for the first call following activation of Prague.\" is not entirely true (?) because if it ever reaches 1181 then it will still reset to 0 if I read this geas code",
        "created_at": "2024-04-30T07:30:10.722000+00:00",
        "attachments": []
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Note: this also means that on the fork block itself if you try to perform a withdrawal this does not work, since the system call is performed after the withdrawals (so after the txs)",
        "created_at": "2024-04-30T07:39:19.733000+00:00",
        "attachments": []
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "I think the EIP should note that in 7002 one should not try to mock the system call but instead do the actual call. In 4788 I think most / all clients mock the system call, but in 7002 this is not necessary: one can do the EVM system call and then use the returndata to get whatever requests were made. This is not clear from the EIP. I have started doing the system mock call because I did not realize that the \"return\" in the pseudocode actually also is the returndata in the contract.",
        "created_at": "2024-04-30T08:03:04.668000+00:00",
        "attachments": []
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "Hi \u003c@508125616940515329\u003e \n\n* I think you might be right re: the address being retrieved by the wrong offsets? Since sstore is always on 32 byte values, it means msg.sender must be coming from stack and is therefore, by default, left padded.\n* padding looks correct to me? can you expand on the issue you see?\n* yes it is possible to fill the entire block with minimal cost exits. I think we calculated it and it would fill the queue for ~6 minutes. doesn't seem like a major issue\n* there is a getter for the fee so that txs don't send the wrong amount to the contract. the call to return funds would both be expensive and a lot more additional complexity\n* yes amount shouldn't have any leading 0s\n* to have an excess of 1181, someone would have to spend more than 1 trillion ether. that is obviously impossible. one thing i didn't consider is if we increase the gas limit in the future it means someone might be able to submit enough 1 wei fee exits requests to get to 1181. i'll make a not to bump this number up.\n* yes clients should do the actual call. i think clients should also do the system call for 4788 but it is up to them to decide to do the optimization ðŸ™‚ it's also possible to mock the system call here, just much more complicated.",
        "created_at": "2024-04-30T13:09:49.065000+00:00",
        "attachments": []
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Great thanks for the feedback!",
        "created_at": "2024-04-30T13:23:38.334000+00:00",
        "attachments": []
    },
    {
        "author": "gakonst",
        "category": "general",
        "parent": "",
        "content": "bump -- can we get a note from ppl working on verkle on this? we really need to get concrete sooner than later, we unfortunately haven't had bandwidth to do this work ourselves yet but we're preparing. the concrete perf matters due to 1) the interaction with the fork choice rule in MEV timing games, 2) how to think about it relative to SNARK proving",
        "created_at": "2024-04-30T18:11:54.148000+00:00",
        "attachments": []
    },
    {
        "author": "marekm3498",
        "category": "general",
        "parent": "",
        "content": "We are going to work on Verkle and Merkle benchmarks, but we're not there yet ðŸ˜‰",
        "created_at": "2024-04-30T18:40:31.390000+00:00",
        "attachments": []
    }
]