[
    {
        "author": "siladu",
        "category": "general",
        "parent": "",
        "content": "The fact the EL only knows about `max_blobs_per_block` transiently during block proposal does cause a bit of nastiness on the EL side. I think it works within the bounds of the protocol, but I've found at least `eth_feeHistory` could break since we don't know the correct `max_blobs_per_block` to use at any point in time other than block creation.",
        "created_at": "2024-12-06T05:13:22.133000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "general",
        "parent": "",
        "content": "Specifically the `blobGasUsedRatio` https://github.com/ethereum/execution-apis/blob/0066eeb83f0365c3dfdfeb67e37151c3432e7a7d/src/eth/fee_market.yaml#L102-L104\n\u003e These are calculated as the ratio of blobGasUsed and the max blob gas per block.",
        "created_at": "2024-12-06T05:19:31.280000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "general",
        "parent": "",
        "content": "It does feel weird that EL can't fully validate block, but need to trust CL",
        "created_at": "2024-12-06T15:27:13.082000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "seems reasonable to have the max_blobs_per_block in the EL header?",
        "created_at": "2024-12-06T15:50:04.801000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "general",
        "parent": "",
        "content": "Yeah it does",
        "created_at": "2024-12-06T16:11:06.451000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "general",
        "parent": "",
        "content": "Would this require changes to the CL? Do we need to pass it in `new_payload`?",
        "created_at": "2024-12-06T16:45:56.174000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "if we added, yes you would",
        "created_at": "2024-12-06T16:51:52.598000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "general",
        "parent": "",
        "content": "Got it. Thanks. I'll make a PR for this now.",
        "created_at": "2024-12-06T16:52:29.866000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "general",
        "parent": "",
        "content": "https://github.com/ethereum/consensus-specs/pull/4042",
        "created_at": "2024-12-06T17:26:26.431000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "general",
        "parent": "",
        "content": "Please approve if you think this is necessary.",
        "created_at": "2024-12-06T17:27:13.530000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "since we already when through the work of specifying things in terms of blob gas, should we use that unit instead of blobs?",
        "created_at": "2024-12-06T17:29:49.022000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "i get it is another level of indirection, but the base fee is per blob gas rn (unless that also changed?)",
        "created_at": "2024-12-06T17:31:25.539000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "general",
        "parent": "",
        "content": "This is for the field in the EL header right? Not about the values passed from CL to EL.",
        "created_at": "2024-12-06T17:35:58.634000+00:00",
        "attachments": null
    },
    {
        "author": "s1na",
        "category": "general",
        "parent": "",
        "content": "I think it wouldn't be the first time. EL already assumes length of withdrawals is checked by CL",
        "created_at": "2024-12-06T17:36:32.192000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "general",
        "parent": "",
        "content": "That is true, good argument. I thing max blobs num is something that is effecting tx pool and potentially how many blobs would tx want to use, they would need to ask CL for this info",
        "created_at": "2024-12-06T18:46:16.135000+00:00",
        "attachments": null
    },
    {
        "author": "s1na",
        "category": "general",
        "parent": "",
        "content": "So we do get max blob count on forkchoiceUpdated and can use that building the block. But I did hit an issue just now where our blob db somehow needs the max blob count. Will have to see how to work around it",
        "created_at": "2024-12-06T18:48:45.551000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "general",
        "parent": "",
        "content": "We have some tx pool and blob structures such as caches that are sized around the max blob count but we figured it was ok to over-provision, eg assume max blobs = 128 or whatever we think the max may eventually get to",
        "created_at": "2024-12-06T19:40:02.619000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "your question still stands about the fee market apis though right?",
        "created_at": "2024-12-06T19:51:03.354000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "general",
        "parent": "",
        "content": "Yes",
        "created_at": "2024-12-06T19:51:56.427000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "general",
        "parent": "",
        "content": "It would make things easier for sure but perhaps a bit heavyweight for the sake of serving an out-of-protocol api? \n\nStruggling to see any other way without introducing an inaccuracy across a block range request with eth_feehistory - it’s a fork boundary edge case though. Could potentially get away with only knowing the latest block’s max blobs",
        "created_at": "2024-12-06T19:52:10.340000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "general",
        "parent": "",
        "content": "Eg transient in newpayload (don’t store in EL block header) and then clients can cache",
        "created_at": "2024-12-06T19:54:02.218000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "general",
        "parent": "",
        "content": "Or can we just derive from the versioned hashes already?",
        "created_at": "2024-12-06T19:55:34.350000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "can't be derived from the versioned hashes already",
        "created_at": "2024-12-06T19:56:15.336000+00:00",
        "attachments": null
    }
]