[
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "SELFDESTRUCT(x):\n1. Moves all ether of current account to x\n2. Marks current account as to-be destroyed\nAdd end of transaction:\n3. Destroy/delete account from trie (*only in case that the contract was created in this transaction. Does not apply to 7702-created delegates)\n\nIt's often confusing but the gotcha is the two steps, first is moving the eth and then at \"the end of the transaction\" delete all accounts marked as selfdestruct",
        "created_at": "2026-01-22T14:00:46.573000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Would we have been asserting that if the account does not have 0 ETH at the end of the transaction then the transaction reverts?  That would have avoided the \"loophole\".",
        "created_at": "2026-01-22T14:36:49.219000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "What's the loophole here?\nIf account is created as contract and selfdestructs in same transaction, entire account is destroyed, so post-tx the account does not exist",
        "created_at": "2026-01-22T14:44:31.376000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Correct, and it may cease to exist with ETH in it, which means the ETH \"disappears\".",
        "created_at": "2026-01-22T15:22:33.195000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Yes, the only way to burn eth ðŸ™‚ Not a bug, but a feature (?) ðŸ™‚",
        "created_at": "2026-01-22T15:25:17.629000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "(its a nasty edge case)",
        "created_at": "2026-01-22T15:25:23.783000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "If we would rebuild evm we would likely get rid of this edge case. Or actually get rid of selfdestruct",
        "created_at": "2026-01-22T15:25:49.945000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "For the logs, here is another fun edge case, what if we selfdestruct to coinbase? Fees go to coinbase and then after tx it gets removed, so coinbase is now non-existent. How should these logs be accounted for?",
        "created_at": "2026-01-22T15:28:23.569000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "(so coinbase of a block is the createX target of a to-be-created contract, which gets created in tx A and in the same tx thus also destroyed)",
        "created_at": "2026-01-22T15:28:52.059000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "This is the debate.  Do we really need this, and if so why don't we just implement it as a precompile instead of this insane hack that 3 people know how to do, and we could log it when it happens pretty easily?",
        "created_at": "2026-01-22T15:31:05.681000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "general",
        "parent": "",
        "content": "it's covered under the current spec:  a transfer log gets emitted for fee payment, and then a burn log gets emitted when the account is removed.  Definitely a good test case to have though.",
        "created_at": "2026-01-22T16:35:59.742000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "general",
        "parent": "",
        "content": "The burn feature is just a side-effect of the compromise we made when we half-removed self-destruct and left open the ability to create ephemeral contracts.\n\nApparently people are making use of these kind of contracts and we didn't want them to lose funds.",
        "created_at": "2026-01-22T16:42:18.953000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "general",
        "parent": "",
        "content": "I think it's worth removing the ability to create ephemeral contracts if there's a viable route for currently-affected contracts to transition before it goes live, and the overall potential losses from those that can't are very low.",
        "created_at": "2026-01-22T16:45:51.697000+00:00",
        "attachments": null
    }
]