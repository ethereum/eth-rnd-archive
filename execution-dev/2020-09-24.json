[
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "I have a question about block header padding, cannot seem to find this explicitly in the yellow paper. The B values are byte-buffers and thus the padding is known. I am assuming that for all N values, any extra left-padded zeros are removed? If a block is mined which has extra zeros (i.e. block number 1 which does not have 0x01 as number but 0x0001) is this invalid or is it accepted?",
        "created_at": "2020-09-24T14:23:27.847000+00:00",
        "attachments": [
            {
                "type": "",
                "origin_name": "YlYNBn4zwm0AAAAASUVORK5CYII.png",
                "content": "9af32716cc669a9af78be93aea65990350261a43d0eabd5805aac49f2c027c14"
            }
        ]
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e not valid - the hash would be different",
        "created_at": "2020-09-24T14:24:03.364000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e I mean, 0x01 and 0x001 is the same until you RLP that",
        "created_at": "2020-09-24T14:24:22.219000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Yes, the hash is different, but you could technically still mine on that block",
        "created_at": "2020-09-24T14:24:23.405000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e nope",
        "created_at": "2020-09-24T14:24:30.373000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e because it is the same number",
        "created_at": "2020-09-24T14:24:36.990000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e and 0x001 is not a valid RLP",
        "created_at": "2020-09-24T14:24:42.607000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e for number",
        "created_at": "2020-09-24T14:24:45.430000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "But 0x0001 is?",
        "created_at": "2020-09-24T14:24:50.638000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e sorry, I mean 0x0001, hm, I see your point",
        "created_at": "2020-09-24T14:25:13.702000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e I wonder if this is potentially leading to some serious consequences",
        "created_at": "2020-09-24T14:25:45.491000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e but probably not because other clients will serialize to 0x01 when verifying hash and they will discard the header",
        "created_at": "2020-09-24T14:26:09.518000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "```javascript\n\u003e rlp = require('rlp')\n\u003e rlp.encode(Buffer.from('01', 'hex'))\n\u003cBuffer 01\u003e\n\u003e rlp.encode(Buffer.from('0001', 'hex'))\n\u003cBuffer 82 00 01\u003e\n```",
        "created_at": "2020-09-24T14:26:19.049000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e so you serialize to 0x0001 and hash, send it around",
        "created_at": "2020-09-24T14:26:21.211000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e and other nodes will just ignore it",
        "created_at": "2020-09-24T14:26:27.054000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e because when verifying hash they will use 0x01",
        "created_at": "2020-09-24T14:26:37.683000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e and the hash will not match so the header will be rejected",
        "created_at": "2020-09-24T14:26:52.462000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Right in that case the block is invalid because ethash will throw",
        "created_at": "2020-09-24T14:27:02.655000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "I think the main question here is if the block with 0x0001 as number is a valid or invalid block",
        "created_at": "2020-09-24T14:27:24.213000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "(as block number)",
        "created_at": "2020-09-24T14:27:32.567000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e not even ethash",
        "created_at": "2020-09-24T14:27:35.275000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e just the hash",
        "created_at": "2020-09-24T14:27:37.666000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e ethash too of course",
        "created_at": "2020-09-24T14:27:43.052000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e but it will be much faster to just verify the header hash mismatch",
        "created_at": "2020-09-24T14:27:54.495000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e ethash uses prehash (hash of header less mix and nonce)",
        "created_at": "2020-09-24T14:28:10.418000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Oh yes you are right üëç But it would still be safer to make the 0x0001 block invalid. So it'd be nice to hear if such block is valid or not",
        "created_at": "2020-09-24T14:29:09.820000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "It depends of course on the encoding, but it would not be good if one client would accept it and the other would not (due to differences in how these are hashed/validated)",
        "created_at": "2020-09-24T14:29:31.306000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e Nethermind would not and I think Geth and Parity would neither",
        "created_at": "2020-09-24T14:29:52.607000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e I mean, hmmm",
        "created_at": "2020-09-24T14:30:13.283000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "It should be part of the consensus rules right",
        "created_at": "2020-09-24T14:30:20.573000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e there is n interesting thing",
        "created_at": "2020-09-24T14:30:29.590000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e if you make the RLP with 0x0001 but calculate hash of the RLP with 0x01",
        "created_at": "2020-09-24T14:30:48.857000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e then you publish this RLP with this hash",
        "created_at": "2020-09-24T14:30:54.557000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e then I think the network could potentially accept it",
        "created_at": "2020-09-24T14:31:04.765000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e and so the clients would store the 0x0001 rlp - but I am not 100% sure",
        "created_at": "2020-09-24T14:31:31.939000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e it depends on the RLP validators",
        "created_at": "2020-09-24T14:31:37.577000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "üòÖ any place where I can escalate this issue? Or is this the right place for it?",
        "created_at": "2020-09-24T14:32:12.503000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e security@ethereum.org",
        "created_at": "2020-09-24T14:32:28.303000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e actually non issue",
        "created_at": "2020-09-24T14:33:15.425000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e because when you propagate headers you propagate them without hash...",
        "created_at": "2020-09-24T14:33:27.179000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e hmmm but RLP would still be accepted",
        "created_at": "2020-09-24T14:33:37.118000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "I'll ask some clients first before escalating to security",
        "created_at": "2020-09-24T14:34:57.828000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e yup, got it confirmed that you can have both representation accepted by Nethermind",
        "created_at": "2020-09-24T14:40:12.926000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e [Test]\n        public void Can_decode_tricky()\n        {\n            BlockHeader header = Build.A.BlockHeader\n                .WithMixHash(Keccak.Compute(\"mix_hash\"))\n                .WithTimestamp(2730)\n                .WithNonce(1000)\n                .TestObject;\n            HeaderDecoder decoder = new HeaderDecoder();\n            Rlp rlp = decoder.Encode(header);\n            rlp.Bytes[2]++;\n            string bytesWithAAA = rlp.Bytes.ToHexString();\n            bytesWithAAA = bytesWithAAA.Replace(\"820aaa\", \"83000aaa\");\n            \n            rlp = new Rlp(Bytes.FromHexString(bytesWithAAA));\n            var decoderContext = new Rlp.ValueDecoderContext(rlp.Bytes);\n            BlockHeader decoded = decoder.Decode(ref decoderContext);\n            decoded.Hash = decoded.CalculateHash();\n            Assert.AreEqual(header.Hash, decoded.Hash, \"hash\");\n        }",
        "created_at": "2020-09-24T14:40:13.679000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e timestamp 2730 is 0aaa, I replaced it with 000aaa",
        "created_at": "2020-09-24T14:40:40.210000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e hen changed the rlp prefix to changed the full header rlp length from 508 to 509",
        "created_at": "2020-09-24T14:40:56.540000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e both were accepted with the same hash",
        "created_at": "2020-09-24T14:41:02.332000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "I find this suspicious. Checking with geth",
        "created_at": "2020-09-24T14:43:09.850000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Wait you changed the RLP length and it now got the same hash?",
        "created_at": "2020-09-24T14:44:40.687000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Does RLP hashing internally strip zeros?",
        "created_at": "2020-09-24T14:44:57.635000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "general",
        "parent": "",
        "content": "Generally, geth doesn't store the network-rlp. But the re-encoded rlp. So even if there was some ambiguous rlp on input, the hash would be calculated from the encoded (canonicalized) form, and that's what we'd store. I think it's probably a non-issue if a client accepts a malformed rlp",
        "created_at": "2020-09-24T14:50:17.693000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "The encoded one would then strip zeros on these number values I assume? I'd say it would be an issue if some clients accept the malformed rlp and the others do not, especially if the hashes of these blocks are different (this would be caused because one client strips zeros and the others do not)",
        "created_at": "2020-09-24T14:52:11.375000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e no, if the hashes do not match then you immediately see the problem :)",
        "created_at": "2020-09-24T14:53:15.341000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e we also publish to network reencoded headers",
        "created_at": "2020-09-24T14:53:29.688000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Oh wait üòÖ",
        "created_at": "2020-09-24T14:53:38.579000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e which we actually would like to optimize to be able to save and serve whatever comes and goes",
        "created_at": "2020-09-24T14:53:48.191000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Yes you are right",
        "created_at": "2020-09-24T14:53:50.894000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e generally rather non issue",
        "created_at": "2020-09-24T14:54:07.503000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Yeah I forgot you can just re-encode it",
        "created_at": "2020-09-24T14:54:13.927000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "üëç",
        "created_at": "2020-09-24T14:54:21.875000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "It should not be an issue but it would be cleaner to generally accept that these numbers are stripped of zeros to canonicalize them",
        "created_at": "2020-09-24T14:54:51.886000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctkstanczak\u003e I have added a test and I am withdrawing from the discussion :)",
        "created_at": "2020-09-24T14:58:17.642000+00:00",
        "attachments": null
    },
    {
        "author": "acoglio",
        "category": "general",
        "parent": "",
        "content": "\u003e I have a question about block header padding, cannot seem to find this explicitly in the yellow paper. The B values are byte-buffers and thus the padding is known. I am assuming that for all N values, any extra left-padded zeros are removed? If a block is mined which has extra zeros (i.e. block number 1 which does not have 0x01 as number but 0x0001) is this invalid or is it accepted?\n\u003c@!508125616940515329\u003e It looks like Equation (187) in Appendix B of the Yellow Paper confirms your assumption: numbers are converted to base 256 big endian without leading zeros, which is '01' for 1 (and '' for 0).",
        "created_at": "2020-09-24T16:44:58.615000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "You are right \u003c@!564638213512101942\u003e, thanks a lot for this reference üòÑ",
        "created_at": "2020-09-24T16:48:25.679000+00:00",
        "attachments": null
    }
]