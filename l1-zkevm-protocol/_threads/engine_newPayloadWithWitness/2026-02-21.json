[
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Got it, this makes sense. I'm wondering if you have considered storing each witness on disk as a file. I'm wondering if it would be more efficient to read / stream bytes from disk rather than performing a database lookup. I'm not sure about this, but just a thought. I'm interested to hear your opinion.",
    "created_at": "2026-02-21T06:13:23.951000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Very insightful, great work on this! I think a TCP stream is the way to go. <@944007601400741989> Would you be able to design and propose an application layer wire protocol for the TCP stream that would fulfil our requirements please?",
    "created_at": "2026-02-21T06:41:02.592000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "cc: <@427491045308235776> <@774033563732541451>  for input",
    "created_at": "2026-02-21T06:41:20.715000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "<@944007601400741989> It would also be great if you could benchmark streaming bytes from file vs doing a database lookup to see how they differ. My intuition is that if we want a zero-copy solution then streaming from file is going to be superior compared to storing witnesses in db.",
    "created_at": "2026-02-21T06:46:04.207000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "From an implementation perspective, I think we can use `sendfile` kernel call to transfer data from the file to the socket efficiently without entering user space -https://man7.org/linux/man-pages/man2/sendfile.2.html.",
    "created_at": "2026-02-21T07:16:33.403000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Does this assume a prover is running an EL?",
    "created_at": "2026-02-21T12:36:17.989000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "No, there are no assumptions on the prover. This is exclusively changes related to the EL.",
    "created_at": "2026-02-21T12:38:09.317000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Prover would connect to the EL via a network connection.",
    "created_at": "2026-02-21T12:38:30.726000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "However it assumes that the connection between the prover and EL is unencrypted i.e. they operate in the same subnet",
    "created_at": "2026-02-21T12:39:36.916000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "If we want to add encryption on the channel then we lose the performance benefits of using `sendfile`",
    "created_at": "2026-02-21T12:40:16.988000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Wouldn‚Äôt this assume that the same entity running the prover is also running an EL?",
    "created_at": "2026-02-21T12:41:42.449000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Yes",
    "created_at": "2026-02-21T12:41:56.623000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Provers and EL's should be within the same subnet",
    "created_at": "2026-02-21T12:42:07.958000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Ah yeah that‚Äôs what I meant here",
    "created_at": "2026-02-21T12:42:14.805000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Right, yes they must be in the same subnet",
    "created_at": "2026-02-21T12:42:26.282000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "What happens if the CL asks for a proof of some block, but the prover hasn‚Äôt seen it or the prover is on a fork?",
    "created_at": "2026-02-21T12:43:01.634000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "If the EL that the prover is connected to has never seen the block, then it won't be able to generate a witness. But I think this is orthogonal to RPC design?",
    "created_at": "2026-02-21T12:44:46.810000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "I think it's a reasonable expectation that provers should run an EL client and prover on the same subnet.",
    "created_at": "2026-02-21T12:47:17.265000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Yep this is more related to whether we assume the prover and the EL are ran by the same entity ‚Äî or maybe a better way to phrase is it whether the builder and the prover would need to to be in the same subnet",
    "created_at": "2026-02-21T12:47:29.500000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "I think it makes distributed proving harder in the future and also the EL state is expected to grow in the future, so a prover now needs to deal with the storage requirements of the L1",
    "created_at": "2026-02-21T12:49:44.074000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Could you elaborate on this?",
    "created_at": "2026-02-21T12:50:22.311000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "When we consider that in practice builders and provers are the same entity I don't think it introduces any new assumptions that woulnd't already be there.",
    "created_at": "2026-02-21T12:54:18.146000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "For the state, currently if we assume that a prover is not connected to an EL then it‚Äôs the job of the builder(who can be a different entity) to send the witness to the prover\n\nFor distributed proving, the idea was that instead of requiring 16 GPUs for one node, we could have four different entities all make the proof collaboratively with four GPUs each for example, these nodes would ideally be ‚Äústateless‚Äù",
    "created_at": "2026-02-21T12:54:27.444000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Yeah I agree with this ‚Äî though I think we haven‚Äôt made any design decisions to preclude builders being different from provers (yet)",
    "created_at": "2026-02-21T12:55:37.111000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Prover nodes in a distributed cluster don't receive witness data from an EL. They receive segments to prove from the orchestrator. At least under the current design. If we migrate to a new guest pattern, then this would change.",
    "created_at": "2026-02-21T12:57:13.931000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Maybe it‚Äôs necessary that this is needed (I think tradeoffs here should ideally be intentional)",
    "created_at": "2026-02-21T12:57:27.778000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Is the alternative that the prover receives the witness from the remote participant?",
    "created_at": "2026-02-21T13:00:01.466000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "I don't think these ideas are at odds. Either way, the remote participant would need to fetch the witness from their EL to be able to send it to the prover.",
    "created_at": "2026-02-21T13:00:52.402000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Yeah in the current design this makes sense and the orchestration would be done on the riscv level ‚Äî I was thinking that the builder would be the orchestrator and each prover is proving a section of the block ‚Äî so the builder sends out chunks of a block + the corresponding execution witness",
    "created_at": "2026-02-21T13:02:54.862000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "I guess at that point, you have a sophisticated builder with a very different setup, and the idea of fetching witnesses from an EL is no longer a thing. You would just build the witness data as you build the block.",
    "created_at": "2026-02-21T13:04:46.847000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Yeah so the prover is essentially stateless and doesn‚Äôt know about the Ethereum state ‚Äî it could be that the same entity is running a builder but it could also not be (ie they may not be on the same network)",
    "created_at": "2026-02-21T13:06:23.003000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Yep this makes sense ‚Äî though once the witness is built from the EL, if the prover and the builder are the same, then there‚Äôs essentially zero latency to get the witness to the prover no?",
    "created_at": "2026-02-21T13:07:50.884000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Prover could maybe just read a file for example",
    "created_at": "2026-02-21T13:08:12.811000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "If they are on the same host yes",
    "created_at": "2026-02-21T13:08:24.509000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "But if they are on different hosts on the same subnet then they would have to communicate over the network",
    "created_at": "2026-02-21T13:08:37.242000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "This makes sense and I think in practice, it will be what most/all sophisticated builders do ‚Äî for the case that they are on different remote networks (prover and builder are different), is the idea that we would add the overhead of encryption and be limited by upload/download bandwidth of the builder/prover?",
    "created_at": "2026-02-21T13:12:35.527000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Ah my initial question about forking doesn‚Äôt apply for sophisticated builders who are also provers since they are the ones building the block too",
    "created_at": "2026-02-21T13:13:24.518000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "I'm actually not sure what would be more efficient in the case of builder and provers on different networks:\n- builder generating a witness and sending it over the wire to the prover\n- builder building block and sending block over the wire with the expectation that the prover will re-execute and build the witness locally",
    "created_at": "2026-02-21T13:14:04.918000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Maybe I‚Äôm over indexing, on the two EL case; in the second scenario, the builder and the prover would have different ELs and possibly could be on different chains?",
    "created_at": "2026-02-21T13:15:35.793000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "ie since the builder only sends over the block, the prover could say that this is not a part of their canonical chain",
    "created_at": "2026-02-21T13:16:13.852000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Possibly but I guess with MEV boost they make it work somehow so I think the same can be applied here?",
    "created_at": "2026-02-21T13:16:17.273000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "In MEV boost, the builder doesn't choose what head to build on top of, right? Id assume it is the validator requesting the payload?",
    "created_at": "2026-02-21T13:17:40.042000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "I can check specs in a few minutes, but I‚Äôd assume that if the proposer gets a block from builders that doesn‚Äôt fit their view of the chain(due to chain split or reorg), then the proposer would fall back to local building",
    "created_at": "2026-02-21T13:19:19.276000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "right I see",
    "created_at": "2026-02-21T13:20:12.552000+00:00",
    "attachments": []
  },
  {
    "author": "taulepton_",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "The builder / prover can always attempt to sync to the requested head using p2p but that does incur some latency overhead.",
    "created_at": "2026-02-21T13:20:48.378000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Cc <@1386598056320831509> <@592004585506340885> ‚Äî I believe the builder doesn‚Äôt know what the proposers view is with mev boost and if the proposer sees a payload from the builder that doesn‚Äôt fit their view, then they fall back to local building?",
    "created_at": "2026-02-21T13:22:18.129000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "This may incur quite a bit of overhead and I guess it‚Äôs not clear who is correct (the proposer could be malicious and just wants to dos the builder) \n\nI think we could probably benchmark both cases, ie the extremely optimised case of the sophisticated builder collocating with the prover and then the case where the builder and prover are separate entities and the prover has no EL state.",
    "created_at": "2026-02-21T13:30:15.587000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "The second case should be more general (the first case mainly removes the networking overhead I think)",
    "created_at": "2026-02-21T13:30:55.663000+00:00",
    "attachments": []
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "yes, the proposer informs the builder which is the parent block according to their view by passing it in the request like this: https://github.com/ethereum/builder-specs/blob/main/apis/builder/header.yaml#L23",
    "created_at": "2026-02-21T13:33:21.761000+00:00",
    "attachments": []
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "if the builder's payload doesn't match the expected header, then the proposer will reject that particular bid",
    "created_at": "2026-02-21T13:33:41.738000+00:00",
    "attachments": []
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "they will only include a bid which matches to their expected header",
    "created_at": "2026-02-21T13:33:51.277000+00:00",
    "attachments": []
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "and with gloas, the proposer will only accept a bid which matches their expected parent_hash AND parent_block_root",
    "created_at": "2026-02-21T13:34:07.790000+00:00",
    "attachments": []
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "hope that helps üôÇ",
    "created_at": "2026-02-21T13:34:25.842000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "It does, thank you!",
    "created_at": "2026-02-21T13:37:33.215000+00:00",
    "attachments": []
  },
  {
    "author": "developeruche",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Thanks! I'd be glad to take this on and draft a proposal for the TCP wire protocol, my initial thought is to keep the application layer as lightweight as possible. Here is a highlevel outline I would be including in the design;\n\n- Encoding (the witness would be encoded as raw bit or RLP format)\n- Framing (this could be a simple length prefix binary framing - example could be `0x01-0000000032-0000...0000`, where 0x01 is the message type(execution witness), 0000000032 this length of the message, 0000...0000 this is the actual message payload.)\n\nWould love to hear your thoughts on this, somethings you would love to see in this specs/PoC <@427491045308235776>, <@402080271563751435>...",
    "created_at": "2026-02-21T21:18:40.832000+00:00",
    "attachments": []
  },
  {
    "author": "developeruche",
    "category": "Cross-layer",
    "parent": "l1-zkevm-protocol",
    "content": "Would implement this on the `reth-witness-indexer` just because it would faster to get a PoC. with this I can also bench for \"Streaming bytes from file\" vs \"Db lookup\", \"reth-witness-indexer\" is currently working with \"Db lookup\".\n\nWould send in a;\n- Markdown file (detailing the spec for the TCP streaming protocol tied to our usecase).\n- `reth-witness-indexer` PoC\n- \"Streaming bytes from file\" vs \"Db lookup\" bench report\n\n\n_note: unlike the IPC implemenation on Ethrex where the full engine API was served over IPC transport, this proposal have no intension in going that direction, it solely focus on answering \" How do we transport execution witness (already generated/on-demand generation) from the EL to a prover or orchestrator\"_",
    "created_at": "2026-02-21T21:19:01.375000+00:00",
    "attachments": []
  }
]