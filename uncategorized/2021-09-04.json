[
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "User sends ETH to cover gas fees for withdrawing tokens, attacker backruns transaction to withdraw the ETH.",
        "created_at": "2021-09-04T03:54:24.197000+00:00",
        "attachments": null
    },
    {
        "author": "zktriumph",
        "category": "general",
        "parent": "",
        "content": "I woke up to a few polygon notifications,  then I checked BSC.",
        "created_at": "2021-09-04T05:08:58.429000+00:00",
        "attachments": null
    },
    {
        "author": "zktriumph",
        "category": "general",
        "parent": "",
        "content": "Attacker is using different networks from bsc, polygon and Ethereum from what I have gathered.",
        "created_at": "2021-09-04T08:16:28.897000+00:00",
        "attachments": null
    },
    {
        "author": "deltus",
        "category": "general",
        "parent": "",
        "content": "",
        "created_at": "2021-09-04T08:51:40.947000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "c2mESLM6rqcT217hYSxjcERvM-djqSwo0gKpSLGYRIM.png",
                "content": "e8746ad64d3191895c9cd04b9f0bbb87c9c439d7a72f366d5995e12fdccbf512"
            }
        ]
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "This isn't the appropriate server for memes.  The \u003c#595721451651465227\u003e channel is for Ethereum research and development topics that aren't covered by one of the other channels.",
        "created_at": "2021-09-04T09:27:39.800000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Yeah but how does the attacker prevents himself from the user programming both the gas transfer and the token transfer from happening in the same block",
        "created_at": "2021-09-04T09:46:17.189000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "They can't be in the same block.  The transfer TX will be rejected until there is enough gas to process it in the account (excluding other pending txs)",
        "created_at": "2021-09-04T09:49:06.909000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Oh I'm misunderstanding how this works: I thought if I make sure that I send two transactions and bribe the miner to take tem as a bundle then I could a) send gas and b) extract the tokens in that order, and that after a) the account will be considered to have enough funds, even in the same block. The issue of the pending transactions is just signing b) with the right nonce",
        "created_at": "2021-09-04T10:16:36.435000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "It may be possible with an MEV-crafted block, but not sure.  It wouldn't work with individual transactions.\n\n(Although it it's MEV-crafted then the obvious solution is for a miner to split the txs)",
        "created_at": "2021-09-04T10:42:52.093000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Sure, I meant all in the same block indeed. I don't understand how these attacks happen since as soon as these mnemonic are public they become free money for the miners as far as I can see",
        "created_at": "2021-09-04T10:52:25.558000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Entirely possible that you just cannot create a block that has both the funding and spending transactions in the same block, which would explain it.  Can't say I ever tried to create such a block, though.",
        "created_at": "2021-09-04T10:55:25.871000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "It should be possible. There’s certainly no advance validation done on transactions in a block - just verify and execute each in order. This is important to prevent double spends where an account has x eth and the block contains two transactions that both spend x eth. The second one should be invalid due to lack of funds.",
        "created_at": "2021-09-04T10:58:11.417000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "The fact that they can both be included suggests that the prior situation will not be allowed, however.",
        "created_at": "2021-09-04T10:58:52.746000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "I’m not even sure you need to do anything fancy because the mempool probably won’t execute the first transaction before verifying the second one.",
        "created_at": "2021-09-04T10:58:58.414000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Oh such a block with both would be invalid. The second transaction is not valid to include if the account at that point doesn’t have sufficient funds.",
        "created_at": "2021-09-04T10:59:33.978000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Basically mempool verifies each tx without executing and the EVM verifies and executes each in turn.",
        "created_at": "2021-09-04T11:00:11.941000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "So the mempool would reject the second tx as the state doesn't show enough funds in the account.",
        "created_at": "2021-09-04T11:00:47.802000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Only if the first tx had actually been executed. If they were both submitted at the same time they’d both wind up in the mempool but block creation would discard the second one when it discovers the funds were already sent.",
        "created_at": "2021-09-04T11:01:46.476000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "(unless it was geth specifically rejecting the tx, rather than the network in general)",
        "created_at": "2021-09-04T11:02:11.177000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Of course mempool implementations can do whatever they want so it may vary between clients.",
        "created_at": "2021-09-04T11:02:23.079000+00:00",
        "attachments": null
    }
]