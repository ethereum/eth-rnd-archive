[
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!332923501079953409\u003e \u003c@!245683379742310400\u003e \u003c@!376568077950910466\u003e Is there an argument against merging this?  https://github.com/ethereum/EIPs/pull/2835\nThe discussion in the PR thread seems to be dominated by \"we could do even better\", but that doesn't seem to be an argument for not merging this and instead an argument for \"someone should give this EIP some more love after we merge this\".  \u003c@!332923501079953409\u003e did have one question that sounded like perhaps dissent to merging, but I haven't heard back on my request for clarification.",
        "created_at": "2020-08-01T11:10:32.978000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I wouldn't mind doing a pass of the EIP to clean it up a bit more, but I wanted to wait until this was merged so I didn't have to deal with merge conflicts (and it is the author's first commit, so I didn't want to just trample it with my own larger PR).",
        "created_at": "2020-08-01T11:11:10.512000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e This is perhaps a dumb question, but what happens when `BASE FEE` + `GAS PREMIUM` is smaller than `FEE CAP`? Does the difference get refunded to the user, or does it get added to `GAS PREMIUM` ?\n\u003c@!552133098075193354\u003e In the current geth implementation, if `BASE_FEE` + `GAS_PREMIUM` is lower than `FEE_CAP` then the `GAS_PRICE` is equal to `BASE_FEE` + `GAS_PREMIUM`, otherwise the `GAS_PRICE` is equal to the `FEE_CAP`.  So in the former case the `FEE_CAP` is essentially ignored, it is not a factor in the fee deducted from the sending account so no extra refund is needed and the `GAS_PREMIUM` value is not changed. `FEE_CAP` is not seen as a promised spend but rather the upper limit to what the sender is willing to spend.",
        "created_at": "2020-08-01T16:00:15.769000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ofc there is the usual refund, after the tx state transition tx.origin gets refunded `GAS_PRICE` * (`tx.gasLimit` - `GAS_USED`) where `GAS_PRICE` is equal to min(`BASE_FEE` + `GAS_PREMIUM`, `FEE_CAP`).",
        "created_at": "2020-08-01T16:06:01.995000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I would love to redo the variables...",
        "created_at": "2020-08-01T16:06:02.486000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think it would be much more clear if the transaction had `MAX_BASE_FEE` and `GAS_PREMIUM`",
        "created_at": "2020-08-01T16:06:27.459000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Or better yet, `MAX_BASE_FEE` and `MINER_BRIBE`.  ðŸ™‚ (though, `MINER_BRIBE` is just terminology, not consensus)",
        "created_at": "2020-08-01T16:06:49.572000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm open to anything but I personally think `FEE_CAP` is fine, `MAX_BASE_FEE` would have a different meaning that would need to be accommodated in the code and from my perspective the redefinition in itself doesn't add clarity. I think there are ways to improve clarity in the EIP doc without redefining things. Seemingly small changes like this take a not-insignificant amount of time to propogate throughout the entire implementation(s).",
        "created_at": "2020-08-01T16:19:20.650000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I agree, which is why I would rather make such a change now rather than later.  ðŸ™‚",
        "created_at": "2020-08-01T16:33:19.088000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And why I tried pushing on this previously (but lost previously).",
        "created_at": "2020-08-01T16:33:27.886000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`FEE_CAP = MAX_BASE_FEE + GAS_PREMIUM`  You need 2 out of 3, doesn't really matter which 2 from a math standpoint.",
        "created_at": "2020-08-01T16:34:04.896000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The reason I think `MAX_BASE_FEE` is a significant improvement over `FEE_CAP` is because I believe it is much more clear to anyone who has to work with the transaction that \"this is the most I'm willing to burn\" and \"this is what I'll pay to miners\".  I *suspect* that integrators will care less about `FEE_CAP` directly, and instead it is more likely to be the dependent variable in the equation for most people.",
        "created_at": "2020-08-01T16:35:41.364000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "'\"I believe it is much more clear to anyone who has to work with the transaction that \"this is the most I'm willing to burn\" and \"this is what I'll pay to miners'\" framed like that, I agree ðŸ™‚  although expecting people to recognize that `FEE_CAP` - `GAS_PREMIUM` _is_ the maxiumum `BASE_FEE` they are willing to pay is a pretty light expectation and something we could explain better in any case. What do other people think, what was the push back previously?",
        "created_at": "2020-08-01T16:56:18.039000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Pushback previously was \"eh... we already started our implementation and don't really want to change it now, maybe later after we have written more code it will be easier to change\".",
        "created_at": "2020-08-01T16:57:24.616000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Paraphrased, and perhaps embelished a bit.",
        "created_at": "2020-08-01T16:58:03.396000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Well I think that's actually pretty fair push back for something this minor, and considering there appears to be no end in sight for minor changes... we have to sort of draw the line somewhere",
        "created_at": "2020-08-01T16:58:19.166000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The clients need to be in the same state to work in the testnet together",
        "created_at": "2020-08-01T16:59:43.704000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So minor changes do interrupt the ongoing testnet coordination",
        "created_at": "2020-08-01T17:00:43.494000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, I get that.  I just find it unfortunate since I believe I suggested this *before* the first testnet, and it *feels* like a one line change (flipping a couple variables in an equation around).",
        "created_at": "2020-08-01T17:09:40.267000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is far more than one line haha but yeah I feel you.",
        "created_at": "2020-08-01T17:10:39.103000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "While I do think that the `FEE_CAP` choice is going to cause a bit of a support nightmare for the community going forward and end up wasting more total engineering hours, I also don't think anything should hold up EIP-1559 because \"why is my transaction pending for 8 hours\" is by far the most common support question I see from users.",
        "created_at": "2020-08-01T17:10:46.757000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also, I'm not trying to be the gatekeeper here",
        "created_at": "2020-08-01T17:11:43.118000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e It is far more than one line haha but yeah I feel you.\nWhen I imagine an implementation I would write, somewhere right near where I decoded the transaction I imagine having a line like:\n```ts\nconst fee_cap = transaction[5] // (or whatever index it is at)\nconst gas_premium = transaction[6]\nconst max_base_fee = fee_cap - gas_premium\n```\nAnd then I would never look at the transaction again for gas stuff (only use those variables).  Of course, I have no idea how you all have implemented things.  ðŸ™‚",
        "created_at": "2020-08-01T17:12:25.540000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We'd be changing the tx struct https://github.com/vulcanize/go-ethereum/blob/eip1559_rebase/core/types/transaction.go#L56 so everywhere the FeeCap field or methods are currently used needs to be adjusted for the new meaning, essentially.",
        "created_at": "2020-08-01T17:13:45.395000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It's not a big lift but it's not insignificant",
        "created_at": "2020-08-01T17:14:44.863000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Go is pretty verbose lol",
        "created_at": "2020-08-01T17:15:44.412000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think what surprises me in that link is that your internal transaction data structure doesn't have `max_base_fee` in it already.  ðŸ™‚",
        "created_at": "2020-08-01T17:17:41.062000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Which suggests you re-derive it every time you need it.",
        "created_at": "2020-08-01T17:17:58.694000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`max_fee` being?",
        "created_at": "2020-08-01T17:18:32.748000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`max_base_fee = fee_cap - gas_premium`",
        "created_at": "2020-08-01T17:18:49.853000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`fee_cap` is there",
        "created_at": "2020-08-01T17:18:53.423000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sorry, `max_base_fee` (fixed)",
        "created_at": "2020-08-01T17:19:01.443000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Or a getter for `max_base_fee` on the transaction datastructure (not sure if that is a thing in Go or not).",
        "created_at": "2020-08-01T17:20:10.784000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I don't see why we'd have that as a field _unless_ we make the change you propose",
        "created_at": "2020-08-01T17:20:44.688000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is necessary for processing the transaction.",
        "created_at": "2020-08-01T17:21:03.698000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Where it is calculated once?",
        "created_at": "2020-08-01T17:21:31.125000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It has to be calculated once somewhere, unless we add the field itself",
        "created_at": "2020-08-01T17:21:47.285000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "When validating a block you have to compare the `max_base_fee` against the block's `base_fee`, and every time you prepare a block for mining you have to compare every potential transaction's `max_base_fee` against the prepped block's `base_fee`.",
        "created_at": "2020-08-01T17:21:56.763000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Meanwhile, nowhere in the code do you ever actually need to compare `fee_cap` to anything (I think, it is late so please correct me if this is wrong).",
        "created_at": "2020-08-01T17:22:38.152000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://github.com/vulcanize/go-ethereum/blob/eip1559_rebase/core/state_transition.go#L172",
        "created_at": "2020-08-01T17:23:06.418000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The way you are going about this hurts my brain because it is totally not how I would do it at all.  ðŸ˜›",
        "created_at": "2020-08-01T17:24:50.046000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(and because it is late)",
        "created_at": "2020-08-01T17:25:00.905000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Well I'm implementing the EIP as it exists",
        "created_at": "2020-08-01T17:25:17.033000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Based on what already exists in geth",
        "created_at": "2020-08-01T17:25:38.148000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That is fair, and the EIP *is* written in a way that is very unnatural to me, and I'm coming at it with no baggage or constraints of an *actual* client to deal with.  ðŸ™‚",
        "created_at": "2020-08-01T17:25:57.079000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So I don't fault you for implementing it the way you have, I just find it weird and awkward is all.",
        "created_at": "2020-08-01T17:26:26.728000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And I worry that non-client developers are going to suffer confusion from this particular choice for years to come.",
        "created_at": "2020-08-01T17:26:43.815000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Minor confusion, that can be cleared up, but confusion none the less.",
        "created_at": "2020-08-01T17:26:51.535000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That's fair, I'm 100% down to make the change if there is consensus",
        "created_at": "2020-08-01T17:27:16.231000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Kind of like the `decimals` field in ERC20 tokens.  *Eventually* everyone gets it, but it takes every new developer several tries to grok the concept.",
        "created_at": "2020-08-01T17:27:18.081000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I have other things I want fixed more badly than this, so I'll probably just bring it up once every few weeks in mild annoyance, discuss briefly, then drop it again.  ðŸ˜¢",
        "created_at": "2020-08-01T17:28:04.797000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I definitely appreciate your input I hope I'm not coming off as dismissive. I'm not sure what the best way to go about approving suggestions like this is, it's hard to track consensus in here.",
        "created_at": "2020-08-01T17:30:29.153000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, leaderless organizations are the worst.  ðŸ™‚",
        "created_at": "2020-08-01T17:32:09.565000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is the one thing I miss about the corporate world, it is generally easy to get *AN* answer there.",
        "created_at": "2020-08-01T17:32:27.751000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Often I would disagree with the answer, but you always could get an answer.",
        "created_at": "2020-08-01T17:32:42.969000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Well, I suppose that isn't true in some dysfunctional enterprise positions, but I tried to avoid those.",
        "created_at": "2020-08-01T17:33:29.619000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The next 1559 implementers meeting might be right time/place to approve this suggestion. I don't think we have a date/time set yet but it would be good to have you on there.",
        "created_at": "2020-08-01T17:38:16.382000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I can rarely make such meetings due to time zone.",
        "created_at": "2020-08-01T17:39:46.549000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But I try to hop in listen-only when I can.",
        "created_at": "2020-08-01T17:39:55.986000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I guess another option is to open an EIP PR with this proposal and we can have a formal discussion and approval over there, things won't get burried in text over there at least.",
        "created_at": "2020-08-01T17:42:07.360000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This week I plan on putting up a PR that cleans up the EIP a bit (adds consistency to wording and such as has been discussed), after that goes through I may take a stab at a PR that flips the variables around.",
        "created_at": "2020-08-01T17:43:15.440000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I also need to get a PR together that moves 1559 over to 2718 transaction types, that may be the right time since developers will need to go touch transactions anyway.",
        "created_at": "2020-08-01T17:43:57.111000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sweeet, I will be keeping my eyes out",
        "created_at": "2020-08-01T17:45:16.438000+00:00",
        "attachments": []
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e When validating a block you have to compare the `max_base_fee` against the block's `base_fee`, and every time you prepare a block for mining you have to compare every potential transaction's `max_base_fee` against the prepped block's `base_fee`.\n\u003c@!301186049323958275\u003e just to clarify, do you mean that a transaction cannot be included in a block if `max_base_fee` is lower than the current basefee? I don't think this is correct. If I set `max_fee = 5`, current basefee is `4` and `gas_premium = 2`, then `max_base_fee` as you define it is `3`. But I could still get in the block at `gas_price = max_fee = 5`, in which case the miner receives `1`. This is also why I think `miner_bribe` would be a misnomer. The gas premium is not always exactly what the miner receives, in particular when `basefee + gas_premium \u003e max_fee`",
        "created_at": "2020-08-01T18:33:58.778000+00:00",
        "attachments": []
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`miner_bribe` would be `gas_price - basefee`, with `gas_price` as Ian defined it, `min(basefee + gas_premium, max_fee)`",
        "created_at": "2020-08-01T18:35:16.996000+00:00",
        "attachments": []
    }
]