[
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "still reading the messages and trying to write down the idea to convince myself. but in any case delaying basefee by one block means that you have a more laggy price oracle than you would if you kept the update in the previous block (\"that was the price to enter two blocks ago which you have to pay now\"). if the attack is serious, maybe that's a tradeoff worth making, but should keep in mind that it's not \"free\"",
        "created_at": "2021-03-05T02:16:47.837000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e (2) how complex it would be \nThis is not trivial, I mean in terms of code impact. At least for Besu. Because all block header validation rules have direct access to parent only. That means we would need to change a lot of methods to propagate the change or adding an additional query to the state to fetch grand parent block header. And that means giving access to state query service to those validation rules, which is not the case in Besu for example. So an additional impact to add missing services to query the grand parent block header.",
        "created_at": "2021-03-05T10:25:55.993000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So unless we confirm there is a potential attack I would not change the rule",
        "created_at": "2021-03-05T10:29:20.727000+00:00",
        "attachments": []
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!574864862338088960\u003e block validation rules go 6 blocks back because of ommers validation",
        "created_at": "2021-03-05T13:50:43.611000+00:00",
        "attachments": []
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "there are many blocks that you would not be able to validate without having 6 ancestors",
        "created_at": "2021-03-05T13:51:21.422000+00:00",
        "attachments": []
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "and you probably always cache at least these 6 blocks because of that",
        "created_at": "2021-03-05T13:51:57.926000+00:00",
        "attachments": []
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so at least on the technical side there should be no impact",
        "created_at": "2021-03-05T13:52:10.436000+00:00",
        "attachments": []
    },
    {
        "author": "timbeiko",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh that's right!",
        "created_at": "2021-03-05T13:52:31.897000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It's worth noting that we've actually had a vuln that's as serious as this issue almost since the beginning, and it's never turned into a problem",
        "created_at": "2021-03-05T13:53:04.626000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Namely, that blocks with higher totaldiff are favored over blocks with lower totaldiff",
        "created_at": "2021-03-05T13:53:05.986000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And you can make your block have higher totaldiff by just setting the timestamp lower",
        "created_at": "2021-03-05T13:53:16.689000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Eh. I think this is actually exploited in the wild currently.",
        "created_at": "2021-03-05T13:53:52.401000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I haven't looked at the numbers recently, but a while back most blocks were produced with a timestamp ~30 seconds in the past.",
        "created_at": "2021-03-05T13:54:14.359000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So that's a different thing; the 30s in the past reduces risk that your block will get rejected by the \"timestamp \u003e locally perceived now\" rule",
        "created_at": "2021-03-05T13:54:43.678000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What I'm suggesting would lead to an equilibrium where blocks set timestamps equal to their parent + 8 (I think)",
        "created_at": "2021-03-05T13:55:01.838000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I feel like 5 seconds would be fine for that?",
        "created_at": "2021-03-05T13:55:03.381000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Just under 9",
        "created_at": "2021-03-05T13:55:03.708000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Why 8 instead of 1?",
        "created_at": "2021-03-05T13:55:13.771000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Because the TD update rule is based on `diff // 9`",
        "created_at": "2021-03-05T13:55:24.193000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah, because if you do +8, it makes it easier for blocks _after_ you to also do +8 instead of +15, or +17 instead of +24 or whatever",
        "created_at": "2021-03-05T13:55:53.066000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So I guess the point is, this EIP 1559 issue doesn't create vulnerability where it didn't exist before",
        "created_at": "2021-03-05T13:56:15.412000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also, it does require a large portion of miners to join on simultaneously",
        "created_at": "2021-03-05T13:56:41.282000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Because if they do not, the optimal strategy continues to be to just build on the head",
        "created_at": "2021-03-05T13:57:00.293000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "will check, thanks",
        "created_at": "2021-03-05T13:57:04.017000+00:00",
        "attachments": []
    },
    {
        "author": "timbeiko",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!273808422753796097\u003e _if_ this happened, is there a way clients can implement a mitigation via a soft fork?",
        "created_at": "2021-03-05T14:00:02.173000+00:00",
        "attachments": []
    },
    {
        "author": "timbeiko",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Or would it require another HF where we start calculating the block based on two parents (which miners would have no incentive to adopt)",
        "created_at": "2021-03-05T14:00:22.946000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Whch attack? The TD issue or the 1559 issue?",
        "created_at": "2021-03-05T14:00:29.461000+00:00",
        "attachments": []
    },
    {
        "author": "timbeiko",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "1559",
        "created_at": "2021-03-05T14:00:33.666000+00:00",
        "attachments": []
    },
    {
        "author": "timbeiko",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But perhaps the solution to both would be similar",
        "created_at": "2021-03-05T14:00:57.310000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So I think the more general issue through is that the attack is even more general than that",
        "created_at": "2021-03-05T14:01:25.083000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So the 1559 idea is: you make a block with fewer txs, so that in the next block it has a lower basefee",
        "created_at": "2021-03-05T14:01:45.453000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I believe it can be done selfishly.",
        "created_at": "2021-03-05T14:01:58.103000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The non-1559 idea is: you make a block with fewer txs, so that the next block miner can include more txs",
        "created_at": "2021-03-05T14:02:03.274000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is a two phase process though.",
        "created_at": "2021-03-05T14:02:05.048000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "First phase is that miners *selfishly* change their fork choice rule to \"prefer sibling blocks with lower base fee\".",
        "created_at": "2021-03-05T14:02:24.067000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Right, but the point is that the incentive gradient is very shallow",
        "created_at": "2021-03-05T14:02:42.948000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Once *enough* miners follow that rule (selfishly) then miners start *producing* blocks with lower base fee to decrease uncle rate.",
        "created_at": "2021-03-05T14:03:14.166000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I do agree that the incentive is pretty small.  But it is non-zero and selfish.",
        "created_at": "2021-03-05T14:03:36.491000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ok this argument is stronger",
        "created_at": "2021-03-05T14:06:17.249000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Basically, with EIP 1559, the lower-gasprice block can give the child an extra income of at most gaslimit/8",
        "created_at": "2021-03-05T14:06:54.043000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Actually, much less, because the child miner won't literally convert the gasprice reduction into revenue",
        "created_at": "2021-03-05T14:07:22.259000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But pre-EIP-1559, it would be *normal* for txs to have wildly divergent fees, so the profit would be very significant",
        "created_at": "2021-03-05T14:07:51.966000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I am very much less clear about the incentives for *producing* low transaction count blocks.",
        "created_at": "2021-03-05T14:09:18.687000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My primary concern is that there *is* now incentive to change the fork choice rule away from \"first seen\".",
        "created_at": "2021-03-05T14:09:34.187000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But there was always an incentive to change the fork choice to \"fails to include the txs that pay the most fees\"",
        "created_at": "2021-03-05T14:09:58.091000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And no one has",
        "created_at": "2021-03-05T14:10:02.327000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The argument here being that our situation isn't *worse* now?",
        "created_at": "2021-03-05T14:11:07.743000+00:00",
        "attachments": []
    },
    {
        "author": "wjmelements",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That fork choice rule is under-utilized, but does not promote intentional uncling in the same way.",
        "created_at": "2021-03-05T14:33:56.922000+00:00",
        "attachments": []
    },
    {
        "author": "darius510",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Putting aside the complexity of implementation, the \"pay it forward\" smoothing idea neutralizes this threat, doesn't it?",
        "created_at": "2021-03-05T15:19:07.148000+00:00",
        "attachments": []
    },
    {
        "author": "darius510",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'll take that as a yes. It was always the best solution anyway, hopefully this potential is enough to finally take it seriously.",
        "created_at": "2021-03-05T15:22:51.851000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!301186049323958275\u003e https://github.com/ethereum/EIPs/pull/3330",
        "created_at": "2021-03-05T15:32:26.770000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ugh, now I have to actually review it.  ðŸ˜–",
        "created_at": "2021-03-05T15:35:29.384000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Probably won't get to it until tomorrow (FYI).",
        "created_at": "2021-03-05T15:35:43.214000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sure, no worries.",
        "created_at": "2021-03-05T15:40:09.196000+00:00",
        "attachments": []
    },
    {
        "author": "hasu0730",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the miners changing their fork choice rule feels a nothingburger to me. It's like a smalll-scale censorship attack, would require miners to leave fees on the table, and that makes it too profitable to defect and maximize fees and hence basefee and bet on the \u003e95% of cases where the fork choice rule doesn't even come into play",
        "created_at": "2021-03-05T16:14:06.288000+00:00",
        "attachments": []
    },
    {
        "author": "hasu0730",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I would also caution everyone that this is the kind of bikeshedding attack we have to watch out for between now and July. someone discovering \"new flaws\" in EIP-1559 that require small changes that then themselves require 2-3 more months of testing",
        "created_at": "2021-03-05T16:15:20.465000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e would require miners to leave fees on the table\nI don't believe this is true.  Changing the force choice rule is a purely rational choice for individual miners.",
        "created_at": "2021-03-05T16:48:36.705000+00:00",
        "attachments": []
    },
    {
        "author": "hasu0730",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yes, but how do you get a block with lower basefee?",
        "created_at": "2021-03-05T16:52:40.126000+00:00",
        "attachments": []
    },
    {
        "author": "hasu0730",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that's the part where miners have to deliberately mine smaller blocks",
        "created_at": "2021-03-05T16:53:38.114000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Anytime you have two blocks mined at the same time (which happens all the time).  Right now, clients (and miners) prefer the block they saw first.  However, with this change they would be incentivized to pick the block that with less gas spent.",
        "created_at": "2021-03-05T17:07:20.588000+00:00",
        "attachments": []
    },
    {
        "author": "hasu0730",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it doesn't happen \"all the time\"",
        "created_at": "2021-03-05T17:15:30.765000+00:00",
        "attachments": []
    },
    {
        "author": "hasu0730",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the uncle rate is about 5% fwiw",
        "created_at": "2021-03-05T17:36:23.186000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\"All the time\" on the relative scale of blockchains, where \"rare\" means 1/2^254.  ðŸ˜„",
        "created_at": "2021-03-05T17:38:10.623000+00:00",
        "attachments": []
    },
    {
        "author": "definitelynotcharles7176",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This is a lot of bad faith to actively write into an actual dev channel.\n\nIt was \u003c@!418000431814279181\u003e  (I have no idea who that is) and your own devs, Micah and Tim who picked up on this.",
        "created_at": "2021-03-05T18:52:52.717000+00:00",
        "attachments": []
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What's bad faith about \u003c@!528251935829262351\u003e's post? Although i haven't analyzed 1559 in depth as many in this chat, his point seems valid",
        "created_at": "2021-03-05T18:56:24.930000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It's worth mentioning that they are *already* incentivized to pick the block that claims fewer fees",
        "created_at": "2021-03-05T18:58:02.179000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And this mostly does not happen",
        "created_at": "2021-03-05T18:58:06.355000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In fact, EIP 1559, by reducing the incentive for txs to have divergent fees, may well *increase* safety on this dimension",
        "created_at": "2021-03-05T18:58:23.293000+00:00",
        "attachments": []
    },
    {
        "author": "definitelynotcharles7176",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I replied to the wrong comment, this is the comment I should have repliedd to:\n\n\u003e I would also caution everyone that this is the kind of bikeshedding attack we have to watch out for between now and July. someone discovering \"new flaws\" in EIP-1559 that require small changes that then themselves require 2-3 more months of testing\n\nI would consider taking a useful, tangible issue, and then using it to speculate about an entirely different class of negative issues, to be unreasonable.\n\nThe miners have so far just complained about unfairness. No serious competent person has begun picking technical holes in an unreasonable way.",
        "created_at": "2021-03-05T18:58:29.943000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Basically, as an individual miner in EIP 1559, you actually gain quite little by cutting the basefee",
        "created_at": "2021-03-05T18:58:59.271000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Because reduced basefee does not immediately just turn into more profit for you",
        "created_at": "2021-03-05T18:59:08.596000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You just get the same tip you would otherwise",
        "created_at": "2021-03-05T18:59:18.233000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You only get a bit more from txs that are ok with the lower basefee but would not have been ok with the higher basefee",
        "created_at": "2021-03-05T18:59:33.043000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Whereas in the status quo, you gain *a lot* from building on top of a block that included fewer transactions",
        "created_at": "2021-03-05T19:00:02.641000+00:00",
        "attachments": []
    },
    {
        "author": "definitelynotcharles7176",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e Because reduced basefee does not immediately just turn into more profit for you...You just get the same tip you would otherwise\n\nI think \"lower base fee increases profit\" is important to this issue.\n\nHonestly, my guess is that only 1-3 people here actually understand and are informed enough to comment.\n\nI think clarifying the issue would be helpful to discussion.",
        "created_at": "2021-03-05T19:08:39.672000+00:00",
        "attachments": []
    }
]