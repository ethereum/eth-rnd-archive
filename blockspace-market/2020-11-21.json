[
    {
        "author": "halfinney.",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "thanks \u003c@552133098075193354\u003e. Is there a chance we might not be able to implement 1559? or is it just engineering grind that you guys need to go through? A good way to put that  might be, is all research complete? and we are waiting to implement it on the mainnet?",
        "created_at": "2020-11-21T03:51:35.214000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!487281155679191041\u003e There are a couple minor open questions, but I don't think they will become dead ends.",
        "created_at": "2020-11-21T04:02:48.031000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Specifically, non-consensus things like \"what do we sort the pending pool by\".",
        "created_at": "2020-11-21T04:03:09.530000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "bumping this again â€” if we can avoid a dynamic tip, I believe it will significantly decrease mempool complexity",
        "created_at": "2020-11-21T04:18:43.407000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!543900561460822016\u003e Perhaps just submit a PR making that change and see if anyone objects in the PR?",
        "created_at": "2020-11-21T04:56:04.277000+00:00",
        "attachments": null
    },
    {
        "author": "halfinney.",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "thanks \u003c@!301186049323958275\u003e !",
        "created_at": "2020-11-21T06:11:20.688000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!487281155679191041\u003e Thinking more on this, I think the open research questions are all \"optimizations\".  That is, we could move forward with *any* solution and each problem has several possible solutions which all are competing against each other.  The \"research\" is figuring out which of the options is best/least bad, but any of the options would likely work.",
        "created_at": "2020-11-21T06:25:26.025000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "PR to switch to *constant tip* transactions from *dynamic tip* transactions: https://github.com/ethereum/EIPs/pull/3124",
        "created_at": "2020-11-21T08:31:15.198000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!543900561460822016\u003e I'm not a big fan of the bit packing of the gas price.  It means that basically all tools will stop working until updated for 1559, which historically we have tried really hard to avoid.",
        "created_at": "2020-11-21T08:51:15.056000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In fact, I suspect that this will be the strongest push back you receive on this PR, and I tend to agree with that pushback.",
        "created_at": "2020-11-21T08:51:57.413000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Do you have any ideas of other ways to deal with legacy transactions that don't require tooling updates?",
        "created_at": "2020-11-21T08:52:52.860000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Part of the rationale for this was to make an easy way to treat existing txs under the new model: an existing tx would just be interpreted as tip = maxprice = tx.gasprice",
        "created_at": "2020-11-21T09:17:29.285000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "thanks \u003c@!543900561460822016\u003e for the note you wrote! added two comments/questions. I am trying but I cannot come up with a reason not to use the constant tip (apart from the legacy transaction as others have pointed out)",
        "created_at": "2020-11-21T12:14:11.315000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "this is superseded by the content here but here are some worked examples of pitfalls clients must deal with with the dynamic tip: https://github.com/ethereum/rig/blob/master/eip1559/notes-call3.md#important-client-strategies",
        "created_at": "2020-11-21T12:15:31.750000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Michal has just prepared a notebook based on amb library",
        "created_at": "2020-11-21T12:20:58.084000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We will review that once again and can publich soon",
        "created_at": "2020-11-21T12:21:04.945000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It compares the success stories of legacy vs eip1559 users within the txpool",
        "created_at": "2020-11-21T12:21:24.682000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "waiting times and gas prices paid",
        "created_at": "2020-11-21T12:21:30.485000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "could clients implement a similar feedback control mechanism as EIP 1559 does? target a number of transactions in their mempool, strenghten/weaken their eviction policies to keep the queue close to target. main issue would be clients at different parameters might disagree with each other on the gossip network (some won't accept transactions that others have sent).  that is assuming all clients parameterise their policies identically in the non-feedback control case in the first place, otherwise disagreements will happen anyways",
        "created_at": "2020-11-21T12:22:36.245000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "these are some results that we are still reviewing internally",
        "created_at": "2020-11-21T12:23:01.322000+00:00",
        "attachments": [
            {
                "type": "",
                "origin_name": "image.png",
                "content": "3c35ef721401ef8d0002d842e28b84ede943ffafee73f94244338409f63e010a"
            }
        ]
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "we need to explain yet the mass eviction of legacy transactions at start",
        "created_at": "2020-11-21T12:23:22.824000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that's cool \u003c@!489256758989029405\u003e ! how do you decide if a transaction should be evicted?",
        "created_at": "2020-11-21T12:24:34.551000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "setting the size limit on the pool and then the strategy that Michal tested is to simply sort by the value to the miner",
        "created_at": "2020-11-21T12:27:32.287000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it is all based on your lib so it will be great if you can review it just before publishing",
        "created_at": "2020-11-21T12:28:01.637000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "of course! happy to",
        "created_at": "2020-11-21T12:28:23.752000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "indeed it's strange more legacy txs are evicted, since we've assumed they would be the most profitable to the miner in the first place",
        "created_at": "2020-11-21T12:28:46.336000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!486501030046203915\u003e The reason I would like to see very strict eviction strategies is only partially for network health, but also for UX.  We have reason to believe that most nodes use the default eviction strategy of their client.  We have seen that once a transaction disappears from the default default strategies, it tends to disappear from miner pools as well and not get mined unless someone is explicitly rebroadcasting it.\n\nWe can use this knowledge to provide a better user experience by aggressively evicting transactions that aren't likely to be included within the next block or two, which will *likely* lead to those transactions essentially being forgotten about/dropped entirely.  This means users who submitted a transaction with a low fee cap right before a sudden surge in block space demand won't end up with their account in a state where they cannot send any new transactions because they have a pending transaction that is unlikely to be mined anytime soon.",
        "created_at": "2020-11-21T12:35:44.964000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is a very common problem for end-users to not understand the concept of nonces and when their transaction gets stuck they just start spamming more and more transactions after it.  Even if you do something like \"Reset MetaMask\" (which tells MM to forget about your history), the network continues to remember your history even though your transactions won't be included anytime soon.",
        "created_at": "2020-11-21T12:36:51.343000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "These users would *rather* the whole network just forget so they can start over.",
        "created_at": "2020-11-21T12:37:00.217000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In fact, I would go so far as to say that when you evict a transaction from the pending pool for a particular user due to low fees, you should also evict any higher-nonce transactions you have for that user.  In most cases, the user will be better off with a clean slate than with a nonce gap in the global pending pool.",
        "created_at": "2020-11-21T12:37:55.065000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I agree with the argument, but want to point out that the more aggressive the policies we suggest are, likely the less incentive-compatible they are for the miners. I might want to have a longer queue than the recommended eviction policy allows for, just so that I can pack a few more transactions for fees. the arguments against \"why would a miner implement a loose policy?\" are:\n- if everyone else's eviction policy is aggressive and mine is loose, i am likely not being gossiped most of the transactions since other miners would evict them, so being loose isn't that interesting\n- miners use the default code we suggest them. to consider: in a regime where transaction fees are high, miners might have more incentive to look for alternative policies that would net them more fees. but this is perhaps softened by the third argument:\n- evicted transactions are the ones that pay the least anyways",
        "created_at": "2020-11-21T12:45:38.892000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i think it's more of a theoretical concern at this point (I also believe miners would implement the policy if that is what default clients are doing), but it'd be a cool thing to investigate this transaction pool management game",
        "created_at": "2020-11-21T12:46:49.879000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, this eviction policy does rely on a bit of altruism or laziness from miners.  With 1559, I expect miner profit from fees will hover just over opportunity cost though and having a few extra transactions every now and then may not even cover the cost of writing/maintaining the code for this.",
        "created_at": "2020-11-21T12:51:25.347000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also, if some miners do ignore the default eviction policy and instead retain things for longer we aren't really in that bad of a place, we are more just back to where we started.",
        "created_at": "2020-11-21T12:52:09.336000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So my vote is to give it a shot and see if it works out positively, and if not it isn't a big deal.",
        "created_at": "2020-11-21T12:52:24.509000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I definitely like the idea of a parametric policy (as in, an eviction rule where there is a fixed constant governing which txs get evicted), because if we find we evict too much it seems easier to just decrease that constant rather than replace the rule. quantitative changes seem easier than qualitative ones",
        "created_at": "2020-11-21T13:14:15.402000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yeah, it was the most confusing part for me when I was sending a transaction for the firs time",
        "created_at": "2020-11-21T13:57:31.369000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I was looking online how to unstuck the tx",
        "created_at": "2020-11-21T13:57:39.368000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I keep being in favour of designs that are gametheoretically sound instead of assuming that miners will use whatever clients implement",
        "created_at": "2020-11-21T13:58:27.721000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We want to simulate miners' behaviour now. I think this may be critical for understanding it. Strategic miner in a DeFi environment is what we want to verify.",
        "created_at": "2020-11-21T13:59:17.204000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The best solution would be to be able to sign transactions only valid within a block range - something that Micah has been extensively working on with his transaction wrappers.",
        "created_at": "2020-11-21T14:00:19.014000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Can't wait for that to happen.",
        "created_at": "2020-11-21T14:00:26.180000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e Can't wait for that to happen.\n\u003c@!489256758989029405\u003e I wouldn't hold my breath too much for that one.  ðŸ˜¢",
        "created_at": "2020-11-21T14:01:21.125000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The problem is that there are some DoS vectors if you can submit a transaction that can become invalid as time passes.",
        "created_at": "2020-11-21T14:01:52.030000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I don't know that this is insurmountable, but it is problematic.",
        "created_at": "2020-11-21T14:02:01.444000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It means the pending queue needs to be walked periodically for validity (currently, you never have to actually walk it, just insert into middle and pop tail).",
        "created_at": "2020-11-21T14:02:44.900000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Or you need some other mechanism for purging transactions that are expired.",
        "created_at": "2020-11-21T14:02:57.986000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "what kind of dos vectors?",
        "created_at": "2020-11-21T14:03:23.992000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "like sending a lot of transactions that are valid for a very short period of time?",
        "created_at": "2020-11-21T14:03:42.607000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "does not seem to be particularly problematic for me",
        "created_at": "2020-11-21T14:03:57.139000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e like sending a lot of transactions that are valid for a very short period of time?\n\u003c@!489256758989029405\u003e Yeah.  More generally, sending transactions that you know won't ever be mined.",
        "created_at": "2020-11-21T14:06:50.331000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "e.g., their gas price is too low.",
        "created_at": "2020-11-21T14:06:54.084000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Interestingly, if we had an aggressive eviction policy post 1559 like described above we could avoid this.",
        "created_at": "2020-11-21T14:07:14.920000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Since the whole network would ditch transactions that can't mine in the next block or two, and wouldn't propagate anything that can't mine in the next block.  So any transaction you send has a high probability of getting included, even if your deadline is very short (e.g., 1 minute or whatever we set the minimum to be).",
        "created_at": "2020-11-21T14:08:02.387000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So maybe we could sort of combine these two approaches to make it so miners and the network as a whole has an incentive to purge transactions aggressively?",
        "created_at": "2020-11-21T14:08:26.567000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If I was  miner I would run a separate machine just to analyze the txpool without purging anything",
        "created_at": "2020-11-21T14:10:05.164000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You certainly could work around this.  I think the expiration thing gives yet-another-reason not to is all.",
        "created_at": "2020-11-21T14:12:39.354000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And if there are enough such reasons, they will outweigh the benefit of writing custom code.",
        "created_at": "2020-11-21T14:13:05.655000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I appreciate your desire for a game theoretic solution.  I personally think that this seems like a really easy change to make since we already need to be messing with pending pool strategies in 1559 anyway, and if it works we get a nice free win, and if it doesn't we are no worse off.",
        "created_at": "2020-11-21T14:14:06.587000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Essentially, from a client dev standpoint it feels like a no-cost solution with maybe some benefit.",
        "created_at": "2020-11-21T14:14:30.191000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We already analysed eip-1559 more than some of the countries the impact of their covid policies",
        "created_at": "2020-11-21T15:18:34.700000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that's a low bar to clear haha... but yes I discussed that idea of client pool behaviour analysis before, I think it'd be interesting to do. there is a nice parallel with the way tcp clients operate (and the analysis that was done for it too) definitely some depth to the problem",
        "created_at": "2020-11-21T15:28:05.490000+00:00",
        "attachments": null
    },
    {
        "author": "halfinney.",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thanks Micah. I was going through a lot of resources from a lot of places, but failed to come to a conclusion that 1559 is actually possible. I guess you put it very accurately ðŸ˜ƒ",
        "created_at": "2020-11-21T16:05:54.034000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!487281155679191041\u003e my slightly less optimistic take is that EIP-1559 may be 100% done, but the network may not be able to handle it because of potential denial of service risks when blocks have 2x the current size. This issue is being worked on outside of 1559, though. This is the first \"Open Issue\" in the checklist: https://github.com/ethereum/pm/blob/master/Fee%20Market%20Meetings/mainnet-readiness.md#client-level-open-issues\n\nI've also written about it more here: https://hackmd.io/@timbeiko/1559-updates/https%3A%2F%2Fhackmd.io%2F%40timbeiko%2F1559-update-001#A-bit-of-context%E2%80%A6",
        "created_at": "2020-11-21T21:09:11.256000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Have you fleshed this idea out much? It seems like the right path. I think if the mempool tracked the volatility of the base fee and itâ€™s trend (avg change over the last N blocks), we could define a couple configurable parameter to use in the replacement / eviction decision. For example, suppose a new tx bumps the only fee_cap. If the volatility is low and the old txâ€™s fee_cap is sufficiently far from the current base fee, there is no need to replace the tx.",
        "created_at": "2020-11-21T21:24:36.336000+00:00",
        "attachments": null
    }
]