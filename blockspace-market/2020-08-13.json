[
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e If later it is found out that this particular choice was wrong, it can be changed\n\u003c@456226577798135808\u003e I think this is where we disagree.  Changing stuff like this later is not likely to happen once it is in the wild.  If people are resistant to the change now when there are only 2 implementations on a testnet, what makes you think that people will be amenable to the change in a year or two?  If it really was easy to change, then it would be even easier to change *now*.",
        "created_at": "2020-08-13T02:42:24.338000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My intention when writing that spec was definitely for the // to mean python division",
        "created_at": "2020-08-13T03:22:49.894000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ie. `-13 // 5 = -3`",
        "created_at": "2020-08-13T03:22:57.799000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "though the other route we could take is the eth2 route, where the spec bans negative numbers",
        "created_at": "2020-08-13T03:23:39.425000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!273808422753796097\u003e Was there a reason you chose that, or just that it was easiest in Python which happens to be your language of choice?",
        "created_at": "2020-08-13T03:25:54.270000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Playing catchup here, are there other languages that do floored division the other way?",
        "created_at": "2020-08-13T03:27:12.614000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "All languages except for Python do truncation.",
        "created_at": "2020-08-13T03:27:45.119000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(I'm sure there are, I'm just curious whether doing it the way python does it makes it difficult for specific other languages)",
        "created_at": "2020-08-13T03:27:47.657000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Python is the *only* language I could find that does round to negative infinity.",
        "created_at": "2020-08-13T03:28:02.817000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh I strongly believe round-down is mathematically correct üòõ",
        "created_at": "2020-08-13T03:28:05.168000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It satisfies more of the invariants we come to expect of division",
        "created_at": "2020-08-13T03:28:14.061000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\"round down\" meaning toward negative infinity?",
        "created_at": "2020-08-13T03:28:15.634000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yeah",
        "created_at": "2020-08-13T03:28:18.710000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so floored division in go/rust does `-13 // 5 = -2`?",
        "created_at": "2020-08-13T03:28:20.933000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes.",
        "created_at": "2020-08-13T03:28:24.989000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But if we want to ban negative numbers and rewrite with positive only I'm happy with that too; after all it is the path eth2 is taking",
        "created_at": "2020-08-13T03:29:11.427000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What invariants?  The only invariant that I would expect to hold (which I don't believe does with round to negative infinity) is that this is true:  `(a / b) * b + (a % b) == a` (I think I got that right)",
        "created_at": "2020-08-13T03:29:23.223000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that does hold with round to negative infinity",
        "created_at": "2020-08-13T03:29:45.877000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(-13 / 5) * 5 + (-13 % 5) = -3 * 5 + 2 * 5 = -13",
        "created_at": "2020-08-13T03:30:07.109000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Mod gives outputs in 0.....n-1 for positive n",
        "created_at": "2020-08-13T03:30:22.073000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm engaged and I don't have a strong opinion.  I like python üò∏ .  I care more that this continues to move forward and I don't think we have to all agree so I'd encourage you to hear out all the opinions you can stand/tolerate and then make whatever choice you feel is best as long as it results in a well defined spec.",
        "created_at": "2020-08-13T03:31:15.111000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "```python\n# python\n\u003e\u003e\u003e -13 % 5\n2\n```\n```javascript\n// javascript\n\u003e -13n % 5n\n-3n\n```",
        "created_at": "2020-08-13T03:31:45.197000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In that case I do lean slightly toward banning negative numbers in the spec",
        "created_at": "2020-08-13T03:31:45.575000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "right, python mod is compatible with python div, and c++ mod is compatible with c++ div",
        "created_at": "2020-08-13T03:32:05.818000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So apparently the issue is that Python does `%` different than other languages.",
        "created_at": "2020-08-13T03:32:08.361000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Interesting.",
        "created_at": "2020-08-13T03:32:19.559000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The nice thing about python mod is that `(k + n) % n = k % n`",
        "created_at": "2020-08-13T03:32:27.574000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And mod n maps to an n-element set",
        "created_at": "2020-08-13T03:32:50.839000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You have successfully convinced me that Python's `//` is right, and its `%` is wrong.  üòâ",
        "created_at": "2020-08-13T03:33:10.655000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And by \"wrong\" I mean \"doesn't match every other programming language out there\".",
        "created_at": "2020-08-13T03:33:35.192000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That is, Python's math is an outlier in programming languages, and because of that, its `//` operator does what makes sense for Python, but it means it is also an outlier.",
        "created_at": "2020-08-13T03:34:07.110000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://www.wolframalpha.com/input/?i=-13+mod+5",
        "created_at": "2020-08-13T03:34:59.567000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This may be a \"programmer vs math\" war where python prefers sticking with the mathies üòõ",
        "created_at": "2020-08-13T03:35:16.855000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I find `2` to be a very unintuitive answer to `-13 mod 5`.  My intuition has certainly been *wrong* before when it comes to math though.",
        "created_at": "2020-08-13T03:36:05.920000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think the strong intuition for me is that mod n should have n possible answers, not 2n-1 possible answers",
        "created_at": "2020-08-13T03:36:37.220000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think the reason is because when I think of mod, I think of \"all the decimals of a floating point division result\" (intuitively).",
        "created_at": "2020-08-13T03:36:41.619000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "right",
        "created_at": "2020-08-13T03:36:50.945000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`-13 / 5 = -2.6` thus (intuition) `-13 // 5 == 2` and `-13 % 5 == 0.6 * 5 == 3`",
        "created_at": "2020-08-13T03:39:12.736000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yep yep I get it",
        "created_at": "2020-08-13T03:39:20.041000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "IIUC, you are saying this intuition is wrong?",
        "created_at": "2020-08-13T03:39:29.929000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It's not wrong, it's just..... not the only way of looking at mod",
        "created_at": "2020-08-13T03:39:44.708000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the way mathematicians look at mod is as a way of collapsing all integers into the space 0.....n-1 that preserves arithmetic properties",
        "created_at": "2020-08-13T03:40:06.941000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "oh btw I've kinda wished that someone promotes a version of arithmetic where we replace the negative sign with a `...` symbol that has different mechanics, basically representing an infinite trail of nines",
        "created_at": "2020-08-13T03:41:09.638000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So eg. `3 - 5 = ...8` ,  `12 - 24 = ...88`, `...96 + 5 = 1`",
        "created_at": "2020-08-13T03:41:36.446000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "there's a big part of me that feels like this is more natural üòÜ",
        "created_at": "2020-08-13T03:42:01.843000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it's actually how computers internally represent signed integers in binary oddly enough",
        "created_at": "2020-08-13T03:42:16.622000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Against my better judgement... I'm going to ask why an infinite trail of nines would help?  üòÑ",
        "created_at": "2020-08-13T03:42:49.825000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It preserves some nice properties, like for example the algorithm for computing `a-b` would not need to have two \"special cases\", one for a\u003cb and the other for a\u003eb",
        "created_at": "2020-08-13T03:43:28.710000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Another nice property:\n\n2012 - 24 = 1988\n1012 - 24 = 988\n12 - 24 = ...88",
        "created_at": "2020-08-13T03:43:50.375000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "...012 - 24 = ...8988",
        "created_at": "2020-08-13T03:44:01.168000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "üòã",
        "created_at": "2020-08-13T03:44:05.534000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Hmm, interesting.",
        "created_at": "2020-08-13T03:44:10.879000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": ":",
        "created_at": "2020-08-13T03:44:37.037000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Does anyone have any suggestions on how to write the 1559 spec such that it doesn't use negatives?  I can just do a conditional, but that feels like it is kind of cheating.",
        "created_at": "2020-08-13T03:44:40.372000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "```\nif gas_used \u003c gas_target: ...\nelse: ...\n```",
        "created_at": "2020-08-13T03:45:09.765000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "eth2 just uses a conditional",
        "created_at": "2020-08-13T03:45:22.655000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah, so it just *hides* its subtraction.  üôÇ",
        "created_at": "2020-08-13T03:45:42.544000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Does this look right for a \"negative-free formula\"?\n```python\n# check if the base fee is correct\n\nif parent_gas_used \u003e= parent_gas_target:\n    excess_gas_used = parent_gas_used - parent_gas_target\n    expected_base_fee = parent_base_fee + parent_base_fee * excess_gas_used // parent_gas_target // BASE_FEE_MAX_CHANGE_DENOMINATOR\nelse:\n    extra_gas_available = parent_gas_target - parent_gas_used\n    expected_base_fee = parent_base_fee - parent_base_fee * extra_gas_available // parent_gas_target // BASE_FEE_MAX_CHANGE_DENOMINATOR\nassert expected_base_fee == block.base_fee, 'invalid block: base fee not correct'\n```",
        "created_at": "2020-08-13T09:13:29.491000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Though, I think that would be consensus incompatible with current implementations, and per my agreement with \u003c@!376568077950910466\u003e earlier we don't want to do a consensus change at the moment for this.",
        "created_at": "2020-08-13T09:14:18.298000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Does someone have an equivalent algorithm that is consensus compatible with Euclidian division?",
        "created_at": "2020-08-13T09:14:42.624000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@456226577798135808\u003e or \u003c@!273808422753796097\u003e may have thoughts on ‚òùÔ∏è since you both were weakly advocating for it earlier.",
        "created_at": "2020-08-13T09:18:12.756000+00:00",
        "attachments": []
    }
]