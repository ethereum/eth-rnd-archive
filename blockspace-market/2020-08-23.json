[
    {
        "author": "pintail_xyz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm playing round with a fork of \u003c@!486501030046203915\u003e's simulation to look at the impact of including multiple miner strategies. I'm trying to see if I can create an equilibrium where the basefee tends to zero and the tip market looks something like the current gas market. To check I understand correctly, is the gasPremium in effect the maximum tip that the user will pay to the miner? So tip = min(gasPremium, feeCap - basefee)",
        "created_at": "2020-08-23T05:23:47.682000+00:00",
        "attachments": null
    },
    {
        "author": "pintail_xyz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also I've noticed people using the word \"bribe\" rather than tip lately - do these mean the same thing, and does anyone have a strong reason for using one or the other?",
        "created_at": "2020-08-23T05:24:42.991000+00:00",
        "attachments": null
    },
    {
        "author": "pintail_xyz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If the above is correct, in a degenerate fee market, users might simply set gasPremium=feeCap to ensure that the maximum fee goes to the miner to increase chances of inclusion. Perhaps one miner strategy would be to reject transactions with gasPremium \u003c feeCap - basefee, since that user has signalled that they are willing to spend more on the transaction but will only do so if it goes to the basefee.",
        "created_at": "2020-08-23T05:38:36.949000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!466048602326695938\u003e gas_premium ~= gas_price ~= miner_bribe ~= miner_tip",
        "created_at": "2020-08-23T05:57:26.604000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I personally like bribe because it is more clear to the novice reader what it is.",
        "created_at": "2020-08-23T05:57:47.583000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You have to bribe miners to include your transaction in the block.",
        "created_at": "2020-08-23T05:58:06.461000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "```python\npremium_per_gas = min(transaction.gas_premium, transaction.fee_cap - block.base_fee)\n```",
        "created_at": "2020-08-23T05:58:56.515000+00:00",
        "attachments": null
    },
    {
        "author": "pintail_xyz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it's amusingly provocative for sure",
        "created_at": "2020-08-23T05:59:07.821000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e users might simply set gasPremium=feeCap to ensure that the maximum fee goes to the miner to increase chances of inclusion\nThis would be a huge waste of money for users.",
        "created_at": "2020-08-23T06:01:49.434000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I would want to see an argument why any more than a small number of users would choose to do this.",
        "created_at": "2020-08-23T06:02:01.147000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Some may do it on accident certainly, or due to not understanding, but there is almost no reason to do that for normal transactions.",
        "created_at": "2020-08-23T06:02:23.187000+00:00",
        "attachments": null
    },
    {
        "author": "pintail_xyz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yep, I can see based on what you've told me that these strategies are probably sub-optimal for both users and miners, but I still think it's interesting to play with them, if only to demonstrate how unlikely a degenerate fee market is",
        "created_at": "2020-08-23T06:06:31.226000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e I'm playing round with a fork of \u003c@!486501030046203915\u003e's simulation to look at the impact of including multiple miner strategies. I'm trying to see if I can create an equilibrium where the basefee tends to zero and the tip market looks something like the current gas market. To check I understand correctly, is the gasPremium in effect the maximum tip that the user will pay to the miner? So tip = min(gasPremium, feeCap - basefee)\n\u003c@!466048602326695938\u003e yes! i know there is a bunch of different terms around. I try to be consistent, although I will soon refactor the entire repo to change `max_fee` to `fee_cap`, to agree with the specs. But I still find the distinction between `gas_premium` (specs-defined) and `tip` (not specs-defined) helpful",
        "created_at": "2020-08-23T13:01:12.971000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "and let me know if there is anything unclear in the code or something i can help with. it's by no means complete yet",
        "created_at": "2020-08-23T13:01:35.910000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "setting `fee_cap` = `gas_premium` is quite strange indeed, but is probably the best implementation of the \"I want to be in front of everyone as long as the price is less than `fee_cap`\" strategy",
        "created_at": "2020-08-23T13:04:11.788000+00:00",
        "attachments": null
    },
    {
        "author": "pintail_xyz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thanks! I think it all makes sense now. I'm currently working on an estimator (a simplified ethgasstation) which simulated users will use to select gas_premium rather than using a fixed 1 gwei as in the current simulation. Once I've got that working and done a few runs I'd really appreciate some feedback üßê",
        "created_at": "2020-08-23T13:18:56.178000+00:00",
        "attachments": null
    },
    {
        "author": "pintail_xyz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "utlimately I think it would be good to be able to model a range of user strategies and a range of miner strategies to see if the interactions of any of these can 'break' the protocol",
        "created_at": "2020-08-23T13:20:58.067000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that's the goal indeed! again, this is a draft, but in this notebook you can see a simple User subclass with a more elaborate bidding strategy https://github.com/barnabemonnot/abm1559/blob/master/notebooks/strategicUser.ipynb",
        "created_at": "2020-08-23T13:22:43.107000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e Thanks! I think it all makes sense now. I'm currently working on an estimator (a simplified ethgasstation) which simulated users will use select gas_premium rather than using a fixed 1 gwei as in the current simulation. Once I've got that working and done a few runs I'd really appreciate some feedback üßê\nWhat will the \"estimator\" do to \"estimate\" required bribe?",
        "created_at": "2020-08-23T13:35:07.170000+00:00",
        "attachments": null
    },
    {
        "author": "pintail_xyz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it tries to estimate the probability of inclusion in the next block `p_t = p(inclusion | tip)`, this is modelled as being constant, and is estimated from the previous k blocks. Users who want their tx included in the next n blocks find the tip such that `1-(1-p_t)^n \u003e threshold` (i.e we calculate the probability of *not* being included in the next n blocks). Clearly if the protocol is working as intended and all tx with `tip = 1 gwei` are being included then the estimator is just going to tell the user to set the tip to 1 gwei (this being modelled as the minimum at present)",
        "created_at": "2020-08-23T14:09:07.218000+00:00",
        "attachments": null
    },
    {
        "author": "pintail_xyz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The estimator is only useful if the protocol is not working as intended - either because it's flooded with more transactions than can be included even in a full 1559 block, or because miners are adopting a strategy intended to force users to increase the tip",
        "created_at": "2020-08-23T14:12:58.887000+00:00",
        "attachments": null
    },
    {
        "author": "pintail_xyz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "clearly such situations can only be modeled if the tip can be varied by users in response",
        "created_at": "2020-08-23T14:13:23.070000+00:00",
        "attachments": null
    },
    {
        "author": "pintail_xyz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e and let me know if there is anything unclear in the code or something i can help with. it's by no means complete yet\n\u003c@!486501030046203915\u003e One thing I was wondering about is why you've called the simulated user an \"affine\" user?",
        "created_at": "2020-08-23T14:31:24.147000+00:00",
        "attachments": null
    },
    {
        "author": "pintail_xyz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e that's the goal indeed! again, this is a draft, but in this notebook you can see a simple User subclass with a more elaborate bidding strategy https://github.com/barnabemonnot/abm1559/blob/master/notebooks/strategicUser.ipynb\n\u003c@!486501030046203915\u003e this is much simpler than what I was working on and definitely a better start point!",
        "created_at": "2020-08-23T14:35:06.418000+00:00",
        "attachments": null
    },
    {
        "author": "pintail_xyz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But with the mixed miner strategies I was using, basing the gas_premium solely on the min gas_premium from the previous block probably won't work well if some portion of the hashpower is playing games like mining empty blocks - probably makes sense to consider at least the last few blocks",
        "created_at": "2020-08-23T14:47:58.436000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e it tries to estimate the probability of inclusion in the next block `p_t = p(inclusion | tip)`, this is modelled as being constant, and is estimated from the previous k blocks. Users who want their tx included in the next n blocks find the tip such that `1-(1-p_t)^n \u003e threshold` (i.e we calculate the probability of *not* being included in the next n blocks). Clearly if the protocol is working as intended and all tx with `tip = 1 gwei` are being included then the estimator is just going to tell the user to set the tip to 1 gwei (this being modelled as the minimum at present)\n\u003c@!466048602326695938\u003e this is close to the approach from the paper I am modelling the simulations after. at equilibrium, you have some function that maps your bid to your waiting time (assuming stationarity), given everyone else's bids. this is for the first-price auction fee market, so extending the analysis to the basefee + maxfee/gaspremium parameters would be cool",
        "created_at": "2020-08-23T15:31:44.160000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e \u003c@!486501030046203915\u003e One thing I was wondering about is why you've called the simulated user an \"affine\" user?\n\u003c@!466048602326695938\u003e I created two \"base\" user classes, one which evaluates its cost using an affine function of time, starting from its value and decreasing each time step by a fixed cost, and the other one is \"discount\" user, where instead your value is discounted over time with some rate. more info here: http://barnabemonnot.com/abm1559/build/html/#users (again: very preliminary docs. also: it's not value per Gwei but per _gas unit_)",
        "created_at": "2020-08-23T15:33:43.080000+00:00",
        "attachments": null
    },
    {
        "author": "pintail_xyz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah thanks. I guess I hadn't really heard the term used outside linear algebra but I suppose affine basically means linear anyway",
        "created_at": "2020-08-23T15:47:35.558000+00:00",
        "attachments": null
    },
    {
        "author": "pintail_xyz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e \u003c@!466048602326695938\u003e this is close to the approach from the paper I am modelling the simulations after. at equilibrium, you have some function that maps your bid to your waiting time (assuming stationarity), given everyone else's bids. this is for the first-price auction fee market, so extending the analysis to the basefee + maxfee/gaspremium parameters would be cool\n\u003c@!486501030046203915\u003e encouraging you don't think I've started on completely the wrong track! Still I think I will experiment with your StrategicUser first",
        "created_at": "2020-08-23T15:48:26.985000+00:00",
        "attachments": null
    },
    {
        "author": "pintail_xyz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "on miner side I'm creating strategies that can target a fixed (non-full) block size and a minimum tip, with various mixtures of hash power (alongside some proportion of \"default\" miners who will completely fill blocks with a minimum tip of 1 gwei)",
        "created_at": "2020-08-23T15:51:15.832000+00:00",
        "attachments": null
    },
    {
        "author": "mrherowarrior",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://www.gstatic.com/allo/stickers/pack-100002/v1/xxhdpi/10.gif",
        "created_at": "2020-08-23T18:31:06.750000+00:00",
        "attachments": null
    },
    {
        "author": "mrherowarrior",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Good Job... \u003c@466048602326695938\u003e üëçüëçüëç",
        "created_at": "2020-08-23T18:32:06.029000+00:00",
        "attachments": null
    },
    {
        "author": "afdudley",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!466048602326695938\u003e \u003c@!486501030046203915\u003e are your simulations constrained by the hardware you have available? would it be useful to you folks for someone to contribute AWS credits, for example?",
        "created_at": "2020-08-23T20:03:43.998000+00:00",
        "attachments": null
    }
]