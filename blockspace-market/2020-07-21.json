[
    {
        "author": "afdudley",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I agree that is the best solution. Now someone has to make an argument for the change.",
        "created_at": "2020-07-21T00:58:47.827000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The argument is simple.  Convincing Geth that they should prioritize it over *everything else on their plate* is the hard part.  ðŸ™‚",
        "created_at": "2020-07-21T01:05:34.079000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "None of the client dev teams are particularly well staffed, and many are entirely volunteer.",
        "created_at": "2020-07-21T01:05:46.085000+00:00",
        "attachments": []
    },
    {
        "author": "Deleted User",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I thought this was good, actually: https://github.com/ethereum/go-ethereum/issues/21350",
        "created_at": "2020-07-21T06:53:24.111000+00:00",
        "attachments": []
    },
    {
        "author": "hendrik_h",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If we can agree on a new sorting mechanism I would volunteer to implement it and open a PR if it's not overly complex.",
        "created_at": "2020-07-21T06:59:37.830000+00:00",
        "attachments": []
    },
    {
        "author": "kiwi.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oooo nice",
        "created_at": "2020-07-21T07:06:30.672000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We have 2 consensus issues on the testnet. Both related to handling of legacy transactions during the transition period. Could you guys please confirm or not my assumptions:\n- we should ensure transaction price for legacy transaction (i.e gasPrice field) to be greater than base fee for EIP-1559 blocks\n- we should deduce the base fee from the coinbase credit even for legacy transactions within EIP-1559 blocks",
        "created_at": "2020-07-21T10:50:27.653000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This is what i did in Besu implementation, Geth implementation differs on those cases. So i want to make sure i am right before asking for a change in Geth implementation.",
        "created_at": "2020-07-21T10:52:16.717000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e - we should ensure transaction price for legacy transaction (i.e gasPrice field) to be greater than base fee for EIP-1559 blocks\nNo.",
        "created_at": "2020-07-21T11:11:08.623000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e - we should deduce the base fee from the coinbase credit even for legacy transactions within EIP-1559 blocks\nNo.",
        "created_at": "2020-07-21T11:11:16.009000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh really ?",
        "created_at": "2020-07-21T11:11:22.106000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Legacy transaction pool is processed *identical* to how things have always worked previously.  The point of it is to be a no-op change from previous to give people time to adjust before the new pool mechanics are forced on them.",
        "created_at": "2020-07-21T11:11:33.018000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But i thought it would give an incentive to miners to include only legacy transactions if we don't burn the the base fee",
        "created_at": "2020-07-21T11:12:29.514000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The only thing that should be different is that the max number of transactions included will be smaller (and continue to shrink down to 0 over time).",
        "created_at": "2020-07-21T11:12:43.921000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "All miners will be able to do is screw users, they won't benefit from it.",
        "created_at": "2020-07-21T11:13:05.392000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ok ok i see",
        "created_at": "2020-07-21T11:13:26.881000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The next miner in line will just include the transaction anyway (elastic blocks allow for this), and eventually legacy transactions will go away so screwing users more and more for 800,000 blocks isn't a great long term strategy.",
        "created_at": "2020-07-21T11:13:29.909000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In that case i will update Besu implementation. Thanks",
        "created_at": "2020-07-21T11:13:56.518000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I am 95% that was the intent, let me verify with the spec that it isn't explicitly written the other way...",
        "created_at": "2020-07-21T11:14:50.546000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e During the transition phase, these fields can be left `nil` and a `tx.gas_price` can be set as usual to generate a backwards compatible legacy transaction",
        "created_at": "2020-07-21T11:15:22.319000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Though, I don't think that is actually true?",
        "created_at": "2020-07-21T11:15:36.240000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think the spec needs updated, since at the moment legacy transactions will *not* be supported if someone implements the spec.",
        "created_at": "2020-07-21T11:16:12.726000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Legacy transactions **MUST** be shaped exactly the same as before so legacy signing tools will continue to work.",
        "created_at": "2020-07-21T11:16:29.105000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This means you cannot add two empty fields, since RLP encoded empty fields take up space (1 byte each).",
        "created_at": "2020-07-21T11:16:51.992000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah i agree. RLP encoding must be exactly the same",
        "created_at": "2020-07-21T11:17:03.969000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@574864862338088960\u003e Where did you put the new fields in both pre-signed and signed transactions?  At the end of the signed data, or in place of `gasPrice`?",
        "created_at": "2020-07-21T11:19:06.670000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "at the end",
        "created_at": "2020-07-21T11:19:48.066000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "gas price is empty for new transactions",
        "created_at": "2020-07-21T11:19:58.007000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "*grumble*",
        "created_at": "2020-07-21T11:20:07.077000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(not your fault, poor spec)",
        "created_at": "2020-07-21T11:20:13.287000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "you think it is bad ?",
        "created_at": "2020-07-21T11:20:28.665000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Legacy Transactions:\n```\nrlp([nonce, gasPrice, gasLimit, to, value, data]) // unsigned\nrlp([nonce, gasPrice, gasLimit, to, value, data, v, r, s]) // signed\n```\nEIP-1559 Transactions:\n```\nrlp([nonce, gasLimit, to, value, data, gasPremium, feeCap]) // unsigned\nrlp([nonce, gasLimit, to, value, data, gasPremium, feeCap, v, r, s]) // signed\n```",
        "created_at": "2020-07-21T11:21:01.215000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That is my recommendation.",
        "created_at": "2020-07-21T11:21:04.576000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Having that empty field in the middle is just wasteful.",
        "created_at": "2020-07-21T11:21:16.032000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Separately, I really would like to see EIP-2718 included in the same fork as 1559, or sooner.",
        "created_at": "2020-07-21T11:21:42.360000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Actually i have followed Geth implementation for the encoding",
        "created_at": "2020-07-21T11:21:53.373000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I agree 2718 would definitely help",
        "created_at": "2020-07-21T11:22:04.268000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Any idea who we can mention here for Geth to try to get that updated?",
        "created_at": "2020-07-21T11:22:11.490000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I really don't think we should be gossiping transactions that have a completely wasted byte in them.",
        "created_at": "2020-07-21T11:22:29.571000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!376568077950910466\u003e , thoughts ?",
        "created_at": "2020-07-21T11:22:58.254000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!301186049323958275\u003e Do you think we can keep as is for the testnet, don't want to delay it now",
        "created_at": "2020-07-21T11:23:15.390000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I don't think it will make any difference for what we want to validate",
        "created_at": "2020-07-21T11:23:32.706000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I only care about what lands on mainnet.  ðŸ™‚",
        "created_at": "2020-07-21T11:23:38.690000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ahh ok, right.",
        "created_at": "2020-07-21T11:23:50.259000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "However, my life experience tells me that the longer we wait to change this the harder it will become.",
        "created_at": "2020-07-21T11:23:58.562000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "For example, waiting until there are 5 clients that have it implemented vs 2 clients.",
        "created_at": "2020-07-21T11:24:08.766000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Definitely.",
        "created_at": "2020-07-21T11:24:20.409000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "However, you are correct that it doesn't really matter much for what is being tested.",
        "created_at": "2020-07-21T11:24:32.828000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The extra byte is unlikely to be the piece that makes everything break. ðŸ™‚",
        "created_at": "2020-07-21T11:24:43.786000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Haha i hope so. Otherwise we have bigger problems. Ok let's keep as is for the encoding. I will work on Besu implementation to align with Geth on processing legacy transactions",
        "created_at": "2020-07-21T11:25:21.871000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://github.com/ethereum/EIPs/pull/2812",
        "created_at": "2020-07-21T11:29:22.490000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If I can manage to get buy-in from Core Devs on 2718, then I'll update 1559 to use that, which should help alleviate this kind of confusion.",
        "created_at": "2020-07-21T11:30:26.920000+00:00",
        "attachments": []
    },
    {
        "author": "abdel.stark",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ok sounds good.",
        "created_at": "2020-07-21T11:33:20.258000+00:00",
        "attachments": []
    },
    {
        "author": "afdudley",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e Legacy transactions **MUST** be shaped exactly the same as before so legacy signing tools will continue to work.\n\u003c@!301186049323958275\u003e Yeah, that was probably a mistake on our end.",
        "created_at": "2020-07-21T14:05:30.442000+00:00",
        "attachments": []
    },
    {
        "author": "afdudley",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e I am 95% that was the intent, let me verify with the spec that it isn't explicitly written the other way...\n\u003c@!301186049323958275\u003e Yes, that was the intent, the legacy transactions need to have identical RLP encodings.",
        "created_at": "2020-07-21T14:06:20.151000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "PR out to make 1559 more clear.",
        "created_at": "2020-07-21T14:07:43.933000+00:00",
        "attachments": []
    },
    {
        "author": "kiwi.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thanks Micah",
        "created_at": "2020-07-21T17:06:43.838000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In the  geth implementation legacy txs are shaped, encoded, and handled exactly the same as they currently are, but the EIP1559 transactions do currently include the `nil` gasPrice field in the rlp encoding. Don't see any reason we shouldn't change that, but like others have said it's not a pressing change. I'm on vacay right now but I'll open a PR to update the EIP sometime this week (if nobody beats me to it), I'll include the other changes discussed here e.g. removing reference to 10 mil. One potential issue with me opening PRs is that they will be automerged before people can review, don't want people thinking I'm sneaking in changes!",
        "created_at": "2020-07-21T20:02:24.413000+00:00",
        "attachments": []
    },
    {
        "author": "iannorden",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh here I go writing without reading everything again, thank you for opening that PR \u003c@!301186049323958275\u003e",
        "created_at": "2020-07-21T20:19:00.633000+00:00",
        "attachments": []
    }
]