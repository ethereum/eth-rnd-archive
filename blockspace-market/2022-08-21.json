[
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think no client makes this comparison. And in most scenarios it's not possible to fall back once you've sent the signed blinded block cause that header is enough to slash you",
        "created_at": "2022-08-21T00:14:14.338000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "By \"fallback\" I mean if you don't get *any* block from the relay.",
        "created_at": "2022-08-21T00:15:13.742000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also, it annoys me that the clients aren't comparing relay ~~blocks~~ bids against native blocks.  This just seems like a great way to get screwed by the relay/builder.",
        "created_at": "2022-08-21T00:15:33.601000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You mean if you don't get any bid?",
        "created_at": "2022-08-21T00:15:38.735000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah.",
        "created_at": "2022-08-21T00:15:44.767000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If you don't get any bid I *think* we do fallback to local EE. I mean we can fall back on any error that happens before we send a blind block.",
        "created_at": "2022-08-21T00:17:03.507000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This may not be impossible to do, but it's hard. It requires you to execute your own block and get the amount that you got increased in your fee recipient address in order to compare with the relay's bid, this before you decide to sign and send. There's no API on the EE (afaik) to do this so any cooked up version for this will be client specific probably and there goes diversity",
        "created_at": "2022-08-21T00:19:41.280000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Why can't you just ask the EL to build you a block like normal?",
        "created_at": "2022-08-21T00:25:53.137000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Then the CL would just *not* sign it right away.",
        "created_at": "2022-08-21T00:26:15.095000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What do you compare against the bid? We always ask the EE to start producing a block early because we send FCU and I understand the engine will start producing a block",
        "created_at": "2022-08-21T00:27:08.637000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We don't request the block though with getPayload",
        "created_at": "2022-08-21T00:27:39.822000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I guess the consensus layer doesn't know how to sum the fees?",
        "created_at": "2022-08-21T00:33:55.873000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Exactly",
        "created_at": "2022-08-21T00:34:05.397000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "While technically the block author can receive money sent indirectly, summing the fees will get you the block's yield with like 99.9% accuracy or something for non relay blocks.",
        "created_at": "2022-08-21T00:34:27.339000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Summing the fees from transactions feels easy enough that it is worth doing to protect the proposer from getting screwed by the relay.",
        "created_at": "2022-08-21T00:34:50.834000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Without it, the relay can give you a block where you get no fees and the CL will accept it as \"best bid\".",
        "created_at": "2022-08-21T00:35:30.561000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This strategy *also* increases the power of censoring relays because native blocks with censored transactions can't beat out MEV blocks without censored transactions, even when there are a lot of high fee censored transactions available.",
        "created_at": "2022-08-21T00:36:11.945000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I was the one that raised this issue a few weeks back in \u003c#874767108809031740\u003e but desisted in following. The reason being that adding this complexity of transaction parsing to the CL is just crazy. Perhaps it's doable if we add this as part of the response to getPayload, to not only get the block but also the fees (it may be worth opening an issue in the execution API for this) but also because the relay/builder has much to lose by cheating this way, since a single monitoring service can check after the fact",
        "created_at": "2022-08-21T00:42:39.094000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm more concerned about how it enables censoring relays to censor *at a loss* to the CL.",
        "created_at": "2022-08-21T00:43:54.240000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah I can see how this is a method to know the relay is censoring",
        "created_at": "2022-08-21T00:45:23.228000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I don't think calculating fee revenue would be *that* onerous.  You just have to iterate over the receipts and multiply `gasUsed * min(priorityFeePerGas, maxFeePerGas - baseFeePerGas)` for each receipt.",
        "created_at": "2022-08-21T00:45:25.318000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I suppose if you don't currently have an RLP decoder it is a pretty big leap though (assuming receipts are RLP encoded when given to the CL).",
        "created_at": "2022-08-21T00:45:45.745000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We do not have access to any structure in the transaction. For us they are just bytes",
        "created_at": "2022-08-21T00:45:55.778000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Same with receipts?",
        "created_at": "2022-08-21T00:46:11.553000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah",
        "created_at": "2022-08-21T00:46:16.781000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We know nothing about the payload essentially",
        "created_at": "2022-08-21T00:46:32.872000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But I do think it may be worth to open the issue as a return value from getPayload, cause it may be simple for the EL to return this",
        "created_at": "2022-08-21T00:47:15.820000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Actually for the receipts is worse right? Since those are not in the block",
        "created_at": "2022-08-21T00:49:15.610000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We only get the root",
        "created_at": "2022-08-21T00:49:21.220000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "They are part of the body IIRC.",
        "created_at": "2022-08-21T00:50:07.963000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, should be incredibly simple for the EL to return this.  Maybe we can convince \u003c@425572898787426305\u003e to work on it so neither of us have to.  ðŸ˜¬",
        "created_at": "2022-08-21T00:50:39.903000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I believe you only include the root in the block and you check by computing them after executing the block",
        "created_at": "2022-08-21T00:50:57.956000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003chttps://github.com/ethereum/consensus-specs/blob/dev/specs/bellatrix/beacon-chain.md#executionpayload\u003e",
        "created_at": "2022-08-21T00:51:51.354000+00:00",
        "attachments": null
    }
]