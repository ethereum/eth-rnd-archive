[
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Can anyone explain the purpose of `epoch` in `VoluntaryExit`?  I understand it technically, just not sure where it would be useful.  Plus, having it around leads to a number of questions as to what to do with exit requests for a future epoch.",
        "created_at": "2019-12-05T09:22:56.983000+00:00",
        "attachments": []
    },
    {
        "author": "mpetrunic",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "From spec: Exits must specify an epoch when they become valid; they are not valid before then",
        "created_at": "2019-12-05T09:24:48.577000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yes but *why* is it there?  What situation?",
        "created_at": "2019-12-05T09:26:15.174000+00:00",
        "attachments": []
    },
    {
        "author": "mpetrunic",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "So you can broadcast on network that you will be exiting in currentEpoch+3 epoch, and validators cannot include exit in a block before that epoch",
        "created_at": "2019-12-05T09:26:29.130000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Still *why*.  What's the point of it, as opposed to waiting for currentEpoch+3 and then exiting?",
        "created_at": "2019-12-05T09:27:01.297000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "(It is also potentially dangerous in that any request to exit in the future could be delayed by other validators asking to exit inbetweentimes and pushing the request to a further epoch thanks to the churn limit)",
        "created_at": "2019-12-05T09:29:02.407000+00:00",
        "attachments": []
    },
    {
        "author": "mpetrunic",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Not sure, but here is some hint: https://notes.ethereum.org/@djrtwo/Bkn3zpwxB?type=view#VoluntaryExit",
        "created_at": "2019-12-05T09:32:10.541000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "That's... cryptic.  \u003c@291925846556540928\u003e any chance of elucidating?",
        "created_at": "2019-12-05T09:34:06.954000+00:00",
        "attachments": []
    },
    {
        "author": "m.kalinin",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "At least epoch is needed to correctly verify signature especially if chain is close to the fork boundary. If you're firing an exit near to the fork you can't be sure whether it'll be included before or after the forking block. By picking an epoch after the fork as an exit epoch you're achieving determinism in the processing of your exit. I am not sure about nefarious use cases though.",
        "created_at": "2019-12-05T09:46:52.718000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Okay so it's to anchor the domain.  Which then makes me wonder why not just always use `0` as the exit epoch?",
        "created_at": "2019-12-05T09:51:39.650000+00:00",
        "attachments": []
    },
    {
        "author": "mpetrunic",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Api changes regarding 0.9.2 spec and aggregation strategy. I would love your input before creating PR",
        "created_at": "2019-12-05T10:31:24.352000+00:00",
        "attachments": []
    },
    {
        "author": "mpetrunic",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "https://github.com/ethereum/eth2.0-APIs/issues/12",
        "created_at": "2019-12-05T10:31:24.771000+00:00",
        "attachments": []
    },
    {
        "author": "m.kalinin",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003e Which then makes me wonder why not just always use `0` as the exit epoch?\n\nBecause state doesn't maintain a history of fork versions, it holds the most recent one. And when a couple of forks after genesis epoch passed you're no more able to verify signature of messages signed with genesis fork version.",
        "created_at": "2019-12-05T10:49:16.604000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "That seems to be a technical limitation without any end-user rationale.  Back to *why* would someone sending a volutary exit ever set `epoch` to be a future value?\n\nRegarding your last suggestion: if you want your exit to only be included after the fork then broadcasting after the fork seems to have all of the same results as broadcasting before the fork with `epoch` after the fork.  What am I missing?",
        "created_at": "2019-12-05T11:16:51.851000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "(Thanks for the discussion on this, by the way; I'm totally happy to believe there is a reason I'm just not understanding, and thank you for helping me to understand)",
        "created_at": "2019-12-05T11:17:43.479000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Remember there's also an exit queue. Declaring your exit in advance avoids unpleasant surprises",
        "created_at": "2019-12-05T11:36:03.804000+00:00",
        "attachments": []
    },
    {
        "author": "mpetrunic",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@203220829473996800\u003e But you don't enter exit queue until your exit isn't processed?!",
        "created_at": "2019-12-05T11:37:33.827000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yeah so announcing in advance you want to exit leaves you open to others springing unpleasant surprises on you",
        "created_at": "2019-12-05T11:38:17.109000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Let me check, the exit queue sure is a fun part of the spec code ..",
        "created_at": "2019-12-05T11:39:06.523000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yep, it checks against current epoch, so no scheduling. Hmm",
        "created_at": "2019-12-05T11:40:41.511000+00:00",
        "attachments": []
    },
    {
        "author": "m.kalinin",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "IIRC, an epoch was added to all signed messages to deal with forks. As if operation semantics is gonna be changed by the fork you don't want to get surprised if someone digs out one of the old messages signed by you and include it into a block. This is basically similar to the previous explanation. As a semantics change you may assume removing a check on double spent as a stupid but demonstrative example.",
        "created_at": "2019-12-05T11:46:37.006000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "That doesn't hold though, as you can sign for fork x and execute on fork x+1",
        "created_at": "2019-12-05T11:48:41.465000+00:00",
        "attachments": []
    },
    {
        "author": "m.kalinin",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "a signature of message signed after fork x won't be valid after fork x+1",
        "created_at": "2019-12-05T11:49:47.452000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "But it *will* be valid on fork x+1, so for example if I signed a message now and an arbitrary time later fork x+1 comes along with different semantics the message is still valid and can be processed with those different semantics",
        "created_at": "2019-12-05T11:50:49.068000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "The fork gets a different signature domain fork version",
        "created_at": "2019-12-05T11:51:23.519000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yes but taking voluntary exits as an example `compute_domain()` uses the transaction's epoch not the current epoch to verify the signature.  So signature verifies for fork x and tx is processed on fork x+1 semantics",
        "created_at": "2019-12-05T11:52:21.862000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "But only signing over fork version, and not epoch, may be good. The epoch check against current epoch is definitely something to revisit",
        "created_at": "2019-12-05T11:53:16.493000+00:00",
        "attachments": []
    },
    {
        "author": "m.kalinin",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I guess, this fork version check in processing is not yet added and assumed to be added as a part of fork changes if it would be needed.",
        "created_at": "2019-12-05T11:54:40.228000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I can also see people publish exits for a future post fork epoch, but the old fork version. Signal that you don't support staying on the old fork, haha",
        "created_at": "2019-12-05T11:56:35.165000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "(If anyone is looking at `VoluntaryExit` in general, could there be some consideration for it not having an `epoch` and it being processed using `get_domain()` i.e. with a fork version of `0`?  Given it's kind-of user facing, the ability to have a long-lived transaction that can exit the validator held offline has use in situations where the validator and staker are different entities)",
        "created_at": "2019-12-05T11:57:20.560000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@203220829473996800\u003e forks aren't exactly namespaced though, are they?  So node devs could push updates that increase the fork version a few times one block after the other and bang goes that idea.\n\nAnd shame on you for suggesting using network resources for protest voting ðŸ˜„",
        "created_at": "2019-12-05T11:59:04.504000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "It's offchain voting, since there's no scheduling",
        "created_at": "2019-12-05T11:59:41.481000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "It would only be valid on chain when the thing voted against actually happens. That's the whole idea",
        "created_at": "2019-12-05T12:00:27.054000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "But anyway, it's more like a fun effect of the current design. Agree that there are other designs to consider, will bring it up with others",
        "created_at": "2019-12-05T12:01:12.422000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I'm now also considering not signing over the validator index, since the sig already is bound to the pubkey. That way you can aggregate exits for future forks, and have some very interesting offchain fork voting with weight",
        "created_at": "2019-12-05T12:03:48.508000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@144468805697929216\u003e you're voting against the old fork at a future epoch, not in favor of the new one.",
        "created_at": "2019-12-05T12:05:11.301000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yeah but you're voting against a version number not a feature set",
        "created_at": "2019-12-05T12:05:49.389000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Just saying \"I don't want to be on fork x come time y\" doesn't seem a particularly strong indication of positive desires",
        "created_at": "2019-12-05T12:06:27.729000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Sorry, though, going off-topic here.  Would love to hear the resolution on voluntary exits, happy to chip in with other thoughts as/when it is discussed further, will go away and implement them as-is for now",
        "created_at": "2019-12-05T12:07:26.871000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Can't make it any stronger than that. But we completely sidetracked here. The real question was the current epoch check. Something that indeed seems off, I'll bring it up and see what others have been thinking off. Signature checks with epoch can be improved probably",
        "created_at": "2019-12-05T12:08:24.891000+00:00",
        "attachments": []
    },
    {
        "author": "protolambda",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yes, thanks for going through the process in so much detail",
        "created_at": "2019-12-05T12:09:16.320000+00:00",
        "attachments": []
    },
    {
        "author": "djrtwo",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003e Still why.  What's the point of it, as opposed to waiting for currentEpoch+3 and then exiting? \n\nThis prevents your exit being replayed on a malicious fork before the epoch you actaully wanted to be exited in",
        "created_at": "2019-12-05T16:39:08.268000+00:00",
        "attachments": []
    },
    {
        "author": "djrtwo",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Say a bunch of vlaidators want to exit at epoch N. An attacker might make a malcious fork off of some past epoch and use their exit message to exit everyone at epoch `N - M`. This could lead to a number of unintended side effects and corner case scenarios",
        "created_at": "2019-12-05T16:40:09.613000+00:00",
        "attachments": []
    }
]