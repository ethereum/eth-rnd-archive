[
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I've written down the simple algorithm how we determine ETH1 data votes in Prysm. Please take a look and correct me if I am wrong with this understanding\nhttps://hackmd.io/@prestonvanloon/H1rfsG5iH",
        "created_at": "2019-11-14T02:07:27.806000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@399309815517544451\u003e are you persisting that hackmd? Is a good reference.",
        "created_at": "2019-11-14T12:29:48.099000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@456226577798135808\u003e yeah, would be happy to persist it somewhere more discoverable. Looking for feedback that we are taking the right approach",
        "created_at": "2019-11-14T19:48:52.911000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "The voting period is divided into two parts, the `start` and the `tail`. During the start, you only pile on your vote to the majority of votes that has blocks that  are suffiiciently new compared to the previous eth1data.block. Once you are in the `tail` of a period, you pile on your vote to _any_ valid eth1data that has the majority.\n\nThe distinction here is to prevent the 1st block proposer of a period having an overwhelming say in what the block is. They could easily just got one block later from the last eth1data and essentially delay (most) new deposits for that voting period. Instead, with this approach, early movers don't get any weight in the early vote if they didn't pick a block that was sufficiently \"new\" enough. Once you enter the tail of the period to just encourage consensus on aynthnig, the requirements become less strict",
        "created_at": "2019-11-14T22:19:07.215000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "In the implementation we have, we don’t even look at what he first block proposers vote was. Why is this needed?",
        "created_at": "2019-11-14T22:22:59.075000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Earlier discussion mentioned that the solution in the spec is to mitigate “lazy validators” but I don’t see how that is possible",
        "created_at": "2019-11-14T22:24:29.514000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@291925846556540928\u003e is this the proper channel for this discussion or should I write up a formal github issue",
        "created_at": "2019-11-14T22:26:11.428000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003e we don’t even look at what he first block proposers vote was. Why is this needed?\n\nDo you look at the second or the third?",
        "created_at": "2019-11-14T22:33:20.341000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "If you don't look at what the other votes are, you greatly diminish the chances of coming to consensus on a block",
        "created_at": "2019-11-14T22:33:44.798000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I never look at others votes when I’m determining what to vote on",
        "created_at": "2019-11-14T22:34:00.489000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "How greatly? We are reading the same ETH1 chain",
        "created_at": "2019-11-14T22:34:14.728000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Do we expect a lot of disparity?",
        "created_at": "2019-11-14T22:34:22.679000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "with the current follow distance, likely not much. If we reduce that follow distance in an effort for faster deposits and/or utilizing the finality gadget (in a potentially lower pow security environment) , the chances of forking on eth1 (naturally or more worrisome during an attack) go up and thus the success of a time-based algorithm goes down",
        "created_at": "2019-11-14T22:39:03.791000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "In the case that we use it as a finality gadget, we want a more active consensus from validators in choosing a block",
        "created_at": "2019-11-14T22:39:28.253000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "So yes, agreed that the mechanism you proposed will be equivalent in almost all scenarios with the current follow distance, but looking forward, I think we need a more sophisticated mechanism if we are to use this to finalize eth1",
        "created_at": "2019-11-14T22:40:26.869000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "(which I am a fan of because it opens up 2-way bridge and/or phase1 as a data availability layer to eth1)",
        "created_at": "2019-11-14T22:40:53.557000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Ok thanks for confirming. Reducing the follow distance is likely a risky trade off so I look forward to hearing more about that. Is that an active proposal somewhere?",
        "created_at": "2019-11-14T22:42:43.119000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Have there been any simulations or analysis?",
        "created_at": "2019-11-14T22:44:02.311000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "A more sophisticated algorithm comes with its own trade offs too. I think we should prefer simplicity when possible unless there is a clear need for a more complicated solution",
        "created_at": "2019-11-14T22:45:27.171000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Id argue straight counting is just as simple and leads to higher likelihood of forming consensus. Counting with this one conditional on slot optimizes that slightly. \n\nThe other worry with your method is if say there are 3 client types on the network all with 1/3 of validators with subtle timing issues between them, you could easily not form consensus with the pure timestamp approach. whereas the counting method would be robust",
        "created_at": "2019-11-14T22:58:10.155000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Not to pick apart your example, but you only need 50% to reach consensus. Subtle would have to be high disparity since we’re talking about a 14 second window on average",
        "created_at": "2019-11-14T23:03:28.676000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I’m not fully against implementing how the spec recommends it. My only complaint would be to write why it should be this way. Answers I’ve heard so far are lazy validators, stalled ETH1 chain, client disparity, we may shorten the follow distance",
        "created_at": "2019-11-14T23:06:00.522000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "No one seems to agree",
        "created_at": "2019-11-14T23:06:10.212000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Average! But sometimes blocks come in rapid succession on pow chain. A matter of a few seconds",
        "created_at": "2019-11-14T23:06:30.693000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Agreed on that. Its clearly a point of confusion in implementation  and lack of clarity",
        "created_at": "2019-11-14T23:07:09.544000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Im willing to help out here if I can, what’s the best route to improve the doc?",
        "created_at": "2019-11-14T23:07:44.247000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I’ll start with updating my hackmd with an extension that supports the algorithm in the spec with some rationale, then we can pick pieces from that maybe?",
        "created_at": "2019-11-14T23:08:48.701000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Let me know what you think",
        "created_at": "2019-11-14T23:08:54.623000+00:00",
        "attachments": null
    }
]