[
    {
        "author": ".vbuterin",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "What's the 6576, 8 and 4 there?",
        "created_at": "2021-08-18T05:53:16.375000+00:00",
        "attachments": null
    },
    {
        "author": "bitmexresearch",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "6576 is the number of attestors. which I have as number of validators divided by 32. Is that wrong?\n\n8 is PROPOSER_REWARD_QUOTIENT\n4 is BASE_REWARDS_PER_EPOCH",
        "created_at": "2021-08-18T09:06:57.122000+00:00",
        "attachments": null
    },
    {
        "author": "bitmexresearch",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "has anyone done this calculation? Would be good to report what the number should be right?",
        "created_at": "2021-08-18T10:30:40.045000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Ok, I'll walk you through the calculation",
        "created_at": "2021-08-18T11:07:58.982000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "you can estimate it like this, we need some constants first",
        "created_at": "2021-08-18T11:08:12.331000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "```\nBASE_REWARD_FACTOR = 64\nPROPOSER_REWARD_QUOTIENT = 8\nBASE_REWARDS_PER_EPOCH = 4\n```",
        "created_at": "2021-08-18T11:08:48.461000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "We take the current number of active validators, which is 210 935",
        "created_at": "2021-08-18T11:09:18.728000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "with this you estimate the `base_reward` to be 778 GWei with the formula\n```\neffective_balance * BASE_REWARD_FACTOR // integer_squareroot(total_balance) // BASE_REWARDS_PER_EPOCH\n```\nHere you take `effective_balance = 32*10^9` and the total balance to be this number times the number of effective validators (it's not exactly this, but it's close).",
        "created_at": "2021-08-18T11:11:14.617000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "now that's what a proposer gets for every included attestation, so we now estimate this (wrong again but not that much) to be the total number of validators divided by `SLOTS_PER_EPOCH=32`, we thus obtain \n```\n778*210935//32 = 5128357 Gwei\n```",
        "created_at": "2021-08-18T11:12:24.805000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "```\nactive_validator_count = 210_931\neffective_balance = commonly 32 * 1000_000_000 gwei\ntotal_balance = get_total_active_balance(state) = about effective_balance * active_validator_count = 32 * 1000_000_000 * 210_931 = 6_749_792_000_000_000 gwei\n\nBASE_REWARD_FACTOR = 64\nBASE_REWARDS_PER_EPOCH = 4\ninteger_squareroot(total_balance) = 82157117\n \ndef get_base_reward(state: BeaconState, index: ValidatorIndex) -\u003e Gwei:\n    total_balance = get_total_active_balance(state)\n    effective_balance = state.validators[index].effective_balance\n    return Gwei(effective_balance * BASE_REWARD_FACTOR // integer_squareroot(total_balance) // BASE_REWARDS_PER_EPOCH)\n\nbase_reward = 32 * 1000_000_000 * 64 / 82157117 / 4 = 6231 gwei\n\nPROPOSER_REWARD_QUOTIENT = 8\n\n# per attester that was included by proposer\ndef get_proposer_reward(state: BeaconState, attesting_index: ValidatorIndex) -\u003e Gwei:\n    return Gwei(get_base_reward(state, attesting_index) // PROPOSER_REWARD_QUOTIENT)\n\nproposer_reward_per_attester = 6231 / 8 = 778 gwei\n\nattesters_per_slot = active_validator_count / SLOTS_PER_EPOCH = 210_931 / 32 = 6591\n\noptimal_proposer_reward = proposer_reward_per_attester * attesters_per_slot = 778 * 6591 = 5_127_798 gwei = 0.005127798 ETH\nNote: this is with some variance, rounding errors, different committee sizes per slot, changing validator count, no slashing-includer rewards, no future tx fees, etc.\n```",
        "created_at": "2021-08-18T11:12:30.848000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "as the expected return for a proposal,",
        "created_at": "2021-08-18T11:12:32.583000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Was just typing the exact thing, but thanks potuz ðŸ˜›",
        "created_at": "2021-08-18T11:12:46.371000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "and this is essentially the same that was obtained by one of the las proposals like this validator https://beaconcha.in/validator/127020  in this block: https://beaconcha.in/block/1871671",
        "created_at": "2021-08-18T11:13:28.987000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "ohh yeah ðŸ™‚",
        "created_at": "2021-08-18T11:13:50.624000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@707358112318750833\u003e after reading your comment perhaps the issue in your calculation is that your are using ETH as units, indeed it's a somewhat of a problem that the constants in the specs are specified mostly unitless when they actually carry inherent units. In this case, amounts like rewards and balances are specified in Gwei and not ETH",
        "created_at": "2021-08-18T11:39:10.191000+00:00",
        "attachments": null
    },
    {
        "author": "bitmexresearch",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "thanks Potuz, yes I was using ETH",
        "created_at": "2021-08-18T11:39:43.972000+00:00",
        "attachments": null
    },
    {
        "author": "bitmexresearch",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I get it now",
        "created_at": "2021-08-18T11:39:47.849000+00:00",
        "attachments": null
    }
]