[
    {
        "author": "gregthegreek",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "is there an audited version of the deposit contract in solidity?",
        "created_at": "2020-02-21T05:04:49.704000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "or in raw bytecode?",
        "created_at": "2020-02-21T05:04:56.562000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Pretty sure it's only in Vyper but the evm bytecode is checked into the specs repo alongside the vyper code I believe.",
        "created_at": "2020-02-21T05:05:48.425000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "interesting...",
        "created_at": "2020-02-21T05:06:16.786000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Also has anyone implemented proper roll-back for syncing against the \"strongest\" head?",
        "created_at": "2020-02-21T05:06:36.554000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "assuming you fork",
        "created_at": "2020-02-21T05:06:43.429000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "what do you mean by \n\u003e Also has anyone implemented proper roll-back for syncing against the \"strongest\" head?\n\nAre you referring to the eth1 chain here ?",
        "created_at": "2020-02-21T05:07:36.426000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "nooo",
        "created_at": "2020-02-21T05:14:19.837000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "so like",
        "created_at": "2020-02-21T05:14:20.959000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "lets say i fork",
        "created_at": "2020-02-21T05:14:33.083000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "are you forever out of sync - or do you attempt to rollback and try to re-sync",
        "created_at": "2020-02-21T05:15:12.932000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "when you say you fork, do you mean a change in fork-version in the state or a short -term fork \ndue to different heads ?",
        "created_at": "2020-02-21T05:16:16.718000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "ha sorry - i should use better terminology",
        "created_at": "2020-02-21T05:16:39.082000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "fork in the heads",
        "created_at": "2020-02-21T05:16:42.917000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "ah k",
        "created_at": "2020-02-21T05:16:49.236000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "yeah that should be handled by forkchoice",
        "created_at": "2020-02-21T05:17:01.887000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "even if you are on a different head",
        "created_at": "2020-02-21T05:17:11.406000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "eventually you should settle on the head that the majority of the chain is on",
        "created_at": "2020-02-21T05:17:28.833000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "It does imply that you keep the BeaconState around for other forks and aren't just trying to track state for just the head you see as \"best\".",
        "created_at": "2020-02-21T05:17:41.865000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "So rollback really just looks like getting an old BeaconState from the Store (or some equivalent of it).",
        "created_at": "2020-02-21T05:18:08.899000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\"old\" or possibly just \"alternate\" state.",
        "created_at": "2020-02-21T05:18:24.856000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "yeap what I had  in mind ^",
        "created_at": "2020-02-21T05:18:31.075000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "we basically keep states from our finalized checkpoint onwards",
        "created_at": "2020-02-21T05:18:44.857000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "right thats more what im curious about",
        "created_at": "2020-02-21T05:19:04.085000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "how we store all the 'old' states ?",
        "created_at": "2020-02-21T05:19:36.422000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "you would have to have the appropriate state saved to rollback to and then continue building the chain from there",
        "created_at": "2020-02-21T05:20:39.194000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "presently we also keep all unfinalized epoch boundary states (not every slot) - \u003c@!322222239850168331\u003e you will also need this to validate incoming blocks and attestations (ie if someone creates a fork because they missed a block, you need its parent state to validate that the block is valid - until you've done this, you shouldn't gossip the block further for example",
        "created_at": "2020-02-21T08:22:04.447000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "the subtlety is that any events that you've scheduled, creating attestations and blocks, must be rescheduled in case of a reorg since the validator sets might be different on the two forks",
        "created_at": "2020-02-21T08:23:01.558000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "as far as terminology goes, we can use `branch` to denote these candidates for `head` selection (like git - this a similar graph after all) - this way we don't run into ambiguity with hard forks",
        "created_at": "2020-02-21T08:24:35.459000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "That's what you do in eth1",
        "created_at": "2020-02-21T13:11:38.890000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@449019668296892420\u003e you save caches of all forks for a period of time to make sure you stay on the heaviest chain",
        "created_at": "2020-02-21T13:12:07.616000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "yeah, we keep all branches from the finalization point.. it's a simple dag: you keep all heads in an array and they all end up at the latest finalized block. when finalization happens, we prune the array, removing anything that's older or equal to that point.",
        "created_at": "2020-02-21T13:33:47.142000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "this is what is fed into the fork choice, ie the tree of blocks - though for reasons I don't remember right now, fork choice starts at the latest justified block",
        "created_at": "2020-02-21T13:34:48.526000+00:00",
        "attachments": null
    }
]