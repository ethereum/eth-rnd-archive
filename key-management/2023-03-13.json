[
    {
        "author": "philogy",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Am I reading the spec correctly? Are deposits really permanently lost  if the signature for the deposit message is correct / doesn't verify? \nhttps://github.com/ethereum/consensus-specs/blob/dev/specs/phase0/beacon-chain.md#deposits specifically the `process_deposit` method states:\n```python\n        if not bls.Verify(pubkey, signing_root, deposit.data.signature):\n            return\n```",
        "created_at": "2023-03-13T17:12:23.834000+00:00",
        "attachments": []
    },
    {
        "author": "pietjepuk",
        "category": "Consensus Layer",
        "parent": "",
        "content": "If the deposit contract accepts it, but things don't match up, indeed funds are lost forever",
        "created_at": "2023-03-13T17:13:23.201000+00:00",
        "attachments": []
    },
    {
        "author": "pietjepuk",
        "category": "Consensus Layer",
        "parent": "",
        "content": "The signature is checked by the deposit contract iirc, and tx will revert if it doesn't match. In practice the easiest way to fuck up is saying (signing) you will deposit 32 ETH, and then actually only transfer 1 ETH. Or vice versa. Those transactions the deposit contract will accept, but the CL will not.",
        "created_at": "2023-03-13T17:14:28.376000+00:00",
        "attachments": []
    },
    {
        "author": "philogy",
        "category": "Consensus Layer",
        "parent": "",
        "content": "The deposit contract does not verify the signature as far as I can see: https://etherscan.io/address/0x00000000219ab540356cBB839Cbe05303d7705Fa#code it does however have a `deposit_data_root` argument it checks which I presume is the message hash to be signed",
        "created_at": "2023-03-13T17:16:30.902000+00:00",
        "attachments": []
    },
    {
        "author": "pietjepuk",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Ah yes, the data root indeed. So if there's a bit flip or something, or you fiddle with deposit-data.json (aside from the amount to deposit), the tx will revert",
        "created_at": "2023-03-13T17:18:03.775000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "It is possible to sign the deposit with the wrong domain (e.g. signing a goerli deposit with mainnet domain), in which case the deposit would indeed be lost because the execution layer would consider it valid as much as it can and so not revert, but the consensus layer would find it invalid and so ignore it.\n\n(Reason for this is that there is no simple way of checking a BLS signature on the execution layer.)",
        "created_at": "2023-03-13T20:27:36.847000+00:00",
        "attachments": []
    },
    {
        "author": "philogy",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I see, was actually going to ask if anyone here knows of a good BLS12-381 library in Solidity (preferably audited)",
        "created_at": "2023-03-13T20:29:48.639000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I don't know of any, sorry.",
        "created_at": "2023-03-13T20:30:17.577000+00:00",
        "attachments": []
    },
    {
        "author": "ralexstokes",
        "category": "Consensus Layer",
        "parent": "",
        "content": "https://github.com/ralexstokes/deposit-verifier/blob/master/deposit_verifier.sol\n\ndo NOT use but it is here for educational purposes\n\nlikely out of date and was never audited or throughly tested",
        "created_at": "2023-03-13T21:38:07.996000+00:00",
        "attachments": []
    },
    {
        "author": "ralexstokes",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i think \u003c@425279588009246720\u003e also has something to this effect",
        "created_at": "2023-03-13T21:38:20.937000+00:00",
        "attachments": []
    },
    {
        "author": "ralexstokes",
        "category": "Consensus Layer",
        "parent": "",
        "content": "the idea was to put this in front of a call to the deposit contract to avoid signature bugs burning deposits",
        "created_at": "2023-03-13T21:38:43.253000+00:00",
        "attachments": []
    },
    {
        "author": "ralexstokes",
        "category": "Consensus Layer",
        "parent": "",
        "content": "in practice, very few bad signatures on mainnet",
        "created_at": "2023-03-13T21:38:56.892000+00:00",
        "attachments": []
    },
    {
        "author": "ralexstokes",
        "category": "Consensus Layer",
        "parent": "",
        "content": "also this approach would need BLS12-381 precompiles (e.g. EIP-2537) which still haven't shipped yet",
        "created_at": "2023-03-13T21:39:42.613000+00:00",
        "attachments": []
    }
]