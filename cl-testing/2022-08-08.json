[
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@291925846556540928\u003e probably better the combo here than polluting your PR. I changed the code in prysm to use bits instead of balances. If there's a spectest vector with \u003chttps://github.com/ethereum/consensus-specs/pull/2967\u003e we will fail it and I don't think we should fix this. And even if we were to fix this, certainly don't want to touch that code a release from mainnet merge",
        "created_at": "2022-08-08T16:05:41.473000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "We got the fuzzing tests and when we realized it was due to a bogus beaconstate, we decided to maintain our correct behavior as per-spec. I feel such a vector will impose implementation rather than specification.",
        "created_at": "2022-08-08T16:07:20.111000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "The right thing to do here is to fuzz with valid input parameters",
        "created_at": "2022-08-08T16:07:40.285000+00:00",
        "attachments": []
    },
    {
        "author": "djrtwo",
        "category": "Testing",
        "parent": "",
        "content": "This case keeps being hit on fuzzing. Although it requires a degenerate state to trigger, it would be a bug amplification vector to cause a chain split once the attacker can create the degenerate state\n\nId like to get it cleaned up",
        "created_at": "2022-08-08T16:09:11.623000+00:00",
        "attachments": []
    },
    {
        "author": "djrtwo",
        "category": "Testing",
        "parent": "",
        "content": "We have no formal definition of \"correct state\"",
        "created_at": "2022-08-08T16:09:26.881000+00:00",
        "attachments": []
    },
    {
        "author": "djrtwo",
        "category": "Testing",
        "parent": "",
        "content": "So I think clients should implement the logic as specified instead of relying on some abstract definition of unreachable state",
        "created_at": "2022-08-08T16:10:00.305000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I would adopt a formal definition of correct state as one that can be obtained from Genesis by applying state transition. It's easy to define and then to impose behavior on a state you need to produce the state transitions that led to it",
        "created_at": "2022-08-08T16:11:02.087000+00:00",
        "attachments": []
    },
    {
        "author": "djrtwo",
        "category": "Testing",
        "parent": "",
        "content": "The bit logic on prysm currently assumes \"x is unreachable, thus I'd equivalent\". I don't think we should be in the habit of making \"x is unreachable\" claims because it makes  reasoning more difficult",
        "created_at": "2022-08-08T16:11:26.055000+00:00",
        "attachments": []
    },
    {
        "author": "djrtwo",
        "category": "Testing",
        "parent": "",
        "content": "Ah but we'd have to explore all state spaces to define this!",
        "created_at": "2022-08-08T16:11:41.657000+00:00",
        "attachments": []
    },
    {
        "author": "djrtwo",
        "category": "Testing",
        "parent": "",
        "content": "And would greatly restrict testing to those tests that we can finagle into certain shapes",
        "created_at": "2022-08-08T16:12:10.921000+00:00",
        "attachments": []
    },
    {
        "author": "djrtwo",
        "category": "Testing",
        "parent": "",
        "content": "Which is hard",
        "created_at": "2022-08-08T16:12:18.046000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I disagree, I don't think the spec should make assumptions as to how are the internal functions of clients laid out. For us splitting balances and bits is an important optimization in computing unrealized justification",
        "created_at": "2022-08-08T16:12:37.562000+00:00",
        "attachments": []
    },
    {
        "author": "djrtwo",
        "category": "Testing",
        "parent": "",
        "content": "I'm not making assumptions about how code is laid out. I'm making a claim that your code is not the same logic unless you assume bounds on the prestate",
        "created_at": "2022-08-08T16:30:01.523000+00:00",
        "attachments": []
    },
    {
        "author": "djrtwo",
        "category": "Testing",
        "parent": "",
        "content": "Which the spec does not",
        "created_at": "2022-08-08T16:30:29.123000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "I claim the spec does have this bound by defining a genesis state and a state transition. If I can formally prove that this situation cannot happen then would it be acceptable? I mean if we didn't have execution specs but a yellow paper then this would be a non issue. I believe these are one of those situations that Colvin was arguing were specification leaks into implementation",
        "created_at": "2022-08-08T16:47:11.890000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Testing",
        "parent": "",
        "content": "Kept thinking about this and although I maintain that this should not be tested at all and we should not change our behavior here, I would rather we **don't** agree in this hypothetical situation than risking agreeing on a bogus state",
        "created_at": "2022-08-08T23:14:00.767000+00:00",
        "attachments": []
    }
]