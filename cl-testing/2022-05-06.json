[
    {
        "author": "daniellehrner",
        "category": "Testing",
        "parent": "",
        "content": "The engine API hive test suite uses port 8551 for all calls to the engine API. But the execution engine spec only mentions port 8550. I think we should either change the hive tests to use 8550 or add 8551 to the spec, to be consistent.",
        "created_at": "2022-05-06T10:44:41.636000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "8551 - is JWT authenticated port\nhttps://github.com/ethereum/execution-apis/blob/main/src/engine/authentication.md#jwt-specifications\n\nThe old unauthenticated 8550 port has been left open to allow for smooth migration from one to another. I think it can be removed now, i'll submit a PR",
        "created_at": "2022-05-06T11:04:59.292000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Here we go https://github.com/ethereum/execution-apis/pull/219",
        "created_at": "2022-05-06T11:20:10.111000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "It's useful as a debugging fallback at times, but that probably doesn't need to be in the spec.",
        "created_at": "2022-05-06T11:31:13.551000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "Error messages when JWT authentication fails still aren't always the best.",
        "created_at": "2022-05-06T11:31:41.162000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "This debugging port (if exists) shouldn't be enabled by default as it would devalue having authentication on the default port",
        "created_at": "2022-05-06T11:36:40.635000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "Sure, agree",
        "created_at": "2022-05-06T11:36:57.439000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Testing",
        "parent": "",
        "content": "Are any other ELs seeing repeated stale JWT tokens from Nimbus? Besu logs are full of \n`Client sent stale token: {\"accessToken\":{\"iat\":1651747327},\"iat\":1651747327,\"rootClaim\":\"accessToken\"}`\nand the iat is same in all of 'em",
        "created_at": "2022-05-06T13:57:51.905000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "Nimbus doesn't ever cache this information to my knowledge/in the code I wrote to do this, so if so, that's definitely interesting",
        "created_at": "2022-05-06T13:59:22.044000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "it uses a callback which accesses the current clock. What one might be seeing is that Nimbus tends to use a ws:// connection though",
        "created_at": "2022-05-06T14:00:09.096000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "and ws:// only does this check once (per engine API spec)",
        "created_at": "2022-05-06T14:00:20.025000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Testing",
        "parent": "",
        "content": "ah, perhaps it is misconfigured and speaking ws to http",
        "created_at": "2022-05-06T14:01:21.412000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Testing",
        "parent": "",
        "content": "we don't negotiate up to ws from http",
        "created_at": "2022-05-06T14:01:55.333000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "And, I can say that if it's the current `kiln-dev-auth` (yes, `unstable` which we'll release next supports The Merge fine, but the testnets have been using modified branches at times), I just set it to disallow `http://` web3 URLs because they caused issues that weren't per se related to anything in the merge, or Bellatrix, but are Nimbus bugs we have to fix",
        "created_at": "2022-05-06T14:03:07.168000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "so it's definitely using `ws://` in that case",
        "created_at": "2022-05-06T14:03:17.142000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "that's an explanation then, yes",
        "created_at": "2022-05-06T14:03:41.559000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Testing",
        "parent": "",
        "content": "nope, it's configured right. ðŸ˜¦ unfortunately there is no snooper container on this host, but this feels like the auth header is being included in every ws message over the socket.",
        "created_at": "2022-05-06T14:09:01.054000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "it's in the header though, only, and the ws:// connection should be getting set up only once?",
        "created_at": "2022-05-06T14:09:49.580000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Testing",
        "parent": "",
        "content": "_should be_ yes",
        "created_at": "2022-05-06T14:10:41.962000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Testing",
        "parent": "",
        "content": "if no other EL is seeing this, i'll treat it like a besu issue... maybe broken logging?",
        "created_at": "2022-05-06T14:11:41.444000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Testing",
        "parent": "",
        "content": "because it was still working and progressing the chain",
        "created_at": "2022-05-06T14:12:05.563000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Testing",
        "parent": "",
        "content": "On the Nimbus side, I don't think that at least `DEBUG` (or even `TRACE`, but less sure) logging would catch quirks of websocket connection setup",
        "created_at": "2022-05-06T14:12:18.323000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Testing",
        "parent": "",
        "content": "k. thx for the help!",
        "created_at": "2022-05-06T14:12:51.080000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Testing",
        "parent": "",
        "content": "tracking here fyi https://github.com/hyperledger/besu/issues/3796",
        "created_at": "2022-05-06T14:33:01.359000+00:00",
        "attachments": null
    },
    {
        "author": "suburbandad_",
        "category": "Testing",
        "parent": "",
        "content": "besu has been using 8550 for json-rpc engine api and 8551 for web socket engine api.  If the authenticated json-rpc port is now 8551, what should the engine api websocket port move to?  or are we expecting the engine api to be served on the standard 8546 web socket port?",
        "created_at": "2022-05-06T17:54:18.016000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "We serve ws and http on the same port",
        "created_at": "2022-05-06T17:55:23.189000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "Testing",
        "parent": "",
        "content": "8550 unauth 8551 auth",
        "created_at": "2022-05-06T17:55:37.217000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "Having some execution clients running WS and HTTP on the same port, and some running on different ports, is a right pain from our side of things.",
        "created_at": "2022-05-06T18:00:36.356000+00:00",
        "attachments": null
    },
    {
        "author": "suburbandad_",
        "category": "Testing",
        "parent": "",
        "content": "I don't think it would be a big lift for besu to serve WS and json-rpc on the same port.  Esp considering we should only expect CL to be connecting.  Is nethermind also serving both on the same port?",
        "created_at": "2022-05-06T18:04:03.604000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "Not sure, but if geth and besu both do it one way I'd hope the others would follow along.",
        "created_at": "2022-05-06T18:06:06.617000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Testing",
        "parent": "",
        "content": "Originally there were separate ports for HTTP and WS but then the decision was made to use the same port for both comm protocols because having two is redundant and was borrowed from geth which old implementation couldn't support two protocols on the same port",
        "created_at": "2022-05-06T19:34:26.456000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Testing",
        "parent": "",
        "content": "So the final goal is one port for HTTP and WS JSON-RPC, and another for just the engine and eth namespaces, a which is authenticated? That would be a lot cleaner than what we have now, is it agreed between the client teams?",
        "created_at": "2022-05-06T20:18:59.018000+00:00",
        "attachments": null
    }
]