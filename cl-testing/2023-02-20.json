[
    {
        "author": "rjected",
        "category": "Testing",
        "parent": "",
        "content": "Hey! I have been setting up reth for continuous hive testing, and while testing found what I think is a known bug, leading to an incorrect `chain.rlp`. The core issue is that `rpctestgen` uses `gen.AddWithdrawal`, which can create a block that has multiple withdrawals with index 0. This behavior was noted in the withdrawals PR:\nhttps://github.com/ethereum/go-ethereum/pull/26484/files#r1073061482\n\nI have a repro in both `rpctestgen` and `go-ethereum`:\nrpctestgen: https://github.com/Rjected/rpctestgen/tree/withdrawal-repro (just adds logs showing that the withdrawal indexes are both zero)\nto run: build the `rpctestgen` binary and run it\n\ngo-ethereum: https://github.com/Rjected/go-ethereum/tree/dan/withdrawal-gen-repro\nto run: run the tests in `core`, the test `TestGenerateWithdrawalChain` should fail\n\nI discovered this when running `rpc-compat` tests on reth, which use a `chain.rlp` generated by `rpctestgen`, added here:\nhttps://github.com/ethereum/execution-apis/pull/334\n\nWho is the best person to talk to for investigating this, so the `chain.rlp` included in that test suite can contain proper indexes? Right now reth verifies that the indexes are monotonically increasing when we import the chain, so I assume `gen.AddWithdrawal` just needs to be fixed?",
        "created_at": "2023-02-20T22:18:25.717000+00:00",
        "attachments": null
    }
]