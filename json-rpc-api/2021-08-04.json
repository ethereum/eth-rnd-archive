[
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "*grumble* how did `v` end up in the JSON-RPC for 2930 and 1559 transactions?\nhttps://github.com/ethereum/eth1.0-specs/blob/master/json-rpc/spec.json#L1691-L1695",
        "created_at": "2021-08-04T07:59:45.725000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "We went to so much work to drop `v` in those two specifications.",
        "created_at": "2021-08-04T07:59:54.986000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "https://github.com/ethereum/eth1.0-specs/pull/293",
        "created_at": "2021-08-04T08:16:16.527000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I'm guessing though that all clients have already shipped with the incorrect JSON-RPC for 2930 and 1559 transactions?",
        "created_at": "2021-08-04T08:16:33.834000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Execution Layer",
        "parent": "",
        "content": "Yeah I definitely remember seeing v in ethereumjs so all js tooling probably has it",
        "created_at": "2021-08-04T09:27:45.896000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Execution Layer",
        "parent": "",
        "content": "What was the reason for dropping it",
        "created_at": "2021-08-04T09:27:52.183000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Execution Layer",
        "parent": "",
        "content": "https://github.com/ethereumjs/ethereumjs-monorepo/blob/master/packages/tx/src/eip1559Transaction.ts#L150",
        "created_at": "2021-08-04T09:31:09.370000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Execution Layer",
        "parent": "",
        "content": "\u003c@301186049323958275\u003e how important is this? I can patch it relatively quickly",
        "created_at": "2021-08-04T09:32:28.785000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "The real question to ask is \"what is the reason we have `v` in legacy transactions instead of `yParity`.",
        "created_at": "2021-08-04T09:33:19.889000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "And the answer to that is \"because of history and ancient Bitcoin things\".",
        "created_at": "2021-08-04T09:33:34.813000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "Switching from `v` to `yParity` was us finally (after many years) shedding that horrific baggage.",
        "created_at": "2021-08-04T09:33:51.975000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I encourage all libraries and clients to start returning `yParity` in all of their 2930 and 1559 transactions ASAP.  I *also* encourage returning it in legacy transactions, but that matters less.",
        "created_at": "2021-08-04T09:34:29.675000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "You can still fill in the `v` for backward compatibility if you want, but just know that it is a lie and may cause confusion in developers.",
        "created_at": "2021-08-04T09:34:50.142000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Execution Layer",
        "parent": "",
        "content": "\u003c@425269142615097345\u003e any chance you can cut a release and Iâ€™ll update our end?",
        "created_at": "2021-08-04T09:35:19.048000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "My guess is what will end up happening is all 3 transaction types will get both `v` and `yParity` in most places.  On the wire (RLP encoded transaction), 2930 and 1559 both only have `yParity` and legacy only has `v`.",
        "created_at": "2021-08-04T09:36:43.390000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "As annoying as that it, is is probably the most pragmatic solution for now and maybe we can look at figuring out a way to long-term deprecate the usage of `v` at all.",
        "created_at": "2021-08-04T09:37:18.395000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Execution Layer",
        "parent": "",
        "content": "Makes sense",
        "created_at": "2021-08-04T10:00:20.240000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Execution Layer",
        "parent": "",
        "content": "Iâ€™m dependent on ethereumjs",
        "created_at": "2021-08-04T10:00:27.825000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Execution Layer",
        "parent": "",
        "content": "So once thereâ€™s a release I can fix clean ours up",
        "created_at": "2021-08-04T10:00:44.781000+00:00",
        "attachments": null
    },
    {
        "author": "holgerd77",
        "category": "Execution Layer",
        "parent": "",
        "content": "\u003c@!322222239850168331\u003e \u003c@!301186049323958275\u003e We did this for implementation reasons, since otherwise this would have substantially complicated tx type implementation by cutting through the respective inheritance patterns. We will very likely not do a short-term release on this - this would reach too deep into our code base and eventually also lead to unwanted quick shots (and realistically this is generally too late in the process for client changes at this point). Very much open to keep this in discussion though.",
        "created_at": "2021-08-04T10:33:28.277000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "You should really structure your codebase to not assume that transactions are inheritable, they are by design not.",
        "created_at": "2021-08-04T10:34:17.904000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "In the future there will be transaction types with different signature schemes, entirely different field sets, different encoding schemes, etc.",
        "created_at": "2021-08-04T10:34:48.324000+00:00",
        "attachments": null
    },
    {
        "author": "holgerd77",
        "category": "Execution Layer",
        "parent": "",
        "content": "We spent a lot of thinking on this (actually: weeks) but in the end came up with this - for now - very much pragmatic approach since we didn't find a JS pattern which would serve the specification design well and would avoid too much code redundancy *and* allow our user base to somewhat stick to the existing API.",
        "created_at": "2021-08-04T10:36:20.376000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "That is, you will find it harder and harder going forward to maintain compatibility with the ecosystem if you assume that transactions are inheritable.",
        "created_at": "2021-08-04T10:36:23.928000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "So the problem is that what you are doing at the moment is **wrong**.",
        "created_at": "2021-08-04T10:36:52.295000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "`v` is not part of the 2930 or 1559 signature.",
        "created_at": "2021-08-04T10:37:00.391000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I feel like that trumps \"it is awkward in our codebase\"?  IMO, doing the right thing is more important than not duplicating code.",
        "created_at": "2021-08-04T10:37:17.734000+00:00",
        "attachments": null
    },
    {
        "author": "holgerd77",
        "category": "Execution Layer",
        "parent": "",
        "content": "Hmm, not completely convinced, this is *just* about a name and there is some strong legacy demand to be served here. There is some reason why this sneaked into stuff like the RPC specification for example.\n\n(not saying that this is beautiful or elegant or whatever).",
        "created_at": "2021-08-04T10:40:15.472000+00:00",
        "attachments": null
    },
    {
        "author": "holgerd77",
        "category": "Execution Layer",
        "parent": "",
        "content": "I've just looked into the go-ethereum code base https://github.com/ethereum/go-ethereum/blob/15fe3050a156af1e13ea2f7d7b48bfefe41d72ad/core/types/transaction.go - using `v` all over the place, same for Ethers https://github.com/ethers-io/ethers.js/blob/master/packages/transactions/src.ts/index.ts, and they don't even *use inheritance* (lol), but rather throw more or less everything in one file (if I read the code correctly).\n\nNot saying this is good or anything: but tx types came in extremely quickly and everyone had very little time to implement. Coming up with some good and robust design here takes time and this will realistically take another round of 2-3 tx types until we have the core libraries and the ecosystem where we would like to have it.",
        "created_at": "2021-08-04T10:52:50.101000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "It is unclear to me how we ended up in this situation.  The specifications for the wire protocol all very clearly used `yParity` and there was discussion about it and rationale.  I do recognize that somehow the ball got massively dropped along the way, but I don't think that is a good reason for leaving the ball on the floor.",
        "created_at": "2021-08-04T11:16:33.558000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "`yParity != v`, these are two different values that represent two different things.",
        "created_at": "2021-08-04T11:16:53.202000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "Naming them both `v` is just going to lead to confusing, frustration, and bugs for dapp developers.",
        "created_at": "2021-08-04T11:17:06.647000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I am pretty strongly against making choices in API design that makes it easier for the API authors and harder for API users, since the relationship there is usually few (API providers) to many (API consumers).",
        "created_at": "2021-08-04T11:17:33.557000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "What I have learned from this experience is that people seem to care fairly little about JSON-RPC API design.  It seems to be a second-class citizen that gets tacked on to applications after consensus changes are in.  Would be great to do better at this and have APIs that are more intentionally designed and thought about in advance, with a focus on the developers they are serving rather than the developer that is authoring them.",
        "created_at": "2021-08-04T11:26:16.178000+00:00",
        "attachments": null
    },
    {
        "author": "holgerd77",
        "category": "Execution Layer",
        "parent": "",
        "content": "Not sure if someone is already working on this or if it exists already, but I would be a fan of slowly bringing together some kind of hardfork playbook or checklist - structured by topic (consensus, RPC, ..., TBD) and time (after the first testnet fork, 1-2 days before mainnet fork, whatever) where we note down the things we stumble upon and which are candidates to be forgotten and then go down that list along HF milestones enfolding and make the appropriate checks.\n\nCould look something like:\n\n**RPC**\n\n**After first testnet fork**\n\n- [ ] Check on all RPC calls if a format update is needed\n- [Â ] Check on all RPC calls if internal behavior changes\n  - [Â ] On EIPs with opcode changes the following RPC calls are likely affected: Call1, Call2,...\n- [ ] Is there a need for call or attribute deprecation?\n\n**After second testnet fork**\n\n- [ ]Â Is the RPC specification on eth1.0-specs updated?\n- [ ] Is there a deprecation plan if deprecation is necessary?\n\n**Transaction Types**\n\n- [Â ] Should one of the existing tx types be deprecated along the HF\n- ...\n\n**Consensus**\n\n...\n\nSomething like this. Would this make sense?\n(made everything up here, just for some initial illustration)\n\n//cc \u003c@!552133098075193354\u003e \u003c@!420951281910284289\u003e",
        "created_at": "2021-08-04T17:12:55.419000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution Layer",
        "parent": "",
        "content": "+1 this is a great idea, it would awesome to have more explicit structure like so things don't get missed",
        "created_at": "2021-08-04T17:17:13.614000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Execution Layer",
        "parent": "",
        "content": "Yes, I think at a high level we need to do something like **Consensus** -\u003e **APIs**, and I expect we will with the merge",
        "created_at": "2021-08-04T17:54:50.254000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Execution Layer",
        "parent": "",
        "content": "IMO we can't do things like decide if a txn type is deprecated after a testnet fork, because we want to have all the consensus changes wrapped up before that.",
        "created_at": "2021-08-04T17:55:16.102000+00:00",
        "attachments": null
    },
    {
        "author": "holgerd77",
        "category": "Execution Layer",
        "parent": "",
        "content": "\u003c@!552133098075193354\u003e please ignore the content of what I've written, that is just about illustration how such a list could look like",
        "created_at": "2021-08-04T17:57:02.160000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Execution Layer",
        "parent": "",
        "content": "Maybe the \"steps\" should be the following:\n\n1. Devnets:\n- Make sure all the clients agree on the consensus changes, fix the spec/EIPs as we find bugs, etc. \n- Make sure we deprecate any relevant consensus things\n- Have a first pass at the APIs to see what we expect to change and implement a v1\n\n2. Testnets:\n- No more consensus changes, unless critical bug\n- Reach out to community/infra/tooling to ensure they support the changes, and iterate over JSON RPC\n- Once we feel JSON RPC is pretty stable, set a mainnet block\n\n3. Mainnet\n- No changes, just wait for it to happen. Maybe some tooling adds support still, but we don't expect to change any APIs for them.",
        "created_at": "2021-08-04T17:58:32.969000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Execution Layer",
        "parent": "",
        "content": "And I suspect for something like the merge, we can expect (1) and (2) to each last a few months.",
        "created_at": "2021-08-04T17:59:32.394000+00:00",
        "attachments": null
    },
    {
        "author": "fvictorio",
        "category": "Execution Layer",
        "parent": "",
        "content": "I think you are talking about different things. What you (Tim) are saying is a broader timeline, and I think Holger is talking about a lower-level checklist of things that need to be done. I'm assuming that checklist would be more of a living document (the timeline too, but I guess it won't change as often)",
        "created_at": "2021-08-04T18:17:15.689000+00:00",
        "attachments": null
    },
    {
        "author": "fvictorio",
        "category": "Execution Layer",
        "parent": "",
        "content": "Both things seem useful and complementary btw",
        "created_at": "2021-08-04T18:17:44.306000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Execution Layer",
        "parent": "",
        "content": "Yes, agreed! I think we need to have checklists for each of the milestones in my timeline ðŸ™‚",
        "created_at": "2021-08-04T18:38:42.609000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Execution Layer",
        "parent": "",
        "content": "But some things can't be changed when we go from one phase to another, so we want to be sure we've gotten them covered in the right phase.",
        "created_at": "2021-08-04T18:39:00.497000+00:00",
        "attachments": null
    }
]