[
    {
        "author": "jens4601",
        "category": "Execution Layer",
        "parent": "",
        "content": "Is the node (tested with Go-Ethereum) supposed to return the following from `eth_getProof` when an account does not exist (exclusion proof)?\n```bash\ncurl -X POST -H 'Content-Type: application/json' --data  '{\"jsonrpc\":\"2.0\",\"method\":\"eth_getProof\",\"params\":[\"0xf9d550b7ff989084171f6159cb46e66594bd948f\",[],\"finalized\"],\"id\":0}' http://127.0.0.1:30312/ | jq\n```\n\n```json\n{\n    \"address\": \"0xf9d550b7ff989084171f6159cb46e66594bd948f\",\n    \"accountProof\": [\n        // ...\n    ],\n    \"balance\": \"0x0\",\n    \"codeHash\": \"0x0000000000000000000000000000000000000000000000000000000000000000\",\n    \"nonce\": \"0x0\",\n    \"storageHash\": \"0x0000000000000000000000000000000000000000000000000000000000000000\",\n    \"storageProof\": []\n}\n```\n\nI'd have expected this to contain an `EMPTY_STORAGE_HASH = 0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421` and `EMPTY_CODE_HASH = 0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470`, as that is the \"correct\" value for non-existent accounts.\n\n[Helios](https://github.com/a16z/helios/blob/master/execution/src/proof.rs#L98-L112) seems to expect those constants when processing an exclusion proof, too, marking the proof as invalid when it does not match these constants.\n\nI don't have other execution nodes handy to test this against, but I wouldn't be surprised if other implementations return the \"correct\" hashes.\n\nThe closest thing to a spec that I could find was [EIP-1186](https://eips.ethereum.org/EIPS/eip-1186), but it doesn't state anything about those values for exclusion-proofs (both variants are valid according to this):\n\n\u003e In case an address or storage-value does not exist, the proof needs to provide enough data to verify this fact. [...] In case of leaf-type, it must be pointing to a different relative-path in order to proof that the requested path does not exist.",
        "created_at": "2024-06-05T13:55:49.356000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution Layer",
        "parent": "",
        "content": "\u003c@1068184824575184896\u003e we can change it if you want",
        "created_at": "2024-06-05T16:17:51.912000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution Layer",
        "parent": "",
        "content": "Please open an issue in go-ethereum",
        "created_at": "2024-06-05T16:18:13.317000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution Layer",
        "parent": "",
        "content": "The fact that it's an exclusion proof should be deduced from the `accountProof`",
        "created_at": "2024-06-05T16:19:10.822000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution Layer",
        "parent": "",
        "content": "So IMHO it doesn't matter what the other fields are, since the account just doesn't exist",
        "created_at": "2024-06-05T16:19:47.956000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution Layer",
        "parent": "",
        "content": "I guess Helios expects it this way because they want to figure out if it's an empty account first, and then match it against the `accountProof`",
        "created_at": "2024-06-05T16:22:19.240000+00:00",
        "attachments": null
    },
    {
        "author": "jens4601",
        "category": "Execution Layer",
        "parent": "",
        "content": "Same, I don't think it matters either (for exactly that reason), though I do find it interesting that the merkle proof verification code returns false (invalid proof) in that situation unless the caller inspects the proof (or the 0x00 values beforehand to pass in a \"good\" Empty account value.",
        "created_at": "2024-06-05T16:22:56.640000+00:00",
        "attachments": null
    },
    {
        "author": "jens4601",
        "category": "Execution Layer",
        "parent": "",
        "content": "\u003e we can change it if you want\n\nTo me it doesn't matter what those values are, I was mainly curious if that is a bug, intended or unspecified behavior (I guess it's unspecified behavior).",
        "created_at": "2024-06-05T16:29:08.091000+00:00",
        "attachments": null
    }
]