[
    {
        "author": "timbeiko",
        "category": "Execution Layer",
        "parent": "",
        "content": "We discussed the 1559-txn `gasPrice` field on the infrastructure call, and \u003c@!358385024573243393\u003e was basically the only one with a strong opinion. \n\nHe said: \n- Deprecating this after the next HF is too soon, given that there is still a ton (50%+, IIRC) of \u003c5.4 ethers usage and this will break them. \n- BUT, we could potentially hardcode this value to `0` at that point to not fully break things, but make it \"clearly wrong\".\n- The long term solution he prefers would be to version the JSON RPC API. Maybe this is something we could consider for the merge? (cc: \u003c@!291925846556540928\u003e \u003c@!425572898787426305\u003e)\n\nIn terms of next steps, I think we should:\n\n1. Figure out of `0` is an OK field to return after the December fork \n2. If this SG, merge https://github.com/ethereum/eth1.0-specs/pull/251, as there were no major concerns about the value changing before/after a txn is mined (and all the clients already do that, 1 week from the fork). \n\nFor (1), perhaps we just open another PR when 251 is merged and get feedback on that? WDYT \u003c@!543900561460822016\u003e \u003c@!301186049323958275\u003e ?",
        "created_at": "2021-07-30T15:54:26.455000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "Was there any talk about the current behavior (`gasPrice` return value changes based on time/reorgs) vs the behavior I recommended (`gasPrice` returns a consistent value for 1559 transactions)?",
        "created_at": "2021-07-30T16:08:19.261000+00:00",
        "attachments": []
    },
    {
        "author": "timbeiko",
        "category": "Execution Layer",
        "parent": "",
        "content": "I didn't bring up your suggestion explicitly, sorry! There was no pushback to it returning different behaviors based on time, though.",
        "created_at": "2021-07-30T16:10:28.434000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I thought \u003c@135612611923279872\u003e was against the variable-return behavior, I'm curious if they changed their mind and if so why, or if they weren't on the call?",
        "created_at": "2021-07-30T16:14:00.096000+00:00",
        "attachments": []
    },
    {
        "author": "danfinlay",
        "category": "Execution Layer",
        "parent": "",
        "content": "I‚Äôm pretty comfortable with Micah‚Äôs proposal, and also with Ricmoo‚Äôs ‚Äúreturn 0‚Äù one. Not sure what we‚Äôd version flag here, we still wouldn‚Äôt have a gasPrice field for some txs, even on an ‚Äúold version‚Äù api.",
        "created_at": "2021-07-30T16:16:14.305000+00:00",
        "attachments": []
    },
    {
        "author": "danfinlay",
        "category": "Execution Layer",
        "parent": "",
        "content": "I did originally suggest a variable one, and I do think it would be ‚Äúmost accurate‚Äù but also error prone, and so likely not worth the maintenance.",
        "created_at": "2021-07-30T16:16:53.172000+00:00",
        "attachments": []
    },
    {
        "author": "timbeiko",
        "category": "Execution Layer",
        "parent": "",
        "content": "To be clear, Ric's versioning proposal was for _future_ changes (e.g. start versioning JSON RPC API, drop `gasPrice` then, and always keep `gasPrice` in the pre-versioned one). We can additionally set `gasPrice` to 0 in the pre-versioned one to not break tooling.",
        "created_at": "2021-07-30T16:23:24.950000+00:00",
        "attachments": []
    },
    {
        "author": "danfinlay",
        "category": "Execution Layer",
        "parent": "",
        "content": "Ok, not worth getting too deep into now, but I hope a versioning scheme has more motivations than that üôÇ",
        "created_at": "2021-07-30T16:24:12.673000+00:00",
        "attachments": []
    },
    {
        "author": "timbeiko",
        "category": "Execution Layer",
        "parent": "",
        "content": "I think his main motivation is that versioning allows us to start doing backwards incompatible changes to JSON RPC in general",
        "created_at": "2021-07-30T16:24:49.745000+00:00",
        "attachments": []
    },
    {
        "author": "danfinlay",
        "category": "Execution Layer",
        "parent": "",
        "content": "Except for keeping the old version around üòâ",
        "created_at": "2021-07-30T16:25:11.103000+00:00",
        "attachments": []
    },
    {
        "author": "danfinlay",
        "category": "Execution Layer",
        "parent": "",
        "content": "Just trying on an api maintenance philosophy for size. Theory: versioning doesn‚Äôt actually avoid the problems of breaking changes, and you can achieve the same results with lower overhead by adding new methods.",
        "created_at": "2021-07-30T16:26:21.628000+00:00",
        "attachments": []
    },
    {
        "author": "timbeiko",
        "category": "Execution Layer",
        "parent": "",
        "content": "Yes, but we could eventually deprecate the unversioned spec altogether, which we can't really do now.",
        "created_at": "2021-07-30T16:27:20.244000+00:00",
        "attachments": []
    },
    {
        "author": "timbeiko",
        "category": "Execution Layer",
        "parent": "",
        "content": "Yeah, I guess the tradeoff here is you end up with really long API names, right? `eth_getTransactionByHashAndType`?",
        "created_at": "2021-07-30T16:27:54.383000+00:00",
        "attachments": []
    },
    {
        "author": "danfinlay",
        "category": "Execution Layer",
        "parent": "",
        "content": "Sure, you can deprecate any method you want! Doesn‚Äôt mean it won‚Äôt break things (in either case)",
        "created_at": "2021-07-30T16:27:56.660000+00:00",
        "attachments": []
    },
    {
        "author": "danfinlay",
        "category": "Execution Layer",
        "parent": "",
        "content": "Sure. But just shuffling around the extra data to a version param",
        "created_at": "2021-07-30T16:28:37.842000+00:00",
        "attachments": []
    },
    {
        "author": "timbeiko",
        "category": "Execution Layer",
        "parent": "",
        "content": "I don't have a strong opinion about how to resolve this, but AIUI, the core of the problem is (1) there will be breaking changes to protocol primitives (2) this will break things (3) we can \"patch\" things in the meantime (which, fwiwi, is kind of what we're doing with the merge by setting a bunch of block header fields to 0) but (4) it's not great to have a ton of patched/0 fields as part of the API long term.",
        "created_at": "2021-07-30T16:30:11.705000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I feel like we have one very immediate problem that we keep getting side tracked away from deciding a solution for because there are long term problems that are more interesting to talk about.  üôÇ",
        "created_at": "2021-07-30T17:45:26.710000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "The very immediate problem is that we launch in a week with a field that (IMO) is going to cause a lot of developer and user pain and suffering.  There is an open proposal to formalize this behavior across *all* clients.  I think we should change the behavior ASAP (as soon as we can reasonably get a patch up date out) for Geth and any other client who has already implemented the pain causing behavior, and for clients who have not yet deployed the Geth behavior they move forward with the alternative (less painful) behavior.",
        "created_at": "2021-07-30T17:47:13.014000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I recognize that this change won't make it in to most clients by London, but I feel like waiting for months before we replace this behavior is only going to make the situation worse for everyone.",
        "created_at": "2021-07-30T17:48:58.766000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "Note: this is all separate from the longer term issue of deprecation and versioning, which I definitely think we need to talk about more!",
        "created_at": "2021-07-30T17:49:17.386000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I just want to come to a resolution on this immediate problem ASAP.",
        "created_at": "2021-07-30T17:49:26.285000+00:00",
        "attachments": []
    },
    {
        "author": "timbeiko",
        "category": "Execution Layer",
        "parent": "",
        "content": "So, it kind of seems like a lot of people are OK with the behaviour your find problematic, which is why I suspect it is not ‚Äúcoming to resolution‚Äù quickly. I may be wrong here, but my read is that it seems mostly fine to leave as is, make the field ‚Äúuseless‚Äù rather quickly (say, after December) to not break things, and eventually have a clean way to remove it altogether",
        "created_at": "2021-07-30T17:59:32.899000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "The current behavior *does* break things.",
        "created_at": "2021-07-30T18:03:49.584000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "Doing something is the \"not break things\" path.  Doing nothing is the \"break things\" path.  üôÇ",
        "created_at": "2021-07-30T18:04:00.609000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I think you and I are both reading our own biases into what people say.",
        "created_at": "2021-07-30T18:04:18.443000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I think if I try to step away from that, what I'm hearing is a lot of ambivalence, with *weak* support of my proposal.",
        "created_at": "2021-07-30T18:04:37.791000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I think the only person I have heard oppose it so far was Martin, though I was never totally clear on \u003c@358385024573243393\u003e's position (conversation kept getting distracted).",
        "created_at": "2021-07-30T18:05:05.399000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "Well, let me try to be a bit more fair.  Only Martin has spoken against it (in ACD), only Dan has spoken in favor (in discord the other day).",
        "created_at": "2021-07-30T18:05:47.319000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "Everyone else seems to rapidly get distracted by the long term problem and not answer the short term problem.  üôÇ",
        "created_at": "2021-07-30T18:06:03.938000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I am very sad I missed the call, I would have liked to get a feel for the proposed change from the people on the call. üò¢",
        "created_at": "2021-07-30T18:06:20.192000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "So, from ethers point of view, either solution is fine, as long as something that can be interpreted as a number is present.",
        "created_at": "2021-07-30T19:13:11.856000+00:00",
        "attachments": []
    },
    {
        "author": "trent_vanepps",
        "category": "Execution Layer",
        "parent": "",
        "content": "we're planning another 1559 Coordination Call for two weeks from now to assess mainnet behavior, discuss API strategies, and generally see where everything settled. bookmark Friday 14:00 UTC Aug 13.",
        "created_at": "2021-07-30T19:13:17.513000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "RicMoo‚Äôs opinion is somewhat ambivalent as to which to choose. Both options are wrong in their own unique way, and I can imagine both being useful and both causing issues.",
        "created_at": "2021-07-30T19:14:01.670000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "My versioning was specifically to mean that a JSON-RPC response never changes it‚Äôs types or removes a field without a major version bump, but adding new things in fine.",
        "created_at": "2021-07-30T19:15:05.905000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "It is nice having a field stay constant before/after a block is mined, but anyone computing the tx hash from that data is is for a bad surprize anyways, which seems to be the main advantage to it remaining static. Changing before/after mining feels akin to the block hash changing from null to something, but means caching breaks for people.",
        "created_at": "2021-07-30T19:17:30.926000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "If there was a vote, my official response would be to abstain. üôÇ",
        "created_at": "2021-07-30T19:17:58.053000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "\u003c@543900561460822016\u003e \u003c@552133098075193354\u003e just got a link from Trent re: the changes to the JSON-RPC and I had most of the changes but noticed one I don‚Äôt account for currently. That is the eth_estimateGas. It now requires fee data. Is that only for eip-1559 networks? If you are running a node without London, is it ok to still leave gasPrice as 0?",
        "created_at": "2021-07-30T20:00:32.399000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "The concern is backwards compatibility. Yesterday an issue came up with Kovan, which doesn‚Äôt look like adopted Berlin, so the `type` field in call and estimateGas were failing.",
        "created_at": "2021-07-30T20:01:27.187000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "So, ideally, I‚Äôd like to only include max*FeePerGas in eth_estimateGas if the network supports London (this is checked by looking for baseFee in the latest block).",
        "created_at": "2021-07-30T20:02:27.476000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "So that legacy networks continue doing whatever they are doing today.",
        "created_at": "2021-07-30T20:02:43.504000+00:00",
        "attachments": []
    },
    {
        "author": "timbeiko",
        "category": "Execution Layer",
        "parent": "",
        "content": "Better question for `@lightclient` than me. I assume `eth_estimateGas` should work as it previously did on non-1559 networks, but I'm not actually sure.",
        "created_at": "2021-07-30T20:06:37.089000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "IIRC (definitely double check this with someone who actually looks at code), estimate gas will work if you leave out (not set to 0) all of the gas price fields.",
        "created_at": "2021-07-30T20:38:26.713000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "If you include one of the 1559 gas pricing related fields then you **MUST** include both.",
        "created_at": "2021-07-30T20:38:40.343000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "Again, my confidence in the accuracy of these statements is low, so seek personal validation or second opinion.",
        "created_at": "2021-07-30T20:39:01.711000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "Yeah, I currently leave it as zero, but according to this document, that isn‚Äôt the case anymore post-eip-1559; https://hackmd.io/@timbeiko/1559-json-rpc",
        "created_at": "2021-07-30T21:14:15.187000+00:00",
        "attachments": []
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution Layer",
        "parent": "",
        "content": "\u003e It is nice having a field stay constant before/after a block is mined, but anyone computing the tx hash from that data is is for a bad surprize anyways \n\nWill `gasPrice` change for legacy transactions though?  If `type` is `0x2` then you _have_ to use the EIP-1559 process for computing the tx hash anyways, which ignores the `gasPrice` field.  \n\nIf `gasPrice` is changing to \"effective gas price\" for mined _legacy_ tx then I 100% agree that that's a _really_ bad thing; but it's my interpretation that `gasPrice` is only changing post-mined for 1559 txs.",
        "created_at": "2021-07-30T21:22:40.845000+00:00",
        "attachments": []
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution Layer",
        "parent": "",
        "content": "Then again, for legacy txs the passed in `gasPrice` should be the \"effective gas price\" after it's mined, so I guess it wouldn't change.",
        "created_at": "2021-07-30T21:24:07.762000+00:00",
        "attachments": []
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution Layer",
        "parent": "",
        "content": "I guess what I'm getting at is the preimage for the tx hash is fully dependent on the `type` field of the tx, like in https://github.com/INFURA/go-ethlibs/blob/master/eth/transaction.go#L134",
        "created_at": "2021-07-30T21:28:22.184000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "That‚Äôs my question. If geth is running on a network without London enabled, will the fee data requirement be enforced. If so, I should make estimateGas populate gasPrice with 0 on those networks.",
        "created_at": "2021-07-30T22:17:08.165000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "Regardless, if on eip-1559, I will populate those values if missing. But more curious about legacy chains running modern Geth. üôÇ",
        "created_at": "2021-07-30T22:17:47.237000+00:00",
        "attachments": []
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution Layer",
        "parent": "",
        "content": "I _think_ that `eth_estimateGas` behaves the same as `eth_call` described here: https://github.com/ethereum/go-ethereum/pull/23027 cases 1, 2 and 3 (\"Prior to 1559\") _should_ apply to chains that will never activate 1559 as well.",
        "created_at": "2021-07-30T22:26:10.255000+00:00",
        "attachments": []
    }
]