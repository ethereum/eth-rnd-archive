[
    {
        "author": "robocopsgonemad",
        "category": "Execution Layer",
        "parent": "",
        "content": "so here's a weird rabbit hole I fell into... besu is failing a test by returning SYNCING too early- hive is expecting it to fail fast on a missing parentBeaconRoot. in the process of refactoring to accomodate it, I realized that there was another validity check in the way:",
        "created_at": "2023-10-12T21:24:45.964000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Execution Layer",
        "parent": "",
        "content": "```Client software MUST ensure that payloadAttributes.timestamp is greater than timestamp of a block referenced by forkchoiceState.headBlockHash. If this condition isn't held client software MUST respond with -38003: Invalid payload attributes and MUST NOT begin a payload build process. In such an event, the forkchoiceState update MUST NOT be rolled back.```",
        "created_at": "2023-10-12T21:24:49.971000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Execution Layer",
        "parent": "",
        "content": "that's from fcuV1 specs",
        "created_at": "2023-10-12T21:25:02.223000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Execution Layer",
        "parent": "",
        "content": "so in our attempt to check that, if we don't have the headBlockHash and have to go get it, we return SYNCING.",
        "created_at": "2023-10-12T21:25:42.167000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Execution Layer",
        "parent": "",
        "content": "i'm not sure how we could return the 38003, since we don't have the comparison block, so we must be inviolation of this rule",
        "created_at": "2023-10-12T21:27:31.407000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Execution Layer",
        "parent": "",
        "content": "but if I fix this, will I be confusing the CL by telling them the payload is invalid, when in fact i'm just out of sync?",
        "created_at": "2023-10-12T21:29:15.526000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Execution Layer",
        "parent": "",
        "content": "Returning `-38003: Invalid payload attributes` does not mean saying the execution payload is invalid (ie it's not marking a block as invalid) - it means the request was invalid.  CLs shouldn't apply that to their fork choice state and be confused by it - it's roughly equivalent to the EL being unavailabe at the time.\nYou get into trouble with CLs when you return a `status: INVALID` response.",
        "created_at": "2023-10-12T23:09:16.539000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Execution Layer",
        "parent": "",
        "content": "That said, it does seem rather impossible to check the timestamp of a block you don't have and the call must not block while the EL fetches that block from peers.",
        "created_at": "2023-10-12T23:10:20.524000+00:00",
        "attachments": null
    }
]