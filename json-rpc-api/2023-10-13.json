[
    {
        "author": "potuz",
        "category": "Execution Layer",
        "parent": "",
        "content": "I think in this situation the CL has to have a bug: you shouldn't trigger a payload build if your EL is syncing. If the EL does not have the head state then there's no possible way that the CL could have had a VALID reply for its head, and therefore should not be building on that",
        "created_at": "2023-10-13T00:39:26.805000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Execution Layer",
        "parent": "",
        "content": "This could happen if the CL imported the block successfully, then the EL state was wiped and then the CL started building a new payload on that head.",
        "created_at": "2023-10-13T00:44:01.791000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution Layer",
        "parent": "",
        "content": "But I find it strange that you get to that point before stopping on 4)\n\u003e Before updating the forkchoice state, client software MUST ensure the validity of the payload referenced by forkchoiceState.headBlockHash",
        "created_at": "2023-10-13T00:44:13.888000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Execution Layer",
        "parent": "",
        "content": "So weird, but not invalid.",
        "created_at": "2023-10-13T00:44:14.460000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Execution Layer",
        "parent": "",
        "content": "The spec doesn't say it explicitly but `payloadAttributes` is supposed to be processed after the forkchoice state has been applied. So if `SYNCING` is returned as a result of applying the forkchoice state then no `payloadAttributes` validation should happen",
        "created_at": "2023-10-13T04:39:51.043000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Execution Layer",
        "parent": "",
        "content": "Hmm, there is another issue related to the order of checks in fcUV3, https://github.com/ethereum/execution-apis/pull/476. I'll try to clarify the order of forkchoice state and payload attributes processing in the spec",
        "created_at": "2023-10-13T04:43:23.779000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Execution Layer",
        "parent": "",
        "content": "So I think that's the failure in 4) that I mentioned above right?",
        "created_at": "2023-10-13T11:04:47.560000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Execution Layer",
        "parent": "",
        "content": "Right, but the spec does only say that in case when the payload is `INVALID` the software must not proceed with the forkchoice state update and the build process. It does not say that if the payload can't be validated, i.e. the `SYNCING` case, the software must act the same, such behaviour is implied but it might be better to explicitly state that to avoid confusion",
        "created_at": "2023-10-13T14:24:39.038000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad",
        "category": "Execution Layer",
        "parent": "",
        "content": "yes! and this test will need updated in hive: `Invalid PayloadAttributes: Missing BeaconRoot (Syncing) (Cancun)`",
        "created_at": "2023-10-13T20:25:12.337000+00:00",
        "attachments": null
    }
]