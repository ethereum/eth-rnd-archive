[
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "I was originally told not to rely on typed transaction type 0 to refer to legacy transactions, but it appears the JSON-RPC is using type 0 for I typed transactions. Is that bow a safe assumption? The 0 is reserved and used for legacy transactions?",
        "created_at": "2021-06-22T04:45:26.805000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "What endpoint is setting type to 0 for legacy transactions?",
        "created_at": "2021-06-22T04:51:57.069000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "0 is *not* reserved for legacy transactions in any specification.",
        "created_at": "2021-06-22T04:52:06.259000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "GetTransactionReceipt",
        "created_at": "2021-06-22T04:52:13.045000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "0x0",
        "created_at": "2021-06-22T04:52:20.465000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "You are seeing this in production, or in the JSON-RPC spec?",
        "created_at": "2021-06-22T04:52:26.513000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "Production. INFURA, Etherscan.",
        "created_at": "2021-06-22T04:52:41.581000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "üòñ",
        "created_at": "2021-06-22T04:52:52.597000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "This is why we can't have nice things.",
        "created_at": "2021-06-22T04:52:56.733000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "I‚Äôve only tested homestead. But have no reason to suspect any different on other networks.",
        "created_at": "2021-06-22T04:53:28.851000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "I could try the others.",
        "created_at": "2021-06-22T04:53:41.865000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "1. we'll ask them to stop\n2. they'll tell us \"it makes things easier for our users\"\n3. we'll tell them but your users are going to break in a horrible way when we add a type 0 transaction type\n4. they'll tell us that they'll deal with that when the time comes\n5. we'll proceed to waste hundreds of engineering hours arguing over whether it is acceptable to break those users sometime in the future when we go to add a type 0 transaction",
        "created_at": "2021-06-22T04:54:18.879000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "It‚Äôs Geth and Parity (or whatever it‚Äôs called now).",
        "created_at": "2021-06-22T04:54:45.999000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I suspect the conversation will go as above no matter who the culprit is.  üò¢",
        "created_at": "2021-06-22T04:55:09.753000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "Though, depending on the culprit, avoiding future pain may sit better with some than others.",
        "created_at": "2021-06-22T04:55:23.961000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "\u003c@543900561460822016\u003e Do you happen to know which client is putting `0` for the transaction type of legacy transactions?",
        "created_at": "2021-06-22T04:55:48.686000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "I mean, we could also just reserve type 0 (along with 0x19). That still gives us like 126 types? And eth2 will use a different format, so that should be enough types for the next bit, no? üôÇ",
        "created_at": "2021-06-22T04:55:56.517000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "Well. To be honest, type 0 would make my life easier. Although, my life would be equally useful is -1 was used.",
        "created_at": "2021-06-22T04:56:41.197000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "But a number would be nice.",
        "created_at": "2021-06-22T04:56:48.724000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "You mean you want a discriminated union?\n```ts\ntype Transaction = { type: 0, ... } | { type: 1, ... }\n```",
        "created_at": "2021-06-22T04:57:57.914000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I can appreciate how that might be marginally easier than:\n```ts\ntype Transaction = { type: never, ... } | { type: 1, ... }\n```",
        "created_at": "2021-06-22T04:58:31.033000+00:00",
        "attachments": []
    },
    {
        "author": "lightclient",
        "category": "Execution Layer",
        "parent": "",
        "content": "geth uses 0 for legacy txs internally https://github.com/ethereum/go-ethereum/blob/5228b2a353726c7b163a534f5145e2f554c497dc/core/types/transaction.go#L45",
        "created_at": "2021-06-22T04:58:57.686000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "Oh, more that the return type is `number` instead of `number | null` everywhere, which also means all consumers have to use `(tx.type == null) thingA: tx.type`.",
        "created_at": "2021-06-22T04:59:19.456000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "```ts\nswitch (transaction.type) { ... }\n```\nvs\n```ts\nif ('type' in transaction) { ... } else switch (transaction.type) { ... }\n```",
        "created_at": "2021-06-22T04:59:27.823000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I think I can be convinced to \"reserve\" a type for legacy transactions just from a usability standpoint.",
        "created_at": "2021-06-22T05:00:32.997000+00:00",
        "attachments": []
    },
    {
        "author": "lightclient",
        "category": "Execution Layer",
        "parent": "",
        "content": "i guess the rpc is not omitting it for legacy txs?",
        "created_at": "2021-06-22T05:00:37.028000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "a: Record\u003cnumber, Thing\u003e = ‚Ä¶; return a[tx.type] is nice and easy.",
        "created_at": "2021-06-22T05:00:38.956000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "Null checks are just unpleasant for everything. Especially if we can easily have a canonical value in the same type. 0xff is fine too. But something. üôÇ",
        "created_at": "2021-06-22T05:01:33.851000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "I can just make type 0 become type -1. But I‚Äôd rather not deviate too far if it is just going to be accepted as the canonical value, then some things will use 0 and ethers -1.",
        "created_at": "2021-06-22T05:03:19.760000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "Don't do negatives.",
        "created_at": "2021-06-22T05:04:53.461000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "The Ethereum protocol goes to great lengths to avoid negative numbers, they cause a ton of interoperability problems.",
        "created_at": "2021-06-22T05:05:01.788000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "Well they get converted before they hit the network.",
        "created_at": "2021-06-22T05:05:37.395000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "I already use -1 in serializeTransaction to be explicit to use legacy. Because there needs to be *a* number.",
        "created_at": "2021-06-22T05:06:17.278000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "tx = { type: null, value: 100 }\n\nshould not be treated critically different, and generate completely different output from:\n\ntx = { type: undefined, value: 100 }",
        "created_at": "2021-06-22T05:08:02.647000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "Keep in mind ethers is largely porcelain, so negative numbers are isolated. But I would prefer 0. üôÇ",
        "created_at": "2021-06-22T05:09:12.974000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "IMO you shouldn't be using `number` in ethers (as I believe I have expressed before).  üòÅ",
        "created_at": "2021-06-22T05:09:20.214000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "Yes, but that change cannot be made in v5.",
        "created_at": "2021-06-22T05:09:36.065000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "And a major version change isn‚Äôt ready yet.",
        "created_at": "2021-06-22T05:09:55.227000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "If you are passionate about this and have the time, I think the best way to get `0` as reserved is to create the doc I mentioned in \u003c#779922457631916064\u003e.  It is on my todo list, but far enough down that it will probably never actually get done.",
        "created_at": "2021-06-22T05:10:15.800000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "(I‚Äôm working on it though, and am quite excited for it. :))",
        "created_at": "2021-06-22T05:10:24.278000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "If we had that list, we would have a place to reserve values, which would let us reserve 0.",
        "created_at": "2021-06-22T05:10:27.485000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "Yeah. My todo list still has 3 EIPs to update. :p",
        "created_at": "2021-06-22T05:10:47.452000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "Where does this list need to live?",
        "created_at": "2021-06-22T05:11:03.442000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "eth1.0-specs seems ideal.",
        "created_at": "2021-06-22T05:11:16.550000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "Ok. I just check out the repo and make a PR?",
        "created_at": "2021-06-22T05:11:43.763000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "I‚Äôm pretty passionate that 0x19 gets reserved. üôÇ",
        "created_at": "2021-06-22T05:12:02.986000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "Make a new folder in the root?",
        "created_at": "2021-06-22T05:13:06.390000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "I can get that together.",
        "created_at": "2021-06-22T05:13:25.186000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I'm not sure, that is part of the challenge.  üò¨",
        "created_at": "2021-06-22T05:22:14.353000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "\u003c@552133098075193354\u003e would be a good person to talk to about getting a place for a living document that tracks reserved secp256k1 signature prefixes.",
        "created_at": "2021-06-22T05:22:41.526000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "I'm pretty confident that eth1.0-specs is the right place, but I'm not sure *within* that where to put it.",
        "created_at": "2021-06-22T05:23:26.016000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "Maybe just create a folder called \"lists\" and put it in there?  üòÅ",
        "created_at": "2021-06-22T05:23:47.355000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "Ok. üôÇ",
        "created_at": "2021-06-22T05:26:01.614000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "I‚Äôll ping him in a PR. üôÇ",
        "created_at": "2021-06-22T05:26:10.337000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "0, 1, leading legacy transaction bytes (I forget what they are, but it is a pretty constrained range), 19, and 3 should all be reserved I think.",
        "created_at": "2021-06-22T05:32:36.945000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "And 2.",
        "created_at": "2021-06-22T05:33:01.222000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "`[0,1,2,3,19,...valid_first_bytes_of_legacy_transaction]`",
        "created_at": "2021-06-22T05:33:30.294000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "\u003c@358385024573243393\u003e ‚òùÔ∏è",
        "created_at": "2021-06-22T05:33:40.909000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "What is 3?",
        "created_at": "2021-06-22T05:34:22.015000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "0 = legacy transactions\n1 = 2930\n2 = 1559\n3 = 3074\n19 = signed message",
        "created_at": "2021-06-22T05:34:26.116000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "I‚Äôve added 0, 1, 2 and 0x19 so far.",
        "created_at": "2021-06-22T05:34:42.979000+00:00",
        "attachments": []
    },
    {
        "author": "ricmoo",
        "category": "Execution Layer",
        "parent": "",
        "content": "Ok. I‚Äôll look up and add 3 now. üôÇ",
        "created_at": "2021-06-22T05:34:51.506000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution Layer",
        "parent": "",
        "content": "https://eips.ethereum.org/EIPS/eip-3074",
        "created_at": "2021-06-22T05:34:59.581000+00:00",
        "attachments": []
    }
]