[
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@415548822983278593\u003e The ABI encoder encodes addresses with 32 bytes of space (it does this for everyhting).",
        "created_at": "2021-07-14T03:16:10.647000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This means `transfer(address,uint256)` actually has two 32 byte parameters.",
        "created_at": "2021-07-14T03:16:38.065000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "However, depending on compiler optimizations (IIUC), it may or may not mask the first parameter down to 20 bytes.",
        "created_at": "2021-07-14T03:16:52.053000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(listening to the call now, heard you mention that you believed the ABI only took in a 20 byte value which isn't accurate)",
        "created_at": "2021-07-14T03:17:21.471000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Alice: \"I want to send you TOK, what is your address?\"\nBob: \"0x\u003c64 characters\u003e\"\nAlice: \"That is too long, I'm getting an error.\"\nBob: \"Oh, um... use this one then: 0x\u003c40 characters\u003e (compressed address).\"\nAlice: \"OK, sent you some tokens.\"\n\u003csome time passes\u003e\nAlice: \"It is Bob's birthday, I want to send him some tokens.  I have his address in my contacts, I'll send tokens to that address.\"\n\u003cAlice sends new token, deployed in long address space, to Bob's compressed address\u003e",
        "created_at": "2021-07-14T03:34:00.611000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Note: Bob has a contract wallet, not an EOA.",
        "created_at": "2021-07-14T03:34:10.881000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "How does Bob get his new tokens out?",
        "created_at": "2021-07-14T03:34:21.762000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In the call it sounds like you all were thinking that tooling can just avoid using compressed address, but I don't think tooling can really help with this situation.  If you *ever* need to give your compressed address out to someone for any reason, then it is now in the wild and might be used in the future.",
        "created_at": "2021-07-14T03:35:13.530000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Man, my connection was like 5 minutes lagged in that call.  ðŸ˜–",
        "created_at": "2021-07-14T03:39:36.735000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Scenarios we need to make sure we solve:\n```\nETH from EOA20 to EOA20\nETH from EOA20 to EOA32\nETH from EOA32 to EOA20\nETH from EOA32 to EOA32\nToken20 from EOA20 to EOA20\nToken20 from EOA20 to EOA32\nToken20 from EOA32 to EOA20\nToken20 from EOA32 to EOA32\nToken32 from EOA20 to EOA20\nToken32 from EOA20 to EOA32\nToken32 from EOA32 to EOA20\nToken32 from EOA32 to EOA32\nETH from EOA20 to Contract20\nETH from EOA20 to Contract32\nETH from EOA32 to Contract20\nETH from EOA32 to Contract32\nToken20 from EOA20 to Contract20\nToken20 from EOA20 to Contract32\nToken20 from EOA32 to Contract20\nToken20 from EOA32 to Contract32\nToken32 from EOA20 to Contract20\nToken32 from EOA20 to Contract32\nToken32 from EOA32 to Contract20\nToken32 from EOA32 to Contract32\nETH from Contract20 to EOA20\nETH from Contract20 to EOA32\nETH from Contract32 to EOA20\nETH from Contract32 to EOA32\nToken20 from Contract20 to EOA20\nToken20 from Contract20 to EOA32\nToken20 from Contract32 to EOA20\nToken20 from Contract32 to EOA32\nToken32 from Contract20 to EOA20\nToken32 from Contract20 to EOA32\nToken32 from Contract32 to EOA20\nToken32 from Contract32 to EOA32\nETH from Contract20 to Contract20\nETH from Contract20 to Contract32\nETH from Contract32 to Contract20\nETH from Contract32 to Contract32\nToken20 from Contract20 to Contract20\nToken20 from Contract20 to Contract32\nToken20 from Contract32 to Contract20\nToken20 from Contract32 to Contract32\nToken32 from Contract20 to Contract20\nToken32 from Contract20 to Contract32\nToken32 from Contract32 to Contract20\nToken32 from Contract32 to Contract32\n```",
        "created_at": "2021-07-14T03:50:14.940000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think part of the reason I keep getting stuck/confused is because there are so many permutations and my mind gets stuck solving one and forgets about the others, then by the time I am thinking about the others I have forgotten again about the first one.",
        "created_at": "2021-07-14T03:51:08.369000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Maybe as a first step we can narrow this list down by things that will \"just work no matter what we do\" like `Token20 from *20 to *20`.",
        "created_at": "2021-07-14T03:52:07.141000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Basically try to narrow the list down to only things that don't have immediately obvious solutions that we get for free.  I think ETH and Token32 from *32 to *32 also works, but only if we do contract versioning and disallow old Solidity code deployed to new addresses?  This would be worthy of a note indicating the solution.",
        "created_at": "2021-07-14T03:53:57.743000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Note: Token32 is a placeholder effectively for \"some contract\", but I think it is easier to think about tokens because they are so widely used and understood, and it represents probably one of the hardest cases which is one function call interacting with both 20 byte and 32 byte addresses in one call.",
        "created_at": "2021-07-14T03:54:55.513000+00:00",
        "attachments": []
    },
    {
        "author": "peter.davies",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!301186049323958275\u003e Continuing our conversation from \u003c#700028534114222171\u003e: Having the persona thing to make current ECRECOVER using contracts keep working seems sensible. In the long term having the meaning of ECRECOVER be partly at the whim of `msg.sender` (who has control over whether or not the persona data is included) seems like a recipe for trouble.",
        "created_at": "2021-07-14T11:38:55.202000+00:00",
        "attachments": []
    },
    {
        "author": "peter.davies",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think the solution is we should add a `ECDSAPUBKEY` precompile. Contracts can then implement any version of `ECRECOVER` they want using that and the `SHA3` opcode.",
        "created_at": "2021-07-14T11:54:08.556000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I suggested that on one of the meetings, but that is just one version of \"ecrecover2\".",
        "created_at": "2021-07-14T11:54:36.970000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think what \u003c@!301186049323958275\u003e is concerned about is backwards compatibility with ecrecover in existing contracts (since we can't change it), and for that we discussed some cases which are recoverable, some which could be using some new features (the eth recovery option), but we are unsure whether all cases are addressed.",
        "created_at": "2021-07-14T11:56:21.141000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think we have to do the persona thing for backward compatibility.  Since we are doing that anyway, it then brings up the question of whether we *also* need a new ecrecover.",
        "created_at": "2021-07-14T12:11:48.551000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think a new ecrecover may be valuable as it would reduce cost I think, but I don't know that it is critical that it launches along with ASE.",
        "created_at": "2021-07-14T12:12:11.713000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(I'll be a minute late, sorry)",
        "created_at": "2021-07-14T12:58:21.682000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@425279588009246720\u003e Can you add notes to 3c what the cons are after this discussion?\nAssuming any more were found besides the one that is already tehre.\nIn fact, I feel like with the realization that storage reads/writes are the most expensive thing, the con in the list may actually not even be a con anymore.",
        "created_at": "2021-07-14T13:58:58.219000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My assertions currently:\n* All solutions for distinguishing between compressed and legacy addresses either breaks counterfactual security (lose too many bits of entropy) or it will be too easy for honest users to accidentally collide (and end up with an unusable address.\n* If we cannot distinguish between compressed and legacy addresses, then we run into problems with interoperability between legacy and long addresses.",
        "created_at": "2021-07-14T14:20:44.527000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'll update the doc in ~3hrs, as being blocked into calls right now.",
        "created_at": "2021-07-14T14:21:07.095000+00:00",
        "attachments": []
    },
    {
        "author": "poojaranjan",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ASE meeting 5 recording\nhttps://youtu.be/TWsI_XxWRek",
        "created_at": "2021-07-14T16:26:46.110000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!301186049323958275\u003e my alternate proposal to ASE, which I mentioned on-and-off, is to offer a migration path: a) a contract storage can be copied to a new address with a new code; b) existing code can be replaced.\n\nIn both cases the code would be replaced with something which understands long addresses, and is initiated by the contract owner, not by the protocol.\n\nUnfortunately probably this can't be done without protocol support, even though many major projects have a proxy, the proxy itself can't be updated.",
        "created_at": "2021-07-14T16:54:55.778000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This wouldn't work for any immutable projects would it (projects with no owner/admin)?",
        "created_at": "2021-07-14T16:57:28.336000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "e.g., Uniswap, MakerDAO, Augur, etc.",
        "created_at": "2021-07-14T16:57:37.592000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The idea goes back to this (but the specific one there is not feasible): https://discord.com/channels/595666850260713488/739145593762611250/817196650237788170",
        "created_at": "2021-07-14T16:57:54.248000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Well those are DAOs so the holders can decide via social consensus, right?",
        "created_at": "2021-07-14T16:58:13.821000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But they can certainly just deploy a new contract and manually migrate. The main problem is that nobody is really incentivized to go through this hassle, unless the new space provides substantial benefits, or the legacy space is too much penalized.",
        "created_at": "2021-07-14T16:59:07.918000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "No.  Governance is *extremely* limited in its ability to change things for those protocols.",
        "created_at": "2021-07-14T16:59:26.349000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Augur has no governance at all.  Uniswap governance can *only* change the fee rate.  Maker governance can tune a bunch of knobs, but cannot replace the core code.",
        "created_at": "2021-07-14T16:59:47.230000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I mean they can vote in a governance item stating \"deploy contract xyz\", but then it is still social consensus for people and tools to use that new address.",
        "created_at": "2021-07-14T16:59:57.383000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Governance can vote but it has no meaning.  ðŸ™‚",
        "created_at": "2021-07-14T17:00:12.755000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "A lot of governance tools just do this exact thing. Vote on something and pray that the keyholders actually execute it ðŸ™‚",
        "created_at": "2021-07-14T17:00:35.867000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The migration strategy is the same as Augur v1 to Augur v2 or Uniswap v1 to Uniswap v2.  Developers deploy a *new project* and then convince people the new project is better than the old one and they should switch to it.",
        "created_at": "2021-07-14T17:00:51.602000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There is nothing that can be executed in the case of *actually* censorship resistant protocols.",
        "created_at": "2021-07-14T17:01:09.711000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Augur v1 and Uniswap v1 can still be used today and you cannot stop anyone from doing so.",
        "created_at": "2021-07-14T17:01:24.132000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sure, and in this \"migration world\", they would just not be able to interact with the new address space (but would be subject to the compressed-address-in-calldata issues).",
        "created_at": "2021-07-14T17:02:00.065000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Augur v2 and Uniswap v2 are completely new projects that people have *chosen* to use instead of the older project with a similar name.",
        "created_at": "2021-07-14T17:02:11.147000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Right, so this would be a hard break where we have two different address spaces that cannot interop with each other.",
        "created_at": "2021-07-14T17:02:35.673000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is unclear if this is significantly better than just spinning up a new chain though?",
        "created_at": "2021-07-14T17:02:48.946000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is better if there is some form of migration possibility, or if there is some form of built in bridge possibility.",
        "created_at": "2021-07-14T17:03:10.288000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We wouldn't get all of the benefits of a new chain (clean slate, fix all of the problems, etc.) but we would suffer the downside of lack of interoperability.",
        "created_at": "2021-07-14T17:03:13.958000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We could build a bridge between chains as well.",
        "created_at": "2021-07-14T17:03:31.177000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Though one can argue a bridge likely is subject to the same problems we see with ASE -- maybe not?",
        "created_at": "2021-07-14T17:03:38.660000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Probably a similar class of problems?  Would need to think it through much more deeply.",
        "created_at": "2021-07-14T17:03:59.822000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In any case my plan was to explore the migration path if we hit a roadblock on this current one.",
        "created_at": "2021-07-14T17:04:15.208000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "To be clear to casual readers, I'm not lobbying for a new blockchain here.  Just asserting that it isn't clear that option is *worse* than the currently proposed/viable alternatives.  ðŸ™‚",
        "created_at": "2021-07-14T17:04:38.976000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And by bridge I mean in practice a contract, which is deployed under a legacy address, but is capable (opcode wise) of interacting with new addresses. Likely the capability is determined based on the bytecode (such as an EOF prefix) or a field in the account (i.e. it is created via a special opcode/tx which sets that field),  as opposed to its address.",
        "created_at": "2021-07-14T17:07:06.012000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I can sketch this idea out for discussion",
        "created_at": "2021-07-14T17:08:30.829000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Is it really this simple?\n\nhttps://notes.ethereum.org/@axic/B1BUs526u",
        "created_at": "2021-07-14T17:53:10.976000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Added transaction validity to it. Can't think about any other pro/con right now?",
        "created_at": "2021-07-14T21:23:52.347000+00:00",
        "attachments": []
    },
    {
        "author": "axic3354",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also tried to clean up some of the other new points and added a few more `Update:` lines explaining what some conclusions.",
        "created_at": "2021-07-14T21:31:36.155000+00:00",
        "attachments": []
    }
]