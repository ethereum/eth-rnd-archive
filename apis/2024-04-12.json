[
    {
        "author": "radekkapka",
        "category": "Consensus Layer",
        "parent": "",
        "content": "How does anyone feel about extending https://ethereum.github.io/beacon-APIs/?urls.primaryName=dev#/Node/getHealth to cover the scenario of optimistic execution? Unless 206 is meant to be returned in this case, in which case it would be good to explicitly state this in the endpoint's description.",
        "created_at": "2024-04-12T09:15:50.381000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Do you have a use case example for this? why not just use https://ethereum.github.io/beacon-APIs/?urls.primaryName=dev#/Node/getSyncingStatus ?",
        "created_at": "2024-04-12T09:18:50.835000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus Layer",
        "parent": "",
        "content": "This is for node operators who run multiple nodes and need to know which are healthy and which are not. If a node is optimistic, it isn't healthy as it cant serve validators",
        "created_at": "2024-04-12T09:20:55.506000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Got it, that's what I assumed, e.g. for readiness probes in k8s. But would there be a difference between bn syncing or bn synced and just el syncing?",
        "created_at": "2024-04-12T09:22:36.996000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Its mostly to cover the latter case where the bn has synced but the EL becomes optimistic for any reason",
        "created_at": "2024-04-12T09:23:55.206000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Wouldn't it be simplest in that situation to return the 206 code as per the spec?  Seems like it is the same situation, practically speaking.",
        "created_at": "2024-04-12T09:25:01.129000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Have just double checked, at least in Lodestar we do not consider the EL right now, probably something to add and return 206",
        "created_at": "2024-04-12T09:28:05.059000+00:00",
        "attachments": null
    },
    {
        "author": "radekkapka",
        "category": "Consensus Layer",
        "parent": "",
        "content": "same in Prysm",
        "created_at": "2024-04-12T09:28:49.979000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Sounds good as long as there is a way for a node operator to differentiate an optimistic node from a healthy one",
        "created_at": "2024-04-12T09:28:54.627000+00:00",
        "attachments": null
    },
    {
        "author": "radekkapka",
        "category": "Consensus Layer",
        "parent": "",
        "content": "you wouldn't be able to differentiate using this endpoint alone",
        "created_at": "2024-04-12T09:29:52.424000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Does it matter if the node is syncing on the CL or synced on the CL and optimistic on the EL, in terms of what the node operator would do?\n\n(You could take the health and syncing endpoints in combination to work it out, if it matters.)",
        "created_at": "2024-04-12T09:30:04.270000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus Layer",
        "parent": "",
        "content": "No, but as long as the operator has  a way to know that the CL + EL pair is unhealthy because the EL is optimistic from the endpoint itself should be enough",
        "created_at": "2024-04-12T09:33:55.009000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Cool, so perhaps worth expanding on the information about the status code in the spec, that it should be returned as 206 if either the consensus node is syncing _or_ the execution node is optimistic?  It sounds like this is not something that the consensus nodes do at current (at least from the quick straw poll here) but they should for the endpoint to be fully suited to its purpose.",
        "created_at": "2024-04-12T09:35:54.481000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Perfect, that should be enough for this particular case",
        "created_at": "2024-04-12T09:37:30.964000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I can throw something together.  how about this for the description of the 206 status code:\n\n```\nEither the consensus node is syncing, or its execution node is optimistic, so data served may be incorrect\n```",
        "created_at": "2024-04-12T09:40:38.920000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "https://github.com/ethereum/beacon-APIs/pull/442",
        "created_at": "2024-04-12T10:01:24.321000+00:00",
        "attachments": null
    }
]