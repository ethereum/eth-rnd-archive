[
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "do clients have benchmarks on their beacon APIs? investigating why calling some of these duties endpoints take so long",
        "created_at": "2025-03-11T16:11:30.983000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I can share metrics if that's helpful but duties endpoint for example highly depends on the number of validators so would need to have similar count to give you comparable data",
        "created_at": "2025-03-11T16:39:40.559000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "great mine is like only 1 validator ( i think it's filtered before hand anyways as there are 2 exited ones in the mix), i'm seeing it takes 5-7 seconds against the pandaops holesky nodes",
        "created_at": "2025-03-11T18:26:35.476000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "maybe i'm not measuring deeply enough will try to add more logs",
        "created_at": "2025-03-11T18:27:02.803000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "this seems like a issue with the beacon node to me rather than the validator client, I don't see a reason why that request would take more than ~100ms",
        "created_at": "2025-03-11T18:30:07.378000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "yeah but i tried several times using prysm vc against it and it should be load balanced so it should probably choose a different node?",
        "created_at": "2025-03-11T18:30:54.565000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "we could also have an issue on our side too in our design with each duties call on a different thread",
        "created_at": "2025-03-11T18:31:21.602000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "it's trying to match the gRPC implementation",
        "created_at": "2025-03-11T18:31:29.664000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I am not sure how their load balancer works, my guess is it does IP based matching as you want static connections and not connect to a different beacon node for each request but could be wrong",
        "created_at": "2025-03-11T18:31:36.860000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "if you are running a debug / local build could inspect headers to try and figure out what bn it is",
        "created_at": "2025-03-11T18:32:51.298000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "or if you wanna try another remote beacon node that is not prysm you can use this one here http://holesky-16.chainsafe.dev:9596/",
        "created_at": "2025-03-11T18:34:39.379000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "oh sweet ok will try that too",
        "created_at": "2025-03-11T18:34:55.868000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "great I hope this doesn't take 7 seconds to respond ðŸ˜…",
        "created_at": "2025-03-11T18:35:14.414000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I think i'm stuck, when i started up nothing happens, tries to get chain start I assume it'll context time out",
        "created_at": "2025-03-11T18:49:55.749000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I checked the node, it seems responsive and healthy, although it still has 60k validators connected but shouldn't be an issue",
        "created_at": "2025-03-11T19:05:40.185000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "that's super weird i wonder why it's not responding",
        "created_at": "2025-03-11T20:04:45.854000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "```\n[2025-03-11 14:10:00] ERROR beacon-api: STARTED COMMITTEE API CALLL!!!!!!!for epoch 119317 time_remaining=11.781662s\n[2025-03-11 14:10:05] ERROR beacon-api: ENDED COMMITTEE API CALLL!!!!!!! for epoch 119317 time_remaining=6.76583s\n```\n\nyeah these committee calls maybe we are using it wrong do you also provide all the matching committee indexes for your call?\n```\ncommitteeParams.Add(\"epoch\", strconv.FormatUint(uint64(epoch), 10))\n    committeesRequest := buildURL(\"/eth/v1/beacon/states/head/committees\", committeeParams)\n```\ni guess we are just getting all of them for the epoch",
        "created_at": "2025-03-11T20:07:44.598000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "why do you call `getEpochCommittees` from the validator client, this shouldn't be required, if you query this api without any query parameter filter like index or slot then it returns all 2048 committees of the epoch, it's only the indices but still, the JSON response is 16 MB large. The 5-7 second response time can be easily explained because it a lot of work the beacon node has to do but also on the client side you have to parse this massiv JSON response.",
        "created_at": "2025-03-11T20:47:32.750000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "good question lol i didn't write this call will need to investigate, it's trying to mirror gRPC is all i know",
        "created_at": "2025-03-11T20:48:50.740000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "there are specific duty endpoints you can use, but I am really curious now what prysm vc does with that information from the endpoint, maybe metric related or some analysing? I know for example that Charon calls `getBlockAttestations` to analyze validator performance, maybe it's similar",
        "created_at": "2025-03-11T20:50:57.390000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "https://github.com/prysmaticlabs/prysm/blob/3ab759e163a6a7f531da7d074b98d5ac24557fc3/validator/client/beacon-api/duties.go#L43\n\nit's just trying to mirror the gRPC response, as first part of our migration we are simply using the gRPC implementation as an interface to hotswap between rest and gRPC , so some of the REST endpoints and calls are not optimized",
        "created_at": "2025-03-11T20:54:19.536000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "not sure I understand your gRPC behavior correctly but the beacon-api has 3 dedicated endpoints to fetch validator duties",
        "created_at": "2025-03-11T21:01:31.098000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "36d9aa2eb36da2be0e62b6663ac8534dc89ce9623a6f4054d4f95fbb4f8608bb"
            }
        ]
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "\u003c@884836500037066862\u003e I just checked in Vouch, and we never call `/eth/v1/beacon/states/\u003cstate\u003e/committees`, so you can likely work without it.  I suspect that what you want to use is the attester duties endpoint, as \u003c@586161934425128960\u003e says.",
        "created_at": "2025-03-11T21:04:24.801000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "there's something up with this then I will look into it",
        "created_at": "2025-03-11T21:07:31.418000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "thanks for the feedback",
        "created_at": "2025-03-11T21:10:07.590000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i don't know if it's because of that committees endpoint yet but we timed out on sync too",
        "created_at": "2025-03-11T21:11:28.166000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "[2025-03-11 10:57:24] ERROR client: Failed to update assignments error=request timed out!!!!!!!!!!!!!!!! (deadline was 2025-03-11 10:57:24 -0500 CDT and it is 2025-03-11 10:57:24.00127 -0500 CDT m=+259.748962501): failed to get duties for next epoch `119288`: failed to get sync duties for epoch `119288`: failed to perform request for endpoint http://beacon.holesky.ethpandaops.io:80/eth/v1/validator/duties/sync/119288: Post \"http://beacon.holesky.ethpandaops.io:80/eth/v1/validator/duties/sync/119288\": context deadline exceeded",
        "created_at": "2025-03-11T21:11:29.862000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I'm seeing that return pretty much immediately.  Sure you aren't carrying around an old timeout on that context?",
        "created_at": "2025-03-11T21:20:00.419000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i'm not tally sure, but if you're saying it's immediate i believe you. it's probably the commitee endpoint then",
        "created_at": "2025-03-11T21:20:46.436000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "sync duties endpoint is pretty cheap but you still only wanna query the duties for your validator indicies (passed in request body)",
        "created_at": "2025-03-11T21:21:55.673000+00:00",
        "attachments": null
    }
]