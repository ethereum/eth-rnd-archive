[
    {
        "author": "tbenr",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Hey, we have increasingly in need of pagination, especially for `beacon/states/\u003c\u003e/validators`. Do other clients feel the same pressure? Should we give some priority to the topic?",
        "created_at": "2022-07-06T09:11:25.219000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Why is there a requirement for this?  Purely down to the size of the response, or something else?",
        "created_at": "2022-07-06T09:14:27.259000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i'd love to know why ppl are trawling validators in that way...",
        "created_at": "2022-07-06T09:15:18.144000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "the validators response is horrible, its bigger than the entire state from memory",
        "created_at": "2022-07-06T09:16:34.110000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I have always held that pagination isn't a lot of use for the beacon node API.  Pagination is useful when (a) results are returned in some sort of user-defined order and (b) the user may not fetch every page.  Anything else seems to be an issue with decoding or similar.",
        "created_at": "2022-07-06T09:17:23.120000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I don't disagree that it's large.  Is the concern the on-the-wire size, or the in-memory size?",
        "created_at": "2022-07-06T09:17:43.736000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "compute isn't great, im not sure we care much about OTW size given the already large requirements",
        "created_at": "2022-07-06T09:18:11.892000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "so fetching archived state, usually slow, then have to jump hoops",
        "created_at": "2022-07-06T09:18:39.755000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Could this endpoint send data as SSZ?\n\nPersonally I'd like to see all endpoints support SSZ, but haven't managed to get around to talking about it.",
        "created_at": "2022-07-06T09:18:44.595000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "its not as easy as a native type but anything is possible...",
        "created_at": "2022-07-06T09:19:32.339000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "just cost/effort - and if they're using 1-2 fields, perhaps a better endpoint would be more appropriate anyway",
        "created_at": "2022-07-06T09:20:03.735000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i could see a strong argument for SSZ for all validator required",
        "created_at": "2022-07-06T09:20:56.867000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Yeah we have a few API-specific data structures, but not many.  And they're all well-defined, so three is a path there.  SSZ should reduce both memory and CPu requirements on server and client, so it is tempting.  But of course I'm not writing the server side ðŸ™‚",
        "created_at": "2022-07-06T09:21:54.704000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i'm not sure who would be best to ask 'what is actually used when a user selects all validators from a state'",
        "created_at": "2022-07-06T09:22:03.066000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i suspect re-computing state will be the bulk of the time in the validators call",
        "created_at": "2022-07-06T09:23:34.686000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "but encoding that much data isnt free, i'll admit ðŸ™‚",
        "created_at": "2022-07-06T09:23:57.553000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Are most calls to validators against old states, though?  I'd imagine that many of them are after the current state of validators, so state should already be available.",
        "created_at": "2022-07-06T09:24:49.403000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "(Only a guess, mind).",
        "created_at": "2022-07-06T09:24:58.532000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i can't see why you'd need to call the validators endpoint often for pretty much anything without filtering...",
        "created_at": "2022-07-06T09:25:32.191000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I'm a bit at a loss as to why ppl would do it",
        "created_at": "2022-07-06T09:25:53.094000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "almost tempting to put in a PR to say max 10000 and see if anyone complains ðŸ˜„",
        "created_at": "2022-07-06T09:27:30.670000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "`chaind` fetches it each epoch to find out what has changed in the list.  Somewhat for balances (although there is a separate API call for that if it was all we wanted) but also to know what has changed in the validator set.  Some sort of \"show me changed validators in the last x epochs\" call may be an option, but that would likely become quite complex.",
        "created_at": "2022-07-06T09:28:02.457000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I would!",
        "created_at": "2022-07-06T09:28:09.489000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "yeh i think something as specific as effective balance would be a good endpoint",
        "created_at": "2022-07-06T09:28:32.561000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "*stacks* less data",
        "created_at": "2022-07-06T09:28:39.777000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "just depends what is actually helpful",
        "created_at": "2022-07-06T09:29:04.030000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "like the validator status?",
        "created_at": "2022-07-06T09:29:34.731000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "(Vouch also fetches all validators, because it needs to check periodically to see if any of the public keys it knows about are now assigned to validators.  We could check each key individually, but I suspect that would be slower, and dependent on the beacon node having a suitable map to make this a cheap operation).",
        "created_at": "2022-07-06T09:30:10.524000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "if you want it cheap, just use leveldb-tree, and you'd get instant fetching of state (at the cost of disk size heh)",
        "created_at": "2022-07-06T09:30:51.028000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I think that if anything it would make sense to keep the return format the same but provide some sort of filtering on the query.  But then we're in to collecting use cases again.",
        "created_at": "2022-07-06T09:31:22.900000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i think in this case stepping back and asking 'whats actually needed' maybe useful",
        "created_at": "2022-07-06T09:32:05.355000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i think a limit may work initially to get a conversation... sometimes i raise PRs that i think might generate conversation and it just gets approved and merged heh",
        "created_at": "2022-07-06T09:33:10.454000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Regarding use cases there seem to be the following:\n  - is there a use case for fetching all validators, and all information provided for each validator?  Yes, for varying reasons (`chaind` is the obvious one as I think of it, but I'm sure there are others out there)\n  - is there a use case for fetching a subset of validators?  Yes, but how much of that requirement is met by calling the `/validators/\u003cid\u003e` endpoint and is there a breakpoint that can be agreed between beacon node implementations as to when it is more efficient to call the per-valdiator endpoint for a number of validators versus fetching them all\n  - is there a use case for fetching a subset of the information for each validator?  Yes, but I suspect that this would end up becoming a monster in terms of having to deal with all of the various combinations and encodings thereof\n - is there a use case for paginating the results?  I don't see one, as per my previous comment, unless it is an issue of load on either the server or client.  But even then I'd be wary of the complications caused by a paginated API Vs. throwing a bit more memory/cpu at the problem if this is not a wide-spread issue\n\nIf anyone does have use cases it would be interesting to hear them.  Ideally we'd look at how to address this across all relevant APIs rather than piecemeal.",
        "created_at": "2022-07-06T10:41:00.255000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Consensus Layer",
        "parent": "",
        "content": "what about introducing a variant  `/validators/\u003cfrom_idx\u003e:\u003cto_idx\u003e` to allow getting ranges? I think several contiguous indices belongs to the same owner so it could give an alternative and the implementation is trivial",
        "created_at": "2022-07-06T11:03:48.235000+00:00",
        "attachments": null
    }
]