[
    {
        "author": "sproul",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Nimbus gang, would you like to weigh in on \u003chttps://github.com/ethereum/beacon-APIs/pull/377\u003e? üôè\n\ncc \u003c@654267572107083777\u003e \u003c@553610810652622860\u003e (apologies if you aren't the API peeps, pls pass to whoever is interested)",
        "created_at": "2023-12-07T01:03:30.512000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Consensus Layer",
        "parent": "",
        "content": "\u003c@792822129019584562\u003e that PR looks like a forum now. \n\u003e I am fine with BN having a final say, but in the case that BN can't honor builder_only it should throw error and not resort with a local block\nI assume this is important for DVT, is this right? can you explain me why? I am in principle not against this because this is anyway information that the VC will have, that is, the receiving end can simply check if it gets a full block and treat that as an error. But I am curious about the use of this feature",
        "created_at": "2023-12-07T15:45:15.103000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "hey! yea lol üòÜ",
        "created_at": "2023-12-07T15:46:44.900000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "but this is my reasoning: ```\nDVTs' proposals seem run in two ways:\n\n    Round robin by electing one of the nodes to build block to propose and circulate it for signing\n    by having a shared block sourced from builders and aggregating the signature.\n\nSo for 2, they need a deterministic output (given a matching set of builders)\n```",
        "created_at": "2023-12-07T15:47:03.146000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "have you confirmed with DVTs doing #2 that this does/would help them?",
        "created_at": "2023-12-07T15:48:20.939000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "yes we were asked to support this specific behavior and hence thats why we added the flag",
        "created_at": "2023-12-07T15:48:55.356000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "\u003e the receiving end can simply check if it gets a full block and treat that as an error.\n\nwe (not the DVT guys) also want to be able to configure BN to respond to blinded versions even of a local block with the aim of providing a way to reduce latency especially for blobs based super blocks",
        "created_at": "2023-12-07T15:50:42.048000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "its possible that they (DVT guys) can work around and figure this out, but may be we can just support this because the cost of supporting this is very small imo",
        "created_at": "2023-12-07T15:52:05.660000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "On the latter point, at least at one time, Vouch had issues with that behavior because it guaranteed the unblinded block wasn't actually available anywhere else, as I understand it.",
        "created_at": "2023-12-07T15:52:30.971000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Consensus Layer",
        "parent": "",
        "content": "\u003e we (not the DVT guys) also want to be able to configure BN to respond to blinded versions even of a local block with the aim of providing a way to reduce latency especially for blobs based super blocks\nI am incredibly against this",
        "created_at": "2023-12-07T15:53:34.579000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "yes, but this behavior would be available on a special flag to be configured on beacon startup so the user is assumed to be knowing what they are doing",
        "created_at": "2023-12-07T15:53:48.615000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Consensus Layer",
        "parent": "",
        "content": "This was a feature that Jim also requested a while ago and I feel very strongly about this",
        "created_at": "2023-12-07T15:53:53.474000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Consensus Layer",
        "parent": "",
        "content": "exactly",
        "created_at": "2023-12-07T15:54:04.873000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Consensus Layer",
        "parent": "",
        "content": "and I still oppose this behavior",
        "created_at": "2023-12-07T15:54:10.425000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "why can't we leave it to client implementations to make it available via special option",
        "created_at": "2023-12-07T15:54:31.089000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Yes, I remember this, and my ask at the time was that people figure out what the spec should require, then Nimbus will do that. But I found add-a-special-case-option unappealing",
        "created_at": "2023-12-07T15:54:42.811000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Consensus Layer",
        "parent": "",
        "content": "that's fine, as far as I am not forced to I don' t mind if Prysm is the only client that doesn' t behave like this. I would like other clients not to do that either. But I will be contempt with not being forced to",
        "created_at": "2023-12-07T15:55:14.464000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Nimbus currently only uses blinded for builder API blocks.",
        "created_at": "2023-12-07T15:55:34.161000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Consensus Layer",
        "parent": "",
        "content": "This was a reply to \u003c@792822129019584562\u003e not \u003c@654267572107083777\u003e",
        "created_at": "2023-12-07T15:55:41.653000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "ah okay",
        "created_at": "2023-12-07T15:55:45.414000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Consensus Layer",
        "parent": "",
        "content": "sorry, pretty slow today at the keyboard",
        "created_at": "2023-12-07T15:55:55.053000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "even we don't do this right now, but we want to and find produceblockv3 limiting in this way",
        "created_at": "2023-12-07T15:56:13.444000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Aren't CL/EL typically on a fast, low-latency connection to each other? Often localhost.",
        "created_at": "2023-12-07T15:57:00.558000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "this is for VC\u003c\u003eCL, yes they are in same network(but not often on localhost)",
        "created_at": "2023-12-07T15:57:45.813000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "oops, right",
        "created_at": "2023-12-07T15:57:55.877000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "VC/BN",
        "created_at": "2023-12-07T15:57:59.445000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "same question",
        "created_at": "2023-12-07T15:58:02.748000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "but the client software's serialization deserilization can add latency rather than just the network",
        "created_at": "2023-12-07T15:58:12.419000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i am thinking about a super blobs scenario",
        "created_at": "2023-12-07T15:58:38.727000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "the current payload is just fine for latency , 30ms of what i observed",
        "created_at": "2023-12-07T15:58:58.096000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Ohh lol I see now the PR actually already \u003c@144468805697929216\u003e raised the issue of the full payload being treated as error there. I need to keep reloading that page üòÑ",
        "created_at": "2023-12-07T15:59:04.299000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "also agree with another commend in the thread, if we don't wanna go the route of allow BN to respond with blinded version on local, we should rename `executionPayloadBlinded` response to `executionPayloadBuilder` or something ...",
        "created_at": "2023-12-07T16:02:09.196000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "this can become significant if block is sourced from multi beacons to have best proposal but yea that could be something niche",
        "created_at": "2023-12-07T16:03:31.691000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I don' t mind this, I mean my hard no will be in providing a way to give the VC a blinded block when the beacon decided that it was a bad idea. Not giving anything in this case (which we would reply if requested for a blinded block in whatever endpoint) is acceptable.",
        "created_at": "2023-12-07T16:07:16.318000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Also, FWIW, I suspect that people already have written the trivial software to blind a block",
        "created_at": "2023-12-07T16:07:39.190000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Consensus Layer",
        "parent": "",
        "content": "the issue is how much of the beacon node work are we willing to safe such operators.",
        "created_at": "2023-12-07T16:07:57.109000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Yeah, need to read the whole GitHub issue, but the main thing I'd be opposed to is requiring the BN to return a blinded block for an engine API block. It's kind of an edge-case maybe-optimization which undermines one of the other features Nimbus has, which is a VC which knows how to use multiple BNs.",
        "created_at": "2023-12-07T16:09:14.704000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "\u003e Not giving anything in this case (which we would reply if requested for a blinded block in whatever endpoint) is acceptable.\nI am good with this to reject the request if BN decided somethings amiss like censorship",
        "created_at": "2023-12-07T16:09:28.355000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Or having an (yet another option) in the REST API specs where the VC could demand it, to be precise",
        "created_at": "2023-12-07T16:09:44.589000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "One has obvious utility (the multiple BN support) and the other, am not convinced and just adds state and complexity",
        "created_at": "2023-12-07T16:10:17.234000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Consensus Layer",
        "parent": "",
        "content": "We' re in the same page here then",
        "created_at": "2023-12-07T16:10:21.274000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "\u003e the main thing I'd be opposed to is requiring the BN to return a blinded block for an engine API block.\ntbh we don't have this in lodestar's produceblockv3, but produceBlindedBlock (which can obviously be deprecated) runs the race and can give local block in blinded fashion, so we can easily support it as we have all moving parts build",
        "created_at": "2023-12-07T16:13:02.699000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "but the main idea is to leave the flexibility of this for future if blobs per block really blow up, which i am assuming they will",
        "created_at": "2023-12-07T16:13:55.758000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "If this happens, and the use case becomes compelling then, the beacon API can be rethought accordingly. But pending that, it's just one more potential bit of API detritis accumulated along the way which might not turn out to be useful by the time it's called into service.",
        "created_at": "2023-12-07T16:15:30.164000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "It's much easier to add such flexibility later than remove false flexibility added now.",
        "created_at": "2023-12-07T16:15:55.937000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "in that case lets just the change `executionPayloadBlinded` to `executionPayloadBuilder` so that we can extend the API if need be",
        "created_at": "2023-12-07T16:16:33.039000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "then `builder_only` flag is not required and DVTs can use the above flag to reject the produced block easily if they are intend to be running proposal via builder",
        "created_at": "2023-12-07T16:18:06.351000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "\u003c@792822129019584562\u003e I'm not sure I see where you're suggesting changing, specifically?",
        "created_at": "2023-12-07T16:26:08.807000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "it's not in the existing `beacon-APIs` repo or that PR",
        "created_at": "2023-12-07T16:26:19.865000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Consensus Layer",
        "parent": "",
        "content": "just added the comment for the same",
        "created_at": "2023-12-07T16:31:30.182000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "No I didn't üôÇ  I'm against this, too, for what it's worth.\n\nWhat I was against was the v1 blinded blocks request building a block from a local request, and then returning blinded information.",
        "created_at": "2023-12-07T17:24:57.023000+00:00",
        "attachments": []
    },
    {
        "author": "sproul",
        "category": "Consensus Layer",
        "parent": "",
        "content": "for a bit more context: blinding local blocks is what Lighthouse was doing on block v1/v2. We've stopped in v3",
        "created_at": "2023-12-07T21:58:35.943000+00:00",
        "attachments": []
    }
]