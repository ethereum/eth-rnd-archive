[
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "well, one challenge with using slot to parse is that it creates two-stage parsing -- first, enough to get slot, then the rest",
        "created_at": "2024-09-25T09:40:55.519000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "thats a pretty trivial search on any json object i'd expect for basically any language...",
        "created_at": "2024-09-25T09:41:37.360000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "it means not being able to directly parse into the destination data type though",
        "created_at": "2024-09-25T09:41:53.130000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "it's not hard, it's ugly and slow",
        "created_at": "2024-09-25T09:42:02.193000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "you could probalby make a fair assumption based on your current slot",
        "created_at": "2024-09-25T09:42:12.781000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "except for a couple of slots either side maybe of transition",
        "created_at": "2024-09-25T09:42:25.915000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "and/or creates bespoke parsers which are almost-JSON but not quite standard-JSON",
        "created_at": "2024-09-25T09:42:36.188000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "eventstream is not standard json anyway, but feel free to comment, at hte moment i need to figure out what way we're going and the general look from tickets is towards that as a solution",
        "created_at": "2024-09-25T09:43:19.424000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i.e. if people are ok with low quality of implementation it's easy",
        "created_at": "2024-09-25T09:43:40.540000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "random glitches here and there",
        "created_at": "2024-09-25T09:43:54.427000+00:00",
        "attachments": []
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "do all CLs acutally implement the client side of all events? we just do it in Lodestar because we have a generic beacon client, but we don't actually use the attestation event anywhere ourselves",
        "created_at": "2024-09-25T09:43:55.506000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "you're possibly overstating a bit, because the type would aslo be coming from the same object",
        "created_at": "2024-09-25T09:44:01.476000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Nimbus doesn't. So in a visceral sense I don't have much at stake. I'll probably never implement an attester stream parser for Nimbus",
        "created_at": "2024-09-25T09:44:41.012000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "we dont read it either, but slashings potentially we do",
        "created_at": "2024-09-25T09:44:58.490000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "but as  to whether i get a version string or slot if i need it, is kinda academic imo",
        "created_at": "2024-09-25T09:45:10.380000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Mostly, I want to systematically move away from reliance on autodetection of types, of the parse-into-generic-JSON-then-detect-shape-of-JSON pattern",
        "created_at": "2024-09-25T09:45:32.689000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "And the beacon API mostly has been doing that",
        "created_at": "2024-09-25T09:45:42.069000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "if you want to remove that, then event stream will never be your friend",
        "created_at": "2024-09-25T09:45:46.602000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "the only way would be to label every single different fork / object pair",
        "created_at": "2024-09-25T09:46:08.295000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "so like attestation_electra",
        "created_at": "2024-09-25T09:46:20.241000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "seems ok?",
        "created_at": "2024-09-25T09:46:22.506000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "horrible",
        "created_at": "2024-09-25T09:46:26.747000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "ok",
        "created_at": "2024-09-25T09:46:35.924000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "every hard fork every type needs to be added",
        "created_at": "2024-09-25T09:46:40.152000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "imo thats in the 'busy work' category",
        "created_at": "2024-09-25T09:46:48.302000+00:00",
        "attachments": []
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "you only need to do it once, if it's versioned it would be forward compatible",
        "created_at": "2024-09-25T09:47:03.458000+00:00",
        "attachments": []
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "like e.g. the light client events right now",
        "created_at": "2024-09-25T09:47:19.264000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "depends how you go, if you want version information it'd need to be a lot of objects, blocks would have every fork",
        "created_at": "2024-09-25T09:47:35.464000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "so if you sign up for a new fork you'd need to potentially sub to a bunch of topics",
        "created_at": "2024-09-25T09:48:06.878000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "well, that's just what clients do now",
        "created_at": "2024-09-25T09:48:32.693000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "eg. attestation_phase0, attestation_electra assuming your forward compatability",
        "created_at": "2024-09-25T09:48:36.189000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "every fork new libp2p topic subscriptions",
        "created_at": "2024-09-25T09:48:44.991000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "kinda dift to every event client needing to also do that",
        "created_at": "2024-09-25T09:49:05.479000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "anyone that ever wants to script something, etc etc",
        "created_at": "2024-09-25T09:49:24.465000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "ok, I don't feel that strongly about this ultimately, if consumers prefer another approach that's fine",
        "created_at": "2024-09-25T09:49:52.387000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "it's not something Nimbus's light client or validator client consumes so.",
        "created_at": "2024-09-25T09:50:12.036000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i'd want everyone to sign up to that pain if we went that way",
        "created_at": "2024-09-25T09:50:20.293000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "random wacky variant JSON objects aren't tricky to produce, only consume",
        "created_at": "2024-09-25T09:51:21.710000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "this isnt a variant",
        "created_at": "2024-09-25T09:51:34.476000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "not in the most technical of senses no",
        "created_at": "2024-09-25T09:51:45.129000+00:00",
        "attachments": []
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "so the v2 eventstream seems to painful in terms of maintaince, the only other option is https://github.com/ethereum/beacon-APIs/pull/461 but I'd would rather not do anything right now and wait for https://github.com/ethereum/consensus-specs/pull/3900 and https://github.com/ethereum/consensus-specs/pull/3787 which would require completely new attestation events. Then the only question remains how we deal with attester_slashing topic",
        "created_at": "2024-09-25T09:51:51.613000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "my point i guess is the current suggestion of embedding the version str in a given object is equiv to just reading slot",
        "created_at": "2024-09-25T09:52:29.577000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "so the only logical thing would be encode it in the event label",
        "created_at": "2024-09-25T09:52:50.149000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "the versioned one seems at least subjectively preferable to me",
        "created_at": "2024-09-25T09:52:55.330000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "if thats what we actually wanted",
        "created_at": "2024-09-25T09:52:55.908000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "to infer-from-slot",
        "created_at": "2024-09-25T09:53:00.650000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "yeh but still pre-parsing object to get info to do something with",
        "created_at": "2024-09-25T09:53:14.488000+00:00",
        "attachments": []
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "yeah, true. We kinda blindly extract the version right now as well, so might as well just do it on the slot",
        "created_at": "2024-09-25T09:53:19.809000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "so slot or version string doesnt help a bunch",
        "created_at": "2024-09-25T09:53:21.949000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "because you're still having to read the json in, find context, read again",
        "created_at": "2024-09-25T09:53:40.353000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i guess the other consideration is, this is due for electra, so whatever is decided, we want to decide in a relatively timely fassion now",
        "created_at": "2024-09-25T09:54:48.046000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "it depends how guaranteed the context is to stay in the same position. Nimbus's JSON parsing libraries can use a pattern something like, define a \"generic JSON node\" hole in one of the types, and have it be\n```\ntype Foo =\n  version = Bar\n  whoknows = JsonNode\n```",
        "created_at": "2024-09-25T09:55:08.937000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "the structure will depend on how much we want to stuff about",
        "created_at": "2024-09-25T09:55:42.572000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "then use the serialization to read in a `Foo` object which automatically knows enough to read the `version` but doesn't try to parse `whoknows`. then dependent on `version` do whatever",
        "created_at": "2024-09-25T09:55:49.223000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "but there's still a clear metadata/data separation",
        "created_at": "2024-09-25T09:55:57.050000+00:00",
        "attachments": []
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I strongly agree here but for the events, we know that the shape stays the same and they won't support ssz, so no byte slicing required..seems kinda ok to me",
        "created_at": "2024-09-25T09:56:26.121000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "anyway, thats the decision to be made. so if \u003c@602753420033785856\u003e \u003c@308223150725005322\u003e \u003c@144468805697929216\u003e and anyone else that has an opinion can speak up",
        "created_at": "2024-09-25T09:57:44.493000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "yeah, curious what the actual consumers of these events think/prefer/want",
        "created_at": "2024-09-25T09:58:02.283000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "the concept of having 2 event streams going does scare me just knowing our code, so i'd prefer to avoid that unless theres a very strong preference and a chunk of spare time",
        "created_at": "2024-09-25T09:58:58.628000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I do see that issue/tradeoff, yes",
        "created_at": "2024-09-25T09:59:17.956000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "it's nice to have a strong guarantee of one canonical event source",
        "created_at": "2024-09-25T09:59:35.976000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "im not against a new attestation event type with a version string in it",
        "created_at": "2024-09-25T09:59:43.258000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "and attester_slashing - like the PR nflaig had raised",
        "created_at": "2024-09-25T10:00:11.409000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "but in the ticket the point was made that slot was just the same, so really im just the messenger",
        "created_at": "2024-09-25T10:01:03.921000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "and more bloat makes timing even less accurate i guess, and some people do seem to want these things as timely as possible",
        "created_at": "2024-09-25T10:02:36.829000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Given above, does probably warrant a TL/DR. I want to close event stream v2 at this point, and either have a new versioned event for the attestation and attester_slashing, or leave it up to the consumer to figure it out based on slot of the object(as suggested by... lion... i think)\nAre people wanting a versioned event for these 2, or do we let people figure it out from the slot?",
        "created_at": "2024-09-25T10:09:43.560000+00:00",
        "attachments": []
    },
    {
        "author": "jameshe5018",
        "category": "Consensus Layer",
        "parent": "",
        "content": "that sounds good üëç",
        "created_at": "2024-09-25T14:40:22.055000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "My preference would be to have a versioned event.  We already have this with the `consensus_version` field in various outputs of the API.\n\nAnd the rationale behind a v2 of the event stream is that we're likely to require versioning of many of the events over time, so it would be less painful to have a new endpoint now where every event contained explicitly versioned data rather than move them one at a time as hard forks require, and end up with ambiguity (_e.g._ people attempting to listen for `attestation` events after Electra, when they're all coming in the `versioned_attestation` topic or something).",
        "created_at": "2024-09-25T18:01:29.415000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Yeah for the v2 validators endpoint there seems to be no consensus on it returning just the validators spec struct, rather than the current validators-spec-struct-plus-some-other-things-we-thought-would-be-useful non-spec struct.  That's the main blocker here, as if we keep the current return fields we don't have an SSZ encoding for `status` so can't provide SSZ and without providing SSZ support the endpoint doesn't give us anything useful.",
        "created_at": "2024-09-25T18:04:59.185000+00:00",
        "attachments": []
    },
    {
        "author": ".paulharris",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i pretty strongly support that as a concept and would implement it happily, but there's not much point if im the only one that would... also though that can sit as a PR, it's not electra specific. I'd love to havea native object we can just return SSZ for, its our biggest output by far.",
        "created_at": "2024-09-25T20:21:08.115000+00:00",
        "attachments": []
    }
]