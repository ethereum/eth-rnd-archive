[
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Hey small q:\n\nI am analyzing/looking at the REST calls of VC. and i see calls to /eth/v1/beacon/pool/attestations that reads as\n\n```\n[{\"aggregation_bits\":\"0x0000000000040008\",\"data\":{\"slot\":\"4803490\",\"index\":\"0\",\"beacon_block_root\":\"0x2c14147963edea00db6500f94257edbbd31ac4838346cf8b72bafe0709e297b9\",\"source\":{\"epoch\":\"150108\",\"root\":\"0xfd1bfb4cc\n003221358ee9fb2db22593fdaa7c7c95a8580f1f1236c289a796914\"},\"target\":{\"epoch\":\"150109\",\"root\":\"0x612313254c23025efe77ed72558596ab245b2a409c1349baf067ec14dd1cdf45\"}},\"signature\":\"0xa7b36808f56bf38602b4c5c34221d6641c628ec89e682ed8d0ebeee783a780c63ce0521b3cc3df08d6d3788ac2f87d1a163ebf807a75655ba100918260e662103e00a873f635efd5993f691edd698519ed8c0906c9ad3509408c87159b38b851\"},{\"aggregation_bits\":\"0x000000000000000c\",\"data\":{\"slot\":\"4803490\",\"index\":\"0\",\"beacon_block_root\":\"0x2c14147963edea00db6500f94257edbbd31ac4838346cf8b72bafe0709e297b9\",\"source\":{\"epoch\":\"150108\",\"root\":\"0xfd1bfb4cc003221358ee9fb2db22593fdaa7c7c95a8580f1f1236c289a796914\"},\"target\":{\"epoch\":\"150109\",\"root\":\"0x612313254c23025efe77ed72558596ab245b2a409c1349baf067ec14dd1cdf45\"}},\"signature\":\"0xa463c63b9da79b4043f3fa3c9d2d3c5fe0f01de357b108a924ec2c854dde2a76381054952236186304fff3d9da51224403e0f67883249c6f22c2f5d37c01a07e5c9ec41f8530409d8155711650a1a143f65125b4b1b7b95752ad4293eecf9c5e\"}]\n```\nI am bit weirded out because according to the specs the aggregation_bits should have only one bit turned to on.\n\n```\n[REJECT] The attestation is unaggregated -- that is, it has exactly one participating validator (len([bit for bit in aggregation_bits if bit]) == 1, i.e. exactly 1 bit is set).\n```. does it not make it impossible to forward it anywhere. I am also seeing that the network sends me attestations on subnets (on sepolia) which have \u003e1 partecipating index and what would be the last bit is always on. Am i missing some spec here?",
        "created_at": "2024-04-17T17:45:09.592000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I am using lighthouse VC btw",
        "created_at": "2024-04-17T17:45:52.211000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "https://ethereum.github.io/beacon-APIs/#/Beacon/getBlockAttestations https://ethereum.github.io/beacon-APIs/#/Beacon/getPoolAttestations https://ethereum.github.io/beacon-APIs/#/Validator/getAggregatedAttestation all effectively specify the pre-7549 `Attestation` type serialization; in Electra, should these translate between the two and return the pre-Pectra Attestations, such that the change is meant to be gossip/SSZ only, or return different attestations depending?",
        "created_at": "2024-04-17T18:12:10.398000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Was that an answer to me or unreleated?",
        "created_at": "2024-04-17T18:25:20.621000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "sorry, unrelated",
        "created_at": "2024-04-17T18:25:36.191000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I don't have any particular insight into why the Lighthouse VC might be doing that",
        "created_at": "2024-04-17T18:26:09.040000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I also see this from the network btw, i think it is some format detail but not sure. Probably not the fault of LH also because it is always the very last bit to be on",
        "created_at": "2024-04-17T18:27:22.241000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "https://ethereum.github.io/beacon-APIs/#/Beacon/submitPoolAttestations doesn't specify that they have to be unaggregated attestations",
        "created_at": "2024-04-17T18:30:07.941000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "The gossip does",
        "created_at": "2024-04-17T18:31:11.105000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "And we publish them there",
        "created_at": "2024-04-17T18:31:16.466000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "there are both aggregated and unaggregated gossip topics",
        "created_at": "2024-04-17T18:31:27.998000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Yeah but that is for unaggregates",
        "created_at": "2024-04-17T18:31:40.654000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "For aggregates there is another REST API",
        "created_at": "2024-04-17T18:31:54.026000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "for `submitPoolFoo`?",
        "created_at": "2024-04-17T18:33:18.892000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I mean yes",
        "created_at": "2024-04-17T19:27:28.900000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Aggregate_and_proof although the publishing is in validator namespace. But regardless, you still need to apply gossip rules",
        "created_at": "2024-04-17T19:28:09.968000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I dont think Lh is at fault, i think the extra bit is added to determine where the actual length of the bitlist is. I just dont find it documented anywhere",
        "created_at": "2024-04-17T19:28:50.345000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "This also happens in gossiped messages fyi",
        "created_at": "2024-04-17T19:28:57.521000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Lodestar has no issues with submitted attestations by Lighthouse VC and we run those checks, see [[REJECT] The attestation is unaggregated](https://github.com/ChainSafe/lodestar/blob/unstable/packages/beacon-node/src/chain/validation/attestation.ts#L303-L320) and [getSingleTrueBit](https://github.com/ChainSafe/ssz/blob/3cc1529541990d7ac63725baa354f20a0f36f670/packages/ssz/src/value/bitArray.ts#L176-L185) for reference",
        "created_at": "2024-04-17T19:52:51.282000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i have no doubt you do, just wondering if there is doc on this behaviour",
        "created_at": "2024-04-17T19:57:14.213000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Consensus Layer",
        "parent": "",
        "content": "This is correct - it's an SSZ bitlist which does indeed set a bit to indicate the end of the list.  Should be in the SSZ spec.",
        "created_at": "2024-04-17T22:56:28.471000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "gotcha, but why is it in the json then?",
        "created_at": "2024-04-17T23:03:05.208000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Because the value in the json is an ssz encoded bitlist. You could make it a full json array with an entry per bit but that seems particularly inefficient.",
        "created_at": "2024-04-17T23:04:05.667000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "ok, guess i will delve a bit deep. this is a bit weird though because afaik i never saw this in attestations included in blocks for example",
        "created_at": "2024-04-17T23:04:46.915000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "or maybe i did but gets ignored and forgot that there was a mechanism for that",
        "created_at": "2024-04-17T23:05:22.299000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "i only see this now when observing subnet/REST behaviour",
        "created_at": "2024-04-17T23:05:50.013000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Yeah that's the standard encoding for bitlists it should be the same wherever they show up (because otherwise we couldn't infer the size of the bitlist from the data).",
        "created_at": "2024-04-17T23:06:33.100000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "wait but that bit is also included in the hash? correct? I see that it is part of the `HashTreeRoot` of beacon blocks",
        "created_at": "2024-04-17T23:07:18.647000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "or at least, never had issues by just ignoring this detail",
        "created_at": "2024-04-17T23:08:32.485000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Yes.  Otherwise you could have two bitlists of different sizes and they would generate the same hash.",
        "created_at": "2024-04-17T23:10:09.050000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "okkk thanks",
        "created_at": "2024-04-17T23:10:30.516000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Typically your SSZ library just deals with it all for you (if you have an even vaguely sane SSZ library). So it's most noticeable when looking at the JSON output manually - everywhere else it's just a blur of SSZ or already got decoded and stripped or added as needed.",
        "created_at": "2024-04-17T23:14:00.931000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Consensus Layer",
        "parent": "",
        "content": "no, i had that fully working (just forgot that little detail), i just was extremely bamboozled by the json",
        "created_at": "2024-04-17T23:16:15.261000+00:00",
        "attachments": null
    }
]