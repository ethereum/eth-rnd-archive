[
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I'm not sure I 100% understand 3 -- could you clarify it?",
        "created_at": "2024-06-24T06:50:57.205000+00:00",
        "attachments": []
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "(3) is essentially updating the event without bumping any version, since we need a format like this\n```\nevent: attestation\ndata: {\"version\":\"phase0\",\"data\": {\"aggregation_bits\":\"0x01\", ...}}\n```\n(1) implies that change as well but we could also update other events to be more forward compatible",
        "created_at": "2024-06-24T09:19:30.762000+00:00",
        "attachments": []
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "this means (4) would not be an option, it's not a great option anyways. And (3) we likely don't want to avoid breaking changes",
        "created_at": "2024-06-24T09:22:43.802000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "yes, we've been moving away from (4)-like options in general",
        "created_at": "2024-06-24T09:24:13.360000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Consensus Layer",
        "parent": "",
        "content": "requiring more APIs to specify in HTTP headers the fork etc",
        "created_at": "2024-06-24T09:24:24.363000+00:00",
        "attachments": []
    },
    {
        "author": "0xunclebill",
        "category": "Consensus Layer",
        "parent": "",
        "content": "is there a reason why we choose to include both the consensus version in the header plus the version in the response object for many beacon api endpoints? it seems a bit redundant",
        "created_at": "2024-06-24T10:40:22.204000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Many of the responses can be SSZ, so we need the header for them.",
        "created_at": "2024-06-24T11:05:41.376000+00:00",
        "attachments": []
    },
    {
        "author": "0xunclebill",
        "category": "Consensus Layer",
        "parent": "",
        "content": "right, i just meant in the json response case, we seem to include the version in both the header and response body when we could  get away with only including it in the header?",
        "created_at": "2024-06-24T11:11:04.657000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Originally we put it in the JSON because we didn't have the header fields.  At this stage we could get away with it being just in the header, but that would be more bumping of versions and given that the effort used to add this field in the JSON metadata is minor I don't think it's worthwhile to do so.",
        "created_at": "2024-06-24T11:23:53.042000+00:00",
        "attachments": []
    },
    {
        "author": "0xunclebill",
        "category": "Consensus Layer",
        "parent": "",
        "content": "makes sense, thank you",
        "created_at": "2024-06-24T11:26:04.406000+00:00",
        "attachments": []
    },
    {
        "author": "nc1234",
        "category": "Consensus Layer",
        "parent": "",
        "content": "For this [endpoint](https://github.com/ethereum/keymanager-APIs/blob/f99e41560b0db7cb922baa3be52735d611280f8b/apis/graffiti.yaml#L2), how does each client handle the case that the queried validator has no graffiti? From the current description, what does \"process-wide default\" graffiti mean? Empty string? I know Lighthouse throws an error in this case. Wonder how other clients handle this",
        "created_at": "2024-06-24T13:10:48.124000+00:00",
        "attachments": []
    },
    {
        "author": "nc1234",
        "category": "Consensus Layer",
        "parent": "",
        "content": "Looks like teku is returning empty byte [here](https://github.com/Consensys/teku/blob/186989a9fc195d8f5ff236321195f789ed3866c4/validator/client/src/main/java/tech/pegasys/teku/validator/client/restapi/apis/GetGraffiti.java#L60)",
        "created_at": "2024-06-24T13:14:36.691000+00:00",
        "attachments": []
    },
    {
        "author": "0xunclebill",
        "category": "Consensus Layer",
        "parent": "",
        "content": "hmm lighthouse shouldn't be throwing an error for validators w/o graffiti. if it's actually doing that, then its a bug",
        "created_at": "2024-06-24T19:50:06.095000+00:00",
        "attachments": []
    },
    {
        "author": "nc1234",
        "category": "Consensus Layer",
        "parent": "",
        "content": "I think it throws error here https://github.com/sigp/lighthouse/blob/f1d88ba4b1256e084d3a2a547e0ce574b896246c/validator_client/src/http_api/graffiti.rs#L20-L22",
        "created_at": "2024-06-24T20:45:25.374000+00:00",
        "attachments": []
    },
    {
        "author": "0xunclebill",
        "category": "Consensus Layer",
        "parent": "",
        "content": "we allow users to set the graffiti on a per validator basis. if a LH validator doesn't have graffiti set, we default to the graffiti set on the beacon node. this is what we consider the process wide default. users can set the process wide default to whatever they want. if no graffiti is set by the user on the BN, we default to the current LH version and commit (truncated to 32 bytes)\n\nheres the snippet of code that does that\nhttps://github.com/sigp/lighthouse/blob/stable/beacon_node/src/config.rs#L589-L597\n\nthe code you shared would only raise an error if somehow the default graffiti flag wasn't set on startup, which would be a bug.",
        "created_at": "2024-06-24T21:16:34.159000+00:00",
        "attachments": []
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "but how do you handle the case where there is no graffiti set for validator and validator client has no global graffiti set either? The VC odes not know the graffiti in that case",
        "created_at": "2024-06-24T21:30:38.078000+00:00",
        "attachments": []
    },
    {
        "author": "0xunclebill",
        "category": "Consensus Layer",
        "parent": "",
        "content": "ah yeah i was looking at the bn and not the validator client... it seems LH isnt setting a process wide default on the validator client which seems wrong. i'll ask the team about it",
        "created_at": "2024-06-24T21:46:17.765000+00:00",
        "attachments": []
    },
    {
        "author": "nflaig",
        "category": "Consensus Layer",
        "parent": "",
        "content": "depending on how you implement https://github.com/ethereum/execution-apis/pull/517 you can't set a default on vc side as it wouldn't be possible to differentiate if it was user-provided or not on bn when produng block as both would be passed as query.",
        "created_at": "2024-06-24T21:51:53.540000+00:00",
        "attachments": []
    },
    {
        "author": "0xunclebill",
        "category": "Consensus Layer",
        "parent": "",
        "content": "yeah thats a good point. we'd probably want to fallback to the bn default as it might expose info about the execution client as well.",
        "created_at": "2024-06-24T22:04:53.631000+00:00",
        "attachments": []
    }
]