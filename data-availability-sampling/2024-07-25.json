[
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003c@520034910149410861\u003e \u003c@964433541813375036\u003e I looked into it after our meeting, and the formula to estimate the gossipsub data amount for relaying a message of size `S` is roughly `T = S*D + S*R`, where `D` is a protocol parameter of gossipsub, and `R` is the number of additional retransmissions generated by `IHAVE`/`IWANT` messages. We can determine `mean(R)` on a CL node by measurements.",
        "created_at": "2024-07-25T08:44:53.784000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "the default `D` is 6",
        "created_at": "2024-07-25T08:45:28.104000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I thought you were talking about the overhead due to the high number of gossipsub topics.",
        "created_at": "2024-07-25T08:50:25.789000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "For the value `R`, ProbeLab received a grant to measure various GossipSub metrics in the mainnet. They published a series of ethresearch posts. https://www.notion.so/probelab/ProbeLab-GossipSub-Monitoring-Metrics-00f30152166a41d6a7e3facbbaf05287",
        "created_at": "2024-07-25T08:52:33.802000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "https://ethresear.ch/t/gossip-iwant-ihave-effectiveness-in-ethereums-gossipsusb-network/19686\nhttps://ethresear.ch/t/number-duplicate-messages-in-ethereums-gossipsub-network/19921\nare probably the ones to look at.",
        "created_at": "2024-07-25T08:53:32.673000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I checked and it looks like R = 3 is a good estimate?",
        "created_at": "2024-07-25T09:00:47.692000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "From this post https://ethresear.ch/t/gossip-iwant-ihave-effectiveness-in-ethereums-gossipsusb-network/19686, the number of msg ids in IWANTs is low compared to the number of msg ids in IHAVEs, so I think `R` should be low as well.",
        "created_at": "2024-07-25T09:01:01.925000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "so let's assume 3 for now",
        "created_at": "2024-07-25T09:01:27.375000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "In Ethereum, `D` is 8. See https://github.com/ethereum/consensus-specs/blob/dev/specs/phase0/p2p-interface.md?plain=1#L240",
        "created_at": "2024-07-25T09:06:05.852000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "thanks!",
        "created_at": "2024-07-25T09:06:19.133000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Where did you get 3? That seems high. Did you get it from https://ethresear.ch/t/number-duplicate-messages-in-ethereums-gossipsub-network/19921#expected-results-3 ? \n```\nStudy Description: Gossipsub’s design is inherently allowing for message duplicates. A brief model we develop shows that it’s normal to receive each message up to 3 extra times (as a duplicate). This excludes the gossip mechanism which propagates messages through the IHAVE/IWANT control message sequence.\n```\nIt seems that you have only 3 duplicates even if the degree is 8 and this excludes the IHAVE/IWANT (which is `R`). I haven't read the blog post yet. I will do soon.",
        "created_at": "2024-07-25T09:10:32.403000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "So my understanding of gossipsub (from the perspective of a single node) is: the data will initially be published to `D` peers. Then the message ID will be published in heartbeat messages and requested for fetching by peers who have not received it. The number of these late transmissions is `R`.",
        "created_at": "2024-07-25T09:13:24.705000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "What they mean by 'duplicate' is the number of times the message is **received** by any single node.",
        "created_at": "2024-07-25T09:15:06.570000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "But I am trying to estimate the number of times the message will be **sent**.",
        "created_at": "2024-07-25T09:15:34.761000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "The expected number of times the message is **sent** should be the same as the expected number of times the message is **received**, right? because when you send, someone receives.",
        "created_at": "2024-07-25T09:20:10.321000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "yeah that's fair",
        "created_at": "2024-07-25T09:22:22.328000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "so that formula kind of computes the worst case.",
        "created_at": "2024-07-25T09:23:05.141000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "the initial publisher of the data likely will not get the benefit of deduplication, so they will need to transmit it more times than the average node",
        "created_at": "2024-07-25T09:23:49.182000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "anyway, so the whole point of trying to figure out this estimate, is that I was curious about the bandwidth requirements for DAS publishing of columns",
        "created_at": "2024-07-25T09:31:30.778000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "When \u003c@415548822983278593\u003e made that comparison \"the load on a supernode in PeerDAS will be roughtly equal to that of a node handling a worst case block\", I just felt like it should be explored more",
        "created_at": "2024-07-25T09:33:21.538000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003e so that formula kind of computes the worst case.\nI don't think so. That looks like a normal average case.",
        "created_at": "2024-07-25T09:34:17.890000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "but then it doesn't match up with measurements at all",
        "created_at": "2024-07-25T09:34:38.404000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "(with `D = 8`)",
        "created_at": "2024-07-25T09:35:33.255000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I'm not surprised with the number 3 because when the degree is D, on average you will receive D/2 copies and forward the message to another D/2 peers who will not send the messages back to you. So 3 is close to D/2=4",
        "created_at": "2024-07-25T09:36:16.138000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "(i'm reading how they come up with the number 3)",
        "created_at": "2024-07-25T09:36:36.058000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "yes.",
        "created_at": "2024-07-25T09:36:42.294000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "but when you are the initial node, you will send the message 8 times?",
        "created_at": "2024-07-25T09:37:17.618000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "isn't that what you are required to do?",
        "created_at": "2024-07-25T09:37:27.762000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yes",
        "created_at": "2024-07-25T09:37:37.633000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "so that is more than 3",
        "created_at": "2024-07-25T09:37:48.138000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "anyway",
        "created_at": "2024-07-25T09:38:09.915000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I think we have a better understanding now.",
        "created_at": "2024-07-25T09:38:25.197000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "3 is the number of copies you will receive or send on average, not just the initial node.",
        "created_at": "2024-07-25T09:38:47.814000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "yes",
        "created_at": "2024-07-25T09:38:53.646000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "but I was curious to know the traffic requirement of the initial node, i.e. the block builder",
        "created_at": "2024-07-25T09:39:12.239000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003e anyway, so the whole point of trying to figure out this estimate, is that I was curious about the bandwidth requirements for DAS publishing of columns\n\nWhat we usually do is to just do `D*S` and ignore the `R*S` part, because I think it's negligible.",
        "created_at": "2024-07-25T09:40:57.445000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "ok",
        "created_at": "2024-07-25T09:42:12.010000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "it is there though, and I am pretty sure `R \u003e 1` on the initial node",
        "created_at": "2024-07-25T09:42:43.402000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "when the message size is large, it is not negligible",
        "created_at": "2024-07-25T09:43:02.124000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "The heartbeat interval is 0.7 second. See https://github.com/ethereum/consensus-specs/blob/dev/specs/phase0/p2p-interface.md?plain=1#L244.\nIf all the peers of the block builder receive the message in 0.7 second, `R` will be zero.",
        "created_at": "2024-07-25T09:44:07.572000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "let's maybe move onto another topic",
        "created_at": "2024-07-25T09:44:52.707000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "So in the call, there was this interesting question whether publishing shards of a message (i.e. columns) across 128 gossip subnets will have a higher overhead than publishing a single large message (i.e. block) within one subnet.",
        "created_at": "2024-07-25T09:46:20.921000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "It is true that the overhead is equal if we consider the message to be split up exactly.",
        "created_at": "2024-07-25T09:46:54.001000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "However, each message shard will have to be tagged with an identifier (slot number + hash), so there will be a bit of extra overhead per message.",
        "created_at": "2024-07-25T09:48:07.313000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "\u003e So in the call, there was this interesting question whether publishing shards of a message (i.e. columns) across 128 gossip subnets will have a higher overhead than publishing a single large message (i.e. block) within one subnet.\n\nWe have done research on this already while doing EIP-4844. Of course, the overhead of the former is higher (which I think is negligible). The messages are certainly propagated faster in the former than the latter. That's why each blob in 4844 has a dedicated GossipSub topic and the blobs are not sent in a single topic. This PR https://github.com/ethereum/consensus-specs/pull/3244",
        "created_at": "2024-07-25T09:53:12.226000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "The intuition behind that is if you use multiple topics, you will have multiple paths to the entire network and can utilize the bandwidth better.",
        "created_at": "2024-07-25T09:54:02.855000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "The intuition is not 100% convincing, but we did the simulation to confirm that.",
        "created_at": "2024-07-25T09:54:31.586000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yeah it's a good result",
        "created_at": "2024-07-25T09:57:18.966000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Another question",
        "created_at": "2024-07-25T10:00:17.751000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "The current PeerDAS proposal requires the block builder to publish columns to all subnets, right?",
        "created_at": "2024-07-25T10:00:56.611000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "So does this mean block building nodes must be supernodes?",
        "created_at": "2024-07-25T10:01:09.783000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yes",
        "created_at": "2024-07-25T10:01:23.530000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "But how can 'home stakers' (as they were referred in the meeting) even exist in that model?",
        "created_at": "2024-07-25T10:01:50.396000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "PBS is not implemented at this time",
        "created_at": "2024-07-25T10:02:01.060000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "So the only option for 'home stakers' will be signing blocks created by an external relay, such as mev-boost",
        "created_at": "2024-07-25T10:02:20.740000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "And they cannot even publish the block, just attest.",
        "created_at": "2024-07-25T10:02:40.589000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "That's what I think. Maybe someone else has a better answer, but I think that's the answer.",
        "created_at": "2024-07-25T10:03:18.679000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I think the PeerDAS is not ready for inclusion in a fork, given these constraints.",
        "created_at": "2024-07-25T10:04:35.605000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "It seems rushed.",
        "created_at": "2024-07-25T10:05:52.901000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I think the long-term vision is that eventually 'home stakers' cannot build the block otherwise it would be too hard to design the protocol.",
        "created_at": "2024-07-25T10:08:35.409000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I understand",
        "created_at": "2024-07-25T10:09:19.101000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Certainly, block building requires high resources. And PBS is being developed to allow decoupling building from the validator role. However, it is not yet decoupled.",
        "created_at": "2024-07-25T10:10:09.835000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "And feels a bit wrong to just raise the networking requirements so high for everyone.",
        "created_at": "2024-07-25T10:10:44.037000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Anyway, I think it is too much of a philosophical discussion for this channel here.",
        "created_at": "2024-07-25T10:11:00.930000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "peerDAS doesn't change the current blob count though, so the the load on a proposer will be the same now as it will be with peerDAS to publish the respective columns. Block building can still be done locally",
        "created_at": "2024-07-25T10:13:14.638000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "We will increase the blob count in PeerDAS eventually. Otherwise, there is no point to do it.",
        "created_at": "2024-07-25T10:14:24.214000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yes that is a question of when we increase the blob count which is a separate concern from peerDAS",
        "created_at": "2024-07-25T10:14:58.331000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I think before we launch PeerDAS, so the increase will be shipped with PeerDAS.",
        "created_at": "2024-07-25T10:15:55.313000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Even if we increase to 4/8 it is still feasible for home stakers especially with michael's proposal to utilize the execution mempool",
        "created_at": "2024-07-25T10:18:10.164000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I heard that the increase will be x4. Not sure about that.",
        "created_at": "2024-07-25T10:18:44.509000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Imho we would want a bigger increase than from 3 to 4, at least by 2-4x",
        "created_at": "2024-07-25T10:18:55.619000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "What I mentioned was that this is the factor by which we can increase it while roughly keeping bandwidth consumption the same, if we do PeerDAS with only distribution and no sampling yet (say with custody = 16, 128 subnets)",
        "created_at": "2024-07-25T10:19:50.650000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yeah, we should go to the highest number while keeping the bandwidth consumption the same.",
        "created_at": "2024-07-25T10:20:46.259000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "It doesn't mean that this is what we have to do, but we have up to that much room when it comes to blob propagation. Of course that's not the case for block proposing, where all columns need to be published, but we are still not talking about crazy increases",
        "created_at": "2024-07-25T10:21:02.106000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "There are a few optimizations that can be done which would help a lot, this is one of them:\nhttps://github.com/ethereum/execution-apis/pull/559",
        "created_at": "2024-07-25T10:22:50.518000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "For me it's also a question of networking.",
        "created_at": "2024-07-25T10:22:55.901000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "you could theoretically just publish the block with only the commitments for a home staker doing local building",
        "created_at": "2024-07-25T10:23:17.779000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "You need peers in all subnets to publish a block",
        "created_at": "2024-07-25T10:23:22.819000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "It's not inherently bad, just something to take note",
        "created_at": "2024-07-25T10:23:45.067000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I think it kind of eats up the benefit of trying to optimize for subnet participation",
        "created_at": "2024-07-25T10:24:06.282000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "All nodes in PeerDAS need peers in all subnets, not just the block builder.",
        "created_at": "2024-07-25T10:24:32.369000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Since any validator can be selected for block building, it kind of means all validators need to be in all subnets.",
        "created_at": "2024-07-25T10:24:34.496000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "But we were talking about trying to somehow optimize the subnet participation?",
        "created_at": "2024-07-25T10:25:00.479000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Like, you guys had the idea to assign the subnets based on node ID, and possibly the validator address?",
        "created_at": "2024-07-25T10:25:33.865000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "By default you would have peers which are in all the column subnets, unless something is very wrong with discovery",
        "created_at": "2024-07-25T10:25:51.204000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "But what use is that when you have to participate in all subnets anyway?",
        "created_at": "2024-07-25T10:25:52.591000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "But someone has to send the blobs anyway",
        "created_at": "2024-07-25T10:26:05.702000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "you don't participate in it, just publish the message in that subnet",
        "created_at": "2024-07-25T10:26:25.455000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "ahh so you wouldn't be forwarding?",
        "created_at": "2024-07-25T10:26:47.598000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "yeah a supernode would reconstruct the columns from all the blobs",
        "created_at": "2024-07-25T10:26:48.481000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "no, just publishing it",
        "created_at": "2024-07-25T10:27:01.073000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "its the same for attestation subnets currently",
        "created_at": "2024-07-25T10:27:10.827000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "isn't it a bit like breaching protocol? does gossipsub allow for such participation?",
        "created_at": "2024-07-25T10:27:33.272000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yes, it's called fan-out",
        "created_at": "2024-07-25T10:28:42.519000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "gossipsub does allow for this to happen",
        "created_at": "2024-07-25T10:28:45.621000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "you don't have to be in that peer's mesh in order to send them a message",
        "created_at": "2024-07-25T10:29:18.349000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "ok",
        "created_at": "2024-07-25T10:30:33.057000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Tangentially related to this is also the fact that blob data is duplicated both in consensus and execution:\nhttps://github.com/ethereum/execution-apis/pull/559\n\nIts not an issue now, but I imagine with higher blob counts this could be a lot more problematic.",
        "created_at": "2024-07-25T10:32:32.801000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Yeah, we talked about this today in a Geth call as well",
        "created_at": "2024-07-25T10:33:35.213000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "It's cool to reduce to the bandwidth requirements for CL nodes with PeerDAS, but if that leads to a larger blob limit, the blob mempool traffic will also increase.",
        "created_at": "2024-07-25T10:34:21.902000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "So we won't be gaining much",
        "created_at": "2024-07-25T10:34:34.668000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Anyway, I fully support that change to add `getBlobsV1` if it's wanted",
        "created_at": "2024-07-25T10:35:15.848000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Very easy to implement",
        "created_at": "2024-07-25T10:35:24.696000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "We could look into a sharded mempool design in the future",
        "created_at": "2024-07-25T10:35:49.773000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "That would be very welcome, also allows block processing to be much quicker for consensus nodes",
        "created_at": "2024-07-25T10:35:57.602000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "It's worse only for block builders I think.",
        "created_at": "2024-07-25T10:35:57.794000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "but all full nodes are expected to participate in tx relay",
        "created_at": "2024-07-25T10:36:13.703000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "yeah, it affects all nodes",
        "created_at": "2024-07-25T10:36:23.360000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "the system doesn't really work otherwise",
        "created_at": "2024-07-25T10:36:31.147000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I think sharded mempool is a hot topic, especially for blobs",
        "created_at": "2024-07-25T10:36:46.956000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "we implemented a disk-backed mempool for blob txs in geth, specifically so that the storage capacity of the mempool is effectively unbounded",
        "created_at": "2024-07-25T10:37:23.047000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "this means we could arbitrarily throttle the relay traffic",
        "created_at": "2024-07-25T10:37:44.391000+00:00",
        "attachments": null
    },
    {
        "author": "popef",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I don't get it. Why? Full nodes get the transactions from beacon blocks, right?",
        "created_at": "2024-07-25T10:38:11.120000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "in order to validate the relayed transactions, you need access to other pending transactions",
        "created_at": "2024-07-25T10:38:59.820000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "you can imagine the tx relay to be like gossipsub, but with a very complicated filtering/validation function",
        "created_at": "2024-07-25T10:39:23.375000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "theoretically, we could remove tx relay from full nodes",
        "created_at": "2024-07-25T10:39:41.952000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "however in practice, there are a few reasons not to do this:\n\n- people generally want access to pending transactions. If we added the option to remove txpool, many user-accessible functions of the client would be impacted.\n- most full nodes have a validator, and it's not automatically known whether a node instance is being used for validating or not\n- the p2p network does not distinguish validator/builder nodes from others",
        "created_at": "2024-07-25T10:41:14.021000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I think the solution to this will be a sharded mempool for blob transactions",
        "created_at": "2024-07-25T10:49:10.902000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "How would that work in practice ?",
        "created_at": "2024-07-25T10:49:44.838000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "The blobpool is already structured around accounts. So maybe we could split up the network into a number of shards based on the sender address. When a block is requested for building, we'd just apply transactions from the locally known accounts.",
        "created_at": "2024-07-25T10:52:53.586000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "There are no dependencies between txs across accounts, the only requirement is the nonce must increase.",
        "created_at": "2024-07-25T10:53:30.755000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Since builders are selected at random, it follows that shards of the mempool will also be selected at random.",
        "created_at": "2024-07-25T10:54:03.566000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "So if you see a tx announcement from a sender address that is not in your local shard , you would not relay it in that case and just ignore it ? In that case a normal node would not have a full view of all the blob txs in the network unless they explicitly opt into it (via a flag , etc)",
        "created_at": "2024-07-25T10:56:03.390000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "yes that's what I mean",
        "created_at": "2024-07-25T10:56:16.540000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "I am not saying this should be added now, just that it could be a measure to deal with the increased traffic in the future.",
        "created_at": "2024-07-25T10:56:40.808000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "It's not a fully built proposal, just a quick idea",
        "created_at": "2024-07-25T10:57:05.673000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "That seems reasonable to me",
        "created_at": "2024-07-25T10:57:36.340000+00:00",
        "attachments": null
    },
    {
        "author": "hsiaowei",
        "category": "Consensus R\u0026D",
        "parent": "",
        "content": "Sorry for the delay. Video is here: https://youtu.be/Rqd_DuPQMvg",
        "created_at": "2024-07-25T12:43:31.099000+00:00",
        "attachments": null
    }
]