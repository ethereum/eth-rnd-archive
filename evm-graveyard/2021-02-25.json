[
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thoughts on removing `tx.origin` as part of the graveyard cleanup?  Are there any legitimate uses of it, or is it just used by people who have poorly designed mechanisms that want to limit the set of people who can attack their system to \"miners\"?",
        "created_at": "2021-02-25T04:41:27.328000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Maybe \u003c@619357961923330051\u003e has something, since you seem to have a knack for coming up with semi-legitimate uses for all of the worst EVM features.  ðŸ˜¬",
        "created_at": "2021-02-25T04:42:28.834000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it's the only way to reliably restrict contract calls to EOAs.",
        "created_at": "2021-02-25T16:11:14.608000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`require(msg.sender == tx.origin)` is widely deployed",
        "created_at": "2021-02-25T16:11:35.638000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What is a *legitimate* reason for wanting to do that?",
        "created_at": "2021-02-25T16:11:58.442000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Is there a real case for restricting calls to only EOAs beyond security theatre?",
        "created_at": "2021-02-25T16:12:01.320000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I believe the other is \"saves a bit of gas on event emission\" for rollup type stuff.",
        "created_at": "2021-02-25T16:12:23.438000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "FWIW, that gas *can* get a bit expensive for calls with a lot of attached data.",
        "created_at": "2021-02-25T16:13:17.533000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm not convinced it is worth retaining \"EOA only\" mechanics for on its own though.",
        "created_at": "2021-02-25T16:13:37.120000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "why is it useful for rollups?",
        "created_at": "2021-02-25T16:13:55.589000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "what are \"legitimate\" and \"real\" use cases?",
        "created_at": "2021-02-25T16:15:36.604000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "we can objectively say that it's widely deployed. clearly many devs want to deploy these use cases",
        "created_at": "2021-02-25T16:16:08.240000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "A rollup client needs to look for all calls to the rollup contract so it can collect transactions to roll up.  This means that either all rollup transactions submitted to mainnet need to be fired as an event (which can be watched for), or all rollup transactions need to be submitted *directly* to the contract by an EOA, or the rollup chain needs to trace every transaction looking for subcalls.",
        "created_at": "2021-02-25T16:16:12.054000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There are *many* things that are deployed to mainnet that are good for dapp developers and bad for their users.",
        "created_at": "2021-02-25T16:16:34.355000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "As core devs, IMO we should generally prefer protecting users over protecting dapp interests.",
        "created_at": "2021-02-25T16:17:02.406000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yep I follow that on rollups, but why tx.origin? can't smart contracts also post transactions on the rollup contract?",
        "created_at": "2021-02-25T16:17:08.236000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So when an opcode is *only* used in a way that is dangerous to users (because they are not security experts), it doesn't bother me if a change to it breaks some apps that ignored all of the security advise saying \"don't do this!\"",
        "created_at": "2021-02-25T16:17:52.994000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I've never heard a compelling case for `require(msg.sender == tx.origin)` but I'm very open to listening if anyone has one. (and saying devs are using it isn't compelling for me)",
        "created_at": "2021-02-25T16:18:22.187000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "sure but this particular case is a little of a \"fake feature\", because anything that you can do with contracts you can also do it with EOAs (if you are a miner)",
        "created_at": "2021-02-25T16:18:29.319000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This is precisely the problem.  If you allow calls to a rollup from contracts, then the rollup client can no longer just look at top level calls (which are easily inspectible as they are part of the block body).  To find that call they need to search the call tree (via a transaction trace) for the call (assuming events aren't emitted with the entire calldata contents).",
        "created_at": "2021-02-25T16:19:00.634000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "many pooling contracts are using it to e.g., flag things for human review. this is good for both devs and users",
        "created_at": "2021-02-25T16:20:15.119000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ohh that's interesting, it would meant the rollups is practically running an eth light client instead of using the information on the rollup contract, a little hacky but fair enough",
        "created_at": "2021-02-25T16:20:15.999000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There was a \"puzzle\" contract a while ago that had a nice `require(msg.sender != tx.origin)` so that you had to proxy your interaction to solve it.  that was fun...",
        "created_at": "2021-02-25T16:20:23.830000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "humans can use smart contracts and bots can use eoas",
        "created_at": "2021-02-25T16:21:01.220000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think most rollups don't store the transaction on-chain, it is too expensive.",
        "created_at": "2021-02-25T16:21:07.286000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Can you explain how this works?  I'm not familiar with it.",
        "created_at": "2021-02-25T16:21:29.287000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Log an event with the contract caller's address so that a human can choose whether to add it to an administrative blocklist, but bypass both the log and the blocklist check if it's an EOA. This represents a commitment from devs to users that they cannot block EOAs",
        "created_at": "2021-02-25T16:22:27.019000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "what about storing or emitting a hash of the transaction?",
        "created_at": "2021-02-25T16:22:36.138000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This is a bit of a reductive position. Smart contracts exist to resolve n-party coordination problems by committing to specific behaviors by all parties. A miner can definitely _not_ do that",
        "created_at": "2021-02-25T16:29:07.728000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "another in-the-wild usecase:\n- prevent a YFI-style vault from farming your yield farm. A miner certainly can't achieve the same result as a YFI vault, and it is legitimate to want to slow roll your rewards to EOAs",
        "created_at": "2021-02-25T16:29:58.051000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "rollups must store txs onchain, otherwise it isn't a rollup (they usually do as calldata though and merklize the calldata to put in storage)",
        "created_at": "2021-02-25T16:30:24.720000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That's true",
        "created_at": "2021-02-25T16:32:29.257000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sorry, I should have been more clear.  Most rollups don't store transactions in state.",
        "created_at": "2021-02-25T16:32:44.703000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This contributes to the \"contract wallets are not widely supported\" problem we have that is hurting contract wallet acceptance.",
        "created_at": "2021-02-25T16:34:01.105000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I wonder how account abstraction plays with that kind of assumptions, because even today assuming 1 EOA = 1 party is not really safe",
        "created_at": "2021-02-25T16:34:12.677000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And contract wallets not being supported drive users to use EOAs, which cannot be as secure as contract wallets.",
        "created_at": "2021-02-25T16:34:17.933000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yeah, it's not safe as a map for 1 human. but it is the only reliable indicator of \"not a contract\"",
        "created_at": "2021-02-25T16:35:23.491000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "all other indicators can be trivially evaded",
        "created_at": "2021-02-25T16:35:39.586000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We actively *don't* want to support \"not a contract\" behaviors.",
        "created_at": "2021-02-25T16:35:45.478000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Because we actively *want* people to be able to use contract wallets everywhere.",
        "created_at": "2021-02-25T16:35:56.317000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Account Abstraction being the canonical example of that desire fulfilled.",
        "created_at": "2021-02-25T16:36:07.971000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "but dapp devs do want not-a-contract behaviors. we can see that they are widely deployed in systems that handle 9-10 figures",
        "created_at": "2021-02-25T16:36:45.879000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm not arguing against contract wallets or abstraction. I'm arguing that delegitimizing dev decisions is maybe not the right way to approach this change",
        "created_at": "2021-02-25T16:37:45.994000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I can definitely appreciate the argument that this is a somewhat opinionated change.",
        "created_at": "2021-02-25T16:38:29.588000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://github.com/harvest-finance/harvest/blob/93128a550de5c9326319098d6e7ffddc9acfc0eb/contracts/AutoStake.sol#L49-L59",
        "created_at": "2021-02-25T16:40:02.078000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I believe we can safely assert that contract wallets *can* be more secure than EOAs.  If we see dapps routinely making choices that hurt user security or prevent users from behaving securely, and we can make a change to the protocol that takes away that power of choice from dapps, I don't think it is unreasonable to make such a choice.",
        "created_at": "2021-02-25T16:40:09.590000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think the implicit assumption there is that EOA-gating is a significant factor in smart contract wallet adoption. Doesn't seem like an accurate assumption",
        "created_at": "2021-02-25T16:41:53.580000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If you're interested in convincing users to use smart contract wallets, you should probably focus on making them cheaper to deploy and cheaper + easier to interact with.",
        "created_at": "2021-02-25T16:42:12.168000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I've been using smart contract wallets since Mist. The main reason I choose to avoid them is that they add operational overhead and expense, not compatibility with apps",
        "created_at": "2021-02-25T16:42:57.891000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Have we done any market research about why people don't use smart contract wallets?",
        "created_at": "2021-02-25T16:44:04.125000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If we assume those are the first barriers to contract adoption (likely true!), we'll still run into the barrier of dapps not supporting contracts once be bust through those.",
        "created_at": "2021-02-25T16:47:31.979000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "this seems like a problem that gets solved when users ask devs why they can't use the application",
        "created_at": "2021-02-25T16:51:04.545000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "as a side note, the harvest use case does not break smart contract wallets",
        "created_at": "2021-02-25T16:53:58.871000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The hardvest use case can be bypased by spawning child contracts, right?",
        "created_at": "2021-02-25T16:55:02.987000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the harvest use case is \"flag potentially problematic behavior for dev response\"",
        "created_at": "2021-02-25T16:56:02.458000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I get what's your point, but I still think this is a big anti-pattern",
        "created_at": "2021-02-25T16:56:03.125000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "you don't need on-chain tools to raise flags to a dev team, you just need a node an a script",
        "created_at": "2021-02-25T16:56:26.223000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is essentially a gas optimization of a node script.  ðŸ™‚",
        "created_at": "2021-02-25T17:01:26.359000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the commitment to users that they can't be blocked is also important",
        "created_at": "2021-02-25T17:02:41.477000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yes but they only have to do that because they are adding a bunch of \"fake protections\", that's why imho is an anti-pattern",
        "created_at": "2021-02-25T17:03:46.953000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Contract wallet users get no such guarantees.  ðŸ˜¢",
        "created_at": "2021-02-25T17:04:13.696000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "if a contract wants to farm on harvest, it can do it, it's a little harder but nothing else, and it causes a bunch of problems along the way",
        "created_at": "2021-02-25T17:04:21.700000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that's not quite right. they bear the expense of deploying a new contract at each interaction",
        "created_at": "2021-02-25T18:36:43.241000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ephemeral proxy contracts can be very cheap, 100k gas or less",
        "created_at": "2021-02-25T18:42:16.793000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that's $30",
        "created_at": "2021-02-25T18:56:05.566000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Im a bit surprised it is 100k.",
        "created_at": "2021-02-25T18:57:30.498000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I am not saying it's free, I am just saying it can be done and well, if you need to create 100 proxies in the process it's only 3000... if that's what it takes to break the app then it's an anti-pattern.",
        "created_at": "2021-02-25T19:02:17.605000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yep, depending on the context you can use very tiny proxies, I am basing the 100k figure off the pine finance proxies, but it depends https://github.com/pine-finance/contracts-v2/blob/optional-fee/contracts/libs/Fabric.sol",
        "created_at": "2021-02-25T19:04:10.543000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "well, my point is that one of the main barriers to user adoption of smart contract wallets is \"spending $30.\" and that \"spending $30 100 times without guarantee of return\" is a useful barrier to abuse. you're arguing to remove the barrier to abuse, without removing the barrier to user adoption",
        "created_at": "2021-02-25T19:06:48.217000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The barrier to adoption is solved by different people, and can be solved in parallel, before, or after breaking tx.origin.",
        "created_at": "2021-02-25T19:07:53.050000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "also, I think you're misreading the harvest blocklist functionality when you say that it can be evaded by making proxies ðŸ¤”",
        "created_at": "2021-02-25T19:08:01.406000+00:00",
        "attachments": null
    },
    {
        "author": "agusx1211",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "to be clear, I am not arguing for removing the opcode, IMHO we should always keep retro-compatibility as long as it's possible. My argument is that I've never seen tx.origin being used outside an anti-pattern.",
        "created_at": "2021-02-25T19:08:56.580000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "then we agree that contract wallet adoption issues are generally unrelated to `tx.origin`?",
        "created_at": "2021-02-25T19:11:34.120000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "then we're actually arguing about what is an anti-pattern. and we will likely not agree on that",
        "created_at": "2021-02-25T19:13:03.259000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I believe that contracts blocking contract callers is another barrier to adoption that we'll run into after the current barriers, but I do agree that the current barriers dwarf that by quite a bit.",
        "created_at": "2021-02-25T19:48:24.870000+00:00",
        "attachments": null
    }
]