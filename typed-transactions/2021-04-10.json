[
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!301186049323958275\u003e I have updated the eth wire protocol spec with EIP-2718",
        "created_at": "2021-04-10T10:04:30.205000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Please review it: https://github.com/ethereum/devp2p/pull/177",
        "created_at": "2021-04-10T10:04:34.212000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "maybe also interesting for \u003c@!543900561460822016\u003e because he asked for this",
        "created_at": "2021-04-10T10:05:25.451000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@194432762315407360\u003e This doesn't align with https://eips.ethereum.org/EIPS/eip-2976, I'm not sure if intentional or not.",
        "created_at": "2021-04-10T10:11:00.064000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "According to 2976, `typed-tx = rlp(tx-type || tx-data)` should be `typed-tx = tx-type || tx-data`",
        "created_at": "2021-04-10T10:11:56.430000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But we've been over this, it is not possible to include non-RLP in RLP",
        "created_at": "2021-04-10T10:12:20.674000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There is no RLP list encoding here, it is just a byte array (which may later be included in an RLP list or SSZ, or whatever).",
        "created_at": "2021-04-10T10:12:22.815000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The way I have documented it is the way we have implemented it in all clients",
        "created_at": "2021-04-10T10:12:43.846000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`rlp([tx, tx, tx])` is fine for the higher level protocol.",
        "created_at": "2021-04-10T10:12:48.020000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But individual transactions are never RLP encoded in isolation.",
        "created_at": "2021-04-10T10:13:02.660000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "A transaction is *just a byte array* for the networking protocol.",
        "created_at": "2021-04-10T10:13:27.967000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, and this is how it is documented in the spec right now",
        "created_at": "2021-04-10T10:13:39.962000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The spec says that typed transactions are RLP byte arrays",
        "created_at": "2021-04-10T10:13:52.924000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Since the networking protocol puts these byte arrays into lists, they end up getting RLP encoded *as a side effect of being in an RLP list*.",
        "created_at": "2021-04-10T10:13:54.423000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Perhaps we are saying the same thing and I am just confused by the language used in the spec?  ðŸ¤”",
        "created_at": "2021-04-10T10:14:26.136000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, we just have different understanding of the notation",
        "created_at": "2021-04-10T10:14:39.495000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I will write a meta-spec for this RLP notation at some point",
        "created_at": "2021-04-10T10:14:52.166000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But we mean the same thing",
        "created_at": "2021-04-10T10:15:09.384000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "typed transactions in RLP are byte arrays",
        "created_at": "2021-04-10T10:15:23.031000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "IIUC, the idea is that since `rlp([a, b, c])` (where a, b, and c are byte arrays) is identical to `rlp([rlp(a), rlp(b), rlp(c)])`, in the spec you say that the list is of RLP encoded byte arrays?",
        "created_at": "2021-04-10T10:16:21.978000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I just put the `rlp(...)` because I don't want to mix the bytes concatenation `||` with the RLP notation",
        "created_at": "2021-04-10T10:17:03.500000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "let me check if we have precedent for this",
        "created_at": "2021-04-10T10:17:26.092000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm OK with removing the `rlp(...)` if you want",
        "created_at": "2021-04-10T10:17:36.081000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "just want it to be consistent",
        "created_at": "2021-04-10T10:17:44.813000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I also agree that consistency is king in this context.",
        "created_at": "2021-04-10T10:18:04.825000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My mild fear (not a hill I will die on at all) is that people will think that we should be RLP encoding typed transactions elsewhere if one of the specs says \"A typed transaction is `rlp(type || details)`\".",
        "created_at": "2021-04-10T10:18:50.030000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "While we do RLP encode typed transactions in some places, that is just a side effect of the higher level datastructures they are being stored in.",
        "created_at": "2021-04-10T10:19:11.841000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I get it",
        "created_at": "2021-04-10T10:19:19.468000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "looks like there is no precedent for this, it seems that for the last 5 years we have somehow managed to avoid specifying RLP structures where one of the byte arrays has a specific format",
        "created_at": "2021-04-10T10:21:36.394000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "BTW, this metalanguage consistency problem has been haunting me forever",
        "created_at": "2021-04-10T10:22:34.293000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Really need to formally specify it soon",
        "created_at": "2021-04-10T10:22:56.207000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think Gavin invented this notation like `[value: P, data: B, hash: B_32]`",
        "created_at": "2021-04-10T10:23:17.786000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it's not too bad, a lot of things can be described with that",
        "created_at": "2021-04-10T10:23:48.313000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "but it doesn't cover the case where the value is a byte array and you want to say what the internal format of it is",
        "created_at": "2021-04-10T10:24:52.274000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "in the other p2p specs, we use the bytes concatenation ( `||`)  and some pseudo-functions like `keccak256(...)` to formally describe binary data",
        "created_at": "2021-04-10T10:26:17.262000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "AFAIK no commonly-agreed notation has been invented for that, people just use whatever in specs",
        "created_at": "2021-04-10T10:27:42.284000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(more about this problem in https://github.com/ethereum/devp2p/issues/139)",
        "created_at": "2021-04-10T10:28:02.907000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Let me know if you find other inconsistencies in the PR",
        "created_at": "2021-04-10T10:28:30.897000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm a fan of writing specs in a common and easy to read programming language, ideally a statically typed one with a good type system.",
        "created_at": "2021-04-10T11:00:15.150000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Though, even that doesn't work great when you have things that are like \"a 3 byte unsigned integer\".",
        "created_at": "2021-04-10T11:01:20.001000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "SSZ can also be used for this in some cases, it's basically a language for describing binary data with some conventions added for variable size stuff",
        "created_at": "2021-04-10T11:04:07.558000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Anyway, let me know by Monday if you want something changed in the eth spec update",
        "created_at": "2021-04-10T11:04:24.626000+00:00",
        "attachments": []
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thanks for checking it so fast today",
        "created_at": "2021-04-10T11:04:30.009000+00:00",
        "attachments": []
    }
]