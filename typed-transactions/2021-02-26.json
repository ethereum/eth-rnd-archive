[
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Precompile can be called by an EOA.",
        "created_at": "2021-02-26T02:31:48.861000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "EOAs calling the precompile should be relatively rare though",
        "created_at": "2021-02-26T02:44:00.352000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I can imagine people using it to sponsor their own transactions.",
        "created_at": "2021-02-26T02:53:14.466000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "E.g., get airdrop tokens out of their own accounts and to sweep accounts and such.",
        "created_at": "2021-02-26T02:53:35.676000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Aight, so how likely are UNGAS or other gas unobservability type proposals?",
        "created_at": "2021-02-26T03:42:07.433000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Why does UNGAS matter?",
        "created_at": "2021-02-26T03:52:14.773000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "One of the changes suggested was returning the gas used for the call, that way even if UNGAS or something similar would come around and disable `GAS`, this particular use case would continue to work.",
        "created_at": "2021-02-26T04:10:38.008000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I do generally dislike planning an EIP around what _may_ come in the future though.",
        "created_at": "2021-02-26T04:11:49.771000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Which use case are you trying to solve for exactly?",
        "created_at": "2021-02-26T04:14:04.623000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The one where someone loops until they are out of gas?",
        "created_at": "2021-02-26T04:14:16.414000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah. Basically where you have to reserve gas so something can run after `CALL_PRECOMPILE`",
        "created_at": "2021-02-26T04:14:56.914000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That won't help you reserve gas I don't think?  It will just tell you that you ran out.",
        "created_at": "2021-02-26T04:22:46.480000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It's kind of a two part problem:\n\nYou need gas observability even if `GAS` is nerfed, so we return `usedgas`.\n\nThere is a lower bound guaranteed to be specified off-chain (with `mingas`), so it's safe to strictly set the gas sent with the transaction.",
        "created_at": "2021-02-26T04:24:33.780000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Doesn't the fact that you can limit gas provided to the call entirely solve the problem?",
        "created_at": "2021-02-26T04:25:03.054000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, but at least one (and I can't remember which) ungas-styled proposal changes CALL to always forward all gas.",
        "created_at": "2021-02-26T04:26:50.196000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It would just be safe to _not_ forward all gas because `mingas` is set off-chain",
        "created_at": "2021-02-26T04:28:04.981000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "@/vbuterin goes into it a little bit here: https://ethresear.ch/t/counter-proposal-to-oil-karma-per-account-gas-limits/7433",
        "created_at": "2021-02-26T04:30:43.070000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think I'm ambivalent.  If the options are \"return gas used\" vs \"return void\", then even though I don't care much about returning gas used, it seems pretty low cost.",
        "created_at": "2021-02-26T04:33:26.340000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Though, maybe it increases implementation complexity to return gas used?",
        "created_at": "2021-02-26T04:33:34.877000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Right now the returndata from `CALL_PRECOMPILE` is one byte (1 == success, 0 == failure), followed by the returndata from the callee.",
        "created_at": "2021-02-26T04:34:21.639000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Since there's already that one extra byte... I don't think I'd mind adding gas used.",
        "created_at": "2021-02-26T04:34:43.643000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What do you mean \"that one extra byte\"?",
        "created_at": "2021-02-26T04:39:22.564000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I forgot that in the EVM there are no exceptions, only returns.  That puts me pretty firmly into the \"don't return gas used\" camp.",
        "created_at": "2021-02-26T04:39:48.367000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The return data from `CALL_PRECOMPILE` is `SUCCESS || returndata(callee)`. The extra byte I'm referring to is `SUCCESS`.",
        "created_at": "2021-02-26T04:41:07.270000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So instead it would be `SUCCESS || GAS_USED || returndata(callee)`",
        "created_at": "2021-02-26T04:41:31.576000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`returndata(callee)` is done through memory I thought?",
        "created_at": "2021-02-26T04:41:36.046000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "All three are",
        "created_at": "2021-02-26T04:41:41.980000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "success/failure isn't done through the stack?",
        "created_at": "2021-02-26T04:41:53.577000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "success/failure of the precompile has to be separated from success/failure of the callee, no?",
        "created_at": "2021-02-26T04:42:12.129000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Why?",
        "created_at": "2021-02-26T04:42:26.863000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If the callee failed, it should increment whatever replay protection the invoker is using",
        "created_at": "2021-02-26T04:42:53.272000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Feels like it would be simpler to have the precompile revert on failure, which includes failure of the inner call (in which case it would propogate the revert).",
        "created_at": "2021-02-26T04:42:57.853000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That is up to the caller to do.",
        "created_at": "2021-02-26T04:43:12.243000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What is caller? Like the sponsor, or the invoker?",
        "created_at": "2021-02-26T04:43:44.257000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Invoker.",
        "created_at": "2021-02-26T04:43:48.727000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(or the sponsor, depends on how you have things setup I suppose)",
        "created_at": "2021-02-26T04:44:02.533000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, for sure. For this scenario there would have to be an invoker contract (because when sponsor == invoker, you don't have any replay protection for the sponsee)",
        "created_at": "2021-02-26T04:44:38.037000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Alright, so the callee reverts, but the sponsor still wants to deduct value from the sponsee's balance.",
        "created_at": "2021-02-26T04:45:18.371000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "How does the invoker know if the call reverted because of a bad signature, or because the inner call reverted?",
        "created_at": "2021-02-26T04:45:42.457000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(on a weird sidenode, discord seems to spike to 100% CPU usage when you type ðŸ¤£ )",
        "created_at": "2021-02-26T04:47:20.762000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It doesn't, and I don't think it needs to.",
        "created_at": "2021-02-26T04:47:22.522000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So you'd penalize the sponsor in that case?",
        "created_at": "2021-02-26T04:48:01.674000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Why would it penalize the sponsor?",
        "created_at": "2021-02-26T04:48:22.710000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sponsor sends the transaction-like package. `CALL_PRECOMPILE` fails, sponsor doesn't get funds.",
        "created_at": "2021-02-26T04:48:47.666000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I see, the idea is that the invoker may be withdrawing funds from the sponsee as a next step.",
        "created_at": "2021-02-26T04:49:28.445000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, or approving an ERC-20 or something.",
        "created_at": "2021-02-26T04:49:46.025000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I feel like this is a problem to be solved at a higher layer?",
        "created_at": "2021-02-26T04:49:54.994000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "By the time `CALL_PRECOMPILE` is called the invoker should be very confident it will not fail for malformed data reasons.",
        "created_at": "2021-02-26T04:50:21.507000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And the sponsee should not be using invokers that are malicious (e.g., that have the *ability* to send less than mingas or not forward value).",
        "created_at": "2021-02-26T04:50:49.632000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Won't that end up duplicating a lot of checks? Like two `BALANCE` checks, two ecrecovers, etc",
        "created_at": "2021-02-26T04:51:49.962000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`CALL_PRECOMPILE` failures should, IMO, be considered a programming error.",
        "created_at": "2021-02-26T04:51:52.119000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I suspect in most cases the invoker will blindly forward all attached value, not be chipping in some of its own, so it doesn't need to do any balance checks.",
        "created_at": "2021-02-26T04:52:40.424000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Signature validation is a fair argument though.",
        "created_at": "2021-02-26T04:52:56.173000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "How about this:  CALL_PRECOMPILE can have well defined revert reason codes, and when the callee reverts it can verify that the callee isn't trying to spoof one of its error codes (and if it is it will rewrite to CALL_PRECOMPILE error code).",
        "created_at": "2021-02-26T04:53:46.257000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Inside CALL_PRECOMPILE:\n```ts\nresult = call{from: signer, value: value}(data)\nif (result == false) {\n    if (returndata == BAD_SIG || returndata == WRONG_GAS || ...) {\n        revert(CALLEE_OVERLAPPED_REVERT_CODE)\n    } else {\n        revert(returndata)\n    }\n} else {\n    return(returndata)\n}\n```",
        "created_at": "2021-02-26T04:56:26.925000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(pseudocode of course)",
        "created_at": "2021-02-26T04:56:41.597000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Given page size for return data is 32 bytes, we can choose randomly selected values for revert reason constants such that the only way an overlap could occur is if the callee was maliciously trying to overlap.",
        "created_at": "2021-02-26T04:58:24.409000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Alternatively, we could do UTF-8 encoded reverts with something like `precompile error: xxxxxxxxxxxxxx` which again should only overlap with a callee revert reason if they are being malicious (strings have the nice property of being easier to debug).",
        "created_at": "2021-02-26T04:59:18.899000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You think that's significantly better than a constant one byte prefix?",
        "created_at": "2021-02-26T05:00:18.283000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm pretty against bitpacking.",
        "created_at": "2021-02-26T05:00:29.747000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It adds complexity that *everyone* needs to deal with and understand.",
        "created_at": "2021-02-26T05:00:43.781000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Revert reasons are something that every tool and dapp developer already \"gets\" so they'll do the right thing for free.",
        "created_at": "2021-02-26T05:01:04.577000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Revert reasons are already pretty complicated, but that's hidden in solidity.",
        "created_at": "2021-02-26T05:09:06.354000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(for some definition of complicated)",
        "created_at": "2021-02-26T05:09:30.538000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sure, but it is something that everyone already has to deal with (tools, users, contracts, etc.) and it is a well established/defined pattern.",
        "created_at": "2021-02-26T05:10:55.215000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I would want to see a pretty compelling argument to have a special one-off mechanism for dealing with call failures that doesn't align with the way *everything else* deals with failure.",
        "created_at": "2021-02-26T05:11:28.887000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I _think_ this is how GSN does it: https://github.com/opengsn/gsn/blob/9856bdd7b55a779452fa7f30eebe39ef36a7b411/contracts/RelayHub.sol#L212",
        "created_at": "2021-02-26T05:19:23.130000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, I'm not a fan of that (for the reasons above).",
        "created_at": "2021-02-26T05:22:03.977000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This is one reason to go for an opcode",
        "created_at": "2021-02-26T05:33:48.508000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Why does an opcode change things here?",
        "created_at": "2021-02-26T05:56:12.123000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "re: opcode vs precompile I would likely defer to client developers on this.  In my mental model of how I would build a client, precompiles are easier to add than opcodes, but that may be an inappropriate intuition.",
        "created_at": "2021-02-26T05:57:09.241000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "They're both fairly easy",
        "created_at": "2021-02-26T06:05:11.801000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But a precompile can only return one boolean plus a blob of bytes, where an opcode can push multiple values.",
        "created_at": "2021-02-26T06:05:44.052000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "As mentioned above, I don't care much about that benefit.  ðŸ™‚",
        "created_at": "2021-02-26T06:07:16.925000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Not having to deal with delegatecall as \u003c@543900561460822016\u003e mentioned above would be nice though.",
        "created_at": "2021-02-26T06:07:54.317000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Delegatecall isn't much of a problem, really. You can just treat it as a regular call like the other precompiles.",
        "created_at": "2021-02-26T06:08:32.531000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`CALL_PRECOMPILE` doesn't read/write any state (anymore)",
        "created_at": "2021-02-26T06:08:55.805000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What about `STATIC_CALL`?",
        "created_at": "2021-02-26T06:09:51.350000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Would behave like static calling into the callee normally, but setting sender and origin",
        "created_at": "2021-02-26T06:11:04.582000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "No idea why you'd want to do that, but maybe someone would want to?",
        "created_at": "2021-02-26T06:11:42.680000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "shower thought: with the proposed schema, it would be possible to wrap multiple levels of sponsoring, right? So entering CALL_PRECOMPILE `n` times and each time entering a new `origin`, and then recursively backing out again. No practicalities in mind, just a thought.. ?",
        "created_at": "2021-02-26T13:51:53.073000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also, I don't think the evm-level implementation should be too coloured by solidity or how wallets are constructed today, but rather focusing on what's best for the platform",
        "created_at": "2021-02-26T13:53:22.998000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Do you think this would be better suited as a precompile or an opcode in the call family?",
        "created_at": "2021-02-26T13:54:47.904000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Not sure. On one hand, it 'feels' like a precompile. But precompiles are a bit nasty, since you can call them in N ways (call, static, delegate, codecall) and the semantics of that can be a bit funky to determine. But opcodes are problematic because they're evaluated differently... And then again, this could be it's own call-type, so it would fit snugly along `call` as `sponsoredcall`... I don't know",
        "created_at": "2021-02-26T14:07:35.960000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I guess it's a bit strange to have four call-type opcodes, and one call-type precompile, which you need to call to make it call",
        "created_at": "2021-02-26T14:08:23.488000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So right now I'm leaning towards it feeling more like an opcode, but I'm swaying like grass in the wind",
        "created_at": "2021-02-26T14:09:02.660000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@543900561460822016\u003e also made the good (IMO) argument that this would be the first precompile that isn't pure.",
        "created_at": "2021-02-26T16:23:22.070000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It would break anyone using `tx.origin == msg.sender` as a reentrancy guard",
        "created_at": "2021-02-26T16:29:50.757000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Only if we change ORIGIN semantics though, right?",
        "created_at": "2021-02-26T16:30:10.251000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yes",
        "created_at": "2021-02-26T16:33:10.326000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "FWIW I also feel like an opcode makes more sense, with the nonce/replay protection moved out of the precompile that precompile feels a bit less self-contained.  Also from an implementation stand-point as someone just now looking at how the EVM and precompiles are implemented I can see a clear way to implement it as an opcode, but implementing it as a precompile requires larger refactors (because it's the first \"impure\" precompile so would need access to the EVM and StateDB).",
        "created_at": "2021-02-26T17:44:20.638000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I get a https error on https://explorer.yolov3.ethdevops.io/",
        "created_at": "2021-02-26T21:34:47.838000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I don't think it came back up when the network was reset for the 2930 changes, even if I bypass the cert warning I still get a 503.",
        "created_at": "2021-02-26T21:54:35.428000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Can someone give me the state root of block 0 of yolov3?",
        "created_at": "2021-02-26T21:59:59.788000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ya just a sec",
        "created_at": "2021-02-26T22:03:38.952000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`0x18fe5753b162ee86c08809d8cfde565e2ca40c869c5f34b19f9e4478759e35e3`",
        "created_at": "2021-02-26T22:05:40.555000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thanks! ðŸ˜„",
        "created_at": "2021-02-26T22:06:08.192000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Full block just in case you need it: https://gist.github.com/ryanschneider/18d1bb10354c5d3e4d3de772cda6e70e",
        "created_at": "2021-02-26T22:07:10.140000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah great! ðŸ˜„",
        "created_at": "2021-02-26T22:07:44.885000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Don't I need the fork hashes to sync with the network? Due to devp2p? Do you maybe have the fork hashes? \u003c@!388751025789468672\u003e",
        "created_at": "2021-02-26T22:11:17.858000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm not 100% sure I know what that means ðŸ™‚  Do you mean from before the reset?",
        "created_at": "2021-02-26T22:13:54.160000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "These fork hashes https://eips.ethereum.org/EIPS/eip-2124",
        "created_at": "2021-02-26T22:14:36.947000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is to check that we are on the correct chain, mainly to ensure we are not connecting to eth classic nodes",
        "created_at": "2021-02-26T22:14:55.500000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thanks, today I learned. ðŸ™‚  I'll see if I can find them in the geth codebase.",
        "created_at": "2021-02-26T22:17:32.617000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Might also be in the genesis config Martin posted some time back.",
        "created_at": "2021-02-26T22:18:19.669000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah I checked Martin's file, but sadly these do not note the fork hashes",
        "created_at": "2021-02-26T22:19:07.710000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ya I don't see it defined in geth either (`.EIP150BlockHash` would be set if it were): https://github.com/ethereum/go-ethereum/blob/744707a490705f292b0558aa6807b3848a9c4bf9/params/config.go#L226",
        "created_at": "2021-02-26T22:22:02.172000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Isn't the networkId and chainId being unique enough though?",
        "created_at": "2021-02-26T22:24:02.275000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sadly I don't know enough about this specific EIP, only that it uses these hashes to filter out the wrong peers, which would be my initial thought where a problem could be if I have a bootnode but cannot sync",
        "created_at": "2021-02-26T22:25:57.109000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!543900561460822016\u003e ran into something like this, I think.",
        "created_at": "2021-02-26T23:11:21.020000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh which sync protocol are you trying?  IIRC fast sync was broken on the bootnode at some point and I'm not sure if it was re-deployed after being fixed, I've been using full sync",
        "created_at": "2021-02-26T23:12:29.584000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I guess you could also trying setting the fork hash to `0xf1f2876e8500c77afcc03228757b39477eceffccf645b734967fe3c7e16967b7` (the hash of block 0)",
        "created_at": "2021-02-26T23:16:08.732000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I just did that in geth and it seems to be working (I'm resyncing ok from an empty chain)",
        "created_at": "2021-02-26T23:19:14.070000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(oh but setting it to an invalid hash _also_ works so I must be missing something else to fully turn on the feature)",
        "created_at": "2021-02-26T23:23:25.976000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Actually n/m EIP-150 is a totally different \"verify fork hash\" step ðŸ˜Š",
        "created_at": "2021-02-26T23:26:39.579000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ok, found it: https://github.com/ethereum/go-ethereum/blob/e01096f531862b982833732514376cead8d58e82/eth/handler.go#L257\n\nI don't see it exposed anywhere so added a logger to dump it am getting `0xa308affe`",
        "created_at": "2021-02-26T23:44:18.508000+00:00",
        "attachments": null
    }
]