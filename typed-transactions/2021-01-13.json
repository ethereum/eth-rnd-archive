[
    {
        "author": "0xraino",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think I know why my hash might be wrong.",
        "created_at": "2021-01-13T14:19:33.886000+00:00",
        "attachments": null
    },
    {
        "author": "0xraino",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Nvm, I'm getting the same hash still",
        "created_at": "2021-01-13T14:48:39.405000+00:00",
        "attachments": null
    },
    {
        "author": "0xraino",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think it'd be worth doing a sanity check to see if you get the same hash for the receipt root in that json file before and after 2718/2930 changes",
        "created_at": "2021-01-13T14:49:07.166000+00:00",
        "attachments": null
    },
    {
        "author": "0xraino",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Are you just concatenating the type byte with the receipt payload or doing that and then wrapping it in rlp bytes?",
        "created_at": "2021-01-13T14:53:03.775000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Will get back to you about that. Receipts were kind of hacked on, since the txs are not actually executed, so maybe they weren't properly accounted in the block",
        "created_at": "2021-01-13T15:05:11.338000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i believe that we shouldn't be doing either for legacy txs",
        "created_at": "2021-01-13T15:13:34.222000+00:00",
        "attachments": null
    },
    {
        "author": "0xraino",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh yeah",
        "created_at": "2021-01-13T15:13:49.888000+00:00",
        "attachments": null
    },
    {
        "author": "0xraino",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Got ahead of myself and was looking at the other tests.",
        "created_at": "2021-01-13T15:14:09.278000+00:00",
        "attachments": null
    },
    {
        "author": "0xraino",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Let's solve the mismatch with the 0 test first",
        "created_at": "2021-01-13T15:14:31.982000+00:00",
        "attachments": null
    },
    {
        "author": "0xraino",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Actually, I might have an issue with the decoding as well. The `yParity` value, should that be an rlp byte? Because I think it's `0x80` in `acl_block_0.json`",
        "created_at": "2021-01-13T15:28:18.174000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "0x80 is `0` for a QUANTITY in RLP IIRC?",
        "created_at": "2021-01-13T16:08:45.179000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "~~Hmm, or is `0x80` a zero length byte array... I always forget.~~ Everything in RLP is a byte array or a list, so this statement doesn't make sense.",
        "created_at": "2021-01-13T16:09:10.537000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It should just be a `0` byte or a `1` byte I believe.",
        "created_at": "2021-01-13T16:10:18.808000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "~~Oh, actually 0x80 may be a special case in Ethereum's pre-RLP encoding step...~~ Also wrong.",
        "created_at": "2021-01-13T16:11:27.360000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm pretty sure `yParity` should always be 0 byte or 1 byte after RLP encoding.",
        "created_at": "2021-01-13T16:12:31.791000+00:00",
        "attachments": null
    },
    {
        "author": "0xraino",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ok, that's what I thought. So it ends up as `00` or `01`, correct?",
        "created_at": "2021-01-13T16:12:57.516000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "0x80 is a 0-length byte array.",
        "created_at": "2021-01-13T16:13:15.509000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh, but Ethereum is dumb.",
        "created_at": "2021-01-13T16:13:39.015000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`The integer 0 = [ 0x80 ]`",
        "created_at": "2021-01-13T16:13:45.707000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ðŸ˜–",
        "created_at": "2021-01-13T16:13:50.728000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`The encoded integer 0 (â€™\\x00â€™) = [ 0x00 ]`",
        "created_at": "2021-01-13T16:14:04.101000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What does that even mean?!",
        "created_at": "2021-01-13T16:14:18.876000+00:00",
        "attachments": null
    },
    {
        "author": "0xraino",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm looking at the same page as you and I am confounded haha",
        "created_at": "2021-01-13T16:14:33.473000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(I have been over this a dozen times over the years, and even written an RLP encoder and decoder and *every* time I am confused.",
        "created_at": "2021-01-13T16:14:41.595000+00:00",
        "attachments": null
    },
    {
        "author": "0xraino",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Glad I'm not the only one haha. I think in this case, since it's never going to need more than 1 byte to encode, we go with `00`, `01`",
        "created_at": "2021-01-13T16:15:48.514000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "```\ndef to_binary(x):\n    if x == 0:\n        return ''\n    else:\n        return to_binary(int(x / 256)) + chr(x % 256)\n```",
        "created_at": "2021-01-13T16:16:53.307000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Pretty sure the protocol just straight up special cases `0` for some reason.",
        "created_at": "2021-01-13T16:17:03.882000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e positive RLP integers must be represented in big endian binary form with no leading zeroes (**thus making the integer value zero be equivalent to the empty byte array**).",
        "created_at": "2021-01-13T16:17:42.660000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is a side effect of the zero stripping that happens prior to RLP encoding.",
        "created_at": "2021-01-13T16:18:06.395000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "When you strip all of the leading zeros off of `0`, you get null.",
        "created_at": "2021-01-13T16:18:23.861000+00:00",
        "attachments": null
    },
    {
        "author": "0xraino",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I see, so `80` and `01` then?",
        "created_at": "2021-01-13T16:18:29.989000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If you want to keep your code clean, that should happen *prior* to RLP.",
        "created_at": "2021-01-13T16:18:52.373000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Since RLP (the encoding system) *only* knows how to encode byte arrays and lists.  It doesn't have any concept of numbers.",
        "created_at": "2021-01-13T16:19:14.864000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ethereum has an un-named encoding scheme for turning various types of data into byte arrays and lists that it applies to things prior to RLP encoding them.",
        "created_at": "2021-01-13T16:19:43.469000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In the RLP document it says:\n\u003e encoding specific data types (eg. strings, floats) is left up to higher-order protocols\nAnd then literally the next words are:\n\u003e but positive RLP integers must be represented in big endian binary form with no leading zeroes",
        "created_at": "2021-01-13T16:20:35.037000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So that is the \"higher level protocol\".  ðŸ˜¬",
        "created_at": "2021-01-13T16:20:52.306000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!213672586264051717\u003e as for that receipt-root, this is the encoded receipt, itself. Which is later placed into a trie for producing the root. I suspect the root of our mismatch should be here. `f90129a000000000000000000000000000000000000000000000000000000000000000008301e241b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0`",
        "created_at": "2021-01-13T18:31:39.445000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah. Oh. Yeah this is my bad.",
        "created_at": "2021-01-13T19:04:25.374000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'll update them tomorrow, but it's due to a different hasher being used, not based on the trie ðŸ™‚",
        "created_at": "2021-01-13T19:08:30.431000+00:00",
        "attachments": null
    },
    {
        "author": "0xraino",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "No worries!",
        "created_at": "2021-01-13T20:01:14.338000+00:00",
        "attachments": null
    }
]