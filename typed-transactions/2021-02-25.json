[
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I want to, but I don't have a good argument other than I hate that opcode and want it to die.  I feel like if we want to kill it, we should just kill it as a separate EIP.",
        "created_at": "2021-02-25T03:31:46.263000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Legacy transactions with a chain ID set will include 9 fields, legacy transactions without chainID will include 6 fields.",
        "created_at": "2021-02-25T03:33:15.068000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Still going to be a few more changes tomorrow, but https://github.com/quilt/EIPs/blob/eip-3074-replay-party/EIPS/eip-3074.md has been updated",
        "created_at": "2021-02-25T04:46:44.730000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Remaining TODOs:\n\n - Specify behavior for CALL, STATICCALL, DELEGATECALL, and CODECALL\n - Return gas used after success bool (everything after the call into the precompile)\n - Walk through using an ERC-20 to pay for gas to make sure it works\n - Don't use RLP\n - Rename v to yParity\n - Rename gaslimit to mingas\n - Gas cost",
        "created_at": "2021-02-25T04:50:13.593000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Recommend grabbing TransactionType `3` instead of `7f`.",
        "created_at": "2021-02-25T04:51:25.756000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It will be much easier to keep track of \"consumed\" numbers if they are approximately sequential.",
        "created_at": "2021-02-25T04:51:40.247000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Even though it's a reservation, and not a true transaction type?",
        "created_at": "2021-02-25T04:51:40.552000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah.",
        "created_at": "2021-02-25T04:51:49.925000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I am weakly trying to avoid having to track \"consumed\" numbers somewhere.  So far, we have a small enough number of new \"types\" that we can just track \"last used\" pretty easily without any explicit tracking system.",
        "created_at": "2021-02-25T04:52:22.771000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also, I think there may have been some problems with 7f that someone brought up...",
        "created_at": "2021-02-25T04:52:46.684000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh, no.  It was 0x19 that is problematic because signed messages use that.",
        "created_at": "2021-02-25T04:53:24.157000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The stuff currently in Security Considerations should be moved to Rationale I think.  Though, there probably should *also* be a mention about the ORIGIN change in backward compatibility.",
        "created_at": "2021-02-25T04:58:08.568000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Re: `ORIGIN` argument.  You are missing (4) the call cannot be conditional.  This property is already invalidated by the fact that a miner can conditionally include a transaction.",
        "created_at": "2021-02-25T05:00:34.947000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Think so? It's definitely security related for existing contracts.",
        "created_at": "2021-02-25T05:10:32.120000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah, that's a good one! It does mean the transaction can be included _only if specific conditions are met_",
        "created_at": "2021-02-25T05:11:12.229000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It may be worth mentioning it in the Security section, but worded differently.",
        "created_at": "2021-02-25T05:11:19.758000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Even _post_ conditions.",
        "created_at": "2021-02-25T05:11:58.925000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Security section items should be warnings to implementors and users basically.\n\u003e Transactions will no longer be able to prevent call preconditions or post conditions using `ORIGIN`",
        "created_at": "2021-02-25T05:12:30.261000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The rationale section is the appropriate place to go into more detail on your *reasoning* for making a decision.",
        "created_at": "2021-02-25T05:12:42.691000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah, okay. So in security considerations, just list the changes, but put the reason why I don't care in rationale.",
        "created_at": "2021-02-25T05:13:12.881000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There is value in keeping the security considerations section short, because it increases the chance people will actually read it.  If they want more details they can go to the rationale.",
        "created_at": "2021-02-25T05:13:36.623000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Hm, is it a problem if an account's balance decreases without changing the nonce?",
        "created_at": "2021-02-25T05:36:34.201000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ugh.",
        "created_at": "2021-02-25T05:43:09.451000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is a problem if an accounts balance can decrease outside of a transaction signed by that account because it is a way to invalidate a transaction after it has been gossiped.",
        "created_at": "2021-02-25T05:43:48.794000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Right, but that's a fairly trivial check, no?",
        "created_at": "2021-02-25T05:44:09.285000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!211091239112671234\u003e probably can be more insightful on the impact this could have on the pending pool.",
        "created_at": "2021-02-25T05:44:11.014000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(also updated my branch)",
        "created_at": "2021-02-25T05:44:17.243000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Skimmed through the missed convo above.. First of all re  `rawTransaction` , I'm not 100% sure, but it might be that `clef` is able to take a raw unsigned transaction as input (alternatively, that I planned to do that but never got around to it).",
        "created_at": "2021-02-25T07:29:58.703000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I need to read up on it a bit before I have anything meaningful to say, will try to get some time for that in the near future",
        "created_at": "2021-02-25T07:33:44.223000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ugh, I'm going back and forth on using EIP-712 for encoding the arguments... It would be so _nice_.",
        "created_at": "2021-02-25T16:53:18.172000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "wouldn't that allow for dapps to potentially conflict with the 3074 tx?",
        "created_at": "2021-02-25T16:55:43.068000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The domain separator and typehash would prevent that, no?",
        "created_at": "2021-02-25T16:56:07.476000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "oh okay, i was thinking of the format that just prepends \"Ethereum signed msg\"",
        "created_at": "2021-02-25T16:56:50.979000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh, no lol",
        "created_at": "2021-02-25T16:57:05.648000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "what's the advantage of 712 encoding?",
        "created_at": "2021-02-25T16:57:26.338000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Wallets support it, solidity can encode it efficiently",
        "created_at": "2021-02-25T16:57:45.830000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Downsides: it isn't finalized.",
        "created_at": "2021-02-25T16:58:03.131000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Well, I'm pretty sure web3.py implements it, finalized or not",
        "created_at": "2021-02-25T17:00:02.946000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yep. I think metamask has three versions of it.",
        "created_at": "2021-02-25T17:00:30.612000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "is there any precedent for a core change to depend on and ERC?",
        "created_at": "2021-02-25T17:00:44.608000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Are there EIPs that use `abi.encode`? That would be a similar dependency.",
        "created_at": "2021-02-25T17:05:00.087000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Can you walk me through exactly how 712 encoding would work?",
        "created_at": "2021-02-25T17:05:28.260000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And how it would be leveraged in a meaningful way?",
        "created_at": "2021-02-25T17:05:39.119000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If the goal is just to make life easier for developers, *everyone* has tools for ABI encoding, certainly far more than have tools for 712 encoding.",
        "created_at": "2021-02-25T17:06:01.150000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also, I would rather design things well and have people build appropriate tools than have the design cater to *current* tools.  EVM changes are for life, tools are temporary.",
        "created_at": "2021-02-25T17:06:29.268000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Would be something like this in the invoker:\n\n```\nfunction invoke(address sponsee, uint256 nextra, address to, uint256 mingas, uint256 value, bytes calldata, uint8 v, bytes32 r, bytes32 s) {\n    bytes memory arguments = abi.encode(sponsee, nextra, to, mingas, value, calldata, v, r, s);\n    call_precompile(arguments);\n}\n```\n\nThen in the precompile, you'd do something like:\n\n```\nDOMAIN_SEPARATOR = keccak256(abi.encode(\n    keccak256(\"EIP712Domain(uint256 chainId,address verifyingContract)\"),\n    chainid(),\n    address(invoker)\n));\n\nTYPEHASH = keccak256(\"Eip3074(address sponsee,uint256 nextra,address to,uint256 mingas,uint256 value,bytes calldata\");\n\nbytes32 digest =\n    keccak256(abi.encodePacked(\n        \"\\x19\\x01\",\n        DOMAIN_SEPARATOR,\n        keccak256(abi.encode(TYPEHASH,\n                             sponsee,\n                             nextra,\n                             to,\n                             mingas,\n                             value,\n                             calldata))\n));\n\nrequire(sponsee == ecrecover(digest, v, r, s));\ncall_set_sender{value: ...}(calldata...);\n```",
        "created_at": "2021-02-25T17:42:29.401000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And what advantage does that provide over RLP or ABI encoding?",
        "created_at": "2021-02-25T17:47:52.658000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "At the least, it requires *more* infarstructure than ABI encoding since ABI encoding is a subset of it.  ðŸ™‚",
        "created_at": "2021-02-25T17:49:07.250000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I feel like signing `Type || abi.encode(...)` is significantly simpler.",
        "created_at": "2021-02-25T17:49:26.687000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It's easier to encode in Solidity, so that's a little nicer than RLP.\n\nI don't think 712 is significantly harder to sign. It's `keccak256(abi.encode(...)) ++ some_constant ++ abi.encode(...)`",
        "created_at": "2021-02-25T17:53:16.459000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "```\nbytes32 digest = keccak256(abi.encodePacked(Type, abi.encode(\n    sponsee,\n    nextra,\n    to,\n    mingas,\n    value,\n    calldata\n)));\nrequire(sponsee == ecrecover(digest, v, r, s));\ncall({ from: sponsee, value: ... }(calldata...);\n```",
        "created_at": "2021-02-25T17:56:03.711000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That seems *way* simpler to me than what you have above.",
        "created_at": "2021-02-25T17:56:12.588000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think we are debating over the margins though, so to me the question is \"what do we gain?\"",
        "created_at": "2021-02-25T17:56:49.083000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Benefits of EIP-712:\n - Reusing structured signature code in wallets\n\nDownsides of EIP-712:\n - Two extra keccaks over naively `abi.encode`-ing the calldata",
        "created_at": "2021-02-25T18:05:47.451000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Hi guys, what chain ID are you using in the state tests of EIP2930? Tests do not define chain id, is it 0?",
        "created_at": "2021-02-25T18:15:47.258000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Why is it better to reuse \"structured code\" in wallets over reusing ABI encoder in wallets?",
        "created_at": "2021-02-25T18:23:08.551000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, I mean I guess I don't really care that much. I'll just `abi.encode` the arguments together",
        "created_at": "2021-02-25T18:26:02.790000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is unclear to me what the purpose of the domain separator is after reading 712, including the rationale for why the domain separator exists.  ðŸ˜–",
        "created_at": "2021-02-25T18:30:02.170000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And the domain separator in your example feels weird, given that we don't include chain ID or a contract address.",
        "created_at": "2021-02-25T18:30:38.475000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In mine, I do include the invoker address and the chain id",
        "created_at": "2021-02-25T18:33:42.589000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The domain separator, at least as far as I understand, is to keep EIP-712 packages for contract A from being valid for contract B",
        "created_at": "2021-02-25T18:34:46.045000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Invoker doesn't *have* to be a contract though.",
        "created_at": "2021-02-25T18:34:56.858000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "No, but that's fine",
        "created_at": "2021-02-25T18:35:04.558000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Still has an address",
        "created_at": "2021-02-25T18:35:12.873000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I don't see how that domain seperator given any guarantee of signature uniqueness across applications.",
        "created_at": "2021-02-25T18:35:38.986000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You would need some sort of globally unique application ID.",
        "created_at": "2021-02-25T18:35:48.071000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh, this is actually missing `invoker`",
        "created_at": "2021-02-25T18:35:52.222000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Isn't that `verifyingContract`?",
        "created_at": "2021-02-25T18:36:11.827000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "An invoker (especially an EOA invoker) can be a verifier for multiple applications.",
        "created_at": "2021-02-25T18:37:11.914000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Under normal circumstances I think you would be right that invoker would provide uniqueness guarantees, but in this specific special case I don't think it does.",
        "created_at": "2021-02-25T18:37:51.294000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah, you meant specifically for EIP-3074",
        "created_at": "2021-02-25T18:37:55.808000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah.",
        "created_at": "2021-02-25T18:38:00.525000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I suppose maybe it works out since the invoker is how you are managing reply attacks anyway.",
        "created_at": "2021-02-25T18:38:18.390000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, it really doesn't add anything for EIP-3074, beyond just signing over the invoker address.",
        "created_at": "2021-02-25T18:38:34.819000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!301186049323958275\u003e do you have any thoughts on whether 3074 should be a precompile or opcode? Originally, 3074 expected to have a storage trie underneath to store nonces. Now that's no longer the case, so I am leaning farther towards the opcode route.\n\nPros:\n* precompiles are generally pure functions, this wouldn't be pure\n* less things to reason about, e.g. no need to deal with call vs. delegatecall vs. callcode - etc\n* seems like a logical extension to the `*CALL` family\n\nCons:\n* requires a lot of inputs, so it may be a bit unwieldy\n* ?\n\ncan't think of so many cons, maybe \u003c@!689161464829050960\u003e can fill some in?",
        "created_at": "2021-02-25T21:31:21.839000+00:00",
        "attachments": null
    }
]