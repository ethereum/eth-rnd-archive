[
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "Why it can't be a contract account balance that the funds are deduced from? It won't be transacted with all related outcomes but it could be a contract and the logic of the contract could be adjusted to work with this in-protocol deduction",
        "created_at": "2021-09-01T02:31:39.088000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think that proposer/builder separation can be well combined with something similar to this proposal https://ethresear.ch/t/commit-to-pre-state-instead-of-post-state-on-the-executable-beacon-chain/8802. \n\nThen we get to the following scheme:\n* Slot N: Proposer publishes a header and receives its first tranche\n* Slot N: Attesters votes for the header\n* Slot N: Builder publishes a block \n* Slot N+1: Proposer executes a block of Slot N and publishes state root which is referred as `pre_state_root`, Slot N proposer receives its second tranche\n* Slot N+1: Attesters votes for the `pre_state_root`",
        "created_at": "2021-09-01T02:39:49.141000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "All we have for validation of fund ownership is a signature.  Either we need a standard deposit contract where the owner is an EOA but withdraws go somewhere else, or we need an EOA.",
        "created_at": "2021-09-01T03:25:47.961000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "And contracts can't sign things.",
        "created_at": "2021-09-01T03:26:20.782000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "Ah, I see",
        "created_at": "2021-09-01T03:26:39.783000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "With a deposit contract, we can have the withdraw address differ from the block signer address.",
        "created_at": "2021-09-01T03:27:15.749000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "Though, now that I think about it an attacker that gains access to the builder private keys could just propose a block to a slot they are proposer for with a proposer fee that is very high.",
        "created_at": "2021-09-01T03:28:29.440000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "The only protection here is that the attacker would need to be a validator and wait for a slot.",
        "created_at": "2021-09-01T03:28:51.643000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "This attack would be possible with whatever payment scheme we end up, right?",
        "created_at": "2021-09-01T03:29:43.114000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "I believe so, yes.",
        "created_at": "2021-09-01T03:54:05.648000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "In theory instead of a block signature we could have a block payment transaction.  That transaction could use any techniques for asset storage like Multisig, recoverable, additional checks, etc.",
        "created_at": "2021-09-01T03:54:59.206000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "However, that opens up a whole can of worms with regards to payment validity that may not be worth it.",
        "created_at": "2021-09-01T03:55:26.093000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "Could account abstraction or anything in this direction help here?",
        "created_at": "2021-09-01T06:25:36.330000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "Maybe, but only because perhaps we'll have already dealt with the hard problems so they are a sunk cost.",
        "created_at": "2021-09-01T06:26:49.300000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "In that case the proposer can just directly take the funds from the account.",
        "created_at": "2021-09-01T08:45:14.270000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "O nvm, you meant a deposit contract",
        "created_at": "2021-09-01T08:45:58.789000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "Okay, but at what point in this flow do attesters execute the block?",
        "created_at": "2021-09-01T08:48:33.806000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "When voting for the `pre_state_root` I suppose since you need to execute to verify it",
        "created_at": "2021-09-01T09:00:20.256000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "which was my original point: attesters only have a maximum of 4 seconds, and realistically 2-3, in their attestation window to execute the block before they have to broadcast their attestation.",
        "created_at": "2021-09-01T09:40:39.678000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "They execute a block in a Slot N+1 likewise the proposer does. So, they would have `12 seconds - the_offset_of_when_a_block_is_received + 4 seconds` instead of `4 seconds - the_offset_of_when_a_block_is_received` to execute the payload.",
        "created_at": "2021-09-01T09:46:05.870000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think 8 --\u003e 4 in your last sentence",
        "created_at": "2021-09-01T09:56:14.084000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "And probably you want to change then the last item in the workflow to slot N attesters instead of N+1",
        "created_at": "2021-09-01T09:57:54.233000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "Attesters fire their votes at `8 seconds` boundary, don't they?",
        "created_at": "2021-09-01T09:58:28.008000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "No, at 4",
        "created_at": "2021-09-01T09:58:37.366000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Aggregates is at 8",
        "created_at": "2021-09-01T09:58:44.983000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "sorry",
        "created_at": "2021-09-01T09:58:57.980000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "fixed",
        "created_at": "2021-09-01T09:59:18.018000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "why? Attesters of Slot N+1 should attest to the beacon block at Slot N+1 and `pre_state_root` that this block contains which implies the execution of the payload contained by the beacon block at Slot N.",
        "created_at": "2021-09-01T10:02:05.500000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Oh ok it was then nomenclature only, I was calling attesters for slot N those that vote for the pre state root that results from executing the payload at slot N",
        "created_at": "2021-09-01T10:03:33.797000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "ah, I see",
        "created_at": "2021-09-01T10:03:56.048000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "I am thinking that bundles proposed by block builders should be processed by another type of a mempool. The mempool logic should include selecting the topmost bundle wrt proposer's bribe. The question is whether every execution client should run both mempools or there are options here. For the sake of the health of the network each node should run both mempools. The advantage of having a mempool is that proposer will always have some bundle that is ready to be picked up.",
        "created_at": "2021-09-01T12:39:56.786000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "bundles or blocks (well, block headers)?  If bundles it seems that we're building MEV in to the core components, which doesn't seem necessary to me.  I'd hope that over time we would move the existing mempool to a separate process rather than incorporate new mempools.",
        "created_at": "2021-09-01T12:48:35.978000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "I should have said block headers suggested by builders",
        "created_at": "2021-09-01T12:54:16.858000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "I also like the idea of having a single mempool of headers (ideally distributed via gossip so they are censorship resistant).",
        "created_at": "2021-09-01T18:19:49.112000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "I guess the idea is that the proposer would propose the best header, and then at that point the builder would see that attestation (over consensus gossip?) and immediately broadcast the body as far and wide as they can (over execution gossip?).",
        "created_at": "2021-09-01T18:21:22.055000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Cross-layer",
        "parent": "",
        "content": "Those block headers would go over execution gossip then?",
        "created_at": "2021-09-01T18:21:52.410000+00:00",
        "attachments": null
    }
]