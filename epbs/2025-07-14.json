[
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "Dropping this short piece on transaction confirmation times under ePBS (with and without an earlier payload observation deadline), delayed execution and the situation today, and would be happy to hear people's thoughts:\nhttps://hackmd.io/@Nerolation/HyMgK5Aree",
        "created_at": "2025-07-14T14:34:19.982000+00:00",
        "attachments": null
    },
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "This table is the main summary:\n\n```\nModel                     | Expected Incl | Best-Case | Worst-Case\n--------------------------|---------------|-----------|------------\nToday                     | 6 seconds     | 0.01s     | 11.99s\nePBS (reveal at t = 9)    | 15 seconds    | 0.01s     | 20.99s\nePBS (reveal at t = 6)    | 12 seconds    | 0.01s     | 17.99s\nDelayed Execution         | 6 seconds     | 0.01s     | 11.99s\n\n```\n\n*0.01s is supposed to represent a lower bound - the min achievable latency-wise.",
        "created_at": "2025-07-14T14:37:27.342000+00:00",
        "attachments": null
    },
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "Of course, I'm assuming here that there is an incentive to delay payload reveal which is not fully clear to me. I can see reasons for it but not certain.",
        "created_at": "2025-07-14T14:41:44.516000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I want to post something about transaction inclusion and pinging \u003c@486501030046203915\u003e since you complained that \"2 seconds is a lot\" during ACD. It turns out that today there is a delay which is far from the 0.01 \"best case\"  scenario in the above table from Toni. Here are data from two different relays (I got permissions from them to publish these graphs) and these are the \"best cases\". I'll explain in a bit, but first \n\nThese are the delays in which the payload has already been committed, is only known to the builder (and the relay) and is still not being broadcast. These are from relays that play timing games, that is, they are trying to minimize this delay at maximum. And still we are seeing a median of 1.3\"  and an average of 1.6\". Let me stress out that for a relay that does not play timing games, like the flashbots relay, these numbers would be much much worse, because those relays select the wining bid very early and broadcast the payload very late after all other relays have returned. This means that for flashbots winning blocks we'd expect even worse inclusion times. \n\nThis delay is there because of the auction mechanism today and it's completely artificial and this delay **does not need to exist on ePBS**.",
        "created_at": "2025-07-14T15:30:15.524000+00:00",
        "attachments": [
            {
                "type": "image/jpeg",
                "origin_name": "us.jpg",
                "content": "f2d5caea6c32ef22c41d96ad23a2b6a28a70260aa80f09ad6b66ba2a04c2a938"
            },
            {
                "type": "image/jpeg",
                "origin_name": "titan.jpg",
                "content": "acc9f1ac8927c75cbf7c5fe89c6e9525fe501b4d624b23a212d66771cd127c91"
            }
        ]
    },
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "The 0.01s should just say \"min possible after latency\". \nTiming games happen before the proposer commits to the payload, not afterwards. As soon as the proposer commits to the payload, it immediatelly gets broadcasted (after being distributed to many internal nodes first - a thing of a few ms).\nThose proposer timing games led to a situation where you can submit a transaction in second 1 in the slot and still get included in the same slot - avg. inclusion time stays at 6s, no matter if every proposer plays timing games or not.",
        "created_at": "2025-07-14T16:10:04.370000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think you're not looking at the graphs I posted, that time is the time between bid selection and payload broadcasting,",
        "created_at": "2025-07-14T16:10:57.916000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "During this time, a tx cannot be included in the payload",
        "created_at": "2025-07-14T16:11:12.167000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "that is, when such a payload wins the auction that payload CANNOT include a tx in less than 1.6 seconds",
        "created_at": "2025-07-14T16:11:34.131000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "in average",
        "created_at": "2025-07-14T16:11:36.854000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "in that relay",
        "created_at": "2025-07-14T16:11:38.586000+00:00",
        "attachments": null
    },
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "Which of the graphs and what is the \"block broadcast delay\", \"delay\" as of when?",
        "created_at": "2025-07-14T16:12:36.022000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "both graphs are for the same metrics essentially, on different relays",
        "created_at": "2025-07-14T16:12:58.525000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "This is the time it takes from bid selection (therefore payload is committed) until the relay revealing the payload",
        "created_at": "2025-07-14T16:13:42.272000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "and timing games as I explain above are very relevant, because when my node takes a block from a relay like Flashbots: my node will wait for everyu single relay replay, so even though flashbots immediately gives me a bid, my node will still wait 1 second because othe other relays wait until the deadline",
        "created_at": "2025-07-14T16:14:51.144000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "so even if I chose the payload that Flashbots got me immediately it will be broadcast with a delay of at least 2 seconds",
        "created_at": "2025-07-14T16:15:31.452000+00:00",
        "attachments": null
    },
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "This delay of 2 seconds is new to me and I just asked Alex from Ultrasound (couldn't tag him here) a few weeks ago if there is any delay between receiving the signed header and starting to broadcast, which he negated.\nWhy would there be any delay? The proposer committed to the block already and would never sign another block (except of an attack but there the best defence is broadcasting as fast as possible since the only thing that can happen is an unbundling which isn't solved through arbitrary delays between receiving the signed header and payload propagation).\n\nAnd yes, you might wait for other relays, but those relays could have blocks that include transactions that were submitted even after your initial getHeader call.",
        "created_at": "2025-07-14T16:25:24.749000+00:00",
        "attachments": null
    },
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yes, relays might first distribute the block among trusted peers (e.g. bloxroute's BDN) and then start propagating all around the world at the same time, reducing unbundling risks, but any other delay of say 2 seconds as you mention would make no sense to me.",
        "created_at": "2025-07-14T16:27:02.722000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The US graph I got from Alex himself",
        "created_at": "2025-07-14T16:27:08.613000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "This is not an intentional delay, this is the time it takes for the roundtrip",
        "created_at": "2025-07-14T16:27:59.277000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "I thought the timeout was 900ms between when my mev-boost sidecar queries every relay and decides to timeout. Then there is possibly the \"proposer unbundling defence\" delay, not sure what the number is",
        "created_at": "2025-07-14T19:35:45.619000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "There's no unbundling delay, the Payload is broadcast as soon as the signed block is received",
        "created_at": "2025-07-14T19:36:41.898000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The delay is in returning it to the proposer",
        "created_at": "2025-07-14T19:36:53.502000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "That's less relevant though, what matters for transaction inclusion latency is more services like Etherscan or the wallet",
        "created_at": "2025-07-14T19:38:01.859000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "Just to make sure, these graphs are plotting the histogram of `received_signed_header_time - received_corresponding_bid_time`? not the difference between any bid received and the signed header's time?",
        "created_at": "2025-07-14T19:39:27.430000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "The first graph has a mean/median close to 400-500ms, I'd say this is not a big delay compared to 2s",
        "created_at": "2025-07-14T19:40:45.266000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "Also I don't think 0.01 best case is reasonable",
        "created_at": "2025-07-14T19:41:33.683000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "Was also drafting a post on transaction inclusion latency actually üôÇ",
        "created_at": "2025-07-14T19:41:45.919000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "",
        "created_at": "2025-07-14T19:42:14.230000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "Screenshot_2025-07-14_at_21.42.08.png",
                "content": "99fe7de3b75dc30dd87e329427d747be407ba9032888af6e3ab39fdba08f2b46"
            }
        ]
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yes",
        "created_at": "2025-07-14T19:43:31.188000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yes the ultrasound graph is about 500ms, Titan's is about 1.5s and flashbots should be about 2s (but I haven't got flashbots times)",
        "created_at": "2025-07-14T19:44:46.580000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think my points are pretty self evident",
        "created_at": "2025-07-14T19:45:28.216000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "Would you include the latency of the proposer pulling bids in ePBS? Because there would be a similar mechanism of pulling from the builders you want, waiting for their response and timing out after some period of time no? This happens in both ePBS and mev-boost, but what doesn't necessarily happen in mev-boost is an extra wait between receiving the signed header and the payload release",
        "created_at": "2025-07-14T19:48:15.145000+00:00",
        "attachments": null
    },
    {
        "author": "stefanbratanov",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think it makes sense to keep it based on Electra and test the queue flow with Prysm and Teku. Afterwards, when more clients start implementing, we should rebase on Fulu.",
        "created_at": "2025-07-14T19:54:55.327000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "its not clear to me what the latency is for proposer pulling bids in epbs, but I think it would be shorter than mev-boost because the timeout is coded in client rather than mev-boost. We could set the timeout to ~500ms and that's more than enough imo, and we would also move the attestation deadline up to 3s or 2s mark. So get header would actually happen at 500ms into the slot, rather than 1.5s into the slot today",
        "created_at": "2025-07-14T19:58:13.543000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Thanks this looks reasonable to me as well. \u003c@592004585506340885\u003e I'd like to make my PR after addressing your review and any other if there's one. We can always change the design later and I'm counting with Francesco changing a bunch of things. But merging this will unlock Terence for giving us static testsvectors and that will let prysm Teku interop soon",
        "created_at": "2025-07-14T20:19:07.225000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Cross-layer",
        "parent": "",
        "content": "Sounds good to me. Let's work on getting that PR merged soon.",
        "created_at": "2025-07-14T20:35:56.488000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Cross-layer",
        "parent": "",
        "content": "Also, regarding [that last concern of mine](https://github.com/ethereum/consensus-specs/pull/4438#discussion_r2201347322), how exactly does the current method promote better chain security? I think I'm going to push a bit harder to have this changed. I _really_ don't like the idea of not providing full payments to proposers.",
        "created_at": "2025-07-14T20:40:17.241000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Cross-layer",
        "parent": "",
        "content": "But I'm not going to block merging this PR on that. Like you said, we can tweak things later üôÇ",
        "created_at": "2025-07-14T20:42:52.997000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The thing is that we need to churn the withdrawals from the builder to keep the same security of weak subjectivity as today.  And we need to slash any slashable stake rather than transfer it",
        "created_at": "2025-07-14T21:17:20.562000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Cross-layer",
        "parent": "",
        "content": "Would this have a real impact weak subjectivity though? Could we slash the builder if this situation happens?",
        "created_at": "2025-07-14T21:27:29.579000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "But it does not matter what the absolute time into the slot it happens or not. Whether getHeader happens earlier or later, the tx inclusion latency will be due to how much time is spent with a ‚Äúlocked view‚Äù that is not yet communicated to the network\n\nAnd if you were to set the timeout to 500ms in ePBS, why couldn‚Äôt you set it to the same amount in mev-boost?",
        "created_at": "2025-07-14T21:48:00.012000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "what's the definition of lock view? is it from proposer calls `getHeader` to the network learns about the payload?",
        "created_at": "2025-07-14T22:18:57.086000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "We will slash the builder but then the withdrawal to the proposer may not have enough funds that's the point",
        "created_at": "2025-07-14T22:41:34.040000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "By the way \u003c@641548687813902336\u003e I propose we aim to implement after we merge this, then testsvectors from Terence and then I rebase on top of the millisecond timestamps PRs so that we can make configurable the PTC deadlines",
        "created_at": "2025-07-14T22:42:43.546000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Cross-layer",
        "parent": "",
        "content": "Builder insufficient funds",
        "created_at": "2025-07-14T23:03:17.843000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The point is that if today due to timing games as described above, a Payload delivered by flashbots is in locked state for 2 seconds, then in ePBS this disappears since there is zero delay from bid selection to CL block broadcast and we can make Payload availability deadline as small as we want as long as the broadcast is possible. Giving the exact delay as today without the \"wait for worst\" relay possible.",
        "created_at": "2025-07-14T23:05:28.942000+00:00",
        "attachments": null
    }
]