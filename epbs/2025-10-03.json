[
    {
        "author": "nc1234",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think semantically speaking the spec should set it to FAR_FUTURE_EPOCH",
        "created_at": "2025-10-03T11:27:28.247000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I much rather keep it at zero unless there is a strong reason not to. That epoch is irrelevant in the spec as long as everyone sets the same, it could be 7 for all that matters",
        "created_at": "2025-10-03T11:29:59.126000+00:00",
        "attachments": null
    },
    {
        "author": "nc1234",
        "category": "Cross-layer",
        "parent": "",
        "content": "I know. It doesnâ€™t make a practical difference. Because we set the epoch later on anyway. I said semantic because withdrawable epoch set to FAR_FUTURE_EPOCH means the payment is not yet eligible to be withdrawn. Setting it to 0 works too but is semantically weaker",
        "created_at": "2025-10-03T11:35:47.853000+00:00",
        "attachments": null
    },
    {
        "author": "nc1234",
        "category": "Cross-layer",
        "parent": "",
        "content": "I guess on the contrary, why prefer 0 over FAR_FUTURE_EPOCH? Is there any performance advantage to some client by not setting it (or explicitly setting it to 0)?",
        "created_at": "2025-10-03T11:37:20.277000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "yeah I agree that semantically it would make sense, but the state has more consecutive 0 bits than 1 bits, I get better compressibility faster storage and avoid bugs of the form \"oh I forgot to set this\" so generally I prefer to default to zero, nothing big in this case, can easily be changed and add a spectest for this.",
        "created_at": "2025-10-03T11:49:12.870000+00:00",
        "attachments": null
    },
    {
        "author": "linoscope",
        "category": "Cross-layer",
        "parent": "",
        "content": "",
        "created_at": "2025-10-03T17:36:20.054000+00:00",
        "attachments": null
    },
    {
        "author": "linoscope",
        "category": "Cross-layer",
        "parent": "",
        "content": "(Forwarded above for visibility)",
        "created_at": "2025-10-03T17:36:34.018000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Left a review of your PR, the issue of the withdrawable epoch being 0 or `FAR_FUTURE_EPOCH` is fine, it's just a matter of taste, if you want to change that  I don't oppose, but the others are bugs. The builder pending payment is deducted from the builder and put in the withdrawal queue for actual withdrawal, the checks here are for WSP safety: we can't remove stake from the protocol in certain events. For example, if the builder is slashed, then we need to wait until it has already withdrable so that we have already deducted all that's possible from it.",
        "created_at": "2025-10-03T18:22:39.591000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Now the dangerous thing is that this PR passes tests without changes \u003c@363800010518822915\u003e",
        "created_at": "2025-10-03T18:38:04.056000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@1035747431461167125\u003e care to write a regression for this bug?",
        "created_at": "2025-10-03T18:38:13.562000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "yep, we def took it for granted that withdrawals epoch is just a constant 0 and didnt asert them, here is the diff to add assertions for them, in these four test cases, will be good to have them in the pr",
        "created_at": "2025-10-03T18:47:39.815000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "Screenshot_2025-10-03_at_11.46.46_AM.png",
                "content": "99a3b7f2b4629a7359b0d8e494cc0eb50abad70dd6dbc269f663ed543f956107"
            }
        ]
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "not only that assertion, the worrysome one is the actual introduced bugs",
        "created_at": "2025-10-03T18:48:30.733000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "on the STF",
        "created_at": "2025-10-03T18:48:38.974000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "the changes in NC's code is only to process bid, it does not change the epoch, that's why there's no assertion because we actually took the initialization value as the face value",
        "created_at": "2025-10-03T20:13:50.059000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "we dont have any spec tests outside of process block operation and process epoch today",
        "created_at": "2025-10-03T20:14:19.273000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "It should make it fail block processing when the purposer needs to get paid",
        "created_at": "2025-10-03T20:16:02.605000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Because it won't of the builder is not slashed",
        "created_at": "2025-10-03T20:16:20.450000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "we dont have any tests for process withdrawals though, i believe you are talking bout this line:\n`return builder.withdrawable_epoch \u003e= current_epoch or not builder.slashed` in `is_builder_payment_withdrawable`\nalso NC changed it to `return current_epoch \u003e= withdrawal.withdrawable_epoch or builder.slashed`\nbut anyway withdrawals tests have not been merged, they are open here: https://github.com/ethereum/consensus-specs/pull/4468",
        "created_at": "2025-10-03T20:24:05.721000+00:00",
        "attachments": null
    },
    {
        "author": "blockkshane",
        "category": "Cross-layer",
        "parent": "",
        "content": "Read through the 70+ messages, very enlightening!  I synthesized my interpretation of how the current consensus spec supports trusted payments based off the convo.  Please feel free to comment if I misrepresented anything or feel like it's missing any crucial pieces discussed.  Could make for a leisurely weekend read: https://hackmd.io/@blockshane/BJJL43T2le",
        "created_at": "2025-10-03T23:57:06.517000+00:00",
        "attachments": null
    }
]