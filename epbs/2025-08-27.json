[
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "I found a bug in spec test: https://github.com/ethereum/consensus-specs/pull/4537\ncc \u003c@592004585506340885\u003e",
        "created_at": "2025-08-27T02:37:59.387000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "Ive been thinking in verifying the header, if the proposer index and the builder index are the same (self build scenario), could we just not check the header signature / assert signatures to be empty? \nThis actually simplifies the validator client and beacon node workflow a ton",
        "created_at": "2025-08-27T14:17:03.526000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "https://github.com/ethereum/consensus-specs/pull/4539 this pr adds parent block hash, any reason we dont have this? \u003c@755590043632140352\u003e",
        "created_at": "2025-08-27T16:05:19.961000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "it is already included",
        "created_at": "2025-08-27T16:21:23.615000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "in the same place you check ðŸ™‚",
        "created_at": "2025-08-27T16:21:32.577000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "ah good point, I see it in process header `assert header.parent_block_hash == state.latest_block_hash`.. thank you, will close, I wont add that to prysm as well",
        "created_at": "2025-08-27T16:23:47.432000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "curious what you mean by \"hasn't produced\" here\n\nPrysm will only support self-building? or you also include bids from the bid pool here",
        "created_at": "2025-08-27T17:07:48.766000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "it means that Prysm will include either self building or payloads produced by others but also signed by others",
        "created_at": "2025-08-27T17:54:02.595000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "that is: it will not sign an `ExecutionPayloadHeader` for which the corresponding execution payload with the committed block hash is not known to the proposer.",
        "created_at": "2025-08-27T17:55:07.885000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Signing the beacon block is fine, but the payload header should come already with the actual builder or relay or whatever signature",
        "created_at": "2025-08-27T17:55:44.479000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "why would any clients support signing payload that's not built via local EL? that's a lot of legacy code to maintain, testing, and more code coverages we otherwise wouldnt have",
        "created_at": "2025-08-27T18:45:54.425000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "(besides keep using mev-boost as it is today)",
        "created_at": "2025-08-27T18:46:22.940000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "not exactly sure what \"built via local EL\"means, but the avenues are:\n\n* self-build (local EL produces payload)\n* self-build (use builder APIs or equivalent to source payload but looks self-built to protocol)\n* souce payload from the \"bid pool\"\n\nthere is also then the question of how one bid is selected from all of the above sources -- i imagine we are thinking to just do max profit across all channels but i'd be curious to hear thoughts",
        "created_at": "2025-08-27T21:37:29.087000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "i had a similar question to ethdreamer above when looking at the specs for the bid pool, want to think more about \"now is the right time to go ahead and set up this 'channel of last resort'\" though",
        "created_at": "2025-08-27T21:38:19.373000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Not part of this channel but I do think that realistically we may end up with some standardized blind signing for off-protocol deals like preconfirmations and the such. My hope is that these protocols instead use the builder market to get signatures and proposers (or the protocol via MEV burn) only get the  by transitivity from the bid the rewards. But for protocols that require a decentralized set of signers it makes sense that we maintain such an API. I just personally think we should however not support those that are covered in protocol, like payloads",
        "created_at": "2025-08-27T21:40:53.634000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I don't think the spec should be specific as to how to select the bid. Besides security considerations (like a per builder circuit breaker) I think clients should be allowed to do whatever they want and I hope Prysm will provide the user with lots of feature flags to model how to get bids and how to select them.",
        "created_at": "2025-08-27T21:42:58.835000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "And yes I think we should not support the second option of \"self building\" here and Prysm is not planning on supporting it",
        "created_at": "2025-08-27T21:46:16.571000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "yeah makes sense",
        "created_at": "2025-08-27T21:46:50.809000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "are you concerned in the event that (i) other clients do, (ii) most profitable bids are selected and they come from the builder apis, (iii) adoption of prysm goes down as users migrate to other clients?",
        "created_at": "2025-08-27T21:48:16.312000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Not much: the builder API in-protocol we will support, that is contacting builders directly that they themselves sign the bid we will support. I think it's very unlikely (unless there's full builder collusion and this in itself is unlikely to happen because it's trivial to defect) that off protocol bids will beat in protocol ones. If that happens and this drives less adoption of Prysm I think it's something we can live with (not sure what the actual bosses at Prysm think) but the point is that we need eventually to move everything on protocol if we want the protocol to be the auctioneer anyway",
        "created_at": "2025-08-27T21:57:27.483000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "But I repeat I think it's very unlikely off protocol bids with an extra network hop will beat in protocol ones",
        "created_at": "2025-08-27T21:58:19.166000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Builders seem to agree with that statement",
        "created_at": "2025-08-27T21:59:40.500000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "what does \"in-protocol\" mean? just that the signed header can be found in the bid pool?",
        "created_at": "2025-08-27T22:01:20.468000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "Starting a thread on execution payload envelope spec test issue",
        "created_at": "2025-08-27T22:03:48.552000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I don't know what you call bid pool: I consider in-protocol a bid that is signed by a staked 0x03 prefixed builder that is different than the proposer",
        "created_at": "2025-08-27T22:12:56.107000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "We can request these bids directly from builders by polling their HTTP endpoint",
        "created_at": "2025-08-27T22:13:28.056000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "i was assuming clients would keep a buffer of messages seen on this topic: https://github.com/ethereum/consensus-specs/blob/master/specs/gloas/p2p-interface.md#execution_payload_header\n\nand im thinking about it like a mempool or operation pool for the signed headers (aka bids)",
        "created_at": "2025-08-27T22:15:41+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yes the P2P stack is there for a number of reasons but we expect all bids in the happy case to come from requesting them directly from builders. As above I consider this part of the protocol. And having the P2P stack ensures that there can't be a full collussion from builders that are the ones with direct connections to proposers.",
        "created_at": "2025-08-27T22:18:15.143000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "We expect the normal behavior to be \n- proposer gets some bids over P2P\n- proposer contacts a list of builders directly and get more bids\n- proposer selects one, most probably from the second list\n-proposer broadcasts block with that bid \n\nWhat I don't think will happen is: \n2) proposer gets an unsigned bid from a relay/builder\n3) proposer blindly signs it and broadcasts the block as if its self building",
        "created_at": "2025-08-27T22:21:00.853000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "We will support the full first part but not the second one",
        "created_at": "2025-08-27T22:21:21.079000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "do you think it makes sense to have some documentation somewhere for the API flows for the \"list of builders\" route?",
        "created_at": "2025-08-27T22:21:38.404000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "yeah, following you now; makes sense",
        "created_at": "2025-08-27T22:22:06.666000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yes definitely, this is the builder API which we haven't fully written yet but we have discussed at length with builders",
        "created_at": "2025-08-27T22:22:12.899000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "This API will be almost verbatim the current builder API but we may need to sign the messages",
        "created_at": "2025-08-27T22:22:57.398000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "For privacy",
        "created_at": "2025-08-27T22:23:05.594000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "There's an item for this Friday's breakout over this, it will be good if you come",
        "created_at": "2025-08-27T22:23:24.776000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "We will go over this",
        "created_at": "2025-08-27T22:23:31.459000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "am planning on it ðŸ™‚",
        "created_at": "2025-08-27T22:23:33.279000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "if any other client team happens to read this, im curious if this \"do not allow side-band block production\" stance is preferred",
        "created_at": "2025-08-27T22:29:38.672000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "its a minimal change to mev-boost today (just require that the signing entity is a 0x03 validator) and tightens up the block production pipeline quite a bit",
        "created_at": "2025-08-27T22:30:20.426000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "side note: i also dont think this is safe for the builder\n```\n2) proposer gets an unsigned bid from a relay/builder\n3) proposer blindly signs it and broadcasts the block as if its self building\n```\nin the scheme described above proposer controls the last look, not relayer because proposer needs to sign the payload envelope, that means proposer could grief the builder or do weird thing.  Builder has to trust the proposer. Very different than mev-boost scheme today",
        "created_at": "2025-08-27T22:31:25.944000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "i think as long as the builder can get their block out (once they see the fork choice weight to confirm bid selection) it seems fine",
        "created_at": "2025-08-27T22:37:08.025000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "AFAICT this is equivalent to \"optimistic relaying v3\" designs that i hear are on the way to deployment",
        "created_at": "2025-08-27T22:37:25.699000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "ya but in the scheme described above ie\n`self-build (use builder APIs or equivalent to source payload but looks self-built to protocol)`\nor\n`proposer gets an unsigned bid from a relay/builder, proposer blindly signs it and broadcasts the block as if its self building`\nbuilder cant get the payload out, it needs proposer to sign the execution payload. Proposer is the last gate here because \"self-building\" \nso it's tricky, im not saying this is a blocker, but need to understand what the implication is",
        "created_at": "2025-08-27T22:41:56.786000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yeah an off protocol system also includes the proposer sending back the full signed block to the relay of course",
        "created_at": "2025-08-27T22:42:20.602000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "And yes the whole thing about signing the Payload envelope is specially designed so that off protocol systems are much more complicated",
        "created_at": "2025-08-27T22:44:21.643000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "But they are still possible",
        "created_at": "2025-08-27T22:44:35.220000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "not seeing where the proposer needs to sign the execution payload, but i might just be missing it",
        "created_at": "2025-08-27T22:50:55.730000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "whomever signs the bid needs to sign the excecution payload header",
        "created_at": "2025-08-27T23:09:57.802000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "it can be done blindly because the hash is just one part of it",
        "created_at": "2025-08-27T23:10:11.274000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "You mean the payload, not the payload header",
        "created_at": "2025-08-27T23:14:45.123000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "so off-protocol support is still possible for clients that want to do it, but they' ll need to go over more than just mev boost today. If you want the full approach is like this:\n1. Proposer requests bids from relay\n2. Relay sends back a bid with a blockhash and also sends the execution payload requests, and the KZG commitments. so the stuff that it' s on the execution payload envelope except the blockhash\n3. Proposer choses a bid and signs both the full consensus block and the bid inside. \n4. The proposer also needs to perform a full beacon state transition as if the payload envelope had been processed and then compute a state root to get  a blind execution payload envelope that can be blindly signed. The builder cannot do this because the builder doesn' t have the CL block yet. So that's 3 signatures and a full weird STF that the proposer did (this is not trivial to implement in clients)\n5. Proposer sends back all of this to the builder and also can broadcast the consensus block if he wants. \n6. Builder broadcasts the consensus block (although the proposer could have done it before) and then assembles the full execution payload envelope and broadcasts it. Builder also needs to check that the proposer did not screw up the state transition cause it could be unbundled perhaps otherwise.",
        "created_at": "2025-08-27T23:16:06.826000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "yep, the envelope, the above 1--6 describes the full system with the minimum number of network hops",
        "created_at": "2025-08-27T23:16:45.342000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "if you want to do it with more network hops then the proposer would return the blind block to the builder, the builder will prepare the blind payload envelope and send it to the proposer to sign and then the proposer will send it back to the builder and then, only then, the builder can broadcast everything",
        "created_at": "2025-08-27T23:17:33.089000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I very much doubt this process will be carried out. Of course this all goes to drain if people insist on removing trustless payments and if people remove the p2p stack cause builder collusion with 2/3 builders and no p2p fallback may be simpler",
        "created_at": "2025-08-27T23:18:41.461000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "btw I think i was wrong in my previous statement, proposer doesnt hold the last look as long as it can calculate the execution post state root which it can, this means proposer will submit 2 things at once.. that is signed beacon block and signed blinded execution payload envelope",
        "created_at": "2025-08-27T23:27:25.521000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "this is step 5 in the above",
        "created_at": "2025-08-27T23:34:05.456000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yep. Just have to modify `SubmitBlindBlock` end point",
        "created_at": "2025-08-27T23:40:05.746000+00:00",
        "attachments": null
    }
]