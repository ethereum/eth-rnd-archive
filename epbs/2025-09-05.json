[
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "I added some basic tests to that PR",
        "created_at": "2025-09-05T10:03:50.251000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "I thought you wanted to move it somewhere üòÑ",
        "created_at": "2025-09-05T11:49:15.671000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@363800010518822915\u003e is `latest_execution_payload_bid` necessary when we have `execution_payload_availability`?",
        "created_at": "2025-09-05T11:59:01.374000+00:00",
        "attachments": null
    },
    {
        "author": "ethdreamer",
        "category": "Cross-layer",
        "parent": "",
        "content": "just looking for a confirmation on this as it informs the design of a new cache:\n```\nIf a SignedExecutionPayloadEnvelope has been seen referencing the block data.beacon_block_root set data.payload_present = True. Otherwise set it to False.\n```\nThe PTC is only attesting to payload availability and payload validity has no impact yes?",
        "created_at": "2025-09-05T13:06:17.133000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I'd say yes, I think honest behavior should be to attest even before sending notify New Payload",
        "created_at": "2025-09-05T13:44:00.014000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Oh! I may have asked the question of whether people would want to move them to the block so that blobs can be recovered earlier and start to propagate before the Payload. But with dual deadlines and short attestation time it doesn't really make sense",
        "created_at": "2025-09-05T13:45:22.533000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Was this a renaming from `latest_execution_payload_header`? if it was then yes, it is still needed, we check the blockhash for example against that",
        "created_at": "2025-09-05T14:15:18.252000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "it's also used for `blob_kzg_commitments_root` check today but I suspect you can get most of those from `beacon_block`.\n\nI think the open question is more along the line: for current slot, you can get the `header/bid` from the `beacon_block`, so do you really need to use the `state`. For historical purpose, you can just use the `execution_payload_availability` instead of getting an ancestor state... \n\nI've been thinking about that as well, but for a different field, do we need `state.latest_block_hash` if we already have `state.execution_payload_availability`",
        "created_at": "2025-09-05T14:27:11.177000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "ah yeah `latest_block_hash` is the one I actually wanted to ask about",
        "created_at": "2025-09-05T14:35:15.671000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "I guess it could be that `execution_payload_availability` doesn't have the slot you need if `parent.slot` is before `SLOTS_PER_HISTORICAL_ROOT`? (as very unlikely as that is)",
        "created_at": "2025-09-05T14:36:21.112000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "hmmm not really right: we can have many headers that didn't get a payload and we need to check that the parent hash in the payload is the latest imported blockhash",
        "created_at": "2025-09-05T14:40:24.222000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "we have this check in processing the bid that I don' t think can be replaced with the availability bid:\n```\n    # Verify that the bid is for the current slot\n    assert header.slot == block.slot\n    # Verify that the bid is for the right parent block\n    assert header.parent_block_hash == state.latest_block_hash\n...\n```",
        "created_at": "2025-09-05T14:41:03.543000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "Sorry I was comparing with an old branch I have and confusing things.\n\n In Terence's PR, `latest_execution_payload_header` is the old one, corresponding to the full payload header for the last payload that was actually available, so `latest_execution_payload_header.block_hash` is exactly `latest_block_hash`",
        "created_at": "2025-09-05T14:56:05.087000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "hm ya that's test code right, (to get the test to pass)",
        "created_at": "2025-09-05T14:57:30.732000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Oh that changes semantically what `latest_execution_payload_header`  is from the current ePBS branch... that' s kinda crazy",
        "created_at": "2025-09-05T14:57:30.758000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "Oh I thought you wanted to keep it",
        "created_at": "2025-09-05T14:58:49.460000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "Why not keep it? It seems more natural to me to keep the same information in the beacon state that we have now",
        "created_at": "2025-09-05T14:59:43.194000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "i dont have a strong opinion about keeping it, but I currently just set it to empty in `fork.md` at the upgrade and nothing touches it afterwards\npotuz had a strong opinion which I kinda of agree with:\nhttps://discord.com/channels/595666850260713488/874767108809031740/1407420969399619677",
        "created_at": "2025-09-05T15:02:51.729000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I don' t have strong opinions, but I always disliked having this field that is completely useless in consensus and we only use the latest hash. I took the opportunity to get rid of it and that's probably why I chose the name \"header\"  for the bid. I think it's fine to add a new \"bid\"  field and keep the older header around, but that will require changes in the EIP since we would need to update the header when processing the payload (the numbers are not sent in the bid) and the bid when processing the block header",
        "created_at": "2025-09-05T15:15:41.507000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003e I think it's fine to add a new \"bid\"  field and keep the older header around\nwell my current PR adds a new bid field but keeps the header empty, the question is do we still want to maintain the header around or not",
        "created_at": "2025-09-05T15:21:23.264000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Opened this to add a note as \u003c@539495253418180618\u003e requested, and I noted in the PR that this most probably needs to be fully documented when we write the builder API\nhttps://github.com/ethereum/consensus-specs/pull/4565\n\nRegarding which I have a couple of questions. We already started discussing in the last breakout and since this is not part of the first devnet we didn't feel it was urgent, yet still it would be nice to set on the builder API. I have a the following practical questions:\n\n- Do we want to document this API in a separate markdown file besides `validator.md` and `builder.md` ?  or should it go in one of these two? It involves both figures: how the validator requests the bids and how the builder handles those requests. \n- The most important one. Currently validators  **register** with the relay to pass a fee recipient and this is because the relay needs to have this address **before** producing the payload which is committed in the bid.  For bids that are not gossiped over P2P this is no longer necessary. I propose that the request for bids directly on the HTTP endpoint, passes the fee recipient. That is, when the validator hits the builder, it tells it \"give me your best bid for this parent block hash and this parent block root and this gas limit. And pay me in this fee recipient\". The builder can drop block production right there, no need to add any transaction, just add the fee recipient to the request and sign over it. \n\nFor bids over P2P, validators that send them can by default send them to the withdrawal credentials of the proposers. This could invalidate some validators (like staking pools and whatnot). Smarter P2P senders could send to previous fee recipients from the same proposer, this is fine if it's not specified, anyway the proposer gets to decide whatever it wants. \ncc \u003c@1219236235109859332\u003e does this sound good from the builder perspective? (the thing about sending the fee_recipient on the bid request and dropping registrations)",
        "created_at": "2025-09-05T15:26:54.662000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "are you guys thinking about making changes to `get_expected_withdrawals`? \nim asking becasue I want to start writing `process_withdrawals` spec tests, but I wont do it just yet if you think there will / should be changes.. want to save time testing \"builders go first\" sweep and later waste the work",
        "created_at": "2025-09-05T15:28:51.831000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "from what I see there are three options:\n1. Add a new bid and remove the header\n2. Add a new bid and keep the header empty\n3. Add a new bid and keep the older header. \n\nMy preference would be 1 -\u003e 3 -\u003e 2, but it's not a hill I am willing to die for.",
        "created_at": "2025-09-05T15:29:35.391000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "i am 2 -\u003e 3 -\u003e 1, because removing the header messes with generalized index which we got complain a few times here, I think that will be a hard no later and i dont want to change it again",
        "created_at": "2025-09-05T15:32:07.386000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "from this point of view 3 seems to be a compromise that also satisfies your condition",
        "created_at": "2025-09-05T15:37:28.286000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "and it looks like Francesco also prefers that",
        "created_at": "2025-09-05T15:37:42.518000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "if your PR succesfully does put it empty but keeps the current full structure around, I think it's easier for me to add after that PR the full header back",
        "created_at": "2025-09-05T15:38:59.284000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "and at the same time remove the latest block hash because \u003c@520034910149410861\u003e is correct that if we do keep a bid and the header around, we do no longer need the latest block hash",
        "created_at": "2025-09-05T15:39:32.761000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "mmm idk it's fine for me to remove it, but if we do choose to remove it I don't really get what's the advantage of keeping it empty? Versus just reusing it for the bid",
        "created_at": "2025-09-05T15:41:38.445000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yeah that was my original thought, but people from Lodestar (cc \u003c@1035747431461167125\u003e ) complained that for them, removing fields is very hard. I never understood this, since internally it would be just a rename (header -\u003e bid) and that's it. Anyway, if we do keep it, then it's better to populate it cause arguably it allows to prove things against the beacon state root contained in the beacon block root from 4788",
        "created_at": "2025-09-05T15:51:30.007000+00:00",
        "attachments": null
    },
    {
        "author": "l03443",
        "category": "Cross-layer",
        "parent": "",
        "content": "it's useful to know the fee recipient in advance though, the builder needs to finalize the block (state root etc) and doing it during the http call would reduce the useful time for block building",
        "created_at": "2025-09-05T17:32:36.983000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "https://github.com/ethereum/consensus-specs/pull/4527 this pr removes inclusion off and signed header from data column sidecar, I'd appreciate a review \u003c@755590043632140352\u003e and \u003c@520034910149410861\u003e  üôè",
        "created_at": "2025-09-05T17:32:46.333000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "There is not state root involvement, that' s the point",
        "created_at": "2025-09-05T17:33:17.563000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "the fee recipient only goes in the envelope and you can't sign it anyway before getting the request for the bid",
        "created_at": "2025-09-05T17:34:15.431000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "so in case it isn't clear: the builder does not need the fee_recipient at all to finalize the payload, it only needs it for the signed payload wrapper (what we call the `SignedExecutionPayloadEnvelope`)",
        "created_at": "2025-09-05T17:35:07.773000+00:00",
        "attachments": null
    },
    {
        "author": "l03443",
        "category": "Cross-layer",
        "parent": "",
        "content": "I see , and the bid does not include the block hash then?",
        "created_at": "2025-09-05T17:35:57.958000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "yes the bid does",
        "created_at": "2025-09-05T17:36:12.020000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "but the fee recipient has nothing to do with the block hash",
        "created_at": "2025-09-05T17:36:20.077000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "it's not part of the block hash",
        "created_at": "2025-09-05T17:36:27.412000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "the fee recipient should not be confused with the coinbase of the block",
        "created_at": "2025-09-05T17:36:46.754000+00:00",
        "attachments": null
    },
    {
        "author": "l03443",
        "category": "Cross-layer",
        "parent": "",
        "content": "right because the fee recipient is now on the CL",
        "created_at": "2025-09-05T17:37:12.450000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "no, the fee recipient is on the EL",
        "created_at": "2025-09-05T17:37:21.537000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "it is the address in the EL where the withdrawal from the CL will be delivered",
        "created_at": "2025-09-05T17:37:36.164000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "the builder's balance on the CL gets put in a withdrawal that gets delivered to the fee recipient",
        "created_at": "2025-09-05T17:37:57.913000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "~~thank you so much, sending you my seed right now~~ Oh some mod deleted some messages and now mine looks like I was sending my seed to \u003c@1219236235109859332\u003e",
        "created_at": "2025-09-05T17:38:07.756000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "ya i banned the person right away and deleted all his messages",
        "created_at": "2025-09-05T17:54:36.915000+00:00",
        "attachments": null
    }
]