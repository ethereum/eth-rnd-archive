[
    {
        "author": "julianma_",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@755590043632140352\u003e just wondering if Prysm, or if you know whether other clients have made changes to localBlockValueBoost since the post from \u003c@911055007837720597\u003e (https://hackmd.io/@dataalways/censorship-resistance-today). The post shows that localBlockValueBoost only leads to very few reversions and is relatively expensive for proposers compared to min-bid.",
        "created_at": "2024-08-05T10:05:48.700000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Prysm has this \u003chttps://github.com/prysmaticlabs/prysm/pull/14205\u003e that hopefully will merge today after I pressure \u003c@363800010518822915\u003e to review it",
        "created_at": "2024-08-05T10:11:50.082000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@755590043632140352\u003e regarding :\nhttps://x.com/potuz_eth/status/1819391927776584141 https://github.com/status-im/nimbus-eth2/pull/6443",
        "created_at": "2024-08-05T11:10:41.825000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Nice!!",
        "created_at": "2024-08-05T11:32:42.709000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "can address for Nimbus, in general might not add another flag along these lines for a while. my suspicion is that it will get pushed into some beacon API in the future if people like it, and want to see how that plays first. the initial idea was compelling enough that we copied Prysm's approach, and now have to support for compatibility both that and the beacon API parameterization. want to avoid similar outcomes in the future",
        "created_at": "2024-08-05T11:42:24.434000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "the cost is fairly high over long run of just-add-a-flag",
        "created_at": "2024-08-05T11:43:03.635000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "and it's already part of MEV boost, which is one of my questions/concerns: I get that the point is to shift ecosystem defaults, but, the flag exists, and my preference would still be fixing this upstream in `mev-boost` (or `commit-boost` etc)",
        "created_at": "2024-08-05T11:46:21.469000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "rather than random workarounds in every single CL",
        "created_at": "2024-08-05T11:46:38.023000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "also\n\u003e Lighthouse and Nimbus are still discussing the possibility of changing the default but both seem unlikely to act.\nNimbus's default is 10% now",
        "created_at": "2024-08-05T11:50:58.353000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "IMO Prysm got it right and the Beacon API just sucks!",
        "created_at": "2024-08-05T11:56:04.569000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "at any rate they are both kinda irrelevant as that thread by Dataalways showed.",
        "created_at": "2024-08-05T11:56:39.334000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "Which did prysm get right and which bit of the beacon API sucks, out of curiosity.",
        "created_at": "2024-08-05T14:42:19.666000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The fact that we don't allow preferring the builder. We don't have a builder boost factor but a proposer one",
        "created_at": "2024-08-05T14:52:21.299000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "the argument was that certain staking pools, etc require the builder, and that people wanted a unified API (i.e. just use `produceBlindedBlock` was not ideal, people didn't want it to be the legacy thing)",
        "created_at": "2024-08-05T14:54:19.408000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "Isn't that `builder_boost_factor` in https://ethereum.github.io/beacon-APIs/#/Validator/produceBlockV3? That can be set for any individual proposal.\n\nOr are you talking about preferring one builder over the other?",
        "created_at": "2024-08-05T14:55:53.170000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "That builder boost factor we support only because it was added to the API. Our flag would be mathematically equivalent to that but only allowing it to be less than 1",
        "created_at": "2024-08-05T14:58:08.751000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I'm aware of the argument, still don't like it",
        "created_at": "2024-08-05T14:58:38.227000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "So your issue is with the range of the value? Not sure that restricting the range can be considered a better solution.",
        "created_at": "2024-08-05T14:59:11.847000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "well, that is a point in its own way -- the prysm approach allowed a version of this in Nimbus which carefully could never possibly overflow, but hit a useful range. not feasible with the beacon API, easily 10x as complex, with the saturating bigint arithmetic etc",
        "created_at": "2024-08-05T15:00:14.713000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "Nimbus just bit that bullet because, no real option. but a real loss",
        "created_at": "2024-08-05T15:00:33.113000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "You could say that, our flag is a proposer boost and it's a positive value in percentage, so that 20 means 1/ 1.2 for the builder's boost in the comparison",
        "created_at": "2024-08-05T15:01:25.548000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "the vast (_vast_) portion of the range in the beacon API version is useless",
        "created_at": "2024-08-05T15:01:59.030000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "it's just there out of some pointless sense of generality",
        "created_at": "2024-08-05T15:02:20.308000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "but implementations have to handle and test for it anyway",
        "created_at": "2024-08-05T15:02:31.058000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I don't think so, I don't know the internals, Jim is here so he can explain but I suspect it's there so that clients like vouch can pick Prysm block for example when it would refuse to serve a blind one otherwise",
        "created_at": "2024-08-05T15:03:34.034000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "The range is because the API tends to use uint64 for numbers. Agree that it is mostly useless, but the alternative was to use a different type which seemed to be a worse result.",
        "created_at": "2024-08-05T15:03:53.530000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I maintain what we should refuse to provide blind blocks when we think so",
        "created_at": "2024-08-05T15:04:09.130000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "but between `2**30` and `2**35` and `2**40`? but can't just blindly treat them all as \"infinite\" because in theory, etc",
        "created_at": "2024-08-05T15:04:35.308000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "That's an explicit feature of the V3 API endpoint.",
        "created_at": "2024-08-05T15:04:35.530000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "and, yes, I largely respect the use-`uint64` everywhere instinct, it means simpler serialization, and here realistically I think people would not have formed a consensus around the ranges required to avoid overflow (probably ~16-bit ints or so with special flags for the \"infinite\" poles), which is why I didn't push for it at the time",
        "created_at": "2024-08-05T15:06:12.253000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "You could likely have a realistic max based on the idea that there are (for example) at most 1 billion ETH available as a proposer reward, so your range is 10^27 or whatever (I'm on vacation so I don't have the effort to work it out properly)",
        "created_at": "2024-08-05T15:07:44.277000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "doesn't matter what a \"realistic\" max is, really, once it's in spec someone might poke the API and find a \"bug\"",
        "created_at": "2024-08-05T15:08:27.103000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "once it went `uint64` it was done, didn't matter anymore",
        "created_at": "2024-08-05T15:08:39.242000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I don't understand what the uint64 has to do with my complain though. Our flag is also a uint64, only complain is that we don't allow to favor the builder",
        "created_at": "2024-08-05T15:11:04.308000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "they're not entirely separate, the design space of wanting to be able to do always-builder and always-engine plus have a one-dimensional knob to turn implied janky math",
        "created_at": "2024-08-05T15:12:24.775000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "with a bunch of non-purely arithmetic-special-cases",
        "created_at": "2024-08-05T15:12:47.090000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "That's the point of my complain: I do not want to allow the only builder case, and I think Prysm should not allow this even if the API eventually says so",
        "created_at": "2024-08-05T15:13:41.956000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think Prysm should not have even allowed prefer builder by 10%",
        "created_at": "2024-08-05T15:14:13.838000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "But I'm only 1 of 10 in the team",
        "created_at": "2024-08-05T15:14:31.982000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "The API attempted to unify a bunch of different options that the different clients already implemented.  And, again, it is always ultimately up to the beacon node as to what proposal it returns.",
        "created_at": "2024-08-05T15:15:43.180000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "If you can convince the rest of your team to go a certain way with your client it is within spec to do so.",
        "created_at": "2024-08-05T15:16:23.671000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I don't think so, I think we are required by the API to actually support the builder boost with the specified range now",
        "created_at": "2024-08-05T15:18:48.028000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "also it sort of enshrines the builder API specifically I think, would have to check the verbiage",
        "created_at": "2024-08-05T15:21:17.524000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "\"The returned block may be blinded or unblinded, depending on the current state of the network as decided by the execution and beacon nodes\"\n\nWe put this into the API description to allow such behaviour.  So you can return the locally built unblinded block if your node considers it the best thing for the network.",
        "created_at": "2024-08-05T15:21:43.414000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "So it would be perfectly fine to tell our users that they are allowed to put whatever they want for the range in the builder boost factor, but we will simply ignore it?",
        "created_at": "2024-08-05T15:23:02.027000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I'm not looking forward to write the documentation of that flag",
        "created_at": "2024-08-05T15:23:17.393000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "Absolutely. If you are detecting censorship then it would be expected. And if your team decides that network conditions are such that you should never return a proposal containing a relay block with less than that of a local block then so be it. Yes you would need to explain this, but it wouldn't necessarily be a negative thing. Lots of people care about decentralisation, and may be happy that the client did this for them.",
        "created_at": "2024-08-05T15:26:33.143000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "This is not the point though, for censorship or whatever reason I agree we have a way out already... my point is that I want to **never** allow my users to specify that the builder block has any advantage. Doing this and at the same time satisfying the API requirement requires us ignoring the user's input explicitly, without any externalities like censorship or whatever",
        "created_at": "2024-08-05T15:30:55.160000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think it was bad design from the start to allow users in the spec (namely force clients to implement) to favor the builder's block",
        "created_at": "2024-08-05T15:31:21.671000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "it's fine if clients wanted to implement that, but I do not like the fact that Prysm had to implement it",
        "created_at": "2024-08-05T15:31:35.968000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "do you have the same concern about `produceBlindedBlock`?",
        "created_at": "2024-08-05T15:31:51.356000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "But as per the quote above the beacon node absolutely *can* decide to return a locally built block if it decides that it should. This was left open-ended on the docs on purpose to allow you to do this!",
        "created_at": "2024-08-05T15:34:53.510000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "As I say, there were beacon nodes that already allowed this and there was no consensus on removing it. But the language gives you the leeway you wanted.",
        "created_at": "2024-08-05T15:36:04.290000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "not without having to document to our users that while they are allowed to set whatever value they want, we will explicitly ignore it",
        "created_at": "2024-08-05T15:36:41.061000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "it turned it from something some BNs chose to do to something expected",
        "created_at": "2024-08-05T15:38:06.208000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "a default the lack of which has to be, yes, explicitly explained",
        "created_at": "2024-08-05T15:38:28.909000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "Correct. If you believe that it is best for the network then I don't see why putting that reasoning into your documentation is a problem.",
        "created_at": "2024-08-05T15:39:06.689000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think this is a mistake in the beacon API to force us to implement this",
        "created_at": "2024-08-05T15:39:23.462000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "by the same token, there was no consensus prior to allow it either. I don't feel as strongly as \u003c@755590043632140352\u003e on this point, but directionally at least I agree",
        "created_at": "2024-08-05T15:39:30.301000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "this is a canonical example of over specification",
        "created_at": "2024-08-05T15:39:32.199000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "It doesn't force you to do anything, it's your choice.",
        "created_at": "2024-08-05T15:40:07.455000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "that's disingenuous",
        "created_at": "2024-08-05T15:40:14.412000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "and you know that",
        "created_at": "2024-08-05T15:40:17.019000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "It does",
        "created_at": "2024-08-05T15:40:17.708000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "if we make the beacon API explicitly optional then I agree",
        "created_at": "2024-08-05T15:40:35.229000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "and even then it's a stretch",
        "created_at": "2024-08-05T15:40:40.493000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "no BN has to do anything, but then, yeah, it's not really implementing the beacon API anymore",
        "created_at": "2024-08-05T15:40:47.689000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I would also not want to have to deal with the client diverity cries of Prysm not implementing some beacon API feature",
        "created_at": "2024-08-05T15:41:26.647000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "In this specific case the API documentation states that it is ultimately up to the beacon node to decide what to return.  So no forcing.",
        "created_at": "2024-08-05T15:42:36.620000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "It is forcing me to accept the user input",
        "created_at": "2024-08-05T15:45:33.199000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "not to obey it",
        "created_at": "2024-08-05T15:45:41.409000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "I really don't, and it really was never the intent. The description went through any number of revisions to reach what we thought met everyone's requirements. I'm still unclear as to why the beacon node cannot make its own decision on the selection of local Vs relay payload.",
        "created_at": "2024-08-05T15:45:46.449000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "which is my point above",
        "created_at": "2024-08-05T15:45:46.617000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "This is not really about making a decision (at least not in my complain), it's about having to actually implement it",
        "created_at": "2024-08-05T15:46:18.838000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I need to have a flag, listen to it, document it, and let my users enter any number",
        "created_at": "2024-08-05T15:46:30.425000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "To take it into consideration, but not for it to be overriding all other concerns.",
        "created_at": "2024-08-05T15:46:40.335000+00:00",
        "attachments": []
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I'm not versed in the APIs so not sure which one you are referring to, do you mean the one we had `v1/validator/blinded_blocks`? that one I didn't have trouble with, if we were requested explicitly a blinded block that's fine, and then the node can reject for whatever reasons. This I believe was changed in `v3` to a unified endpoint which takes this `builder_boost_factor`.",
        "created_at": "2024-08-05T16:11:58.895000+00:00",
        "attachments": []
    }
]