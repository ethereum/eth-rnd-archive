[
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "https://x.com/giuliorebuffo/status/1866616654576370087?s=46\u0026t=isKsf6v9K6M4UPb8l84KHQ i’m trying to reason about the gas limit increase possible assuming we only care about the resource constraints binding short-term execution (so bandwidth, compute, state accesses etc, not state growth or history growth). With pipelining, we still need the next beacon proposer to receive the current payload and evaluate it in order to build on it right? The builder is expected to release at t=6s, but in practice may release up to the deadline for PTC members to vote, which is t=9s. I don’t understand where the numbers in tweet come from",
        "created_at": "2024-12-11T09:11:17.983000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "(cc \u003c@687974325072035882\u003e btw!)",
        "created_at": "2024-12-11T09:23:57.296000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "yes sorry - so honestly it is probably closer to 2x than 3x",
        "created_at": "2024-12-11T09:26:06.808000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "the reasoning is that current L1 bottlenecks are:\n- History growth\n- opcodes who do not scale",
        "created_at": "2024-12-11T09:26:30.344000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "and generally the time it takes to process worst-case block",
        "created_at": "2024-12-11T09:26:44.616000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think that if you have more time you can scale to the extent with ePBS and 4444s effectivelly",
        "created_at": "2024-12-11T09:27:10.547000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "state growth is yet to become a bottleneck on L1 even regarding to verkle - me and \u003c@353136597522448385\u003e ran some numbers there and it is not so bad up to 120mn gas when it comes to conversion time and the rest is just engineering problem on guillaume part",
        "created_at": "2024-12-11T09:28:38.268000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "thanks! which are \"opcodes who do not scale\"?",
        "created_at": "2024-12-11T09:28:55.155000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "CC \u003c@758579010027782144\u003e - he asked me not to share ;)",
        "created_at": "2024-12-11T09:29:01.602000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "(and yeah for the purpose of this discussion I'm really ignoring the long-term resource constraints like state growth or history growth. though state accesses also scale a bit with state size)",
        "created_at": "2024-12-11T09:29:34.317000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "no - not that much",
        "created_at": "2024-12-11T09:29:43.527000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "it grows logarithmically",
        "created_at": "2024-12-11T09:29:49.806000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "right yes, that's still a bit of growth but agreed we can ignore in first approximation",
        "created_at": "2024-12-11T09:30:10.787000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "and it grows 30 GB/year - it is a bit far to be problematic imo. you can look up numbers on how DBs random access grow with respect to size - there is lots of research and is essentially the same thing",
        "created_at": "2024-12-11T09:30:43.431000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "Erigon supports polygon and access time is 30% slower with 4x the state of mainnet",
        "created_at": "2024-12-11T09:31:14.817000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "just trying to think through what's the multiple increase of gas limit possible with pipelining in ePBS, based on the short-term resource constraints. the way I see it:\n- today we have at most 4s between the block release and the attester votes. these four seconds must include the propagation time (PT) + the execution time (ET), for attesters to make a claim that it is valid.\n- in ePBS we'd have at most 3s between payload release and PTC vote, but the PTC members only need to vouch for timeliness, so the propagation time is the binding thing for the builder when they make their release. the nice thing is there is no reason for the builder to delay their release, they already committed to the payload so timing games are not worth playing, but let's say in the worst case they'd aim to release at `t = 9 - PT`, so then we'd have 3 full seconds for ET for the next proposer to execute the block.\nHow do you get to 2x increase from this then? wondering what's the model. My understanding is that today `PT` is in the order of \u003e 1s, which means that `ET` indeed is \u003c 3s, but I don't see how today's `ET` is at most half of ePBS's `ET` in the worst case",
        "created_at": "2024-12-11T09:37:22.947000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "So some things here - execution block building takes more than simple execution and overall this is better because right now that is crammed into 4 secs",
        "created_at": "2024-12-11T10:36:28.741000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "3 secs for ET is way more than we get today",
        "created_at": "2024-12-11T10:36:51.391000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "like 2x if not more",
        "created_at": "2024-12-11T10:37:14.751000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "I am still reading through ePBS and understanding more but really - right now you do not have \"4s between the block release and the attester votes\" this is a very theorical number - that is delayed by how much it takes to build the block and THEN you process it",
        "created_at": "2024-12-11T10:38:40.724000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "3s for the next proposer to process the block is better than today",
        "created_at": "2024-12-11T10:39:03.735000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "3s with timing games is a dream imo",
        "created_at": "2024-12-11T10:39:52.784000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "yeah i was assuming that the block was built before `t = 0` here. technically the honest validator specs expects you to release the block at that time, implying that it's built beforehand",
        "created_at": "2024-12-11T10:42:13.153000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "That is not possible - you need to pack attestations",
        "created_at": "2024-12-11T10:42:54.410000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "You can pre-build execution block tho",
        "created_at": "2024-12-11T10:43:03.516000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "how much better is what i'm trying to get at i suppose, in the best case for today",
        "created_at": "2024-12-11T10:43:10.873000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "sure, but you could also consider that receiving the aggregates is bound by how much time you need to pack them, so aggregates should arrive to you a bit before `t=0` so you have time to pack them for timely release of the block",
        "created_at": "2024-12-11T10:44:29.121000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yes - you do receive them but you still need to build the CL block and do the state root",
        "created_at": "2024-12-11T10:45:30.431000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "Anyway I honestly never saw a block arriving at t=0 so j just assume this does not really happen",
        "created_at": "2024-12-11T10:47:01.951000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "Or even close to that",
        "created_at": "2024-12-11T10:47:08.337000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "ofc, but if I take timely block release as a fixed point, these can also be scheduled beforehand so i meet the release at `t=0`. this is a bit orthogonal anyways, but agreed that today in the worst case you need to account for block building time within the first 4s interval",
        "created_at": "2024-12-11T10:47:09.527000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "if it's released at t=0 it wouldn't be received as early as t=0 but yeah i guess you mean never seen a block so close to t=0",
        "created_at": "2024-12-11T10:47:41.695000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "But if you also tell me that the 3s is with timing games (was not aware) then it will be better",
        "created_at": "2024-12-11T10:47:56.346000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yes",
        "created_at": "2024-12-11T10:47:57.659000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "I am saying that theorically you are right. Practically, no.",
        "created_at": "2024-12-11T10:48:12.720000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "sure sure",
        "created_at": "2024-12-11T10:48:19.927000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "and yes for timing games, the thing is they are played as much as they can afford to be played. so if the block size increases there is less room to play them, all else equal (in particular, if the execution time budget remains constant). so let's say if today we always had 100% of the time timing games played such that people delay by 1s the block release, then we could add 1s of execution time and timing games would disappear (this is a spherical cow model, assuming perfect latency). what i'm saying is we can assume away timing games when thinking about the worst case, in the worst case there is no time to play them",
        "created_at": "2024-12-11T10:50:27.151000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "so i'm still missing what's the worst case execution time today, then assuming worst case execution time in ePBS is 3 seconds, the ratio of the two would give me the gas limit multiple that ePBS affords, imo",
        "created_at": "2024-12-11T10:51:33.836000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "I know we can just not really consider timing games for this - its just cool to have that property :) but you wont receive a block at=0 nonetheless. Your question is a bit hard to answer but block building is still a major thing in the slot time and the best i see is t=1, usually i see t=2. If you can remove that - i think you can effectivelly do a 2x. Also if you dont assume timing games in ePBS, you have more than 3secs no?",
        "created_at": "2024-12-11T10:55:50.241000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "Ah no misread sorry",
        "created_at": "2024-12-11T10:56:33.283000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "You have 3 secs",
        "created_at": "2024-12-11T10:56:40.140000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "Wait no you do assume timing games",
        "created_at": "2024-12-11T10:57:22.788000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "well I just don't think we can get to the number i'm looking for by looking at something other than the worst case. i don't really need to assume timing games, but more, in the worst case the propagation of the payload by the builder can happen up to t=9s before the PTC attests that it wasn't timely. so in the worst case you have 3s of execution time (and in fact, if you really care about timely release of the beacon block by the next proposer, you should have strictly less than 3s, but here we'll definitely have timing games and they can be played even more since the ePBS beacon block proposer proposes a much smaller block, without the payload)",
        "created_at": "2024-12-11T11:02:22.556000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "what is PT here? building+propagating?",
        "created_at": "2024-12-11T11:02:46.923000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "because if it is, it will just find equilibrium like timing games for the same reason",
        "created_at": "2024-12-11T11:03:19.163000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "you cannot assume the \"best\" case, but there will be an equilibrium most likely just like todays PT then",
        "created_at": "2024-12-11T11:04:24.576000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "because realistically PT can take 3.5secs today too depending on the machine but that is mostly a block building thing which have more time under ePBS",
        "created_at": "2024-12-11T11:04:45.012000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "in any case - it is better",
        "created_at": "2024-12-11T11:06:00.255000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "idk need to think more but 6 secs for block building is better than today if you we have no timing games - overall you have the entire slot to do block building and execution time in ePBS - so i do not really understand why is it not better? the worst case of today is not t=0, if you want to be precise it is 3.8s or something like that or as much as we allow today",
        "created_at": "2024-12-11T11:07:52.746000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "the thing is: if you do this kind of \"worse\" case on the current design then you can have proposer that broadcast at t=3.9 (not t=0) too, you cannot stop that either. having a cap is good for that tho. assuming t=0 for today's slot time and PT=6 for ePBS is comparing best case of today vs worst case of ePBS",
        "created_at": "2024-12-11T11:15:07.523000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@755590043632140352\u003e correct me if i am wrong, I read about ePBS yesterday so I might be getting some stuff wrong :P",
        "created_at": "2024-12-11T11:15:55.596000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "well not really, timing games are determined by how long the execution takes, so if the block size is larger, the timing games get smaller. need to drop unfortunately, I think I just don't have yet a sense of where the 2x comes from, would be good to align on a model for how this number comes up",
        "created_at": "2024-12-11T13:17:34.853000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "We' re thinking on moving PTC much closer to 6 seconds in fact, the builder should be able to reveal close to 4 seconds and there's no reason to give them slack since they can't be be grieved. At any rate, honest builder behavior is to broadcast as soon as 40% of attesttions are seen and that's less than 4 seconds into the slot.",
        "created_at": "2024-12-11T13:25:55.392000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "Its not about timing games - its the fact that the assumption that the worst case or any case for current design to t=0 assuming no timing games is wrong. It does not happen in practice. So you do have more time with ePBS and even better gurantees",
        "created_at": "2024-12-11T13:28:24.309000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "the issue is that you are considering no timing games today vs a timing game on the builder on ePBS that doesn' t seem to be profitable at all for them, they are only hiding the tx that were included which doesn' t give them any profit at all and risk them being reorged. Builders need of the order of milliseconds to simulate the block, so they aren' t grieved at all by seeing the payload at 9 vs 6 vs 4",
        "created_at": "2024-12-11T13:28:35.619000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "In real life we expect to have about 8 seconds to execute the block (the proposer) and about 11 seconds for the attesters",
        "created_at": "2024-12-11T13:29:09.129000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "and this is independent on where we put PTC. Moving PTC to say 6 seconds the only thing that it does it bounds the worst case scenario to about 5 seconds for execution, but in the absence of any relevant timing games to delay broadcasting, the expected time of execution remains 8 seconds",
        "created_at": "2024-12-11T13:30:25.608000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "potuz explained my point better here :P",
        "created_at": "2024-12-11T13:48:48.139000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Cross-layer",
        "parent": "",
        "content": "so the claim is that today we have roughly 1-3 secs of execution time, while with ePBS you'd assume we have 5-8 secs",
        "created_at": "2024-12-11T16:03:54.035000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@363800010518822915\u003e you probably have handy the averages today? I thought we have less than 2 seconds for validation today on over 80% of blocks?",
        "created_at": "2024-12-11T17:35:23.580000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "also notice \u003c@486501030046203915\u003e that the lower threshold is now applicable to a single validator (the proposer) instead of everyone in the committee (the attesters). The latter get 8-11 seconds",
        "created_at": "2024-12-11T17:42:30.641000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I understand that the block size is constrained by the minimum value, but the resilience is still larger nonetheless",
        "created_at": "2024-12-11T17:43:23.730000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "Just checked. The number looks better. It's about 40% of the blocks (last 4 days). This used to be higher",
        "created_at": "2024-12-11T18:41:17.365000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "Screenshot_2024-12-11_at_10.39.49_AM.png",
                "content": "b8a3b764209f2e740ee641ef65557fe963e22acd77d455c6b842379460200f09"
            }
        ]
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "Query if anyone is interested: `count_over_time((rate(block_arrival_latency_milliseconds_sum[30s]) / rate(block_arrival_latency_milliseconds_count[30s]) \u003e 2000)[4d:30s]) \n/ count_over_time(rate(block_arrival_latency_milliseconds_sum[30s])[4d:30s])`",
        "created_at": "2024-12-11T18:41:26.374000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "so half the blocks have less than 2 seconds",
        "created_at": "2024-12-11T18:42:43.873000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "can you post the graph with the average arrival time?",
        "created_at": "2024-12-11T18:43:14.369000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I have no access to my node here",
        "created_at": "2024-12-11T18:43:21.432000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "",
        "created_at": "2024-12-11T18:47:11.625000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "Screenshot_2024-12-11_at_10.47.03_AM.png",
                "content": "2a769b101062f30826d039f66b876207ccfc481d83451f8cb8ce159789422d7a"
            }
        ]
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "there's a huge drop off at 1.5s\n- 90% of blocks arrive after 1.5s\n- 80% of the blocks arrive after 1.6s\n- 70% of the blocks arrive after 1.7s",
        "created_at": "2024-12-11T18:49:34.706000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Cross-layer",
        "parent": "",
        "content": "oh right I was using the forkchoice  timestamp - yes the block arrives earlier",
        "created_at": "2024-12-11T22:56:21.975000+00:00",
        "attachments": null
    }
]