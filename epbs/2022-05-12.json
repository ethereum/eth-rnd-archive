[
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "how do https://github.com/ethereum/beacon-APIs/blob/master/apis/validator/register_validator.yaml and https://github.com/ethereum/builder-specs/blob/v0.0.0/apis/builder/validators.yaml relate to each other? They're similar, but some slight differences",
        "created_at": "2022-05-12T08:07:50.021000+00:00",
        "attachments": []
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "The only difference I see is that the builder API takes a single entry, whereas the beacon-api takes an array of entries, are there other differences too? Perhaps the builder-api should also use an array ü§î  (cc/ \u003c@543900561460822016\u003e)",
        "created_at": "2022-05-12T08:19:54.964000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003e Perhaps the builder-api should also use an array\n\nYes please.",
        "created_at": "2022-05-12T08:26:07.639000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "There were arguments in one of the GitHub issues or PRs from Danny Ryan against using an array because it would be less compatible semantically with libp2p gossiping.",
        "created_at": "2022-05-12T08:26:49.742000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "At one point the builder-api one was called `registerValidators`",
        "created_at": "2022-05-12T08:27:13.073000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "Not sure that the p2p piece is relevant for a REST-based API.  The obvious equivalent is the endpoint for submitting attestations https://ethereum.github.io/beacon-APIs/#/ValidatorRequiredApi/submitPoolAttestations that takes an array then sends the individual array elements on the p2p network.",
        "created_at": "2022-05-12T08:41:27.765000+00:00",
        "attachments": []
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "https://github.com/ethereum/builder-specs/pull/10 \u003c-- registerValidator to use array of entries",
        "created_at": "2022-05-12T09:02:46.675000+00:00",
        "attachments": []
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "And yeah, I think any p2p implementation would independent from the REST API spec anyway. I recall that another discussion item around this was about the error/success response. But since mev-boost will regularly resend the registration to all relays, i think it should be okay to return success if one relay received it.",
        "created_at": "2022-05-12T09:15:33.494000+00:00",
        "attachments": []
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "The link I gave above has a response system that could be used as a template for returning partial errors for this call.",
        "created_at": "2022-05-12T09:16:31.016000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "There seems to be some inconsistency in whether mev-boost is viewed as a thin layer or not -- if it's a thin layer that's just kind of a proxy without much internal logic, then that's less intrinsic to what it does. If, as was discussed in other places, currently mostly a thin proxy but really a nascent layer with more built-in logic, then it's reasonable to put that sort of translation into it.",
        "created_at": "2022-05-12T09:17:38.417000+00:00",
        "attachments": []
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "i'm not quite following ü§î  do you have a specific example in mind?",
        "created_at": "2022-05-12T12:58:18.289000+00:00",
        "attachments": []
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "Re error handling on registerValidator: https://github.com/ethereum/builder-specs/issues/8",
        "created_at": "2022-05-12T14:55:17.785000+00:00",
        "attachments": []
    },
    {
        "author": "realbigsean",
        "category": "Cross-layer",
        "parent": "",
        "content": "How should we default gas limit in the CL? Set it to the parent payload's value, outsource it to the builder, or can we get the info from a local EE otherwise?",
        "created_at": "2022-05-12T15:17:50.423000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "is it possible in mergemock relay, instead of it spinning its own engine (geth i think) i can provide it a geth engine url?",
        "created_at": "2022-05-12T16:39:57.535000+00:00",
        "attachments": []
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "mergemock relay only works with it's internal engine. there is a open PR for `eth_getBlockByHash/Number` to get the first block, then call FCU -\u003e getHeader -\u003e getPayload for testing (https://github.com/protolambda/mergemock/pull/27)",
        "created_at": "2022-05-12T17:05:59.780000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "well, in discussions regarding whether a CL might just embed current mev-boost functionality, the idea that currently that might be feasible but that mev-boost might also become more elaborated, rendering the exercise less useful, but at the same time, so far there's not much evidence of such sophistication (granted, it's not part of an MVP here)",
        "created_at": "2022-05-12T17:33:33.452000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "`process '${PATH_TO}/mergemock/mergemock' started with executable stack`",
        "created_at": "2022-05-12T17:34:00.144000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "in my `dmesg` running `mergemock`.",
        "created_at": "2022-05-12T17:35:02.057000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "yes this is exactly what i need, when can we expect this to be merged?",
        "created_at": "2022-05-12T17:37:21.661000+00:00",
        "attachments": []
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "https://github.com/flashbots/mergemock/tree/beta1 is the branch that has the API, all the correct datatypes and the `eth_getBlockBy*` API, until the PRs at mergemock are merged (https://github.com/protolambda/mergemock/pulls cc/ \u003c@543900561460822016\u003e \u003c@203220829473996800\u003e).",
        "created_at": "2022-05-12T17:38:11.206000+00:00",
        "attachments": []
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "What's still missing is the domain in the BLS signature, it currently signs without a domain (tracking in https://github.com/protolambda/mergemock/issues/29)",
        "created_at": "2022-05-12T17:39:01.339000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "awesome, let me pull that branch and see how it goes",
        "created_at": "2022-05-12T17:39:03.951000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "yes, tested validator registration, was throwing invalid signature error, inspected code a bit to see its just signing hashTreeRoot of signedValidatorRegistrationV1, switched to that and signatures passed",
        "created_at": "2022-05-12T17:40:24.809000+00:00",
        "attachments": []
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "```bash\ngo run . relay\ncurl --header 'Content-Type: application/json' --request POST 'http://127.0.0.1:8551' --data-raw '{\n    \"jsonrpc\":\"2.0\",\n    \"method\":\"eth_getBlockByNumber\",\n    \"params\":[\"latest\", false],\n    \"id\":1\n}'```(edited to add content-type header)",
        "created_at": "2022-05-12T17:40:25.339000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "```\nINFO   [2022-05-12T22:23:18+05:30] http: POST /eth/v1/builder/validators 200     durationMs=\"5\" method=\"POST\" path=\"/eth/v1/builder/validators\" status=\"200\"\n```",
        "created_at": "2022-05-12T17:40:37.114000+00:00",
        "attachments": []
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "if I don't pass `-H \"Content-Type: application/json\"` with `curl`, it returns\n\u003e invalid content type, only application/json is supported\nwhich seems correct. But with that change, it works for me as well",
        "created_at": "2022-05-12T18:13:23.482000+00:00",
        "attachments": []
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "that's great to hear, and thanks for the input! put up some minimal docs with that included: https://github.com/flashbots/mev-boost/wiki#testing",
        "created_at": "2022-05-12T18:15:39.730000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@388610194608750595\u003e  i am getting very weird error plugging into our http json Client module: ```\netchError: invalid json response body at http://localhost:8661/eth/v1/builder/validators reason: Unexpected end of JSON input\n    at /mnt/code/mintsugi/lodestar/node_modules/node-fetch/lib/index.js:272:32\n    at runMicrotasks (\u003canonymous\u003e)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\n    at HttpClient.request (/mnt/code/mintsugi/lodestar/packages/api/src/client/utils/httpClient.ts:114:14)\n    at HttpClient.json (/mnt/code/mintsugi/lodestar/packages/api/src/client/utils/httpClient.ts:71:12)\n```",
        "created_at": "2022-05-12T19:03:04.013000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "could it be that response is not being written with the json headers?",
        "created_at": "2022-05-12T19:03:21.486000+00:00",
        "attachments": []
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "fixed - please update the beta1 branch ^^",
        "created_at": "2022-05-12T19:20:56.595000+00:00",
        "attachments": []
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "ok awesome! that fixes it, beta1 branch seems to be working nice for me with my setup now, will continue the integration! thanks for the resolution üôè",
        "created_at": "2022-05-12T19:26:11.679000+00:00",
        "attachments": []
    }
]