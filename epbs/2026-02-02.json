[
  {
    "author": "nero_eth",
    "category": "Cross-layer",
    "parent": "",
    "content": "What is the latest around handling builders around the fork transition?\nIn the specs it seems a builder's deposit must be finalized although in builder.md it says *processed* here: ⁨`Builders are active as soon as the deposit is processed on the consensus layer.`⁩",
    "created_at": "2026-02-02T07:47:28.597000+00:00",
    "attachments": []
  },
  {
    "author": "jih2nn",
    "category": "Cross-layer",
    "parent": "",
    "content": "If you're referring to a transition from Fulu to Gloas, this [PR](https://github.com/ethereum/consensus-specs/pull/4868) would give you an answer",
    "created_at": "2026-02-02T11:13:05.728000+00:00",
    "attachments": []
  },
  {
    "author": "jtraglia",
    "category": "Cross-layer",
    "parent": "",
    "content": "Hmm yes, that sentence is a bit misleading now. We added the deposit finalization requirement & forgot to update that line. After ACDT, I'll submit a PR to get that cleared up.",
    "created_at": "2026-02-02T13:51:42.160000+00:00",
    "attachments": []
  },
  {
    "author": "jtraglia",
    "category": "Cross-layer",
    "parent": "",
    "content": "<@792404665068158998> does this make sense? https://github.com/ethereum/consensus-specs/pull/4890",
    "created_at": "2026-02-02T14:14:53.941000+00:00",
    "attachments": []
  },
  {
    "author": "jtraglia",
    "category": "Cross-layer",
    "parent": "",
    "content": "<@755590043632140352> <@845691100072509460> could I get a quick review on this?",
    "created_at": "2026-02-02T14:31:47.939000+00:00",
    "attachments": []
  },
  {
    "author": "nero_eth",
    "category": "Cross-layer",
    "parent": "",
    "content": "Yes it does, thanks for clarifying!",
    "created_at": "2026-02-02T14:33:54.741000+00:00",
    "attachments": []
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "",
    "content": "Just to be clear on it, We won't have active builders on Gloas fork and builders will be active only 2 epochs later post the first gloas finalized checkpoint? We will be self-building till then",
    "created_at": "2026-02-02T14:33:59.244000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "asked for a change, Bharath was confused by it so I think everyone will be",
    "created_at": "2026-02-02T14:35:54.845000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "I replied to you as well Barath, that statement is not strictly true",
    "created_at": "2026-02-02T14:36:11.425000+00:00",
    "attachments": []
  },
  {
    "author": "jtraglia",
    "category": "Cross-layer",
    "parent": "",
    "content": "Yup will further clarify. Good suggestion.",
    "created_at": "2026-02-02T14:39:11.835000+00:00",
    "attachments": []
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "",
    "content": "this is a nicer place to have a conversation haha, I am confused at the following:\nIf we look at `add_builder_to_registry`, the `deposit_epoch` is set to `compute_epoch_at_slot(slot)` which will be `GLOAS_FORK_EPOCH` at the hard fork boundary.\nBut `state.finalized_checkpoint` will be `GLOAS_FORK_EPOCH-2` right? because of the following check in `is_active_builder`:\n```python\ndef is_active_builder(state: BeaconState, builder_index: BuilderIndex) -> bool:\n    \"\"\"\n    Check if the builder at ``builder_index`` is active for the given ``state``.\n    \"\"\"\n    builder = state.builders[builder_index]\n    return (\n        # Placement in builder list is finalized\n        builder.deposit_epoch < state.finalized_checkpoint.epoch\n        # Has not initiated exit\n        and builder.withdrawable_epoch == FAR_FUTURE_EPOCH\n    )\n```\nso `state.finalized_checkpoint.epoch`  will only be greater than the builder.deposit_epoch after 2 epochs right?",
    "created_at": "2026-02-02T14:39:39.610000+00:00",
    "attachments": []
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "",
    "content": "post the fork",
    "created_at": "2026-02-02T14:39:43.961000+00:00",
    "attachments": []
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "",
    "content": "assuming we have finality",
    "created_at": "2026-02-02T14:39:48.414000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "no",
    "created_at": "2026-02-02T14:39:58.355000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "the ⁨`slot`⁩ that is being passed is the slot of the deposit",
    "created_at": "2026-02-02T14:40:09.258000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "not of the state",
    "created_at": "2026-02-02T14:40:15.072000+00:00",
    "attachments": []
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "",
    "content": "ahh got it, so this will evaluate to the epoch at which they have created the deposit",
    "created_at": "2026-02-02T14:42:01.642000+00:00",
    "attachments": []
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "",
    "content": "but at the fork boundary, this has to be before the finalized checkpoint at `GLOAS_FORK_EPOCH`",
    "created_at": "2026-02-02T14:42:48.711000+00:00",
    "attachments": []
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "",
    "content": "so deposits will have to be done before  `GLOAS_FORK_EPOCH-2` if a builder wants to be active at the hard fork",
    "created_at": "2026-02-02T14:43:11.332000+00:00",
    "attachments": []
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "",
    "content": "just to clear my head, there is a chance that these deposits can become validators also right?",
    "created_at": "2026-02-02T14:45:45.132000+00:00",
    "attachments": []
  },
  {
    "author": "nc1234",
    "category": "Cross-layer",
    "parent": "",
    "content": "If the deposit is too early yeah, it would accidentally be processed as a validator deposit",
    "created_at": "2026-02-02T14:47:03.401000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "yes, this depends on the queue at the time of the fork, but it should be pretty damned obvious days in advance",
    "created_at": "2026-02-02T14:48:04.289000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "not even hours",
    "created_at": "2026-02-02T14:48:09.007000+00:00",
    "attachments": []
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "",
    "content": "Yeah I also assume there is no way for clients to have a pre-release before the hard fork where deposits with 0x03 withdraw credentials are not at all considered for the validator registry and they are only considered at the epoch boundary for gloas for builder activation",
    "created_at": "2026-02-02T14:50:03.303000+00:00",
    "attachments": []
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "",
    "content": "I mean to offset the risk of builders becoming validators by accident, clients could ignore validators with 0x03 withdraw credentials in `process_pending_deposit` before the gloas fork but that seems like that would require a spec change for Fulu",
    "created_at": "2026-02-02T14:57:21.026000+00:00",
    "attachments": []
  },
  {
    "author": "jtraglia",
    "category": "Cross-layer",
    "parent": "",
    "content": "<@1386598056320831509> <@755590043632140352> how does this sound?",
    "created_at": "2026-02-02T14:58:38.480000+00:00",
    "attachments": []
  },
  {
    "author": "jtraglia",
    "category": "Cross-layer",
    "parent": "",
    "content": "",
    "created_at": "2026-02-02T14:58:40.018000+00:00",
    "attachments": [
      {
        "type": "image/png",
        "origin_name": "image.png",
        "content": "21e490f83226960118815ca707fafcf5e600c1ad8858f1b89dd2d9d7facb2014"
      }
    ]
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "",
    "content": "sounds good!",
    "created_at": "2026-02-02T15:00:20.331000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "Looks good to me, will let the bureaucrats argue if that should go on builder.md or in fork.md and then add a link to that.",
    "created_at": "2026-02-02T15:03:02.525000+00:00",
    "attachments": []
  },
  {
    "author": "bharath.vedartham",
    "category": "Cross-layer",
    "parent": "",
    "content": "will `upgrade_to_gloas` be run after processing justification and finalization for the hard fork epoch or is `upgrade_to_gloas` run before processing justification and finalization for the epoch? because I believe this will dictate which finalized epoch is considered for the builder to be active right?",
    "created_at": "2026-02-02T15:03:10.998000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "It's the last thing it's run, it's after epoch transition",
    "created_at": "2026-02-02T15:03:51.611000+00:00",
    "attachments": []
  },
  {
    "author": "jtraglia",
    "category": "Cross-layer",
    "parent": "",
    "content": "We have kicked off the release for v1.7.0-alpha.2:\nhttps://github.com/ethereum/consensus-specs/actions/runs/21597159454",
    "created_at": "2026-02-02T15:59:32.050000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "Another easy one, I am reviewing forkchoice to annotate it and I think this makes it more understandable if it's right, I was asking myself why in the hell did we add that branch. https://github.com/ethereum/consensus-specs/pull/4892",
    "created_at": "2026-02-02T20:12:07.568000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "<@427491045308235776> I'll ask here instead of chatting in the PR, I did not understand a word of your comment",
    "created_at": "2026-02-02T20:56:05.344000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "",
    "content": "The comment says it was removing the impossible branch:\n\n⁨⁨```python\nif message.slot <= block.slot:\n  return False\n```⁩⁩\n\nfor \n\n⁨⁨```python\nassert message.slot >= block.slot\n```⁩⁩\n\nI was saying that this changes the behaviour when ⁨⁨`message.slot == block.slot`⁩⁩, implying that the previous behaviour of returning ⁨`False`⁩ was a bug",
    "created_at": "2026-02-02T20:59:26.273000+00:00",
    "attachments": []
  },
  {
    "author": "nc1234",
    "category": "Cross-layer",
    "parent": "",
    "content": "So we should `assert message.slot > block.slot` instead",
    "created_at": "2026-02-02T21:01:21.951000+00:00",
    "attachments": []
  },
  {
    "author": "kevaundray",
    "category": "Cross-layer",
    "parent": "",
    "content": "I believe the new >= is correct due to\n\n⁨⁨```python\nassert block_slot <= attestation.data.slot \n```⁩⁩\n\nfrom\n\n https://github.com/ethereum/consensus-specs/blob/7e33b9f9de37f02e711aa534dcc72e9880e551e2/specs/gloas/fork-choice.md?plain=1#L562\n\nI was just skimming the code fwiw, haven't looked at the implications",
    "created_at": "2026-02-02T21:03:40.548000+00:00",
    "attachments": []
  },
  {
    "author": "nc1234",
    "category": "Cross-layer",
    "parent": "",
    "content": "Hmmm, if `message.slot == block.slot`, then it should be supporting PENDING only and not EMPTY or FULL. The `if node.payload_status == PAYLOAD_STATUS_PENDING` prior to this check already covers this scenario. So we should only consider `message.slot > block.slot` here.",
    "created_at": "2026-02-02T21:07:15.703000+00:00",
    "attachments": []
  },
  {
    "author": "fradamt",
    "category": "Cross-layer",
    "parent": "",
    "content": "If `message.slot == block.slot` and `node.payload_status != PAYLOAD_STATUS_PENDING`, we should be returning `False`, not failing an assert",
    "created_at": "2026-02-02T22:47:03.173000+00:00",
    "attachments": []
  }
]