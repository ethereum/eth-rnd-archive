[
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@388610194608750595\u003e  cc: \u003c@578356786889752586\u003e finally got it fully working ü•≥  in a local testnet albeit with some caveats:```bash\nEL 65190: time=\"2022-05-16T17:31:23+05:30\" level=\"info\" msg=\"computed block from payload\" blockHash=\"0xdcc802335d5f5919d3e76bf062a544ae7eeec2b6ece4ab4deb3645ea7c809da9\" difficulty=\"0\" extraData=\"\" gasLimit=\"30000000\" gasUsed=\"0\" logsBloom=\"[0 ...]\" miner=\"0x0000000000000000000000000000000000000000\" number=\"14\" ...\"\nEL 65190: time=\"2022-05-16T17:31:23+05:30\" level=\"info\" msg=\"Imported new chain segment\" blocks=\"1\" dirty=\"0.00 B\" elapsed=\"104.714¬µs\" hash=\"0xdcc802335d5f5919d3e76bf062a544ae7eeec2b6ece4ab4deb3645ea7c809da9\" mgas=\"0\" mgasps=\"0\" number=\"14\" txs=\"0\"\nEL 65190: time=\"2022-05-16T17:31:23+05:30\" level=\"info\" msg=\"Executed payload\" block_hash=\"0xdcc802335d5f5919d3e76bf062a544ae7eeec2b6ece4ab4deb3645ea7c809da9\"\nEph 0/14 0.241[NODE-A]           info: \u003e Block attestations slot=14, bits=1, inclDelay=1\nEph 0/14 0.241[VALI 0-31]        info: Published block slot=14, validator=0xa98e‚Ä¶1d99, graffiti=\nEL 65190: time=\"2022-05-16T17:31:23+05:30\" level=\"info\" msg=\"Forkchoice updated\" attributes=\"\u0026{1652702485 0x4b75ecf2383e2bb573394d983975d282af5c9e26842f6cc3b235aa518a2111a6 0x0000000000000000000000000000000000000000}\" finalized=\"0xccaf66b50e791f95d4b50bae4de28af9396824e7c29f99aeba19414fdf72673f\" head=\"0xdcc802335d5f5919d3e76bf062a544ae7eeec2b6ece4ab4deb3645ea7c809da9\" safe=\"0xdcc802335d5f5919d3e76bf062a544ae7eeec2b6ece4ab4deb3645ea7c809da9\"\ntime=\"2022-05-16T17:31:23+05:30\" level=\"info\" msg=\"Preparing new payload\" attributes=\"\u0026{1652702485 0x4b75ecf2383e2bb573394d983975d282af5c9e26842f6cc3b235aa518a2111a6 0x0000000000000000000000000000000000000000}\" payload_id=\"[0 0 0 0 0 0 0 15]\"\nEph 0/14 0.349[VALI 0-31]        info: Published attestations slot=14, count=1\n```",
        "created_at": "2022-05-16T12:06:59.286000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "1. Had to override the `transactionsRoot` i was getting with the self computed one (mentioned before that the `transactionsRoot` is not matching vs locally computed for empty transactions array)\n2. Running the test on `mainnet` preset, would be good if the mergemock can support `minimal` sync_commitee_bits is the variable thats plays spoils-sport while serializing/deserializing json requests\n3. Had to turn off the signature validations on mergemock's submit blinded blocks because i)`transactionsRoot` issue ii) the blinded beacon block's signature was required on domain, otherwise the  full block **reconstructed** from the blinded beacon block + payload  wasn't getting published/accepted\n\nBut really appreciate the support and troubleshooting  üôè , if the above issues can be addressed then, can configure it to run it in our CI (apart from tons of  pending cleanup/code reviews üòÖ)",
        "created_at": "2022-05-16T12:17:02.079000+00:00",
        "attachments": null
    },
    {
        "author": "ruteri",
        "category": "Cross-layer",
        "parent": "",
        "content": "There's a PR from \u003c@543900561460822016\u003e to add proper domain signing to mergemock https://github.com/protolambda/mergemock/pull/33 if you want to test it!",
        "created_at": "2022-05-16T12:45:44.669000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "Will resume testing from either that PR/branch or whatever `beta` branch or `master` (if the domain signing is merged) as soon as https://github.com/protolambda/mergemock/issues/31 is fixed",
        "created_at": "2022-05-16T12:58:10.963000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "it has `beta1` changes too?",
        "created_at": "2022-05-16T13:17:27.171000+00:00",
        "attachments": null
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "The changes from beta1 are now in protolambda/mergemock master",
        "created_at": "2022-05-16T14:24:33.883000+00:00",
        "attachments": null
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003e 2. Running the test on mainnet preset, would be good if the mergemock can support minimal sync_commitee_bits is the variable thats plays spoils-sport while serializing/deserializing json requests\nplease open an issue for this: https://github.com/protolambda/mergemock/",
        "created_at": "2022-05-16T14:24:55.206000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Cross-layer",
        "parent": "",
        "content": "i believe this is now fixed here: https://github.com/protolambda/mergemock/pull/34",
        "created_at": "2022-05-16T14:46:43.966000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "okay, there are two PRs each with a useful fix. Of course, one can do this manually, but ideally at least one of those is merged, so the whole package can be tested",
        "created_at": "2022-05-16T14:47:38.819000+00:00",
        "attachments": null
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "i think both are good to merge",
        "created_at": "2022-05-16T14:48:38.887000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "and my goal is to write a document showing steps of how to reproduce this, get branch `foo`, etc",
        "created_at": "2022-05-16T14:48:53.606000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "so, it doesn't matter whether `foo` is `master` or `beta1` or `beta2`, that's all about as easy. But \"get this branch, then make this manual change\" is an additional step to document",
        "created_at": "2022-05-16T14:49:29.354000+00:00",
        "attachments": null
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "something like this? https://github.com/flashbots/mev-boost/wiki#using-mergemock",
        "created_at": "2022-05-16T14:49:34.301000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "yes, but including the Nimbus parts",
        "created_at": "2022-05-16T14:49:44.561000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "maybe just incorporate that by reference",
        "created_at": "2022-05-16T14:49:54.503000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "initially something like what \u003c@792822129019584562\u003e is doing but if it works, a local testnet",
        "created_at": "2022-05-16T14:50:37.085000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@654267572107083777\u003e I've merged both into master, so pls let me know if you have more issues",
        "created_at": "2022-05-16T15:01:06.874000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "great, will test",
        "created_at": "2022-05-16T15:01:28.788000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Cross-layer",
        "parent": "",
        "content": "Apologies if this has been discussed - will `/eth/v1/builder/blinded_blocks` support ssz-encoded `SignedBlindedBeaconBlock` (request body `application/octet-stream` rather than `application-json`)",
        "created_at": "2022-05-16T15:15:56.239000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "It should, although I don't know if it is officially listed in the spec.\n\n(At some point I'll raise a PR to allow SSZ for all endpoints, but everyone is so caught up in merge-related work it's unlikely to have much attention at the moment.  If it's easy for you to do though, feel free to get ahead of the game.)",
        "created_at": "2022-05-16T15:17:31.103000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Cross-layer",
        "parent": "",
        "content": "at some point it should",
        "created_at": "2022-05-16T15:18:32.759000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Cross-layer",
        "parent": "",
        "content": "Then is it safe to implement it that way, or do I need to implement encoding for `application/json` as a temporary measure?",
        "created_at": "2022-05-16T15:23:23.178000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "So this hits on a point of concern for me -- these \"temporary\" things tends to stick around. If people were more committed to JSON, I guess, alright. But the idea that despite SSZ being basically as easy or easier to deal with, it's this, well, maybe in the future thing, after everyone's adapted to JSON, seems off.",
        "created_at": "2022-05-16T15:24:41.439000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "But the sooner the better in that case",
        "created_at": "2022-05-16T15:25:24.926000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Cross-layer",
        "parent": "",
        "content": "json is extra work and maintenance for us atm, so I would prefer to go right to ssz if possible",
        "created_at": "2022-05-16T15:25:25.976000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Cross-layer",
        "parent": "",
        "content": "JSON has its place, not least it's easily readable and so useful for human querying of the beacon chain.  It's also the standard, and not sure that anyone wants to rehash the arguments that led us to it.  But with some of the larger data structures (state, validators, blocks post-merge) it's a lot of data and for computer-to-computer communications SSZ is going to be faster everywhere (encoding, decoding, transmission) so worth pursuing.",
        "created_at": "2022-05-16T15:26:25.176000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "And, someone brought up the \"flexibility\" (I think was the word) of JSON before; that's fake, here, because these need to be isomorphic with SSZ objects, which are not at all flexible.",
        "created_at": "2022-05-16T15:27:20.236000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "This adds a whole layer of validation to the parsing, which is unfortunate.",
        "created_at": "2022-05-16T15:27:38.658000+00:00",
        "attachments": null
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "It's not an issue from our end to support this, but will probably take a bit of time until we have it in mev-boost, mergemock and our Kiln relay+builder",
        "created_at": "2022-05-16T15:32:10.533000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Cross-layer",
        "parent": "",
        "content": "I would have assumed it would be easier to start with SSZ for these upstream components as well, since the values have signatures which would require you to translate them to the SSZ-encoding for verification.",
        "created_at": "2022-05-16T15:37:02.510000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "Do you have a rough estimate on time? No pressure here, we are just curious",
        "created_at": "2022-05-16T15:40:09.893000+00:00",
        "attachments": null
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "Perhaps, but the initial REST API integration is completed on all these components already.",
        "created_at": "2022-05-16T15:40:53.173000+00:00",
        "attachments": null
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "I guess a few days, depending on what else comes up as priority the next days. Should be fine until end of this week, maybe start of next.",
        "created_at": "2022-05-16T15:41:31.849000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Cross-layer",
        "parent": "",
        "content": "I don't want to block our testing and integration efforts, so I'd like to do the needful with json on our end, but with the understanding that upstream will be able to implement ssz support swiftly so we aren't stuck with json going forward.",
        "created_at": "2022-05-16T15:42:34.264000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Cross-layer",
        "parent": "",
        "content": "Where \"swiftly\" just means \"before json becomes enshrined as a matter of expediency\" not necessarily before the end of the week üôÇ",
        "created_at": "2022-05-16T15:43:23.894000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "The block sizes specifically for MEV aspects mostly will come out in the response from `submitBlindedBlock` probably -- it's the only one which will include transactions, due to the, well, blinding elsewhere.",
        "created_at": "2022-05-16T15:43:39.501000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "But since people are discussing block sizes up to 2MB (SSZ) it is a real concern",
        "created_at": "2022-05-16T15:43:59.319000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "there is another issue: the ssz root has of empty transactions : [] is not matching: received: `transactions_root\":\"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421\"` should be: `0x7ffe241ea60187fdb0187bfa22de35d1f9bed7ab061d9401fd47e34a54fbede1`, you can use: https://www.simpleserialize.com/ to validate (choose `bellatrix` fork, choose `Transactions` object, let the array be `[]` empty which is what mergemock is giving on fetching full payload) and serialize to see hash tree root",
        "created_at": "2022-05-16T15:53:47.728000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "https://pypi.org/project/web3/2.6.0/ shows where `0x56e...`  comes from. It's an EL construction, not an SSZ one",
        "created_at": "2022-05-16T16:02:48.011000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "```\n\u003e\u003e\u003e web3.sha3('0x80', encoding='hex')\n'56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421'\n```",
        "created_at": "2022-05-16T16:03:06.487000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "and to be clear that field is the SSZ hash tree root, not the RLP hash",
        "created_at": "2022-05-16T16:08:54.387000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "so prolly want to track down a bug in mergemock(?)",
        "created_at": "2022-05-16T16:09:12.835000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "or wherever it came from",
        "created_at": "2022-05-16T16:09:19.208000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "should be*",
        "created_at": "2022-05-16T16:09:19.235000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "It can show up in `ExecutionPayload` objects, but that's because those fields involve RLP hashing",
        "created_at": "2022-05-16T16:10:15.396000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "i don't see where/how",
        "created_at": "2022-05-16T16:12:50.827000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "It should be the `receiptsRoot` of an execution payload without transactions, no?",
        "created_at": "2022-05-16T16:14:42.925000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "https://github.com/ethereum/go-ethereum/search?q=receiptsRoot\u0026type=code",
        "created_at": "2022-05-16T16:15:30.596000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "ah good catch",
        "created_at": "2022-05-16T16:22:17.133000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "i guess you could also theoretically have a state root w/ an \"empty\" state and get the same thing",
        "created_at": "2022-05-16T16:29:15.912000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yeah, so it can show up as a generic \"empty\" RLP hash",
        "created_at": "2022-05-16T16:31:06.687000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "yep but not for `transactions_root`",
        "created_at": "2022-05-16T16:34:40.641000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "right",
        "created_at": "2022-05-16T16:35:17.295000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "i have a PR to clarify how builders should sign messages: https://github.com/ethereum/builder-specs/pull/15",
        "created_at": "2022-05-16T17:47:10.521000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "the main decision point is around how we want to version signatures and this PR elects to skip versioning, if you see some problem here then please chime in there or in https://github.com/ethereum/builder-specs/issues/14",
        "created_at": "2022-05-16T17:47:56.827000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Cross-layer",
        "parent": "",
        "content": "good catch, made a mistake in translating the payloads to headers -- this should fix it: https://github.com/protolambda/mergemock/pull/36",
        "created_at": "2022-05-16T20:24:22.940000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "ok this is resolved, but the submit blinded beacon block's signature are not matching. On some debugging, the hash tree root of execution payload header is not matching (and hence causing htr of the block to not match)",
        "created_at": "2022-05-16T21:40:40.400000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "block json",
        "created_at": "2022-05-16T21:41:08.048000+00:00",
        "attachments": [
            {
                "type": "text/plain; charset=utf-8",
                "origin_name": "message.txt",
                "content": "03ac368d74f581a618195c9eeb3f09976f42f12cfae35de9e80c17152f75f26d"
            }
        ]
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "logged root at relay: ```bash\n HashTreeRoot Message.Body.ExecutionPayloadHeader[81 220 138 38 111 173 131 235 30 116 248 192 36 203 43 181 235 142 121 255 113 224 192 177 240 114 84 138 214 170 57 72]```",
        "created_at": "2022-05-16T21:41:38.337000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "calculated root: ```typescript\nsz.bellatrix.ExecutionPayloadHeader.hashTreeRoot(x1.body.executionPayloadHeader)\nUint8Array(32) [\n  117, 152, 122, 157,  27, 94,  22, 199,\n   27, 202, 147, 171, 213, 66, 199, 100,\n  182, 125, 183, 226,  81, 32,  96, 115,\n   59, 213,  30,   7, 226, 30, 117, 206\n]\n```",
        "created_at": "2022-05-16T21:42:14.567000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "relay logged blinded beacon root: ```[162 247 101 242 250 28 48 203 68 242 11 163 97 162 133 105 98 21 58 176 33 106 193 130 223 102 29 30 122 94 56 166]```",
        "created_at": "2022-05-16T21:44:12.346000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Cross-layer",
        "parent": "",
        "content": "expected: ```typescript\nssz.bellatrix.BlindedBeaconBlock.hashTreeRoot(x1)\nUint8Array(32) [\n  135, 181, 122, 105,  50, 30, 194,  30,\n  138, 131, 163, 159,  47, 15, 136,  90,\n   59, 233, 187, 221, 184,  7, 148, 179,\n  178, 112,  12,  60, 248, 35,  10, 161\n]\n```",
        "created_at": "2022-05-16T21:45:54.021000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Cross-layer",
        "parent": "",
        "content": "looking into this",
        "created_at": "2022-05-16T23:13:54.091000+00:00",
        "attachments": null
    }
]