[
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "I've been thinking more about how an issue like an invalid withdrawal root applies to ePBS: https://github.com/flashbots/mev-boost/issues/661.\n\nI don't think it applies much because in ePBS, the proposer gets unconditional payment with an invalid execution block. However, in mev-boost, the proposer defaults to local block building.\n\nDoes that imply we have an asymmetry where we should add `withdrawals_root` to `ExecutionPayloadHeader` and allow the proposer to filter it out? \u003c@755590043632140352\u003e",
        "created_at": "2024-07-23T14:47:19.234000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I don't think so, in fact I'm thinking in moving all of processing withdrawals to the payload directly, it's cleaner",
        "created_at": "2024-07-23T15:01:34.620000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think I hit an actual forkchoice bug, after a missed epoch I am not advancing the chain ðŸ˜¦",
        "created_at": "2024-07-23T15:04:14.750000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "Ok, let me clarify my question. Today in MEV-Boost, a proposer can manually check if the withdrawals root matches what it has in the beacon state and filter builder bids based on that. In epbs, a proposer can't do it; it could sign a bid with an invalid withdrawals root but still get paid regardless. That's a mental shift. Sure, we can move processing withdrawals to the payload, that makes this argument moot...",
        "created_at": "2024-07-23T15:07:13.365000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think this is kinda irrelevant, the builder can always invalidate it's own payload. It could prevent a very specific bug in the builder that has the right beacon block root as parent and has the wrong state transition, I do not see what's the gain here",
        "created_at": "2024-07-23T15:18:51.103000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think you get slightly better liveness. The difference is that the proposer has a choice to prevent a missing execution slot. If you take the withdrawal issue above and apply it to epbs today, the execution slot is missed, but in MEV-Boost, it defaults to local building",
        "created_at": "2024-07-23T15:22:11.459000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Notice that today the problem when the builder has the wrong withdrawals is because it's building over the wrong block. On ePBS you already commit to a parent block root",
        "created_at": "2024-07-23T15:22:15.664000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "I buy this argument. Instead of checking withdrawals root, checking the parent block hash/root is good enough to prevent this",
        "created_at": "2024-07-23T15:23:40.059000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Oh I think I have a pretty bad bug on forkchoice ðŸ˜¦",
        "created_at": "2024-07-23T15:24:40.393000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "What is it? ðŸ™‚",
        "created_at": "2024-07-23T15:25:28.048000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "weight counting is wrong",
        "created_at": "2024-07-23T15:26:26.146000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "just happy case?  or reveal status + new boost values are in play?",
        "created_at": "2024-07-23T15:28:09.699000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "how could it have the wrong block? `getHeader` specifies the parent hash",
        "created_at": "2024-07-23T15:28:19.766000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "that's simply a bug",
        "created_at": "2024-07-23T15:28:26.059000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "that's the same guarantee you describe above",
        "created_at": "2024-07-23T15:29:06.601000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "yeah but that bug is that they are building over the wrong beaconstate, but yeah hash is just as good as  root here",
        "created_at": "2024-07-23T15:29:18.948000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "right, but if they manage to get the wrong beaconstate (therefore withdrawals) already, it won't be better or worse this way",
        "created_at": "2024-07-23T15:30:02.071000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think it's still kinda irrelevant, if a builder is giving bad blocks on ePBS, proposers can immediately block it",
        "created_at": "2024-07-23T15:30:09.903000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "because that wrong beacon is already a bug, not a hole in the API",
        "created_at": "2024-07-23T15:30:14.021000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "yeah definitely I think builders bugs are kinda irrelevant",
        "created_at": "2024-07-23T15:30:28.323000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "how can the proposer know that from just the bid itself? because today you can withdrawals_root is part of the header",
        "created_at": "2024-07-23T15:30:38.786000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "yeah that is a regression",
        "created_at": "2024-07-23T15:30:55.083000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "or potentially",
        "created_at": "2024-07-23T15:31:00.154000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "in any case it's a bug that would cause bad incentives if fixed like that: rational proposers would still prefer to include the bad bid",
        "created_at": "2024-07-23T15:31:57.071000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "of course we can make it part of state transition",
        "created_at": "2024-07-23T15:32:11.181000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003e rational proposers would still prefer to include the bad bid\nThat wont be the client code though. We check withdralwas root and use local block if it fails",
        "created_at": "2024-07-23T15:32:42.777000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "which transition it's part of is partly a question of who should bear the risk",
        "created_at": "2024-07-23T15:32:44.898000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "anyway, this is extra complexity without any reason, it's much simpler to just move withdrawals to the payload",
        "created_at": "2024-07-23T15:32:47.316000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "ya, I tend to agree with this",
        "created_at": "2024-07-23T15:32:59.718000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Anyway, I'll continue debugging forkchoice which is a bit of a mess",
        "created_at": "2024-07-23T15:33:27.732000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Cross-layer",
        "parent": "",
        "content": "sure, it's at least not worse than today then",
        "created_at": "2024-07-23T15:33:34.790000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "in epbs, we can do better circuit breaker too, we can block the builder if we immediate see one invalid execution payload from them",
        "created_at": "2024-07-23T15:33:41.054000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Whomever decided to have an executable spec is a genius, it's trully the best protocol bug bounty program I've ever seen, it pays for itself",
        "created_at": "2024-07-23T16:09:48.296000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "```\n========================= 3 failed, 756 passed, 432 skipped, 34 warnings in 492.69s (0:08:12) =========================\n```\nAlmost there, getting the withholding forkchoice tests failing these are pretty nasty to figure out what the hell is wrong of if there is something wrong, it could easily be (block, slot) voting at play. Hoping to have this ready tomorrow",
        "created_at": "2024-07-23T19:57:49.757000+00:00",
        "attachments": null
    }
]