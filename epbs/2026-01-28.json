[
    {
        "author": "raulvk",
        "category": "Cross-layer",
        "parent": "",
        "content": "But even keeping the KZG commitments in the DCS, sidecars were no longer self-contained in the current ePBS spec",
        "created_at": "2026-01-28T00:01:08.144000+00:00",
        "attachments": null
    },
    {
        "author": "raulvk",
        "category": "Cross-layer",
        "parent": "",
        "content": "Before: column =\u003e cells =\u003e cell proofs =\u003e KZG commitments =\u003e inclusion proof =\u003e signed block =\u003e execution payload root. All this was present and verifiable in the column.",
        "created_at": "2026-01-28T00:02:47.917000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Cross-layer",
        "parent": "",
        "content": "For the purposes of DA we stop caring at `signed block`.",
        "created_at": "2026-01-28T00:04:01.274000+00:00",
        "attachments": null
    },
    {
        "author": "raulvk",
        "category": "Cross-layer",
        "parent": "",
        "content": "That is no longer the case, so KZG commitments being there are kinda an accidental limbo IMO. Not in the bid, not in the exec payload, no self-contained verifiability while being in DCS",
        "created_at": "2026-01-28T00:04:09.584000+00:00",
        "attachments": null
    },
    {
        "author": "raulvk",
        "category": "Cross-layer",
        "parent": "",
        "content": "The point is, before you could verify, accept and forward a DCS without having received the beacon block. Now you canâ€™t (and we think itâ€™s fine because the block is slimmer, so itâ€™ll propagate faster)",
        "created_at": "2026-01-28T00:05:48.611000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think we are saying the same thing. I was pointing it out as an implication of the change. It moves these things to strictly happening in serial.",
        "created_at": "2026-01-28T00:07:03.734000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Not only slimmer: the DCs can't even start being broadcast until the block has",
        "created_at": "2026-01-28T00:07:09.505000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Cross-layer",
        "parent": "",
        "content": "Not exactly. We need the bid in the sidecar gossip checks: https://github.com/ethereum/consensus-specs/blob/46c1199d6b4584ba484dec807f03b8e6211dd725/specs/gloas/p2p-interface.md?plain=1#L385-L387",
        "created_at": "2026-01-28T00:07:09.763000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Cross-layer",
        "parent": "",
        "content": "Ah thanks.",
        "created_at": "2026-01-28T00:08:05.670000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yes this will always be the case cause we need to be validating for an expected builder and this cannot be known without the block",
        "created_at": "2026-01-28T00:08:32.539000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "But the point is that the DCs can't even start being broadcast without the CL block already having been broadcast",
        "created_at": "2026-01-28T00:09:10.076000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The only edge case is self building and I don't care much about that",
        "created_at": "2026-01-28T00:09:25.309000+00:00",
        "attachments": null
    },
    {
        "author": "raulvk",
        "category": "Cross-layer",
        "parent": "",
        "content": "Thereâ€™s higher latency between the block and the DC sends now, yes, as they no longer come from the same node, and the block needs to travel some p2p network path before the builder realizes its bid was selected and proceeds to release the DCs",
        "created_at": "2026-01-28T00:22:43.738000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "My optimized version of `get_ptc` had multiple consensus bugs that spec tests did not catch. I think it is worth updating the spec tests to cover the following invariants\n* There is more than one `committee_per_slot`\n* Sampling ended after `i` is greater than the `active_validator_count`",
        "created_at": "2026-01-28T00:33:16.299000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I don't think you can compute the commitments without having all the data right? if you only get a DCs and you do not have the commitments you cannot reproduce them from neither the data nor the versioned hashes. I'll create an issue with what I see as the tradeoff and viable approaches, I do not know how to make the versioned hash version work so I'll leave that just as a comment",
        "created_at": "2026-01-28T01:14:58.567000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@795439202732867594\u003e \u003c@833706406699073536\u003e created this issue that may be a more permanent place to have a discussion there https://github.com/ethereum/consensus-specs/issues/4870",
        "created_at": "2026-01-28T01:21:46.500000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Cross-layer",
        "parent": "",
        "content": "I was talking about the full blob. Which is why I mentioned it breaks down as we move to cell level on the EL.",
        "created_at": "2026-01-28T01:23:10.244000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "But the DCs don't have the blob data anyway",
        "created_at": "2026-01-28T01:25:43.678000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "How do you verify the DCs if you don't have the commitments",
        "created_at": "2026-01-28T01:25:59.048000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Cross-layer",
        "parent": "",
        "content": "The EL has the full blob, so it could compute the commitment.",
        "created_at": "2026-01-28T01:26:22.035000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The EL may have nothing",
        "created_at": "2026-01-28T01:26:33.038000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "You get a DCs how do you verify it?",
        "created_at": "2026-01-28T01:26:44.288000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Cross-layer",
        "parent": "",
        "content": "Sorry I was trying to imply all this earlier but I think it wasnâ€™t clear. Yes something needs the full commitments. That could be the block, or it could be the bid. If itâ€™s in the bid, itâ€™s in the block too. Or put the versioned hashes in the bid and the full commitments in the block. In either case, if the EL has the blob, it can generate commitments, if it doesnâ€™t, you have to wait for the block (which is what started the thread above clarifying self-contained data sidecar verification).",
        "created_at": "2026-01-28T01:30:34.753000+00:00",
        "attachments": null
    },
    {
        "author": "__kasey__",
        "category": "Cross-layer",
        "parent": "",
        "content": "What doesnâ€™t work is only versioned hashes in the bid. In that case you are hosed without the blob in EL.",
        "created_at": "2026-01-28T01:31:17.664000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yeah ok then we're in the same page, the only two designs I can see are the ones I wrote in the issue then: move commitments to the bid and remove them entirely from everywhere else, or what we have now in which commitments are in the DCs and the Payload",
        "created_at": "2026-01-28T01:32:17.848000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "But not in bids",
        "created_at": "2026-01-28T01:32:27.329000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think this trade-off was discussed years ago and we may have rushed at assuming that adding them to the bids was worse.",
        "created_at": "2026-01-28T01:33:31.693000+00:00",
        "attachments": null
    },
    {
        "author": "bharath.vedartham",
        "category": "Cross-layer",
        "parent": "",
        "content": "This would apply if the bid came via the p2p bidpool as the builder would have to listen to the beacon block via gossip. \nBut if the bid came via the Builder-API, the proposer returns the beacon block back to the builder on a direct TCP connection if it includes the builders bid. Post which the builder can release the payload with the DCs. So the gap b/w the beacon block and DC sends can be almost neglible on the Builder-API. \n\nOne reason why there can be a gap b/w block and DC sends could be that the builder waits for the block to get enough attestations before releasing it in order to avoid a re-orged payload",
        "created_at": "2026-01-28T09:26:16.946000+00:00",
        "attachments": null
    },
    {
        "author": "bharath.vedartham",
        "category": "Cross-layer",
        "parent": "",
        "content": "w.r.t the Builder-API, it wouldn't matter if the bids are in the commitment as today the commitments are already sent in the bid: [BuilderBid](https://github.com/ethereum/builder-specs/blob/13bec3d8e74bf7570922b3735a79ad0a53fcc9a5/specs/electra/builder.md#L33)",
        "created_at": "2026-01-28T09:26:51.600000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The commitments are not sent in the bid",
        "created_at": "2026-01-28T09:29:41.013000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "You made a different type for the builder API? Yeah that PR needs to be reviewed",
        "created_at": "2026-01-28T09:30:30.312000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "That doesn't make sense",
        "created_at": "2026-01-28T09:30:41.592000+00:00",
        "attachments": null
    },
    {
        "author": "bharath.vedartham",
        "category": "Cross-layer",
        "parent": "",
        "content": "sorry this is not the BuilderBid sent in gloas. This is the BuilderBid sent today with Fulu",
        "created_at": "2026-01-28T09:31:18.200000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "That link is for the type today",
        "created_at": "2026-01-28T09:31:24.050000+00:00",
        "attachments": null
    },
    {
        "author": "bharath.vedartham",
        "category": "Cross-layer",
        "parent": "",
        "content": "in gloas the builder just sends the `SignedExecutionPayloadBid`",
        "created_at": "2026-01-28T09:31:33.384000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yes that's more reasonable and that bid doesn't have the commitments today",
        "created_at": "2026-01-28T09:31:55.335000+00:00",
        "attachments": null
    },
    {
        "author": "bharath.vedartham",
        "category": "Cross-layer",
        "parent": "",
        "content": "yes the point i was trying to make was that adding the commitments to the `SignedExecutionPayloadBid` shouldn't be a problem w.r.t to the Builder-API.",
        "created_at": "2026-01-28T09:32:45.732000+00:00",
        "attachments": null
    },
    {
        "author": "bharath.vedartham",
        "category": "Cross-layer",
        "parent": "",
        "content": "as the builder already sends the commitments as part of the bid today",
        "created_at": "2026-01-28T09:33:11.747000+00:00",
        "attachments": null
    },
    {
        "author": "raulvk",
        "category": "Cross-layer",
        "parent": "",
        "content": "Right, this settles it for me then.\n- we can no longer validate columns without the block, so kzg comms on every column are dead weight\n- we expect builders to keep using the builder API, which already includes the full list of KZG commitments on every bid. We should readd it for Gloas.\n- we are unsure about how the p2p bid channel will be used, so it feels premature to optimize for compactness there",
        "created_at": "2026-01-28T10:42:38.854000+00:00",
        "attachments": null
    },
    {
        "author": "raulvk",
        "category": "Cross-layer",
        "parent": "",
        "content": "Related: this is nice. Repeating the signed beacon block + kzg commitments + inclusion proof on every column was overhead, but worthwhile because it bought us self-contained validation. In a world of heavier, variably sized blocks this was a desirable property. Now that we have lighter and stably sized blocks, it seems more viable to depend on the block, but weâ€™ll need to carefully study and optimize at the p2p layer to derisk this new data flow dependency (alas, we also have longer slack to propagate blobs, for now) \u003c@477396362917576713\u003e",
        "created_at": "2026-01-28T10:53:15.077000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@\u00261458826346896687229\u003e could any of you weigh in the effects of having or not having the full KZG list in the bids? keep in mind the difference between 9-15 blobs to 72-128 blobs.",
        "created_at": "2026-01-28T11:50:25.494000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "And the changes in the auction mechanism from a push-to-relay system to a one-shot pull-from-proposer one",
        "created_at": "2026-01-28T11:51:04.246000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@586161934425128960\u003e, re: your comment on the issue, I second that, we implemented ePBS on top of electra, and did so without any blobs because I envisioned that not having the commitments in the block body was going to be a big problem for Prysm. This would be a big saving in complexity for us if we were to move the commitments to the bid (even though I am scared that it hurts ABS/APS).",
        "created_at": "2026-01-28T12:03:12.106000+00:00",
        "attachments": null
    },
    {
        "author": "l03443",
        "category": "Cross-layer",
        "parent": "",
        "content": "I'm trying to fully understand the tradeoff but as general rule the less data we have in the hot path (bid from builder -\u003e proposer) the better it is. Ideally it could fit a single packet, ~1400 bytes",
        "created_at": "2026-01-28T12:04:03.430000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The current specification has them at 212 bytes, it would go to about 3600",
        "created_at": "2026-01-28T12:09:01.244000+00:00",
        "attachments": null
    },
    {
        "author": "l03443",
        "category": "Cross-layer",
        "parent": "",
        "content": "we put some thoughts here: https://titanbuilder.substack.com/i/167800100/auction-dynamics , essentially moving to a first price blind auction . though relays are still free to implement alternative auction mechanisms",
        "created_at": "2026-01-28T12:10:31.618000+00:00",
        "attachments": null
    },
    {
        "author": "l03443",
        "category": "Cross-layer",
        "parent": "",
        "content": "that seems a lot of overhead to pay for every single bid. What would be the tradeoff if the commitments are not there?",
        "created_at": "2026-01-28T12:11:10.413000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "yeah I meant only this particular change in this context, how much of an impact would be and if builders would be incentivized to not produce blobs because of this. Notice that estimations from \u003c@592004585506340885\u003e are just 2ms not much more. We're talking from 1 packet to 2-3.",
        "created_at": "2026-01-28T12:11:40.725000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "https://github.com/ethereum/consensus-specs/issues/4870\nDescribes the issue well I think",
        "created_at": "2026-01-28T12:12:20.648000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "It removes about 448000 bytes from the data being broadcast by adding these 3500  to the bid",
        "created_at": "2026-01-28T12:13:23.961000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Cross-layer",
        "parent": "",
        "content": "we already include `blob_kzg_commitments` currently, and with gloas we safe a lot by omitting `execution_payload_header` and `execution_requests` which currently the worst case bid size can be ~1.7 MB ssz encoded, there was some discussion [here](https://github.com/ethereum/builder-specs/issues/120)",
        "created_at": "2026-01-28T12:27:00.050000+00:00",
        "attachments": null
    },
    {
        "author": "bharath.vedartham",
        "category": "Cross-layer",
        "parent": "",
        "content": "Does using only SSZ encoding over the wire help reduce the size of the bid?",
        "created_at": "2026-01-28T12:27:43.418000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Cross-layer",
        "parent": "",
        "content": "~50% smaller compared to using json",
        "created_at": "2026-01-28T12:28:03.453000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "In my static numbers from 212 bytes to 3600 I am assuming SSZ",
        "created_at": "2026-01-28T12:28:04.964000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think it's useless to use the \"we send the bid today\" kinda argument anyway, the fact that the bid today is 1.7MB is irrelevant what matters is the difference with and without this feature at the given fork",
        "created_at": "2026-01-28T12:28:57.916000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "the overhead we pay on the bid is 3500 bytes over 212 (plus the signature that I am not counting so reallistically it should be ~300 bytes)  and the question is if this overhead is relevant. It should be noted that perhaps the relative nature is not so important since in absolute value it may not mean any extra latency",
        "created_at": "2026-01-28T12:30:20.835000+00:00",
        "attachments": null
    },
    {
        "author": "0w3n6325",
        "category": "Cross-layer",
        "parent": "",
        "content": "It's hard to predict future builder behavior but I can't imagine builders are likely to omit a blob just to decrease data transfer on the bid path by 48 bytes. The saving is much higher now and they don't really do it. Partially due to social pressure. Builders don't want to be perceived by the community to be censoring blobs.\n\nFor example in this block titan submitted a bid to our relay with 14 blobs. The \"bid\" here is the full block so they had to include 14 * ~131.1 kb\n\nhttps://beaconcha.in/block/24333391#blobs",
        "created_at": "2026-01-28T12:50:14.770000+00:00",
        "attachments": null
    },
    {
        "author": "raulvk",
        "category": "Cross-layer",
        "parent": "",
        "content": "shameless plug for the blob flow viz (refreshes daily) on the p2p observatory: https://observatory.ethp2p.dev/latest/blob-flow we should be able to enhance to show builders as origins",
        "created_at": "2026-01-28T13:41:07.764000+00:00",
        "attachments": null
    },
    {
        "author": "raulvk",
        "category": "Cross-layer",
        "parent": "",
        "content": "Re: the 1400 bytes threshold. Is this because some systems use datagrams, or because you're concerned about segmentation?",
        "created_at": "2026-01-28T13:43:49.255000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Cross-layer",
        "parent": "",
        "content": "To be clear, 3500 bytes is for 72 blobs. Currently, the max added to the bid could be 1008 bytes.",
        "created_at": "2026-01-28T14:02:59.147000+00:00",
        "attachments": null
    },
    {
        "author": "l03443",
        "category": "Cross-layer",
        "parent": "",
        "content": "i think one point here is that now the builders hardly pay the full latency cost thanks to hydration / v3. We did use to see a lot lower blob counts before, especially during high volatility",
        "created_at": "2026-01-28T14:03:27.812000+00:00",
        "attachments": null
    },
    {
        "author": "l03443",
        "category": "Cross-layer",
        "parent": "",
        "content": "segmentation indeed",
        "created_at": "2026-01-28T14:03:36.016000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Cross posting this here, we need to send all of the payload data necessary to the endpoint to produce a payload envelope on the beacon API\nhttps://discord.com/channels/595666850260713488/692078615269212180/1466085824268468357",
        "created_at": "2026-01-28T15:02:22.390000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "so to be clear how even the self-building path would need to be changed (cc \u003c@363800010518822915\u003e cause this is very different than what we had implemented). \n\n- Previous slot BN sends FCU with payload attributes, triggers block production\n- Start of the slot, VC calls to get a beacon block to sign. \n- The beacon node calls get payload, gets bids from builders but decides to locally build. Assembles the block and sends it back to the VC and **it needs to send back everything related to the payload, the requests, the withdrawals everything!** \n- The VC signs the block and sends it back to post and broadcast. \n- The VC now calls and endpoint in the beacon node to get a payload envelope to sign. It needs to send everything back to the beacon node: payload, requests, withdrawals, everything!. The beacon node prepares the payload envelope to sign and it sends it back to the VC (yet again everything needs to go back)\n- The VC signs and sends yet again everything to the node to post and broadcast. \n\nWe could potentially optimize this a lot, the full payload is travelling at least 3 times now, but builders/vouch would need the receiving beacon node, when they get a request to produce a payload envelope to sign, they will need all the data to actually produce it.",
        "created_at": "2026-01-28T15:11:07.305000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Also I am not really sure how we can help to support builders building on top of different heads. I'll leave that up to builders for now. I think it's fine if we just concentrate on building on top of our current head",
        "created_at": "2026-01-28T15:11:51.444000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Cross-layer",
        "parent": "",
        "content": "Unrelated, could I get some eyes on this PR? Is my math correct?\nhttps://github.com/ethereum/consensus-specs/pull/4869",
        "created_at": "2026-01-28T15:42:31.952000+00:00",
        "attachments": null
    },
    {
        "author": "bharath.vedartham",
        "category": "Cross-layer",
        "parent": "",
        "content": "so according to rbuilder's code here: https://github.com/flashbots/rbuilder/blob/e9ea2aa5cd307f00edc761375317a6d43de3dbe9/crates/rbuilder/src/live_builder/payload_events/mod.rs#L184 they build the payload on top of the parent block hash indicated in the payload attributes event. I can also confirm with them on this\nIt appears that rbuilder also regularly monitors to see if the parent block they are building on is still the canonical block hash to ensure that there is no reorg possibility. If the head changes it looks like they cancel their build.",
        "created_at": "2026-01-28T16:06:07.216000+00:00",
        "attachments": null
    },
    {
        "author": "bharath.vedartham",
        "category": "Cross-layer",
        "parent": "",
        "content": "If I am right payload attributes is called when the client starts building the block for the next slot and it would return the parent beacon block root and parent block hash based on the output of get_head from the forkchoice. I would under no crazy network asynchrony, the builder would run a very well connected beacon client and always be following the head of the chain?",
        "created_at": "2026-01-28T16:09:03.291000+00:00",
        "attachments": null
    },
    {
        "author": "pk910",
        "category": "Cross-layer",
        "parent": "",
        "content": "Heya,\nIs it correct, that PTC duties for epoch N can only be calculated after the epoch N state transition?\nattester duties can be calculated in epoch N-1 already, but PTC duties do a weighted selection which is based on the effective balances that may change during the epoch transition. \ndid I understand the spec correctly here?",
        "created_at": "2026-01-28T16:29:15.361000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "we should treat them how we do the proposer shuffling so we dont have this lookahead problem",
        "created_at": "2026-01-28T16:33:01.036000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "wouldn't that require adding a lookahead field to the state? That does not seem ideal.\nAlso, what is the issue with having PTC duties known at epoch N and computed during the epoch transition?",
        "created_at": "2026-01-28T16:42:11.024000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Cross-layer",
        "parent": "",
        "content": "Good points. It would require a new state field \u0026 it's probably not worth it.",
        "created_at": "2026-01-28T16:43:06.300000+00:00",
        "attachments": null
    },
    {
        "author": "pk910",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think the reason for the lookahead is to give validators some time to prepare for their duties.\nwith the current design,  a PTC contributor in the first slot of an epoch doesn't know about his duty before the first block is proposed",
        "created_at": "2026-01-28T16:44:11.734000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "the reason lookahead was for based pre-confirmation protocols rely on a deterministic proposer schedule for smooth operations, otherwise i dont think we would have done it",
        "created_at": "2026-01-28T16:46:28.061000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "the reason for the lookahead is that validators may want to sell in advance certain rights, there's no need for that in the PTC",
        "created_at": "2026-01-28T16:50:17.907000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "oh jinx to Terence ðŸ™‚",
        "created_at": "2026-01-28T16:50:31.217000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "it also reduces implementation complexity -- its just fewer moving pieces that can change just-in-time",
        "created_at": "2026-01-28T16:52:54.345000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "agree we shouldn't add more to the state but it does seem a bit off that we just patched this type of thing and are turning around and re-adding it",
        "created_at": "2026-01-28T16:53:20.282000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "naively speaking, i think that increaes implementation complexiity.. new state field.. new epoch transition method ðŸ™‚ but could be wrong here",
        "created_at": "2026-01-28T16:55:47.461000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "for the state transition yes, but there are many other things that get simpler bc the data can't change at the last minute",
        "created_at": "2026-01-28T17:00:08.046000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "i think if we wanted a proper solution here would would keep a delayed copy of effective balances",
        "created_at": "2026-01-28T17:01:18.789000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "that should cover all of the use cases, rather than just addressing these one-by-one",
        "created_at": "2026-01-28T17:01:36.321000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "but i dont think we should go down that road now, and so then yeah the PTCs will be JIT",
        "created_at": "2026-01-28T17:02:05.944000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "Imho having different PTCs if there's a small fork at epoch boundary is quite annoying and an in-state lookahead seems preferable. The proposer being potentially different with a small fork was always a bad design, even before preconfirmations",
        "created_at": "2026-01-28T17:33:22.975000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "although to be fair the PTC should only change a little bit given bounded balance changes, it shouldn't completely change? (should check the actual logic, I am not sure if this holds)",
        "created_at": "2026-01-28T17:35:41.997000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "In which case, I think it's a lot better, the only issue would then be the JIT computation",
        "created_at": "2026-01-28T17:36:16.562000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "Another option (but probably getting ahead of ourselves here) would be to make it a VRF election, like for aggregators, which is also more secure. We'd have to remove the PTC votes from the beacon block though, because they the selection proofs wouldn't be aggregable.",
        "created_at": "2026-01-28T17:38:06.474000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The JIT computation is indeed annoying, in general anything that requires access to the effective balance is quite annoying for Prysm. If we sampled by the effective balance of the justified checkpoint it would be simpler,  but probably bug prone though",
        "created_at": "2026-01-28T18:18:28.458000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Related to the above, this is how it would look if we move kzg commitments to the bid\nhttps://github.com/ethereum/consensus-specs/pull/4875\nIt would simplify a lot of things on data column validation for Prysm",
        "created_at": "2026-01-28T18:20:13.064000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "i looked at this a bit with RaÃºl; given what i know right now if we are going to touch the DataColumn structure at all this would be my preference",
        "created_at": "2026-01-28T18:34:00.288000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "the place it could get weird is if builders are sending many updated bids over a critical period to proposers, although RaÃºl made the point there's little reason for the blobs to be changing so the commitment list would be static for this entire exchange",
        "created_at": "2026-01-28T18:35:03.524000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "changing the structure at all implies we now have a strict dependency of the DataColumns against the BeaconBlock, which we didn't have before (at the cost of a larger DataColumn message on the wire)",
        "created_at": "2026-01-28T18:35:59.742000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@592004585506340885\u003e is it possible to do another release soonish with the updated withdrawal tests?",
        "created_at": "2026-01-28T18:43:21.821000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Cross-layer",
        "parent": "",
        "content": "A release with new tests",
        "created_at": "2026-01-28T19:03:18.015000+00:00",
        "attachments": null
    },
    {
        "author": "kevaundray",
        "category": "Cross-layer",
        "parent": "",
        "content": "reject when execution payment is zero",
        "created_at": "2026-01-28T19:06:14.202000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "We always have a strict dependency of the DCs on the block",
        "created_at": "2026-01-28T19:52:07.084000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "there's no way to validate them without having a bid saying that the beacon block included them",
        "created_at": "2026-01-28T19:52:21.541000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "so regardless of this change, the DCs cannot be validated without seeing the beacon block before",
        "created_at": "2026-01-28T19:52:35.258000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I am a little pissed cause if the bid increase is not bad for P2P the only reason I have to advocate against this change is because I believe it's also a nobrainer to remove entirely the auction and just have the protocol charge builders and it's trivially implementable. This change would make it a little harder, but not so much",
        "created_at": "2026-01-28T19:53:47.449000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The benefits for validations are a no brainer, and it saves a lot of bwidth in the way",
        "created_at": "2026-01-28T19:54:12.844000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Cross-layer",
        "parent": "",
        "content": "so, naive question...\nif we wanted ptc to be stable, we could just select a simple subset of the attesters like 'first n from each committee', and then its deterministic given a list of attesters... we could avoid extra state info etc if we wanted a stable ptc...",
        "created_at": "2026-01-28T21:38:29.403000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Cross-layer",
        "parent": "",
        "content": "The issue is that we want the selection to be stake-weighted, not just a shuffle, because it's a small committee and it's much more secure that way",
        "created_at": "2026-01-28T22:25:48.854000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "right but today DCs are self-contained, and it looks like we lost that property in the current gloas specs",
        "created_at": "2026-01-28T22:28:37.450000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "we could just keep the status quo DC layout and keep it as-is",
        "created_at": "2026-01-28T22:29:03.960000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "im not sure why it was changed in the first place actually",
        "created_at": "2026-01-28T22:29:15.595000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "We can't, the inclusion proof is not possible cause they aren't part of the block body and the DCs are broadcast by an entity that is only known after the Payload has been revealed",
        "created_at": "2026-01-28T22:35:19.677000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "So on any universe in which the builder is responsible for sending the DCs we will need to have seen the block before we can validate them",
        "created_at": "2026-01-28T22:36:07.948000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Well I'm lying in fact we could do a construction in which there is a root committed in the bid and the builder sends a Merkle proof against that bid",
        "created_at": "2026-01-28T22:37:26.873000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "But that is crazy",
        "created_at": "2026-01-28T22:37:30.493000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "you say tomato, i say tomato",
        "created_at": "2026-01-28T22:44:22.839000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Lol any way even in these crazy schemes if it happens that you get the column before the block you should stop your node",
        "created_at": "2026-01-28T22:45:14.984000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "And move country",
        "created_at": "2026-01-28T22:45:18.429000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "lol",
        "created_at": "2026-01-28T22:57:22.781000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Cross-layer",
        "parent": "",
        "content": "it just seems like stake weighting is what will stop you from being able to have a stable PTC, so if you wanted a stable PTC theres alternatives is all",
        "created_at": "2026-01-28T23:06:34.514000+00:00",
        "attachments": null
    }
]