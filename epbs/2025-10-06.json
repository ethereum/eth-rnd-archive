[
    {
        "author": "nc1234",
        "category": "Cross-layer",
        "parent": "",
        "content": "Right, but the spec currently doesn't match what you say. `is_builder_payment_withdrawable` currently returns true if `withdrawable_epoch` has not been reached (too early) **OR** builder is not slashed. \nShouldn't we do `is_builder_payment_withdrawable` to be true if `withdrawable_epoch` has been reached (current epoch \u003e= withdrawable epoch) **AND** builder is not slashed?",
        "created_at": "2025-10-06T09:37:21.424000+00:00",
        "attachments": null
    },
    {
        "author": "nc1234",
        "category": "Cross-layer",
        "parent": "",
        "content": "Also we don't need to consider the slashed case in `get_expected_withdrawals`, because `is_builder_payment_withdrawable` is evaluated as false. See my comment https://github.com/ethereum/consensus-specs/pull/4631#discussion_r2405487952",
        "created_at": "2025-10-06T09:40:37.331000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Nope, let's look at the table of truth: if the builder is slashed and `current_epoch \u003e= withdrawable_epoch` , then using `AND` would return `false`, however, it's perfectly safe to actually fulfill that payment here because all of the slashing penalties have been applied by the time the builder is withdrawable",
        "created_at": "2025-10-06T09:56:55.939000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "This example also contradicts your comment in the PR",
        "created_at": "2025-10-06T09:57:58.345000+00:00",
        "attachments": null
    },
    {
        "author": "nc1234",
        "category": "Cross-layer",
        "parent": "",
        "content": "So in `is_builder_payment_withdrawable` we don't actually need to consider if builder is slashed or not, as long as `current_epoch \u003e= withdrawable_epoch`?",
        "created_at": "2025-10-06T10:04:53.309000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "No, I gave you one example where the `AND` operation would have the wrong outcome. Let me give you another one. \n\nThe builder is not slashed and `current_epoch  \u003c withdrawable_epoch` in this case the `AND` one would return false but actually here it's also safe to schedule the payment because since the builder is not slashed, the funds are free to be moved to the proposer",
        "created_at": "2025-10-06T10:13:45.688000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Oh I replied to another question before the edit",
        "created_at": "2025-10-06T10:14:11.824000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "With the current edit the answer is yes, which is precisely what the `OR` does",
        "created_at": "2025-10-06T10:14:47.947000+00:00",
        "attachments": null
    },
    {
        "author": "nc1234",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003e The builder is not slashed and current_epoch  \u003c withdrawable_epoch in this case the AND one would return false but actually here it's also safe to schedule the payment because since the builder is not slashed, the funds are free to be moved to the proposer\nYes schedule is fine. But `is_builder_payment_withdrawable` is called in `get_expected_withdrawals`, which is called in `process_withdrawals` and builder's balance is decreased immediately after. So it's the step after scheduling, and is deciding whether the withdrawal should be executed now",
        "created_at": "2025-10-06T10:23:15.396000+00:00",
        "attachments": null
    },
    {
        "author": "nc1234",
        "category": "Cross-layer",
        "parent": "",
        "content": "I guess the naming of `is_builder_payment_withdrawable` is confusing, it is not about whether we should put the payment into the withdrawal queue, but rather, deciding whether the withdrawal should be processed",
        "created_at": "2025-10-06T10:23:59.226000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yes this function returns if the payment can actually be withdrawn, balances are always only deducted when the withdrawal is processed. Yeah if by scheduling we mean putting the withdrawal in the queue, this is always done in process epoch when we process the pending builder payments regardless of any of this. I believe the current logic is correct and the proposed change will cause a bug, since it passes tests we need a regression",
        "created_at": "2025-10-06T10:32:58.441000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "we have 0 test to begin with, process withdrawal tests is still an open pr",
        "created_at": "2025-10-06T19:55:56.513000+00:00",
        "attachments": null
    },
    {
        "author": "etan_status",
        "category": "Cross-layer",
        "parent": "",
        "content": "https://github.com/ethereum/consensus-specs/pull/4630 \nthe SSZ stable gindex PR is now in a shape that's reviewable. will highlight in next ACDC as well\nas for light client, it touches same files, will wait until this one's done.",
        "created_at": "2025-10-06T20:46:21.106000+00:00",
        "attachments": null
    },
    {
        "author": "etan_status",
        "category": "Cross-layer",
        "parent": "",
        "content": "made a thread here, to discuss the stable gindex PR: https://discord.com/channels/595666850260713488/598292067260825641/1424863530359853056",
        "created_at": "2025-10-06T21:02:54.803000+00:00",
        "attachments": null
    }
]