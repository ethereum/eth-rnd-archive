[
    {
        "author": "lightclient",
        "category": "Cross-layer",
        "parent": "",
        "content": "Nice to see many of you in Amsterdam! If you're wondering what the status of the builder api + mev-boost is please see the following:\n* preparing to merge builder api spec into execution apis - this will be cut into a release soon after for CLs to target: https://github.com/ethereum/execution-apis/pull/209\n* beacon-api modification to allow the validator to sign a `registerValidator` msg (previously `setFeeRecipient`): https://github.com/ethereum/beacon-APIs/pull/206\n* consensus-spec update to allow validators to sign application-specific messages, rather than only in-protocol messages: https://github.com/ethereum/consensus-specs/pull/2882\n* many short/medium term research questions opened in the mev-boost repository: https://github.com/flashbots/mev-boost/issues",
        "created_at": "2022-04-29T07:16:35.135000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Cross-layer",
        "parent": "",
        "content": "There is also an immediate question from \u003c@539495253418180618\u003e about whether the validator should control the gas limit or the builder should. I'm inclined to say that the validator's \"target gas limit\" should be included in the `RegisterValidator` message. This seems to map nicely to how clients currently allow miners to signal their gas limit preference (via cli flags usually) and builders can then calculate i) the largest possible move towards their desired limit or ii) immediately construct a block with the preferred target gas limit.",
        "created_at": "2022-04-29T07:20:24.718000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "What is the rationale behind using validator's `pubkey` instead of `index`?",
        "created_at": "2022-04-29T08:43:59.395000+00:00",
        "attachments": null
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "Only convenience, not necessity. It saves the builders a lookup. At the workshop  on mev-day the opinion was to simply add it because it's free.",
        "created_at": "2022-04-29T08:53:38.105000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "The problem is that builder will have to check if a `pubkey` belongs to existing validators, otherwise, builder may be DoSed and registry may be overflown by fee recipient addresses of non-existing validators. So, the lookup seems necessary",
        "created_at": "2022-04-29T08:55:07.720000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "Also, in a direct communication scenario do we need a builder to provide its `pubkey` and sign a message? Or is this now in data structures to provide future compatibility?",
        "created_at": "2022-04-29T08:55:43.487000+00:00",
        "attachments": null
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "Hmm good point, builders will need to look it up. In this case adding the pubkey doesn't offer additional benefits, and just using `validator_index` + `timestamp` + `fee_recipient` should be fine. (~~I couldn't immediately find the beacon-API to get the `pubkey` for a given `validator_index` though~~ probably https://ethereum.github.io/beacon-APIs/#/ValidatorRequiredApi/getStateValidator)",
        "created_at": "2022-04-29T09:13:38.878000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Cross-layer",
        "parent": "",
        "content": "One idea behind using pubkey is that it bundles everything necessary to cryptographically verify the message together (idx requires an additional lookup). I think the benefit turns out to be marginal at best though because keys can be generated on demand to sign spam.",
        "created_at": "2022-04-29T09:18:31.027000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Cross-layer",
        "parent": "",
        "content": "yes, the path is: `eth/v1/beacon/states/head/validators/\u003cindex\u003e`",
        "created_at": "2022-04-29T09:23:00.012000+00:00",
        "attachments": null
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "Thinking on it some more, builders would also need some more information before the block building process starts (before `getHeader` is called):\n- `timestamp` (value for the timestamp field of the new payload)\n- `prevRandao` (value for the prevRandao field of the new payload)\n\nAnd perhaps (could be part of `builder_registerValidator`):\n- `extraData` (unless it comes from the builder)\n- maybe: preferred/required gas limit target\n\nMaybe all of these should just be set by the builder, not the proposer (which would a straight-forward solution without a lot of additional update calls to mev-boost)  ðŸ¤” (cc/ \u003c@539495253418180618\u003e)",
        "created_at": "2022-04-29T09:37:34.684000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@388610194608750595\u003e the builders won't need  `prevrandao` because it can be determined from the previous slot",
        "created_at": "2022-04-29T10:21:57.045000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Cross-layer",
        "parent": "",
        "content": "- `extraData` : I don't feel strongly one way or another about, it might be simplest to just assume the `GetHeader` will also have it as an input and the builder _must_ recompute the execution payload hash\n- `gasLimit` : this seems like it should be done during the validator registration. It won't change much and avoids give the builders total control over the limit",
        "created_at": "2022-04-29T10:23:55.997000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "how will proposer validate the `gasLimit` is set according to its preferences?",
        "created_at": "2022-04-29T11:03:24.390000+00:00",
        "attachments": null
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "It's part of the `ExecutionPayloadHeader`, and the relay could verify that before sending the header to the validator.",
        "created_at": "2022-04-29T11:41:51.202000+00:00",
        "attachments": null
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003e - extraData : I don't feel strongly one way or another about, it might be simplest to just assume the GetHeader will also have it as an input and the builder must recompute the execution payload hash\nWe could only do that if `getHeader` is authenticated (signed), otherwise it opens up to spam/ddos attacks. Should this even come from the proposer? Maybe it should actually come from the builder anyway. Would also be the easiest solution (otherwise i'd see that in `builder_registerValidator`).",
        "created_at": "2022-04-29T11:45:44.336000+00:00",
        "attachments": null
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "Dropping the updated system diagram here so everyone has the full context (builders submitting header + payload together to the relay, which acts as escrow and verifies the value, feeRecipient and all other necessary properties):",
        "created_at": "2022-04-29T11:47:17.217000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "mev-boost-integration-overview.png",
                "content": "66e4ce16995d849e75d962634fa8bff2f50f527b1eeda5fb214d628f7968eca2"
            }
        ]
    },
    {
        "author": "m.kalinin",
        "category": "Cross-layer",
        "parent": "",
        "content": "`gasLimit` can't be set to arbitrary value, it has a limitation on the difference wrt parent block value. Proposer may check if `gasLimit` is adjusted according to its preferences, it would need some logic on CL side",
        "created_at": "2022-04-29T11:53:26.945000+00:00",
        "attachments": null
    },
    {
        "author": "metachris_",
        "category": "Cross-layer",
        "parent": "",
        "content": "I guess the relay could verify it, in addition to checking that the payload actually has the value and pays to feeRecipient (it is trusted in that way already).",
        "created_at": "2022-04-29T12:26:59.241000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "the even lower-res thing to do *now* is to simply let validators commit to a target in `builder_registerValidator`\n\nsome (offline, even) process can check after the fact and raise a loud off-chain alarm (e.g. twitter) if foul play is detected",
        "created_at": "2022-04-29T18:29:25.975000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Cross-layer",
        "parent": "",
        "content": "i think it is **critical** that validators retain control of the gas limit and that this power is not given to builders",
        "created_at": "2022-04-29T18:30:11.869000+00:00",
        "attachments": null
    }
]