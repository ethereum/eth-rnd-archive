[
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "<@520034910149410861> what is Anders' concern on the variable PTC PR? also, can you take a look at the current status of the DA bit? If that is fine I will open a separate one for the validator guide that may be contentious about the proposer honest behavior being that it needs to reorg such payloads.",
    "created_at": "2026-02-09T14:37:18.655000+00:00",
    "attachments": []
  },
  {
    "author": "fradamt",
    "category": "Cross-layer",
    "parent": "",
    "content": "Yes this would be fine, except for this \"Implemnetations MAY return `True` if the node have recovered all the blob data\", which still shouldn't be the case for attesters (I commented on the PR as to why)\n\nThe proposer behavior is imo to be specified separately, and for example could look like:\n- do not extend the payload if < 25% votes for either data availability or payload timeliness, or if not locally available and valid\n- extend otherwise\n\nThis way, you only extend blocks that were timely and which are actually available, even if you yourself cannot fully verify the availability. And you could leave implementations the choice to have the full custody proposer behavior be instead:\n- do not extend the payload if < 25% votes for payload timeliness, or if not locally available and valid\n- extend otherwise\n\nIn other words, a full custody proposer would not care if the data is late, as long as it gets all of it locally. It would only listen to the PTC for the payload timeliness part (to ensure that it doesn't come very late and leaves no time to build a block). Basically, the proposer behavior would follow the note above, \"return `True` if the node have recovered all the blob data\", but attesters wouldn't",
    "created_at": "2026-02-09T15:37:49.525000+00:00",
    "attachments": []
  },
  {
    "author": "fradamt",
    "category": "Cross-layer",
    "parent": "",
    "content": "<@917367578966523934> maybe you can comment on the other thing",
    "created_at": "2026-02-09T15:40:48.516000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "I agree about the DA timeliness needing to be there but specifying it in an executable way is incredibly tricky. I do not know how to do that. If you have a suggestion or if just changing the wording in this function I am fine with it, but I don't think we can (or should if we could) make it executable. \n\nAs for the proposer: I think if the proposer is not a super node it should not extend the payload if less than 50% of the PTC (or probably higher) voted for not available. But let's get to that one later in a separate PR, I want to merge this one. So if I change the wording on this PR, in that docstring to mention that clients should return true from that call if they had received all the data before the PTC deadline and then leave the proposer's behavior to the `validator.md` file in a different PR, would that be OK? I don't know how to do this otherwise",
    "created_at": "2026-02-09T15:45:39.672000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "So I think simply changing that docstring to \n```\n    Implemnetations MAY return `True` if the node has recovered all the blob data\n    *before* the deadline returned from `get_payload_attestation_due_ms`.\n ```\nShould be fine, for both proposer and attester, while still leaving the option to the proposer to reorg if he wanted *and* leaving the wording to force the proposer to reorg to the  `validator.md` file",
    "created_at": "2026-02-09T15:52:29.944000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "would that be OK?",
    "created_at": "2026-02-09T15:52:34.425000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "Github is down, but added [this commit](https://github.com/ethereum/consensus-specs/pull/4884/commits/ab570b0b9e19b0efb64d71b9b1d6e83a507a0041)",
    "created_at": "2026-02-09T16:24:35.885000+00:00",
    "attachments": []
  },
  {
    "author": "fradamt",
    "category": "Cross-layer",
    "parent": "",
    "content": "This still doesn't work. A non-full-custody proposer must be able to use the PTC to decide whether the data is available, for example by not extending any payload that has < 25% data available. If full custody attesters are not paying attention to the PTC, and instead will return `True` just based on their local view at the deadline, you can have this situation:\n- proposer sees < 25% of PTC saying that data is available, does not extend\n- many honest attesters (for example 24% of them, but could be more since PTC =/= attesters) have seen the data on time, they do not attest to the proposal because to them it's not extending a payload that should be extended\n\nSure, they're a minority, but we want rules that ensure (given the assumptions) that honest attesters attest to honest proposals. This is why I keep saying that the rule should be that the proposer uses 25% as a threshold and the attesters 50%.",
    "created_at": "2026-02-09T16:38:57.315000+00:00",
    "attachments": []
  },
  {
    "author": "fradamt",
    "category": "Cross-layer",
    "parent": "",
    "content": "Any such proposer would be vulnerable to ex-ante reorgs, the threshold the proposer uses to decide what to extend has to be significantly lower than what attesters use to decide what is *required* to be extended",
    "created_at": "2026-02-09T16:40:55.936000+00:00",
    "attachments": []
  },
  {
    "author": "fradamt",
    "category": "Cross-layer",
    "parent": "",
    "content": "I really don't think there are better options than using 25/50, which do not involve weird things like multiple deadlines. Still, a full custody proposer does not need to care about this 25% threshold, it can be fine with local availability of the data (though it would still want to require 25% for the payload, to be able to reorg late payloads)",
    "created_at": "2026-02-09T16:45:22.341000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "I think we're talking past each other or  missunderstanding what the other says. This PR explicitly says that the non-full-custody proposer will have to use PTC to decide this, for that proposer this function will return `false` if the PTC has voted that it wasn't available. By *all the blob data* I really mean **all**",
    "created_at": "2026-02-09T16:52:40.413000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "Cross-layer",
    "parent": "",
    "content": "at any rate, having different thresholds for proposers and attesters can only be specified by having different tiebreakers for get_proposer_head or similar but I wouldn't touch this function for this, as currently specified they would both use 50% to decide head",
    "created_at": "2026-02-09T16:56:25.509000+00:00",
    "attachments": []
  },
  {
    "author": "fradamt",
    "category": "Cross-layer",
    "parent": "",
    "content": "The problem is that the PR says full custody *attesters* will return `True` without caring about the PTC says. What I am saying above is that this doesn't work",
    "created_at": "2026-02-09T17:00:27.343000+00:00",
    "attachments": []
  },
  {
    "author": "fradamt",
    "category": "Cross-layer",
    "parent": "",
    "content": "I don't know how it should be specified, but attesters and proposers can also not have the same threshold, the current mechanism is meant for attesters, not proposers",
    "created_at": "2026-02-09T17:01:45.921000+00:00",
    "attachments": []
  }
]