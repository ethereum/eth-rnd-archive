[
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@808969530608451584\u003e I know you're busy and this is low priority, do you want feedback/requests on the Dora support for ePBS or would you rather receive this later? if you do, what's the best channel to reach you?",
        "created_at": "2025-02-04T11:42:05.765000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@641548687813902336\u003e have you guys tested with a missing payload by any chance? I will give you an image when we have a kurtosis run that can handle that situation. I can give you one before that is sure to break if a payload is missing, but it could be enough to test that your gossip is working",
        "created_at": "2025-02-04T11:46:47.793000+00:00",
        "attachments": null
    },
    {
        "author": "pk910",
        "category": "Cross-layer",
        "parent": "",
        "content": "Yea, please ping me here ðŸ™‚ \nDora \"should\" already support epbs in a very basic way (showing blocks without any execution payload related information)\nBut I haven't been able to test it yet - so if any client has a ready epbs image (even without interop with another client), pls share so I have something to test against ðŸ™‚",
        "created_at": "2025-02-04T11:54:16.718000+00:00",
        "attachments": null
    },
    {
        "author": "stefanbratanov",
        "category": "Cross-layer",
        "parent": "",
        "content": "yes, I did some test and it seems to be handled, even though the approach is bit hacky and should be cleaned up, good enough for interop though. Gossip seems to be working well with two Teku nodes, but debugging an inclusion proof issue with validating blobs. By the way \u003c@504202741933932544\u003e and I split the work on the specs. I am doing the beacon-API part, while he is doing the RPC part. Should have PRs soon.",
        "created_at": "2025-02-04T11:55:56.537000+00:00",
        "attachments": null
    },
    {
        "author": "stefanbratanov",
        "category": "Cross-layer",
        "parent": "",
        "content": "Also currently not handling cases where we receive execution payload before block, we will just reject it rather than save it and apply it later",
        "created_at": "2025-02-04T11:57:37.257000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "will send you something minimal in these days. The very first example would be that the fork doesn't appear here:",
        "created_at": "2025-02-04T11:58:05.453000+00:00",
        "attachments": [
            {
                "type": "image/jpeg",
                "origin_name": "fo.jpg",
                "content": "833df0afd1f999f483646b54c929ef6d6d35d4239f4e492df433deb58e80c3eb"
            }
        ]
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Ohh blobs I am not sure if we supported yet, if you send us any probably we'll be broken ðŸ™‚",
        "created_at": "2025-02-04T11:58:54.131000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "haven't worked in this for over 2 months so we're slowly merging the hacks in our interop branch to the main epbs branch",
        "created_at": "2025-02-04T11:59:18.960000+00:00",
        "attachments": null
    },
    {
        "author": "pk910",
        "category": "Cross-layer",
        "parent": "",
        "content": "Are you running that testnet via kurtosis?\nThere is a separate dora image that should be automatically used when eip7732 is scheduled for activation.\nMake sure to not set a dora image in your kurtosis config",
        "created_at": "2025-02-04T12:01:29.689000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "yeah I'm running via kurtosis, but I'm new to it, so I may be forcing a different dora",
        "created_at": "2025-02-04T12:07:10.824000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "```\ndora_params:\n  image: \"ethpandaops/dora:master-latest\"\n```",
        "created_at": "2025-02-04T12:07:48.407000+00:00",
        "attachments": null
    },
    {
        "author": "pk910",
        "category": "Cross-layer",
        "parent": "",
        "content": "yea, remove the dora_params completely  or use   `ethpandaops/dora:eip7732-support`  as image ðŸ™‚",
        "created_at": "2025-02-04T12:09:06.411000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "yep, that worked ðŸ™‚",
        "created_at": "2025-02-04T12:33:02.297000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@641548687813902336\u003e did you transition from Electra to eip7732 or Fulu to eip7732?",
        "created_at": "2025-02-04T13:56:46.456000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Cross-layer",
        "parent": "",
        "content": "electra -\u003e eip7732",
        "created_at": "2025-02-04T14:18:39.839000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "perfect, that's what prysm is doing as well",
        "created_at": "2025-02-04T14:27:14.786000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Cross-layer",
        "parent": "",
        "content": "Not super sure about how it looks:\nhttps://github.com/tbenr/consensus-specs/commit/0154de00250fe69782ffca79626f1c851fa9d545\n\nHow clients are comfortable in switching the type at a particular fork? some clients may end up having a 7732 version of that method anyway...\n\nMaybe one of these two options might be better:\n\n1- (unified) have a brand new `beacon_blocks_and_payload_by_range/1/`  using a container.\n  -PRO: nice and clean with new type\n  -CON: we need to handle version transition (pre 7732 you have to use one method and than switch to new rpc)\n\n2- (separated) having a dedicated `payload_by_range/1/` rpc and do the two call.\n  -PRO: nice and clean with new types. Node could download data in parallel from 2 peers and might go faster.\n  -CON: more complex syncing logic to orchestrate the two calls (but we already do it for blobs)",
        "created_at": "2025-02-04T14:36:45.440000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "I'm weakly supportive for 2.. more than 1 just because we already do this for blobs so the framework is already there,  the complexity is minimal, and being able to download data in parallel is nice + clener with new types",
        "created_at": "2025-02-04T14:43:51.880000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Cross-layer",
        "parent": "",
        "content": "I feel the same",
        "created_at": "2025-02-04T14:44:34.902000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Cross-layer",
        "parent": "",
        "content": "the annoying thing is that `ExecutionPayloadEnvelope` has no explicit `slot` field, thus when sending the response the context (forkDigest) must be hardcoded, and will cause issues for subsequent forks..",
        "created_at": "2025-02-04T15:39:50.710000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "Ya i've raised that to \u003c@755590043632140352\u003e a few times but we were able to work around most of the cases (ex: validator key signing)",
        "created_at": "2025-02-04T15:40:40.204000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Cross-layer",
        "parent": "",
        "content": "we should add the `slot` in it if we don't want client to have headache to lookup slot by the block root",
        "created_at": "2025-02-04T15:40:46.939000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Cross-layer",
        "parent": "",
        "content": "well actually teku can easily do a lookup by block root, but, for old blocks, it will trigger a block retrieval from DB and deserialization.. which is not ideal",
        "created_at": "2025-02-04T15:47:04.605000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Cross-layer",
        "parent": "",
        "content": "heaving the slot appears to be convenient..",
        "created_at": "2025-02-04T15:49:18.692000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Cross-layer",
        "parent": "",
        "content": "we go from 7 to 8 fields, right at the edge to avoid extra hashing for ssz ðŸ˜‰",
        "created_at": "2025-02-04T15:49:59.894000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "we can add it, it should be a minor change on our codebase, but I would want to limit spec changes unless really necessary until we have an interop",
        "created_at": "2025-02-04T16:03:15.131000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "so that we can start from some form of stable devnet that we can push Pari to run",
        "created_at": "2025-02-04T16:03:30.033000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Cross-layer",
        "parent": "",
        "content": "we can hardcode it for now.. np!",
        "created_at": "2025-02-04T16:42:52.688000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I think this makes sense to add sooner than later if we go with your RPC where you can request individual payload envelopes My original thought was that payload envelopes would be only gossip objects",
        "created_at": "2025-02-04T16:57:22.097000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I have a couple of blockers before we can interop: we are getting the payload envelope before the block and we aren't holding it to sync it after the block has arrived",
        "created_at": "2025-02-04T17:42:29.966000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "For some reason our branch is broken now in gossip and I can't really explain it, it may be even easier to add the slot to the gossip structure if we agree to that and leave the consensus changes pending anyway",
        "created_at": "2025-02-04T18:58:42.981000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "Change it to this order specifically:\n```\nclass ExecutionPayloadEnvelope(Container):\n    payload: ExecutionPayload\n    execution_requests: ExecutionRequests\n    builder_index: ValidatorIndex\n    beacon_block_root: Root\n    slot: Slot\n    blob_kzg_commitments: List[KZGCommitment, MAX_BLOB_COMMITMENTS_PER_BLOCK]\n    payload_withheld: boolean\n    state_root: Root\n```",
        "created_at": "2025-02-04T19:01:00.366000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "The `payload_withheld` field anyway needs to be gone with Francesco's forkchoice",
        "created_at": "2025-02-04T19:01:24.235000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "so that's another change about to happen",
        "created_at": "2025-02-04T19:01:35.757000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "I'll work the full CL spec once I have the branch finalizing, does this work for you Enrico or would you rather keep the spec as-is?",
        "created_at": "2025-02-04T19:02:23.395000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "we can probably remove right now the payload_withheld boolean anyway",
        "created_at": "2025-02-04T19:06:14.897000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "since we aren't testing this in forkchoice",
        "created_at": "2025-02-04T19:06:24.247000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "will delay me just a couple of days to have the full image",
        "created_at": "2025-02-04T19:06:44.121000+00:00",
        "attachments": null
    },
    {
        "author": "tbenr",
        "category": "Cross-layer",
        "parent": "",
        "content": "Don't worry, we are fighting a mysterious problem with inclusion proof.. kinda stupid one which likes to hide",
        "created_at": "2025-02-04T19:07:26.980000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "we are putting empty KZG commitments and no blobs anyway lol",
        "created_at": "2025-02-04T19:09:25.469000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Cross-layer",
        "parent": "",
        "content": "haven't even looked at blobs yet",
        "created_at": "2025-02-04T19:09:36.105000+00:00",
        "attachments": null
    }
]