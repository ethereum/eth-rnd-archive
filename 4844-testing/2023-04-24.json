[
    {
        "author": "marioevz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The Hive sim (https://github.com/ethereum/hive/pull/759) was just updated to support blobs in GetPayloadV3.\n\nTo run:\n```\n./hive --client \u003cExec client\u003e --sim ethereum/engine --sim.limit \"engine-blobs/Blob Transactions On Genesis\"\n```\n\nThis is just an Engine API test for the execution clients, it does not involve the Consensus clients just yet.",
        "created_at": "2023-04-24T15:57:55.863000+00:00",
        "attachments": null
    },
    {
        "author": "inphi",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Fixing...",
        "created_at": "2023-04-24T16:00:37.255000+00:00",
        "attachments": null
    },
    {
        "author": "inphi",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@607055410104500244\u003e Geth has been updated for the rename. Thanks for pointing this out.",
        "created_at": "2023-04-24T16:43:30.436000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hey all. Integrated KZG into Geth today. I think I broke it tho' ðŸ˜›\n\nComputing commitments and proofs is 5-6x slower in C than in Go on Apple M2\nVerifying proofs is about 50% faster in C than in Go on Apple M2\nThe C KZG library crashes with an illegal instruction on Intel i7 (older version)\n\nIt's a bit of a shitshow y'all ðŸ˜›",
        "created_at": "2023-04-24T21:02:56.367000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The SIGILL is due to CKZG using a BLS lib that said fuck it, buy a new CPU",
        "created_at": "2023-04-24T21:03:25.251000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Alternatively you need to disable compile time the fancy instruction because I guess the authors couldn't be bothered to detect it runtime like every other crypto library that exists like ever in the world",
        "created_at": "2023-04-24T21:03:59.274000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But from my persopective, I cannot disable it in Geth, because it needs to be disabled in the compiling scope (ckzg CGO flags), so I cant make it be portable. We could hack it into CKZG, but it should be fixed in BLS",
        "created_at": "2023-04-24T21:05:19.856000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "As for the performance on Apple M2, I have no clue why CKZG is so bad at it, 6x worse performance than Go means something's broken there too",
        "created_at": "2023-04-24T21:05:43.882000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Got a benchmark result from Jared, the speed issue is present on Intel Xeon too, tohugh there C is \"just\" 4 times slower than Go",
        "created_at": "2023-04-24T21:08:11.753000+00:00",
        "attachments": null
    },
    {
        "author": "__flcl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah, the Intel 4th generation doesn't support enough instructions. Let me know if it's worth fixing. I have a workaround.",
        "created_at": "2023-04-24T21:14:03.039000+00:00",
        "attachments": null
    },
    {
        "author": "__flcl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "(modern c compilers do not allow to disable specific one, so you need to change /proc/cpuinfo to get compatible output from the compilers)",
        "created_at": "2023-04-24T21:16:44.003000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Usually crypto libs have various implementations for various capabilities and pick the one to run when initializing themselves",
        "created_at": "2023-04-24T21:18:48.173000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So the compiler builds all the flavors into the binary and it gets picked runtime",
        "created_at": "2023-04-24T21:19:09.659000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But this is really a fault in the BLS lib, not CKZG",
        "created_at": "2023-04-24T21:20:52.575000+00:00",
        "attachments": null
    },
    {
        "author": "__flcl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The mentioned flavors are provided by C compiler looks like, so it replaces new instructions with old ones, if find they are not supported.",
        "created_at": "2023-04-24T21:23:57.335000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "nah https://github.com/cloudflare/bn256/blob/master/gfp_amd64.s#L113",
        "created_at": "2023-04-24T21:25:04.693000+00:00",
        "attachments": null
    },
    {
        "author": "__flcl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "(=compile time solution only for now)",
        "created_at": "2023-04-24T21:25:05.141000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "https://github.com/cloudflare/bn256/blob/66a4f6353b47b94f61ac466b3f21b28adb76ae29/gfp_decl.go#L12",
        "created_at": "2023-04-24T21:25:53.782000+00:00",
        "attachments": null
    },
    {
        "author": "__flcl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Btw the problem is in https://en.wikipedia.org/wiki/Intel_ADX (if you try to disable with a flag, it will ignore the flag)",
        "created_at": "2023-04-24T21:25:54.797000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "cloudflare does it like this, detects it at runtime and uses the flag to run one code or antoher",
        "created_at": "2023-04-24T21:26:10.343000+00:00",
        "attachments": null
    },
    {
        "author": "__flcl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So blst can be improved to have a runtime switch, you mean?",
        "created_at": "2023-04-24T21:28:24.008000+00:00",
        "attachments": null
    },
    {
        "author": "__flcl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm still not sure if it's important to care about the 4th gen",
        "created_at": "2023-04-24T21:29:23.709000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "well at least fail compile time",
        "created_at": "2023-04-24T21:30:22.403000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "blowing up runtime is extremely bad practice",
        "created_at": "2023-04-24T21:30:33.670000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but then again, there's no other way",
        "created_at": "2023-04-24T21:30:53.224000+00:00",
        "attachments": null
    },
    {
        "author": "__flcl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "You can try to compile with ADX disabled, I did not test it but should not affect performance a lot",
        "created_at": "2023-04-24T21:31:56.207000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I cannot control the CGO build flags of an external package",
        "created_at": "2023-04-24T21:37:13.259000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And I will not make everyone use a custom build system just to inject an env var",
        "created_at": "2023-04-24T21:37:36.043000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I get it that kicking the can down the road is an easy path to take",
        "created_at": "2023-04-24T21:38:06.532000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But we need to build solid code that people can rely on at all levels",
        "created_at": "2023-04-24T21:38:19.701000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And a crypto lib shoudl work out of the box, not needing patching on various systems",
        "created_at": "2023-04-24T21:38:29.727000+00:00",
        "attachments": null
    },
    {
        "author": "__flcl",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It'd be great if we could fix blst with a runtime switch for sure, and the audit guys could additionally check that change",
        "created_at": "2023-04-24T21:40:09.968000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e \u003e \u003cdankrad\u003e  replying to: \n ```@testing4844_bot wrote: \n \u003cPÃ©ter SzilÃ¡gyi (karalabe)\u003e As for the performance on Apple M2, I have no clue why CKZG is so bad at it, 6x worse performance than Go means something's broken t...```\n it's just not parallelized? so it's 6x difference in latency but not cpu time.\n\nI think I did write the parallel code at one point but it was probably not considered important? Nodes don't really have to compute any commitments in normal operation, even when they create a block. Only creating blob transactions requires this, which is a very specialized function",
        "created_at": "2023-04-24T22:06:09.035000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003casn_d6\u003e \u003c@206016661470314496\u003e btw, how come you are not using `go-kzg-4844` as was initially the plan for geth and prysm?",
        "created_at": "2023-04-24T22:11:31.044000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003casn_d6\u003e go-kzg-4844 is written in pure go, should be easy to integrate with geth and has comparable performance",
        "created_at": "2023-04-24T22:13:52.927000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003casn_d6\u003e the only reason c-kzg has go bindings atm is because justin has been using them for fuzzing :)",
        "created_at": "2023-04-24T22:19:13.998000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah, that's right. We recommended Go clients use Go-KZG-4844.",
        "created_at": "2023-04-24T22:34:41.086000+00:00",
        "attachments": null
    }
]