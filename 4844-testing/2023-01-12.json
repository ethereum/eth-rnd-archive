[
    {
        "author": "jgm",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If it is the change in the addition of the blobs sidecar then that isn't what would usually be considered enough to increment the version.  The entire introduction of the execution payload didn't come with a version bump, for example.",
        "created_at": "2023-01-12T00:02:12.190000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the response is now `{execution_payload, blobs_sidecar}` instead of just the `execution_payload`",
        "created_at": "2023-01-12T00:02:23.335000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "so execution payload is moved one level down in the json",
        "created_at": "2023-01-12T00:03:11.938000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yep, although thats an addition to the existing `BeaconBlock` structure",
        "created_at": "2023-01-12T00:04:03.151000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It's actually a new `BeaconBlock` structure, I believe, specific to the hard fork in which EIP-4844 lands.",
        "created_at": "2023-01-12T00:05:15.333000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ah that's true, I thought you were referring to the bellatrix change",
        "created_at": "2023-01-12T00:06:54.211000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm not sure if we have the same versioning rules in p2p interface?",
        "created_at": "2023-01-12T00:07:27.262000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The idea of the `/v2/beacon/blocks/{block_id}` endpoint is that it is versioned both in the JSON response and in the HTTP header, allowing consumers to be able to decode it based on that metadata.  Otherwise it requires clients to know in advance when hard forks occurred to call the correct endpoint for the block's ID.",
        "created_at": "2023-01-12T00:08:15.586000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Not sure how the p2p part of it works, sorry.",
        "created_at": "2023-01-12T00:08:31.053000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I should've probably started a thread, sorry üôÇ .. adding the responses here so it's bit clearer on the propose changes:\nexisting `getHeader` response:\n```\n{\n  \"version\": \"capella\",\n  \"data\": {\n    \"parent_hash\": \"0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2\",\n    \"fee_recipient\": \"0xabcf8e0d4e9587369b2301d0790347320302cc09\",\n    \"state_root\": \"0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2\",\n    ...\n  }\n}\n```\nnew response with blobs\n```\n{\n  \"version\": \"eip4844\",\n  \"data\": {\n    \"execution_payload\": {\n        ...\n    },\n    \"blobs_sidecar\": {\n        ...\n    }\n  }\n}\n```",
        "created_at": "2023-01-12T00:16:41.386000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Why wouldn't that be:\n```\n{\n  \"version\": \"eop4844\",\n  \"data\": {\n    \"header\": {\n      ...\n    },\n    \"blobs\": {\n      ...\n    }\n  }\n```\n\nThe general form of all responses is to put the data in the `data` section.",
        "created_at": "2023-01-12T00:20:22.857000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "data is generally the actual object, and because the version string isnt part of the object, it's kept outside, otherwise its all kinds of messy",
        "created_at": "2023-01-12T00:22:36.944000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "so the `data` is the executionPayload object if its just returning that",
        "created_at": "2023-01-12T00:23:21.285000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "which is basically what \u003c@144468805697929216\u003e said heh sorry",
        "created_at": "2023-01-12T00:24:05.805000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "As long as `header` and `blobs` are spec objects (or there is a spec object that has both of these in it) then that format should be okay.",
        "created_at": "2023-01-12T00:24:31.742000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "(Otherwise we go back to creating objects specifically for decoding the responses, which then often requires shifting the data around between objects and gets ugly.)",
        "created_at": "2023-01-12T00:25:04.869000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ah sorry good catch! the new response example is incorrect - yes, the proposed change matches what \u003c@144468805697929216\u003e was suggesting -",
        "created_at": "2023-01-12T00:25:12.002000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "so  if data now becomes `\"data\": { \"header\": {}, \"blobs\": {} }`  instead of `\"data\": {header object}` - would this require a version change? I'm new and not trying to break the existing patterns here - just trying to figure what it should be",
        "created_at": "2023-01-12T00:28:00.850000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "generally data is pretty much an ssz object... i'll try to read more on what you're looking at and see if i can say something less generic",
        "created_at": "2023-01-12T00:29:16.171000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "thank you! üôè",
        "created_at": "2023-01-12T00:29:59.109000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "im working from teh assumption you're talking about beacon-api etc so i'd like to make sure üôÇ",
        "created_at": "2023-01-12T00:30:25.286000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "oh this is builder api, PR here: \nhttps://github.com/ethereum/builder-specs/pull/61\nI've updated the json example, thanks \u003c@144468805697929216\u003e",
        "created_at": "2023-01-12T00:33:48.387000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This PR seems to be assuming that blobs are coming from relays.  Is this correct?",
        "created_at": "2023-01-12T00:36:36.557000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yes, thinking about this again, I'm not sure if this is necessary if the relays also publish the signed block and blobs",
        "created_at": "2023-01-12T00:39:14.208000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "(not sure if this is the current behaviour though)",
        "created_at": "2023-01-12T00:39:32.560000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "given this is all effectively coming from a spec object, i'd be putting it in the same spot as in the spec object for 4844\nI can't find the blobs in this version of the spec https://github.com/ethereum/consensus-specs/blob/dev/specs/eip4844/beacon-chain.md#beaconblockbody \nthe location in the spec will map where they go in the api...",
        "created_at": "2023-01-12T00:42:02.702000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "it's under fork choice https://github.com/ethereum/consensus-specs/blob/ed1c6be132e12850a50119f0f3815ca7cf8bb46c/specs/eip4844/fork-choice.md#blobssidecar",
        "created_at": "2023-01-12T00:45:10.456000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Looking at https://github.com/ethereum/consensus-specs/blob/dev/specs/eip4844/beacon-chain.md there is no direct reference to the blobs, just the KZG commitments.  So not sure why the blobs would need to be passed to the relay.",
        "created_at": "2023-01-12T00:45:22.521000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "if its going to map into the block, it needs to make its way to the beacon-chain spec and be in the block object, or we're deviating from spec, and that would be bad",
        "created_at": "2023-01-12T00:46:16.148000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "once it's there (on the bright side) you know exactly where its needed üôÇ",
        "created_at": "2023-01-12T00:47:33.159000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "it doesn't exactly map to the block though?",
        "created_at": "2023-01-12T00:58:52.402000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "it's ... akin to optimistic sync somewhat",
        "created_at": "2023-01-12T00:59:14.725000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "it's this additional side-condition which must pass (like EL validation) for a block to be valid, for gossip only. but it's not part of the block, and one can sync later with no reference to the sidecar",
        "created_at": "2023-01-12T00:59:51.198000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I don't know how else the blobs make their way to the proposer beacon node, this is my understanding how the builder flow would work - please correct me if i'm wrong",
        "created_at": "2023-01-12T02:02:34.852000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "38ff94c9d1d53bf9ef88ab79a26b73d317840a08a966b01c234e5351a7d45f03"
            }
        ]
    },
    {
        "author": "jimmygchen",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "would it be possible for the local EL to request the blobs (that aren't included in a block yet) from its peers?",
        "created_at": "2023-01-12T02:03:56.635000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "i'm not really up on the design, i thought they were going to be part of the block but i haven't been paying close attention",
        "created_at": "2023-01-12T02:05:29.806000+00:00",
        "attachments": null
    },
    {
        "author": "realbigsean",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "transactions in the block include blob versioned hashes, and the relays are providing us the tx root to sign over",
        "created_at": "2023-01-12T02:10:48.114000+00:00",
        "attachments": null
    },
    {
        "author": "realbigsean",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "blobs are necessary to validate a block when they're referenced by the new blob tx type, so blob inclusion seems like it should be a responsibility of the builder",
        "created_at": "2023-01-12T02:17:26.624000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "right, but i think it should return blobs as well since a CL can do its own separate publish of the block (here with sidecar) like we do in lodestar",
        "created_at": "2023-01-12T06:34:23.984000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "i don't think EL will sync blobs ever, their processing just works off on commitments",
        "created_at": "2023-01-12T06:37:32.977000+00:00",
        "attachments": null
    },
    {
        "author": "acolytec3",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Correct, at least in the current specs, the only time the EL touches the blobs is when the transactions are in the mempool. So, if the EL gets a payload from its CL for a block via the route \u003c@466006586477772831\u003e described, inclusive of transactions, the EL may never have retrieved corresponding blob txns from other EL nodes while those txns were in the mempool",
        "created_at": "2023-01-12T09:56:45.869000+00:00",
        "attachments": null
    }
]