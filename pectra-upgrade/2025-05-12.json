[
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "FYI, the sequence of eth1 bridge deprecation on mainnet:\n\nepoch 364,065 / https://beaconcha.in/slot/11650102 : the first voting period after the fork ended\nepoch 364,065 / https://beaconcha.in/slot/11650111 : the first portion of legacy deposits processed\n\nepoch 364,128 / https://beaconcha.in/slot/11652121 : the second voting period after the fork ended\nepoch 364,129 / https://beaconcha.in/slot/11652144 : the second portion of legacy deposits processed\n\nepoch 364,192 / https://beaconcha.in/slot/11654163 : the third voting period after the fork ended\nepoch 364,192 / https://beaconcha.in/slot/11654163 : the third portion of legacy deposits processed -- this is the *last one*\n\nepoch 364,603 : *the last* legacy deposit (https://beaconcha.in/tx/0xb16884da3af8c936e43b9e3b3fecb0f3324dd4cce0f5e78ba9184cde888d9e2d) processed by CL",
        "created_at": "2025-05-12T06:06:22.291000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "general",
        "parent": "",
        "content": "Any objection to remove that legacy deposit code from CL clients?",
        "created_at": "2025-05-12T09:57:45.389000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "Nimbus already did: https://github.com/status-im/nimbus-eth2/pull/7114",
        "created_at": "2025-05-12T10:14:51.337000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "general",
        "parent": "",
        "content": "Same here https://github.com/grandinetech/grandine/pull/205",
        "created_at": "2025-05-12T10:15:56.187000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "And as that PR states, the EIP via https://eips.ethereum.org/EIPS/eip-6110#eth1data-poll-deprecation seems to explicitly invite this:\n\u003e Consensus layer clients will be able to remove `Eth1Data` poll mechanism in an uncoordinated fashion once transition period is finished. The transition period is considered as finished when a network reaches the point where `state.eth1_deposit_index == state.deposit_requests_start_index`.",
        "created_at": "2025-05-12T10:16:10.846000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "general",
        "parent": "",
        "content": "And how about that ancient genesis tracking. Is it removed among CL clients or there may still be some networks that may benefit from it?",
        "created_at": "2025-05-12T10:17:26.951000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "Could you clarify what you mean by ancient genesis tracking?",
        "created_at": "2025-05-12T10:19:48.467000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "general",
        "parent": "",
        "content": "The code that allows to lauch the client for the network that is pre-genesis.",
        "created_at": "2025-05-12T10:21:44.241000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "general",
        "parent": "",
        "content": "So this code would be usable for networks that are now still pre-merge.",
        "created_at": "2025-05-12T10:22:35.011000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "Oh, ok, I personally distinguish between block application, the ability to take the sequence of blocks and play them back from the genesis, and the ability to have actually operated in that pre-merge environment re-do the merge. As far as I can tell, the specs have gradually deprecated the ability to re-do the merge anyway",
        "created_at": "2025-05-12T10:24:05.933000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "The former is significantly more straightforward to support than the latter",
        "created_at": "2025-05-12T10:24:58.279000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "general",
        "parent": "",
        "content": "ok, so whats the status with the latter?",
        "created_at": "2025-05-12T10:25:36.066000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "general",
        "parent": "",
        "content": "is it removed from the codebases of CLs? We still have it.",
        "created_at": "2025-05-12T10:25:59.123000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "general",
        "parent": "",
        "content": "BTW, the former - backtracking to the genesis should be supported by the clients in my opinion. I'm just looking is there relevant use cases to support the merge . Otherwise we can get rid of that code.",
        "created_at": "2025-05-12T10:27:56.307000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "For Nimbus, I can say, I don't think it could do the merge again. I'd have to check, but the specs have started making post-merge assumptions too",
        "created_at": "2025-05-12T10:28:11.925000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "That said, Nimbus runs/passes all of the EF consensus spec tests we can find [except for some fork choice ones unrelated to this for unrelated reasons] and don't have to exclude any of them. But, one point is that the specs explicitly don't allow the merge to occur past Bellatrix anymore",
        "created_at": "2025-05-12T10:30:03.553000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "Compare https://github.com/ethereum/consensus-specs/blob/v1.5.0/specs/bellatrix/beacon-chain.md#process_execution_payload and https://github.com/ethereum/consensus-specs/blob/v1.5.0/specs/capella/beacon-chain.md#modified-process_execution_payload and the `if is_merge_transition_complete(state):` condition is gone",
        "created_at": "2025-05-12T10:31:00.326000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "That is, EF specs assume the merge will have happened by the time Shapella does",
        "created_at": "2025-05-12T10:31:19.317000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "That did not used to be the case, because logically, one can run the consensus spec protocol indefinitely (through Fulu even) unmerged",
        "created_at": "2025-05-12T10:31:50.440000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "Another example is that `exchangeTransitionConfiguration`, part of the merge infrastructure, was deprecated in https://github.com/ethereum/execution-apis/pull/420",
        "created_at": "2025-05-12T10:38:41.868000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "general",
        "parent": "",
        "content": "OK, I think it's safe to remove, but I'm just wondering which clients actually did it.",
        "created_at": "2025-05-12T10:40:13.191000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "general",
        "parent": "",
        "content": "Some EL had issues even supplying the correct TTD block … I won’t throw stones, I don’t recall which, but we had to allow overriding it in teku because of an error in an EL that wasn’t going to be resolved iirc",
        "created_at": "2025-05-12T10:52:33.008000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "eth1_data voting matters for block building only, all blocks since genesis can still be replayed even if the voting is removed from the codebase. Although, if the removal happens, re-doing the merge won't be possible as \u003c@654267572107083777\u003e mentioned above",
        "created_at": "2025-05-12T11:32:24.423000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "general",
        "parent": "",
        "content": "yes, the concern I raised is that maybe there is some networks or some other exotic use cases that are still pre-merge.",
        "created_at": "2025-05-12T11:34:05.579000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "I don't know how durable those can be, because \"the merge\", per se, is a singular [yes, one option for Beam, etc, but that's different altogether] event. It's also worthwhile distinguishing between:\n- a network being launched postmerge (most new networks following Ethereum consensus presumably)\n- a network never intending to merge (works fine, it can't carry transactions but it can run Casper FFG, Nimbus's `block_sim` tests does this, as well as some other testing infrastructure, and Nimbus just ignores that Capella must-be-merged condition, it was never a good idea, for this exact kind of reason)\n- a network which after a few years is running a PoW or non-PoW setup, and wants to transition to non-(Ethereum PoS): out of scope of the merge support to begin with;\n- a network which after a few years is running a non-PoW setup, and wants to transition to an Ethereum PoS: also out of scope of the merge infrastructure, it was never designed/tested for that to begin with; and\n- the only case where in theory this could still be a concern, another merge-like scenario, a network specifically running an pre-merge Ethereum PoW network today and wanting to become an Ethereum PoS network.\n\nBut the other four use cases listed are either supported regardless of supporting \"the merge\", or never were supported by the merge infrastructure. The last one isn't a durable use case, because it's another one-off event for that chain, unless there's an unexpected long tail of never-merged-but-wants-to-merge Ethereum PoW chains. The ones which exist partly forked _explicitly_ to avoid merging. So I'm skeptical",
        "created_at": "2025-05-12T11:43:01.646000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "for example, for point (4), the non-PoW-to-now-PoS, those did exist, various kinds of PoA, etc",
        "created_at": "2025-05-12T11:45:41.243000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "but unless it had a \"difficulty\" (TTD) exactly like Ethereum PoW attached it was never tested",
        "created_at": "2025-05-12T11:46:27.030000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "So unless your postulated exotic use case is doing merges over and over, you're going to run out of networks to merge. The complexity isn't really in supporting either pre-merge networks, per se, it's mostly in the merge infrastructure, doing that transition. Starting pre-merge and staying pre-merge is fairly simple.",
        "created_at": "2025-05-12T11:51:44.303000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "If we want to drop eth1_data voting from clients code we should be sure that there is no known network among the existing ones that might require it in the future, in other words that all existing networks we know has been upgraded to Pectra. If this is the case, I think clients may safely drop that piece of code",
        "created_at": "2025-05-12T12:01:09.518000+00:00",
        "attachments": null
    },
    {
        "author": "sauliusgrigaitis",
        "category": "general",
        "parent": "",
        "content": "One of the reasons why we haven't removed it is that this change is quite heavy in terms of the codebase structure. So it's not about the arguments that the current pre-merge code is kinda broken anyway, but it's more about - do we know some similar merge cases that may happen again? If yes, then it may make sense to leave the current code.",
        "created_at": "2025-05-12T13:10:19.076000+00:00",
        "attachments": null
    }
]