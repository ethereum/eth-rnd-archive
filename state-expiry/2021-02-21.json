[
    {
        "author": "pauld.9606",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It depends on how you define it. I am working to make the spec as generic as possible, not tied to any specific algorithms or hardware. I.e., future-proof.",
        "created_at": "2021-02-21T00:52:37.168000+00:00",
        "attachments": []
    },
    {
        "author": "pauld.9606",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is challenging to have both performance and future-proofness.",
        "created_at": "2021-02-21T00:52:40.294000+00:00",
        "attachments": []
    },
    {
        "author": "pauld.9606",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But not impossible! (I hope to have both.)",
        "created_at": "2021-02-21T00:52:54.378000+00:00",
        "attachments": []
    },
    {
        "author": "pauld.9606",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "For add/submod384, I want to keep the modular reduction as just a conditional subtraction/addition. This is the common case which we need to be fast.",
        "created_at": "2021-02-21T00:54:33.440000+00:00",
        "attachments": []
    },
    {
        "author": "pauld.9606",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It would be nice to remove the \"modulus must be odd\" restriction.",
        "created_at": "2021-02-21T00:58:02.605000+00:00",
        "attachments": []
    },
    {
        "author": "pauld.9606",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I have thought about this briefly, but I have not had time to focus on it yet.",
        "created_at": "2021-02-21T00:58:17.982000+00:00",
        "attachments": []
    },
    {
        "author": "pauld.9606",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "To clarify, add/submod384 don't have a \"modulus must be odd\" restriction. mulmodmont384 does. I would like to remove this restriction.",
        "created_at": "2021-02-21T03:13:52.636000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There is one simple-and-dumb way to do that: count the number of 0 bits and represent m as `m * 2**e`, then use `x % m = (x - (x % 2**e)) % m + (x % 2**e) % m`",
        "created_at": "2021-02-21T19:36:15.132000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Basically treat the higher bits and lower bits separately",
        "created_at": "2021-02-21T19:36:26.948000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But I guess that could add bit twiddling overhead....",
        "created_at": "2021-02-21T19:36:41.423000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And counting 0 bits takes work, so this would work best with the \"set modulus\" method",
        "created_at": "2021-02-21T19:36:55.253000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Or perhaps there's a generalization of montgomery that works well with gcd != 1?",
        "created_at": "2021-02-21T19:37:43.894000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "----------------------------------------------------------------------------------------------------------",
        "created_at": "2021-02-21T19:38:49.788000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So I want to have a more focused discussion on resurrection conflicts here at some point. It's a problem that I think it would be good to get us on the same page toward a solution for.",
        "created_at": "2021-02-21T19:42:42.067000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "See https://hackmd.io/@HWeNw8hNRimMm2m2GH56Cw/state_size_management#Resurrection-conflicts",
        "created_at": "2021-02-21T19:43:01.400000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think it's the key barrier toward implementing a \"good\" state expiry scheme",
        "created_at": "2021-02-21T19:43:22.261000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And also my arguments for why we need storage-slot granularity a bit further above\n\n--------------------------------------------------------------------------------------------",
        "created_at": "2021-02-21T19:46:23.994000+00:00",
        "attachments": []
    },
    {
        "author": "pauld.9606",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(Hah, I just read Koc's \"Montgomery reduction with an even modulus\" this morning which uses a trick like this to split the modulus just like you did.) Nice trick, glad you wrote it down. Yes, this may work with the \"set modulus\" method.",
        "created_at": "2021-02-21T20:22:17.346000+00:00",
        "attachments": []
    },
    {
        "author": "pauld.9606",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Your suggestion is the best that I have seen.",
        "created_at": "2021-02-21T20:22:49.089000+00:00",
        "attachments": []
    },
    {
        "author": "pauld.9606",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "To be clear, I want `MULMODMONT` to compute the standard montgomery multiplication `(x*y*R^{-1}) % mod`. Not `(x*y) % mod`.",
        "created_at": "2021-02-21T20:23:26.963000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "right",
        "created_at": "2021-02-21T20:23:41.300000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My math above was actually just doing `x % mod`",
        "created_at": "2021-02-21T20:23:55.665000+00:00",
        "attachments": []
    },
    {
        "author": "pauld.9606",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I imagine that one day, there will be crypto coprocessors which can compute `x*y % mod` fast, but I assume they will go up to a certain bitwidth because of hardware size limitations. So `MULMODMONT` may still be needed for large bigints.",
        "created_at": "2021-02-21T20:24:14.046000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But multiplying by invR during the reduction is a linear operation so it should still work",
        "created_at": "2021-02-21T20:24:17.374000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If montgomery is faster in software might it not be faster in hardware as well?",
        "created_at": "2021-02-21T20:24:45.313000+00:00",
        "attachments": []
    },
    {
        "author": "pauld.9606",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Good question.",
        "created_at": "2021-02-21T20:25:00.090000+00:00",
        "attachments": []
    },
    {
        "author": "pauld.9606",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I don't know.",
        "created_at": "2021-02-21T20:25:03.824000+00:00",
        "attachments": []
    }
]