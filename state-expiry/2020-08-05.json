[
    {
        "author": "madeof_tin7509",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Nice",
        "created_at": "2020-08-05T00:05:23.666000+00:00",
        "attachments": null
    },
    {
        "author": "pauld.9606",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "How long until RAM overflows, in the worst case? A first estimate follows. With 12,500,000 gas limit, one can create ~600 leafs per block. Each leaf requires 32 bytes plus the memoized merkle hashes and tree structure/index. So, say, 40 kb of new active state per block. So 250 mb per day. So RAM may overflow in a few weeks.",
        "created_at": "2020-08-05T00:46:26.177000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e With 12,500,000 gas limit, one can create ~600 leafs per block",
        "created_at": "2020-08-05T00:46:43.403000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that's average case",
        "created_at": "2020-08-05T00:46:47.674000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Status quo theoretical max is 15000 leaves per block, with my proposed gas cost changes it would drop to ~4000 leaves per block",
        "created_at": "2020-08-05T00:47:07.645000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Aaaah I see you're measuring state expansion",
        "created_at": "2020-08-05T00:47:41.427000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But state *writing* would still expand the active state",
        "created_at": "2020-08-05T00:47:50.904000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But reading would not, I guess?",
        "created_at": "2020-08-05T00:47:56.347000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Then it's 2500 leaves per block",
        "created_at": "2020-08-05T00:48:12.254000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "you have to also take into account the merkle branches of the active state items",
        "created_at": "2020-08-05T00:48:59.853000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm less hopeful about keeping state fully in RAM because of the being no firm bounds on the active state size.",
        "created_at": "2020-08-05T00:49:16.699000+00:00",
        "attachments": null
    },
    {
        "author": "pauld.9606",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My worst case estimate is a block which does SSTORE 600 times at 20,000 gas each. Maybe there are worse cases.",
        "created_at": "2020-08-05T00:58:45.965000+00:00",
        "attachments": null
    },
    {
        "author": "pauld.9606",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "A worse case is to CREATE contracts totaling ~60kb per block. At 200 gas per byte of code.",
        "created_at": "2020-08-05T01:34:49.539000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "one thing to consider is how regenesis (semi-statelessness) fits into eth2 sharded designs\n\nIf there is just one shard chain (Ethereum today) of many that has state and uses regenesis, then it is not entirely out of the question to assume all validators have this regenesis'd sub-state at all times.\nBut if we expand state/execution to more shards (which seems likely but not set in stone), this assumption is not longer reasonable in the sharded design. So this breaks the ability for committees to quickly swap between shards and validate blocks unless all validators keep all of the shards' regenesis'd sub-state at all times -- breaking the intention for small amounts of validators to be able to run on consumer hardware\n \nThere is a world in which state on one shard is \"good enough\" in the context of rollups and other layer 2s leveraging the high scale data layer of eth2, but at this point, I don't think anyone is ready to commit to that path.\nSo, I do think we still need to continue to attempt address the issues to allow for full statelessness eventually",
        "created_at": "2020-08-05T02:31:10.558000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e My immediate intuition is to get it right and have it happen automatically, but I'm just catching up on regenesis today\n\u003c@!291925846556540928\u003e One could *very* easily argue that the difficulty bomb can trivially be automated away (literally, just delete the bomb code) yet we retain it for exactly the reasons \u003c@456226577798135808\u003e mentioned.  At least with the state bomb there is a \"thing\" that happens periodically that needs action and we will write *less* code to not automate it, unlike the difficulty bomb which required writing *more* code to not automate it.",
        "created_at": "2020-08-05T02:35:44.560000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e Would likely break some contracts relying on chain_id\n\u003c@!278762485497069569\u003e What contracts rely on `chain_id`?  I didn't even know it was available on-chain (an opcode)?",
        "created_at": "2020-08-05T02:37:30.574000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Many meta-transaction framework or contract that relies on signature like order book based dexes",
        "created_at": "2020-08-05T02:45:59.555000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Almost all smart contract wallet that use create2 need to rely on chainID, since the same user wallet is deployed at the same address on multiple networks",
        "created_at": "2020-08-05T02:46:38.338000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I would assume state-channels and other L2s relying on signatures would care about chain ID too",
        "created_at": "2020-08-05T02:47:03.483000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This seems like a bad design pattern.",
        "created_at": "2020-08-05T02:47:14.182000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Especially since if we ever have a contentious hard fork in the future I am going to argue *really* hard to have both branches of the fork have unique chain IDs since there is a *ton* of power in defaults that I don't think either side of a contentious fork should have.",
        "created_at": "2020-08-05T02:47:42.343000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Why? You want to sign a transaction that works only on one network, chain ID is the natural opcode to use",
        "created_at": "2020-08-05T02:47:47.301000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Signing a transaction is fine, because in a fork (where chain ID changes) you can just sign a new transaction.",
        "created_at": "2020-08-05T02:48:15.506000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The problem is the expectation that chain ID is constant for the life of a chain, because that assumes there is no branching.",
        "created_at": "2020-08-05T02:48:28.152000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The entire governance model for fork-based governance explicitly assumes that there is *not* a single canonical chain, it is a tree.",
        "created_at": "2020-08-05T02:48:56.230000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And chain ID represents branches of that tree and can change over time depending on the specific path you follow.",
        "created_at": "2020-08-05T02:49:11.911000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So you should *not* use ChainID for something like salt in a CREATE2 address.",
        "created_at": "2020-08-05T02:49:27.914000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I would assume most projects just use the opcode chainid, so if there is a hardfork and chainID changes, then probably fine, but it could invalidate many in-flight signatures that people would otherwise consider valid",
        "created_at": "2020-08-05T02:49:28.218000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Hmm, I didn't know there was a CHAINID opcode!",
        "created_at": "2020-08-05T02:49:43.773000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e  ChainID for something like salt in a CREATE2 address\nThat's not where you use it, you would use it for something like EIP-712",
        "created_at": "2020-08-05T02:50:03.067000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Hmm, I don't see a CHAINID opcode in the yellow-paper.  Do you know what number it is?",
        "created_at": "2020-08-05T02:50:36.373000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Such that Bob has the same smart wallet on all networks at the same address and the only difference when they sign a meta-tx is which chain ID they specify in the payload they sign",
        "created_at": "2020-08-05T02:50:38.718000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think that is fine.  It just means a transaction signed before the fork won't work after the fork.  Not a big deal IMO.",
        "created_at": "2020-08-05T02:51:03.385000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Was a pretty recent EIP I think",
        "created_at": "2020-08-05T02:51:06.955000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah, not implemented yet?",
        "created_at": "2020-08-05T02:51:15.418000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Or perhaps part of Berlin?",
        "created_at": "2020-08-05T02:51:18.295000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think its https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1344.md",
        "created_at": "2020-08-05T02:51:49.550000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`0x46`",
        "created_at": "2020-08-05T02:52:02.056000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I like this one much more if it isn't too late (from the description at least, haven't read details): https://eips.ethereum.org/EIPS/eip-1959",
        "created_at": "2020-08-05T02:52:11.471000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yep, that would be nice indeed",
        "created_at": "2020-08-05T02:53:01.270000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If I understand the use case you are describing, I don't think chain ID changing once every 3 to 6 months is going to cause much trouble.  There would be a bit of thrash around the fork block as transactions that were created before the fork block would be invalid if mined after the fork block (unless 1959 was implemented instead of 1344) but otherwise everything should work.  Does that align with your understanding?",
        "created_at": "2020-08-05T02:56:25.827000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@291925846556540928\u003e i see regenesis as a parallel and complimentary track to statelessness",
        "created_at": "2020-08-05T02:56:47.832000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e There would be a bit of thrash around the fork block as transactions that were created before the fork block would be invalid if mined after the fork block (unless 1959 was implemented instead of 1344) but otherwise everything should work.  Does that align with your understanding?\n\nThis is what I envision indeed, not sure if there would be other issues",
        "created_at": "2020-08-05T03:46:47.254000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Personally, that doesn't seem bad enough to say no to new chain ID per regenesis on its own, but maybe a bunch of small problems like this could total up to a \"nah\" vote from me.",
        "created_at": "2020-08-05T06:38:45.075000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "CHAIN_ID opcode was introduced specifically to make sure smart contracts can cope with changing Chain ID. And, ideally, we should be changing chain Id at every single hard fork, because its purpose is replay protection. Otherwise, we just saying \"Ah, the other chain will definitely not survive, so why bother\"",
        "created_at": "2020-08-05T07:24:23.999000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!291925846556540928\u003e full statelessness can be achieved, I think, if we figure out the practicalities of block witnesses and transaction witnesses complementing each other. Yesterday, I realised (and then added to the doc) that block witnesses can be used by miners to \"patch\" any holes in the transaction witnesses, if they wish to. And, I will also add to the document that if we have some form of \"thin blocks\" (where blocks are just list of tx id + block witness, and you can obtain the actual transactions from the tx pool), then the main concern about Stateless Ethereum (very large block witnesses) goes away",
        "created_at": "2020-08-05T07:28:28.505000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I have updated the document to include the ideas about changing ChainID and about Thin Blocks: https://ledgerwatch.github.io/regenesis_plan.html",
        "created_at": "2020-08-05T08:03:30.070000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Is there anywhere discussing switching to binary tree and how if we went with ReGenesis?",
        "created_at": "2020-08-05T15:38:40.183000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "still thinking about it",
        "created_at": "2020-08-05T15:41:33.168000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Would ReGenesis be viable without this change? Witnesses would be very large without binary tree even for Regenesis, wouldn't they?",
        "created_at": "2020-08-05T16:05:30.076000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I.e. I can access new state for the current \"regenesis epoch\" that maximize witness size",
        "created_at": "2020-08-05T16:06:14.359000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We need to get some backtesting data before I can answer this question",
        "created_at": "2020-08-05T16:33:56.300000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "also, I am not too worried about larger witnesses, because we might be able to do Thin blocks",
        "created_at": "2020-08-05T16:34:15.914000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e you can obtain the actual transactions from the tx pool), then the main concern about Stateless Ethereum (very large block witnesses) goes away\ndo we generally have 100% propagation by the time a tx is included in a block?\n\nwhat happens when I want to sync execute past blocks (say since regenesis). Would these blocks be provided with full TXs whereas immediately gossip'd blocks would just have TX ids due to the assumption of mempool access?\n\nAnd I assume we'd need a p2p protocol for requesting recent TXs via tx-id to fill in the gaps when the optimistic assumption that my local mempool has all requisite TXs fails\n\nOne worry is the idea of creating a block with a false TX id and that being a DoS vector. I think the simple response is that the PoW (or valid PoS signature) is \"expensive\" and thus this vector is expensive. Still though, need to consider upon what conditions a user (a) propagates a tx-id filled block (e.g. do they validate that they have all the TXs before propagation?) and (b) at what point based on requesting requisite TXs does the node drop the block as a failure and  thus not incorporate into fork choice",
        "created_at": "2020-08-05T17:32:31.872000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e \nwhat happens when I want to sync execute past blocks (say since regenesis). Would these blocks be provided with full TXs whereas immediately gossip'd blocks would just have TX ids due to the assumption of mempool access?\n\u003c@!291925846556540928\u003e Those will have full witnesses included. So if you request a block body, you will get full tx with witnesses. When the new block propagates (it is currently message `NewBlock` in eth/65, with code 0x07, then it only contains tx IDs",
        "created_at": "2020-08-05T17:35:00.109000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "currently, go-ethereum propagates full blocks to sqrt(peer_number) of random peers, and then announces block hash to the rest",
        "created_at": "2020-08-05T17:35:58.819000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "if there is pre-consensus, showing few fields from the header, like mining nonce, coinbase, can be enough to propagate the block, so it can be propagated to all peers",
        "created_at": "2020-08-05T17:37:39.942000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "which means that the block propagation is potentially even faster than today",
        "created_at": "2020-08-05T17:37:56.105000+00:00",
        "attachments": null
    }
]