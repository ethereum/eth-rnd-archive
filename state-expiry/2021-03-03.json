[
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Does anyone have numbers for how much faster a storage/account read would be if storage were 10 GB?",
        "created_at": "2021-03-03T02:00:31.932000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Or any number significantly smaller than storage size today",
        "created_at": "2021-03-03T02:00:52.250000+00:00",
        "attachments": []
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thinking about the case where state expires every year, and if that would help push worst-case block verification times even further down",
        "created_at": "2021-03-03T02:01:23.263000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Small enough to fit into memory == *a lot faster*.",
        "created_at": "2021-03-03T05:23:48.821000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "On this topic, do you have any numbers on how big state would be if we implemented the thing we previously discussed where we only have to store state touched in the last year?",
        "created_at": "2021-03-03T05:24:50.383000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Current state is small enough that it could be mmaped into RAM directly",
        "created_at": "2021-03-03T07:43:02.716000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "cc \u003c@504539940760322048\u003e",
        "created_at": "2021-03-03T07:43:08.314000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Given enough RAM, anything can be mapped to RAM.  ðŸ˜„",
        "created_at": "2021-03-03T07:53:00.923000+00:00",
        "attachments": []
    },
    {
        "author": "b00ris",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "As i remember, state is about 30gb on block 11500000",
        "created_at": "2021-03-03T07:53:52.844000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Do you happen to know how much of that is cold vs warm (touched in the last year)?",
        "created_at": "2021-03-03T07:54:08.728000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And is that 30GB including the surrounding datastructures, or just for the state itself?",
        "created_at": "2021-03-03T07:54:36.556000+00:00",
        "attachments": []
    },
    {
        "author": "b00ris",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I don't know, but i can check",
        "created_at": "2021-03-03T07:54:59.014000+00:00",
        "attachments": []
    },
    {
        "author": "b00ris",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Accounts, storage, contracts",
        "created_at": "2021-03-03T07:55:21.431000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I mean like the merklization stuff as well, or is that just a sum of \"values\"?",
        "created_at": "2021-03-03T07:56:37.773000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Would love to get data on how much of state is cold vs warm (1 year).  Would let us talk more concretely about the effects of state expiry.",
        "created_at": "2021-03-03T07:57:27.422000+00:00",
        "attachments": []
    },
    {
        "author": "b00ris",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But keys is majority of state. Storage key - 64b, but value about 8(for tg data layout).",
        "created_at": "2021-03-03T07:59:35.734000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The 30GB number is keys + value?",
        "created_at": "2021-03-03T08:02:26.330000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Any other metadata or enveloping included?",
        "created_at": "2021-03-03T08:02:36.017000+00:00",
        "attachments": []
    },
    {
        "author": "b00ris",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Accounts, storage, contracts",
        "created_at": "2021-03-03T08:08:49.767000+00:00",
        "attachments": []
    },
    {
        "author": "b00ris",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "without any metadata. Just a flat state.",
        "created_at": "2021-03-03T08:10:17.933000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But I mean there wasn't any other structural data or metadata beyond that?  For example, in a traditional Ethereum client layout my understanding is that the merkle tree has a DB entry per path segment (ish).  The DB itself also has overhead per \"row\".",
        "created_at": "2021-03-03T08:10:42.761000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think for merklization we have intermediate hashes, not sure about the size of that table",
        "created_at": "2021-03-03T08:12:01.507000+00:00",
        "attachments": []
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "btw in OpenEthereum there is snapshot protocol `par` that takes whole state, packs it in rlp and sends it in chunk to other oe client. it is currently around ~22gb for block 11960000. Spec for what is inside can be found here: https://openethereum.github.io/Warp-Sync-Snapshot-Format",
        "created_at": "2021-03-03T08:15:58.648000+00:00",
        "attachments": []
    },
    {
        "author": "b00ris",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "is it compressed?",
        "created_at": "2021-03-03T08:17:22.431000+00:00",
        "attachments": []
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "hm, need to look, but it does have optimization: `if 0x02, the account has code, and code stores a 32-byte big-endian integer which is the hash of the code. The codeâ€™s hash must be substituted if and only if another account which has a smaller account entry has the same code.`",
        "created_at": "2021-03-03T08:18:11.687000+00:00",
        "attachments": []
    },
    {
        "author": "draganrakita",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yes it is compressed",
        "created_at": "2021-03-03T08:20:37.191000+00:00",
        "attachments": []
    },
    {
        "author": "b00ris",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I have a baseline for block 11500 with minor encoding optimisations.\naccounts hashed:\nkeys:   3431\nvalues: 1340\ntotal:  4771\naccounts plain:\nkeys:   2144\nvalues: 1340\ntotal:  3484\nstorage hashed:\nkeys:   24216\nvalues: 3978\ntotal:  28194\nstorage plain:\nkeys:   19675\nvalues: 3978\ntotal:  23654\nTotal hashed: 32965\nTotal plain: 27138",
        "created_at": "2021-03-03T10:18:16.318000+00:00",
        "attachments": []
    },
    {
        "author": "b00ris",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "in mb",
        "created_at": "2021-03-03T10:18:19.256000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "cc \u003c@!296630428754771968\u003e who just did some research on this topic.  I know that we found out that blocks regularly touched state that hadn't been touched for 1 million blocks.",
        "created_at": "2021-03-03T14:36:57.380000+00:00",
        "attachments": []
    }
]