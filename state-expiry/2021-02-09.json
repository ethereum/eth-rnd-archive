[
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think I have two main issues: \n\n1. why even describe it as being a \"restart\"? Surely you could just more generally allow the idea of spinning up a chain from an arbitrary genesis state and let that genesis state be the post-state of some block? (We could restrict to eg. multiples of 1000000, so that there's only one state file per 6 months so it's easy to torrent or whatever)",
        "created_at": "2021-02-09T05:37:43.617000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "2. Need to distinguish carefully between two kinds of forgetting: (i) forgetting old history, and (ii) forgetting old state. (i) is clearly the lower-hanging fruit, and we should actually do (i) before we get to doing (ii). Proposals to do (ii) are pretty much all going to be \"complicated\" in some way; you can't just make a new genesis file that removes old state because you have to actually verify that file, do the state split into \"old\" and \"new\", allow a way for old state to become new again, etc etc. Proposals to do (i) are relatively easy by comparison, because they all just amount to \"the eth protocol should stop even pretending to care about anything older than block N\"",
        "created_at": "2021-02-09T05:39:47.345000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(2) isn't really an argument against anything, it's more just a plea for clarity ðŸ˜†  make sure we don't fall into the trap of *comparing* schemes for (i) and schemes for (ii) when actually they do different things and are complementary",
        "created_at": "2021-02-09T05:40:45.666000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I kind of suspect (i) will be harder than we think.  Application developers have been building apps with a hard dependency on historic block headers, bodies, and receipts being available forever.  Even the ETH2 team (beacon chain) has created a hard dependency on ETH1 nodes keeping all state forever (or at least until The Merge).  ðŸ˜¢",
        "created_at": "2021-02-09T05:57:40.615000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think step 1 for (i) is to just assert clearly to everyone that chain history is not permanent and no one should have a hard dependency on it being available.  Perhaps along with that include an EOL policy.",
        "created_at": "2021-02-09T05:59:15.849000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "How hard do they depend on storing history blocks by every node in the network? Could that be replaced with other kind of storage? Like packaging every million blocks and serving them via bittorrent which is done by interested parties?",
        "created_at": "2021-02-09T06:05:12.137000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I don't know the specifics of what beacon chain demands, but applications scan for logs over historic blocks, which requires saving historic receipts (which can be pretty big).",
        "created_at": "2021-02-09T06:09:30.169000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I see. The beacon chain requires several hours of eth1 history to be available.",
        "created_at": "2021-02-09T06:19:45.022000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e Even the ETH2 team (beacon chain) has created a hard dependency on ETH1 nodes keeping all state forever (or at least until The Merge)",
        "created_at": "2021-02-09T06:20:47.761000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "wait, is this necessarily true?",
        "created_at": "2021-02-09T06:20:58.080000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "surely you can have eth2 clients that only verify the deposit data roots of, say, the last 3 months?",
        "created_at": "2021-02-09T06:21:42.090000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My understanding is that the beacon chain requires history back to the deposit contract deployment?",
        "created_at": "2021-02-09T06:23:27.236000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Why would it?",
        "created_at": "2021-02-09T06:23:34.332000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ðŸ¤·",
        "created_at": "2021-02-09T06:23:42.079000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!291925846556540928\u003e ?",
        "created_at": "2021-02-09T06:23:55.674000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Nethermind won't work as an ETH1 client using the defaults because it *doesn't* store headers/bodies/receipts for ancient blocks.  It had to get a special config to make it work with the beacon chain where it only prunes before the deposit contract I believe.",
        "created_at": "2021-02-09T06:24:24.049000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I don't know for certain if it is headers, bodies, or receipts that are needed specifically.",
        "created_at": "2021-02-09T06:25:03.504000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You do need receipts from Nov 2020 to generate the genesis state",
        "created_at": "2021-02-09T06:25:25.930000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But we can just pre-package the genesis state and put it into eth2 clients",
        "created_at": "2021-02-09T06:25:33.949000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That may be it then.",
        "created_at": "2021-02-09T06:25:36.517000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Why don't they?",
        "created_at": "2021-02-09T06:25:50.265000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So interestingly enough according to https://dev.to/q9/ethereum-2-0-mainnet-clients-3and only prysm actually checks receipts",
        "created_at": "2021-02-09T06:26:42.804000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e While this is a useful feature from a security perspective, as you do not have to trust the Prysm developers to give you the correct genesis state\nThis feels like a somewhat silly argument to me.  You already have to trust Prysm developers explicitly to give you correct code.  It is like getting a file's checksum from the same source as you get the file itself (assuming TLS for transport).",
        "created_at": "2021-02-09T06:29:22.363000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yeah I think it's cool-but-gimmicky",
        "created_at": "2021-02-09T06:29:57.235000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ultimately everything before the merge is \"socially coordinated\" and we should just embrace that",
        "created_at": "2021-02-09T06:30:14.856000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm a huge fan of social coordination.  The benefit of automated coordination is it is fast, but social coordination is *easier* if you only need to do it every now and then.",
        "created_at": "2021-02-09T06:30:59.025000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "From what I know it does not. Some of beacon clients are listening to updates of deposit contract online and create their own index consisting of eth1 data. This scheme does not depend on the history. Though, the history might be somehow used to serve user's RPC",
        "created_at": "2021-02-09T06:31:31.421000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It may be the thing mentioned about Prysm above.  I don't have a lot of details, only that Nethermind has to fetch some old data in order for it to be ea viable beacon chain ETH1 client (in at least some common enough cases to cause them to change the dafault config of Nethermind).",
        "created_at": "2021-02-09T06:33:39.974000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You do have to create a full merkle trie of the deposits so you can process them new deposits and I donâ€™t believe thatâ€™s possible just from the genesis state. I also donâ€™t think itâ€™s available from the eth1 world state and so you wind up pulling all the logs. \n\nThere may be a way around this but Iâ€™m not aware of any clients implementing such a thing.",
        "created_at": "2021-02-09T08:02:34.863000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That's a good point. Technically it's possible to retrieve a `branch` storage variable (via multiple `eth_getStorageAt` calls) from deposit contract and start tracking deposits online with the logic for merkle proof computation reflected from the contract.",
        "created_at": "2021-02-09T14:37:33.914000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If I am not mistaken, of course",
        "created_at": "2021-02-09T14:38:09.346000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "oof, that sounds awful.  I think I'd just put a copy of the merkle tree at some block number into the code and move it forward every so often.",
        "created_at": "2021-02-09T20:00:17.187000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Although that still requires being able to access some amount of log event history",
        "created_at": "2021-02-09T20:01:17.031000+00:00",
        "attachments": null
    }
]