[
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Apologies if this has already been answered or described in depth; there's a lot of text on regenesis and I haven't read all of it. So regenesis has tx witness + block witness. I'm wondering about tx sealing. Basically, which of these statements are (the most) correct?\n\n1. Transactions are signed without witness. Witnesses are an appendage to a tx, and do not actually remain when the tx is inside a block body. \n2. Transactions are signed _with_ witness data, so all tx witnesses are also part of the block body",
        "created_at": "2020-08-09T08:14:05.305000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Is there a reason it cannot be this \u003c@!211091239112671234\u003e?\n3. Transactions are signed without witness.  Witnesses are part of the block body.",
        "created_at": "2020-08-09T09:02:45.081000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Hmm, actually since the transaction signer has to pay for witness data, it *has* to be signed.",
        "created_at": "2020-08-09T09:03:24.241000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Otherwise a malicious miner could swap out an optimized witness for a worst-case-scenario witness payload and charge the transaction signer for it.",
        "created_at": "2020-08-09T09:03:56.486000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Note: This assumes EIP-2711 doesn't get implemented first, which would allow for the sponsor to pay for witness inclusion (in fact, I would argue that is where witness data should live).",
        "created_at": "2020-08-09T09:04:40.181000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The alternative is instead of paying for witness data byte-by-byte, you just explicitly charge a high amount of gas for accessing a not-recently-accessed account",
        "created_at": "2020-08-09T11:56:43.064000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "actually, stepping back.... one broader question about this plan",
        "created_at": "2020-08-09T11:59:02.564000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If a transaction touches an account that's not recent (ie. not part of the \"active state\"), the transaction sender themselves has to include the witness, right?",
        "created_at": "2020-08-09T11:59:28.465000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If that's the case, what happens if a transaction spends millions of gas and then touches an old account it didn't declare a witness for?",
        "created_at": "2020-08-09T12:00:08.383000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Is it invalid?",
        "created_at": "2020-08-09T12:00:19.042000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If so, then verifying a transaction at network layer would be a not-that-easy task, and would fall under DoS risk...",
        "created_at": "2020-08-09T12:01:23.808000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Now if on the other hand, we add a rule that says that if a tx call something not in the active state and not in the access list, that call fails but the execution continues",
        "created_at": "2020-08-09T12:02:20.524000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(which seems to be the only way to solve this conundrum)",
        "created_at": "2020-08-09T12:02:28.478000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Then you get the problem that you would need a witness going down to that account to prove that the tx actually has that effect",
        "created_at": "2020-08-09T12:03:04.598000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Unless you change the tree structure so that every node in the tree has a \"last block modified\" parameter",
        "created_at": "2020-08-09T12:03:31.839000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Otherwise, how would a newly fast synced client know that the account is not recent",
        "created_at": "2020-08-09T12:03:49.947000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Unless the idea is that fast syncing is only possible at all at epoch boundaries",
        "created_at": "2020-08-09T12:04:07.060000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But would be horrible, it basically introduces an \"implicit state\" that's not actually part of the merkle tree (namely, which accounts are active and which are not), which breaks a core invariant we've stringently maintained since day 1, and moves further away from the goal of full stateless verification being _possible_ (even if most clients don't do it)",
        "created_at": "2020-08-09T12:04:26.454000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sorry, so, to re-express the above and summarize: consider the case where a transcation does a lot of execution and then unexpectedly calls into some account A, which may be active state and may be inactive state. The transaction does NOT include an explicit witness for A or have it as part of an access list.\n\nCase 1: if A is inactive, transaction execution fails and the tx is invalid. This creates a DoS vuln.\nCase 2: if A is inactive, the call fails but tx execution continues. This means that the fact of (whether or not there exists an active account at any address) must be part of the active state, which means one of three things:\n\n(2.1) miners still need to download the full state tree, including active and inactive\n(2.2) every node of the state tree, including intermediate nodes, have a flag that says \"do I have at least one active child\"\n(2.3) the information of which accounts are active does not get merklized",
        "created_at": "2020-08-09T12:10:46.412000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I guess there's (2.4): there's a *separate* Merkle tree that keeps track of the set of active accounts?",
        "created_at": "2020-08-09T12:12:02.412000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e If that's the case, what happens if a transaction spends millions of gas and then touches an old account it didn't declare a witness for?\n\u003c@!273808422753796097\u003e IIUC from \u003c@456226577798135808\u003e's brief overview in the ACD call, as soon as that state access is hit, the transaction stops and all gas up to that point is spent (like a revert opcode essentially).",
        "created_at": "2020-08-09T12:12:15.073000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the transaction stops or the call stops?",
        "created_at": "2020-08-09T12:12:42.737000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "a revert opcode would mean the call stops",
        "created_at": "2020-08-09T12:12:57.369000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "He only covered it very briefly, but my understanding was that it was the same (effectively) as a REVERT opcode being hit.",
        "created_at": "2020-08-09T12:13:04.555000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ok, so it is case (2)",
        "created_at": "2020-08-09T12:13:12.202000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Though, one can imagine a full halt as well (e.g., no recovery possible).",
        "created_at": "2020-08-09T12:13:17.641000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that would be case (1), but that would be a DoS vuln as we decided in 2016",
        "created_at": "2020-08-09T12:13:36.223000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So then my question would be, which of (2.1), (2.2), (2.3) or (2.4) is true? Or is there some fifth option?",
        "created_at": "2020-08-09T12:14:00.156000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e This means that the fact of (whether or not there exists an active account at any address) must be part of the active state\nCan you help me understand why this is true?",
        "created_at": "2020-08-09T12:15:28.647000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so in principle the definition of \"state\" is \"data that is fully sufficient to evaluate the state transition function\", right?",
        "created_at": "2020-08-09T12:16:27.084000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah, the issue is differentiating between \"value has never been set\" and \"value has not been migrated from old state\".",
        "created_at": "2020-08-09T12:16:32.547000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so imagine that I tell you I have a transaction T, which has  no witness and no access list and runs this code:\n```\nfor i in range(1000000): x = (x * x * x + block.number + i)\nz = extcodesize(CONST_ACCOUNT_ADDRESS)\nsstore(x + z)\n```\nWhere `CONST_ACCOUNT_ADDRESS` is an address that I do not yet tell you. If you \"have the state\", you must be able to fully execute T no matter what `CONST_ACCOUNT_ADDRESS` is. But the result of T depends on whether or not `CONST_ACCOUNT_ADDRESS` is active, because if it is inactive, then correct execution of T reverts, and if it is active, it saves some value in storage. Hence, the information of the whether or not any given account is active must be in the state.\nBut if this is true, we cannot leave the Merkle tree format unchanged, because (i) the Merkle tree currently does not say which accounts are active, but even more scarily (ii) if you are provided a subtree that does NOT include some range X...Y, then you have no way to tell whether or not there is some active account hidden inside X...Y. So this means you can't actually authenticate whether or not you received a correct state.",
        "created_at": "2020-08-09T12:22:34.635000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So the easiest resolution as far as I can tell is just to stick with what we've been planning to do all along: fully-stateful miners, and a spectrum of stateless and semi-stateless clients (where regenesis is a standardized form of semi-statelessness).",
        "created_at": "2020-08-09T12:24:56.114000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "As stateful miners would have the full state and so they would be able to construct the appropriate witness",
        "created_at": "2020-08-09T12:25:54.470000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@301186049323958275\u003e well, I thought the block witness would suffice to exec all txs, and thus having tx-witness in blocks would just be bloat. However, the tx signed part could include the witness-root+size, but not the actual witness data.",
        "created_at": "2020-08-09T13:16:32.077000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Where root would never be validated after inclusion in a block",
        "created_at": "2020-08-09T13:19:54.960000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So the transaction would be signed asserting, \"there exists a witness that allows this transaction to process and is at most X bytes big\".  You need the witness to validate the block (validate that the assertion of size is true), and every future client that wants to sync would also need that data.",
        "created_at": "2020-08-09T13:24:18.945000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Though, maybe I'm missing something?",
        "created_at": "2020-08-09T13:24:24.194000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "hmm",
        "created_at": "2020-08-09T13:24:57.298000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "why do we need the transaction to sign over the witness?",
        "created_at": "2020-08-09T13:25:23.789000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "why can't block execution just compute the witness size of each tx and subtract that from its gas?",
        "created_at": "2020-08-09T13:25:52.516000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Witness sizes are not fixed, there is a \"worst case\" witness where you prove everything, but a client can provide a smaller witness size with a little bit of work.",
        "created_at": "2020-08-09T13:33:35.759000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "wait, how can you do work to make a smaller witness?",
        "created_at": "2020-08-09T13:33:48.179000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If miners are allowed to include any witness they want, they'll always pick worst case.",
        "created_at": "2020-08-09T13:33:52.174000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Isn't there only one witness that includes a particular set of state objects?",
        "created_at": "2020-08-09T13:34:03.060000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You can figure out what data *isn't* in active and provide a witness for that subset.",
        "created_at": "2020-08-09T13:34:09.174000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "As I understand it, at regenesis all state is dormant (not in the active set).  The first time after regenesis a state entry is referred to it will be included in the active set and it is assumed that all clients now have it in the active set.",
        "created_at": "2020-08-09T13:34:55.899000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You only *need* to provide witness data for state that isn't in the active set (hasn't appeared on-chain since last regenesis), but you *can* (if you are lazy) provide a witness of all data (since last regenesis).",
        "created_at": "2020-08-09T13:35:37.284000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "sure, but you could make the block commit to a list of accounts it accesses, and for a given state root and a given set of keys there's exactly one witness that covers those keys",
        "created_at": "2020-08-09T13:35:47.063000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "To make sure we are on the same page, transaction signer is the one paying per byte for witness data inclusion, right?",
        "created_at": "2020-08-09T13:36:35.059000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yes",
        "created_at": "2020-08-09T13:36:41.678000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And are we in agreement that a valid witness is \"all state referenced by the transaction\"?",
        "created_at": "2020-08-09T13:37:09.062000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But they don't need to know that witness size ahead of time, they just have to budget gas for an upper bound for all uncertain gas execution (including witness size but also storage updating and the like)",
        "created_at": "2020-08-09T13:37:15.258000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e \u003e And are we in agreement that a valid witness is \"all state referenced by the transaction\"?",
        "created_at": "2020-08-09T13:37:23.165000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "All state and only that state referenced by the transaction",
        "created_at": "2020-08-09T13:37:37.083000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(oh btw I'm not in favor of transactions including witness data, I think the block proposer should do it)",
        "created_at": "2020-08-09T13:37:58.289000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I believe \u003c@456226577798135808\u003e's plan with regenesis is specifically that transactions include the witness data.",
        "created_at": "2020-08-09T13:38:19.182000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Part of his push to move more costs away from the core and to the edges.",
        "created_at": "2020-08-09T13:38:29.476000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "why though.... that complicates things by 4x",
        "created_at": "2020-08-09T13:38:32.011000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "why can't we first do the 80/20 and remove the need for non-miners to have state?",
        "created_at": "2020-08-09T13:38:44.251000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also if transactions have to include witness data I think we still have the dilemma I mentioned above",
        "created_at": "2020-08-09T13:40:15.214000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e Sorry, so, to re-express the above and summarize: consider the case where a transcation does a lot of execution and then unexpectedly calls into some account A, which may be active state and may be inactive state. The transaction does NOT include an explicit witness for A or have it as part of an access list.\n\u003e \n\u003e Case 1: if A is inactive, transaction execution fails and the tx is invalid. This creates a DoS vuln.\n\u003e Case 2: if A is inactive, the call fails but tx execution continues. This means that the fact of (whether or not there exists an active account at any address) must be part of the active state, which means one of three things:\n\u003e \n\u003e (2.1) miners still need to download the full state tree, including active and inactive\n\u003e (2.2) every node of the state tree, including intermediate nodes, have a flag that says \"do I have at least one active child\"\n\u003e (2.3) the information of which accounts are active does not get merklized\n\u003c@!273808422753796097\u003e ^ this",
        "created_at": "2020-08-09T13:40:31.497000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, I don't know what his idea was for that.  My knowledge of regenesis is pretty weak, basically just tidbits I have picked up here and there.  Certainly no expert.  ðŸ™‚",
        "created_at": "2020-08-09T13:41:06.887000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yeah, I definitely don't see the rationale for the pivot.... I always thought the roadmap of \"first let's make everyone but miners stateless, and worry about miners as a later stage 2\" was super pragmatic and correct",
        "created_at": "2020-08-09T13:41:48.883000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Re: \"miners have full state\" I think that is certainly an improvement over current, though I can also appreciate Alexy's desire to push costs to the edge as much as possible (taking that last 20% gain).",
        "created_at": "2020-08-09T13:42:14.585000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It encourages those at the edges to \"do better\" rather than \"meh, the miners will handle it\".  Could lead to better designs of dapps and such.",
        "created_at": "2020-08-09T13:43:35.729000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "right, but we could just add the gas costs today that pretend that we don't have stateful miners to encourage the dapp devs",
        "created_at": "2020-08-09T13:44:10.714000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is easier to say \"figure it out edge people\" than to try to *correctly* price in those costs I think is the idea.",
        "created_at": "2020-08-09T13:48:10.913000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "hmm, that doesn't seem true",
        "created_at": "2020-08-09T13:48:28.959000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Because the edge costs are an externality anyway",
        "created_at": "2020-08-09T13:48:35.318000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "they're witness data that network participants have to download",
        "created_at": "2020-08-09T13:48:43.116000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so we have to correctly price it no matter what happens",
        "created_at": "2020-08-09T13:48:49.814000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I do like the idea of miners giving the smallest dataset (per consensus) in the block, rather than telling the edge to \"figure it out\" and sometimes they provide excess data because they don't care about the costs-per-byte (or because we underpriced it).",
        "created_at": "2020-08-09T13:50:15.778000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If the miner is constructing witness per block, does that mean they can reorder transactions to change *who* pays for witness data?",
        "created_at": "2020-08-09T13:50:44.650000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If two transactions in a block both touch the same previously-dormant piece of data, the miner can order the transaction such that one of them pays for inclusion (the first) and the other doesn't I think?",
        "created_at": "2020-08-09T13:51:16.348000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I was thinking a setup where each transaction pays for the subset of the witnesses it uses; if the transactions intersect then they both pay for the same chunks",
        "created_at": "2020-08-09T13:51:25.591000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I don't see a problem with this, just trying to understand.",
        "created_at": "2020-08-09T13:51:27.350000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "and that's an acceptable cost",
        "created_at": "2020-08-09T13:51:29.639000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "we could also give a half-refund to both transactors at the end if we want, I don't really care",
        "created_at": "2020-08-09T13:51:50.726000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That seems like in encourages the miners to pick as many transactions at once that touch the same data, so as to maximize their fees for that block.",
        "created_at": "2020-08-09T13:52:15.694000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is pretty minor, again probably not a big issue.",
        "created_at": "2020-08-09T13:52:28.737000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "well, in an EIP 1559 regime, on average the optimal miner strategy would be to take *all* the transactions",
        "created_at": "2020-08-09T13:52:45.435000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Really, within a few blocks of regenesis all of the live state will probably be included.",
        "created_at": "2020-08-09T13:52:50.286000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so the miner's choice would be the order",
        "created_at": "2020-08-09T13:52:55.287000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "and if we use a first-user-pays rule, the miner's optimal strategy will be....... including transactions in descending order of gasprice",
        "created_at": "2020-08-09T13:53:19.055000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "though I recall \u003c@!211091239112671234\u003e not liking cross-transaction interdependencies and preferring \"everyone pays\"",
        "created_at": "2020-08-09T13:53:52.281000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "and indeed my fixed-gas cost proposal (bump SLOAD and EXT opcodes to 3000) is implicitly everyone-pays",
        "created_at": "2020-08-09T13:54:27.521000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e why can't block execution just compute the witness size of each tx and subtract that from its gas?\n\nI've been advocating for this as well, since tx witnesses will likely be a nightmare for devs and users, especially on ReGenesis days. \n\nI've made this graph that looks at how good users are at predicting gas used by a transaction, which is primarily difficult because of the unpredictable chain's state, a similar challenge for ReGenesis, and the numbers were pretty bad ; \n\nhttps://discordapp.com/channels/595666850260713488/688075293562503241/727304381275570226",
        "created_at": "2020-08-09T14:06:33.501000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yeah, of course everyone habitually puts too much gas",
        "created_at": "2020-08-09T14:07:28.428000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "because there's no cost to putting in too much gas",
        "created_at": "2020-08-09T14:07:34.387000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "you get refunded anyway",
        "created_at": "2020-08-09T14:07:38.323000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "and I think that's fine",
        "created_at": "2020-08-09T14:07:43.454000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Well, there are small incentives to put accurate gas limits:\n\n1. Users sees lower fees to be paid, which is better for the dapps (especially true if dapps were mainstream)\n2. Smaller gas limits tend to be included earlier in blocks, as they are easier to fit in",
        "created_at": "2020-08-09T14:09:41.160000+00:00",
        "attachments": null
    },
    {
        "author": "phabc",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Nevertheless, ignoring the statistics, I feel confident in saying that being accurate at predicting gas costs is hard, especially when you have complex systems like DeFi where many contracts or states are touched by many independent users. People use higher gas limits than necessary because accurate estimations often lead to failed txs and I think this will be the same for tx witnesses",
        "created_at": "2020-08-09T14:12:34.366000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e and indeed my fixed-gas cost proposal (bump SLOAD and EXT opcodes to 3000) is implicitly everyone-pays\n\u003c@273808422753796097\u003e \n\nIs there an eip for that? I'd like to support it",
        "created_at": "2020-08-09T14:42:20.408000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "don't think there's a formal EIP; there was just the magicians thread and then the twitter thread",
        "created_at": "2020-08-09T14:42:53.084000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I guess it \"requires a champion\"?",
        "created_at": "2020-08-09T14:42:59.011000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sell me on it.  Why would I want to make SLOAD cost more?",
        "created_at": "2020-08-09T14:50:49.197000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "because it's absolutely necessary for bounding the witness size of a block to an acceptable amount",
        "created_at": "2020-08-09T14:51:13.371000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Is this one of those \"we need to do this or eventually Ethereum will fall over\" things, or does it provide more tangible/immediate benefits?",
        "created_at": "2020-08-09T14:51:54.951000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The sad reality is, that finding a champion for \"we need to make things cost more so Ethereum doesn't fall over\" are not popular.  Need to find someone who doesn't mind being \"the bad guy\".",
        "created_at": "2020-08-09T14:52:26.462000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Basically, the key benefit of bounding the witness size and enabling fully stateless verification is that an arbitrary subset of blocks can be verified. One concrete benefit in an eth2 context is that eth2 clients would only have to validate eth1 blocks (which is a very expensive procedure) when they happen to have been selected for that committee (ie. 1/2048 of the time) instead of always",
        "created_at": "2020-08-09T14:53:42.678000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also if we want to expand to multiple computation shards this becomes even more important",
        "created_at": "2020-08-09T14:54:04.353000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Otherwise, one challenge with partial statelessness strategies is that if you do the math, it turns out that \"active state\" can grow in size pretty quickly",
        "created_at": "2020-08-09T14:54:30.592000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Here's one way to look at it: suppose we use current gas costs with no change. Then, the active state can grow by 400MB per block (this is the same calculation as that used to compute the witness size), so theoretically an attacker could generate a sequence of 25 blocks that would immediately make the active state larger than lots of people's RAM",
        "created_at": "2020-08-09T14:55:26.546000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so it's quite hard for partial statelessness to actually *guarantee* active-state-in-RAM, unless you... implement my proposed reforms that make accessing all state significantly more expensive",
        "created_at": "2020-08-09T14:56:05.851000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "eg. if we set gas prices so the max witness size is 4 MB (my proposal 1 year ago), then you'd need at least half a day to get to that 10 GB (though maybe less if you include merkle branches), which is.... somewhat acceptable?",
        "created_at": "2020-08-09T14:57:15.091000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so the easiest way to enable *both* stateless verification and partial statelessness a la regenesis without horrible tradeoffs is to adjust gas costs to clamp down hard on the max witness size of a single block, with 4 MB being my proposed limit that would come from SLOAD and EXT opcodes costing ~2500",
        "created_at": "2020-08-09T14:59:10.558000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "hi everyone, here are my answers to the 2 main questions",
        "created_at": "2020-08-09T16:31:05.465000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "1) tx witness is included into the signable data, in other words, transaction sender completely determines the content of the tx witness and commits to it",
        "created_at": "2020-08-09T16:32:03.608000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "2) if tx execution hits inactive state, the transaction is still valid (i.e. it is included into the block), but its execution reverts completely (meaning that all state changes except for payment for gas are reverted, including all sub-calls).",
        "created_at": "2020-08-09T16:33:44.635000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@456226577798135808\u003e How do you differentiate between \"no state written here/0 value written here\" and \"state is here, but its value is unavailable without bringing a witness\"?",
        "created_at": "2020-08-09T17:24:24.905000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "this would be handled by a specific representation of the active state. I would say it is an implementation detail, and I am pretty sure it is possible to implement it efficiently",
        "created_at": "2020-08-09T20:03:08.255000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "a separate tree that stores active accounts is certainly possible",
        "created_at": "2020-08-09T20:42:39.147000+00:00",
        "attachments": null
    }
]