[
    {
        "author": "gurukamath",
        "category": "general",
        "parent": "",
        "content": "Will not be able to join the call tomorrow. Updates from me include review of the current Berlin PR and further understanding of 1559 for London implementation.",
        "created_at": "2022-07-11T16:11:20.998000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "I'm still stuck on modexp ^^;;",
        "created_at": "2022-07-11T16:11:41.395000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "In the EIP, it uses `((exponent \u0026 (2**256 - 1)).bit_length() - 1)` but geth uses the 32 most significant bytes?",
        "created_at": "2022-07-11T16:12:28.528000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "See https://github.com/ethereum/go-ethereum/blob/714fb302a5f1c19dc2fc3973d01210f4e2624a91/core/vm/contracts.go#L317",
        "created_at": "2022-07-11T16:13:03.695000+00:00",
        "attachments": null
    },
    {
        "author": "peter.davies",
        "category": "general",
        "parent": "",
        "content": "I think the EIP is supposed to mean 32 most significant bytes",
        "created_at": "2022-07-11T16:22:30.452000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Yeah, that's what I've gathered.",
        "created_at": "2022-07-11T16:22:38.425000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Nethermind has a great comment:\n\n```\n// Geth takes head here, why?\n```",
        "created_at": "2022-07-11T16:23:01.963000+00:00",
        "attachments": null
    },
    {
        "author": "peter.davies",
        "category": "general",
        "parent": "",
        "content": "Presumably the test harness they used passed the 32 most significant bytes of the exponent in the `exponent` variable.",
        "created_at": "2022-07-11T16:23:47.733000+00:00",
        "attachments": null
    },
    {
        "author": "peter.davies",
        "category": "general",
        "parent": "",
        "content": "The modexp EIPs are really bad at failing to explain *why* they the formula is what it is.",
        "created_at": "2022-07-11T16:24:42.692000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Then why do the `\u0026 (2**256 - 1)`?",
        "created_at": "2022-07-11T16:24:43.637000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "But yeah, I think you're right. The variable should at least be named `exponent_head` ðŸ˜›",
        "created_at": "2022-07-11T16:25:22.641000+00:00",
        "attachments": null
    },
    {
        "author": "peter.davies",
        "category": "general",
        "parent": "",
        "content": "My guess is a bug in the test harness concealed a bug in the specification.",
        "created_at": "2022-07-11T16:25:36.903000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "I'm also not exactly sure what to do when `.bit_length() - 1` is a negative number.",
        "created_at": "2022-07-11T16:26:05.302000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Say, for example, you set an `exponent_length` of 100, with a value of zero.",
        "created_at": "2022-07-11T16:26:28.240000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "(so 100 zero bytes)",
        "created_at": "2022-07-11T16:26:39.888000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Pretty sure geth just clamps that fragment to zero.",
        "created_at": "2022-07-11T16:27:11.830000+00:00",
        "attachments": null
    },
    {
        "author": "peter.davies",
        "category": "general",
        "parent": "",
        "content": "`(8 * (exponent_length - 32)) + ((exponent \u0026 (2**256 - 1)).bit_length() - 1)`  basically just means `exponent.bit_length() - 1`, but with an exception that you are only required to look at the highest word (32 byte words here). If the highest word is zero, you assume the highest bit of remaining words is set.",
        "created_at": "2022-07-11T16:34:16.878000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Yeah, that's what I figured",
        "created_at": "2022-07-11T16:35:13.517000+00:00",
        "attachments": null
    },
    {
        "author": "peter.davies",
        "category": "general",
        "parent": "",
        "content": "Of course, if the entire highest word is zero the caller should have specified a shorter word length.",
        "created_at": "2022-07-11T16:35:25.487000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Agreed ðŸ˜›",
        "created_at": "2022-07-11T16:35:32.398000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "But still, the right hand side of that expression can go negative",
        "created_at": "2022-07-11T16:35:48.801000+00:00",
        "attachments": null
    },
    {
        "author": "peter.davies",
        "category": "general",
        "parent": "",
        "content": "It kinda proves the point of this entire project, that EIPs contain code that is blatantly broken in ways that suggests it has never suffered the rigors of execution.",
        "created_at": "2022-07-11T16:37:28.582000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Yep",
        "created_at": "2022-07-11T16:37:43.379000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "I think I'm going to have to make a PR to update this EIP once I get it working.",
        "created_at": "2022-07-11T16:38:04.133000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Oh, interesting. I guess we don't need to make an estimate any more, since the `adjusted_exp_length` doesn't change.",
        "created_at": "2022-07-11T16:38:40.140000+00:00",
        "attachments": null
    },
    {
        "author": "peter.davies",
        "category": "general",
        "parent": "",
        "content": "The definition of `adjusted_exp_length` is exactly the same between both versions. It just gets renamed to `iteration_count`.",
        "created_at": "2022-07-11T16:41:47.249000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Interesting... so why did we have the estimate before, if it only depends on the first 32 bytes of the exponent?",
        "created_at": "2022-07-11T16:42:30.074000+00:00",
        "attachments": null
    },
    {
        "author": "peter.davies",
        "category": "general",
        "parent": "",
        "content": "The way I implemented it, we do an initial gas estimate after reading only the lengths. This avoids lots of edgecases involving excessively long lengths (due to failing out of gas). Reading the first 32 bytes of `exponent` is not trivial because they come after all the bytes of `base`.",
        "created_at": "2022-07-11T16:51:20.381000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "True, though in our implementation, it's already in memory, no? ðŸ˜›",
        "created_at": "2022-07-11T16:59:40.629000+00:00",
        "attachments": null
    },
    {
        "author": "peter.davies",
        "category": "general",
        "parent": "",
        "content": "Those calls to `right_pad_zero_bytes` could easily fill all available memory, so we have to protect them with a gas check.",
        "created_at": "2022-07-11T18:51:10.861000+00:00",
        "attachments": null
    },
    {
        "author": "peter.davies",
        "category": "general",
        "parent": "",
        "content": "I am on holiday from Wednesday for the rest of this week and then am at EthCC the following week, so I won't be around as much. I will be at spec sync tomorrow, but not the following week.",
        "created_at": "2022-07-11T18:58:41.954000+00:00",
        "attachments": null
    }
]