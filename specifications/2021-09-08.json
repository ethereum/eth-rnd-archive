[
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "\u003c@!564718359304863744\u003e I was wondering what happens with self-destruct if you were to have two contracts:\n\n```\ncontract Bar { function thing() { log(\"foo\"); selfdestruct(0); } }\ncontract Foo { function test(Bar bar) { bar.thing(); bar.thing(); } }\n```",
        "created_at": "2021-09-08T14:06:51.078000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "I noticed they get added to the to-be-removed list. Does the self-destruct not kick in until after the tx is done?",
        "created_at": "2021-09-08T14:07:47.398000+00:00",
        "attachments": null
    },
    {
        "author": "voith",
        "category": "general",
        "parent": "",
        "content": "Nope thats a set. so it only gets added once",
        "created_at": "2021-09-08T14:08:17.509000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "(sneaky edit)",
        "created_at": "2021-09-08T14:09:08.772000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "How many `log(\"foo\")` get produced/emitted?",
        "created_at": "2021-09-08T14:09:17.757000+00:00",
        "attachments": null
    },
    {
        "author": "voith",
        "category": "general",
        "parent": "",
        "content": "I had thought about that case and I think I've handled it correctly.\nBut before I answer your question I want to double check my idea.",
        "created_at": "2021-09-08T14:13:09.331000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "I literally have no idea what the correct behavior is, just wanted to check with you ðŸ˜›",
        "created_at": "2021-09-08T14:13:37.607000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "State Sync #15 \n - \u003c@!564718359304863744\u003e precompiles and double checking self-destruct\n - \u003c@!243183686562873344\u003e looking into databases\n - \u003c@!497280885645639691\u003e continuing sync\n\n(if I missed your update, speak up ðŸ˜… )",
        "created_at": "2021-09-08T14:38:00.030000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Just checked on remix. There should be two logs.",
        "created_at": "2021-09-08T14:42:06.067000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "That's... unexpected.",
        "created_at": "2021-09-08T14:42:09.979000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "At least for me.",
        "created_at": "2021-09-08T14:42:15.626000+00:00",
        "attachments": null
    },
    {
        "author": "voith",
        "category": "general",
        "parent": "",
        "content": "Yeah, thats what's happening in my implementation. \nHandling balances is the tricky part(to make sure that the beneficiary's  balance  doesn't get updated twice):\nThe code I have for this is:\n```\n    originator_balance = get_account(evm.env.state, originator).balance\n    # First Transfer to beneficiary\n    set_account_balance(\n        evm.env.state, beneficiary, beneficiary_balance + originator_balance\n    )\n    # Next, Zero the balance of the address being deleted (must come after\n    # sending to beneficiary in case the contract named itself as the\n    # beneficiary).\n    set_account_balance(evm.env.state, originator, U256(0))\n```",
        "created_at": "2021-09-08T14:45:13.904000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Perfect",
        "created_at": "2021-09-08T14:45:43.833000+00:00",
        "attachments": null
    }
]