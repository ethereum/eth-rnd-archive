[
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think we should also remove the 1 to 1 mapping. If a block is not known it should not return it in the list. It shouldn't be SSZ null as that makes us encode all non-null blocks with extra bytes. It's also easy to figure out which blocks are missing if any.",
        "created_at": "2019-09-01T08:14:10.717000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm happy to remove 1:1",
        "created_at": "2019-09-01T11:29:19.854000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "re constants, we can just use some random value like 1 or 10 mb or whatever",
        "created_at": "2019-09-01T11:29:42.544000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "one thing to think about: what's the correct behavior of a response that doesn't fit: truncate to fit as many responses as possible or error request (ie imagine loading the whole history of 4 months woth of blocks).. responding \"as much as possible\" makes some sense because the client making the request doesn't know how large the blocks are and thus cannot determine how many blocks to request",
        "created_at": "2019-09-01T11:31:14.258000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah, potentially we give an error response. I think batch requests should only ask for a max number of blocks which can never go over the max size to prevent this",
        "created_at": "2019-09-01T11:32:57.252000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yeah, it's just a bit risky: for the vast majority of cases it'll work, but then when someone spams the network with a max_size block, everything breaks down - or in the \"normal\" case we have to be very conservative",
        "created_at": "2019-09-01T11:34:18.833000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the problem here becomes to differentiate \"I don't have the block\" from \"I have the block ,but won't give it to you now\"",
        "created_at": "2019-09-01T11:35:14.110000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "True. So I guess a standard error response so that we can re-request less blocks in that case",
        "created_at": "2019-09-01T11:35:23.836000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Isnt the 1:1 mapping for BeaconBlocks already removed \u003c@498009160982724610\u003e? I think this is just a distinction on the ssz type (list or vector) and it should be list",
        "created_at": "2019-09-01T12:54:55.324000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I was referring to this: \n```\nThe response is a list of BeaconBlock with the same length as the request. Blocks are returned in order of the request and any missing/unknown blocks are left empty (SSZ null BeaconBlock)\n```\nIn the `RecentBeaconBlocks` request. Currently, we dont rely heavily on this request, but the spec currently would indicate a union type, when it may be more efficient to just have a list of beacon blocks, with unknown blocks removed.",
        "created_at": "2019-09-01T13:05:44.463000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We are currently only using `RecentBeaconBlocks` with a single hash lookup (if we don't know a parent), so we are not really looking up a list of hashes. It's more just about the encoding.",
        "created_at": "2019-09-01T13:09:46.308000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ah, but is \"an ssz null beaconblock\" an empty beaconblock or is it `null`",
        "created_at": "2019-09-01T13:12:01.456000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I would have assumed `null` to reduce size transmitted. But I think we should clarify",
        "created_at": "2019-09-01T13:12:45.737000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Right",
        "created_at": "2019-09-01T13:14:01.120000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think I added this... but at the time I didn't consider that a union type would require more bytes for non-null objects",
        "created_at": "2019-09-01T13:14:25.291000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The rationale for keeping a 1:1 mapping on this operation was to be able to do fast or parallel verification and usage of specific blocks that were returned. Otherwise, you have to sequentially walk through the list and hash verify each to know what blockroot it belongs to",
        "created_at": "2019-09-01T13:16:08.364000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yep makes sense. The only use I could find for this was to lookup parents. But if I see a block I don't know, I can only lookup it's parent, so I find myself only using a single hash for this request.",
        "created_at": "2019-09-01T13:17:35.082000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So is your preference for a null block, or a null ssz?",
        "created_at": "2019-09-01T13:18:52.857000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I wasnt thinking of the union type when we wrote it but thats exactly what this is for.. right?",
        "created_at": "2019-09-01T13:20:33.605000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah, sounds right to me.",
        "created_at": "2019-09-01T13:21:22.376000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The downside is adding a small amount of data for every non-null object returned",
        "created_at": "2019-09-01T13:21:58.543000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e I think I added this... but at the time I didn't consider that a union type would require more bytes for non-null objects\n\n4 bytes for the type index, right?",
        "created_at": "2019-09-01T13:22:44.183000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think so, yeah",
        "created_at": "2019-09-01T13:23:00.679000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hmm",
        "created_at": "2019-09-01T13:23:05.922000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e The only use I could find for this was to lookup parents. But if I see a block I don't know, I can only lookup it's parent, so I find myself only using a single hash for this request.\n\nA bit confused by whar you mean here",
        "created_at": "2019-09-01T13:25:32.465000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ah, i see",
        "created_at": "2019-09-01T13:27:19.980000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Actually don't worry, I was thinking in the context of a client starting up from scratch.",
        "created_at": "2019-09-01T13:27:25.927000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "`RecentBeaconBlocks` could be used for starting from Weak Subjectivity period... then for downloading blocks backwards to genesis from the current finalized state",
        "created_at": "2019-09-01T13:28:13.116000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "In that case we would know the hashes we want to download.... in the normal client running and syncing... if we know hash, we typically know the block. In the case we get a block from the network that we don't know of or its parent, we use `RecentBeaconBlocks` with a single hash lookup.",
        "created_at": "2019-09-01T13:29:19.151000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "My statement was that ignoring a client trying to sync backwards,  I didn't see a use case of asking for more than 1 hash",
        "created_at": "2019-09-01T13:30:55.346000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Right.. I feel like I'm forgetting an intended usecase here. The syncing backward with this method would require knowing all the block hashes and isnt intended\n\nI suppose if you saw 3 attestations on network with blocks you didnt know, you could batch but that seems unlikely",
        "created_at": "2019-09-01T13:35:59.991000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@449019668296892420\u003e you have the original rationale in your head?",
        "created_at": "2019-09-01T13:36:24.874000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeop, for syncing backwards can't we collect the hashes using the state's historitcal roots recursively to collect the block hashes, then we can use `RecentBeaconBlocks` to request them?",
        "created_at": "2019-09-01T13:38:28.532000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If you happen to have fully synced the state but dont have prev blocks and your peer will serve them to you via has, then yeah you are right. Wasnt the originally discussed intended use. \n\nNote that the direct hash lookup method via RecentBeaconBlocks is only MUST since latest finalzied whereas the sequential lookup via BeaconBlocks is MUST since weak subjectivity. This was to reduce the unordered db hit requirement for historic blocks",
        "created_at": "2019-09-01T13:45:20.376000+00:00",
        "attachments": null
    },
    {
        "author": "agemanning",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yep cool. Thanks.",
        "created_at": "2019-09-01T13:46:40.187000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So the only motivating factor for recentbeaconblocks being multiple is to have seen multiple hashes on the wire that you didnt know about and batch requesting to find them",
        "created_at": "2019-09-01T13:48:04.804000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Unless \u003c@449019668296892420\u003e can enlighten us",
        "created_at": "2019-09-01T13:48:16.856000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@291925846556540928\u003e original motivation was it was because the old requests gave the block body without header, so it would be hard to construct block root from response",
        "created_at": "2019-09-01T13:49:19.285000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "syncing more than one hash won't happen too often, agree..  essentially, we keep a table of all orphan block roots and have a request manager to try to fetch them from reasonable sources, so theoretically it could know of more than one and batch the request.. but as far as I'm concerned we could also change the request to be single-block - that allows for more simple error handling/reporting because you no longer have to aggregate errors",
        "created_at": "2019-09-01T13:52:45.288000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "when discussing it last, we were wavering back and forth between nil blocks or not, and kept nil for no particular reason except that the old, body-only request (that had a good reason) did it this way",
        "created_at": "2019-09-01T13:54:36.229000+00:00",
        "attachments": null
    }
]