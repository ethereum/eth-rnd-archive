[
    {
        "author": "mratsim",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://ethereum-magicians.org/t/eip-2537-bls12-precompile-discussion-thread/4187/76",
        "created_at": "2024-08-23T13:18:18.414000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Would be interesting to see how other libraries fare, I imagine not every client uses constantine",
        "created_at": "2024-08-23T14:44:37.809000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "None at the moment but Besu and Nimbus are integrating it.\n\nEIP-2537 aren't too bad.\nmax 15% perf difference between state-of-the art and slowest on non-MSM operations\nup to 70% perf difference between Constantine/Gnark and blst for MSM due to BLST not using batch affine additions.\n\nBN254 impls are really bad, AFAIK current Nimbus and Besu, and probably Nethermind are using a port of https://github.com/zcash-hackworks/bn/ to their language and this is at minimum 10x slower than kilic's or gnark go implementations.",
        "created_at": "2024-08-23T16:23:08.495000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yes",
        "created_at": "2024-08-23T16:23:58.375000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We use the fork as well, it's extremely slow, there's one library that's 2x faster, but ultimately it's hard to find bn bindings in rust that are fast _and_ not a nightmare build system wise",
        "created_at": "2024-08-23T16:25:40.919000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "When you say up to 70% perf different between constantine / gnark and blst, you mean that blst is slower right?",
        "created_at": "2024-08-23T16:26:29.307000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yes",
        "created_at": "2024-08-23T16:26:59.311000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "if you have Nim and Rust installed\n\n```\ngit clone https://github.com/mratsim/constantine\ncd constantine\ncargo test\n```",
        "created_at": "2024-08-23T16:27:55.988000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "see CI: https://github.com/mratsim/constantine/blob/master/.github/workflows/ci.yml#L325-L338",
        "created_at": "2024-08-23T16:28:01.193000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "and you just pass the input as byte buffer: https://github.com/mratsim/constantine/blob/master/constantine-rust/constantine-ethereum-evm-precompiles/src/lib.rs#L62-L111",
        "created_at": "2024-08-23T16:29:23.901000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Given the speed I may write a bench to see what it would take to integrate in revm",
        "created_at": "2024-08-23T16:29:38.079000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "another venue I was considering is to have an assembly code generator so that Cosntantine directly generates assembly file that can be used with nbindgen, and no nim is needed anymore.",
        "created_at": "2024-08-23T16:30:53.122000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "can you get portable binaries that way?",
        "created_at": "2024-08-23T16:31:36.012000+00:00",
        "attachments": null
    },
    {
        "author": "rjected",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that would be my only concern",
        "created_at": "2024-08-23T16:31:44.141000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I would generate binaries for x86, arm, risc-v, mips, nvidia, amd with a fallback to Nim.",
        "created_at": "2024-08-23T16:32:19.238000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "with the various relevant OS as well",
        "created_at": "2024-08-23T16:32:28.312000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ihave some of my experiemnts there for AMD, Nvidia GPU: https://github.com/mratsim/constantine/tree/master/constantine/math_compiler\n\nAnd reported perf issues to LLVM folks for x86 and ARM: https://github.com/mratsim/constantine/pull/456",
        "created_at": "2024-08-23T16:33:16.769000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "```\ngit clone https://github.com/mratsim/constantine\ncd constantine\nCC=clang nimble bench_eth_evm_precompiles\n```",
        "created_at": "2024-08-23T16:39:02.712000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You need Nim 1.6.x or Nim 2.0.2, 2.0.4 or latest 2.08 installed.",
        "created_at": "2024-08-23T16:39:36.262000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This will give you a table like this",
        "created_at": "2024-08-23T16:40:23.469000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "b867501a596e1e55b68ea3ab4ce31e939a31fcf03eb5cc25064c9e773b561856"
            }
        ]
    }
]