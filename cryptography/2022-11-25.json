[
    {
        "author": "frozenfire.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Still working through this, but I think that I'm leaning towards ECIES (https://en.wikipedia.org/wiki/Integrated_Encryption_Scheme) with XOR encryption.",
        "created_at": "2022-11-25T00:57:37.358000+00:00",
        "attachments": null
    },
    {
        "author": "frozenfire.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Since we just need to encrypt a single element, we should be able to just prove the relationship between a public key `A`, `bA`, and `bG`, and then prove `element XOR bA`, outputting `bG` and the XOR encrypted element.",
        "created_at": "2022-11-25T01:07:02.355000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Maybe I am being dense, but how can you compute `encrypt(pk, H(message))` without the private key?",
        "created_at": "2022-11-25T04:20:41.129000+00:00",
        "attachments": null
    },
    {
        "author": "frozenfire.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm not sure if there are other strategies for encrypting a message for a public key, but ECIES seems to be the most straightforward.",
        "created_at": "2022-11-25T20:16:46.827000+00:00",
        "attachments": null
    },
    {
        "author": "frozenfire.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It's a non-interactive diffie-hellman, some sort of KDF if the message is more than one element, and then whatever encryption method makes the most sense.",
        "created_at": "2022-11-25T20:17:52.055000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Does ECIES allow you to `verify_decryption(public_key, message)`?",
        "created_at": "2022-11-25T20:28:56.738000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It feels like that would be necessary in order for `encrypt(pk, H(message))` to not work for your use case.",
        "created_at": "2022-11-25T20:29:22.429000+00:00",
        "attachments": null
    },
    {
        "author": "frozenfire.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In my particular use-case, I don't need to verify decryption. Only prove encryption correctness.",
        "created_at": "2022-11-25T20:30:20.185000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah, I see.  It does because `encrypt(public_key, H(message)` is what is actually happening, not `encrypt(private_key, H(message))`.",
        "created_at": "2022-11-25T20:30:25.631000+00:00",
        "attachments": null
    },
    {
        "author": "frozenfire.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, should've been clear, `pk` is public key",
        "created_at": "2022-11-25T20:30:40.759000+00:00",
        "attachments": null
    },
    {
        "author": "frozenfire.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Apparently MACI already tackled the ECDH part: https://github.com/privacy-scaling-explorations/maci/blob/v1.1.0/circuits/circom/ecdh.circom",
        "created_at": "2022-11-25T20:31:17.202000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You cannot share a secret between the sender and recipient I assume?",
        "created_at": "2022-11-25T20:31:27.589000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This *feels* impossible, as the attacker has exactly the same set of information as the sender has.",
        "created_at": "2022-11-25T20:33:32.411000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The attacker knows the public key of the recipient, and they know all of the possible messages.  Similarly, the sender knows the public key of the recipient, and they know all of the possible messages.",
        "created_at": "2022-11-25T20:34:11.322000+00:00",
        "attachments": null
    },
    {
        "author": "frozenfire.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It's a sort of three-party identity commit-reveal. Alice knows N identity commitments in a merkle tree (Semaphore). Bob proves he knows the preimage to an identity in that tree, and encrypts the commitment he's using, using Joe's public key. Joe can decrypt Bob's identity commitment if needed, and go to Alice to find out who Bob is.",
        "created_at": "2022-11-25T20:34:32.744000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Unless \"all possible messages\" is too voluminous to brute force, it seems like the attacker can simply try every combination?",
        "created_at": "2022-11-25T20:34:36.436000+00:00",
        "attachments": null
    },
    {
        "author": "frozenfire.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Alice needs to not know which identity Bob is encrypting for Joe.",
        "created_at": "2022-11-25T20:35:42.980000+00:00",
        "attachments": null
    },
    {
        "author": "frozenfire.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But since Alice doesn't know Joe's private key, and ECIES takes a random input for the ECDH, Alice doesn't know what Bob's revealing to Joe until Joe tells Alice.",
        "created_at": "2022-11-25T20:36:32.112000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So you want Bob to create a proof of knowledge that only Joe can read, but such that Joe can forward that proof to Alice.",
        "created_at": "2022-11-25T20:37:19.566000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And the goal is to have that proof be as small as possible?  Or as fast to create as possible or as fast to verify as possible?",
        "created_at": "2022-11-25T20:37:49.965000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The naive solution is a simple ZK Proof of knowledge encrypted against Joe's public key.",
        "created_at": "2022-11-25T20:38:29.485000+00:00",
        "attachments": null
    },
    {
        "author": "frozenfire.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yup. That's what I'm doing.",
        "created_at": "2022-11-25T20:38:38.690000+00:00",
        "attachments": null
    },
    {
        "author": "frozenfire.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Bob constructs an identity and gives it to Alice, who includes it in a tree, which Bob then proves he knows a leaf of, and makes some claims about the identity's construction, plus encrypts his identity for Joe, who is able to reveal to Alice what Bob is using his identity for.",
        "created_at": "2022-11-25T20:39:39.445000+00:00",
        "attachments": null
    },
    {
        "author": "frozenfire.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Most of this is done in SNARKs",
        "created_at": "2022-11-25T20:40:04.817000+00:00",
        "attachments": null
    },
    {
        "author": "frozenfire.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "To complicate things a bit, Joe is actually The Council of Joes, who use threshold decryption to recover Bob's identity. ðŸ™‚",
        "created_at": "2022-11-25T20:41:51.122000+00:00",
        "attachments": null
    }
]