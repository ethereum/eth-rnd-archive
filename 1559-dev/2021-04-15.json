[
    {
        "author": "abdel.stark",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yes we need client specific config files. The one I provided is for Besu. I can also align with what Quilt did. As you prefer \u003c@!552133098075193354\u003e",
        "created_at": "2021-04-15T07:43:03.819000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Got it. \u003c@!543900561460822016\u003e should I add what you shared above as the geth genesis?",
        "created_at": "2021-04-15T13:57:56.520000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "if you just rename `eip1559Block` to `aleutBlock` that should be the only thing needed",
        "created_at": "2021-04-15T13:58:30.316000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Do you mean rename it directly in the `aleut.md` file as it is right now, and that this would work with both Besu and Geth?",
        "created_at": "2021-04-15T14:11:42.912000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "once \u003c@!574864862338088960\u003e updates it should",
        "created_at": "2021-04-15T14:13:48.852000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "i don't have a strong preference, i could also conform",
        "created_at": "2021-04-15T14:14:06.395000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "To be clear, is this what you meant ðŸ¤” ? https://github.com/ethereum/eth1.0-specs/pull/29",
        "created_at": "2021-04-15T14:15:10.698000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yes looks good to me",
        "created_at": "2021-04-15T14:19:03.891000+00:00",
        "attachments": null
    },
    {
        "author": "abdel.stark",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I will conform now worries",
        "created_at": "2021-04-15T14:35:58.174000+00:00",
        "attachments": null
    },
    {
        "author": "abdel.stark",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "https://github.com/hyperledger/besu/pull/2149",
        "created_at": "2021-04-15T15:31:27.064000+00:00",
        "attachments": null
    },
    {
        "author": "abdel.stark",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Done \u003c@!552133098075193354\u003e",
        "created_at": "2021-04-15T15:31:36.960000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yay!",
        "created_at": "2021-04-15T15:39:05.926000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I still need to add `\"petersburgBlock\": 0,` to get the genesis file from https://github.com/ethereum/eth1.0-specs/pull/29 to work in geth.",
        "created_at": "2021-04-15T17:11:08.155000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'll draft a PR, with that change I'm now synced using the quilt/eip1559 branch",
        "created_at": "2021-04-15T17:11:47.272000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "https://github.com/ethereum/eth1.0-specs/pull/30",
        "created_at": "2021-04-15T17:15:30.788000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Is it possible that this is because Besu calls it \"constantinopleFix\" and Geth \"petersberg\"?",
        "created_at": "2021-04-15T17:20:04.772000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ya that must be it, geth doesn't have a constantinopleFix block.  I'm not sure about other clients but geth seems to ignore fields it doesn't understand, hopefully besu and others behave the same way and we can just make the genesis a superset of the required fields?",
        "created_at": "2021-04-15T17:36:28.811000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "has there been any discussion on the names of the new fields in the JSONRPC responses (e.g. in eth_getTransactionByHash).  Now that I'm synced I'm trying to test end-to-end JSONRPC response -\u003e RLP -\u003e Hash for EIP-1559 txs but that obviously fails since the new fields aren't exposed via JSONRPC yet.  I figured I can start on adding them as a PR to the quilt branch but not sure if the names have been settled on.  For now my code is using `maxInclusionFee` and `maxFee` but I know I've seen baseFee and Tip used in places before too.",
        "created_at": "2021-04-15T17:39:55.546000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Somewhat related, but I really wish we'd thought to add EIP-2718 style types to blocks too, casing on whether the header has 15 or 16 fields to know if BaseFee is there feels dirty..",
        "created_at": "2021-04-15T17:44:59.827000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "interesting, i expected it to fallback to being the same as constantinople https://github.com/ethereum/go-ethereum/blob/1e207342b545fb5992e2e8f38e60f219f379e5e0/params/config.go#L324",
        "created_at": "2021-04-15T17:47:55.114000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!388751025789468672\u003e btw i added the `--aleut` flag",
        "created_at": "2021-04-15T17:49:34.810000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ya it's this function that seems to have the bug https://github.com/ethereum/go-ethereum/blob/1e207342b545fb5992e2e8f38e60f219f379e5e0/params/config.go#L468 fix would probably be to set `c.PetersburgBlock` to `c.ConstantinopleBlock` if it's nil somewhere.",
        "created_at": "2021-04-15T18:25:21.618000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I see, `feeCap` and `tip` were added to transaction_marshalling.go but the JSONRPC layer actually uses RPCTransaction (in internal/ethapi/api.go), I'll take a stab at updating RPCTransaction for EIP-1559.",
        "created_at": "2021-04-15T18:45:39.289000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "https://github.com/quilt/go-ethereum/pull/47 \u003c-- with that I'm able to go from JSONRPC -\u003e RLP -\u003e hash on all the blocks and txs currently on Aleut using my own in-progress EIP-1559 parser.",
        "created_at": "2021-04-15T19:00:01.254000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "sorry didn't realize i hadn't quite published this yet",
        "created_at": "2021-04-15T20:09:03.564000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm also taking a stab at adding `effectiveGasPrice` to `eth_getTransactionReceipt` and started to compute it based on block.baseFee and maxFee/tip, but realized this logic probably already exists somewhere since it needs to be calculated for applying the txs.\n\nBut looking then I see that `DynamicFeeTransaction.gasPrice()` returns `tx.Tip`, but according to the pseudo-code in the EIP shouldn't that really return something more like `inclusion_fee_per_gas = min(transaction.max_inclusion_fee_per_gas, transaction.max_fee_per_gas - block.base_fee_per_gas)`?",
        "created_at": "2021-04-15T21:07:39.593000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ah I see, that logic is in `StateTransition`",
        "created_at": "2021-04-15T21:11:24.333000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I wonder if instead of adding fee and tip to `Message` we could  make `Transaction.AsMessage` do the computation?  That would require passing in the block's baseFee to AsMessage though, perhaps that's too big of a change?",
        "created_at": "2021-04-15T21:26:35.902000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That said, everywhere `AsMessage` is called has access to either the block or the baseFee via `EVMBlockContext`",
        "created_at": "2021-04-15T21:30:44.650000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "(Also if this is a distraction to this channel happy to take this dicussion elsewhere)",
        "created_at": "2021-04-15T21:31:39.329000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah, the consensus calculation of gas is done in `StateTransition`. I'm not super happy with the interface having `GasPrice` even for 1559 txs, but would increase the complexity in the txpool to constantly switch on the type.",
        "created_at": "2021-04-15T21:36:08.690000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "i think having the computation in the `StateTransition` make it more \"findable\"",
        "created_at": "2021-04-15T21:38:38.287000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ya looking at it more I agree, I missed that `StateTransition` already had a fair amount of per-fork complexity in `IntrinsicGas`.  Anyways it was pretty straight-forward to replicate the gas-price logic in `GetTransactionReceipt`.",
        "created_at": "2021-04-15T21:52:25.668000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Maybe `DynamicFeeTransaction.gasPrice()` should return some sentinel value instead of the Tip to make it more obvious it shouldn't be used?",
        "created_at": "2021-04-15T21:54:20.996000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yeah maybe it just returns 0 - my thinking with tip is at least it still serves as a \"priority\" signal e.g. larger tip means more priority like bigger gasPrice means more priority",
        "created_at": "2021-04-15T21:55:34.972000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but don't have a strong preference",
        "created_at": "2021-04-15T21:55:40.007000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "At a more meta level, now I'm questioning if `effectiveGasPrice` should even be part of the `eth_getTransactionReceipt` response since it's no longer a consensus field of the receipt, arguably it could go in `RPCTransaction` (for mined txs) or even be left out altogether.",
        "created_at": "2021-04-15T22:00:15.351000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Which, sigh, is what you said here: https://github.com/ethereum/EIPs/pull/3463#issuecomment-812895257. I misread that as still adding it to `eth_getTransactionReceipt`.",
        "created_at": "2021-04-15T22:02:12.242000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "i really don't have a good feel if it is important to include `eth_getTransactionReceipt` - it feels like something to include in the `eth_getTransaction*`",
        "created_at": "2021-04-15T22:05:02.146000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but like i said in the PR, i'm happy with what the consumers of the RPC prefer",
        "created_at": "2021-04-15T22:05:19.597000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ya I agree it makes sense in `getTransaction`.  Not sure if it makes sense to change the name to `effectiveGasPrice` or keep it `gasPrice`, I can see arguments either way.",
        "created_at": "2021-04-15T22:19:01.165000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I updated my PR to set `gasPrice` to the effective gas price on EIP-1559s, and to add the `baseFee` to block responses.  tangentially related but it'd be really nice if `eth_getBlockByNumber(\"pending\", true)` returned the presumptive `baseFee`, currently it doesn't.",
        "created_at": "2021-04-15T22:42:37.622000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@574864862338088960\u003e would that work with Besu? Worst case Iâ€™ll just put client-specific ones in the spec",
        "created_at": "2021-04-15T22:42:49.841000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If anyone has a little Aleut ETH to spare for `0xdf0a88b2b68c673713a8ec826003676f272e3573` I'd like to try getting some txs in my pending pool to see if the JSONRPC behaves reasonably for them.",
        "created_at": "2021-04-15T23:01:01.068000+00:00",
        "attachments": null
    }
]