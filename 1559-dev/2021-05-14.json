[
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the current tx format is accepted into a 1559 chain. can you get the same behavior in a 1559 formatted tx? would you set the params like this?\nmax: gasPrice\npriority: \u003cvery high number\u003e",
        "created_at": "2021-05-14T01:44:10.433000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "```ts\nmaxFeePerGas: gasPrice\nmaxPriorityFeePerGas: gasPrice\n```",
        "created_at": "2021-05-14T01:52:51.565000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "is there a simulation of 1559 available to hack around on?",
        "created_at": "2021-05-14T02:04:00.938000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "https://github.com/ethereum/abm1559 ?",
        "created_at": "2021-05-14T02:07:30.334000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "https://github.com/ethereum/rig/blob/9de2ecbba130fba13011eca2b229979b0adcba52/eip1559/eip1559.ipynb ?",
        "created_at": "2021-05-14T02:08:18.599000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "curious if these are up to date with the latest eip1559 proposal",
        "created_at": "2021-05-14T02:08:26.503000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "what are the requirements when replacing an existing tx in the mempool with the same nonce",
        "created_at": "2021-05-14T02:23:39.128000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "i suppose this could technically vary by client as its not part of the consensus rules",
        "created_at": "2021-05-14T02:24:16.742000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!188137169905254401\u003e the way i've implemented is if either the `feeCap` or `tip` are bumped more than the min bump amount (i think default is 10%) then it is considered \"better\" and bumps out the other tx",
        "created_at": "2021-05-14T02:28:23.891000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "what if one parameter is lower and one is higher",
        "created_at": "2021-05-14T02:28:54.889000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "hey \u003c@!188137169905254401\u003e the simulations are designed to be extensible and model any gas market more generally, but if there is a specific item you want to simulate wrt eip1559 i am happy to help",
        "created_at": "2021-05-14T02:30:58.986000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "you can also check http://ethereum.github.io/abm1559 for a more human readable version of the notebooks",
        "created_at": "2021-05-14T02:31:20.215000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!486501030046203915\u003e thanks/ we're iterating on metamask's simple tx fee parameter selection design and its proving to be a challenge to actually make it simple and understandable",
        "created_at": "2021-05-14T02:33:56.378000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "so i want to have a better idea of how the eip1559 market will behave, especially with certain parameter selection strategies",
        "created_at": "2021-05-14T02:35:11.354000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "at some point we had discussed this and iirc this rule could be abused by e.g. a low fee cap transaction bumping their tip infinitely often, unless you make a hard constraint that tip must always be smaller or equal to fee cap",
        "created_at": "2021-05-14T02:35:41.917000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "i had a wallet simulation in the works that I kind of set aside, where users go through a wallet to set their tips etc. if helpful i can make a working version that you can use as a starting point? or if there is any spec you have in mind I can also help you get started",
        "created_at": "2021-05-14T02:37:14.960000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yeah i'm currently rejecting txs whose tips are greater than feeCap",
        "created_at": "2021-05-14T02:37:59.758000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "although, one issue is still that they could keep bumping their feeCap over and over at no cost to the network - it's sort of tricky IMO because if for some reason you don't get a transaction in before your feeCap becomes too low to be included, you'd *want* to just bump your feeCap to be included",
        "created_at": "2021-05-14T02:39:46.780000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "if either parameter is lower it should be rejected",
        "created_at": "2021-05-14T02:40:34.815000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!486501030046203915\u003e that would be really cool to see",
        "created_at": "2021-05-14T02:40:41.435000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!543900561460822016\u003e is that in the spec or is that a reccomendation",
        "created_at": "2021-05-14T02:40:56.348000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!188137169905254401\u003e it's just how i've implemented it",
        "created_at": "2021-05-14T02:41:31.135000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Perhaps only replace the transaction if priorityFee is higher **and** the fee cap is above the latest block base fee?",
        "created_at": "2021-05-14T02:41:31.404000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the issue is that you could keep bumping the fee cap infinitely at no cost --- oh you mean also bumping the tip?",
        "created_at": "2021-05-14T02:41:58.709000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!543900561460822016\u003e this sort of thing is difficult for wallets because we try to be able to connect to any node but we dont know what their tx replacement requirements are",
        "created_at": "2021-05-14T02:42:18.440000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "You are thinking of an attack vector where someone is just trying to spam the gossip network?",
        "created_at": "2021-05-14T02:42:35.538000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "understandable, we should definitely try to be reasonable uniform in our handling",
        "created_at": "2021-05-14T02:42:52.098000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yes",
        "created_at": "2021-05-14T02:43:02.392000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "will work on a minimal prototype then and let you know ðŸ™‚",
        "created_at": "2021-05-14T02:43:10.291000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Don't need to be uniform, but you do need to have strategies well defined and published.",
        "created_at": "2021-05-14T02:43:11.092000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "well, if geth implements tx bumping one way and nethermind does it another way - depending on which nodes first see your tx you may not propagate anywhere",
        "created_at": "2021-05-14T02:44:07.095000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "MetaMask would adopt a strategy that suits both in that case.",
        "created_at": "2021-05-14T02:44:34.166000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Essentially, wallets would likely choose a lowest-common-denominator strategy.",
        "created_at": "2021-05-14T02:44:51.562000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Which you want anyway so your transaction can gossip.",
        "created_at": "2021-05-14T02:45:14.227000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think to protect against spam vectors you *must* require bumping both.",
        "created_at": "2021-05-14T02:46:30.854000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!301186049323958275\u003e in practice what would likely happen is metamask just does what geth does bc we primarily talk to geth and then users are pointing to other clients are mad that its not compatible but we have trouble prioritizing the fix for a small number of users",
        "created_at": "2021-05-14T02:46:31.825000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "which is the reason the replacement requirement should be formalized",
        "created_at": "2021-05-14T02:47:10.816000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Never included:\n```\nmaxFee: 1000000000000\npriorityFee: 0\n```\nAlso never included:\n```\nmaxFee: 0\npriorityFee: 100000000000\n```",
        "created_at": "2021-05-14T02:47:35.574000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think what you are actually arguing here is that everyone must conform to what Geth does, because wallets will only support what Geth does.",
        "created_at": "2021-05-14T02:48:06.960000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "A sad but common situation in Ethereum.",
        "created_at": "2021-05-14T02:48:16.656000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Unless we have a mechanism for validating that either the maxFee or the maxPriorityFee is \"reasonable\", we need to assume that one of the two is totally unreasonable (will prevent inclusion) and thus not allow replacement unless they bump both.",
        "created_at": "2021-05-14T02:49:04.960000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "minority clients will have the same pressures, in order to serve their users. if things are valid for them but not for geth, the tx may not propagate to a miner",
        "created_at": "2021-05-14T02:50:51.131000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "as far as i understand it",
        "created_at": "2021-05-14T02:51:33.513000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!486501030046203915\u003e likely ill be digging into the simulations tonight or tomorrow -- let me know if you have any suggestions for how to get started",
        "created_at": "2021-05-14T02:52:31.693000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah, I just wish the ecosystem wasn't so willing to bend a knee to Geth.",
        "created_at": "2021-05-14T02:52:55.760000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Not because I dislike Geth, but because that policy discourages experimentation.",
        "created_at": "2021-05-14T02:53:27.178000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I understand that it is often done by necessity (like here).  It just bugs me.",
        "created_at": "2021-05-14T02:53:40.644000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "can anyone explain the \"next block inclusion guarantee\" people seem to associate with 1559?",
        "created_at": "2021-05-14T03:07:58.075000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "whenever the effective demand (willing to pay at least basefee + the minimum miner fee) is smaller than the block limit (30 million gas), then you are guaranteed to be included in the next block. since basefee adjusts to target effective demand = 15 million gas, it provides stronger guarantees that should you be willing to pay the basefee, you'll be included in the next block, unless a rapid demand shift ups the effective demand past 30 million gas. see also https://barnabe.substack.com/p/better-bidding-with-eip1559",
        "created_at": "2021-05-14T03:16:16.383000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ok! i'll work on the prototype today (it's friday for me already ðŸ™‚ ) but a good place to get started is the first \"interesting\" notebook https://ethereum.github.io/abm1559/notebooks/stationary1559.html\n\nthe notebooks typically follow the same format always: you define user behaviours, transaction pool behaviour and simulate to see what happens. the library has a few \"default\" behaviours for both, and to build more complex simulations I usually subclass the default behaviours to suit what I want to explore with it",
        "created_at": "2021-05-14T03:18:23.139000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ok so equivalent to the \"next block inclusion guarantee\" of the current gas market in the sense of you get next block inclusion if you pay enough",
        "created_at": "2021-05-14T03:19:13.650000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but \"paying enough\" is more clearly defined?",
        "created_at": "2021-05-14T03:21:45.275000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ill read up",
        "created_at": "2021-05-14T03:21:54.379000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "exactly, the market price is arrived at objectively (via the basefee update rule and double sized blocks) rather than subjectively (via past and current demand), and on top of that the market price is a reserve price: you have to pay at least that to be included, no getting around it, which makes it binding",
        "created_at": "2021-05-14T03:24:01.454000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Most importantly here is that you do not *overpay*.  Right now if you set `gasPrice` to 1000 nanoeth because that is what you are *willing* to pay, then you will pay 1000 nanoeth per gas.  With 1559 if you set `maxFeePerGas` to 1000 nanoeth, then you will pay the block's `baseFee` plus `maxPriorityFeePerGas`, which is probably a *much* smaller number (e.g., 21 nanoeth).",
        "created_at": "2021-05-14T04:36:36.500000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e  `maxPriorityFeePerGas`, which is probably a much smaller number \n\u003c@!301186049323958275\u003e  what makes you believe that this number will be small",
        "created_at": "2021-05-14T04:45:13.780000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "current block utilization (~98%)",
        "created_at": "2021-05-14T04:47:09.233000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "ddecd6e97f206a1601d4e5fd4b7a336d496deb06f832510a9f05b169e7c99377"
            }
        ]
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "what do we expect this graph to look like in 1559 world",
        "created_at": "2021-05-14T04:47:40.460000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "(im sure this is covered in one of the dozen notebooks i was linked, just putting the question here for now)",
        "created_at": "2021-05-14T04:48:03.535000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "we'd expect this graph to on average have block utilisation equal to 50% (the target size of the block)",
        "created_at": "2021-05-14T04:50:46.348000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "and users would only need to adjust upwards their `maxPriorityFeePerGas` whenever the congestion increases rapidly",
        "created_at": "2021-05-14T04:51:18.848000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "and largely be flat? or spikey?",
        "created_at": "2021-05-14T04:51:22.280000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "probably noisy around 50%, with short periods where it is consistently 100% (ie, these periods where demand increases significantly)",
        "created_at": "2021-05-14T04:51:57.513000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "note that you can have very high demand and yet block utilisation at 50%. what matters for the block utilisation number is the _rate of change_ of the demand",
        "created_at": "2021-05-14T04:52:22.855000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "what might happen if for some reason, it was 100% for a long time",
        "created_at": "2021-05-14T04:53:08.928000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "it cannot be (or define long time)",
        "created_at": "2021-05-14T04:53:21.458000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "if it is 100% for 6 blocks the base fee doubles",
        "created_at": "2021-05-14T04:53:30.618000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "which means that the minimum price can double in a minute",
        "created_at": "2021-05-14T04:53:44.320000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "current gasPrice spikes dont seem to affect block utilization",
        "created_at": "2021-05-14T04:54:08.963000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "because there is no binding minimum gas price",
        "created_at": "2021-05-14T04:54:29.609000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "miners can just include anything",
        "created_at": "2021-05-14T04:54:34.849000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yeah i dont have a good graph for block gasPrice breakdown",
        "created_at": "2021-05-14T04:55:02.880000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but that makes sense",
        "created_at": "2021-05-14T04:55:33.322000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "btw a block 50% full under eip1559 = a block 100% full right now",
        "created_at": "2021-05-14T04:55:35.777000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "right",
        "created_at": "2021-05-14T04:55:41.344000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "in gas terms",
        "created_at": "2021-05-14T04:55:41.591000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "if there are more people willing to pay the base fee than the 50% target, basefee will increase for the next block, so naturally you will have less people inclined to pay the next time around",
        "created_at": "2021-05-14T04:56:17.430000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "do we expect 100% block utilization periods to have an increased uncle rate?",
        "created_at": "2021-05-14T04:56:35.942000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "over time, assuming demand is stable, it will stabilise to target the 15M gas quantile of the demand",
        "created_at": "2021-05-14T04:56:37.802000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "no it was quite heavily tested and given that basefee increases quite fast, we don't expect long bursts of 30M gas blocks",
        "created_at": "2021-05-14T04:57:03.005000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "short bursts were totally ok iirc",
        "created_at": "2021-05-14T04:57:16.483000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "is eip1559 live on a testnet? plans to be?",
        "created_at": "2021-05-14T05:00:40.723000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yes! there is a testnet, it was discussed earlier (look for \"baikal\" or \"aleut\" in this thread)",
        "created_at": "2021-05-14T05:01:14.637000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The opportunity cost of miners to include a transaction is around 1 nanoeth per gas (a bit less IIRC).  In a world of spherical cows, it would be irrational for miners to set a minimum priorityFee higher than that, because they are leaving money on the table for the next miner to take.",
        "created_at": "2021-05-14T05:06:29.877000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Of course, miners may be irrational, malicious, vengeful, etc. so we can't say for sure what they'll include.  However, any miner that behaves rationally will make more money than those who do not, so there is financial incentive to be rational.",
        "created_at": "2021-05-14T05:07:00.157000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The only time you need to increase this number above the miner minimum is if you want a specific position in a block (e.g., first in block) or there is a sudden 2x spike in demand and you have a very strong time preference.",
        "created_at": "2021-05-14T05:07:50.185000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "does priorityFee actually determine position in block?",
        "created_at": "2021-05-14T05:14:49.430000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "does a block need to sort txs by some parameter in order to be valid?",
        "created_at": "2021-05-14T05:15:44.567000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It does, because the alternative is worse (shotgun for position).",
        "created_at": "2021-05-14T05:16:06.011000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "No, it is not a consensus rule.",
        "created_at": "2021-05-14T05:16:17.974000+00:00",
        "attachments": null
    },
    {
        "author": "kumavis",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e The opportunity cost of miners to include a transaction is around 1 nanoeth per gas\n\u003c@!301186049323958275\u003e  how was this derived?",
        "created_at": "2021-05-14T05:20:29.770000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Vitalik has a blog post about it *somewhere*.  Might be linked in the 1559 resources hackmd.",
        "created_at": "2021-05-14T05:20:50.047000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It is a function of block reward and uncle risk.",
        "created_at": "2021-05-14T05:21:05.114000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And uncle risk is a function of block size and block processing time.",
        "created_at": "2021-05-14T05:21:16.974000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And gas used is a proxy for block size and block processing time.",
        "created_at": "2021-05-14T05:21:25.977000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "",
        "created_at": "2021-05-14T06:16:28.732000+00:00",
        "attachments": [
            {
                "type": "image/jpeg",
                "origin_name": "image0.png",
                "content": "605a42b4b00ab289b23d4d415466ef17482f6448f5ef859e7010bdd1afbf9930"
            }
        ]
    },
    {
        "author": "barnabemonnot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This is the link: https://www.reddit.com/r/ethereum/comments/lk1rjp/this_is_why_eip_1559_is_good_and_why_vitalik/",
        "created_at": "2021-05-14T06:17:21.450000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "A block utilization of 98% might also be caused by miners filling available space with mining gasTokens. So if we get rid of that, which, incidentally will happen in the same hf as 1559, that should also make an impact",
        "created_at": "2021-05-14T09:25:21.898000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I might be missing something but what about this principle: If new transaction wants to replace the old one it needs to conform to the:\n```assert(new.effective_gas_price(current_block_base_fee) - old.effective_gas_price(current_block_base_fee) \u003e desired_gas_bump)\n```\nwhere \n```effective_gas_price = min(maxFeePerGas, maxPriorityFeePerGas + current_block_base_fee) // for 1559 txs\neffective_gas_price  = gas_price // for legacy txs\n```",
        "created_at": "2021-05-14T09:33:21.293000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And this is how would metamask speed up the tx:\n```while new.effective_gas_price(current_block_base_fee) - old.effective_gas_price(current_block_base_fee) \u003c desired_gas_bump {\n  if maxFeePerGas \u003c maxPriorityFeePerGas + current_block_base_fee {\n    //increase maxFeePerGas by 1 gwei\n  } else {\n    //increase maxPriorityFeePerGas by 1 gwei\n  }\n}\n```",
        "created_at": "2021-05-14T09:54:39.150000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@439883507406340126\u003e this is the most correct way, but it requires the effective price to be recalculated each block for each tx. Since geth stores txs in a min heap, weâ€™d have to recalculate the min heap each block to get the lowest paying txs. \n\nSince fee cap is constant, you donâ€™t need to resort all of them, only the dirty accounts need to be updated",
        "created_at": "2021-05-14T14:00:13.746000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Is it not acceptable for you to do resorting on each block? is because of the performance? did you try to benchmark it?",
        "created_at": "2021-05-14T14:09:09.265000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I don't know whether or not it is acceptable, but it would be good to compare. Generally, I try to avoid doing anything that could be considered a degradation. Have you done any analysis on this?",
        "created_at": "2021-05-14T14:11:25.416000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "No, i was hoping you did ðŸ˜†",
        "created_at": "2021-05-14T14:12:29.872000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "haha let me see if i can do some analysis over the weekend",
        "created_at": "2021-05-14T14:15:02.779000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "well, if tx pool behaviour is not right, then either 1) transactions will be over-evicted and this will annoy the users 2) transactions will be under-evicted, which will lead to the ballooning of tx pool overhead for the nodes. So while it is not consensus critical, it is important to get his right before go-live",
        "created_at": "2021-05-14T14:49:03.782000+00:00",
        "attachments": null
    },
    {
        "author": "zsfelfoldi",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I highly doubt that recalculating and re-queueing each transaction in each block would even be a noticeable performance hit. Btw what do you think about my dual-queue ordering approach? I'm thinking about implementing it on top of your tx pool branch, it's not that hard to do and it would also allow us to test the cost of tx reordering.",
        "created_at": "2021-05-14T17:58:35.629000+00:00",
        "attachments": null
    },
    {
        "author": "zsfelfoldi",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "https://gist.github.com/zsfelfoldi/9607ad248707a925b701f49787904fd6",
        "created_at": "2021-05-14T17:59:56.564000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!202397237962211328\u003e hey sorry, it's been on my todo list to respond to your post - let me do that now",
        "created_at": "2021-05-14T18:08:52.368000+00:00",
        "attachments": null
    },
    {
        "author": "zsfelfoldi",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "thanks",
        "created_at": "2021-05-14T18:34:37.219000+00:00",
        "attachments": null
    },
    {
        "author": "zsfelfoldi",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Another though about the price bump: the first version I saw was a replacement condition that required both parameters to be bumped by a minimum percentage. Though I initially disliked this version now I think that maybe it's the best we can do. The purpose of this condition is to avoid spamming the tx propagation bandwidth with irrelevantly small price bumps. You should only update if you are willing to pay some non-negligible extra price. Now it's hard to see which parameter is relevant and if we only require one of them to be bumped then it's still possible to spam the network with a lot of updates, without really paying a price for it because the sender always updates the irrelevant parameter. OTOH requiring both to be updated is not so bad because that is going to mean that you'll pay a bit more regardless of which parameter is going to be the relevant one (and this is really the valid reason to update).",
        "created_at": "2021-05-14T18:43:05.960000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah this is how \u003c@!415548822983278593\u003e initially expected the bumping to work and I thought maybe we didn't need to require both to be updated, but after the discussion yesterday I updated the PR to enforce both to be bumped. *Maybe* we could allow only the tip to be bumped since there is only a small number of tip bumps that could be allowed before either the tip \u003e= feeCap and after each bump, the sender is actually paying more. The issue is with bumping only the fee cap, there is really no cost to spamming fee cap bumps if the base fee is relatively steady",
        "created_at": "2021-05-14T18:48:08.153000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!202397237962211328\u003e your dual-queue ordering seems reasonable. I've been bothered that with the fee cap only approach, because it's *possible* to flood the network with high fee cap, low tip txs and beat out lower fee cap, high tip txs. Although, I'm running the number on the default tx pool size and it seems with 1024 128kb txs (suppose all 0 calldata) it would only cost ~0.5 eth to clear a default nodes tx pool? Seems like I may be making a miscalculation somewhere. But even a factor of 0 greater than that is a bit concerning. I'm not sure what the effects of such an attack would be though, since I believe miners configure their tx pools to store more txs than the default?",
        "created_at": "2021-05-14T18:54:32.144000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I personally now believe for replacement (same sender \u0026 same nonce, not eviction!) it is indeed sufficient to enforce a min percentage priority fee bump, together with outright rejecting txs with higher priority fee than fee cap and txs below a minimum tip (likely 1 gwei)",
        "created_at": "2021-05-14T19:07:06.464000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "sufficient = basically equivalent to the current pre-1559 rule",
        "created_at": "2021-05-14T19:07:25.990000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but I think the more practical choice would be to enforce a bump in both, and then after a few months of real world 1559 experience reassess",
        "created_at": "2021-05-14T19:09:11.121000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "hm wait, a pure priority fee bump is not actually equivalent for the current situation. if we evict by fee cap, but replace by priority fee, then you can cause quite a bit initial replacement effort basically for free",
        "created_at": "2021-05-14T19:11:13.591000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "okay, so all the more reason to go with a dual bump.",
        "created_at": "2021-05-14T19:11:51.191000+00:00",
        "attachments": null
    },
    {
        "author": "zsfelfoldi",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "what I was worried about is that it can not only happen because of an attack but also because of rational behavior in a usage peak. Also, just miners having large pools won't make things better, actually it can make things worse because the priority fee bids won't propagate to small miners and that can incentivize priority fee bidders to try to communicate with the largest mining pools directly.\nI'll try to implement my version during the weekend just to see how complex it is. If it turns out to be not very complicated then we can consider making it a recommendation.",
        "created_at": "2021-05-14T19:12:45.374000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "hm, so for eviction I agree that in the case of \"all of the mempool is currently includable\" pure fee cap ordering is subobtimal.",
        "created_at": "2021-05-14T19:20:03.237000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "as a quick aside though: important to note that users that want to make it into one of the next blocks no matter the cost could always set a high tip and a maxint fee cap",
        "created_at": "2021-05-14T19:20:58.333000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "if we still wanted to find an alternative sorting metric for these (normally very rare) situations though, I don't think it is obvious which one that should be. Like, even in normal conditions fee cap eviction is not strictly speaking optimal behavior, it is just the closest-to-optimal simple solution.",
        "created_at": "2021-05-14T19:24:43.169000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the two obvious candidates would be sorting by (nominal) priority fee, or sorting by effective priority fee (the one proposed by \u003c@!202397237962211328\u003e).",
        "created_at": "2021-05-14T19:26:22.046000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the two obvious candidates are sorting by (nominal) priority fee, or sorting by effective priority fee at current base fee level (as e.g. proposed by \u003c@!202397237962211328\u003e).",
        "created_at": "2021-05-14T19:27:36.366000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "sorting by nominal priority fee would be nice because static (constant tx order), but doesn't seem to be good enough.",
        "created_at": "2021-05-14T19:30:34.051000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "leaving sorting by effective priority fee.\nI looked into something very similar a while ago for mining, where you want to (partially) sort by effective priority fee as well, but from the top.\nIt can be done more efficiently than fully re-calculating effective fee \u0026 re-building a heap every block. I'll quickly look into the solution I had back then. But the question then remains if that extra overhead is feasible, and if it is worth the effort. given that the mempool would only have to turn it on in these rare situations though, the answer at least to that second question might well be yes though.",
        "created_at": "2021-05-14T19:36:14.766000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "sketch for how I think you would do effective priority fee sorting:\ndistinguish between txs in dynamic / static priority fee range: dynamic if `baseFee + priorityFee \u003e feeCap` (i.e. effective priority fee below nominal), static otherwise.\ntwo main (partially sorted) heaps:\n- txs in dynamic range by fee cap (which is equivalent to sorting by effective priority fee)\n- txs in static range by priority fee\nand then two more auxiliary heaps for efficient updates each time the base fee changes:\n- txs in dynamic range by transition base fee (`feeCap - priorityFee`), max on top\n- txs in static range by transition base fee, min on top",
        "created_at": "2021-05-14T19:47:55.470000+00:00",
        "attachments": null
    },
    {
        "author": "zsfelfoldi",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\"always set a high tip and a maxint fee cap\" that is not necessary a rational move (I wrote about the reason in my gist). I expect some users to set a high tip and fee cap = tip + current baseFee.",
        "created_at": "2021-05-14T19:48:41.789000+00:00",
        "attachments": null
    },
    {
        "author": "zsfelfoldi",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\"sorting by effective priority fee at current base fee level (as e.g. proposed by \u003c@!202397237962211328\u003e)\" this is not exactly what I proposed. My proposal is to sort at most half of the pool by effective priority fee, then sort the rest by feeCap.",
        "created_at": "2021-05-14T19:50:21.584000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ah, missed that part",
        "created_at": "2021-05-14T19:50:55.680000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "interesting compromise",
        "created_at": "2021-05-14T19:51:00.272000+00:00",
        "attachments": null
    },
    {
        "author": "zsfelfoldi",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think there are basically two kind of distinct possible rational strategies and this can be safe for any mix of them.",
        "created_at": "2021-05-14T19:51:48.629000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think the overhead of sorting by effective priority fee is mostly constant though, so I think ideally you want to not do it at all unless you have to, at which point you might as well do it for all txs",
        "created_at": "2021-05-14T19:51:54.956000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ah wait, so you are saying even in the case of all txs above base fee you explicitly prefer the 50/50 approach?",
        "created_at": "2021-05-14T19:52:38.880000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "would have to think that through, could be that that would be preferrable",
        "created_at": "2021-05-14T19:52:54.520000+00:00",
        "attachments": null
    },
    {
        "author": "zsfelfoldi",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "In that case it's basically the same behavior",
        "created_at": "2021-05-14T19:53:04.737000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "well, then I don't see the case for 50/50",
        "created_at": "2021-05-14T19:53:28.239000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "because if not all are immediately includable, you would never evict one with effective priority fee \u003e 0",
        "created_at": "2021-05-14T19:53:50.557000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "and given the sorting by effective fee is so much more expensive, I would rather have it fully turned off in these cases",
        "created_at": "2021-05-14T19:54:34.929000+00:00",
        "attachments": null
    },
    {
        "author": "zsfelfoldi",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "wait, maybe it's not true what I just wrote ðŸ™‚ let me think it through",
        "created_at": "2021-05-14T19:54:37.473000+00:00",
        "attachments": null
    },
    {
        "author": "ansgar.eth",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "sent you a dm, in case you are interested in having a call to talk about this ðŸ™‚",
        "created_at": "2021-05-14T19:56:58.628000+00:00",
        "attachments": null
    }
]