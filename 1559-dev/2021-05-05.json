[
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Please send me any aleut nethermind and/or OE nodes (enode id) cc \u003c@!429719902363058177\u003e \u003c@!489256758989029405\u003e",
        "created_at": "2021-05-05T08:04:43.393000+00:00",
        "attachments": null
    },
    {
        "author": "draganrakita",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "cc \u003c@!439883507406340126\u003e",
        "created_at": "2021-05-05T08:09:15.228000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "OE will have node up and running until the end of week, will notify you when its ready.",
        "created_at": "2021-05-05T08:15:24.003000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!211091239112671234\u003e Nethermind enode://aec88fd902744bf67705c098bf532b01017ccc3a156395508e2d9c4e7c22699ecccae1e7316614f8a2d4c5698a9be3fe6151ee25b9ed4aa052f88e112c65387a@164.90.171.157:31559",
        "created_at": "2021-05-05T08:55:26.278000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Did it crash? It disconnected after I sent a malicious block",
        "created_at": "2021-05-05T09:03:23.136000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hmmm it looks like it is working fine: http://eip1559-testnet.ops.pegasys.tech:3001/",
        "created_at": "2021-05-05T09:06:10.662000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "(seemed to be up for reconnect immediately after though, so probably no crash)",
        "created_at": "2021-05-05T09:06:12.614000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yes, it's working fine ðŸ™‚",
        "created_at": "2021-05-05T09:06:35.464000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Found another pretty serious issue, which unfortunately cannot be tested on aleut. If a block/header _with_ basefee is mined before 1559, then it would be accepted in the geth implementation: https://github.com/ethereum/go-ethereum/pull/22617/files#r626407395 . Other clients need to check this. \u003c@!393119312350543872\u003e \u003c@!439556036647714817\u003e we should add a test for this. With 1559 at block 5, have block `4` include a basefee, ensure that block `4` is rejected.",
        "created_at": "2021-05-05T09:24:03.399000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I _think_ nethermind suffers from the same flaw: https://github.com/NethermindEth/nethermind/pull/3023/files#diff-3f69ed0eab850713c4d45a0d9f32e305d7a21716c4996f029d9296de38a928adR140",
        "created_at": "2021-05-05T09:34:18.282000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If 1559 is enabled, it does a few additional checks. But it does not verify that the block is _missing_ basefee when it's not enabled",
        "created_at": "2021-05-05T09:35:04.822000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "How is it that a block with a base fee is being accepted by the network before 1559 hard fork block?",
        "created_at": "2021-05-05T09:35:17.082000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hmm, I see.  The block validity check just says \"Is this a valid block under either of these two rulesets\" rather than \"is this a valid block under the ruleset applied to this block number\"?",
        "created_at": "2021-05-05T09:35:59.423000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Regarding that _first_ case, where I sent a header without basefee _after_ 1559, nethermind fared ok. However, I see now that you check the `seal` prior to checking 1559-stuff, so it might be that it errored on that part (since I don't have a sealer-key on aleut).  So potentially, on a PoW network, I could get further with that attack",
        "created_at": "2021-05-05T09:38:42.127000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But my naive attack probably did not make it into this portion: https://github.com/NethermindEth/nethermind/pull/3023/files#diff-3f69ed0eab850713c4d45a0d9f32e305d7a21716c4996f029d9296de38a928adR143",
        "created_at": "2021-05-05T09:39:26.142000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Well, the parsers don't know about the chain rules, they just build a header from the data. The header validity check, which is _aware_ of the current chain rules, needs to enforce that this new field (because most implementations just added a field to the existing type, and didn't define a totally new type) is nil when it should, and non-nil when it should.",
        "created_at": "2021-05-05T09:42:00.519000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hey all, we've had a long discussion with \u003c@!211091239112671234\u003e and \u003c@!194432762315407360\u003e about certain kinks/ambiguities in the 1559 EIP naming conventions and wanted to bring up 3 issues that we think ave very important to get right (RPC API naming and any fallout that is causes in client and ecosystem code). Please read through and consider them: https://gist.github.com/karalabe/1565e0bc1be6895ad85e2a0116367ba6\n\nCC \u003c@!543900561460822016\u003e \u003c@!273808422753796097\u003e",
        "created_at": "2021-05-05T09:59:48.317000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Wrote it up as a gist to have an extended reasoning + proposals to fix it vs. having a bike-shedding fest due to people misunderstanding / missing bits of information through some chat logs.",
        "created_at": "2021-05-05T10:01:08.146000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I believe this is a primary topic of discussion for the London Readiness meeting this Friday?",
        "created_at": "2021-05-05T10:01:39.322000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Also, you three definitely aren't the only ones discussing this, sadly the discussion is quite spread out at the moment.",
        "created_at": "2021-05-05T10:02:16.183000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm not sure it warrants a live debate, if it can be solved here ðŸ™‚ But sure, we can bring it up thre too if we must",
        "created_at": "2021-05-05T10:02:33.743000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm very glad to see the writeup though!  I wish everyone would do a long-form write-up of their views like that.  ðŸ™‚",
        "created_at": "2021-05-05T10:02:36.792000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "People have been debating this specific question of naming for the past several weeks, so I think the meeting on Friday is an attempt to try to find a termination for that debate.",
        "created_at": "2021-05-05T10:03:04.936000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Personally, I am a fan of verbosity and with auto-complete engines being the norm am not swayed much by \"unwieldy\" variable names, especially when they are in specifications but also when they are in APIs.",
        "created_at": "2021-05-05T10:03:46.724000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So my preference is something like `maxPriorityFeePerGas` and `maxFeePerGas` because they very clearly describe what those values mean.",
        "created_at": "2021-05-05T10:04:10.231000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "However, I care *less* about the final wording in the API than in the specification, so I'm more likely to roll over there.",
        "created_at": "2021-05-05T10:04:50.500000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "In general I'd agree with the verbose versions, but since we have `gas` `gasLimit` `gasPrice` and `gasUsed` as fields currently, I think we also need to be consistent, hence why we went with the similar naming structure `gasFeeCap` and `gasTipCap`. We could name it `gasMaxFee` and `gasMaxTip` too.",
        "created_at": "2021-05-05T10:09:17.707000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Tip in favor of PriorityFee seems like a definite win though",
        "created_at": "2021-05-05T10:09:43.359000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I agree that consistency is good.  I dis agree that this is something where consistency matters much and I have never been a fan of the legacy naming.",
        "created_at": "2021-05-05T10:09:51.593000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "`tip` doesn't accurately represent what this is though.  A `tip` is optional (this is not) and is paid after service is provided, not before.",
        "created_at": "2021-05-05T10:10:16.864000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "priorityfee is optional though, you can have it 0",
        "created_at": "2021-05-05T10:10:41.080000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This is definitely a fee, as you need to pay it before service and it is very much not optional for anyone except the most advanced users.",
        "created_at": "2021-05-05T10:10:43.512000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ah, I get what you're hinting at",
        "created_at": "2021-05-05T10:11:05.415000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "While technically true, I think the set of users who will be trying to guess what this variable is based on its name it is not optional.",
        "created_at": "2021-05-05T10:11:07.866000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yes, maybe there's even a better word",
        "created_at": "2021-05-05T10:11:12.450000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I liked `bribe` for a while, but it was pointed out that bribes are (by definition) a dishonest thing and this is very much part of the protocol.",
        "created_at": "2021-05-05T10:11:52.676000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ok, it does end up as a bike shed :)) Ok, anyone else is free to do their writeup ðŸ™‚",
        "created_at": "2021-05-05T10:11:58.295000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It probably makes it saner that chat, otherwise we just go back and forth",
        "created_at": "2021-05-05T10:12:17.560000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If there's an agenda for London, pls drop the above gist there",
        "created_at": "2021-05-05T10:12:33.942000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think we went over about a dozen different options for naming over the past 6 months.",
        "created_at": "2021-05-05T10:12:36.486000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ok, I'm fine with others too as long as the EIP specs out the RPC",
        "created_at": "2021-05-05T10:13:04.893000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Done: https://github.com/ethereum/pm/issues/308",
        "created_at": "2021-05-05T10:13:17.431000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Thx",
        "created_at": "2021-05-05T10:15:16.677000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I wrote this test yesterday. With t8ntool I cant check blockchain logic, so I do this verification myself",
        "created_at": "2021-05-05T10:21:05.325000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "https://github.com/ethereum/tests/pull/826/files#diff-55c801e327c7b178cfeb79e761b04c476c226fe70c1154bdd25a14a745515a13",
        "created_at": "2021-05-05T10:21:57.974000+00:00",
        "attachments": null
    },
    {
        "author": "matkt0",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "looking at the code of Besu. We need to add an additional check to be sure to avoid that",
        "created_at": "2021-05-05T10:22:32.860000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Awesome \u003c@!393119312350543872\u003e ! I will try to check that test, to verify that the current geth PR indeed fails that test!",
        "created_at": "2021-05-05T10:50:10.245000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Is the `expectException` part of blockchain tests a new thing?",
        "created_at": "2021-05-05T11:17:20.411000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "No its only in fillers",
        "created_at": "2021-05-05T11:34:38.811000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The test is invalid as t8ntool pass 1559 transaction in legacy blocks",
        "created_at": "2021-05-05T11:35:34.942000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "You mean block `4` is invalid, right, not the test itself... ?",
        "created_at": "2021-05-05T12:09:29.143000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm having some problems with the block which has `header.Number` `5`, but `\"blocknumber\" : \"6\",`. The `\"gasTarget\" : \"0xbebc20\",` is `12.5M`, which is way too high",
        "created_at": "2021-05-05T12:10:34.515000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ok, sorted it out, wrote on the PR",
        "created_at": "2021-05-05T12:22:15.120000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The block 4 has invalid transaction which is accepted",
        "created_at": "2021-05-05T12:42:48.585000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ok so. No gasTarget in the block json",
        "created_at": "2021-05-05T12:44:28.703000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Eip1559 tr must be rejected before the fork",
        "created_at": "2021-05-05T12:44:54.577000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hey guys, at JS we implemented EIP1559 such that on the first EIP1559 block, the base fee should be 1,000,000,000 (the blocks before the EIP1559 block are assumed to have this base fee). However, the spec seems to imply that on the first block we calculate the base fee just fine. Since we synced with Aleut just fine it seems that all other clients also assume that on the fork block the base fee should be 1,000,000,000? So the question is, should we already alter the base fee on the fork block or does it default to 1,000,000,000?",
        "created_at": "2021-05-05T13:12:28.662000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@508125616940515329\u003e Per spec, the base fee of the block prior to the fork block is assumed to be `10^9`.",
        "created_at": "2021-05-05T13:13:35.322000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think... let me actually double check that.",
        "created_at": "2021-05-05T13:14:07.114000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah, the parent of the fork block should be assumed to have a base_fee of 10^9.  This means that the fork block (the first block which actually has `base_fee` in the header) will probably have more or less than 10^9.  Is this not what you see?",
        "created_at": "2021-05-05T13:15:34.228000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I will check but I am rather certain that on Aleut the block base fee is 1e9 since we enforce this in our package, but I will verify",
        "created_at": "2021-05-05T13:16:22.867000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "You mean the fork block base fee?",
        "created_at": "2021-05-05T13:16:36.588000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yep",
        "created_at": "2021-05-05T13:16:45.988000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Oh, did the parent block have 100% gas used?",
        "created_at": "2021-05-05T13:17:08.078000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This would be a bit surprising if so, but that would result in the fork block having a base fee of 10^9 just like the parent (no change needed, target was hit exactly).",
        "created_at": "2021-05-05T13:17:33.320000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Interestingly, the fork block will almost certainly have a base_fee of less than 10^9.",
        "created_at": "2021-05-05T13:18:08.939000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Just as a side effect of how the transition works.",
        "created_at": "2021-05-05T13:18:19.253000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It cannot have a base fee larger than 10^9, because the parent block cannot go over the gasTarget.",
        "created_at": "2021-05-05T13:18:36.330000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "http://eip1559-testnet.ops.pegasys.tech:3000/block/10\nhttp://eip1559-testnet.ops.pegasys.tech:3000/block/9\n\nBlock 9; 0 gas used\nBlock 10 base fee: 10^9",
        "created_at": "2021-05-05T13:23:03.452000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Block 10 is an EIP-1559 block?",
        "created_at": "2021-05-05T13:24:11.354000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Could \u003c@!574864862338088960\u003e \u003c@!273808422753796097\u003e maybe chime in here? All clients seem to agree on first block base fee 10^9, but this does not seem to match the spec",
        "created_at": "2021-05-05T13:24:20.851000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yes Aleut forks at block 10",
        "created_at": "2021-05-05T13:24:25.149000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I wouldn't be terribly surprised if everyone landed on the wrong implementation.  ðŸ˜¢",
        "created_at": "2021-05-05T13:24:55.088000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Heh ðŸ˜…",
        "created_at": "2021-05-05T13:25:09.910000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Then we should update the EIP ðŸ™‚",
        "created_at": "2021-05-05T13:25:14.656000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "https://github.com/ethereum/eth1.0-specs/blob/master/network-upgrades/client-integration-testnets/aleut.md (block 10 forks see genesis file)",
        "created_at": "2021-05-05T13:25:25.573000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It is going to add notable complexity I think to have it the way clients have implemented it.  :/",
        "created_at": "2021-05-05T13:25:28.265000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Also CC \u003c@!543900561460822016\u003e \u003c@!758579010027782144\u003e for this issue",
        "created_at": "2021-05-05T13:32:01.172000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I've already asked about this situation few weeks before in this channel, and the agreement was that the first block to actually calculate the base fee is FORK_BLOCK_NUMBER + 1",
        "created_at": "2021-05-05T13:37:19.299000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Here it is",
        "created_at": "2021-05-05T13:38:55.236000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ahh ok great. But then we should update the spec since the spec does match the implementation ðŸ˜…",
        "created_at": "2021-05-05T13:39:12.453000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ugh.  Why aren't we fixing bugs in clients?",
        "created_at": "2021-05-05T13:47:01.889000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I mean, we *can* change the spec, but I feel like we should spec how things *should* be, and then build clients to match.  We shouldn't write a spec, then write clients that do something different, then change the spec to retroactively match whatever crazy thing clients ended up doing.",
        "created_at": "2021-05-05T13:47:43.432000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The spec doesn't say \"calculate the base fee starting in `FORK_BLOCK_NUMBER + 1`, and doing so adds complexity to the spec IMO.",
        "created_at": "2021-05-05T13:48:19.211000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@\u0026688090867927482525\u003e i invited you to have write access to quilt/go-ethereum (you may need to accept invitation in your email)",
        "created_at": "2021-05-05T13:49:30.054000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I agree with this. On the other hand, it feels more logical to calculate base fee for FORK_BLOCK_NUMBER + 1, because base fee calculation is based on gas target of block and gas target of parent block. And for the FORK_BLOCK_NUMBER you don't have gas target for his parent. Just a clue why clients implemented it this way...",
        "created_at": "2021-05-05T13:54:43.053000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "that line was added after it was already decided initialize the fork block to 1e9, IMO it's the spec update that didn't match what we expected",
        "created_at": "2021-05-05T13:55:14.911000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I am open to being convinced that we should change the spec in a way that improves the spec, and this is not a terribly unreasonable argument.  My opposition is only to blindly changing the spec to match client behavior.",
        "created_at": "2021-05-05T13:55:45.505000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I don't believe this is true, but maybe I'm mis-remembering?",
        "created_at": "2021-05-05T13:56:13.184000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I believe that as soon as we decided to change the default base fee from 0 to 10^9 I did so within a day or two.",
        "created_at": "2021-05-05T13:56:35.404000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "IIRC, I asked a while back why the initial param wasn't defined in the spec",
        "created_at": "2021-05-05T13:56:45.536000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Though, maybe this PR, like many others, sat unmerged for a month.",
        "created_at": "2021-05-05T13:56:46.764000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The spec definitely said default to 0 originally, but this same bug would have existed in that case.",
        "created_at": "2021-05-05T13:57:16.513000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The recent change was only \"change 0 to 10^9\", it didn't change how the base_fee calculation for the fork block is done.",
        "created_at": "2021-05-05T13:57:46.916000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "i see",
        "created_at": "2021-05-05T13:58:41.370000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "is there a functional improvement by calculating the base fee based on fork_block - 1 instead of fork block?",
        "created_at": "2021-05-05T13:59:30.982000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "i think we can expected the fork block - 1 to be 99.75 percent full anyways so the default will already be very close to the correct value?",
        "created_at": "2021-05-05T14:00:05.656000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Well there is a nonzero chance it's an empty block mined in a millisecond",
        "created_at": "2021-05-05T14:00:32.921000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I have no strong opinions here",
        "created_at": "2021-05-05T14:00:52.382000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "definitely",
        "created_at": "2021-05-05T14:01:19.141000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "also don't have much of an opinion",
        "created_at": "2021-05-05T14:02:05.205000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Currently in the spec, as of the fork block new rules are followed for block production and validation.",
        "created_at": "2021-05-05T14:04:11.898000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It is a clean cut between `FORK_BLOCK_NUMBER-1` and `FORK_BLOCK_NUMBER`.",
        "created_at": "2021-05-05T14:04:40.719000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ðŸ¤” Can we rewrite the spec so we maintain that clean cutover while doing the other way (the implemented way)?",
        "created_at": "2021-05-05T14:05:09.825000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I suppose we could have `base_fee` default to `null` instead?",
        "created_at": "2021-05-05T14:05:27.377000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Then switch on null.",
        "created_at": "2021-05-05T14:05:34.832000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Though, I think large conditional blocks adds complexity.",
        "created_at": "2021-05-05T14:05:57.130000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think I have some preference to actually just set the base fee to 10^9 on the fork block since the previous block can never have more gas used than gas target / gas limit.",
        "created_at": "2021-05-05T14:06:03.495000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The current solution just defaults a value when missing, thus lower complexity IMO.",
        "created_at": "2021-05-05T14:06:08.388000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I care far more about implementation complexity than what the base fee is on the fork block.",
        "created_at": "2021-05-05T14:06:29.820000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "What the base fee is on the fork block is nearly inconsequential in the long term, while code complexity is forever.",
        "created_at": "2021-05-05T14:06:51.272000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "What would the proposed validation code look like?",
        "created_at": "2021-05-05T14:07:19.314000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!301186049323958275\u003e \n```\nexpectedBaseFee := new(big.Int).SetUint64(params.InitialBaseFee)\nif notFirst {\n    // Only calculate the correct baseFee if the parent header is\n    // also a EIP-1559 header.\n    expectedBaseFee = CalcBaseFee(parent)\n}\nif header.BaseFee.Cmp(expectedBaseFee) != 0 {\n    return fmt.Errorf(\"invalid baseFee: expected: %d, have %d, parentBaseFee: %v, parentGasUsed: %v\", expectedBaseFee, header.BaseFee.Int64(), parent.BaseFee.Int64(), parent.GasUsed)\n}\n```",
        "created_at": "2021-05-05T14:08:50.623000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That is what I had in my head, which I'm reasonably strongly against.",
        "created_at": "2021-05-05T14:09:22.497000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I have a strong dislike for branching in code when it can be avoided and in this case it can.",
        "created_at": "2021-05-05T14:09:43.915000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Current:\n```ts\nparent_base_fee_per_gas = self.parent(block).base_fee_per_gas == null ? 10^9 : self.parent(block).base_fee_per_gas\n// everything after this is the same\n```",
        "created_at": "2021-05-05T14:10:02.305000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "In this case we have reduced the conditional down to a simple default value, which in some languages isn't even a conditional.",
        "created_at": "2021-05-05T14:10:40.367000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "this is still a branch ðŸ˜¦",
        "created_at": "2021-05-05T14:10:57.336000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yes, but it branches over *much* less code.",
        "created_at": "2021-05-05T14:11:06.127000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "?",
        "created_at": "2021-05-05T14:11:09.647000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The branches are just picking between two numbers.  Similar to how `Math.min(a, b)` is technically branching inside, but it is an incredibly narrow/constrained amount of code living inside the two branches.",
        "created_at": "2021-05-05T14:12:09.307000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The more code that is executed differently based on some condition, the more complexity I consider a branch to bring into the codebase.",
        "created_at": "2021-05-05T14:12:48.156000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "neither go nor rust have ternary operators, so the code couldn't be implemented",
        "created_at": "2021-05-05T14:12:50.266000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Are `if` statements expressions in either language?",
        "created_at": "2021-05-05T14:13:23.011000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "(doesn't change my argument, but I'm still curious)",
        "created_at": "2021-05-05T14:14:06.794000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "not sure what exactly you mean \"expression\" - e.g. you can assign the outcome of an if statement?",
        "created_at": "2021-05-05T14:14:17.470000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah.",
        "created_at": "2021-05-05T14:14:33.035000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "go no, rust yes",
        "created_at": "2021-05-05T14:14:52.003000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "```\nconst appleColor = if (sour) 'green' else 'red'\n```",
        "created_at": "2021-05-05T14:14:56.386000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but i believe the rust formatter doesn't allow 1 line if expressions",
        "created_at": "2021-05-05T14:15:18.652000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The multi-linesess isn't what bothers me, it is:\n```ts\nif (condition) {\n    doALotOfStuff()\n}\n```",
        "created_at": "2021-05-05T14:16:22.761000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This, IMO, has significantly lower code complexity (and thus lower change of bugs) than the above:\n```ts\nif (condition) {\n    doVeryLittleStuff()\n}\n```",
        "created_at": "2021-05-05T14:16:55.849000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "only one thing in the if statement ðŸ˜¦",
        "created_at": "2021-05-05T14:17:56.646000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Maybe I'm misreading, but isn't `CalcBaseFee(parent)` a function call to something that does a bunch of stuff?",
        "created_at": "2021-05-05T14:20:04.323000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yeah, it calculates the base fee, but that code has to live somewhere",
        "created_at": "2021-05-05T14:21:20.090000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Right.  The idea is to keep the amount of logic that is conditionally executed to a minimum to minimize complexity.",
        "created_at": "2021-05-05T14:22:46.030000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Well, that would mean that we should calculate base fee for pre fork blocks also, and figure out how to keep them to default value until fork block comes.",
        "created_at": "2021-05-05T14:24:22.665000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That would be nice!",
        "created_at": "2021-05-05T14:24:42.144000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Have ideas on how we could do that?",
        "created_at": "2021-05-05T14:24:46.881000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Having a separate `gasTarget` from `gasLimit` variable in the internal block datastructure may achieve this?",
        "created_at": "2021-05-05T14:25:24.144000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We could default `gasTarget` to `gasUsed` when missing from the block.",
        "created_at": "2021-05-05T14:25:42.993000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "```ts\nstruct Block {\n    gasLimit: bigint | undefined\n    gasUsed: bigint\n    gasTarget: bigint = gasUsed\n}\n```",
        "created_at": "2021-05-05T14:26:42.537000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If there is no `gasTarget` in the received block, then it defaults to `gasUsed`.  This would result in the base fee calculations being able to be run without ever actually changing the base fee, so we could execute this code against every block in history (no need to have this code fork).",
        "created_at": "2021-05-05T14:27:38.416000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Then on the fork block, all that changes is that the header deserializes one of the values into a different item.",
        "created_at": "2021-05-05T14:28:13.299000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I kind of suspect this wouldn't actually work well for Geth due to the way they do deserialization.  ðŸ˜¢",
        "created_at": "2021-05-05T14:28:28.130000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Are you sure about leaving gasTarget as gasLimit? Its referenced as gasTarget in so many docs and formulas and we already started json structures with gasTarget..",
        "created_at": "2021-05-05T15:33:49.691000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Is that comment targeted at Peter or me?",
        "created_at": "2021-05-05T15:46:48.347000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@211091239112671234\u003e",
        "created_at": "2021-05-05T15:49:15.643000+00:00",
        "attachments": null
    },
    {
        "author": "karalabe",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This drives the point home. If Dimitry is having a hard time changing from gasTarget back to gasLimit, imagine what effort the entire ecosystem needs to go the other way. It's imho a bad idea to rename.",
        "created_at": "2021-05-05T16:03:25.715000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think the problematic part is that, in rlp-world, there is no ambiguity. Renaming a json-field means that we introduce an ambiguity that is totally not needed. We can leave things unambiguous, what `gasLimit` means if the context is \"post eip 155\" or \"pre eip 155\". The context for why this cropped up in the discussion with \u003c@!393119312350543872\u003e is this comment: https://github.com/ethereum/tests/pull/826#issuecomment-832643523",
        "created_at": "2021-05-05T16:33:06.493000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "it is not hard. it is just confusing. as eip itself has gasTarget everywhere\nif EIP paper would use the same variable names as in the code it would be perfect",
        "created_at": "2021-05-05T16:38:45.080000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Well, if we _really_ want to fix it, it's actually a lot harder. Then we should instead do this: \n- Change the EIP, so that `gasLimit` is the absolute max cap of gas that can be used in a block. So it's essentially the eip-current `gasLimit * 2`. \n- Redefine `gasTarget`, or even remove it, and rephrase as: \"If the `gasUsed` exceeds `gasLimit/2`, then ... \" \n- And have `gasLimit`, at fork block, bump to `2x` the previous value. \n\nThat would remove all ambiguity. However, it would also change the blocks, and all implementations would have to update, because the field formerly-known-as-gastarget would be twice as large.",
        "created_at": "2021-05-05T17:06:50.014000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But then, the `gasLimit` would still be semantically correct: the upper limit which is allowed. And we would no longer have this wonky 1-field-2-json-names situation.",
        "created_at": "2021-05-05T17:08:06.297000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Does doing the above introduce a lot of extra work for clients? And would it lead to a problem around the fork block where blocks end up at only 50% of the current capacity and miners need to push the gas limit up 2x from there?",
        "created_at": "2021-05-05T18:20:50.584000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I don't think that would be much effort, removing some `gasLimit = gasTaget*elasticity` statements",
        "created_at": "2021-05-05T18:23:07.284000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "i like this approach a lot, i think it will save a lot of frustration down the road",
        "created_at": "2021-05-05T18:27:48.651000+00:00",
        "attachments": null
    },
    {
        "author": "suburbandad_",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "As I understand it, we'd need to have the change implemented and tested before May 19th right?",
        "created_at": "2021-05-05T18:36:33.511000+00:00",
        "attachments": null
    },
    {
        "author": "suburbandad_",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "plus 3529 and 3541.  That would be awfully tight for besu",
        "created_at": "2021-05-05T18:42:32.615000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "No, we would just bump what is in the header, so that with 1559, the gasLimit is 2x the target. The target is not communicated in the header, only the gaslimit, as before.",
        "created_at": "2021-05-05T18:50:52.046000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "In eip 1559, the `gasLimit` _does_ bump to 2x whatever was before. But for some reason, the EIP chose to encode the `gasTarget` into the header, which adds ambiguity. It could have chosen this alternative approach.",
        "created_at": "2021-05-05T18:51:54.928000+00:00",
        "attachments": null
    },
    {
        "author": "suburbandad_",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "baikal should probably wait for this change if that is the direction though right?",
        "created_at": "2021-05-05T18:55:16.976000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If we want the blog post to go out on June 2 (1 week prior to the fork), in theory you have all the way until June 1, but that's cutting it close ðŸ˜…",
        "created_at": "2021-05-05T18:55:24.934000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ah, got it! Yeah, that's much more logical.",
        "created_at": "2021-05-05T18:57:05.388000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Does making `gasLimit` the absolute max gas used introduce a DoS risk for miners? Like they'd run a transaction, it'd refund most/all of the gas, and they wouldn't get paid?",
        "created_at": "2021-05-05T19:02:25.592000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Well, _if_ we chose to do this, then I definitely think we need to have it in baikal",
        "created_at": "2021-05-05T19:02:33.580000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Nothing of the semantics, or \"mechanics of tx execution and block processing\" would change",
        "created_at": "2021-05-05T19:03:32.975000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It would just be a different way to describe the state of things from one block to the next",
        "created_at": "2021-05-05T19:04:02.472000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Just to clarify, the block header change is the only one that affects consensus, right? The JSON RPC variable naming isn't a blocker for Baikal (but still a nice to have, of course). If that's the case, is there a way we can agree on the block header change async here so that teams are all on the same page?",
        "created_at": "2021-05-05T19:05:35.661000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We clearly can't wait to the next ACD to do that anyways ðŸ˜…",
        "created_at": "2021-05-05T19:05:47.087000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yes, that's what makes this a bit \"hard\" -- it's a consensus change.",
        "created_at": "2021-05-05T19:06:21.179000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "New transaction type as well. With new fields tip and feeCap and gasPrice removed",
        "created_at": "2021-05-05T19:08:46.065000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e is  there a way we can agree on the block header change async here so that teams are all on the same page?\n\nWell, I don't know. \u003c@\u0026836981603216654336\u003e (via Gary) signalled, fwict, somewhat negative. \u003c@\u0026688090867927482525\u003e thinks it's good. What about \u003c@\u0026652918665943056397\u003e and \u003c@\u0026595684226221735986\u003e ? And how does \u003c@!273808422753796097\u003e feel about it?",
        "created_at": "2021-05-05T19:09:15.996000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "No we're talking about something else: https://discord.com/channels/595666850260713488/749160974506000444/839548707859070996",
        "created_at": "2021-05-05T19:09:30.903000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The transaction are also in json rpc",
        "created_at": "2021-05-05T19:10:02.744000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yes, but what we're talking about now is not that.",
        "created_at": "2021-05-05T19:10:43.094000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yes. If a gasLimit just jumps 2 times and formulas change accordingly ita much more clear",
        "created_at": "2021-05-05T19:11:18.827000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I don't understand what you mean \u003c@!393119312350543872\u003e",
        "created_at": "2021-05-05T19:12:15.998000+00:00",
        "attachments": null
    },
    {
        "author": "dimitry8570",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I mean I agree on your proposal in that message",
        "created_at": "2021-05-05T19:13:11.493000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!508125616940515329\u003e any thoughts from EthereumJS? \u003c@456226577798135808\u003e from TG? \n\nSpecifically about this message: https://discord.com/channels/595666850260713488/749160974506000444/839548707859070996",
        "created_at": "2021-05-05T19:14:09.654000+00:00",
        "attachments": null
    },
    {
        "author": "suburbandad_",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "somewhat negative due to resource constraints, and just general timeline.  solution-wise it sounds like a good idea",
        "created_at": "2021-05-05T19:19:50.316000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "For OE, seems like a 1 day job to carefully implement the change and test it.",
        "created_at": "2021-05-05T19:21:51.727000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If timing is the main constraint, one option we have is to fork the first testnet on June 16th instead of 9th and just have less time between the last testnet fork and mainnet. \n\nIt would go from:\n- June 9: Ropsten\n- June 16: Goerli\n- June 23: Rinkeby\n- [3 weeks]\n- July 14: Mainnet \n\nTo: \n- June 16: Ropsten\n- June 23: Goerli\n- June 30: Rinkeby\n- [2 weeks]\n- July 14th: Mainnet",
        "created_at": "2021-05-05T19:25:47.338000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We can also push back mainnet 1 week, but that will mean the difficulty bomb is likely to go off at least a bit (rough guess would be ~5% longer block times) and when I spoke with client teams, there was some fairly strong opposition to that.",
        "created_at": "2021-05-05T19:26:45.288000+00:00",
        "attachments": null
    },
    {
        "author": "marekm3498",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I like this. From Nethermind perspective, it should be easy to change",
        "created_at": "2021-05-05T19:39:25.157000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hmm did we actually test a GASLIMIT opcode on Aleut already?",
        "created_at": "2021-05-05T19:41:56.620000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Actually what should be the semantics of this..?",
        "created_at": "2021-05-05T19:42:35.087000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Should it be the block gas target or the gas target * elasticity..!?",
        "created_at": "2021-05-05T19:42:46.765000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "doesn't appear to be specified in the spec",
        "created_at": "2021-05-05T19:43:14.458000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ouch",
        "created_at": "2021-05-05T19:43:18.461000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm gonna send a gas limit tx ðŸ™‚",
        "created_at": "2021-05-05T19:43:22.453000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think I have a preference for the changes \u003c@!211091239112671234\u003e proposed.",
        "created_at": "2021-05-05T19:44:40.792000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Then we don't have these new fields. But that would mean rolling back these gasTarget changes.",
        "created_at": "2021-05-05T19:45:09.300000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "OK so basically everyone seems in favor, but this would potentially affect timelines. \n\nDoes it make sense to go with the change, and then we can discuss if we need to move the London timelines on the next ACD based on where implementations are at? \n\nIf so, can someone open a PR against the spec? \u003c@!574864862338088960\u003e or \u003c@!273808422753796097\u003e can approve it once it's there.",
        "created_at": "2021-05-05T19:50:54.824000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I would assume the GASLIMIT opcode would return the actual limit, and not the target?",
        "created_at": "2021-05-05T19:51:40.144000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Not sure, it is not defined in the spec...",
        "created_at": "2021-05-05T19:53:49.822000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We should add it then, but I was mostly asking what clients had done when implementing ðŸ˜…",
        "created_at": "2021-05-05T19:54:45.638000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Haha yeah I think consensus wise we are going to be fine",
        "created_at": "2021-05-05T19:55:36.390000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But we should think about this nevertheless",
        "created_at": "2021-05-05T19:55:40.743000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think also for this opcode it makes sense to use \u003c@!211091239112671234\u003e 's idea",
        "created_at": "2021-05-05T19:55:51.447000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Oh wow. Great question! I had forgotten we even had such a thing. What does it even return, on the current EIP-1559 ?",
        "created_at": "2021-05-05T20:04:29.170000+00:00",
        "attachments": null
    },
    {
        "author": "suburbandad_",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "+1 for go with the change and evaluate if dates need to be pushed",
        "created_at": "2021-05-05T20:04:42.590000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I can't get my txs mined for GASLIMIT",
        "created_at": "2021-05-05T20:05:27.684000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "updated EIP-1559 per \u003c@!211091239112671234\u003e's proposal: https://github.com/ethereum/EIPs/pull/3552",
        "created_at": "2021-05-05T20:05:54.632000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!543900561460822016\u003e Could you post your RPC endpoint? ðŸ™‚",
        "created_at": "2021-05-05T20:06:19.423000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "dm'd you",
        "created_at": "2021-05-05T20:09:32.458000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Thanks",
        "created_at": "2021-05-05T20:12:13.093000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I just mined a txn which stores gaslimit in storage",
        "created_at": "2021-05-05T20:12:28.748000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Lemme see what it has stored ðŸ˜…",
        "created_at": "2021-05-05T20:12:43.380000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!211091239112671234\u003e this message seems to contradict what you just posted on Github: https://github.com/ethereum/EIPs/pull/3552#issuecomment-832974187",
        "created_at": "2021-05-05T20:12:51.670000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Uhh",
        "created_at": "2021-05-05T20:14:23.068000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It stores 19805555",
        "created_at": "2021-05-05T20:14:30.104000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ah ok maybe OE lowered the gas target?",
        "created_at": "2021-05-05T20:14:45.057000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Sorry, i am not sure i fully understand the question?",
        "created_at": "2021-05-05T20:16:55.235000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Gas target used to be constant 20M, but now it has apparently lowered",
        "created_at": "2021-05-05T20:20:04.418000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "(Of the blocks)",
        "created_at": "2021-05-05T20:20:10.122000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "OE is the new signer right?",
        "created_at": "2021-05-05T20:20:13.393000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "regardless of whether it's 19m or 20m, clearly that must be returning the target and not the limit, right?",
        "created_at": "2021-05-05T20:23:30.248000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I am now strongly in favor for this since this lowers the complexity of the EIP in the following cases:\n\nLet's assume we follow the current spec and then compare to the changes \u003c@!211091239112671234\u003e proposed.\n\n(1) Txs get rejected in TxPool / over RPC in case `gasLimit` of tx \u003e `gasTarget` of the block. EIP does not specify anywhere that a single tx using more than gas target is not allowed to get mined. If we change the spec, then this behavior does not change compared to pre-EIP1559 blocks\n(2) GASLIMIT opcode now does not change, just report the gas limit\n(3) Since sending txs with higher gas limit over RPC gets rejected then it is likely that all (?) clients currently do not allow any txs with gasLimit \u003e gasTarget getting mined, but a miner *could* potentially mine a block where there is a txn using more than gasTarget gas in the block. According to the spec this is fine, but it is very likely that this would lead to consensus issues.",
        "created_at": "2021-05-05T20:23:58.058000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We can change it, no problem",
        "created_at": "2021-05-05T20:24:56.049000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I have done two 1-hour sessions (meaning video calls with screen share) this week on going through London HF implementation in TG, so I know pretty well how to find all these places",
        "created_at": "2021-05-05T20:25:48.457000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Next week we are going to discuss Consensus Engine separation, usual times on Monday morning and Tuesday afternoon",
        "created_at": "2021-05-05T20:26:42.633000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I am not sure if we should agenda these points for the london call \u003c@!420951281910284289\u003e ?",
        "created_at": "2021-05-05T20:28:25.290000+00:00",
        "attachments": null
    },
    {
        "author": "trent_vanepps",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "which ones?",
        "created_at": "2021-05-05T20:29:09.584000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yes, at the very least to confirm them. Can you leave this as a comment on the agenda, \u003c@!508125616940515329\u003e ?",
        "created_at": "2021-05-05T20:29:24.014000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This proposed change to the EIP https://discord.com/channels/595666850260713488/749160974506000444/839579519139840061 (EIP 1559)",
        "created_at": "2021-05-05T20:29:54.275000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah I will",
        "created_at": "2021-05-05T20:30:01.646000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "How does this doubling of the gas limit work? Are miners allowed to also change the gas limit on that block (up or down a few units?). Or is at fork block forced that the block has twice the parent gas limit?",
        "created_at": "2021-05-05T20:39:30.004000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ah right I think I get it with the proposed changes",
        "created_at": "2021-05-05T20:42:03.928000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "i updated 1559 to where miners control the gas_target (as it was before) as gas limit is just elasticity * gas_target",
        "created_at": "2021-05-05T20:44:45.968000+00:00",
        "attachments": null
    },
    {
        "author": "trent_vanepps",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "added to the agenda",
        "created_at": "2021-05-05T20:53:59.028000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Soo, you managed to crash OE node on Aleut with this tx ðŸ™‚ OE actually reports 39611110 for GASLIMIT opcode, while other clients report 19805555 i guess, since no other node crashed. So, should we return gas_target or gas_target*elasticity_multiplier for GASLIMIT opcode?",
        "created_at": "2021-05-05T22:23:40.418000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!439883507406340126\u003e it seems like we're going to modify the spec so that the block goes back to having the gas limit rather than the gas target, at which point it should return the gas limit defined in the block",
        "created_at": "2021-05-05T22:26:02.533000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Let's wait until we discuss the proposed changes to the EIP; if we change the EIP then the answer to this question is not ambiguous anymore ðŸ™‚ I think the EIP spec leans towards reporting the gas target as gas limit, but on the other hand that (semantically) does not make much sense.",
        "created_at": "2021-05-05T22:28:15.493000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yes, I understand. But for the current implementation, I guess most of the clients use the same variable for GASLIMIT opcode to also verify if the single tx fits the block size. So, If you all use gas_target as that variable, that means that currently you don't allow a single tx to be bigger than gas_target right?",
        "created_at": "2021-05-05T22:32:31.084000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yep this seems to be the case ðŸ™‚ But, if we update the PR with the proposed changes then this problem is gone ðŸ™‚",
        "created_at": "2021-05-05T22:33:07.858000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "for geth, GASLIMIT returns the value in the block header (whether its gas target or gas limit), but the block limit available for txs should allow for txs to use the entire limit (e.g. with elasticity multiplier)",
        "created_at": "2021-05-05T22:35:00.399000+00:00",
        "attachments": null
    }
]