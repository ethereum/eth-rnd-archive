[
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I'm not sure which Guillaume asked for examples of blockhash usage in ACD:\n\u003chttps://github.com/Keydonix/uniswap-oracle/\u003e",
        "created_at": "2021-02-19T15:16:43.644000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "\u003c@!353136597522448385\u003e",
        "created_at": "2021-02-19T15:19:15.136000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "I see it also uses MPT proofs. What would happen if MPT would be replaced with anything else like binary trie or verkle trie?",
        "created_at": "2021-02-19T15:42:40.468000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Would need to be reimplemented and redeployed.",
        "created_at": "2021-02-19T15:43:01.723000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "If state proof validation changes in any way it would need updated.",
        "created_at": "2021-02-19T15:43:15.011000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "You could make me *want* to make that change by giving me an opcode/precompile for validating a state proof.",
        "created_at": "2021-02-19T15:43:33.204000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "The clients already have the ability to do this, but I can't access that ability from the EVM, so I have to implement the whole thing in the EVM.  ðŸ˜¢",
        "created_at": "2021-02-19T15:44:00.607000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Note: As far as I know, no one actually uses that oracle because it is too gas expensive right now.  Just using it as an example.",
        "created_at": "2021-02-19T15:44:20.862000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "There are similar provers for transaction inclusion and receipts I have seen out there, but I *suspect* they are also too expensive to actually be used in any real apps anymore.",
        "created_at": "2021-02-19T15:44:48.360000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "I see. Yes, it makes sense to implement a precompile that verifies proofs of data inclusion into the state disregarding abstracting away particular commitment scheme.",
        "created_at": "2021-02-19T15:48:12.304000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "\u003c@!301186049323958275\u003e btw this is what I meant with proving anything of eth2 in evm, if the proofs are standardized it would make sense having that as opcode/precompile, as it is a clear and needed functionality, the surface area is smaller than a generic purpose precompile, and keeps breaking changes isolated.",
        "created_at": "2021-02-19T15:51:14.100000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "\u003c@!353136597522448385\u003e \u003c@!425572898787426305\u003e also we have been looking into some of these opcodes last year how they are used, but apart from proofs, the only examples we found were for \"randomness\".",
        "created_at": "2021-02-19T15:51:55+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Do you have a list of contracts maybe?",
        "created_at": "2021-02-19T15:57:44.990000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "\u003c@!259648573401071617\u003e was running the data collection, here are some.\n\nThese are all for randomness:\n0x3ffff4facd37f09b03f79b1eddfdc65316ecb2bd\n0x1eccc2197e5d8e240c922f0d1372add49b475efc\n0x9eae547e8843399afc15b4a676de9155796b3cf5\n0xa2482ccff8432ee68b9a26a30fcdd2782bd81bed\n\nAnd these I have not checked yet:\n0xa9d4be962d5e2b2331125d423fad76b1021d301f\n0x9380a66619b5f6ca17629054bfceda879db4268c\n0x00000000000017c75025d397b91d284bbe8fc7f2\n0x2720c9c7b4766a13bb6704714b2791f5a441cd52\n0x87c3c6b9c917b1732f13d36d6938e4f8802f7c7e\n0xf8a4d3a0b5859a24cd1320ba014ab17f623612e2\n0x5a7edfc698359f2311c6f3f9034a627afa4e49d0\n0x0957b9891929da206de76f5ca13c591cdd37d310\n0x2cb3c989d47a87a2bf1a49b9868b1ea533570e2c\n0x03d37ad26961d79e52c3daea840c0095fb4729a7",
        "created_at": "2021-02-19T16:01:52.923000+00:00",
        "attachments": null
    },
    {
        "author": "s1na",
        "category": "general",
        "parent": "",
        "content": "(these are contracts executing DIFFICULTY within the last 3 weeks of mainnet activity, I have a similar list for BLOCKHASH)",
        "created_at": "2021-02-19T16:08:20.677000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Actually, DIFFICULTY should not be a big problem as we may replace the return value with the randao and even rename DIFFICULTY to RANDAO/RANDOM",
        "created_at": "2021-02-19T16:11:02.801000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "In case you are wondering here is a typical \"randomness\" code:\n```\n    function _rand() private view returns (uint256) {\n        uint256 seed = uint256(keccak256(abi.encodePacked(\n            block.timestamp + block.difficulty +\n            ((uint256(keccak256(abi.encodePacked(block.coinbase)))) / (now)) +\n            block.gaslimit + \n            ((uint256(keccak256(abi.encodePacked(msg.sender)))) / (now)) +\n            block.number\n        )));\n\n        return seed.sub(seed.div(tokenIdPointer).mul(tokenIdPointer));\n    }\n```",
        "created_at": "2021-02-19T16:11:57.406000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "This would not be affected by keeping difficulty as randao.",
        "created_at": "2021-02-19T16:12:41.104000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "there will be an overflow in some cases which is fine I suppose",
        "created_at": "2021-02-19T16:13:19.753000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "I don't think whoever wrote this cares about real randomess.",
        "created_at": "2021-02-19T16:13:36.202000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "sure",
        "created_at": "2021-02-19T16:13:52.651000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "One thing I don't get why there are any concerns about blockhash. Why doesn't it just become the ssz hash of `ExecutableData`?",
        "created_at": "2021-02-19T16:15:43.789000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "The \"concern\" is that people are using blockhash for random number generation.",
        "created_at": "2021-02-19T16:16:12.987000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Which I don't think we should care about.",
        "created_at": "2021-02-19T16:16:22.613000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Well ssz hash is not less random than rlp hash, right? ðŸ™‚",
        "created_at": "2021-02-19T16:16:28.262000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "and since PoW is gone the strength of this randomness is reduced",
        "created_at": "2021-02-19T16:16:45.863000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "It is trivially/cheaply manipulable by block proposers in PoS.",
        "created_at": "2021-02-19T16:17:03.498000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Well, one could include the randao value as a field in `ExecutableData` to improve that?",
        "created_at": "2021-02-19T16:17:24.040000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "In PoW it is costly to manipulate it (though, not that costly).",
        "created_at": "2021-02-19T16:17:26.778000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I don't think this would help.  You can just grind out many blocks until you get the result you want.",
        "created_at": "2021-02-19T16:17:49.279000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "yep, but you may change say `coinbase` or even pre generate blocks with 10 coinbases and pick whatever you need",
        "created_at": "2021-02-19T16:17:55.410000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Or include different transactions.",
        "created_at": "2021-02-19T16:18:09.542000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Or extradata (assuming that is retained).",
        "created_at": "2021-02-19T16:18:18.116000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Well you can do that same currently.",
        "created_at": "2021-02-19T16:18:23.780000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Yes, but currently every time you do that you lose a bit of money.",
        "created_at": "2021-02-19T16:18:32.407000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Mix up transactions, add trailing transaction, change extradata, etc.",
        "created_at": "2021-02-19T16:18:35.820000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "you will have to recompute the Ethash currently",
        "created_at": "2021-02-19T16:18:40.373000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "In *theory* today (under PoW) you can ensure that your system never has more money at stake than the loss to a miner who accepts an uncling.",
        "created_at": "2021-02-19T16:18:50.224000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Isn't the extradata close to the tail of the block rlp?",
        "created_at": "2021-02-19T16:19:03.870000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I don't know that anyone actually does that.",
        "created_at": "2021-02-19T16:19:07.601000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "You have to come up with a new nonce under PoW.",
        "created_at": "2021-02-19T16:19:17.401000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Which means after you find a block, you have to throw it away and then start looking for *another* block.",
        "created_at": "2021-02-19T16:19:30.143000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Each block you find is one \"die roll\".",
        "created_at": "2021-02-19T16:19:48.077000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Under PoS you can roll 1000s of dice per second and pick the die that you like.",
        "created_at": "2021-02-19T16:20:01.701000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "I forgot the nonce is the beginning and the extradata at the end.",
        "created_at": "2021-02-19T16:20:17.812000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "I was practically talking about the optimisation asicboost did in bitcoin.",
        "created_at": "2021-02-19T16:20:29.567000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "It doesn't matter where they are in the block, what matters is that you have to *search* for a new nonce after *any* change in the blockheader.",
        "created_at": "2021-02-19T16:20:50.757000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "The benefits of changing data at the end instead of the beginning is epsilon compared to the cost of finding a new valid nonce.",
        "created_at": "2021-02-19T16:21:15.672000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "It does matter, as you can do most of the hashing prior to iterating on changes if both of them are at the tail of the data you would hash.",
        "created_at": "2021-02-19T16:21:20.710000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Ah, I see what you are say.  Yeah, I suppose that would be true if nonce was at the end.  ðŸ™‚",
        "created_at": "2021-02-19T16:21:52.293000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Oh, that's really interesting",
        "created_at": "2021-02-19T16:21:52.933000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Luckily (or perhaps on purpose) for us, it isn't.  ðŸ˜„",
        "created_at": "2021-02-19T16:21:57.168000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "So isn't the real question if anyone uses this for randomness outside of lottery/ponzi schemes? ðŸ™‚",
        "created_at": "2021-02-19T16:23:04.224000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "And whether anyone cares about breaking those.",
        "created_at": "2021-02-19T16:23:15.984000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Yes, that's the one. How bad is to break randomness and the other one is how bad is to break block header verification",
        "created_at": "2021-02-19T16:25:22.422000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "I think fuel does some partial block verification, but I'm not 100% certain: https://github.com/FuelLabs/fuel/tree/master/src",
        "created_at": "2021-02-19T16:25:56.027000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Wait, is solving a puzzle related to hashing a block? How can one optimise finding a nonce by rehashing only a part of a block? What am I missing?",
        "created_at": "2021-02-19T16:26:03.590000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Lets say your want the hash of `difficulty_bits || data || extradata || nonce` to have  `difficulty_bits` number of leading zeroes. Let also say that `data` is 99% of the data you will hash.\n\nIn this case you hash everything up to extradata, and keep the hash state around.\n\nThen you start the challenge of changing extradata/nonce to find a resulting hash. However you are not hashing everything every single time, rather just start from your hash state and only supply the short bytes (like 32 bytes) consisting of `data || nonce`.\n\nYou are saving \u003e99% of time spent on hashing. This is what asciboost did for bitcoin.",
        "created_at": "2021-02-19T16:28:22.061000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "But it doesn't relate to the nonce computation itself, right?",
        "created_at": "2021-02-19T16:32:07.278000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "I mean that rehashing a block should be cheaper than finding a nonce. This optimisation makes it even more cheap but it doesn't affect the speed of finding the nonce.",
        "created_at": "2021-02-19T16:37:00.223000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "It leverages the fact that the chosen hashing algorithm iterates over the bytes of input data front to back.  It doesn't ever have to look at old/previous bytes.",
        "created_at": "2021-02-19T16:39:02.994000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "This property is what makes it possible to hash datasets that are terabytes large.",
        "created_at": "2021-02-19T16:39:26.261000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Given a terabyte input, if you hash the whole thing and retain intermediate states, you can change the last byte or add one more byte to the input data and \"rehash\" everything for very cheap.",
        "created_at": "2021-02-19T16:40:34.082000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "yep, this is understood and it seems like I get the point",
        "created_at": "2021-02-19T16:43:23.286000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "You still have to find a new nonce, but you can do it *way* faster if the nonce is at the end.",
        "created_at": "2021-02-19T16:44:32.135000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "general",
        "parent": "",
        "content": "Naive question: Will/does eth2 have anything conceptually equivalent to uncle blocks/uncle rewards?  If so, could this be used during the transition to award miners for continuing to mine empty blocks for a bit after the transition (as discussed on the ACD call)?  Having the communication channel for the PoS to see those blocks might not be worth it though.",
        "created_at": "2021-02-19T21:07:13.934000+00:00",
        "attachments": null
    }
]