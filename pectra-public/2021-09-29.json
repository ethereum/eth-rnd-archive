[
    {
        "author": "paulhauner",
        "category": "general",
        "parent": "",
        "content": "\u003c@!425572898787426305\u003e \u003c@!291925846556540928\u003e here's a clearer description of the question I was trying to ask: https://github.com/ethereum/consensus-specs/issues/2636",
        "created_at": "2021-09-29T00:03:58.170000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "My understanding of the spec (which very much can be wrong) is that point number 3 in that issue applies: I think it can return PoS blocks and probably a change of name is useful.",
        "created_at": "2021-09-29T00:35:09.156000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "Ah, I see! you're right. see issue",
        "created_at": "2021-09-29T01:06:40.717000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "ah, maybe potuz is right",
        "created_at": "2021-09-29T01:06:59.670000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "haa",
        "created_at": "2021-09-29T01:07:00.293000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "okay, so this code is only called if there has not yet been an execution payload",
        "created_at": "2021-09-29T01:07:57.464000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "and you are construction the merge block",
        "created_at": "2021-09-29T01:08:01.021000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "general",
        "parent": "",
        "content": "i think you need to always skip past the PoS blocks, back to the terminal PoW block. otherwise you're restricting the ability for the beacon chain to have multiple merge blocks",
        "created_at": "2021-09-29T01:08:41.568000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "so the pow chain is simple to retrieve with the known condition that addiotnal blocks aren't imported past the  termianl condition on the pow side",
        "created_at": "2021-09-29T01:08:43.535000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "and all that exists on that side is the pow chain at this point in spec so I'd probably say it's totally fine *spec'd* as is. You might consider race conditions here between the two layers and be able to do a few reverse lookups",
        "created_at": "2021-09-29T01:10:23.919000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "but I don't know if that is really needed",
        "created_at": "2021-09-29T01:10:30.809000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "general",
        "parent": "",
        "content": "There's a case where a consensus node is connected to an execution node that has PoS blocks applied to it, but it doesn't agree with the corresponding `BeaconBlocks`, so it needs to go back past those PoS blocks to find the terminal PoW block.",
        "created_at": "2021-09-29T01:12:04.940000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "I'm not sure such a case exists",
        "created_at": "2021-09-29T01:13:05.937000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "thinking..",
        "created_at": "2021-09-29T01:13:28.542000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "general",
        "parent": "",
        "content": "oh yeah, assuming a 1-1 of consensus\u003c\u003eexecution?",
        "created_at": "2021-09-29T01:13:29.779000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "general",
        "parent": "",
        "content": "if an execution node has multiple consensus nodes talking to it, then my scenario is possible",
        "created_at": "2021-09-29T01:14:10.497000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "right",
        "created_at": "2021-09-29T01:14:39.729000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "general",
        "parent": "",
        "content": "i think it might also be possible with a 1-1, if the head on the consensus node changes. it might agree with the existing `BeaconBlock` but just decide not to build on that chain",
        "created_at": "2021-09-29T01:15:08.890000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "yeah, you're right on that account as well. It is very unlikely but a beacon block having a valid execution merge  trigger payload  does not take over the fork choice so attestations could in some degenerate case not lead to that head",
        "created_at": "2021-09-29T01:16:09.580000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "so the spec doesn't need the loop if you assume you can get `pow_chain` and just get the latest block",
        "created_at": "2021-09-29T01:16:50.494000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "but getting `pow_chain` isn't actually something directly supported",
        "created_at": "2021-09-29T01:17:00.076000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "and TTD doesn't grow with POS blocks (diff set to `0`) so the loop/recursion does work as specified if you replace `pow_chain` with `chain`",
        "created_at": "2021-09-29T01:18:33.107000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "but then your question remains -- what's a safe bound.",
        "created_at": "2021-09-29T01:18:41.912000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "general",
        "parent": "",
        "content": "i guess we don't *necessarily* have to have a safe bound",
        "created_at": "2021-09-29T01:19:17.595000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "general",
        "parent": "",
        "content": "understanding clearly what the bound is (if any) is a step forward",
        "created_at": "2021-09-29T01:19:37.558000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "general",
        "parent": "",
        "content": "if we're adding methods to execution nodes, perhaps a getter for the hash of the terminal block is an option",
        "created_at": "2021-09-29T01:20:20.526000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "heh as long as there isn't anything finalized, you could technically revert to a block that had not done the transition and need to build",
        "created_at": "2021-09-29T01:20:33.980000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "ahhhh",
        "created_at": "2021-09-29T01:20:35.490000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "but such a revert would require a fork-choice change",
        "created_at": "2021-09-29T01:20:42.403000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "which would lead to the `pow_chain` object being sound wrt what you want",
        "created_at": "2021-09-29T01:20:59.696000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "general",
        "parent": "",
        "content": "why is this? do you mean a change to the spec?",
        "created_at": "2021-09-29T01:21:24.895000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "this only works on a 1:1 consensus to execution\n\nbut then, I'm not sure what the fork choice does when you have a many to one relationship here.",
        "created_at": "2021-09-29T01:21:40.829000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "no, I mean if you re-orged on the beacon chain, you would have to signal the re-org  to the execution-client. Once a transition block has happened, th execution-layer defers its fork choice to the beacon node",
        "created_at": "2021-09-29T01:22:32.815000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "and the only way you'd have seen blocks that the execution-layer thinks are transition blocks in teh canonical chain but then you are building a new transition block, this would ahve to be handled with a re-org",
        "created_at": "2021-09-29T01:23:25.994000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "*but* this might bring up an unspecified edge case!",
        "created_at": "2021-09-29T01:23:43.653000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "how does the beacon node signal a re-org to the execution-layer if the re-org is to a pre-transition beacon chain",
        "created_at": "2021-09-29T01:24:06.242000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "general",
        "parent": "",
        "content": "i guess it's the 0x00..00 block hash?",
        "created_at": "2021-09-29T01:24:29.496000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "and in such a case, the execution-layer reverts to TD pow fork choice (still with the MUST NOT import beyond TTD blocks)",
        "created_at": "2021-09-29T01:24:46.981000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "without any PoS blocks on top",
        "created_at": "2021-09-29T01:24:54.183000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "this is probably the appropriate behavior but is not currently specified",
        "created_at": "2021-09-29T01:25:13.459000+00:00",
        "attachments": null
    },
    {
        "author": "paulhauner",
        "category": "general",
        "parent": "",
        "content": "flip-flop",
        "created_at": "2021-09-29T01:25:37.271000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "terribly unlikely in practice. but needs to make it in the spec",
        "created_at": "2021-09-29T01:26:06.420000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "if we didn't specify, I would suspect we get 20 (4*5) different behaviors",
        "created_at": "2021-09-29T01:26:34.197000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "quick notes here -- https://github.com/ethereum/consensus-specs/issues/2636#issuecomment-929748031\n\n7:30 and I'm supposed to be cooking dinner. will check back in tomorrow. thanks \u003c@!361447803194441738\u003e !",
        "created_at": "2021-09-29T01:30:52.734000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Great finding guys! I've put a comment to the issue",
        "created_at": "2021-09-29T08:28:30.965000+00:00",
        "attachments": null
    },
    {
        "author": "sma4321",
        "category": "general",
        "parent": "",
        "content": "is it easier to say that the block that crosses the merge threshold must contain zero transactions?",
        "created_at": "2021-09-29T13:25:17.851000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "What an empty block could ease with respect to the transition process?",
        "created_at": "2021-09-29T13:29:40.317000+00:00",
        "attachments": null
    }
]