[
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It is known *at least* one block in advance to *at least* one party.  It may be known many blocks in advance to one or more parties.  The further in the future it is used, the less likely someone is to know what it is in advance.",
        "created_at": "2022-07-12T07:56:34.121000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Also, if you are using RANDAO for *block* x, a block producer can choose to forgo block transaction fees and effectively they get one free \"reroll\" of the RANDAO.",
        "created_at": "2022-07-12T07:57:09.622000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Oh, and also I don't remember what we settled on for how to deal with missing blocks (whether we take next or previous slot), but that strongly influences the ability for a block producer to \"pick\" the result.",
        "created_at": "2022-07-12T07:58:16.724000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If you want to use it for a gambling game, you need to be very careful with how you design it and likely need to cap rewards to some extent so rewards from the game cannot exceed rewards from block building.",
        "created_at": "2022-07-12T07:58:54.027000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "An ideal solution if you want a random game is to use a VDF seeded with RANDAO.  The VDF just needs to be hard enough that the block producer cannot finish executing it from the time they know the RANDAO for their block and when their block needs to be published.",
        "created_at": "2022-07-12T08:00:00.841000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Depending on your game, you may want to have a VDF that takes at least an hour to compute if there is a large pot of money at stake (e.g., large lottery).",
        "created_at": "2022-07-12T08:00:25.909000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We take the next block because you never know what's the next value is unless colluded with the proposer of the next slot",
        "created_at": "2022-07-12T08:06:43.560000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "`PREVRANDAO` return value can be unpredictable if a slot you use to obtain randomness is far enough into the future, but it always biasable. You may get more details by reading Security Considerations section of EIP-4399: https://eips.ethereum.org/EIPS/eip-4399#security-considerations",
        "created_at": "2022-07-12T08:09:17.371000+00:00",
        "attachments": null
    },
    {
        "author": "sma4321",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "is there anything stopping clients activating bellatrix at different times? so the merge client comms are \"TTD-set EL and a post-goerli CL\"",
        "created_at": "2022-07-12T17:22:03.118000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "if clients activate bellatrix at different times they will be on different, incompatible forks",
        "created_at": "2022-07-12T17:35:12.719000+00:00",
        "attachments": null
    },
    {
        "author": "tokey1475",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "re: https://discord.com/channels/595666850260713488/745077610685661265/996461060309647420 - Has anyone put forward a realistic scenario where someone has the power to double hashrate and premature TTD is the attack vector we need to worry about?",
        "created_at": "2022-07-12T20:01:28.514000+00:00",
        "attachments": null
    },
    {
        "author": "tokey1475",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Seems like we are chasing ghosts with this one",
        "created_at": "2022-07-12T20:01:35.712000+00:00",
        "attachments": null
    },
    {
        "author": "dirigible6945",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Sounds almost like a positive since we are so concerned about hashrate declining...",
        "created_at": "2022-07-12T20:02:14.789000+00:00",
        "attachments": null
    },
    {
        "author": "dirigible6945",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I understand the argument in theory about a state level actor, it just seems to be more theoretical than actual",
        "created_at": "2022-07-12T20:02:59.852000+00:00",
        "attachments": null
    },
    {
        "author": "tokey1475",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "User error due to overcomplicating the merge seems orders of magnitude more likely",
        "created_at": "2022-07-12T20:03:09.496000+00:00",
        "attachments": null
    },
    {
        "author": "dirigible6945",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It seems reasonable to coordinate a single release and if you detect a clear and obvious upsurge in hashrate then you mobilize to protect the network?",
        "created_at": "2022-07-12T20:04:44.827000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If we go w/ single release then I think we need to address Micah's concern about this being the first time we approve a fork w/ a known attack vector and so should have a framework in place for formally deciding on if the trade-offs are worth it.",
        "created_at": "2022-07-12T20:18:35.964000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e the attack vector is similar to the current known PoW attack vector â€” adversary has somewhere between 50% to 100% of the current online hash power (depending on fork spacing) and can attack the chain\n\nthey can do one of two things in these instance â€” 51% attack and re-org, or induce an liveness failure before the merge that is *noticeable* in advance if looking at the difficulty of the chain\n\nSo one attack can be done hidden and likely more damage (the existing ongoing threat in PoW)\n\nThe other attack canâ€™t practically be pulled off (money/resources aside) without us knowing 1 week in advance for this discrete event which has an override mechanism\n\nI just donâ€™t buy that we are increasing the threat model *at all*",
        "created_at": "2022-07-12T20:23:53.657000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "thats fair and I think a strong counter-argument.",
        "created_at": "2022-07-12T20:56:09.034000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I added a third option to the doc to basically use a TTD override like we did for Ropsten",
        "created_at": "2022-07-12T21:13:08.109000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think that might be worth considering, because we can avoid hitting this issue at all, and also share ahead of time what command users will have to run, and when the actual TTD will be decided, without waiting on client releases",
        "created_at": "2022-07-12T21:13:40.451000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It _might_ also be the option with the shortest delay between Bellatrix and TTD, because unlike the Single Release, we aren't estimating super far out, and unlike the Dual Release, we aren't waiting on client teams to each put out a release: their TTD override flags can be \"set\" as soon as the high TTD release goes out.",
        "created_at": "2022-07-12T21:14:46.362000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Obviously, this comes at some risk of operator error, which we're obviously OK with in an emergency, but may not want to use as a default.",
        "created_at": "2022-07-12T21:15:12.711000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "To take Micah's side here: all \"state level actor\" arguments are theoretical, until they are practical ðŸ˜…  That said, I generally agree with Danny that this risk can be mitigated because we can see the hashrate climb well in advance which gives us an opportunity to coordinate a solution off-chain",
        "created_at": "2022-07-12T21:17:07.466000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "What would the off-chain solution be?  Would we \"unschedule\" the bellatrix fork?",
        "created_at": "2022-07-12T21:18:09.484000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "TTD override to a higher number could work",
        "created_at": "2022-07-12T21:18:22.641000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "and \"higher\" can either be \"a few weeks out at the new hashrate\" or \"super far away\"",
        "created_at": "2022-07-12T21:18:43.380000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ah right thats what we did for ropsten",
        "created_at": "2022-07-12T21:19:02.404000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yep, and obviously all the delays here would be larger than Ropsten because of the base level of hashrate we start from (and attention levels higher because it's mainnet)",
        "created_at": "2022-07-12T21:19:46.024000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I still think if we go that new route we should pick an obviously incorrect TTD and the clients should ideally contain logic to message at startup that the TTD is a placeholder and needs to be set to a final value for the merge to succeed.",
        "created_at": "2022-07-12T21:22:48.956000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So that means hardcoding a log based on this specific incorrect TTD for both mainnet and Goerli?",
        "created_at": "2022-07-12T21:24:00.888000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "One challenge I can see is that a high Goerli TTD could be a realistic mainnet TTD ðŸ™‚",
        "created_at": "2022-07-12T21:24:43.747000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ya (although doesn't _have_ to be mainnet specific, anytime that TTD is seen it could log that's it's a placeholder TTD)",
        "created_at": "2022-07-12T21:24:49.474000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but we can use a high mainnet TTD for Goerli too",
        "created_at": "2022-07-12T21:24:49.907000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "right, we can just choose a single high fake TTD that works for both mainnet and Goerli, and then even message that in advance too",
        "created_at": "2022-07-12T21:25:13.168000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "(\"this value is wrong, and will also be used as a placehodler for mainnet\")",
        "created_at": "2022-07-12T21:25:23.143000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I kinda like the idea of doing an override using that.",
        "created_at": "2022-07-12T21:25:44.864000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Can also use visual signifiers, e.g. fake TTD is the same number over and over (`999...999`) and real ones end with multiple `000`s. Mainnet's difficulty is 17 digits long, so you can get at least that number of 0s trivially. Goerli increments by 1/2 each time, but at 6-7k blocks per day, you can get. 4 `0`s within a 36h period.",
        "created_at": "2022-07-12T21:27:04.070000+00:00",
        "attachments": null
    },
    {
        "author": "dirigible6945",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Third option is reasonable enough.",
        "created_at": "2022-07-12T21:48:26.649000+00:00",
        "attachments": null
    },
    {
        "author": "dirigible6945",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yes, I don't want to be dismissive of Micah who's arguments are very correct about the possibility. I was weighing the danger of merge failures from poor user understanding as higher than those from the state actors. So an apology to Micah if it came across that way",
        "created_at": "2022-07-12T21:50:29.796000+00:00",
        "attachments": null
    },
    {
        "author": "tokey1475",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "override in an emergency only please, it is a UX disaster.  I know it is simple for those of us that are interacting with these clients on a daily basis, but the command line is greek to many people who are using these clients to stake at home and we should absolutely avoid overburdening them any further.",
        "created_at": "2022-07-12T22:14:28.943000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Right, but people need to use the CLI to pass a JWT token anyways, no?",
        "created_at": "2022-07-12T22:20:12.740000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "(And a bunch of other flags)",
        "created_at": "2022-07-12T22:20:30.388000+00:00",
        "attachments": null
    },
    {
        "author": "tokey1475",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "that is true.  If the final TTD is available when they set their other merge flags I agree it isn't much of a concern.  If they have to go back in as an additional step after the other merge flags are set is where I see the issue.",
        "created_at": "2022-07-12T22:25:46.745000+00:00",
        "attachments": null
    },
    {
        "author": "alexssd7fp",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "+1",
        "created_at": "2022-07-12T22:26:22.833000+00:00",
        "attachments": null
    },
    {
        "author": "alexssd7fp",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That could end with a lot of unprepared nodes",
        "created_at": "2022-07-12T22:27:06.651000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "another (perhaps minor) papercut w/ using the TTD override is knowing when it is safe to **unset** the TTD override -- this came up on a prior testnet where it was ok some time after the merge but i as not a client dev didn't really know if it was or not... so this adds some more uncertainty to the process and i think highlights we should only use the override in emergency situations and not as a first resort",
        "created_at": "2022-07-12T22:42:45.744000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "if we wanted to get around this i'd strongly suggest we need to add another communication point around how to successfully remove the override",
        "created_at": "2022-07-12T22:43:29.466000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Good point yeah. Then perhaps what you could do if you wanted two releases and minimal delays is to target a TTD one week out 24h before Bellatrix hit, and then assuming Bellatrix goes well, have clients put out a release in the 24hs after that so you lose minimal time but also have an easy \"use this version\" upgrade path.",
        "created_at": "2022-07-12T23:02:13.069000+00:00",
        "attachments": null
    }
]