[
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think we should provide the `coinbase` parameter in the consensus API. \n\nNot providing this parameter does give a *weak* security benefit as it does not prevent the outsourcing from happening, some party will be able to fork all the clients to add this option on top of existing API implementations. What do really significantly decreases the incentive to outsource is the proof-of-custody for execution and we should aim for this option long term.\n\nNot adding the `coinbase` param opens an incentive to fork clients by 3rd parties. Which adds a security risk as we don't know who will maintain this forks, how frequent they will be updated and so force. IMO, this risk is more sever than the weak security benefit that we might get from ignoring the `coinbase`.\n\nAll these points have been mentioned above. Just summarizing and sharing a bit of my opinion.",
        "created_at": "2021-08-23T06:51:01.119000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I've added a few sequence diagrams, a couple that illustrates the block processing flow and another couples that shows how consistency checkpoints and recovery after failure may look like.",
        "created_at": "2021-08-23T11:46:54.530000+00:00",
        "attachments": null
    },
    {
        "author": "gregthegreek",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!388751025789468672\u003e is infura going to run the beacon node (consensus) api and execution (eth1) api separately or under the same url?\n\nOther node providers please chime in üôÇ",
        "created_at": "2021-08-23T17:39:41.199000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I don't think the beacon API is meant to be made available to the public.",
        "created_at": "2021-08-23T20:08:13.499000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "IIUC, apps should be integrating with the execution engine API only.  That should have everything an app needs to do app things.",
        "created_at": "2021-08-23T20:10:22.849000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@203220829473996800\u003e will hopefully correct me here.  üòÑ",
        "created_at": "2021-08-23T20:10:37.901000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Greg did mention tooling, that's still useful very useful to have bindings for. Aside from forkchoice and consensus-blocks, the beacon API also contains endpoints to submit data as validator, and read things like the peerstore, so it's not really meant for the browser.",
        "created_at": "2021-08-23T20:12:21.713000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Things like finalization are communicated with the execution layer through this new engine API, so it should be possible to expose the useful parts (as web3 user) through the existing eth1 API / future execution API.",
        "created_at": "2021-08-23T20:14:06.563000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If there are parts of the API that are meant to be public (something Infura might expose) we should split them out to another port I think.",
        "created_at": "2021-08-23T20:14:17.383000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The current finalized checkpoint and head of the chain are the only consensus things a web3 user should really care about, and maybe some participation info to indicate how strong a confirmation is. But these things are already communicated to the engine via new engine api (doc of Mikhail), and could be exposed as new module in the existing JSON RPC to a user",
        "created_at": "2021-08-23T20:16:23.977000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e I think that's a dangerous view TBH",
        "created_at": "2021-08-23T20:16:39.490000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e an app needs to be able to tell how trustworthy the current head is",
        "created_at": "2021-08-23T20:17:01.128000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yea, I just mentioned that, discord-telegram bridge is delayed a bit",
        "created_at": "2021-08-23T20:17:27.161000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e a head that has very few attestations might not be safe",
        "created_at": "2021-08-23T20:17:44.918000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I meant the total weight ofc.",
        "created_at": "2021-08-23T20:17:55.298000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e so I think apps need to become beacon aware. Not sure if routing all that through the Eth1 API is the right way?",
        "created_at": "2021-08-23T20:18:19.454000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hmm, so the idea here is that the consenus clients would only serve an internally facing API, and any externally useful data would get exposed by any attached execution client?",
        "created_at": "2021-08-23T20:18:36.997000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "right, since said execution client syncs that same data anyway, to keep track of its local state",
        "created_at": "2021-08-23T20:19:04.793000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And you'd want the consensus and execution results to be consistent anyway, not out of sync",
        "created_at": "2021-08-23T20:19:23.153000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e this would require passing a lot more data to the execution client than is the plan now though?",
        "created_at": "2021-08-23T20:19:36.096000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "No it does not",
        "created_at": "2021-08-23T20:19:46.813000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e So the execution client is aware of the total weight attesting to the current head?",
        "created_at": "2021-08-23T20:20:10.415000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Finality and head block are already there. Adding a number to the head message to indicate how heavy it is weighted is not difficult",
        "created_at": "2021-08-23T20:20:15.154000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We already have the \"required for validator\" section in the beacon API.  Other calls are useful for \"external\" entities, for whatever definition of external you want to use.",
        "created_at": "2021-08-23T20:20:28.062000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e it's more than a single number IMO",
        "created_at": "2021-08-23T20:20:37.395000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "You want to expose the latest weight of every individual consensus block? We don't even have that in the current beacon API (well, lighthouse has it, in a custom extension)",
        "created_at": "2021-08-23T20:22:04.197000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e for current GHOST you need to do something like this: https://ethresear.ch/t/high-confidence-single-block-confirmations-in-casper-ffg/8909",
        "created_at": "2021-08-23T20:22:06.747000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e https://ethresear.ch/t/high-confidence-single-block-confirmations-in-casper-ffg/8909",
        "created_at": "2021-08-23T20:22:29.018000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e I think we need to expose enough so that an app can make reasonable decisions about a head, otherwise users will get screwed (re @merge_chat_bot: \u003cproto\u003e You want to expose the latest weight of every individual consensus block? We don't even have that in the current beacon API (well, lighthouse has it, in a custom extension))",
        "created_at": "2021-08-23T20:23:24.423000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e what exactly that is may yet be an open research topic? I'm not sure. I think my post may give an idea",
        "created_at": "2021-08-23T20:23:48.956000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e basically, a block can have very high attestations weight (100%) but if its parents have much lower weight, it's still not a safe block",
        "created_at": "2021-08-23T20:24:44.108000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e this needs to be accounted for in whatever consensus API is exposed, whether it's the beacon API or routed through execution",
        "created_at": "2021-08-23T20:25:43.526000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Right, forgot about that, you indeed need to traverse from checkpoint to head, since it doesn't work like total-difficulty",
        "created_at": "2021-08-23T20:25:55.522000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e yup",
        "created_at": "2021-08-23T20:26:06.492000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e and empty slots further complicate the counting",
        "created_at": "2021-08-23T20:28:00.798000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Maybe expose just a list of floats then, looking like `[0.9, 0.74, 0.5, ..., 0.1]`, for latest weight of all blocks leading to the current head? Or do we also want to expose the weight of the alternative forks? If we don't simplify we essentially just dump all weights and re-evaluate forkchoice in the client, which gets large (even though lighthouse already supports it for debugging purposes)",
        "created_at": "2021-08-23T20:28:29.628000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e I don't know if all of these can be boiled down to a single number. Reasonably there may actually be THREE heads to expose:\n1. Finalized head\n2. Safe head (safe under the assumption that a majority of validators will only vote for forkchoice and is synchronized)\n3. Latest head",
        "created_at": "2021-08-23T20:29:51.642000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e I don't know. Even that might not be enough given empty slot, because in the current fc a vote on an empty slot does not vote for that slot being empty, but only for the latest non-empty parent (re @merge_chat_bot: \u003cproto\u003e Maybe expose just a list of floats then, looking like `[0.9, 0.74, 0.5, ..., 0.1]`, for latest weight of all blocks leading to the current head? Or do we also want to expose the weight of the alternative forks? If we don't simplify we essentially just dump all weights and re-evaluate forkchoice in the client, which gets large (even though lighthouse already supports it for debugging purposes))",
        "created_at": "2021-08-23T20:30:42.016000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e so a block that has [1, 1, 0.7, 0.5] is NOT safe if its parent was empty",
        "created_at": "2021-08-23T20:31:28.181000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e in addition you also need to track justification status because a different chain (that is not the heaviest on the fc) might get justified",
        "created_at": "2021-08-23T20:36:42.882000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e i.e. if any of your past epochs has less than 0.33 of the target votes, you are also in danger and should not consider the head safe",
        "created_at": "2021-08-23T20:37:20.603000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "More pragmatic approach for API discussion we were having: assuming we already pass head slot/root, justification checkpoint and finality checkpoint to the execution layer, and that we can represent/sync confirmation weight in some reasonable way, then we have all (I hope) the relevant consensus-related info in the execution layer, and can serve it in a consistent way (w.r.t. the execution-layer blocks/state) to the application-layer. That confirmation data representation needs a proposal and can be merged into the API spec later.",
        "created_at": "2021-08-23T20:42:21.392000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e Counterpoint: This means that the consensus client can't be independently updated from the Execution clients, which will be a huge hassle given that we will be pushing quite a few fork choice updates over the next years",
        "created_at": "2021-08-23T20:43:39.468000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e Can we instead create some pass-through API endpoints or something like that that will be proxied to the consensus client?",
        "created_at": "2021-08-23T20:44:23.191000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Finality and head need to be handled anyway, but the rest can indeed be pass-through (although not like a proxy, I think it's better if the beacon node can push out this info once, and buffer in the execution client, instead of an API request having to do a round-trip through different APIs)",
        "created_at": "2021-08-23T20:45:47.902000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "How frequent do you expect those updates to be? I think if we're aiming for ~2 upgrades per year, then it's safe to assume we upgrade both consensus and execution at the same time. Also, from the user perspective, there's value in updates being bundled.",
        "created_at": "2021-08-23T20:45:51.177000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e I would really hope to avoid that!",
        "created_at": "2021-08-23T20:47:12.165000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e I think getting the two nicely unbundled would be a huge win overall",
        "created_at": "2021-08-23T20:47:50.064000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e the problem is now instead of having 5 eth2 dev teams being synchronized for beacon changes and maybe the same number for evm changes, it will suddenly all 10 or so of them being synchronized on everything. In my experience these things scale exponentially",
        "created_at": "2021-08-23T20:49:28.685000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah, I think in practice the first post-merge upgrade will require both (if we enable withdrawals), so it will be a good test to see how much harder it is",
        "created_at": "2021-08-23T20:50:08.544000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e about 2^5=32 times :)",
        "created_at": "2021-08-23T20:50:32.009000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ideally, it'd be great for the only thing both sides need to agree on is the fork block (and any cross-layer features) but keep everything else pretty independent",
        "created_at": "2021-08-23T20:50:34.146000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e exactly",
        "created_at": "2021-08-23T20:50:46.576000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So you could have, say, the first post-merge fork enable withdrawals, change the fork choice on the beacon chain, and implement a few EIPs on the execution layer. You'd only need to coordinate for withdrawals, but both the EIPs and fork choice would be decided on/implemented like they are today on eth1/eth2",
        "created_at": "2021-08-23T20:51:51.338000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The merge will also be a good test üòÑ",
        "created_at": "2021-08-23T20:52:09.117000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e the problem is that then if any single one of these items is delayed, the whole package may be",
        "created_at": "2021-08-23T20:55:43.066000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e sounds like a pretty terrible world :(",
        "created_at": "2021-08-23T20:56:00.133000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I don't want to spam this channel because this is a bit of a tangent, but on Eth1 we considered shipping EIPs individually to avoid this and in practice what happens is that each upgrades has some \"core things\" (e.g. withdrawals) and delays there will delay the whole thing, but we can be aggressive about cutting non \"core\" things out if they delay everything else.",
        "created_at": "2021-08-23T20:57:15.888000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "There is a pretty high fixed cost to forks (announcements, testing, monitoring, etc.) so we need to also consider that. Maybe consensus/execution forks are the best path, but it may also be the case that they are  so close that delaying a fork by 1-2 months because the other side isn't ready is less worse than shipping 2 forks 2 months apart",
        "created_at": "2021-08-23T20:58:34.888000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e I think the testing and monitoring does not scale (i.e. bundling execution and consensus forks does not lower this). The only thing you are saving on is announcements which seems minor",
        "created_at": "2021-08-23T21:00:09.681000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e It may well be easier to do them not in lockstep because then at each for you can test against an otherwise stable codebase",
        "created_at": "2021-08-23T21:00:41.358000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Well, we'll be doing the first couple in sync so we'll find out what it's like. I suspect we'll try doing separate upgrades at some point as well just based on what changes need to happen.  So once we've done it both ways a couple of times we'll have some actual information about what works best.",
        "created_at": "2021-08-23T21:19:08.847000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e being able to design and test features independently is different from coordinating forks independently",
        "created_at": "2021-08-23T21:47:26.419000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e I think we can heavily have the former even if we coordinate on the latter",
        "created_at": "2021-08-23T21:47:44.781000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e (except for those pesky things like withdrawals which cross layer)",
        "created_at": "2021-08-23T21:47:55.396000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e my question is why? the savings from coordinating only the \"update your client now\" part are marginal",
        "created_at": "2021-08-23T21:48:24.944000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e sure. I just think that practically for the first few that we likely will have coordinated forks due  to the coordinated feature set",
        "created_at": "2021-08-23T21:48:53.703000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e but sharding can be forked without. as can ligh client features, as can a number of things",
        "created_at": "2021-08-23T21:49:08.136000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e whereas the downside is tremendous (every time a side is delayed by a couple of weeks, you need to make the decision to cut it off or delay the *whole* fork)",
        "created_at": "2021-08-23T21:49:11.705000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e Of course where the layers are pierced we will have coordinated forks",
        "created_at": "2021-08-23T21:49:35.071000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e sure, I just presume that the first fork (assuming no emergency fork) will be coordinated so we to get to observe that first",
        "created_at": "2021-08-23T21:49:57.203000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e the reason I am so vocal here is that I fear this API design that is discussed will force synchronisation of all forks",
        "created_at": "2021-08-23T21:49:58.630000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e I think this will make overall Ethereum development 50% slower",
        "created_at": "2021-08-23T21:50:09.125000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e which components of the api being discussed require fork* coupling?",
        "created_at": "2021-08-23T21:50:22.037000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e that apps only communicate with the execution API and have to get all their consensus information from there",
        "created_at": "2021-08-23T21:51:04.268000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e is it ‚Äî  the execution layer needs to know about fork choice info (beyond just justification/finality)",
        "created_at": "2021-08-23T21:51:08.456000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e ah",
        "created_at": "2021-08-23T21:51:14.181000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e yeah, I didn‚Äôt really think that would be the case in my previous imaginings but clearly this is a point to discuss",
        "created_at": "2021-08-23T21:51:32.551000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e For an application developer, I figured web3.beacon would be valuable for some usecases",
        "created_at": "2021-08-23T21:51:52.543000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e exposing just the head is clearly not enough because that may not be safe. But any additional information will be dependent on consensus design",
        "created_at": "2021-08-23T21:52:17.925000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e the separation of concerns is natural but I suppose not 100% backwards compatible with how things are done today",
        "created_at": "2021-08-23T21:52:20.978000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e \u003e exposing just the head is clearly not enough because that may not be safe\nI‚Äôm curious, do application developers often make more sophisticated confirmation decisions?\nObviously an exchange is a primary target for such decisions but not sure about dapp frontends",
        "created_at": "2021-08-23T21:53:07.006000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e exchangs, wallets, etc I suppose",
        "created_at": "2021-08-23T21:53:14.857000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e I think you can't compare the PoW world with PoS though",
        "created_at": "2021-08-23T21:53:44.066000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e a single PoW block has certain properties that a PoS block does not without any attestations",
        "created_at": "2021-08-23T21:54:09.188000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e well, you can compare it! but it‚Äôs certainly different\nIf confirmation information should be utilized more by application developers, my inclinition is to get it from beacon, but I haven‚Äôt thought about it deeply\nIt keeps the *functionality* in the correct layer but makes users of the execution layer have to cross layers",
        "created_at": "2021-08-23T21:54:57.988000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e the other direction moves the functionality of one layer to the other but keeps users comfortable in one layer",
        "created_at": "2021-08-23T21:55:12.333000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e I would want to spend some time designing the type of queries we expect to be standard for developers to want to make about ‚Äúconfirmations‚Äù before deciding the correct direction on the above tradeoff",
        "created_at": "2021-08-23T21:56:05.271000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e A plausible alternative would be that the \"head\" that is exposed by the execution client is the \"safe\" head as determined by my algorithm: https://ethresear.ch/t/high-confidence-single-block-confirmations-in-casper-ffg/8909",
        "created_at": "2021-08-23T21:56:49.799000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e and in addition you can have an \"unsafe\" head that is whatever the fork choice rule currently outputs",
        "created_at": "2021-08-23T21:57:13.381000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e yeah, interesting\nthat becomes just one more piece of info to pass to the execution engine on head/finality updates",
        "created_at": "2021-08-23T21:57:48.270000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e rather thna a complex alg or a pass through",
        "created_at": "2021-08-23T21:57:56.729000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e yes",
        "created_at": "2021-08-23T21:58:05.867000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e web3.eth.head\nweb3.eth.unsafeHead",
        "created_at": "2021-08-23T21:58:09.700000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e what is your confidence level in this or similar algs? (re @dankrad: A plausible alternative would be that the \"head\" that is exposed by the execution client is the \"safe\" head as determined by my algorithm: https://ethresear.ch/t/high-confidence-single-block-confirmations-in-casper-ffg/8909)",
        "created_at": "2021-08-23T21:58:25.811000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e probably need a few numbers in addition to this though",
        "created_at": "2021-08-23T21:58:26.553000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e If I haven't made a mistake, then the head determined by this algorithm is going to be safe as long as:\n - the network is synchronous\n - majority of validators vote according to fork choice rule (re @dannyryan: what is your confidence level in this or similar algs?)",
        "created_at": "2021-08-23T21:59:24.659000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e but before it is implemented it should certainly be examined more",
        "created_at": "2021-08-23T22:00:07.075000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e gotcha, will (re)review",
        "created_at": "2021-08-23T22:04:56.697000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e what do you expect the safe vs unsafe head latency to be under normal operation?",
        "created_at": "2021-08-23T22:05:15.104000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e 4 seconds?",
        "created_at": "2021-08-23T22:05:27.218000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e basically time until attestations are seen",
        "created_at": "2021-08-23T22:05:38.447000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e assuming \u003e80% or so online. They are really only different when significant numbers of attestations are missing",
        "created_at": "2021-08-23T22:06:25.385000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e I see, thanks!",
        "created_at": "2021-08-23T22:07:39.680000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "A common theme for dapps is to send off multiple transactions, such as some token approvals first and then executing a swap (this does not apply to swaps only, but most cases where tokens are involved). Dapps currently can check two things: 1) did the first transaction succeed (as told by the wallet); 2) is the approval valid on the contract (by calling the `allowances` function).\n\n(This problem would be minimized should some of the transaction batching proposals go live, such as \"batched transactions\", \"rich transactions\", eip-3074, etc.)\n\nIf I understand the above discussion correctly, there is more delay for finality compared to what dapp developers assume today, and one way to solve this by exposing consensus details via some RPC methods. I wonder if dapps would actually deal with that, or rather just implement what I mentioned as 2) above (checking the allowances before crafting the second transaction).\n\n(I would assume it is possible that the first transaction was included in some paths, but not in the \"safe head\".)",
        "created_at": "2021-08-23T22:12:36.054000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Exposing a complicated set of RPC methods and expecting dapps to use them properly sounds like a bit of a stretch to be honest. If it is possible, a simplified solution may be nicer to avoid mistakes.",
        "created_at": "2021-08-23T22:15:08.666000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e \u003e If I understand the above discussion correctly, there is more delay for finality compared to what dapp developers assume today,\nyou might actually get *faster* confs under normal operation, but that the decision of ‚Äúsafe‚Äù vs ‚Äúnot safe‚Äù is more complex than counting depth in the chain",
        "created_at": "2021-08-23T22:15:45.389000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e yes. I think we need to apply the Einstein principle \"Make things as simple as possible, but not any simpler\"",
        "created_at": "2021-08-23T22:16:07.293000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e I.e. by all means simplify but whatever we expose needs to be able to support safely written dapps",
        "created_at": "2021-08-23T22:16:35.454000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e maybe finalized/safe/unsafe is that",
        "created_at": "2021-08-23T22:17:00.110000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e heh\nso co-opt web3.eth.head to be ‚Äúsafe‚Äù head by default and expose a method no one would generally use called web3.eth.unsafeHead\nyeah, my gut is that is the least invasive and safest path forward",
        "created_at": "2021-08-23T22:17:24.165000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e in almost all circumstances you can work with finalized/safe but it may be a user decision to work with unsafe (and validate it in some other way)",
        "created_at": "2021-08-23T22:17:42.704000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e default current path remains safe, exceptional path for exeptional scenarios\nAnd new finality path for ultra-safe and to replace 6-conf depth",
        "created_at": "2021-08-23T22:17:51.795000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e sounds reasonable to me",
        "created_at": "2021-08-23T22:18:13.332000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Actually most of the RPC methods accept a block number or the string `latest`. I don't think mayn dapps deal with `web3.eth.head` too much directly, they rather just execute a call on the `latest` block.\n\nIn that sense, perhaps saying `latest` point to the latest safe head, `finalized` points to the latest finalized head, and `unsafehead` points to the unsafe head may be a good direction to consider.",
        "created_at": "2021-08-23T22:26:13.648000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e üëç",
        "created_at": "2021-08-23T22:26:37.350000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Why not just report all current forks with their respective weights? If the network stays running smoothly as is now this would mean just one or two numbers max regularly",
        "created_at": "2021-08-23T23:17:40.265000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e because there is no such thing as a simple \"weight\" anymore",
        "created_at": "2021-08-23T23:22:04.928000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e it's a list of weights of all the parents plus information whether the slot was empty",
        "created_at": "2021-08-23T23:22:30.199000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah but the list of parents is generally minimal. I mean whatever metric the execution engine would report is going to be a view of what it's beacon node is telling. And this later one has a view of the world that allows it to choose among different forks. I think what should be exposed is this view and let the developers decide the degree of safety they want to get. A simplified version of current/safe/finalized head could be an addition. But not exposing the full view of the beacon might lead to \"non-oficial\" implementations of these points",
        "created_at": "2021-08-23T23:27:15.939000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ah right, just looking at the current cache structure of a pyrmont node that's impracticable... It's a huge list of numbers even without any forks",
        "created_at": "2021-08-23T23:43:00.594000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Would a user want to have validator registry numbers? I mean even if head seems safe I wouldn't want to include important transactions if I see thousands of validators being slashed currently",
        "created_at": "2021-08-23T23:56:58.396000+00:00",
        "attachments": null
    }
]