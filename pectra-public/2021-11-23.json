[
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "You can have many execution engines talking to one consensus engine, but you cannot have many consensus engines talking to one execution engine.",
        "created_at": "2021-11-23T04:57:27.756000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "It's also documented in the Engine API spec, https://github.com/ethereum/execution-apis/blob/main/src/engine/specification.md#load-balancing-and-advanced-configurations",
        "created_at": "2021-11-23T05:00:49.387000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "I am not sure if clients have enough granularity to be able to add a subset of methods from another namespace. Why extending a surface area for this interface doesn't feel good to you? Basically, CL utilizes a few methods to grab the head of the chain, a block at a follow distance, and logs. So, effectively the surface won't be extended that much",
        "created_at": "2021-11-23T05:05:19.715000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "If you put the entire `eth_` namespace in the EL\u003c=\u003eCL API then the surface area would be extended a lot, just not *used* very much.",
        "created_at": "2021-11-23T05:10:06.385000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "If all you need is block headers and logs under specific constrained scenarios it *may* make more sense to expose those specifically in the `engine_` namespace, and expose them in a way that exactly aligns with the needs of the CL.",
        "created_at": "2021-11-23T05:11:29.528000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "e.g., provide the ability to get logs for a specific block without getting the block body (if the body isn't needed).",
        "created_at": "2021-11-23T05:11:51.576000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "It would need to change more code on CL as standard libraries like web3j use `eth_` namespace by default, this kind of change would require to add custom endpoints. EL also would need to add custom methods if their semantics stems from original `eth_` calls. Not sure that the result worth complexity in this case",
        "created_at": "2021-11-23T05:19:19.774000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I tend to agree with that analysis, but my resolution to that problem is to just favor the CL connecting to both the internal and the public API endpoints.",
        "created_at": "2021-11-23T05:20:14.260000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "This is the default option. Exposing `eth_` at the same endpoint is an attempt on improving UX by avoiding an extension of \"eth1\" config surface on CL side. If this is insecure in any sense or adds unequal complexity to EL implementations then we should leave two separate endpoints. At the moment, I personally don't see how it could be insecure or too complicated for EL",
        "created_at": "2021-11-23T05:28:12.905000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "It's worth noting that currently EL clients are exposing everything on a single endpoint. That's going to need to change but it does mean they already have to move `engine_` to the new endpoint.",
        "created_at": "2021-11-23T05:30:19.570000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Wat?",
        "created_at": "2021-11-23T05:34:43.445000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "All of them are doing this?  How did that come to pass?  That is absolutely horrible from a security standpoint.",
        "created_at": "2021-11-23T05:35:12.446000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Was this just something like \"we are doing a hackathon and it is easier to add methods to existing endpoint than add an endpoint and we want to be done by tomorrow at noon so whatever\"?",
        "created_at": "2021-11-23T05:35:57.471000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "The spec says that it MUST be exposed on a different port and suggests port numbers, https://github.com/ethereum/execution-apis/blob/main/src/engine/specification.md#underlying-protocol. So, this basically means that implementations don't follow the spec in this regard.",
        "created_at": "2021-11-23T05:40:01.296000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "There's a fair few things that aren't yet following the spec.  kintsugi is meant to require optimistic sync but it isn't implemented yet either from my understanding.",
        "created_at": "2021-11-23T05:51:52.140000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "We've been setting some very tight timelines so it's not particularly surprising there's a lot of TODO items yet.",
        "created_at": "2021-11-23T05:52:11.646000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Why is the HTTP port different from the WebSocket port?",
        "created_at": "2021-11-23T06:10:50.432000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "WebSocket is designed *explicitly* so that it can be used on the same port as an HTTP server.",
        "created_at": "2021-11-23T06:11:10.267000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "`https://endpoint.com` will return a single resource.\n`wss://endpoint.com` will open a websocket.",
        "created_at": "2021-11-23T06:12:02.708000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "good point, I am wondering why it's different for JSON-RPC API ü§î",
        "created_at": "2021-11-23T06:14:01.195000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "It's always been different. No idea why.",
        "created_at": "2021-11-23T06:16:36.450000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "\u003c@!206016661470314496\u003e Felix (whose Discord handle I can never remember) or \u003c@!211091239112671234\u003e would probably know the answer as I believe this was a Geth thing and all of the other clients copied it to encourage users to switch from Geth to their clients.",
        "created_at": "2021-11-23T06:20:08.968000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Could have been an issue with the http server library used by Geth at the time, or perhaps the HTTP server they use doesn't support WS so they had to run two servers side by side (and thus bind to two ports).",
        "created_at": "2021-11-23T06:21:02.355000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "It is possible whatever the original reason was it no longer applies, in which case I would recommend using a single port for both for *new* API endpoints.",
        "created_at": "2021-11-23T06:21:23.366000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "\u003c@!194432762315407360\u003e ‚òùÔ∏è",
        "created_at": "2021-11-23T06:35:53.212000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "looking for input on these two tickets:\nhttps://github.com/ethereum/consensus-specs/issues/2732\nhttps://github.com/ethereum/consensus-specs/issues/2735",
        "created_at": "2021-11-23T06:38:39.645000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "general",
        "parent": "",
        "content": "I think that's it, yes. \u003c@!493136661656502282\u003e helped align that later on, so it's (afaik) possible to run both (or all three - graphql too) on the same port. \n```\n$ geth --dev --http --http.port 8545 --ws --ws.port 8545 2\u003e\u00261 | grep \"enabled\\|started\"\nINFO [11-23|08:44:26.563] WebSocket enabled                        url=ws://127.0.0.1:8545\nINFO [11-23|08:44:26.563] HTTP server started                      endpoint=127.0.0.1:8545 prefix= cors= vhosts=localhost\n```",
        "created_at": "2021-11-23T07:45:21.058000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "general",
        "parent": "",
        "content": "Yes ,we discussed this in greece. The decision was to open the EL on a separate port, and have it be authenticated. I don't 100% recall what form of authentication we decided to go with, possibly JWT?",
        "created_at": "2021-11-23T07:46:47.409000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Why authenticated?  Isn't the direction of the connection one in which something like TLS or local network would be good enough?",
        "created_at": "2021-11-23T07:47:35.171000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I guess the trust relationship needs to go both ways.  ü§î",
        "created_at": "2021-11-23T07:47:59.274000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "general",
        "parent": "",
        "content": "So, ostensibly, the `private` api is never exposed, and geth rpc only binds to localhost. However, if you shodan the internet, you'll find lots of `8545` ports open, with `admin` and `private` rpc namespace exposed. People are fond of copy-pasting insecure examples. Throw everything and the kitchen sink into the commandline and hope that it works. With that in mind, it would be good to make it _really difficult_ to expose the `engine` api in an insecure way",
        "created_at": "2021-11-23T07:49:38.990000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Should the second port be remove from the Engine API spec?",
        "created_at": "2021-11-23T08:30:53.511000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Given that there is only a single expected user of an engine endpoint, it seems to be overkill to have authentication.  I know that there are issues with users misconfiguring things, but requiring authentication in an attempt to allow misconfigured nodes seems like the wrong solution.",
        "created_at": "2021-11-23T08:34:01.635000+00:00",
        "attachments": null
    },
    {
        "author": "0x6c",
        "category": "general",
        "parent": "",
        "content": "will you have to exit to reap \u003e32eth rewards post merge?",
        "created_at": "2021-11-23T15:24:54.740000+00:00",
        "attachments": null
    },
    {
        "author": "0x6c",
        "category": "general",
        "parent": "",
        "content": "maybe this is not defined at the current time?",
        "created_at": "2021-11-23T15:25:04.573000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "Not defined yet \u003c@92308257393086464\u003e as withdrawals will come in the fork after the merge, not the same one.",
        "created_at": "2021-11-23T18:07:29.394000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "general",
        "parent": "",
        "content": "\u003e and logs\n\nthe CL using `eth_getLogs` to get some data is an example of what I'm referring to.  Since the spec doesn't say which logs or what range of logs or anything like that, that means the EL needs to support all possible log queries for all time to satisfy this somewhat hidden requirement, so for example it might suddenly break when EIP-4444 goes live.  If instead there was an explicit `engine_getFooLogs` (I'm not 100% sure what the logs are used for so can't say what \"Foo\" should be) then maybe the logs in question could be explicitly kept even after EIP-4444 is approved).  My point is that the CL having these implicit requirements for the EL eth_ namespace makes it even harder for us to change the behavior of the JSONRPC eth namespace, since now changes are _consensus breaking_ when in the past they were \"just\" DX issues.",
        "created_at": "2021-11-23T18:22:19.783000+00:00",
        "attachments": null
    },
    {
        "author": "yash_staked",
        "category": "general",
        "parent": "",
        "content": "Currently, our operational design is to run one prysm wallet for multiple validators, upto 150 validators;  how would we go about changing this with respect to the merge and execution engine?  Can we run one execution engine per wallet rather than per validator?",
        "created_at": "2021-11-23T19:40:49.949000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e Architecture  is generally\nOne validator client (VC)\nOne beacon node (BN)\nOne execution engine (EE)\nYour \"node\" is the joint effort of the BN and EE\nAs with before you can attach any number of validators to a VC to talk to a node",
        "created_at": "2021-11-23T19:43:01.126000+00:00",
        "attachments": null
    },
    {
        "author": "yash_staked",
        "category": "general",
        "parent": "",
        "content": "hmm... isn't that contradictory to https://discord.com/channels/595666850260713488/692062809701482577/912567504495317012?",
        "created_at": "2021-11-23T19:47:15.383000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "Ah no. I think the above was in regards to sharing an untrusted endpoint",
        "created_at": "2021-11-23T19:48:30.374000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "So using infura for this task will be bricked",
        "created_at": "2021-11-23T19:48:44.662000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "Regardless. My above statement is correct wrt how a staker can consider their mukti-validator setupd",
        "created_at": "2021-11-23T19:49:31.564000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "Sorry for any confusion",
        "created_at": "2021-11-23T19:49:46.308000+00:00",
        "attachments": null
    },
    {
        "author": "yash_staked",
        "category": "general",
        "parent": "",
        "content": "Sorry if I'm misunderstanding, but just to confirm for our setup, this would look like:\nOne prysm validator wallet process managing multiple validators\nOne execution engine per wallet process\nX beacon nodes proportional to number of wallet processes\n\nIs that correct?",
        "created_at": "2021-11-23T19:51:25.852000+00:00",
        "attachments": null
    },
    {
        "author": "yash_staked",
        "category": "general",
        "parent": "",
        "content": "\u003c@!291925846556540928\u003e or someone else?  pre-thanks for the help!  we run at the scale of ~10-100k validators, so tryna make sure we're running with the best recommendations",
        "created_at": "2021-11-23T20:23:29.997000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "VC \u003c\u003e BN \u003c\u003e EE\n\nVC (what you are calling a prysm wallet) can support N validators \nFor every VC, you need a BN and EE",
        "created_at": "2021-11-23T20:33:41.512000+00:00",
        "attachments": null
    },
    {
        "author": "yash_staked",
        "category": "general",
        "parent": "",
        "content": "OK awesome \u003c@!291925846556540928\u003e, that's great to hear!  https://github.com/ethereum/execution-apis/blob/main/src/engine/specification.md#load-balancing-and-advanced-configurations gave a slightly misleading lead, so wanted to confirm; we'll test this of course prior to merge, expect it to work smoothly, but just wanna have a headsup",
        "created_at": "2021-11-23T20:59:25.641000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e The engine API is made for a BN to drive an EE. There isn‚Äôt a notion of what happens when an EE is driven by multiple BNs and so that is undefined. A BN could easily in theory drive multiple EEs",
        "created_at": "2021-11-23T21:20:46.371000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e but all of this is unrelated to the validators",
        "created_at": "2021-11-23T21:20:56.693000+00:00",
        "attachments": null
    }
]