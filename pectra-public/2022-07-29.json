[
    {
        "author": "ryanleeschneider",
        "category": "general",
        "parent": "",
        "content": "Questions around finalization and its relationship w/ the EL, specifically the `finalized` tag: theoretically there can exist an epoch where every slot is empty, right?  For example if every chosen validator was offline (I know rare, but _possible_).  In that case, the new epoch could still be finalized?  In which case even though the beacon chain is progressing normally, the EL `\"finalized\"` tag would remain unchanged?\n\nLikewise, the `\"finalized\"` tag isn't guaranteed to \"move forward\" in epoch-number-of-block sized chunks, right, since epochs contain _slots_ but not every slot contains a _block_?  \n\nPut another way: if the EL (or a DApp developer) treats the CL as a black box, then really the `finalized` tag will progress rather haphazardly, usually in something _close_ to a 32-block increment, but not always.  Is that a correct statement?",
        "created_at": "2022-07-29T14:47:34.942000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "you need to get new attestation information on-chain before you can advance finality",
        "created_at": "2022-07-29T15:07:28.058000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "so if you had an epoch of empty slots then finality would not change",
        "created_at": "2022-07-29T15:07:42.032000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "i am trying to answer the rest of your question but want to double-check what exactly this `finalized` tag refers to and can't find the definition ðŸ˜…",
        "created_at": "2022-07-29T15:15:20.862000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "what i believe will happen is that this `finalized` tag will have the execution block hash of the most recently finalized checkpoint, and these checkpoints are aligned to `SLOTS_PER_EPOCH` slots",
        "created_at": "2022-07-29T15:16:23.108000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "if there are missing intervening slots, you pull forward the most recent data on-chain",
        "created_at": "2022-07-29T15:17:19.868000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "so in that case you could have a non-aligned EL block hash",
        "created_at": "2022-07-29T15:17:32.202000+00:00",
        "attachments": null
    },
    {
        "author": "daniellehrner",
        "category": "general",
        "parent": "",
        "content": "`finalized` in the EL is equal to `finalizedBlockHash` of the latest (successful) call to `engine_forkchoiceUpdatedV1`",
        "created_at": "2022-07-29T15:32:51.527000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "general",
        "parent": "",
        "content": "thanks for the answers!  I was trying to answer some questions ask to me around the finalized tag and realized I wasn't so sure myself :). IMO it's going to be a rather hard thing for dapp developers to fully understand, especially since the CL is otherwise a total black box from the existing JSONRPC API point-of-view.",
        "created_at": "2022-07-29T15:49:44.343000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "`finalized` \"you can assume this wont reorg\"\n`latest` \"this has been 'confirmed' but could reorg\"",
        "created_at": "2022-07-29T15:53:29.222000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "general",
        "parent": "",
        "content": "sorry, I should've been more clear: I've already heard people say things like \"finalized is basically latest minus 32 or 64 blocks\" and explaining how that isn't quite right will be hard.  And we probably don't want developers assuming a nice stable relation like that especially if it affects how their code operates.",
        "created_at": "2022-07-29T16:09:01.143000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "In these contexts, are they functionally/operationally relying on such misunderstandings of finalization, or just a sort of half-pattern-matched trivia?",
        "created_at": "2022-07-29T16:20:02.681000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "general",
        "parent": "",
        "content": "more trivia at the moment, but don't extrapolate any actual trend from my handful of anecdotes ðŸ™‚ But it's definitely the risk of someone somewhere in the ecosystem operationalizing that misunderstanding that partly caused me to raise the discussion here.",
        "created_at": "2022-07-29T17:53:46.652000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "Fair enough, I agree with your concern",
        "created_at": "2022-07-29T18:23:46.686000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Hopefully someone will correct me if I'm wrong, but I think it is slots that are finalized, not blocks.",
        "created_at": "2022-07-29T19:01:57.866000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "When a slot is finalized, every block up to and including the block in that slot is finalized.",
        "created_at": "2022-07-29T19:02:31.948000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "When you ask for the finalized tag from an EL, you are asking for the latest finalized block.",
        "created_at": "2022-07-29T19:02:49.809000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "i this it is most correct to talk about finalized \"checkpoints\" which are a pair (epoch, block_root)",
        "created_at": "2022-07-29T19:39:41.810000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "the block root that is finalized summarizes a (beacon) block which contains an EL block hash",
        "created_at": "2022-07-29T19:41:14.861000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "this is the hash that the `finalized` tag refers to",
        "created_at": "2022-07-29T19:41:26.013000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "general",
        "parent": "",
        "content": "I think an interesting graph for someone to produce would be `latest - finalized` over time, as reported by `eth_getBlockByNumber` on Sepolia and Ropsten (and soon Goerli).  The gap should grow steadily with each block, then suddenly jump closer when a new epoch is finalized, then start drifting apart again.  Since Sepolia is a closed validator set is there any way for us to \"chaos monkey\" the validators to cause the  `2-finality` or even 3- or 4- finality scenarios described in https://eth2book.info/altair/part3/transition/epoch#finalisation ? ðŸ‘¿",
        "created_at": "2022-07-29T20:05:49.596000+00:00",
        "attachments": null
    }
]