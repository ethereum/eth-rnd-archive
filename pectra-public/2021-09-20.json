[
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Crosspost from the \u003c#745077610685661265\u003e :\nHere is the PR to the execution-apis repo that introduces Engine API. Interop edition, https://github.com/ethereum/execution-apis/pull/74",
        "created_at": "2021-09-20T06:04:05.491000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Added a few comments.  Looking good!",
        "created_at": "2021-09-20T07:33:02.426000+00:00",
        "attachments": null
    },
    {
        "author": "holgerd77",
        "category": "general",
        "parent": "",
        "content": "On the networking layer, what would we set the `FORK_NEXT` value from the fork ID to on the Merge (see EIP-2124, https://eips.ethereum.org/EIPS/eip-2124, \"Fork identifier for chain compatibility checks\") if the block number is not known in advance?\n\nI guess for safety reasons and so to differentiate from clients which (for whatever reasons) don't want to perform the merge it makes sense to not leave this as `0` (for unknown)? Would it have side effects if this is instead set to the `TERMINAL_TOTAL_DIFFICULTY` value as some first idea? ðŸ¤”\n\n(if this has already been discussed please let me know)\n\n//cc \u003c@!194432762315407360\u003e",
        "created_at": "2021-09-20T09:25:33.618000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Thanks for raising it! IMO, this should be specified in EIP-3675. We may use first 64 bits of the TTD value as `FORK_NEXT` but I guess it would require an update of this logic across all clients.",
        "created_at": "2021-09-20T10:32:43.433000+00:00",
        "attachments": null
    },
    {
        "author": "holgerd77",
        "category": "general",
        "parent": "",
        "content": "\u003e Thanks for raising it! IMO, this should be specified in EIP-3675. \n\nYes, that'll likely make sense.\n\nHad a short look into our (EthereumJS) code base, for us it would actually not mean any logic code changes. We solely use the `FORK_NEXT` value for comparisons (against the peer `FORK_NEXT` value) and do not apply this as a \"real world\" fork block number in any other context.",
        "created_at": "2021-09-20T10:55:38.119000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "I see. And the `FORK_HASH` should be computed on startup, right? Spec says that concatenation of `uint64(block_number)` values should be used, pure TTD value doesn't fit this computation too",
        "created_at": "2021-09-20T11:19:56.291000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "\u003c@425572898787426305\u003e I may be confused about something.  I thought the issue with https://github.com/ethereum/consensus-specs/issues/2608 is that prior to the merge we need to either change the transaction SSZ encoding, or we need to give legacy transactions a \"type\"?",
        "created_at": "2021-09-20T13:37:32.778000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "It is about future compatible encoding of transaction objects on consensus side, not related to introduction of new types",
        "created_at": "2021-09-20T14:11:29.568000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Well, you need to put *something* in the type slot IIUC, right?",
        "created_at": "2021-09-20T14:15:54.646000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "And that \"something\" should be forward compatible with types eventually used in the execution layer in the future.",
        "created_at": "2021-09-20T14:16:11.115000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "The proposal is to use ids of transaction types as a selector for SSZ Union to encode transaction objects and add a support of transactions that are already supported by the execution layer",
        "created_at": "2021-09-20T14:18:39.948000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Right, but there is no \"type\" for legacy transactions.",
        "created_at": "2021-09-20T14:41:53.343000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "So the consensus layer needs to *make one up*.  I recommend that if the consensus layer is going to make up a type, we should do it right so we don't have to change it later.",
        "created_at": "2021-09-20T14:42:18.383000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "And IMO \"right\" here means two types, one for multi-chain and one for single-chain.",
        "created_at": "2021-09-20T14:42:37.682000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Consensus layer will have to handle `LegacyTransaction` in any case, introducing a couple of new types won't save implementations from handling a special case which `LegacyTransaction` is. Thus, there seem to be no value in introducing extra couple of types of those that already exist",
        "created_at": "2021-09-20T14:44:43.960000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "\u003e Consensus layer will have to handle LegacyTransaction in any case, introducing a couple of new types won't save implementations from handling a special case which LegacyTransaction is. \nNot necessarily.",
        "created_at": "2021-09-20T14:48:08.017000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "We can drop raw legacy transactions from gossip in favor of typed legacy transactions.",
        "created_at": "2021-09-20T14:48:36.737000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "And I think we *should* at some point, we just didn't originally to keep things simple.",
        "created_at": "2021-09-20T14:48:54.874000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "However, we may still do that at some point (I'm a proponent of doing so), and it would really suck if the final solution didn't match what the consensus layer did.",
        "created_at": "2021-09-20T14:49:24.783000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "This is what I meant in the comment by \"Deprecate `LegacyTransaction`\"",
        "created_at": "2021-09-20T14:49:25.639000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Legacy transactions exist in the following places:\n1. the transactions merkle tree whose root is in block header.\n2. the receipts merkle tree whose root is in block header.\n3. execution client gossip protocol.\n4. consensus client gossip protocol (soon).\n5. json-rpc APIs.",
        "created_at": "2021-09-20T14:50:37.113000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "* We can create two new types of transactions (0 and 4) that are just wrapped multi-chain transactions and single-chain transactions.\n* We can continue to use legacy transactions in any of those places without wrapping anywhere except (4).\n* Since (4) *needs* the typed wrapping, we should make choices that can later be applied to (1), (2), (3), and (5) when the time comes to apply wrapping in those locations.",
        "created_at": "2021-09-20T14:52:40.282000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "I still feel like it's pretty big change and that it should be introduced on both layers. It is unlikely to be done prior the Merge",
        "created_at": "2021-09-20T15:08:17.546000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I don't see any other viable option.  You need a transaction type for the SSZ union prior to The Merge.",
        "created_at": "2021-09-20T15:49:31.064000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Unless you think that you can convince the execution client teams to make the change at the same time, and if so, which subset of places would you propose get updated?",
        "created_at": "2021-09-20T15:50:05.313000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "I thought that we can just add a better support of EIP-2718 (including the support of existing `LegacyTransaction`) to the consensus layer and that's it. I don't understand why we need to add more transaction types as a part of this change",
        "created_at": "2021-09-20T17:29:10.220000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "+1, Mirroring the current existing EIP-2718 types, without breaking API or touching execution layer seems best to me. Then there's no confusion about type IDs, as they are exactly the same in both layers. And the conversion back and forth between Union (selector + value) and EIP-2718 (type + payload) is super easy, as it's basically the same (only involves the first byte in the legacy case, no signature/chain-id work)",
        "created_at": "2021-09-20T19:34:01.338000+00:00",
        "attachments": null
    },
    {
        "author": "pengineering",
        "category": "general",
        "parent": "",
        "content": "Apologies if this is the wrong place to ask. Is there any updates regarding \"targets for Merge devnets in October\" from Consensus-layer Call 72? Meeting notes: https://hackmd.io/@benjaminion/S1smzqwzY#Merge-discussion",
        "created_at": "2021-09-20T21:10:51.751000+00:00",
        "attachments": null
    },
    {
        "author": "trent_vanepps",
        "category": "general",
        "parent": "",
        "content": "no public updates yet, but expect more details in october!",
        "created_at": "2021-09-20T21:43:55.380000+00:00",
        "attachments": null
    }
]