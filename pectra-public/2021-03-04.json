[
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e So I have some good news: geth people told me that they made some upgrades over the last ~1.5 years and it's *much* faster to make many storage reads now",
        "created_at": "2021-03-04T12:51:32.609000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e Basically, I don't think there actually are any known DoS blocks that will take more than a couple seconds to process; if there are, it would be some new crazy quadratic EVM bug",
        "created_at": "2021-03-04T12:52:38.697000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cn0ble\u003e These are definitely good news",
        "created_at": "2021-03-04T12:53:05.230000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cdankrad\u003e So this acceleration is not based on caches?",
        "created_at": "2021-03-04T12:53:48.392000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e It is based on a state cache",
        "created_at": "2021-03-04T12:53:57.244000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cdankrad\u003e Because caches are probably easy to game",
        "created_at": "2021-03-04T12:54:00.742000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e Different kind of cache",
        "created_at": "2021-03-04T12:54:09.324000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e Not \"store a few recently used tree nodes\", rather \"store the entire bottom layer of the state, on disk if needed\"",
        "created_at": "2021-03-04T12:54:28.603000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e So you need 1 leveldb access to read the state, instead of O(log(n))",
        "created_at": "2021-03-04T12:54:41.503000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cn0ble\u003e you mean to pre-cache something on purpose to further exploit it? (re @dankrad: Because caches are probably easy to game)",
        "created_at": "2021-03-04T12:54:43.265000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cn0ble\u003e oh, that’s great! then it’s not actually the cache but a kind of database re-org or optimisation (re @vbuterin: Not \"store a few recently used tree nodes\", rather \"store the entire bottom layer of the state, on disk if needed\")",
        "created_at": "2021-03-04T12:56:03.392000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cdankrad\u003e hashmaps instead of trees then, I suppose? (re @vbuterin: So you need 1 leveldb access to read the state, instead of O(log(n)))",
        "created_at": "2021-03-04T12:56:12.865000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e it's... literally a key/value store",
        "created_at": "2021-03-04T12:56:25.486000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e at least that's how I understand it",
        "created_at": "2021-03-04T12:56:44.148000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cn0ble\u003e it should enlarge the storage though",
        "created_at": "2021-03-04T12:57:11.846000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e right, it does, by ~30 GB",
        "created_at": "2021-03-04T12:57:18.296000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e But the tradeoff seems worth it",
        "created_at": "2021-03-04T12:57:37.392000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003casqyzeron\u003e The mid-term goal is to keep using these extra 30GB more and more until we no longer need to store the full tree.",
        "created_at": "2021-03-04T13:14:30.795000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "What about the other clients?",
        "created_at": "2021-03-04T13:16:04.834000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003casqyzeron\u003e @paperun my node has synced up to December 30th last year, so I now have an updated list of contracts using DIFFICULTY and BLOCKHASH https://gist.github.com/gballet/fc53f46d4f8e4db2f37a0b64e9b47962 That is the last update, I need the machine for something else.",
        "created_at": "2021-03-04T13:16:42.695000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cn0ble\u003e what is the size of the tree? (re @asqyzeron: The mid-term goal is to keep using these extra 30GB more and more until we no longer need to store the full tree.)",
        "created_at": "2021-03-04T13:16:53.749000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e 100 GB including that 30, at the moment",
        "created_at": "2021-03-04T13:17:06.126000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e (that's total disk storage for the state in the latest version)",
        "created_at": "2021-03-04T13:17:22.186000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cn0ble\u003e is this for one or multiple versions of the state?",
        "created_at": "2021-03-04T13:19:16.855000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e This is for the current state and a bit of recent history",
        "created_at": "2021-03-04T13:19:34.165000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cn0ble\u003e got it, thanks! a quick thought, caches probably useful in the state root computation at the end of the block, which should not result in spikes of block execution time unless there is inadequate number of slots modified during the execution",
        "created_at": "2021-03-04T13:24:54.576000+00:00",
        "attachments": null
    },
    {
        "author": "mrabino1",
        "category": "general",
        "parent": "",
        "content": "curious, is the current thinking to keep all historic transaction (pre-merge) apart from the merge such that only the state is brought over? if so, how would a user (say in 4 years from now) want to re-verify all of ETH from the ETH1 genesis until that date? are we planning to have the ETH2 client teams make it an option to migrate the history along w/ the state or no? ( I can make the argument for each of those.. )",
        "created_at": "2021-03-04T15:46:08.202000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "\u003e how would a user (say in 4 years from now) want to re-verify all of ETH from the ETH1 genesis until that date?\nI don't think having this functionality is a primary (or necessary) goal.",
        "created_at": "2021-03-04T15:50:27.938000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "The application layer can choose to not prune pre-merge blocks and have logic to rebuild from genesis, but there are certainly technical debt and other trade-offs here",
        "created_at": "2021-03-04T15:51:03.115000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "Yeah, it would become a more specialized task: you could run an old ethereum client to verify the ethpow chain up until the end, then you would run an ethereum client to verify the beacon chain",
        "created_at": "2021-03-04T15:51:15.645000+00:00",
        "attachments": null
    },
    {
        "author": "mrabino1",
        "category": "general",
        "parent": "",
        "content": "under the merge date + 1 month scenario... and a new user now on PoS gets an ETH client, would the idea be that his / her verification from genesis would then be the PoS genesis with one basically massive state block and then all subsequent transactions thereafter?  it is an interesting question to ponder.. as I can also imagine a PoS ETH client having the ability to verify from PoW Genesis (which I suppose would then query a PoW client for all its historic blocks).. but then how would the PoS genesis verification occur? i suppose in such a scneario, both PoW and PoS chains from genesis would be able to be verified....   while not really the focus of the merge per se, I do believe many will want to ensure the powchain is somehow retained forever.. purely relying on then legacy clients (which also for sure will have their maintenance decay) may not be the best plan...  $0.02",
        "created_at": "2021-03-04T16:12:45.947000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "\u003e under the merge date + 1 month scenario... and a new user now on PoS gets an ETH client, would the idea be that his / her verification from genesis would then be the PoS genesis with one basically massive state block and then all subsequent transactions thereafter?",
        "created_at": "2021-03-04T16:13:12.841000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "yes",
        "created_at": "2021-03-04T16:13:14.998000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "I think users will have the ability to verify the pow chain if they want to",
        "created_at": "2021-03-04T16:13:26.353000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "They could just run an eth1 client on it",
        "created_at": "2021-03-04T16:13:31.021000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "And then they would make two consistency checks: (i) the eth2 genesis actually is what the beacon chain deposit contract generated, and (ii) the state root that gets put into the beacon chain actually is the last state root of the eth1 chain",
        "created_at": "2021-03-04T16:14:04.105000+00:00",
        "attachments": null
    },
    {
        "author": "mrabino1",
        "category": "general",
        "parent": "",
        "content": "probably more directed at client teams, but i *really* hope we dont have to p2p share a 100gb state.. rather the hash of it to confirm it is correct locally.",
        "created_at": "2021-03-04T16:18:19.006000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "You can think of the PoS genesis block like a ZK setup ceremony that involved 100s of thousands or millions of people over the course of 6 years.  Anyone who joins *after* PoS needs to trust that there was *at least* **one** honest actor in the set of people who were around for the PoS genesis construction/transition.  Given the popularity of Ethereum at the moment, I don't think this is at all unreasonable of a trust assumption.",
        "created_at": "2021-03-04T16:24:37.540000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e If you validate the PoW chain too, you don't even need that level of trust",
        "created_at": "2021-03-04T16:26:00.316000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e (unless of course someone creates an even higher-hashrate PoW chain long after we stop building ours)",
        "created_at": "2021-03-04T16:26:15.592000+00:00",
        "attachments": null
    },
    {
        "author": "mrabino1",
        "category": "general",
        "parent": "",
        "content": "well I suppose there are really four general options (post-merge).. 1.) use current eth pow clients to have the history 2.) use then eth PoS clients to reference #1      3.) use then PoS client to digest and include #1 in their own db    or 4.) hope someone else has the powchain history...  I personally fall in the #2 and #3 are the ideal methods with pruning options..",
        "created_at": "2021-03-04T16:29:10.783000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cvbuterin\u003e I guess my preferred camp is \"the default behavior should be to run a beacon chain node and a beacon chain node only (the eth1 client would be renamed the \"application state library\" or something like that), and validating the historic PoW chain would be an optional extra for whoever wants it\"",
        "created_at": "2021-03-04T16:30:13.610000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "general",
        "parent": "",
        "content": "\u003cpaperun\u003e excellent, ty (re @asqyzeron: @paperun my node has synced up to December 30th last year, so I now have an updated list of contracts using DIFFICULTY and BLOCKHASH https://gist.github.com/gballet/fc53f46d4f8e4db2f37a0b64e9b47962 That is the last update, I need the machine for something else.)",
        "created_at": "2021-03-04T17:22:55.167000+00:00",
        "attachments": null
    }
]