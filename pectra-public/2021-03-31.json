[
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!425572898787426305\u003e in merge/validator.md, should \n```\n    application_parent_hash = state.application_block_hash\n    return produce_application_payload(state.application_block_hash)\n```\nBe\n```\n    application_parent_hash = state.application_block_hash\n    return produce_application_payload(application_parent_hash)\n```\nOr just remove the local variable?",
        "created_at": "2021-03-31T01:15:02.873000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "well spotted, will fix that!",
        "created_at": "2021-03-31T06:47:38.396000+00:00",
        "attachments": null
    },
    {
        "author": "chat-bridge",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cn0ble\u003e I have made a mistake in the doc. It was supposed to be the NewHead message that switches the fork choice. One caveat here is that NewHead doesn‚Äôt mean that the block specified in it was attested by the majority. And the first PoS block accepted by the majority is where we do want to make a switch from one fork choice rule to the other, right? I don‚Äôt see a way in what these two rules can be combined and switched back and force. (re @vbuterin: so it could cause fork choice divergence for as long as there are no honest proposers)",
        "created_at": "2021-03-31T07:00:01.844000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Merge Implementers Call in ~23 hours\nAgenda has been updated https://github.com/ethereum/pm/issues/290",
        "created_at": "2021-03-31T14:19:32.150000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "one very stupid question, why is message called `NewBlock` when it verifies a block, maybe `VerifyBlock` is a better name? or is it some legacy terminology I'm not aware of?",
        "created_at": "2021-03-31T14:31:47.910000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think that `VerifyBlock` is more suitable for the name of the action that is taken upon receiving a `NewBlock` message. The name was taken from existing gossip terminology. It doesn't affect the name of JSON-RPC method that is exposed by application-layer. Btw, block verification does not cover whole chain of actions that should be done to process this message, it should consist of verification, execution and inserting a block into application chain",
        "created_at": "2021-03-31T14:44:06.092000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ah, gotcha, then is that okay if I try rephrase the description a bit? because it wasn't clear at least to me",
        "created_at": "2021-03-31T14:44:51.397000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "based on your message",
        "created_at": "2021-03-31T14:44:59.251000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yep, go ahead!",
        "created_at": "2021-03-31T15:41:21.615000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "updated, let me know if you think that is a more clear spec... probably MUST/SHOULD as per https://tools.ietf.org/html/rfc2119 are useful here",
        "created_at": "2021-03-31T16:21:49.479000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'll take a look more tomorrow to read it through before the sync up",
        "created_at": "2021-03-31T16:22:12.638000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The `NewBlock` message is also how the eth1 client becomes aware of this block though (e.g. the block body must be in the payload), right?  \n\naside: is there a trick to avoid getting refresh invalidated on hackmd?  I keep trying to add a comment but it gets invalidated",
        "created_at": "2021-03-31T16:30:36.207000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I would not take MUST/SHOULD notation as this is rather a design doc than the spec",
        "created_at": "2021-03-31T16:30:43.226000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Regarding `NewBlock`, right. Regarding hackmd, weird ü§î",
        "created_at": "2021-03-31T17:26:54.451000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I am not opposed to making this doc more spec'y, but that was not the original intention. Looks good to me! thank you üëç",
        "created_at": "2021-03-31T17:28:52.099000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yeah, I'm trying to just make it more clear to myself tbh, especially when skimming through üôÇ thanks",
        "created_at": "2021-03-31T18:03:17.173000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "comments on hackmd just broken in Safari for me btw",
        "created_at": "2021-03-31T18:03:30.561000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ah ya I'm on Safari too, will try in Chrome thanks!",
        "created_at": "2021-03-31T18:31:56.002000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "RE: difficulty.  Since the field needs to stick around to simplify the merge, can we set it to a really high value instead of 1?  That way the total difficulty of any pow-chains that linger after the merge should always be lower than the eth2-proposed chain.",
        "created_at": "2021-03-31T19:36:59.680000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "one thing to consider is overflow on total difficultly calcuations. I'm not immediately sure if issue here but would flag it",
        "created_at": "2021-03-31T19:37:40.426000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Oh the total difficulty is already above 2**64",
        "created_at": "2021-03-31T19:39:16.105000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The latest value is 22695988059822960737221 which is about `1.20 * 2**74`",
        "created_at": "2021-03-31T19:39:35.661000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I guess if set to high it could overflow 2^256?  But I didn't mean anything that high.",
        "created_at": "2021-03-31T19:41:01.268000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah 2**192 seems reasonable",
        "created_at": "2021-03-31T19:41:13.153000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That said, I feel like doing this is a crutch that could hide problems",
        "created_at": "2021-03-31T19:41:39.595000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If a client is comparing PoS chains by total difficulty, then there's the possibility that it would accept a longer PoS chain that loses the LMD GHOST fork choice",
        "created_at": "2021-03-31T19:42:04.925000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Which would imply that that client is actually following the wrong fork choice",
        "created_at": "2021-03-31T19:42:16.733000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ya true, I was thinking it might help with preventing any reorgs back to the pow chain around the reorg window but thinking about it more it does feel like a crutch.",
        "created_at": "2021-03-31T20:32:42.702000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I was originally skeptical of the approach in \u003c@!425572898787426305\u003e's doc where the fork choice just does a hard one-way transition from following TD to following the beacon chain, but I'm seeing the wisdom of it more",
        "created_at": "2021-03-31T20:33:49.488000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "or at least, the main corner case I was really worried about doesn't seem so bad anymore",
        "created_at": "2021-03-31T20:34:00.770000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Basically, if the first beacon chain that includes embedded blocks gets reorged away, it's only a matter of time (actually, 1 honest proposer), until we get another beacon chain with embedded blocks",
        "created_at": "2021-03-31T20:34:30.786000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It's certainly nice and simple, and it may even remove the need for authentication for application \u003c-\u003e beacon comms",
        "created_at": "2021-03-31T20:35:21.978000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "(CC \u003c@!291925846556540928\u003e \u003c@!552133098075193354\u003e )",
        "created_at": "2021-03-31T20:35:44.298000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "submitBlock would _definitely_ not affect the application client fork choice, because by the time that function is called, the application client's fork choice would already just be \"ask the beacon chain client\"",
        "created_at": "2021-03-31T20:36:29.867000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "though I guess there would still be DoS mitigation reasons to authenticate the connection",
        "created_at": "2021-03-31T20:36:55.347000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "we used mTLS for a gRPC connection between RPCdaemon \u0026 tg core, one way to authenticate if you are okay with dealing with certificate authorities",
        "created_at": "2021-03-31T21:04:07.367000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but in most of my use-cases, when, turbo-geth is deployed, we just run both rpc daemon and tg core in the same Docker container and don't make the internal API port public.\n\nI guess, most of the Eth 2 clients are resource-light enough at that point to pull that off.",
        "created_at": "2021-03-31T21:12:04.552000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm still personally strongly in favor of the merge API transport being as light as possible (e.g. HTTP 1.x JSONRPC or REST) or at least being _available_ over lighter transports.  I can already see some interesting infrastructure opportunities available by proxying the merge API between M beacon nodes and N application nodes.",
        "created_at": "2021-03-31T21:26:21.610000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yeah, I mostly want an option to run these APIs on a separate port, so I don't need to invent an auth schema",
        "created_at": "2021-03-31T21:28:50.910000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "doesn't have to be anything more than that",
        "created_at": "2021-03-31T21:29:56.655000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Encoding/decoding performance is not as critical here, since it's only 1 block to insert per 12 seconds, and a rare block proposal to build (and proposal tasks are known, it's not like PoW). I agree that light and isolated is better. I am a fan of keeping it to a simple REST endpoint for portability.",
        "created_at": "2021-03-31T21:32:20.270000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'd vote for isolated, json-rpc, everything JSON encoded (no RLP/other serialization)",
        "created_at": "2021-03-31T21:33:44.445000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "btw how would genesis sync work in that way, when first 11M blocks are POW and the rest is POS?",
        "created_at": "2021-03-31T21:34:16.732000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "you pre-sync your eth1 (application) node?",
        "created_at": "2021-03-31T21:34:29.467000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "also 1 block per 12 second is true when you at the tip of the chain, what about when you are catching up?",
        "created_at": "2021-03-31T21:35:32.858000+00:00",
        "attachments": null
    },
    {
        "author": "mandrigin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "sorry if those questions were already answered in the doc, I didn't finish reading it...",
        "created_at": "2021-03-31T21:35:52.294000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Application layer software (eth1 node) handles sync after beacon tells it a recent head. The doc does discuss a few design options. Check them out then happy to answer questions",
        "created_at": "2021-03-31T21:36:41.891000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think the eth1 block (application payload) should probably be treated as an opaque binary blob by the beacon-chain side.  That is whatever bytes are returned from `AssembleBlock` should be the same bytes passed to `NewBlock`.  I _think_ the beacon node should run `keccak256(this blob)` to get the BlockHash used in the `NewHead` message vs. getting the block hash via some other method, gut yes generally agree that the fields should be minimally encoded (e.g. binary blobs as either base64 or hex or some other simple format that pairs well with whatever transport layer is settled on).",
        "created_at": "2021-03-31T22:32:30.655000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Question: if I understand correctly, the EIP-1559 style \"tips\" (inclusion fees) will go to the `coinbase` in the application block, while the staking reward will go to the block proposer.  Is that correct?  And this \"quick merge\" still doesn't \"unlock\" the staking rewards on the eth1 side, correct?  I'm pretty sure that's generally out of scope for this quick merge but has there been some discussion on how we see that happening?  Maybe some new EIP-2718 transaction type gossiped to the application nodes that allows transfers from eth2 balances into eth1?",
        "created_at": "2021-03-31T22:39:18.529000+00:00",
        "attachments": null
    }
]