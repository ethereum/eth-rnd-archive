[
    {
        "author": "chris2_2_2",
        "category": "general",
        "parent": "",
        "content": "Well miners are all talking about@the merge coming in months so thankfully the msg is out there now.",
        "created_at": "2021-05-21T01:15:52.337000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Can you give more details about your setup?  Geth and consensus client on same machine or different?  If different, how far away from each other are they?  Do you know if you are network bound, disk bound, or CPU bound in the consensus client?  What are the specs on the hosts involved?",
        "created_at": "2021-05-21T01:54:28.428000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "You may take a look at this blog post, https://blog.ethereum.org/2021/05/18/eth_state_problems/\nHere the numbers are: Post-berlin, with snapshots, `25M` gas: `~0.3s`. This is for the worst case that has been discovered so far, originally, this kind of payload took `~70s` for Geth and `~90s` for Parity to be processed with `10M` gas limit. `25M` gas counts max block size that will be available since eip1559 deployed.\n\nResource exhaustion attack vector will become more important after the Merge as time synchrony hence consensus may be affected by such attacks.",
        "created_at": "2021-05-21T05:27:24.238000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "It might not a game changer but after the Merge CPU load coming from execution clients should be less due to absence of PoW verification. Though, transaction pool might be the source of high CPU load at the moment.",
        "created_at": "2021-05-21T05:29:09.512000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "My experience is that verifying incoming transaction messages is the majority of load on an eth1 node.  That's from quite a while back but I'd be surprised if its changed a lot.",
        "created_at": "2021-05-21T05:30:53.149000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "I see. As I remember a big portion of CPU load during block processing was coming from signature verification. I could imagine this part of transaction pool isn't amenable to optimization.",
        "created_at": "2021-05-21T05:37:10.607000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "I am curious now about transaction pool TPS parameter",
        "created_at": "2021-05-21T05:38:17.961000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Yeah, it is almost certainly not the PoW verification that is time consuming.",
        "created_at": "2021-05-21T06:05:32.423000+00:00",
        "attachments": null
    },
    {
        "author": "chris2_2_2",
        "category": "general",
        "parent": "",
        "content": "Are you accounting for mev simulation as well when talking about the delay?",
        "created_at": "2021-05-21T06:26:07.512000+00:00",
        "attachments": null
    },
    {
        "author": "thegoldchef7542",
        "category": "general",
        "parent": "",
        "content": "Perhaps a fresh set of eyes to this problem folks.... I hope Iâ€™m not out of line as this will be my first post in this community, but I just spent the past couple hours reading lots of convo between everyone. You all have valid points. But what if we are over thinking it to a degree that a hack attempt is practical, but not probable.  No system of currency has ever been 100% full proof. Take money for example. People have been counterfeiting it for ages. Or even gold for another example. People have flooded the market with gold plated tungsten bricks. Where there is a will, there will always be a way. The best we can do sometimes is mitigate the risk as best as possible, without putting up such a roadblock that derails the entire idea to the point of abandonment.  Curious to hear legitimate responses to this assessment.",
        "created_at": "2021-05-21T06:47:17.208000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "I think if youâ€™re doing MeV simulation thatâ€™s your problem to optimise and get done in time.",
        "created_at": "2021-05-21T07:54:08.011000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Mev is not an issue here cause that only affects block creation and not validation. Proposers have an extra 8 seconds to do that",
        "created_at": "2021-05-21T10:05:21.196000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "How much time do validators have to validate a block?",
        "created_at": "2021-05-21T10:06:11.264000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Isn't it also around 8 seconds (assuming 4 second network propagation)?",
        "created_at": "2021-05-21T10:06:30.366000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Until 4 seconds in the slot, the actual time depends on when the block arrives",
        "created_at": "2021-05-21T10:06:53.368000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Just waking up here, will send you my specs in a second",
        "created_at": "2021-05-21T10:07:13.198000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "No, if 4 seconds is propagation time then attesters get zero time to attest",
        "created_at": "2021-05-21T10:08:00.110000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Block is produced and broadcasted ideally at 0, and then validators attest at 4",
        "created_at": "2021-05-21T10:08:27.755000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Why do attesters only get 4 seconds to attest?  That feels like a problem given that block propagation time is on the order of several seconds last I heard.",
        "created_at": "2021-05-21T10:08:42.922000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Currently consensus blocks in the vast majority arrive in 500ms",
        "created_at": "2021-05-21T10:09:25.931000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Consensus blocks are tiny and don't require basically any validation right now.",
        "created_at": "2021-05-21T10:09:38.912000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "This doesn't have any execution payload",
        "created_at": "2021-05-21T10:09:48.784000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Exactly",
        "created_at": "2021-05-21T10:09:55.515000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "After The Merge, blocks become much bigger and take *significantly* longer to process (before forwarding on).",
        "created_at": "2021-05-21T10:09:59.183000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "What is the purpose of the 4 second limit?",
        "created_at": "2021-05-21T10:10:25.898000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "And how is the timer counted?",
        "created_at": "2021-05-21T10:10:41.432000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Attestations then need to be further aggregated",
        "created_at": "2021-05-21T10:10:43.945000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "That happens at the 8 seconds mark",
        "created_at": "2021-05-21T10:10:55.661000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "And I do believe that we can tweak that to be something like 6 seconds and keep 8 for aggregation. I tried this on pyrmont a while back as a way to solve the slot 0 problem and it didn't affect me negatively",
        "created_at": "2021-05-21T10:12:07.361000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Whose clock is counting all of this stuff?",
        "created_at": "2021-05-21T10:12:38.476000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Each one",
        "created_at": "2021-05-21T10:13:10.195000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Block processing isn't included in the propagation conditions and it won't be after the merge. If block arrives in 500ms it then will take 300ms in the worst case to further process it for after the merge .",
        "created_at": "2021-05-21T10:13:12.388000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I don't believe this is true, because propagation is significantly slowed down by validation.",
        "created_at": "2021-05-21T10:13:43.386000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Proposer signature is the only thing that is validated before propagating a block. The same is on the Mainnet today where PoW is the only thing that is being validated.",
        "created_at": "2021-05-21T10:14:59.637000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "If I receive a single byte over a gossip network and all I need to do is validate that it is the number `10` before passing it along, I can pass it along effectively instantly and it will propagate across the gossip network very quickly.\n\nIf I receive 1MB of data over a gossip network and I have to do 300ms of processing and many disk lookups to validate it, it will take me some time before I pass it along to my peers.  Such a payload will propagate across the gossip network very slowly (relative to the single byte).",
        "created_at": "2021-05-21T10:15:11.653000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Hmm, I don't think this is true that only PoW is validated?",
        "created_at": "2021-05-21T10:15:29.389000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "But this is true ðŸ™‚",
        "created_at": "2021-05-21T10:15:37.358000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Though, maybe it is?",
        "created_at": "2021-05-21T10:15:38.428000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Even without block processing, the blocks will still be significantly *bigger* (which means slower propagation).",
        "created_at": "2021-05-21T10:15:57.093000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "But still \u003c@301186049323958275\u003e point is valid: if blocks are larger and take longer to travel, validators will have less time to verify them until the 4 seconds mark",
        "created_at": "2021-05-21T10:16:37.700000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "If you are lucky, you get the header and you already have the body in your mempool.  Realistically, you probably are missing *some* things from the body (especially with transactions that never touch the mempool).  I suppose you could propagate the header without the body?",
        "created_at": "2021-05-21T10:18:24.593000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "A block proposer could withhold the body (data availability problem), would that cause problems if we validate the header only?",
        "created_at": "2021-05-21T10:19:01.379000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "There is no sense to propagate header only due to data availability issue you're mentioning",
        "created_at": "2021-05-21T10:21:51.090000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "What bad things would happen if a block proposer proposed a block and withheld the body?",
        "created_at": "2021-05-21T10:22:30.471000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "If we can propagate header only I think we can worry less about the time attesters have.",
        "created_at": "2021-05-21T10:22:52.523000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "If we have to propagate the body, then we probably should increase the 4s to something bigger.",
        "created_at": "2021-05-21T10:23:06.096000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "\u003c@!755590043632140352\u003e do we know what is the average size of beacon block today?",
        "created_at": "2021-05-21T10:25:12.675000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "alright, now with a coffee in my hand: Ryzen 5 3600 6-cores 3.6Ghz. fast NVME (measured 775Mb/s read, 259Mb/s write). 16Gb RAM. bandwidth 140Mbps up, 10Mbps down. This **should** be overkill to validate. Running prysm + geth on the same machine I get 20 bad head votes per day. Running prysm alone and infura as eth1 point I get 2. It is on the lower end on RAM, but I think the culprit was precisely CPU spikes when validation happened around the same time, that's why I brought back this issue here. My guess: single stakers are not following bad head votes largely. Also please notice that bad head votes are not a problem for large stakers. It scales with the number of validators up to a point, but when you are attesting on every slot is independent of number of validators. If you are a single staker then 20 bad votes a day is about 5% of your rewards",
        "created_at": "2021-05-21T10:25:39.191000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "There was an experiment (by StarkWare if I am not mistaken) where they prove that block size doesn't affect propagation time that much. I am trying to find their post now",
        "created_at": "2021-05-21T10:26:04.894000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Is validation for attestation even over the ETH1 block header?",
        "created_at": "2021-05-21T10:28:53.802000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Or is it *just* over the ETH1 block hash?",
        "created_at": "2021-05-21T10:29:01.921000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Here it is, https://ethereum-magicians.org/t/eip-2028-transaction-data-gas-cost-reduction/3280/24",
        "created_at": "2021-05-21T10:32:52.843000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "sorry, I'll be afk next couple of hours",
        "created_at": "2021-05-21T10:33:29.144000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "on the wire I don't know, but it's easy to patch my node to tell me. It's 76 bytes plus the body part which is mostly attestations, and the bitlists can't be compressed much.",
        "created_at": "2021-05-21T10:33:56.130000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "I used to make some estimation of the block size increase a while ago, not sure if it's relevant to the average block size on the beacon chain network that we have today. Numbers in my spreadsheet may be higher than the avg case we have today, because there are 128 attestations, 16 deposits and 16 exits in what is referred as \"regular beacon block\" -- it is definitely higher than the avg case. Avg beacon block on the network today has something about the same size as avg Mainnet block. So, it will be doubled after the merge (at least)\n\nThe spreadsheet:\nhttps://docs.google.com/spreadsheets/d/19Tz4wkPmdseBh023Wq2hBYv8Zk6Nrme6d2JkTkRawLE/edit?usp=sharing",
        "created_at": "2021-05-21T10:38:47.362000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Yeah I remember that spreadsheet linked in your original document for the executable beacon chain. In that proposal you mention between 10%--20% expected increase, but a comment by \u003c@!552133098075193354\u003e mentions that the maximum block size should double after 1559.",
        "created_at": "2021-05-21T10:50:54.092000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Does devp2p gzip on the wire?",
        "created_at": "2021-05-21T11:34:31.595000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Ah, it uses snappy, but it appears they tried to account for that.",
        "created_at": "2021-05-21T11:36:07.669000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Though, they talk about uncompressed size rather than compressed size in that post, which is odd since I believe it is compressed size that matters.",
        "created_at": "2021-05-21T11:36:42.505000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "From what I can conclude, this block ~~compressed~~ uncompressed size is `0.5MB`, https://etherscan.io/block/8157001",
        "created_at": "2021-05-21T12:24:31.916000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "And the post reads the following \"compressed significantly (no more than roughly a factor 2x compression)\". Which makes an estimation on the compressed size at most 250kb.",
        "created_at": "2021-05-21T12:27:15.509000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "Yes worst case blocks post-London will be 2x the current size",
        "created_at": "2021-05-21T14:32:51.221000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Since attestations are small and their validation is much faster, perhaps we could test increasing the threshold for attestation broadcasting and shortening the timing for aggregation",
        "created_at": "2021-05-21T14:43:15.289000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Anyways validators do send their attestations as soon as they finish validating the block",
        "created_at": "2021-05-21T14:43:53.739000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "So this is mostly a guideline more than a protocol enforced rule",
        "created_at": "2021-05-21T14:44:14.524000+00:00",
        "attachments": null
    }
]