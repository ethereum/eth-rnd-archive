[
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "I generated a testnet genesis using `eth2-testnet-genesis` but all my validators are awaiting activation, is there something special I need to do so they are considered active from genesis?",
        "created_at": "2022-01-04T15:51:59.687000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "I'm invoking the cli tool like this: https://github.com/ethereum/hive/blob/78c35897784eff1d21ab224304aa850887fb2739/clients/lighthouse-bn/lighthouse_bn.sh#L16-L27",
        "created_at": "2022-01-04T16:00:31.403000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "is it possible that the keys `eth2-testnet-genesis` is deriving is different than the ones i'm supplying my validators? so the validators don't see the keys I've given them in the state and so they're waiting for them to be activated?",
        "created_at": "2022-01-04T16:08:34.894000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e use zcli to read your genesis state ouput\nhttps://github.com/protolambda/zcli\nand see if the 0th validator in that state is the 0th key taht is awaiting activation",
        "created_at": "2022-01-04T16:10:50.733000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e \u003e but all my validators are awaiting activation, \nIs this the output of your validator client?",
        "created_at": "2022-01-04T16:11:05.514000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e because most VCs in my experience will say ‚Äúawaiting activation‚Äù as a default even if the key *is not* yet in the state",
        "created_at": "2022-01-04T16:11:31.444000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e so  your hypothesis certainly could be valid",
        "created_at": "2022-01-04T16:11:39.853000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "oh cool, i'll check that out - yes it's the output of the VC",
        "created_at": "2022-01-04T16:11:45.355000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "Hello, Erigon team member here, we are writting unit tests doing tests along mergemock and noticed that for some odd reason mergemock in proposing instances just resets the gasLimit up to what started as",
        "created_at": "2022-01-04T20:23:35.588000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "this causes our consensus verification to fail",
        "created_at": "2022-01-04T20:23:50.058000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "after doing some debugging i found that we are supplying a correct GasLimit in GetPayloadV1 but then mergemock sends us a block with a GasLimit which is not in the correct range",
        "created_at": "2022-01-04T20:24:50.556000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "aka. 10000000",
        "created_at": "2022-01-04T20:25:23.282000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "\u003c@!687974325072035882\u003e so erigon is constructing a payload that is retrieved by mergemock via `GetPayloadV1` and then executed via `ExecutePayloadV1`, but the payload you receive to execute is different than what was provided over `GetPayloadV1`?",
        "created_at": "2022-01-04T20:28:45.970000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "yes",
        "created_at": "2022-01-04T20:29:08.326000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "the gasLimit is different",
        "created_at": "2022-01-04T20:29:13.642000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "i have some erigon logs and mergemock logs, which i can show you",
        "created_at": "2022-01-04T20:30:46.981000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "that would help",
        "created_at": "2022-01-04T20:36:30.043000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "mergemock should send back exactly what it received from `GetPayloadV1`: https://github.com/protolambda/mergemock/blob/39e705fb67cf18bd590600877180908787c5cb51/consensus.go#L338-L363",
        "created_at": "2022-01-04T20:37:27.230000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "",
        "created_at": "2022-01-04T20:43:11.499000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "Schermata_2022-01-04_alle_21.43.05.png",
                "content": "046ec406ea643e2dbb4e61458270be9befd79ef1947657061c4570484455c6eb"
            }
        ]
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "`GetPayloadV1` are some logs i made to observe this",
        "created_at": "2022-01-04T20:43:34.368000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "they give the gasLimit of the block about to be sent over",
        "created_at": "2022-01-04T20:43:47.001000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "",
        "created_at": "2022-01-04T20:44:07.468000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "Schermata_2022-01-04_alle_21.44.01.png",
                "content": "5f9a22c8d6c2925b538a5bf88d8f5e066ecf15862ea3a1b0eaa28c1cfdd9a515"
            }
        ]
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "these are the gasLimit that the rpcdaemon receives from the beacon chain",
        "created_at": "2022-01-04T20:44:19.211000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "we never give a block with gasLimit = 1000000",
        "created_at": "2022-01-04T20:46:14.691000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "and yet we receive it",
        "created_at": "2022-01-04T20:46:23.418000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "is the block with the erroneous gas limit one erigon mined or one that came from an external source?",
        "created_at": "2022-01-04T20:49:10.486000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "external source",
        "created_at": "2022-01-04T20:49:24.594000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "it is a normal import with no proposing according to mergemock logs",
        "created_at": "2022-01-04T20:49:37.641000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "so the sequence is erigon proposes a block, then mergemock proposes a block with an invalid limit?",
        "created_at": "2022-01-04T20:50:19.561000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "okay, i just noticed that this happens only when we propose a block with merge mock and after with just EngineExecute directly",
        "created_at": "2022-01-04T20:51:26.029000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "so erigon proposes a block, it gets accepted, it is sent over and it is valid, then when mergemock does not propose but just send a block over, the block sent over has 1000000 of gasLimit",
        "created_at": "2022-01-04T20:52:43.588000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "got it, i think i see the issue",
        "created_at": "2022-01-04T20:53:06.641000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "is it erigon or mergemock?",
        "created_at": "2022-01-04T20:53:58.226000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "this is what i am trying to figure out wheter it is expected and i forgot to read some specsüòÖ",
        "created_at": "2022-01-04T20:55:41.820000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "mergemock seems to be using a constant limit from the spec for the gas limit when adding blocks to the local chain (although I'm not sure how it's successfully inserting the block if it is breaks a consensus rule)",
        "created_at": "2022-01-04T20:55:57.854000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "can you switch to the branch `fix-block-adding`, rebuild mergemock, and try again?",
        "created_at": "2022-01-04T20:56:42.728000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "yes sure üôÇ",
        "created_at": "2022-01-04T20:56:52.313000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "thanks lmk if that resolves the issue",
        "created_at": "2022-01-04T20:57:07.122000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "i think go-ethereum still does consensus checks because of optimistic sync,  so we also do them",
        "created_at": "2022-01-04T20:59:33.301000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "i am not aware why go-ethereum did not stumble into this, maybe it was different back then",
        "created_at": "2022-01-04T20:59:53.803000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "yes that fixes it thank you so much!",
        "created_at": "2022-01-04T21:00:47.685000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "good, i'll merge into master - sorry for the bug!",
        "created_at": "2022-01-04T21:01:16.267000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "do not worry we all make mistakes",
        "created_at": "2022-01-04T21:01:27.278000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "general",
        "parent": "",
        "content": "you can use the beacon-api to find the validator public keys, `/eth/v1/beacon/states/head/validators `. Cross reference that with the public key you are giving to your VC üòÑ",
        "created_at": "2022-01-04T21:29:25.430000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "Thank you \u003c@199561711278227457\u003e! I did find the keys were different and was able to figure out the discrepancy üôÇ",
        "created_at": "2022-01-04T22:47:29.957000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "Main thing I'm stuck on at this point is getting to the merge epoch - I can't get a merge genesis to load in lighthouse and if I start from phase0, it fails in altair because it can't verify sync committee signature",
        "created_at": "2022-01-04T22:49:22.228000+00:00",
        "attachments": null
    }
]