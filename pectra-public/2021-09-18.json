[
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Can we hard-code the fork to be `block_at_specific_timestamp + delta_total_difficulty` where `delta_total_difficulty` is calculated based on the hashpower of the network at `block_at_specific_time`?",
        "created_at": "2021-09-18T04:45:29.447000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Actually, I think that is more or less the current plan, so nevermind.",
        "created_at": "2021-09-18T04:46:14.550000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Missed this.  I think this doesnt allow for elegant handling of cases in which communication ordering is messed up or something failed on execution engine wrt the prepare before the get was called.\n\nI still see value in passing the core params a second time on `get` becuase you have far more options on how to elegantly handle edge cases. E.g. returning an empty but valid payload in the event of a bungled `prepare`",
        "created_at": "2021-09-18T04:47:47.911000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Rather than two client releases, can we release a version of clients that can be launched with a TTD configuration option (which would then be stored so it only needs to be provided once) and configure those clients to halt if they don't have a TTD set by a certain date?",
        "created_at": "2021-09-18T04:51:32.641000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That would at least make it so we don't have to do multiple releases, though it still would require two actions by operators.",
        "created_at": "2021-09-18T04:51:53.164000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think that there should be unification of message inconsistency handling mechanism for all messages. I don't think we should have a specific handling for the case when the corresponding `prepare` has been missed or failed and the `get` with the same parameter set should do its work. Also, if `prepare` has failed or hadn't responded then something wrong is happening with the execution client and there is a probability that subsequent `get` call is gonna fail too. While if `prepare` hasn't been called then this is something wrong with consensus client anyway and it should be investigated.",
        "created_at": "2021-09-18T04:55:52.096000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I was thinking about it. In this critical thing I'd not rely on users ability to make a proper configuration of their nodes. I am sure some of them are experienced and can handle it but not sure about all of them",
        "created_at": "2021-09-18T04:58:23.328000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think clients can be designed to make this easy, and they will fail to launch if it isn't set correctly which will lead to the user investigating.",
        "created_at": "2021-09-18T04:59:07.707000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "There is a very limited valid range of TTDs that can be set, and that range can be coded into the clients so that even a fat finger will cause the client to fail to launch.",
        "created_at": "2021-09-18T04:59:38.183000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I am not sure that we could pick up the right moment in time when processing halts due to absence of TTD in the configuration. What if this moment is too early or too late? In case when it's too late we are facing with the same issue, the client may follow the wrong chain. In case when it's too early it screws up the transition.",
        "created_at": "2021-09-18T05:01:41.419000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That is a problem no matter what we do.",
        "created_at": "2021-09-18T05:02:20.594000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Whether users have to update their client or set a configuration option, if they fail to do that step they will continue following the PoW chain until some trigger coded into the client is reached.",
        "created_at": "2021-09-18T05:03:04.549000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Unless we introduce a backward incompatible consensus rule in execution clients that triggers in a HF prior to the merge (such as when the TTD becomes known).",
        "created_at": "2021-09-18T05:05:23.259000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Oh, what if we have a HF that removes the ice age at the time the TTD is expected to be known, and if a TTD isn't configured by then the client will halt?",
        "created_at": "2021-09-18T05:06:05.102000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And this trigger may hit too late reducing the benefit of hardcoding/configuring TTD. One of the failures we want to prevent is consensus client miscofiguration but with configurable TTD we create a point of failure of the same source on the execution client side",
        "created_at": "2021-09-18T05:06:28.750000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That exact same failure mode exists with a client upgrade requirement.",
        "created_at": "2021-09-18T05:06:47.307000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "There is no functional difference between \"run version 1.2.3\" and \"run version 1.2.2 with config x\".",
        "created_at": "2021-09-18T05:07:03.225000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I don't think so as this is a usual procedure for everyone",
        "created_at": "2021-09-18T05:07:07.799000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Just as someone can fail to set the TTD configuration option, someone can just as easily fail to update their client.",
        "created_at": "2021-09-18T05:07:33.783000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "You could make the argument that \"update your client\" is a more well understood process, but it is not functionally different from \"update your config\" when it comes to how the clients and network behaves.",
        "created_at": "2021-09-18T05:08:01.212000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Also, what if somebody downloads a client in the middle of the transition and misses the information about updating their configs for some reason?",
        "created_at": "2021-09-18T05:08:46.374000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm not opposed to client teams *also* releasing an updated client with TTD baked in.",
        "created_at": "2021-09-18T05:09:13.766000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I just think there is value in making it so doing a full client upgrade isn't required just to change a single constant.",
        "created_at": "2021-09-18T05:09:33.135000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think that TTD should be hardcoded in the client even if it's been overridden as a part of accelerating the Merge mechanism or if it would be a configurable value",
        "created_at": "2021-09-18T05:09:40.053000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So, it means that we will have options here. This is interesting. You may either update your client or update your config?",
        "created_at": "2021-09-18T05:10:15.159000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Is updating the config for big infrastructures easier than updating the client?",
        "created_at": "2021-09-18T05:10:45.461000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Sometimes.  Sometimes updating the client is easier.  Depends on how your infrastructure is setup.",
        "created_at": "2021-09-18T05:11:03.500000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@425572898787426305\u003e Can you put together a sample timeline of what The Merge may look like given each of the current proposals?",
        "created_at": "2021-09-18T05:12:36.896000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "how would removing the ice age halt the client?",
        "created_at": "2021-09-18T05:12:51.384000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm struggling to keep things straight in my head, and I think having timelines would really help me visualize it.",
        "created_at": "2021-09-18T05:12:52.830000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It is a *very* simple backward incompatible change that will result in a network split between the people who are running client version X and those who are not.",
        "created_at": "2021-09-18T05:13:27.051000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Let me try ðŸ™‚",
        "created_at": "2021-09-18T05:13:30.196000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Oh, I see what you mean",
        "created_at": "2021-09-18T05:14:06.886000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "In particular, it would be really helpful if this timeline indicated which pieces have time constraints and what those are.  Like \"the time between X and Y needs to be larger than A and smaller than B because ....\".",
        "created_at": "2021-09-18T05:14:25.131000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We can push back the ice age instead of removing it",
        "created_at": "2021-09-18T05:14:56.804000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "IIUC, in one of the plans the time between client release A and the merge needs to be small because we can only predict TTD so far out.",
        "created_at": "2021-09-18T05:15:00.419000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think this is unnecessary.  The same client that includes this hard fork will presumably include code that will hard-stop the chain if it isn't switched to PoS by TTD.",
        "created_at": "2021-09-18T05:15:44.376000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah, this is true",
        "created_at": "2021-09-18T05:16:47.655000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Execution client release that does the following:\n* Ice age removed on block 1000 (simple backward incompatible change that ensures anyone who doesn't update forks away from mainnet).\n* If TTD is not set by block 1000, halt.\n* If PoS is not used by TTD, halt.",
        "created_at": "2021-09-18T05:17:18.290000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "One thing, we were actually wanted to use difficulty bomb at the transition to put some cost for the desire of continuing the PoW chain",
        "created_at": "2021-09-18T05:19:06.471000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "oh, this in this case it is TTD that has to be removed",
        "created_at": "2021-09-18T05:19:34.891000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Is this anyhow helpful, https://hackmd.io/oos_BeGtS_CYHbZ_g2STCg ?",
        "created_at": "2021-09-18T05:34:49.151000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "You should use https://www.websequencediagrams.com/  ðŸ˜¬",
        "created_at": "2021-09-18T05:36:24.922000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "thanks for the link ðŸ™‚",
        "created_at": "2021-09-18T05:39:04.883000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "What happens in the consensus layer Merge Hard Fork?",
        "created_at": "2021-09-18T05:40:30.901000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This is the working name of an upgrade on the beacon chain currently. It will add placeholders for execution payload and the logic of processing it",
        "created_at": "2021-09-18T05:41:35.573000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "What are the time constraints between each step?",
        "created_at": "2021-09-18T05:42:08.012000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "For example, any reason we can't do the Merge HF today and then the rest in 9 months?",
        "created_at": "2021-09-18T05:42:42.097000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I know I asked this in the call yesterday, but I think it would be valuable to have all time constraints documented somewhere so when we are discussing we can reference it.",
        "created_at": "2021-09-18T05:43:01.234000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I guess the Merge HF should happen in a month after software release as usual. Then a month or two weeks after the Merge HF transition happens",
        "created_at": "2021-09-18T05:43:06.166000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think there is value in documenting *why* those timeframes are reasonable.",
        "created_at": "2021-09-18T05:43:30.124000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "After the merge we have a node consisting of two pieces of software and both pieces should be coherently implemented and tested",
        "created_at": "2021-09-18T05:44:47.553000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "For example, statements like this are useful to document I think:\n* The time between software with Merge HF client release and the Merge HF needs to be long enough to give plenty of time for testing in test networks.\n* The time between Merge HF client release and the transition needs to be as short as possible (given all other constraints) because the Merge HF is the \"code complete\" date for the whole process and at that point all we are waiting on for The Merge is to just \"do all of the steps\" so unnecessary delays should be avoided.",
        "created_at": "2021-09-18T05:45:41.992000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Agreed, will try to prepare something like Merge release procedure",
        "created_at": "2021-09-18T05:48:29.712000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Will need a help from ppl who are familiar with the HF release procedure that we have for the Mainnet",
        "created_at": "2021-09-18T05:49:04.710000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Something that may be worth considering when evaluating all of the various options is which one gets us The Merge quickest.",
        "created_at": "2021-09-18T05:49:45.413000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Also, which one has the lowest complexity.",
        "created_at": "2021-09-18T05:49:51.235000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "In your diagrams, the first one certainly seems like the simplest.  One set of client releases followed by Merge and then Transition.",
        "created_at": "2021-09-18T05:50:20.378000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And which one is more secure",
        "created_at": "2021-09-18T05:50:25.851000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "IIUC, the risk of the first one is that the TTD we pick ends up being significantly further away than we intended, right?",
        "created_at": "2021-09-18T05:51:03.309000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Or the opposite, it hits *before* the Merge HF (unlikely though, someone would need to buy a lot of hardware to make this happen or we should make a huge mistake computing the TTD)",
        "created_at": "2021-09-18T05:52:05.303000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And the remedy from having it set too far would be TTD override setting, so it could be sped up",
        "created_at": "2021-09-18T05:52:44.394000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Though, TTD override would require a follow up release to make it set in stone in the clients' code",
        "created_at": "2021-09-18T05:53:28.479000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think this one is safe to ignore.  It just means that hashpower *increased* leading up to the merge.",
        "created_at": "2021-09-18T06:20:35.864000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I donâ€™t think Iâ€™d ignore any scenario where people could cause chaos around the merge. There are limits to what people what to spend but I definitely donâ€™t think itâ€™s a given hash rate will drop if increasing it would make the merge fail (or appear to fail)",
        "created_at": "2021-09-18T07:15:54.126000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "There simply isn't enough hardware available globally to execute the attack.",
        "created_at": "2021-09-18T07:25:16.720000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ethereum already uses a majority of GPU hardware globally I believe.",
        "created_at": "2021-09-18T07:25:39.573000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And we can tune to require something like 2x hashrate to attack.",
        "created_at": "2021-09-18T07:26:04.074000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If we make the target high enough then yes it will be safe. I was more disagreeing with dismissing it because the hash rate would need to increase. Itâ€™s entirely feasible for the hash rate to increase. How much hardware is required just depends on how much existing hash rate drops off and how much you want it to increase by.",
        "created_at": "2021-09-18T07:51:04.387000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That is quite fair.  I guess what I really meant was \"this is trivially easy to mitigate, so not really a con\".  I agree, we do need to consider it when picking values though.",
        "created_at": "2021-09-18T07:53:55.580000+00:00",
        "attachments": null
    },
    {
        "author": "ryg9705",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Do we know how much it cost the recent attacker to try and attack mainnet with their 550 blocks? I read that the PoW was invalid so was it basically free? How would that have affected the merge?",
        "created_at": "2021-09-18T10:19:43.382000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That only affected Nethermind, as there was a bug in Nethermind's Ethash validator.",
        "created_at": "2021-09-18T10:30:59.318000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "In the case of the merge, it would have potentially broken anyone using Nethermind as their execution client.",
        "created_at": "2021-09-18T10:31:26.168000+00:00",
        "attachments": null
    }
]