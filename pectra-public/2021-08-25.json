[
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Maybe we should not call it \"safe head\" as the level of security would depend on the threshold and \"safe\" might be too strong word here. Or explicitly mention that security level depends on what's at stake - in this case it might be better to use a threshold value instead of any vague identifiers like \"safehead\".",
        "created_at": "2021-08-25T06:48:17.029000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\"suspected head\"?",
        "created_at": "2021-08-25T07:06:31.273000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\"good chance head\"",
        "created_at": "2021-08-25T07:06:51.550000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\"confirmed head\"",
        "created_at": "2021-08-25T09:18:52.580000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e my suggestion is to just call it \"head\" and call the other one \"unsafeHead\"",
        "created_at": "2021-08-25T09:28:29.169000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It is called `latest` right now and there would be a huge amount of work to change that (all dapps use that frequently).",
        "created_at": "2021-08-25T09:33:59.921000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e ok then use that :)",
        "created_at": "2021-08-25T09:34:18.924000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The questions to answer are:\n1. What does `latest` point to after The Merge?\n2. What are the new options added after The Merge?",
        "created_at": "2021-08-25T09:34:24.427000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think this is a pretty simple suggestion ^^",
        "created_at": "2021-08-25T09:34:44.728000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "`latest` would point at the best known canonical chain I assume?",
        "created_at": "2021-08-25T09:34:47.207000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e latest -\u003e safeHead\nAdd unsafeHead, finalizedHead",
        "created_at": "2021-08-25T09:34:58.942000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "How far behind (normally) do we think `safeHead` will be?  When things are healthy.",
        "created_at": "2021-08-25T09:35:15.031000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e In that sense, perhaps saying latest point to the latest safe head, finalized points to the latest finalized head, and unsafehead points to the unsafe head may be a good direction to consider.",
        "created_at": "2021-08-25T09:35:16.355000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e about 4 seconds when a new block appears (re @merge_chat_bot: \u003cMicah\u003e How far behind (normally) do we think `safeHead` will be?  When things are healthy.)",
        "created_at": "2021-08-25T09:35:32.252000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "`unsafe`: The absolute newest block seen, what the client expects will probably become the canonical chain under normal circumstances.\n`latest`: The latest block with 50%+ signatures, where it is quite unlikely to reorg outside an attack.\n`finalized`: The finalized block, clients won't reorg past this without human intervention.",
        "created_at": "2021-08-25T09:37:14.828000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Does that sound right?  I'm a little uncertain what \"safe head\" means exactly.",
        "created_at": "2021-08-25T09:37:26.228000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "There's an effort to rename things so as to make them accurate and avoid possible confusion. Calling `latest` whatever was being called `safehead` above could really lead to someone believing this is what is currently thought as `chainhead` among consensus clients.",
        "created_at": "2021-08-25T10:18:58.380000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e how is that a danger though?",
        "created_at": "2021-08-25T10:20:07.329000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I don't see anything dangerous in this. Just against the philosophy of having clear non-misleading nomenclature",
        "created_at": "2021-08-25T10:20:57.162000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e The point is to have safe behaviour of apps that aren't upgraded in time. If you look at EIP1559, you can see how long it takes to update everything. Not great if in the meantime the default behaviour is unsafe",
        "created_at": "2021-08-25T10:21:20.829000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e what alternative are you suggesting, that is not clear to me (re @merge_chat_bot: \u003cpotuz\u003e I don't see anything dangerous in this. Just against the philosophy of having clear non-misleading nomenclature)",
        "created_at": "2021-08-25T10:21:32.689000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Latest head certainly sounds to me like what my current beacon node thinks is the chainhead. It could be called `credible head` `feasible head` or some variation in tone. Even `safe head` was fine too, if the API call has a parameter to adjust the security level that should indicate that it's not 100% safe",
        "created_at": "2021-08-25T10:24:16.295000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e I'm simply asking where the \"latest\" that current dapps use should point",
        "created_at": "2021-08-25T10:24:49.138000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "`unsafe`, `safe` (alias for `latest` for backward compatibility), `finalized` is my current thinking.",
        "created_at": "2021-08-25T10:25:41.940000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ah I see what you mean. Yeah I have no saying on that. It looks to me that safe head is a good option",
        "created_at": "2021-08-25T10:25:49.787000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e yeah the discussion was only about that :)",
        "created_at": "2021-08-25T10:26:07.871000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I believe that most apps will behave correctly if `latest` is aliased to `safe` rather than `unsafe` because in the common case `safe` will be *close enough* to head that everything will \"just work\".  This is especially true given PoW blocks are irregular and ~13 seconds apart while PoS blocks are regular and 12 seconds apart plus maybe 4 more seconds for signature collection.",
        "created_at": "2021-08-25T10:26:56.920000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Aliasing `latest` to `finalized` will likely result in things breaking because it is too far behind what apps are designed around, and aliasing to `unsafe` puts users at unnecessary risk for incredibly marginal gain in functionality.",
        "created_at": "2021-08-25T10:27:36.022000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "How does the 4 seconds figure appears? A new block arrives essentially right at the beginning of the slot (about 0.2 seconds normally) at 4 seconds max attestations are sent. But only at 8 seconds they are rebroadcasted by aggregators.",
        "created_at": "2021-08-25T10:33:34.678000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So I always assumed that safe head would be the previous slot",
        "created_at": "2021-08-25T10:34:05.034000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "In normal circumstances",
        "created_at": "2021-08-25T10:34:12.955000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e hmm, yes I forgot about aggregation",
        "created_at": "2021-08-25T10:34:23.531000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Except at 8 seconds you can switch",
        "created_at": "2021-08-25T10:34:39.217000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think 8 seconds is still acceptably close to pre-merge definition of `latest`.",
        "created_at": "2021-08-25T10:36:04.089000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Good to know it is actually 8 seconds though.",
        "created_at": "2021-08-25T10:36:11.158000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "`latest` in the PoW network points to the recent head and this head is valid with respect to the consensus rules. If we apply this semantics to the PoS network then `latest` should point to a block with _some_ level of confirmations received, i.e. what we're referring to as a `safe` here.\n\nOTOH, some apps _may_ expect `latest` to return the most recent head, even unconfirmed. This should be considered too. We may change these names entirely to enforce apps to update and start following the new semantics, though, this is additional update step required from apps while we try to reduce these steps where possible and reasonable.\n\nAlso, we should think about `pending` which currently refers to a pending block on top of the `latest` one. Will `pending` in PoS point to a pending block on top of `safe` or `unsafe` head?",
        "created_at": "2021-08-25T10:38:38.729000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e Doesn't any app need to be able to deal with latency anyway?",
        "created_at": "2021-08-25T10:39:36.169000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e Like I simply can't see how a confirmation delay can lead to an app breaking. if that app isn't pretty fundamentally broken already",
        "created_at": "2021-08-25T10:40:06.742000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Correct.  I think making `latest == finalized` would be a long enough delay to cause problem problems though.",
        "created_at": "2021-08-25T10:40:35.178000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I don't think there are apps that will be broken but we should be explicit about this change and let app devs decide what to do",
        "created_at": "2021-08-25T10:41:24.596000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "`latest` confirmed by `2/3` attestations in PoS gives much strong guarantees to apps than the `latest` in PoW does. As in the PoS case this block is very likely to be in the canonical chain eventually.",
        "created_at": "2021-08-25T10:44:48.216000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The question of whether `pending` builds on top of `unsafe` or `safe` or `finalized` is interesting.",
        "created_at": "2021-08-25T10:45:40.684000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "My gut says it should build on top of `unsafe`.  I think the most common case of `pending` is for bots that are trying to predict what a future block will look like so they can plan around it.",
        "created_at": "2021-08-25T10:46:12.773000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yeah, following the same logic it should be built on top of `safe`",
        "created_at": "2021-08-25T10:46:17.025000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I also don't care much about breaking bots (they are much more agile than dapps and can change easily).",
        "created_at": "2021-08-25T10:46:29.058000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "`pending` is meant to be 0-conf explicitly.",
        "created_at": "2021-08-25T10:46:44.252000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That is, the `pending` block should be built exclusively with transactions from the pending pool, not from transactions that have already been included in any mined block.",
        "created_at": "2021-08-25T10:47:13.154000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Currently, `pending` is an ephemeral block on top of `latest` _valid_ block, if we follow this then `pending` should be based on top of `safe` one in PoS. I agree that the semantics of `pending` block in PoS network should be defined with the majority of use cases in mind.",
        "created_at": "2021-08-25T10:49:57.870000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I don't think anyone who actually uses `pending` is using it based on that definition.  üôÇ",
        "created_at": "2021-08-25T10:50:44.238000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Everyone I have seen who uses `pending` is trying to get details about the state of the world *after* the next block is built.",
        "created_at": "2021-08-25T10:51:10.568000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It wouldn't serve that purpose at all if it returned a block built on top of safe head (which is almost certain to look nearly identical to the unsafe block).",
        "created_at": "2021-08-25T10:51:51.078000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This is used by people who are doing fancy stuff with pending pools like frontrunning, backrunning, etc. where you are trying to squeeze your transaction into a specific spot (relative to other transactions).",
        "created_at": "2021-08-25T10:52:45.121000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Then the following seems reasonable to me:\n- `earliest` -\u003e genesis (isn't changed)\n- `finalized` -\u003e the most recent finalized block\n- `safe`/`latest` -\u003e the most recent _confirmed_ block in the canonical chain\n- `unsafe` -\u003e the head of the canonical chain disregarding the number of confirmations\n- `pending` -\u003e pending block built on top of the `unsafe` block",
        "created_at": "2021-08-25T10:56:15.508000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I like those ^",
        "created_at": "2021-08-25T13:42:53.986000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but I will note that pow `latest` doesn't take into account it's re-org probability. and a pow block at 0.1 seconds received might actually have a higher chance of re-org *under normal operation* than a pos block at 0.1 seconds and no attestations",
        "created_at": "2021-08-25T13:44:09.429000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "^ but just food for thought! I think the digest from mikhail is good",
        "created_at": "2021-08-25T13:44:34.953000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think having `latest` alias to `safe` is generally the healthier choice for most apps as well, so people who \"do nothing\" will become safer with PoS, which is a good thing.",
        "created_at": "2021-08-25T13:46:43.494000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "fair",
        "created_at": "2021-08-25T13:48:11.388000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e but a PoW block costs 1000s of US$ to produce which a single PoS block (without any attestations) do not",
        "created_at": "2021-08-25T13:53:35.759000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e right, that‚Äôs what I said ‚Äúnormal operation‚Äù",
        "created_at": "2021-08-25T13:53:53.405000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e in normal operation, there are no competing blocks because of single slot assignment",
        "created_at": "2021-08-25T13:54:12.601000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e I think the paradoxical situation is that immediately after production, a PoS block is less safe than a PoW block, but with attestations coming in it is very quickly 100s of times safer",
        "created_at": "2021-08-25T13:54:13.335000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e and in normal pow operation there are often uncles",
        "created_at": "2021-08-25T13:54:17.644000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e it does depend! (re @dankrad: I think the paradoxical situation is that immediately after production, a PoS block is less safe than a PoW block, but with attestations coming in it is very quickly 100s of times safer)",
        "created_at": "2021-08-25T13:54:29.231000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e if it is built on a well attested head at the slot in question",
        "created_at": "2021-08-25T13:54:38.685000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e then it is much more likely to be hte head than some rogue head forked from a while ago",
        "created_at": "2021-08-25T13:54:49.683000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e I see, interesting",
        "created_at": "2021-08-25T13:54:56.448000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e but I suppose that wouldn‚Äôt go down to the execution layer as ‚Äúhead‚Äù anyway",
        "created_at": "2021-08-25T13:55:04.948000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e yes, potentially the algorithm could conclude that a block built on a safe head is actually safe even without attestations",
        "created_at": "2021-08-25T13:55:18.103000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e worth attempting to quantify and parametrize",
        "created_at": "2021-08-25T13:55:36.415000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e because this is actually probably true under synchronous conditions",
        "created_at": "2021-08-25T13:55:46.963000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdannyryan\u003e right, especially if you see the head very much on time",
        "created_at": "2021-08-25T13:56:00.101000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e yeah",
        "created_at": "2021-08-25T13:56:06.418000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003cdankrad\u003e good point! so maybe \"best case\" latency can be even lower",
        "created_at": "2021-08-25T13:56:27.546000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "**The Merge: Consensus API design space Call is in about 22 hours**\nAgenda: https://github.com/ethereum/pm/issues/378",
        "created_at": "2021-08-25T14:46:45.880000+00:00",
        "attachments": null
    }
]