[
    {
        "author": "yperbasis",
        "category": "general",
        "parent": "",
        "content": "\u003c@!425572898787426305\u003e I think \"terminalBlockNumber MUST be set to 0\" in the Engine API is misleading. It should instead say \"In case terminalBlockHash is stubbed with 0x0000000000000000000000000000000000000000000000000000000000000000, terminalBlockNumber MUST be set to 0\". Or EIP-3675 could say that.",
        "created_at": "2022-02-18T09:40:38.275000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "This particular requirement does only relate to the input parameters, i.e. to the transition settings that are sent by CL. CL doesn't have `terminalBlockNumber` in its configuration",
        "created_at": "2022-02-18T09:44:02.711000+00:00",
        "attachments": null
    },
    {
        "author": "yperbasis",
        "category": "general",
        "parent": "",
        "content": "Perhaps omit terminalBlockNumber from TransitionConfigurationV1 altogether then?",
        "created_at": "2022-02-18T09:45:05.275000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "It one of the options but it's useful to read it from EL side though, if you want to check that all your nodes are configured properly",
        "created_at": "2022-02-18T09:46:00.758000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Either way, we may omit this `MUST` statement to avoid further confusion. In this case it won't matter at all what the number is set there. This statement was made to avoid questions like \"what should CL set as a value for this field?\" But the statement seems confusing in another way",
        "created_at": "2022-02-18T09:59:11.421000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "is there a way to signal that some `fcU`s might call with an optimistic head and some might be a verified head, so that the EL doesn't have to figure out why there might be a large gap the CL seems to be oscillating between? another option is to always send an opt head, but then there are edge cases around making sure the CL allows itself to do deep reorgs",
        "created_at": "2022-02-18T10:20:08.580000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "(until verified head overtakes opt head, which it usually will, because 128 slots behind, but again, deep reorg potentials, and given that parameter \"must\" be configurable, it might not even have to be that deep)",
        "created_at": "2022-02-18T10:21:01+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Not sure I understand. The idea behind an optimistic sync is to give EL directions to sync with the head of the chain. For this purpose CL reaches the head optimistically and propagates this info down to EL",
        "created_at": "2022-02-18T11:51:34.388000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "I get that, yeah, but is there value in the EL having, separately, any notion of a verified head, and of what the optimistic head is? Because the latter is just a guess. Maybe an unusually likely guess, but a guess. Even a verified head is ultimately a guess, because reorgs, but it's a significantly better guess.",
        "created_at": "2022-02-18T12:00:44.678000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "Optimistic sync partly works through fcU, which means that in the presence of optimistic sync, there seems to be no unambiguous way of communicating  verified head. Not sure if this just doesn't matter much on the EL side.",
        "created_at": "2022-02-18T12:02:07.036000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "From EL perspective a block is fully verified if 1) it's been designated by fcU -- evidence that consensus is valid 2) valid wrt execution environment. So, basically EL have all the information to decide whether a block is fully verified or not",
        "created_at": "2022-02-18T12:10:38.462000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "\u003e have a RANDOM(n) instruction, where n is a slot number\n\n\u003c@!425572898787426305\u003e does \"slot number\" equal to block number here?",
        "created_at": "2022-02-18T12:11:37.479000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "There's still a potential gap -- the CL provides a block the EL knows isn't verified, but the EL doesn't necessarily know the most recent block it'd consider verified.",
        "created_at": "2022-02-18T12:11:48.787000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "These numbers may not be equal due to missed slots. And it's a slot number that might need to be used for better security properties",
        "created_at": "2022-02-18T12:12:58.421000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "I guess the obvious inference is that it hasn't mattered, so.",
        "created_at": "2022-02-18T12:13:04.444000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Yeah I was wondering if you plan to store it even for missed slots?",
        "created_at": "2022-02-18T12:13:15.617000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Not necessarily. It may be stored for non-empty slots and return the values from the next non-empty slot if `n` is an empty one",
        "created_at": "2022-02-18T12:14:26.971000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Is this the case when EL database has been wiped out? Thus, CL knows verified head that is older than genesis?",
        "created_at": "2022-02-18T12:15:36.827000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Left a suggestion here: https://ethereum-magicians.org/t/eip-4399-supplant-difficulty-opcode-with-random/7368/24?u=axic",
        "created_at": "2022-02-18T12:16:16.627000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "The suggestion is to rename the opcode to `LASTRANDAO/LASTRANDOM` at the moment AND implement `BEACONSLOT`. Or the latter can be done later on?",
        "created_at": "2022-02-18T12:23:58.809000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "The main suggestion is to go with `{LAST/CURR}{RANDAO/RANDOM}` for the renaming, but also propose `BEACONSLOT`+`RANDAO/RANDOM` so that the ecosystem have something to look for. This is mostly an education play, and having a clear roadmap should make it easier.",
        "created_at": "2022-02-18T12:25:12.588000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "I personally like this name as it strictly represents the semantics of the instruction. It also may be clearly stated how `LASTRANDOM` may be biased in opposition to `RANDOM(n)`, and gives us future compatibility",
        "created_at": "2022-02-18T12:28:32.630000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "I do prefer randao over random, if that is the underlying naming, as it makes it more clear what the source is. And since it may be a weird term for people unfamiliar with it, they would be prompted to look up the docs (like solidity docs) before using it.",
        "created_at": "2022-02-18T12:29:02.159000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "/methinks",
        "created_at": "2022-02-18T12:29:17.638000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "In the future we may replace RANDAO mix with VDF. Should we rename the opcode when it happens?",
        "created_at": "2022-02-18T12:30:55.773000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Is there any other term then over random which could cover both?",
        "created_at": "2022-02-18T12:31:35.619000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Like mixhash or something.",
        "created_at": "2022-02-18T12:31:52.676000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "I am a bit worried about random, even if prefixing it with last, it may give off the wrong idea.",
        "created_at": "2022-02-18T12:32:54.238000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "It could also be `PREVRANDAO` as the return value is a RANDAO mix produced in the previous non-empty slot",
        "created_at": "2022-02-18T12:36:03.470000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "Alright, this seems reasonable enough",
        "created_at": "2022-02-18T12:37:30.357000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "RANDAO isn't *known* for missed slots (doesn't exist) I believe.",
        "created_at": "2022-02-18T12:40:07.370000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Verified head may be too far from an optimistic head, e.g. more than 128 blocks behind. In this case I am not sure that verified head is useful for EL. Suppose EL is pulling the state from the network, it can't use verified head as it might be too far and point to already unavailable state due to state trie pruning.",
        "created_at": "2022-02-18T12:41:58.925000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "RANDAO mix of a missed slot equals to the mix produced in the previous non-empty slot",
        "created_at": "2022-02-18T12:43:37.984000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Right, because there is no RANDAO for a missed slot, so we have to *define* what a missed RANDAO means.",
        "created_at": "2022-02-18T12:49:24.219000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I still think using previous slot is bad though.",
        "created_at": "2022-02-18T12:49:33.032000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Agreed. I think it is fine for `LASTRANDAO`, but not for the explicit query.",
        "created_at": "2022-02-18T13:03:54.582000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "This definition should be a part of instruction's semantics, not enshrined in the way we store RANDAO values in accumulator, IMO",
        "created_at": "2022-02-18T13:09:57.658000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Agreed.  I think an accumulator should have empty slots when the RANDAO is missing, not auto-fill with something else.",
        "created_at": "2022-02-18T13:15:27.555000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "If you query using the accumulated value it is up to you to decide whether you want previous or next in the case of missing.",
        "created_at": "2022-02-18T13:15:45.076000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "The only downside is that if someone wants a less-biased randomness they may need to have a loop for querying multiple slots for non-misses.",
        "created_at": "2022-02-18T13:22:07.686000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e I actually feel otherwise. The semantics of a missed slot in the beacon chain are some state-transition through that slot but the randao does stay stable until a new slot. so any skipped slots, imo should be the randao from the latest block in that chain",
        "created_at": "2022-02-18T13:31:38.604000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e similiarly if there is a block at N and not at N+1, if querying a block_root, one would get the block root at N at the slot N+1",
        "created_at": "2022-02-18T13:31:57.431000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e whereas, the state root changes each slot evn at skip slots",
        "created_at": "2022-02-18T13:32:10.858000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e shoving in 0s or something is a semantic mismatch with reality",
        "created_at": "2022-02-18T13:32:28.186000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e randao *is* in the beacon state at each slot and is thus strange to not be able to query if querying by slot",
        "created_at": "2022-02-18T13:32:44.176000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "We want randao mix from the first non-empty slot for security purposes. So, there should be a notion of an empty slot. Though, we better keep this discussion for the future `RANDAO(n)` instruction once we get there",
        "created_at": "2022-02-18T13:52:33.235000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e \u003e We want randao mix from the first non-empty slot for security purposes\nThis is how a call to RANDAO(latest_slot) would work if you used the semantics of what I described",
        "created_at": "2022-02-18T13:57:04.537000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e this discussion is relevant for the BEACON_BLOCK_ROOT eip in discussion",
        "created_at": "2022-02-18T13:57:24.549000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e if the accessor is slot (which I think it likely should be), then you have to decide what to do with empty slots in exaclty the same way",
        "created_at": "2022-02-18T13:58:02.970000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e which I think semantically, it makes sense for spans of empty slots to return the latest beacon block root  at or before that slot",
        "created_at": "2022-02-18T13:58:30.517000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "We need something like `RANDAO(n)` returning RANDAO mix of the first non-empty slot starting from `n`",
        "created_at": "2022-02-18T13:58:48.153000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e this is how voting works ofr hte beacon chain, it’s how the state trnasition works, and it’s how the native beacon chain accumulators work",
        "created_at": "2022-02-18T13:58:50.997000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e hmm (re @merge_chat_bot: \u003cMikhail Kalinin [mkalinin]\u003e We need something like `RANDAO(n)` returning RANDAO mix of the first non-empty slot starting from `n`)",
        "created_at": "2022-02-18T13:59:07.826000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "If `n` is empty it should use `n+1`",
        "created_at": "2022-02-18T13:59:13.740000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e that’s the reverse of the beacon chain semantics in all other places",
        "created_at": "2022-02-18T13:59:16.495000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "`n+1` or `n-1`?",
        "created_at": "2022-02-18T13:59:35.496000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e worth discussing. will think about it some more",
        "created_at": "2022-02-18T13:59:37.092000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "sure",
        "created_at": "2022-02-18T13:59:40.562000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e when we ask something about the beacon chain (that doesn’t change in empty slots), if we query by N, we get the latest tihng *at* or *before* N",
        "created_at": "2022-02-18T14:00:19.660000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Only if you don't have a mechanism for returning `null` or `missing`.",
        "created_at": "2022-02-18T14:00:28.335000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e that is an option, yes",
        "created_at": "2022-02-18T14:00:41.333000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I advocate that we *should* have a mechanism for returning `null`, because that is the *correct* answer IMO.",
        "created_at": "2022-02-18T14:00:43.221000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e that makes failed TXs easier",
        "created_at": "2022-02-18T14:00:48.137000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "I think `n-1` makes more sense because explicitly querying mostly is motivated by getting a stronger number. Also going `n+1` has the risk of reaching the current slot.",
        "created_at": "2022-02-18T14:01:01.273000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e I wouldn’t argue it’s the most obvious correct answer",
        "created_at": "2022-02-18T14:01:04.239000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e oh call started",
        "created_at": "2022-02-18T14:01:16.049000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "What is the argument that it is incorrect to return `null` for a slot that has no RANDAO (because it is empty)?",
        "created_at": "2022-02-18T14:01:43.446000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdannyryan\u003e beacuse the beacon state exists at that slot and had a randao value",
        "created_at": "2022-02-18T14:02:07.612000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Re withdrawals. I would like to also rectify the total supply problem. Potentially at the beginning of a block both the withdrawal and deposit contracts balances could be synchronised according to the beacon state.",
        "created_at": "2022-02-18T15:33:45.256000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "e.g. elevating those regular contracts into \"system contract\" status",
        "created_at": "2022-02-18T15:34:18.375000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Maybe this is the wrong chat.",
        "created_at": "2022-02-18T15:35:22.909000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "\u003c@!425279588009246720\u003e I think folks are discussing that in \u003c#823588372743323658\u003e/ party-lounge",
        "created_at": "2022-02-18T15:35:49.203000+00:00",
        "attachments": null
    }
]