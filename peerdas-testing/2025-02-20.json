[
    {
        "author": "jimmygchen",
        "category": "Testing",
        "parent": "",
        "content": "looks like we''ve lost some nodes on devnet-4, seeing a few missed blocks from lodestar and prysm on recent slots",
        "created_at": "2025-02-20T00:34:57.511000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Testing",
        "parent": "",
        "content": "but we're still at 76%",
        "created_at": "2025-02-20T00:35:07.683000+00:00",
        "attachments": null
    },
    {
        "author": "0xtylerholmes_",
        "category": "Testing",
        "parent": "",
        "content": "Are the images [here](https://notes.ethereum.org/@ethpandaops/peerdas-devnet-4) for kurtosis still the be best versions to use for local devnet testing?",
        "created_at": "2025-02-20T02:15:34.572000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Testing",
        "parent": "",
        "content": "I think these are still the images currently running on devnet, and are mostly quite stable.\nMost clients have made  some fixes since then, so may be worth rebuilding some images.",
        "created_at": "2025-02-20T02:34:32.878000+00:00",
        "attachments": null
    },
    {
        "author": "0xtylerholmes_",
        "category": "Testing",
        "parent": "",
        "content": "I’ll try pulling updated images. I haven’t been able to get a successful fork with that configuration.",
        "created_at": "2025-02-20T04:10:24.287000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Testing",
        "parent": "",
        "content": "what issue are you seeing?",
        "created_at": "2025-02-20T04:11:01.342000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Testing",
        "parent": "",
        "content": "I think the exact same images used in peerdas-devnet-4 would be fine (except for the geth image)",
        "created_at": "2025-02-20T04:11:35.238000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@520034910149410861\u003e \u003c@564345498471759890\u003e some metrics to measure of effectiveness of `getBlobs` and Distributed Blob Publishing:\n- the EL hit rate is pretty high, we always get *some* blobs from the EL\n- miss blobs per minute range from 0-8 blobs, we currently don't do retries on `getBlobs`, but a retry on `getBlobs` after some milliseconds could improve this.\n- the node is constantly publishing a small number of blobs (it only publishes what it hasn't seen on gossip)\n- this is using geth, we know that the performance varies across EL, but geth is pretty fast.\n\nThis is metrics from mainnet today, which isn't too bad, but if we can bring down the missing blob count further, local block builders may not have to publish blobs / columns at all.",
        "created_at": "2025-02-20T04:55:35.203000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "22a5cb5f1d79c3be82dc83f2b8cbe8846ba086a4d745deeb49ab683bfcd14e93"
            }
        ]
    },
    {
        "author": "agnxsh",
        "category": "Testing",
        "parent": "",
        "content": "Does it actually ever happen that you send versioned hashes 1,2,3,4,5 and you get  ,2,3, ,5? Read _ as null.",
        "created_at": "2025-02-20T05:07:19.071000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Testing",
        "parent": "",
        "content": "yes, it means EL doesn't have it in its mempool",
        "created_at": "2025-02-20T05:07:46.402000+00:00",
        "attachments": null
    },
    {
        "author": "agnxsh",
        "category": "Testing",
        "parent": "",
        "content": "So practically can getBlobs totally replace gossip validation of blobs? Say after a couple retries?",
        "created_at": "2025-02-20T05:09:03.901000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Testing",
        "parent": "",
        "content": "I don't actually know if retry helps. Im not familiar with the EL side of things, would be an EL question",
        "created_at": "2025-02-20T05:10:57.706000+00:00",
        "attachments": null
    },
    {
        "author": "agnxsh",
        "category": "Testing",
        "parent": "",
        "content": "It could save cpu quite significantly every slot, that is 9 kzg verify proofs and 9 inclusion proof verifications for pectra, looking at the graph i guess getBlobs almost always serves 4-6ish per slot atleast",
        "created_at": "2025-02-20T05:11:50.497000+00:00",
        "attachments": null
    },
    {
        "author": "agnxsh",
        "category": "Testing",
        "parent": "",
        "content": "From the second point it seems getBlobs even serves more per slot, that’s even better savings on cpu and bandwidth. Nice.",
        "created_at": "2025-02-20T05:13:57.974000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Testing",
        "parent": "",
        "content": "i dont know if it actually save bandwidth, because IDONTWANT doesn't really work :/",
        "created_at": "2025-02-20T05:16:55.752000+00:00",
        "attachments": null
    },
    {
        "author": "jimmygchen",
        "category": "Testing",
        "parent": "",
        "content": "cross posting here for visibility - drafted a PR on PeerDAS readiness here:\nhttps://github.com/ethereum/pm/pull/1314",
        "created_at": "2025-02-20T06:15:21.750000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "Do you have an example of missed blocks from Prysm?",
        "created_at": "2025-02-20T08:41:09.432000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "I cannot find one. (Apart from `prysm-geth-5`  of course)",
        "created_at": "2025-02-20T08:41:47.443000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Testing",
        "parent": "",
        "content": "what do you mean by \"the node is constantly publishing a small number of blobs (it only publishes what it hasn't seen on gossip)\"?",
        "created_at": "2025-02-20T09:01:57.820000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Testing",
        "parent": "",
        "content": "It would be helpful to have something like a distribution of miss rate based on the first seen time of a blob in the mempool, or first seen by the proposing node. E.g. you'd expect that there are no misses for blobs that appeared in the mempool 6s before proposing, some misses for blobs that appeared 3s before proposing, a lot of misses for blobs that appeared 1s before proposing? (just saying numbers to explain what I mean, I don't know what are propagation times in the mempool)",
        "created_at": "2025-02-20T09:06:20.175000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Testing",
        "parent": "",
        "content": "Speaking of which, that would be another useful data point in itself. How are propagation times in the mempool, when there's N blobs going through it?",
        "created_at": "2025-02-20T09:07:15.847000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Testing",
        "parent": "",
        "content": "Sorry if already asked\nI have 4 custody req plus 8 for validator custody\nI need 12 or it combines to 8?",
        "created_at": "2025-02-20T09:14:27.184000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Testing",
        "parent": "",
        "content": "8. Validator custody overrides the regular custody min of 4, let's say",
        "created_at": "2025-02-20T09:17:09.647000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Testing",
        "parent": "",
        "content": "and do we drop sampling with this? it becomes completely useless",
        "created_at": "2025-02-20T09:21:17.548000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Testing",
        "parent": "",
        "content": "I mean extra sampling",
        "created_at": "2025-02-20T09:21:37.180000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Testing",
        "parent": "",
        "content": "just check that custody for this block is filled",
        "created_at": "2025-02-20T09:21:49.805000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Testing",
        "parent": "",
        "content": "Yeah, `SAMPLES_PER_SLOT` is just the min number of columns (custody groups to be precise) you need to download. If your advertised custody is \u003e= `SAMPLES_PER_SLOT`, you're done.",
        "created_at": "2025-02-20T09:26:49.561000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Testing",
        "parent": "",
        "content": "E.g. a full node with custody = 4 needs to download an extra 4. A validator never needs to do any extra sampling",
        "created_at": "2025-02-20T09:27:28.424000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Testing",
        "parent": "",
        "content": "\u003e E.g. a full node with custody = 4 needs to download an extra 4\nAssuming it's not voting for forkchoice it's just a complication of software",
        "created_at": "2025-02-20T09:28:57.510000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Testing",
        "parent": "",
        "content": "it's passive node",
        "created_at": "2025-02-20T09:29:16.164000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Testing",
        "parent": "",
        "content": "By that logic we could have full nodes not download anything",
        "created_at": "2025-02-20T09:30:46.699000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Testing",
        "parent": "",
        "content": "no, it serves for data sharing",
        "created_at": "2025-02-20T09:31:19.500000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Testing",
        "parent": "",
        "content": "sampling is not stored and doesn't serve",
        "created_at": "2025-02-20T09:31:35.449000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Testing",
        "parent": "",
        "content": "Sampling is primarily for security. The whole point of DAS is that you can have decent guarantees that the chain you're following is available, and that only a small minority of the network can be tricked into thinking otherwise",
        "created_at": "2025-02-20T09:33:24.154000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Testing",
        "parent": "",
        "content": "That said, serving is not super important for this purpose but I think full nodes should at least store the sampled columns",
        "created_at": "2025-02-20T09:34:01.257000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Testing",
        "parent": "",
        "content": "Here's the conversation about this decision in case you're interested: https://discord.com/channels/595666850260713488/988798065894907934/1270680679562215507",
        "created_at": "2025-02-20T09:39:19.795000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "\u003e  I think full nodes should at least store the sampled columns\n~~In this case, why not simply say that a full node should custody 8 columns instead of custodying 4 columns + sample 4 extra columns?\n\nIf a full node should store the sampled columns, the only difference between sampled columns and custody columns is that the sampled columns won't be requestable by peers. (Since the announced `cgc` is 4 and not 8.)\n\nThe main advantage I see for full node in the 4+4 version contrary to the 8 version, was in the 4+4 version, you need half the disk storage compared to the 8 version.\n\nIf, in the 4+4 version, we need to store the 4 sampled columns, this advantage disappears, and I don't really see what other advantage remains.~~",
        "created_at": "2025-02-20T09:46:18.038000+00:00",
        "attachments": null
    },
    {
        "author": "agnxsh",
        "category": "Testing",
        "parent": "",
        "content": "one question regarding column syncing: lets say i have downloaded and verified a block of say slot 24 while syncing, do i need to wait until i can download all my local custodied columns of slot 24 before persisting this downloaded and verified block (at slot 24) to the database, or can i optimistically persist the block and advance slots for downloading blocks, and slowly backfill and download the next columns independently? \n\nif i advance slots for blocks independently without waiting to download all columns for a given slot, isn't my BN ready faster (except for being able to serve columns for a while as it would be still downloading and persisting columns)?",
        "created_at": "2025-02-20T09:52:50.357000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "In prysm we do sync blocks and columns (and blobs, pre fulu) in parallel. However, a block will be considered as available if it is verified and if all needed columns are downloaded and verified.",
        "created_at": "2025-02-20T09:56:56.286000+00:00",
        "attachments": null
    },
    {
        "author": "agnxsh",
        "category": "Testing",
        "parent": "",
        "content": "alright, thanks!",
        "created_at": "2025-02-20T09:57:34.605000+00:00",
        "attachments": null
    },
    {
        "author": "agnxsh",
        "category": "Testing",
        "parent": "",
        "content": "it means if the columns haven't yet been downloaded but the block is, and someone root requests prysm that block, prysm won't respond or say it's unavailable, correct?",
        "created_at": "2025-02-20T09:59:15.910000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Testing",
        "parent": "",
        "content": "comparing to all el data and other cl data storage gains are so negligible, it's less than 5%\nand it's even not a validator\nwe'd better have clear and simple spec instead",
        "created_at": "2025-02-20T10:06:04.551000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "\u003e  it's less than 5%\nWith 3/6 blobs, I agree. Will be less negligible when we increase the blob count.",
        "created_at": "2025-02-20T10:07:14.715000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "~~My opinion is: If we say a full node (without validators) should store the **sampled** columns, in this case, just let's say a full node should custody 8 columns.~~",
        "created_at": "2025-02-20T10:10:26.828000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Testing",
        "parent": "",
        "content": "4 columns = 1/32, 1/16 of blob size\nso for 16 blobs it's like 1 blob in Deneb for storage\n+16Gb \nwhile we need 1tb only for el",
        "created_at": "2025-02-20T10:10:55.873000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Testing",
        "parent": "",
        "content": "You can see some of the rationale in the discussion I linked above, though I am struggling to find where exactly Nishant first wrote down the problem he had with the original design (which was what you're saying here, just set min custody to 8)",
        "created_at": "2025-02-20T10:25:56.503000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "I guess the issue with the original design was a decrease in the published `cgc` when we want to switch from subnet sampling to peer sampling.\n\nWith the `4+4` idea, the `cgc` remains the same.",
        "created_at": "2025-02-20T10:28:29.382000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "But the question remains the same with peer sampling: Should columns sampled via peer sampling be stored?",
        "created_at": "2025-02-20T10:29:21.333000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Testing",
        "parent": "",
        "content": "Yes, that was the issue. In principle this allows more flexibility in such a switch (or to some other sampling scheme even). Whether it is worth the extra complexity right now, idk, I think it's up to you guys to decide",
        "created_at": "2025-02-20T10:29:33.068000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Testing",
        "parent": "",
        "content": "I would say that it should be stored. Otherwise, most full nodes could in principle decide that something is available, but not actually have the data to reconstruct (even if they wanted to get together offline and do so).",
        "created_at": "2025-02-20T10:30:57.025000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Testing",
        "parent": "",
        "content": "Tbh I also only recently realized that only nodes that are explicitly advertising custody of something are asked for historical data. I thought anyone in a subnet would keep the data and also serve it.",
        "created_at": "2025-02-20T10:32:18.420000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "\u003e Tbh I also only recently realized that only nodes that are explicitly advertising custody of something are asked for historical data. \nIt is, at least, the prysm behaviour. Prysm will only ask for columns announced in the peers `cgc`. (Prysm won't look at peers subscribed subnets)",
        "created_at": "2025-02-20T10:32:55.765000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "I remember now. It had to deal with the minimum value of announced `cgc`. Setting it to `4` (and not `8`) definitly works for both subnet sampling **and** peer sampling. If we decide to set the minimum value to `8`, then, even with peer sampling, this value will have to be `8` (while `4` will be enough since 4 extra columns will be peer sampled.)\n\nSo, I withdraw what I said a few minutes ago, let's keep the `4+4` mechanism.",
        "created_at": "2025-02-20T10:37:14.439000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Testing",
        "parent": "",
        "content": "we could add sampling whenever it's really needed\nfor now, I'd just bump full node requirement to 8 and remove extra sampling from the spec and software\nif we need sampling in G fork, we could add it in G-spec",
        "created_at": "2025-02-20T11:48:29.419000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Testing",
        "parent": "",
        "content": "well, the behavior makes sense (and is required?) if nodes are not storing the extra samples",
        "created_at": "2025-02-20T11:52:14.137000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "Testing",
        "parent": "",
        "content": "I'd say it's up to client teams to figure out what they want to do here. Maybe put it on the agenda for next week's breakout? I don't really care either way",
        "created_at": "2025-02-20T11:53:58.263000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Testing",
        "parent": "",
        "content": "and it's not slightly more space occupied for full-node\nThere are pros: it serves more good for whole network\nit's strange that we need 2x full-nodes to sync any 1 validator node for da sync while all other data is in place",
        "created_at": "2025-02-20T12:22:46.173000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Testing",
        "parent": "",
        "content": "I will add comment",
        "created_at": "2025-02-20T12:24:15.289000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "\u003e if we need sampling in G fork, we could add it in G-spec\n**peer** sampling you mean?\n\nIf so, the advantage of the 4+4 solution is any client can switch from subnet sampling to peer sampling without requiring any hard fork.",
        "created_at": "2025-02-20T12:55:13.918000+00:00",
        "attachments": null
    },
    {
        "author": "skylenet",
        "category": "Testing",
        "parent": "",
        "content": "We have devnet-5 (aka devnet-4 relaunch) up and running https://dora.peerdas-devnet-5.ethpandaops.io/ . The main difference is that it's using a fixed geth version now. https://notes.ethereum.org/@ethpandaops/peerdas-devnet-5",
        "created_at": "2025-02-20T14:10:29.968000+00:00",
        "attachments": null
    },
    {
        "author": "skylenet",
        "category": "Testing",
        "parent": "",
        "content": "I'm thinking about deleting devnet-4 soonish (~tomorrow) . Please let me know if you want me to hold off.",
        "created_at": "2025-02-20T14:52:34.787000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "\u003c@498331483732312075\u003e it seems `grandine-geth-1` has some troubles.",
        "created_at": "2025-02-20T15:05:47.098000+00:00",
        "attachments": null
    }
]