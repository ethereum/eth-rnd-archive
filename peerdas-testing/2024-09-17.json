[
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "just curious, why is prysm sampling on the current ongoing slot",
        "created_at": "2024-09-17T13:15:28.986000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "columns have aparently not even been persisted by that time in the peer node",
        "created_at": "2024-09-17T13:17:02.621000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "395c0f94cfaacf36fb74b3f3a674ea26e2bbebaacfabdbc3ee11a5bafd81af86"
            }
        ]
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "slot started 1.3 second before : Sep-17 13:03:27.000[chain]         verbose: Clock slot slot=110",
        "created_at": "2024-09-17T13:18:17.706000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "",
        "created_at": "2024-09-17T13:20:10.669000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "image.png",
                "content": "03484fc3920e5c65c44f20633ee3a3616d8e50f56d265d29711555542ae31cd9"
            }
        ]
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "i also see 3 logs for sampling on the same slot, at the same time",
        "created_at": "2024-09-17T13:21:16.829000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "It's peer sampling. But it's deprecated on the next devnet, and it's replaced by subnet sampling in the latest spec.",
        "created_at": "2024-09-17T13:26:56.403000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "This PR (in review) does the change: https://github.com/prysmaticlabs/prysm/pull/14452",
        "created_at": "2024-09-17T13:27:44.255000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "And more precisely, this commit: https://github.com/prysmaticlabs/prysm/pull/14452/commits/560b1951edbcb7d3d328c3b9045eef22ba9dc2e3",
        "created_at": "2024-09-17T13:28:05.351000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "\u003e i also see 3 logs for sampling on the same slot, at the same time\nYes, it's peer sampling from 3 different peers. Sampled columns are not the same.",
        "created_at": "2024-09-17T13:30:31.529000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "right, but it shouldn't happen on the current clock slot, atleast not in the first interval",
        "created_at": "2024-09-17T13:48:57.288000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "Why not? If you received a `columnByRoot` request for a block you already have, but for a column you did not yet receive, just hang and respond when (and if) you receive the corresponding column.",
        "created_at": "2024-09-17T13:50:51.935000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "\u003e  but it shouldn't happen on the current clock slot\nIt depends if we are going to use tight fork choice or trailing for choice. For sure for tight fork choice, the sooner the better.\n\nBut anyway, this feature is going to be deactivated in Prysm as soon as this PR is merged.",
        "created_at": "2024-09-17T13:52:25.126000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "sampling is different from forchoice/block import, thats what we have discussed in past",
        "created_at": "2024-09-17T17:11:32.016000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "for block import, its same slot availability, which is you don't import block unless you have all you want to custody",
        "created_at": "2024-09-17T17:12:23.598000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "sampling is to sample your peers if they are maintaining custody and hence disconnect/downscore them, which should be trailing 1 slot behind in the least",
        "created_at": "2024-09-17T17:13:07.304000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "\u003e but for a column you did not yet receive, just hang and respond when (and if) you receive the corresponding column. \neven if you made a request on the current slot, it could be for availing the missing datacolumn, so yes for the other peer it doesn't matter though.\n\nbut:\n\n1. its a bad idea to hang and wait and could lead to DDOS, so its better to just respond what the peer has at that moment. not to mention a bit more complicated. It also allows the requesting node to go request someone else\n\n2. the main issue is if prsym or the other peer are scoring the other peer on the basis of this request as the other peer might not have this data yet or even the block for that matter.",
        "created_at": "2024-09-17T17:19:22.819000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "although it would be nice if 3 seconds into the slot, if my peers can tell me or i can poll if they have a imported a fully available block (only of the current slot) by thn, may be have a new gossip blockimport message which a node spreads to its peer that it has imported the block, (doesn't need to be propagated further) so that anyone who wants to pull the block/custodied data can do so",
        "created_at": "2024-09-17T17:25:39.733000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "if there is such a message, it can also notify that i can serve all the columns (for e.g. if i am proposer) for this current slot, so my peers can just pull if they need and need not hop",
        "created_at": "2024-09-17T18:11:16.156000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "\u003e sampling is different from forchoice/block import, thats what we have discussed in past\n\u003e ...\n\u003e sampling is to sample your peers if they are maintaining custody and hence disconnect/downscore them, which should be trailing 1 slot behind in the least\n\nThe comment in [is_data_available](https://github.com/ethereum/consensus-specs/blob/dev/specs/_features/eip7594/fork-choice.md#modified-is_data_available) states:\n\u003e ...\n\u003e For the given block root, it returns all column sidecars **to sample**, or raises an exception if they are not available.\n\u003e ...\n\nHere it is **to sample**, not **to custody**.\n\nAlso, the output of [is_data_available](https://github.com/ethereum/consensus-specs/blob/dev/specs/_features/eip7594/fork-choice.md#modified-is_data_available) has to be `True` for [on_block](https://github.com/ethereum/consensus-specs/blob/dev/specs/_features/eip7594/fork-choice.md#modified-on_block) to succeed.\n\n==\u003e A successful sampling is needed to import the block. The output of sampling is not only used to disconnect/downscore \"bad\" peers.\n\nOr maybe using the word \"sampling\" you were *specifically* talking about \"peer sampling\"?",
        "created_at": "2024-09-17T18:50:51.778000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "But, even if \"sampling\" here specifically means \"peer sampling\", for the [tight fork choice](https://ethresear.ch/t/das-fork-choice/19578#tight-fork-choice-2), there is the following:\n\n\u003e In PeerDAS, this would mean that validators are required to perform peer sampling **immediately upon receiving a block, and cannot vote for it without completing it**\n\nFor trailing fork choice, I'm not sure if a fork choice rule were clearly defined.",
        "created_at": "2024-09-17T19:05:49.040000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "\u003e For the given block root, it returns all column sidecars to sample, or raises an exception if they are not available.\n\ni think it should mean custody and not sample",
        "created_at": "2024-09-17T20:43:38.172000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "i remember having this exact discussion on one of peerdas breakout calls to clarify between data availability and sampling",
        "created_at": "2024-09-17T20:44:37.069000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "\u003e peer sampling immediately upon receiving a block, and cannot vote for it without completing it\nall this is a mess we should talk and figure out in next call and get everything aligned",
        "created_at": "2024-09-17T20:51:23.468000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "Testing",
        "parent": "",
        "content": "all other clients also inferring this as sampling for is_data_available rather than custody?\n\u003c@466006586477772831\u003e \u003c@785811170387951616\u003e \u003c@425907307621122049\u003e \u003c@425567222635954178\u003e",
        "created_at": "2024-09-17T20:57:07.999000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "Reposting here Francesco's message since it's clearly related: https://discord.com/channels/595666850260713488/1252403418941624532/1283491543642275894",
        "created_at": "2024-09-17T21:12:54.029000+00:00",
        "attachments": null
    },
    {
        "author": "manunlp",
        "category": "Testing",
        "parent": "",
        "content": "Current Prysm behavior for a **full node**:\n1. Custodies **4** columns, obtained with `get_custody_columns(node_id, custody_subnet_count)`, with `custody_subnet_count = 4`.\n2. In advertised ENR, `csc = 4`\n3. In advertised Metadata, `custody_subnet_count=4`\n4. Subscribed to **8** subnets. The columns corresponding to these subnets are obtained with `get_custody_columns(node_id, subnet_sampling_size)`, with `subnet_sampling_size = 8` (since `subnet_sampling_size = max(SAMPLES_PER_SLOT, custody_subnet_count)` and `SAMPLES_PER_SLOT = 8`)\n5. For a block to be available, all the 8 columns computed in `4.` must be available.",
        "created_at": "2024-09-17T21:35:25.267000+00:00",
        "attachments": null
    },
    {
        "author": "dmitriishmatko",
        "category": "Testing",
        "parent": "",
        "content": "Teku:\n1,2,3: same\n4: subscribed to 4 subnets\n5. for a block to be available 4 columns (same as custody) availability is only verified\nhave an issue to align it with the spec, not yet done",
        "created_at": "2024-09-17T22:28:23.663000+00:00",
        "attachments": null
    }
]