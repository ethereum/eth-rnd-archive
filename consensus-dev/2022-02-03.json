[
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Could I ask you again about this? So the question has several layers\n1) is it possible that Teku will keep the block at 31?\n2) assuming that the answer to 1) is true (it was my understanding that this was the case) then will you return the skipped slot even if you have the block?\n3) I find 2 striking, this can't possibly happen if you don't have 32 yet right? So if I request this state right after the node synced 31, do you give me the state with 31 applied?\n4) will Teku return different values for the same call if it knows the block is non canonical vs if it doesn't know?\nSorry for the battery of questions but I'm even trying to figure out a) what's the right thing to do and b) do the same thing that other clients do, but I don't even understand where we differ",
        "created_at": "2022-02-03T00:30:29.955000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "1. Teku will keep block 31 as long as it is still in the non-finalized portion of the chain.  If you enable the option to keep non-canonical blocks we will also keep it beyond finalization (but it's then only available via a teku specific API to retrieve non-canonical blocks - designed for things like block explorers)\n2. When you specify a slot in the standard REST API you are requesting data from that slot for the canonical chain.  The canonical chain has no block at slot 31 so we would generate the state based on that slot being empty (including process_slots for that empty slot)\n3. If you don't have 32 then 31 must be your canonical head and there is no fork, so yeah you'd return data on the basis that 31 is on the canonical chain (because it is).\n4. Teku always knows if the block is canonical or not because a beacon node *always* knows its canonical chain head (well assuming genesis has been determined for the chain).  I think the key thing here is that the canonical chain is simply the one your node says is canonical.  The point of the fork choice rule is that all nodes will wind up agreeing on the same canonical chain, but the agreement isn't reached instantly.  Each node always acts based on the assumption that it's canonical chain is the correct one - if it gets further information later it will reorg over to a different chain and the responses you get from the REST API would then change to be based on that canonical chain.",
        "created_at": "2022-02-03T00:40:40.661000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Thanks this clarifies a lot, but it still strikes me that Teku will give you a different answer for the same request at different times. I think what you do is the right thing, just not expected clients to do this. Thanks I have now enough info to at least match up Teku and debug our problem (which lies somewhere else since my node keeps a block that it knows it's not canonical, and there's no such option for prysm)",
        "created_at": "2022-02-03T00:48:14.488000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Having responses that may change is par for the course with blockchain APIs because there's the possibility to reorg.  That's why it's so powerful that the beacon chain introduces actual finality and part of why single slot finality is so tempting (if we can find a way to deal with 32x more attestations...)",
        "created_at": "2022-02-03T00:52:16.207000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Yeah in fact I shouldn't be surprised if we get two different blocks for 31 instead of the orphaned situation we would return different answers as well before or after the reorg",
        "created_at": "2022-02-03T00:53:58.958000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "So I guess I'm probably looking in the wrong place",
        "created_at": "2022-02-03T00:54:35.662000+00:00",
        "attachments": null
    }
]