[
    {
        "author": "edson.eth",
        "category": "general",
        "parent": "",
        "content": "Is this correct? 99% of Medalla is Prysm?",
        "created_at": "2020-10-30T05:43:26.616000+00:00",
        "attachments": [
            {
                "type": "",
                "origin_name": "Screen_Shot_2020-10-30_at_1.42.50_AM.png",
                "content": "c2a4baa0693291d56aa623757737f605cdad679b035eb170ef9fe4f0e0703635"
            }
        ]
    },
    {
        "author": "prestonvanloon",
        "category": "general",
        "parent": "",
        "content": "\u003c@290615096462409728\u003e no, that chart is broken",
        "created_at": "2020-10-30T05:48:56.917000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nDo we have any idea why the \"voted\" percent is so volatile?",
        "created_at": "2020-10-30T05:50:06.830000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nI would have expected it to just be cleanly rising at this point with everyone who's online being online and everyone else slowly getting leaked...",
        "created_at": "2020-10-30T05:50:31.823000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "general",
        "parent": "",
        "content": "this is a chart showing currently attesting validators between epochs 18900 and 19000, per declared client (grabbing it from the graffiti)",
        "created_at": "2020-10-30T07:24:12.169000+00:00",
        "attachments": [
            {
                "type": "",
                "origin_name": "Screenshot_2020-10-30_at_15.23.33.png",
                "content": "3dd43746ee7c43d3e66d84c699fd45be1c6bbca2b24a4334e44ea5dda4413811"
            }
        ]
    },
    {
        "author": "barnabemonnot",
        "category": "general",
        "parent": "",
        "content": "the cells in red are where the client failed to attest",
        "created_at": "2020-10-30T07:24:29.169000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "general",
        "parent": "",
        "content": "interestingly, the vertical stripes are identically distributed across the four clients, as if there was a correlated failure",
        "created_at": "2020-10-30T07:24:54.136000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nOne other interesting thing is that when the chain justified, at epoch 19066, the clients did not break immediately; they hung on for a while; it was epoch 19072 when participation rapidly dropped",
        "created_at": "2020-10-30T07:25:56.274000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Important to note that just because a validators attestation isn’t included doesn’t mean it wasn’t active. The blocks are all completely full at the moment because so many slots are empty.",
        "created_at": "2020-10-30T08:07:14.300000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "The fact that those red stripes are so vertical look to me more like blocks were missed so attestations couldn’t be fit in.",
        "created_at": "2020-10-30T08:08:38.656000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nThose are epochs, not single slots",
        "created_at": "2020-10-30T08:09:04.941000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nAnd if you actually look at those epochs, there are some successful proposals in them",
        "created_at": "2020-10-30T08:09:14.871000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\neg. here is one of the red stripe epochs",
        "created_at": "2020-10-30T08:09:43.464000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nhttps://beaconcha.in/epoch/18953",
        "created_at": "2020-10-30T08:09:44.097000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nActually the red stripe goes across multiple epochs, 18952 has below-average participation too",
        "created_at": "2020-10-30T08:10:09.108000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Yes but blocks are consistently full. There are enough missed slots that the blocks can’t catch up and include all attestations.",
        "created_at": "2020-10-30T08:10:13.323000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "I don’t think it’s all that but I think it’s a part.",
        "created_at": "2020-10-30T08:10:28.404000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\noh interesting!",
        "created_at": "2020-10-30T08:10:37.075000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "If the validators were offline they should be a completely red line.",
        "created_at": "2020-10-30T08:10:52.466000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nI wonder if we should increase the attestation count for 1.0 to 256",
        "created_at": "2020-10-30T08:11:55.772000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\n@dannyryan thoughts?",
        "created_at": "2020-10-30T08:11:59.514000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\noh btw it looks like we are hitting 128 in basically all of these epochs",
        "created_at": "2020-10-30T08:12:33.396000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nhttps://beaconcha.in/epoch/18939",
        "created_at": "2020-10-30T08:12:34.302000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nhttps://beaconcha.in/epoch/18935",
        "created_at": "2020-10-30T08:12:42.949000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nhttps://beaconcha.in/epoch/18942",
        "created_at": "2020-10-30T08:12:55.893000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nhttps://beaconcha.in/epoch/18932 has more \u003c128s",
        "created_at": "2020-10-30T08:13:01.213000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "general",
        "parent": "",
        "content": "i can plot the block fullness per slot and correlate with the plot above, see if red stripes happen when more blocks are missing/blocks are fuller",
        "created_at": "2020-10-30T08:13:33.108000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "I’d be hesitant to do that. It adds more load on nodes right when they are already struggling with the non finalisation. Ultimately if we don’t have enough validators online to fill most slots then we probably won’t be finalising anyway. \n\nWould have to run the numbers in more detail to be sure.",
        "created_at": "2020-10-30T08:13:45.509000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Definitely would be interesting to see a correlation between blocks being full and missing attestations.",
        "created_at": "2020-10-30T08:14:10.788000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "general",
        "parent": "",
        "content": "i roughly estimated the current attesting weight to be 70% of the stake, so i think there is enough active validators, the thing is they are not all active at the same time",
        "created_at": "2020-10-30T08:14:47.439000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "general",
        "parent": "",
        "content": "by current attesting weight i mean i look at validators who attested somewhat recently, in the last 100 epochs or so",
        "created_at": "2020-10-30T08:15:05.669000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "There is likely a problem if they are not fitting as well theoretically everyone should attest to the same head, the all get aggregated and you only need 64 attestations to include everything produced each slot. So you can miss half the blocks and still wind up including everything.",
        "created_at": "2020-10-30T08:15:12.732000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "What I’ve seen in at least some cases is nodes are struggling under the load and so don’t import the block for a slot in time then produce an attestation that it was an empty slot. That creates more attestations which makes things harder to fit in blocks and harder to finalise.",
        "created_at": "2020-10-30T08:16:12.407000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nhuh",
        "created_at": "2020-10-30T08:16:22.939000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nWhat load are they struggling under?",
        "created_at": "2020-10-30T08:16:27.545000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nie. what are the nodes spending the bulk of their computation time on at the moment?",
        "created_at": "2020-10-30T08:16:49.012000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "general",
        "parent": "",
        "content": "also if blocks are full, they should look into dropping redundant/subset attestations, i counted that they are quite frequently included https://ethereum.github.io/rig/medalla-data-challenge/notebooks/explore.html#aggregate-attestations",
        "created_at": "2020-10-30T08:17:20.463000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Well the other day we had a huge reduction in cpu usage for Teku with an optimisation to how it ran get_ancestor. That hasn’t shipped in a release yet but helped a lot.",
        "created_at": "2020-10-30T08:17:27.336000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "But there’s also a lot of memory pressure cause by many competing heads and a need to hold or regenerate many different hot states and blocks.",
        "created_at": "2020-10-30T08:18:11.629000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "It was the state management that hurt most last time (at least to my memory) but this time it seems to be more on the fork choice side - the protoarray is really huge now.",
        "created_at": "2020-10-30T08:19:05.900000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nIf it's the fork choice rule then one option is a simple patch where nodes just follow only a random 5000 validators",
        "created_at": "2020-10-30T08:19:28.288000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nAnd longer term we should do this at some point:",
        "created_at": "2020-10-30T08:20:48.140000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**vbuterin**\nhttps://github.com/ethereum/eth2.0-specs/issues/1340",
        "created_at": "2020-10-30T08:20:48.718000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "I think it’s mostly about optimisation (and a bit of learning that you need some headroom in resources for your client - if it can’t keep up easily in good times you’re in trouble when it doesn’t finalise) n",
        "created_at": "2020-10-30T08:21:20.446000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Yes making skipping empty slots cheaper would be a big help in a bunch of cases. Haven’t read the details of that issue yet but will try to tomorrow.",
        "created_at": "2020-10-30T08:22:23.157000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "\u003e also if blocks are full, they should look into dropping redundant/subset attestations, i counted that they are quite frequently included https://ethereum.github.io/rig/medalla-data-challenge/notebooks/explore.html#aggregate-attestations\n\u003c@486501030046203915\u003e  this is really helpful. Was looking for data like this recently. Will try to dig into it tomorrow as well. Teku tries really hard to avoid including redundant attestations but I’ve heard reports of it and can’t work out how it happens yet. Extra data should be useful.",
        "created_at": "2020-10-30T08:23:27.728000+00:00",
        "attachments": null
    },
    {
        "author": "barnabemonnot",
        "category": "general",
        "parent": "",
        "content": "let me know! also if something else can help. the code is a bit messy and idiosyncratic atm but i'd like to package it nicely for others to use",
        "created_at": "2020-10-30T08:34:44.344000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**dankrad**\nWhat if during the failure epochs (where many validators fail to attestate to head) there are simply several forks of very similar weights? That could also explain why you see correlated failure by all clients",
        "created_at": "2020-10-30T10:59:48.126000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**dankrad**\nI don't really see how availability of attestation slots would explain this. That should result in dropping the least aggregated attestations, so very unlikely to have a huge influence unless there are literally no blocks",
        "created_at": "2020-10-30T11:02:31.141000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Attestations from other forks should still be included though. Except that the blocks are then more likely to fill up resulting in dropped attestations. \n\nSo I think you’re right, it’s not just that blocks are full because if it was working normally that should be an evenly spread effect and it clearly isn’t. But I do think it’s a part of the story. The main point is that validators aren’t necessarily offline just because their attestations are missing.",
        "created_at": "2020-10-30T11:44:51.045000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "general",
        "parent": "",
        "content": "\u003e That should result in dropping the least aggregated attestations\nassuming that clients implement this - ie packing attestations is a hard problem generally - we have a greedy / eager algorithm in nimbus rather than an optimal one - the other thing is that to compute \"least aggregated\" for slots earlier than the latest (which is the opportunity to \"fill in\" attestations the previous block producer missed), you should include in the calculation all attestations that are already in blocks - this also is non-trivial",
        "created_at": "2020-10-30T12:04:07.632000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**dankrad** (in reply to **\u003c@340345049063882753\u003e**)",
        "created_at": "2020-10-30T12:07:41.284000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "They would be included, but would not count toward finality as they are voting for the wrong ffg target. I assume this is the metric e.g. beaconcha.in is showing as % online",
        "created_at": "2020-10-30T12:07:41.691000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "There's currently 17 committees per slot for a total of 544 committees per epoch.  If there are 50% of proposers that show up per epoch there are roughly 4 potential attestation block positions each committee can be included in. If aggregatability or disagreement about head is high, then you won't be able to pack all of the attestations.\n\nThat said, there is known bloat in client packing algorithms. Strict subsets are regularly observed in the same block.\n\nAnecdotally on epochs with low participation, there appears to be a high orphan rate, making the block space for attestations significantly lower.\nSee https://beaconcha.in/epoch/19545. 12 blocks got in, 6 were orphaned. We saw 32% attestation participation and ~37% of proposals. \n\nMy hypothesis  is that there is a correlated resource consumption issue on some set of nodes during certain epochs that cause blocks to be broadcast late, and thus increase orphans and reduce overall epoch attestation space for the rest of the network",
        "created_at": "2020-10-30T14:06:44.171000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "If the resource consumption issue is correlated in a majority client and block space for the epoch diminishes, you could see correlated attestation failures with the minority clients",
        "created_at": "2020-10-30T14:07:52.840000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "The prysm team was aware of some resource consumption issues earlier this week. I believe they were correlated across prysm nodes",
        "created_at": "2020-10-30T14:08:29.989000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "I suppose my hypothesis doesn't fully explain why teku seems to be maybe more affected than prysm (or at least very similarly)",
        "created_at": "2020-10-30T14:33:01.934000+00:00",
        "attachments": null
    },
    {
        "author": "benjaminion",
        "category": "general",
        "parent": "",
        "content": "We had a resource issue around the time of the charts (high CPU) that was leading to frequently lagging a few slots behind head. This is now fixed, and my validators and the PegaSys validators, at least, are back to making accurate and timely attestations. Inclusion rates are good on my node currently (avg 97% over the last 12 hours, 98% over the last 24 hours).",
        "created_at": "2020-10-30T14:52:14.633000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**dankrad**\n\u003c@573787335796326400\u003e I think I was seeing this issue causing very low effectiveness for my teku node. Upgraded yesterday. What's your current communication strategy ensuring ppl upgrade when such critical fixes are rolled out?",
        "created_at": "2020-10-30T14:54:20.761000+00:00",
        "attachments": null
    },
    {
        "author": "benjaminion",
        "category": "general",
        "parent": "",
        "content": "\u003c@!555483069038198827\u003e The Teku channel on the ConsenSys discord is the main place. Open to suggestions for other channels. We encourage people to update frequently, and ideally keep up with the latest master, at least for now.",
        "created_at": "2020-10-30T14:57:46.543000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "I suggest an opt-in email list",
        "created_at": "2020-10-30T15:00:54.231000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "for release updates and other critical items",
        "created_at": "2020-10-30T15:01:05.164000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "email cuts through the noise a bit more for some users",
        "created_at": "2020-10-30T15:01:18.349000+00:00",
        "attachments": null
    },
    {
        "author": "trent_vanepps",
        "category": "general",
        "parent": "",
        "content": "wen eth2 client substack",
        "created_at": "2020-10-30T15:04:11.986000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**dankrad** (in reply to **\u003c@291925846556540928\u003e**)",
        "created_at": "2020-10-30T15:04:46.740000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "Yes I suggest that too.",
        "created_at": "2020-10-30T15:04:47.139000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**dankrad**\nConsensys discord does not sound like the right answer for prod",
        "created_at": "2020-10-30T15:05:18.984000+00:00",
        "attachments": null
    },
    {
        "author": "benjaminion",
        "category": "general",
        "parent": "",
        "content": "All good points - just been having some conversations about setting up an email alert list and maybe something on Twitter for Teku.",
        "created_at": "2020-10-30T15:32:19.329000+00:00",
        "attachments": null
    }
]