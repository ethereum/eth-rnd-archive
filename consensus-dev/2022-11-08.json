[
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "\u003c@881905303011086387\u003e What would be the cost of making LES protocol SSZ aware? IMO, we should be consistently getting rid of RLP all over the protocol and replacing it with SSZ, but not leaking RLP data into CL and Engine API",
        "created_at": "2022-11-08T04:27:03.890000+00:00",
        "attachments": null
    },
    {
        "author": "etan_status",
        "category": "general",
        "parent": "",
        "content": "\u003c@202397237962211328\u003e should know the answer best from the LES side. \n\nBut, currently, if you do `eth_getBlockByNumber`, you will receive a RLP `stateRoot`, a RLP `transactionsRoot`, a RLP `receiptsRoot` etc, and then another RLP `blockHash` that combines them all together. If you pass a SSZ `transactionsRoot` but no actual transactions, it becomes impossible to check that the provided RLP `blockHash` is correct without downloading additional data from the network. The idea of https://github.com/ethereum/consensus-specs/pull/3078 is not to leak any additional RLP data, but instead just to leak 2 intermediate RLP hashes that are already (implicitly) there and make them explicit.",
        "created_at": "2022-11-08T10:05:09.981000+00:00",
        "attachments": null
    },
    {
        "author": "etan_status",
        "category": "general",
        "parent": "",
        "content": "`parent_hash`, `state_root`, `receipts_root`, `block_hash` are currently RLP hash, that are transferred via engine API and persisted in CL `ExecutionPayload`.\n\nMy request is consistent with the existing RLP use:\n1. In `engine_getPayload`, EL also exposes the `transactions_root` and `withdrawals_root` RLP hashes that the EL already stores as part of the EL block header.\n2. Save them as part of `ExecutionPayload`, same as the other hashes, in an opaque way. CL doesn't care about them.\n3.Â In `engine_newPayload`, EL verifies that the computed `transactions_root` and `withdrawals_root` match the values from the `ExecutionPayload`.\nNote that all of `engine_getPayload`, `engine_newPayload`, and `ExecutionPayload` structure already require changes in Capella, so this addition does not add more risk.\n\nThis makes the EL block header a subset of `ExecutionPayloadHeader`; currently, it can only be derived from the full `ExecutionPayload` because only with the full one can the RLP `transactions_root` and RLP `withdrawals_root` be computed and the RLP `block_hash` be verified.\n\nFurthermore, it could make life simpler for verifying transaction inclusion proofs, or withdrawal inclusion proofs, by being able to follow similar procedures as for `eth_getProof` state proofs (which are RLP).\n\nRegarding the full transition to SSZ, I don't think it needs to be tied together with this change. RLP data is already present in CL and Engine API, the additions just expose 2 more hashes of the same kind as the existing ones. They can be treated completely opaque by CL, no RLP processing is needed there.",
        "created_at": "2022-11-08T10:46:17.146000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "unknown.png",
                "content": "2b319518876d05b043feb7e2f8f125dd8b8ccd791855f95ebeacc7033757387e"
            },
            {
                "type": "image/png",
                "origin_name": "unknown.png",
                "content": "b08fccb55fe68de54aeb395890af8f6a5e8f7c8202156b7c7f01345e9d20b87c"
            }
        ]
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Oh, I see. There are two distinct problems. 1) `blockHash` can't be verified without those values 2) those values may be utilized by LES to prove transaction/withdrawal inclusion. And the latter doesn't make any sense without doing the former, reading transactions from not verified block header is insecure. Though, my comment was mainly about the latter (use SSZ proofs to prove inclusion). Proof of inclusion may not be completely switched to SSZ, LES may still use RLP but probably there is a room of using SSZ in this particular situation -- this is what I was wondering for.\n\nLet me think on `blockHash` case more. It is actually in the CL current because EL can't verify a block without having this hash. And probably we should move our discussion to \u003c#595701319793377299\u003e",
        "created_at": "2022-11-08T13:59:44.058000+00:00",
        "attachments": null
    },
    {
        "author": "etan_status",
        "category": "general",
        "parent": "",
        "content": "Yes, SSZ proofs could also work for tx / withdrawal inclusion, but currently only the CL can do them (because the EL doesn't know SSZ). So you would need to ask CL for tx/withdrawal inclusion, but the EL for state proofs. And the proof would then root in the SSZ `transactions_root`, not in the EL `block_hash`.\nAgree on moving to \u003c#595701319793377299\u003e",
        "created_at": "2022-11-08T16:23:21.336000+00:00",
        "attachments": null
    }
]