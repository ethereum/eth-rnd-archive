[
    {
        "author": "eth2_bridge_bot",
        "category": "general",
        "parent": "",
        "content": "**will_vill**\nPhase 2 community call notes can be found here at the bottom  - https://github.com/ethereum/eth2.0-pm/issues/103",
        "created_at": "2019-12-05T02:32:34.965000+00:00",
        "attachments": null
    },
    {
        "author": "sassal",
        "category": "general",
        "parent": "",
        "content": "hey guys ðŸ™‚ have a question here (apologies if ive missed it before). is there an ETA on when the deposit contract is going live on mainnet? ðŸ™‚",
        "created_at": "2019-12-05T03:47:19.665000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "Runtime Verificaton will be publishing their full formal veirifcation, analysis, and report within the month. Once that is published, we can depy the contract.\nI am a little hesitant to deploy the official contract until we have gone through a public multi-client testnet to sanity check this process. That said, I don't expect particular issues with that component as there are a number of single client testnets using the deposit contract as is.\n\nI know this item is important for the community as a signal that things are moving forward. Once the RV report is out this month, we can discuss a good date.",
        "created_at": "2019-12-05T04:02:33.564000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "eth2 call in 10 hours\nagenda: https://github.com/ethereum/eth2.0-pm/issues/108\nlivestream: https://www.youtube.com/watch?v=MxeEWmEdb5E\nchatbox: https://www.youtube.com/live_chat?v=MxeEWmEdb5E\u0026is_popout=1",
        "created_at": "2019-12-05T04:03:10.309000+00:00",
        "attachments": null
    },
    {
        "author": "sassal",
        "category": "general",
        "parent": "",
        "content": "awesome! thank you for the update \u003c@291925846556540928\u003e - ill try to make the call if i can",
        "created_at": "2019-12-05T04:04:42.547000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "\u003c@291925846556540928\u003e regarding the deposit contract, do you think that this statement should hold true for the deposit contract?\n\n    \"If the deposit contract is given a deposit with specific withdrawal credentials it should result in either the deposited amount being withdrawable by those credentials or the deposit rejected.\"\n\nGiven the prevalence of scammers in the crypto world who could exploit this without users being aware (given they'll have no knowledge they have been scammed for a year or so without having a deep understanding of the deposit contract) it does seem to me that shipping the contract with the exploit I mentioned last week is not the best of moves.",
        "created_at": "2019-12-05T08:12:26.798000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "\u003c@291925846556540928\u003e is it in 20 mins? or did I miss some daylight saving changes?",
        "created_at": "2019-12-05T13:42:05.015000+00:00",
        "attachments": null
    },
    {
        "author": "pscott1337",
        "category": "general",
        "parent": "",
        "content": "\u003c@570268431522201601\u003e if you follow the link (https://www.youtube.com/watch?v=MxeEWmEdb5E) you can get a little timer ðŸ˜„",
        "created_at": "2019-12-05T13:42:49.471000+00:00",
        "attachments": null
    },
    {
        "author": "pscott1337",
        "category": "general",
        "parent": "",
        "content": "short answer is yes 17 minutes ðŸ™‚",
        "created_at": "2019-12-05T13:43:16.121000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "I should have an autoping on zoom link ðŸ˜‰",
        "created_at": "2019-12-05T13:43:19.970000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "20 minutes! Just getting up over here",
        "created_at": "2019-12-05T13:43:21.473000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "\u003c@144468805697929216\u003e, I am unsure how this actually operates as an exploit. The only withdrawal credentials that can be recorded on the beacon chain are those that were originally signed in the proof of possession by the signing key\nA scammer can then only send the validator eth as subsequent proof of possession TXs to that pubkey are not validated on beacon chain",
        "created_at": "2019-12-05T13:45:59.716000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "Can't get into a discussion about this now. Have to setup up the stream, but I'll followup after",
        "created_at": "2019-12-05T13:46:14.827000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "eth2 call in 8 minutes\nagenda: https://github.com/ethereum/eth2.0-pm/issues/108\nlivestream: https://www.youtube.com/watch?v=MxeEWmEdb5E\nchatbox: https://www.youtube.com/live_chat?v=MxeEWmEdb5E\u0026is_popout=1\nzoom: https://ethereumfoundation.zoom.us/j/352229383",
        "created_at": "2019-12-05T13:51:38.591000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "\u003c@291925846556540928\u003e it's a front-running exploit.  It assumes the validator and staker are separate parties (which I don't believe is unreasonable; there must be many out there who hold Ether and want to stae but don't have the ability/desire to run validators) and it allows the (malicious) validator to front-run the deposit by the (honest) staker.  The staker believes they have deposited with withdrawal credentials A but because the validator front-ran the deposit with withdrawal credentials B their withdrawal credentials are ignored and the validator gains control of the funds.\n(And yeah, understand about the call)",
        "created_at": "2019-12-05T13:54:50.447000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "The 1st validator's deposit would fail on the beacon chain due to the failed proof of possession signautre",
        "created_at": "2019-12-05T13:59:36.305000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "can talk more after!",
        "created_at": "2019-12-05T13:59:38.848000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "call now!",
        "created_at": "2019-12-05T13:59:40.053000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "This first (malicious) deposit sends 1 Ether of its own funds, and is in all ways a valid deposit.  It just happens to be processed prior to the second (honest) deposit.  Both have the same validator public key, both are valid deposits, but have different withdrawal credentials.",
        "created_at": "2019-12-05T14:23:00.358000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "My notes: https://gist.github.com/mratsim/b1fe4213ece4b60baa93be773715fd83 unfortunately I had a spotty internet and it completely dropped around the end.",
        "created_at": "2019-12-05T14:59:17.232000+00:00",
        "attachments": null
    },
    {
        "author": "eth2_gitter_bot",
        "category": "general",
        "parent": "",
        "content": "\u003cbenjaminion\u003e And from me: https://hackmd.io/@benjaminion/H1J8vYLaS",
        "created_at": "2019-12-05T15:04:19.772000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "\u003e This first (malicious) deposit sends 1 Ether of its own funds, and is in all ways a valid deposit.  It just happens to be processed prior to the second (honest) deposit.  Both have the same validator public key, both are valid deposits, but have different withdrawal credentials.\n\n\u003c@144468805697929216\u003e The deposit must sign over the deposit data which includes the pubkey and withdrawal credentials. The front-runner cannot produce a valid signature unless they have already compromised the user's key. \nThe front-runner's deposit in this case would make it through the deposit contract, but when included on the beacon chain would be invalid and would not be added. The front-runner's eth would then be lost. The real deposit would come through second, have a valid signature, and be processed into validation with no problem",
        "created_at": "2019-12-05T16:37:59.010000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Which signature would be invalid in the first deposit?",
        "created_at": "2019-12-05T16:56:03.328000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "The malicious deposit contains the validator public key (which the validator has, being the malicious party), the withdrawal credentials (which the validator supplies), the signature (again valid because the malicious validator has the private key) and an amount of 1 Ether. They send it from their Ethereum 1 account, which has sufficient Ether. It is a valid tx.",
        "created_at": "2019-12-05T17:02:40.622000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "It is validly processed in the deposit contract, but a failed signature (if no validator record exists for hte pubkey in the beacon chain yet) results in a failed deposit into the beacon chain",
        "created_at": "2019-12-05T17:03:38.441000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "In `process_deposit` (https://github.com/ethereum/eth2.0-specs/blob/master/specs/core/0_beacon-chain.md#deposits) see `if pubkey not in validator_pubkeys:` and `if not verify: return`",
        "created_at": "2019-12-05T17:04:25.795000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "This results in a no-op to the baecon chain state and results in the loss of ether by the attacker",
        "created_at": "2019-12-05T17:04:43.881000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Why would that not verify?",
        "created_at": "2019-12-05T17:05:14.585000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "Think there's a misunderstanding here. If it's about a staking service the service has the key, can sign whatever, and the problem exists indeed. To be avoided by the validator making the initial deposit themselves (can be 1 ETH, to not activate immediately). Or by the staking service to open a bond that can be redeemed by the validator if the staking service uses a different withdrawal cred than promised for the bond. It's messy all around, but think simplicity and just securing the credentials yourself is at least some solution, to a problem very specific to an already non-ideal staking service model.",
        "created_at": "2019-12-05T17:05:22.758000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "Because the signature signs over the withdrawal credentials. so the front-runner can't change the withdrawal credentials unless they know the privkey and can resign the tx",
        "created_at": "2019-12-05T17:05:55.006000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "The front runner *defines* the withdrawal credentials on the beacon chain by being first deposit for that public key",
        "created_at": "2019-12-05T17:07:11.058000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "But they can't sign over the withdrawal credentials without the privkey to that pubkey.",
        "created_at": "2019-12-05T17:07:29.985000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "_if_ the attacker knows the privkey, then this could happen. If the user gives privkey to a custodial service, this is certainly a risk",
        "created_at": "2019-12-05T17:08:00.686000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "That's what jgm is saying, what if the service has the signing key?",
        "created_at": "2019-12-05T17:08:18.018000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Yes, the withdrawal credentials are to the exploiter's account",
        "created_at": "2019-12-05T17:08:18.542000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "The validator key but *not *the withdrawal key",
        "created_at": "2019-12-05T17:08:44.333000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "In this type of full-custody scenario, the deposit should be made by the user and then the credentials given to the service",
        "created_at": "2019-12-05T17:09:15.015000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Is \"pass private keys around\" really the answer to what is likely to be a common setup?",
        "created_at": "2019-12-05T17:10:33.067000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "I don't see this is a common setup at all\nthe normal custody scenario is someone shows up with non-units-of-32 ETH and their capital is split with other users into a a single validator. In such a case, the custodian can't assign multiple withdrawal credentails for the same validator (but multiple user's eth)",
        "created_at": "2019-12-05T17:11:07.675000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "I also don't see how you could get around this without \"passing keys around\".\n\nAre you suggesting that there should be a \"claim\" function on the dpeosit contract in which I can claim a pubkey/withdrawal credentails without signing over it?",
        "created_at": "2019-12-05T17:12:00.171000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "This is the case whenever someone has 32 Ether or more and wants someone else to run the validator process for them",
        "created_at": "2019-12-05T17:12:16.623000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "My suggestion is to add a \"validator pubkey -\u003e withdrawal credentials\" mapping in the deposit contract and revert if a deposit is attempted with same validator but different withdrawal",
        "created_at": "2019-12-05T17:14:38.389000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "I understand that, but how am I now protected as a user?\n\nI think the following flow satisfies the scenario you are concerned about and I don't think we need the extra mappng in the contract:\n* user contacts custodian to setup an account and sends them their proposed withdrawal credentials and amount intended to deposit\n* custodian sends what will be the pubkey back to user and sends a signature over the deposit data (including withdrawal credentials)\n* user makes the ETH deposit with the agreed upon data and signature from the custodian, knowing that the custodian provably has the pubkey and that the deposit will be made against the correct withdrawal credentials",
        "created_at": "2019-12-05T17:20:04.284000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "---------\nWith the mapping added, it still requires at least 1 eth deposit to be made and for a correct signature to \"claim\" the pubkey/withdrawal combo. I don't really see how this could be used safely without passing privkeys around.",
        "created_at": "2019-12-05T17:21:06.658000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "This attack is by  a malicious validator service. They can always front run the honest deposit.\n\nI'm obviously failing to describe this accurately, for which please accept my apologies. I'll write it up fully and post an update to the ethresear.ch thread and link it here (will be tomorrow now as I'm away for the rest of the day)",
        "created_at": "2019-12-05T17:25:21.261000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "No, you're right. My method is flawed, but I'm unclear as to how the mapping in the contract would help in practice",
        "created_at": "2019-12-05T18:42:38.978000+00:00",
        "attachments": null
    }
]