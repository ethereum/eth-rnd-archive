[
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "Hello! I was looking over `process_attestation` (https://github.com/ethereum/eth2.0-specs/blob/dev/specs/core/0_beacon-chain.md#attestations) for bring Prysm up to date with the spec but I noticed a few things that confused me.\n\n```\n    committee = get_crosslink_committee(state, data.target.epoch, data.crosslink.shard)\n    assert len(attestation.aggregation_bits) == len(attestation.custody_bits) == len(committee)\n\n    pending_attestation = PendingAttestation(\n        data=data,\n        aggregation_bits=attestation.aggregation_bits,\n        inclusion_delay=state.slot - attestation_slot,\n        proposer_index=get_beacon_proposer_index(state),\n    )\n\n    # Check bitlist lengths\n    committee_size = get_committee_count(state, attestation.data.target.epoch)\n    assert len(attestation.aggregation_bits) == committee_size\n    assert len(attestation.custody_bits) == committee_size\n```\n\n\nWhy is the bitlist length check performed twice? \nWouldn't \n```assert len(attestation.aggregation_bits) == committee_size\nassert len(attestation.custody_bits) == committee_size``` \nbe the same as \n```assert len(committee) == committee_size```\nbased on the earlier conditions? \nIf so, is that an accurate condition to expect?",
        "created_at": "2019-08-27T14:58:47.695000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "The committee is derived from the state and the epoch/shard.\nThe check for the correct bitlengths is related to the well-formedness of the attestation bitlists wrt this expected committee size. You need the independent checks",
        "created_at": "2019-08-27T15:02:22.687000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "also what code are you drawing that from? The bitlengths should be checked against the length of the committee rather than the number of committees in the epoch",
        "created_at": "2019-08-27T15:02:53.501000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "I got that code from the spec, in `process_attestation` https://github.com/ethereum/eth2.0-specs/blob/dev/specs/core/0_beacon-chain.md#attestations",
        "created_at": "2019-08-27T15:03:21.148000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "`get_committee_count` is not the correct function and isn't at that link",
        "created_at": "2019-08-27T15:03:34.030000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "also I recommend reading the spec at `master` or at the `tag` specific to the release you are working on",
        "created_at": "2019-08-27T15:03:54.441000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "`dev` is not at parity with the releases",
        "created_at": "2019-08-27T15:04:03.279000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "aaah",
        "created_at": "2019-08-27T15:04:21.142000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "Good point, I'll stick to master",
        "created_at": "2019-08-27T15:04:25.110000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "I see",
        "created_at": "2019-08-27T15:04:26.810000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "sory",
        "created_at": "2019-08-27T15:04:28.601000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "But I'm still seeing the function used there",
        "created_at": "2019-08-27T15:04:34.136000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "no worries",
        "created_at": "2019-08-27T15:04:49.873000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "```\n    # Check bitlist lengths\n    committee_size = get_committee_count(state, attestation.data.target.epoch)\n    assert len(attestation.aggregation_bits) == committee_size\n    assert len(attestation.custody_bits) == committee_size\n```\n\nthat looks totally wrong",
        "created_at": "2019-08-27T15:04:52.536000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "and is not in `master`",
        "created_at": "2019-08-27T15:04:58.688000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "Yeah right? It really goofed me",
        "created_at": "2019-08-27T15:05:11.636000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "looks like a bad merge or something",
        "created_at": "2019-08-27T15:05:26.652000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "I'll get that cleaned up in `dev`. still recommend working directly off of the release version you are targeting",
        "created_at": "2019-08-27T15:05:45.434000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "Yeah, I'll do that",
        "created_at": "2019-08-27T15:05:54.863000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "(sorry for my initial confusion. thanks for the heads up!)",
        "created_at": "2019-08-27T15:06:05.592000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "While you're at it, make sure you `committee_size = get_committee_count(state, attestation.data.target.epoch)` change this to use `data`.",
        "created_at": "2019-08-27T15:06:09.740000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "(if that line is still in the function)",
        "created_at": "2019-08-27T15:06:18.058000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "it'll be removed",
        "created_at": "2019-08-27T15:06:29.865000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "üëç",
        "created_at": "2019-08-27T15:06:34.677000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "So that whole segment would be removed?",
        "created_at": "2019-08-27T15:06:46.295000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "```\n    # Check bitlist lengths\n    committee_size = get_committee_count(state, attestation.data.target.epoch)\n    assert len(attestation.aggregation_bits) == committee_size\n    assert len(attestation.custody_bits) == committee_size\n```",
        "created_at": "2019-08-27T15:06:53.378000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "yeah, looks like it snuck in in some weird PR that was a bit out of date",
        "created_at": "2019-08-27T15:06:53.928000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "yes",
        "created_at": "2019-08-27T15:06:56.081000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "üëç",
        "created_at": "2019-08-27T15:07:04.626000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "I'll switch to master",
        "created_at": "2019-08-27T15:07:11.643000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "surprised the tests are passing on dev tbh...",
        "created_at": "2019-08-27T15:07:26.039000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "yeah right? I was wondering how that got through haha",
        "created_at": "2019-08-27T15:07:41.952000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "I can submit a PR if you're busy to take it now btw",
        "created_at": "2019-08-27T15:09:56.004000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "I think mainnet config tests would fail right now. Seems that the committee count and the size of the committees happen to be equivalent for tests in `minimal` config",
        "created_at": "2019-08-27T15:09:58.883000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "I'm on it. thanks!",
        "created_at": "2019-08-27T15:10:06.623000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "üëç",
        "created_at": "2019-08-27T15:10:10.280000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "Ahh yeah that makes a bit more sense",
        "created_at": "2019-08-27T15:10:50.139000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "yeah, weird coincidence (and one that I might change a few things in tests to avoid)",
        "created_at": "2019-08-27T15:11:15.449000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "üôÇ",
        "created_at": "2019-08-27T15:13:08.654000+00:00",
        "attachments": null
    }
]