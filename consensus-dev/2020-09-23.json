[
    {
        "author": "prestonvanloon",
        "category": "general",
        "parent": "",
        "content": "Does anyone want to talk out eth2 planned forks with me?",
        "created_at": "2020-09-23T20:37:03.660000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "general",
        "parent": "",
        "content": "\u003c@!203220829473996800\u003e ?",
        "created_at": "2020-09-23T20:37:06.923000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "You mean the process of forking, or the forks themselves?",
        "created_at": "2020-09-23T20:38:36.288000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "general",
        "parent": "",
        "content": "I'm brain storming how a planned for might be executed. First, thinking about when to update the \"fork\" in the state",
        "created_at": "2020-09-23T20:38:37.336000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "general",
        "parent": "",
        "content": "a fork is \n```python\nclass Fork(Container):\n    previous_version: Version\n    current_version: Version\n    epoch: Epoch  # Epoch of latest fork\n```",
        "created_at": "2020-09-23T20:38:53.664000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "general",
        "parent": "",
        "content": "when do we insert this into the state? when state.epoch == fork.epoch?",
        "created_at": "2020-09-23T20:39:11.886000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "My understanding is yes, at an epoch boundary, and the epoch then invalidates new signatures for old pre-fork epochs.",
        "created_at": "2020-09-23T20:42:52.629000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "For full details I'd open a spec issue though",
        "created_at": "2020-09-23T20:43:01.542000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "general",
        "parent": "",
        "content": "I am assuming we would insert it prior to state.epoch == fork.epoch since we have logic that reads the state.fork and chooses previous version or current version based on the current epoch compared to fork epoch",
        "created_at": "2020-09-23T20:43:10.437000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "general",
        "parent": "",
        "content": "```python\ndef get_domain(state: BeaconState, domain_type: DomainType, epoch: Epoch=None) -\u003e Domain:\n    \"\"\"\n    Return the signature domain (fork version concatenated with domain type) of a message.\n    \"\"\"\n    epoch = get_current_epoch(state) if epoch is None else epoch\n    fork_version = state.fork.previous_version if epoch \u003c state.fork.epoch else state.fork.current_version\n    return compute_domain(domain_type, fork_version, state.genesis_validators_root)\n```",
        "created_at": "2020-09-23T20:44:06.702000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "pretty much you'd have logic conditional upon an epoch number (similar to block number conditioning in eth1)\nand at that epoch, you'd do an irregular state transition to mod the fork version and any other state/container changes\n\nan example of the irregular state change/upgrade can be seen in the phase1-fork.md doc\n\nhttps://github.com/ethereum/eth2.0-specs/blob/dev/specs/phase1/phase1-fork.md",
        "created_at": "2020-09-23T20:46:33.011000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "general",
        "parent": "",
        "content": "OK great, this is making sense. So we define a fork, using the fork container/class AND a slot on which to apply / insert the fork into the state? \n\nIn the config, could we have a FORK_SCHEDULE or similar property? Perhaps in the format of `map[Slot]-\u003eFork`?",
        "created_at": "2020-09-23T20:50:09.940000+00:00",
        "attachments": null
    },
    {
        "author": "prestonvanloon",
        "category": "general",
        "parent": "",
        "content": "I'd be happy to file an issue and/or propose a PR, if that helps",
        "created_at": "2020-09-23T20:50:33.980000+00:00",
        "attachments": null
    }
]