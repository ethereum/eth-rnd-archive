[
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "the specs are filling up with variations of\n```python\n    # Verify pubkey exists\n    source_pubkey = consolidation_request.source_pubkey\n    validator_pubkeys = [v.pubkey for v in state.validators]\n    if source_pubkey not in validator_pubkeys:\n        return False\n  # usually followed by source_index = ValidatorIndex(validator_pubkeys.index(request_source_pubkey) or similar for third linear search\n```\nthis is unviable in anything but hand-controlled tests. At some point maybe just have this be functionality defined the way other functionality intrinsically dependent on implementation details outside the scope of the executable specs. they need some version of this, but it's misleading to mix it with otherwise very reasonable sequences of `if` statements, et cetera",
        "created_at": "2024-10-05T04:43:43.510000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "e.g., for execution payload things, the spec doesn't pretend to define a network interface, it just assumes CLs will somehow",
        "created_at": "2024-10-05T04:44:58.370000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "and the issue is, it's not even pedagogically better really. it's a lot of fluff for what in idiomatic Python would be a short, fairly readable one-linear-search thing. Yeah, it would be Python-specific, but this isn't usable code directly anyway",
        "created_at": "2024-10-05T05:44:44.159000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "why does https://github.com/ethereum/consensus-specs/blob/v1.5.0-alpha.7/specs/electra/beacon-chain.md#new-process_consolidation_request check the both `process_consolidation_request` do this absurd duplicated/triplicated search, then call `is_valid_switch_to_compounding_request` to do it again? why does the\n```python\n\n    # Switch to compounding requires source and target be equal\n    if consolidation_request.source_pubkey != consolidation_request.target_pubkey:\n        return False\n```\ncheck occur in both? why is the\n```python\n\n    # Verify the source is active\n    current_epoch = get_current_epoch(state)\n    if not is_active_validator(source_validator, current_epoch):\n        return False\n```\ncheck duplicated in both? why is the\n```python\n\n\n    # Verify exit for source has not been initiated\n    if source_validator.exit_epoch != FAR_FUTURE_EPOCH:\n        return False\n```\ncheck in both? why anything I guess",
        "created_at": "2024-10-05T06:05:09.127000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "oh, right, and process_consolidation_request spends like 1/3 of its LoC doing yet another set of these validator index searches in the middle",
        "created_at": "2024-10-05T06:15:32.156000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "just say it's magic and be done with it",
        "created_at": "2024-10-05T06:19:00.926000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "you mean having helpers like `is_existing_validator` and maybe `get_validator_index_by_pubkey`?",
        "created_at": "2024-10-05T22:30:57.941000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "essentially",
        "created_at": "2024-10-05T22:31:58.049000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "There are twofold semantics and the two pipelines are separated now, this is done mainly for readability",
        "created_at": "2024-10-05T22:32:03.107000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "They are a bit different and mixing the two would be less readable, they also have duplicate `switch_to_compounding_validator` action",
        "created_at": "2024-10-05T22:33:34.359000+00:00",
        "attachments": null
    }
]