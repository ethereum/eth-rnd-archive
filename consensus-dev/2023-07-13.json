[
    {
        "author": "rishabhvasudevan",
        "category": "general",
        "parent": "",
        "content": "Can anyone please help me out with this problem : https://ethereum.stackexchange.com/questions/152416/number-of-validators-in-a-committee-for-a-particular-slot-is-not-equal-to-the-nu",
        "created_at": "2023-07-13T10:04:21.532000+00:00",
        "attachments": null
    },
    {
        "author": "rishabhvasudevan",
        "category": "general",
        "parent": "",
        "content": "I don't seem to understand what could be the reason for this",
        "created_at": "2023-07-13T10:04:36.917000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "did you correctly decode the aggregation bits? i haven't looked too closely but you may be counting the extra top bit in the serialization which should be excluded from the count",
        "created_at": "2023-07-13T13:39:15.607000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "if you have 5 extra validators then perhaps the framing is binary 5 and you should be ignoring that",
        "created_at": "2023-07-13T13:39:44.841000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "left the answer with the explanation there, bitlists are serialized to a full byte, but the last set bit indicates it's end",
        "created_at": "2023-07-13T14:01:15.926000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "https://ethereumfoundation.zoom.us/j/91725886939?pwd=b2kzT0JGeFAzTmhyb1BYSTgrZ0xwdz09",
        "created_at": "2023-07-13T14:01:59.399000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "\u003c@755590043632140352\u003e I am recalling you were concerned about reducing the aggregation section of a slot as it is almost at capacity with current load. Can validator set size doubling or tripling make it unmanageable in your opinion?",
        "created_at": "2023-07-13T14:56:54.547000+00:00",
        "attachments": null
    },
    {
        "author": "rishabhvasudevan",
        "category": "general",
        "parent": "",
        "content": "Hey \u003c@755590043632140352\u003e, Thank you for the answer, but I still didn't completely understand what you were trying to explain. `0x0f` is not 0 if I convert it to binary. Could you help me understand this? And could you also expalain with `0x473194651448d9c75d267229236d0af0a1ca672d69dafdfeb2050ba687d077e6`  please?",
        "created_at": "2023-07-13T15:01:00.761000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I think the right people to get involved in the discussions around validator size growth are the experts on networking. From the parts of prysm that I know well, I think we can handle 2M vals with better caching systems. I suspect the biggest impact is on gossip validation, peering and overal network delays. I'd ping \u003c@498009160982724610\u003e \u003c@476250636548308992\u003e for input on the issue of validator size.  Aggregation is not a problem for the small staker, and it won't be at 2M, for the bigger operator I don't really mind if they need to buy beffier machines. I think we should aim to be at a place where a single staker connected to its own subnet can handle large validators sets, and large stakers connected to all can, although they may need to upgrade hardware",
        "created_at": "2023-07-13T15:02:42.510000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "the byte `0x0f` which is the last one, reads as the sequence of bits `{true, true, true, true, false, false, false, false}` The last `true` indicates the actual end of the sequence, so that byte alone means `{true, true, true}`",
        "created_at": "2023-07-13T15:04:15.172000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "I am not that much concerned about networking, considering attnet revamp rollout plan the bandwidth increase should be manageable. What I am personally more concerned is computational complexity. If this is not a concern of client teams then we're really fine to handle 2M. I agree that we should check out with networking ppl but from what I know so far networking shouldn't be an issue",
        "created_at": "2023-07-13T15:05:41.242000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I cannot explain with `0x473194651448d9c75d267229236d0af0a1ca672d69dafdfeb2050ba687d077e6` cause that's a different length, but in any case this bitset is a bitset for 255 bits. \n1. You can see this as follows: the string has length 66, \n2. Subtract 2 for the `0x` part. get 64\n3. Divide by 2 since 2 characters form a byte: get 32 bytes.\n4. Multiply by 8 to get 256 bits.\n5. Analyze the last byte, its last 4 bits are `0xe` which correspond to the bits `{false, true, true, true}` . So the very last bit in this sequence is also the marker for the end. So this sequence encodes 255 bits. The last three of which are `{false, true, true}`.",
        "created_at": "2023-07-13T15:09:38.715000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "we need to test this rather than speculate around this problem, if we can deploy a working network and cause some reorgs around epoch transition, see some cache misses and state regens with 2M states, we will see how much we bleed.",
        "created_at": "2023-07-13T15:10:48.843000+00:00",
        "attachments": null
    },
    {
        "author": "rishabhvasudevan",
        "category": "general",
        "parent": "",
        "content": "\u003c@755590043632140352\u003e Thank you so much now I understand it",
        "created_at": "2023-07-13T15:13:36.943000+00:00",
        "attachments": null
    },
    {
        "author": "rishabhvasudevan",
        "category": "general",
        "parent": "",
        "content": "\u003c@755590043632140352\u003e if I understand it right, we read the bytes from left to right. But inside the byte we read from right left? and the zeros after the last set bit are ignored?",
        "created_at": "2023-07-13T15:15:43.579000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "correct",
        "created_at": "2023-07-13T15:16:22.911000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "the specification is here",
        "created_at": "2023-07-13T15:16:28.435000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "https://github.com/ethereum/consensus-specs/blob/dev/ssz/simple-serialize.md",
        "created_at": "2023-07-13T15:16:40.034000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "I don't know if we can have this kind of test with a number of nodes that we consider as enough, this number should not be as the mainnet one but not as small as 10. \u003c@199561711278227457\u003e  what would be a rough estimation on a max number of nodes that we can set up in a devnet?",
        "created_at": "2023-07-13T15:16:40.664000+00:00",
        "attachments": null
    },
    {
        "author": "rishabhvasudevan",
        "category": "general",
        "parent": "",
        "content": "\u003c@755590043632140352\u003e thanks",
        "created_at": "2023-07-13T15:17:42.103000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "just for the record since DappLion also contacted me asking about this: the issue of aggregation on prysm has now gone down by a lot: the average small staker needs just a few milliseconds to aggregate on average and the largest nodes highly connected would need about 200ms. The very worst case scenario after reorgs and cache misses has gone to 800ms.\n\nSo to stress again: the issue with validator registry increase is not the slow degradation of our performance but rather some regime change that exponentiates a current flaw, as we saw with the \"old attestations\" issue a couple of months ago",
        "created_at": "2023-07-13T15:18:58.385000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "general",
        "parent": "",
        "content": "We've done up to 300 nodes(650k validators) and we have the tooling to hit 1000-1500 node networks now. it'll take a few days to setup and the cost definitely needs to be justified, but we have the ability now.\n\njust wanna also point out that Holesky is planned for september and will have 1.5M validators at genesis with a decent number of nodes.",
        "created_at": "2023-07-13T15:20:21.628000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "We can probably start Holesky with say 1k nodes, do testing, and then reduce this number to cut the costs",
        "created_at": "2023-07-13T15:24:03.237000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "By the way \u003c@425572898787426305\u003e when I say networking I don't mean bandwidth: I mean also computation, gossip validation takes longer if you need to validate a lot of messages, and block propagation was causing reorgs on slot 1 a few weeks ago as an example",
        "created_at": "2023-07-13T15:24:49.120000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Or just have a separate network for 2M stress test to avoid messing up the Holesky",
        "created_at": "2023-07-13T15:24:51.905000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Oh, I see. When I was saying \"aggregation\" it implied computational cost of attestation dissemination as well as the aggregation itself",
        "created_at": "2023-07-13T15:25:40.528000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "So attestation validation is not a current bottleneck as far as I know, aggregation was a problem for us that I think we have greatly reduced now",
        "created_at": "2023-07-13T15:26:31.635000+00:00",
        "attachments": null
    },
    {
        "author": "rishabhvasudevan",
        "category": "general",
        "parent": "",
        "content": "\u003c@755590043632140352\u003e when I run the `/eth/v1/beacon/blocks/{block_id}/attestations` it doesn't return the slot that I passed in the parameter, it is usually `slot_passed - 1`. Do you know the reason for this and how this can be solved?",
        "created_at": "2023-07-13T18:06:21.906000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I don' t think that's the case, you will see attestations that were included in the block with `slot` , which typically will be attestations cast during `slot -1`",
        "created_at": "2023-07-13T18:51:42.184000+00:00",
        "attachments": null
    },
    {
        "author": "rishabhvasudevan",
        "category": "general",
        "parent": "",
        "content": "Oh ok thanks",
        "created_at": "2023-07-13T19:53:15.711000+00:00",
        "attachments": null
    }
]