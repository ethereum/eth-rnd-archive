[
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "\u003c@!841217748942979072\u003e I've left some comments in the PR, I don't understand the 1/2 figure you're getting. I do however believe that you are right that the tradeoff seems to point that it is better to optimize for `l=2`  than for `l=1`. On the other hand, it would be good to have more numbers on this. If my comments in the PR are right, my understanding is that going from a `W_PB = 1/3`  to `W_PB = 0.4`, we would lose protection against simple ex-post reorgs for `0.3 \u003c \\beta \u003c 1/3`  but gain protection against ex-ante reorgs for `0.17 \u003c \\beta \u003c 0.20`  but on the other hand **lose** protection against l=2 sandwiches for `0.2 \u003c \\beta \u003c 0.22`.  It is not entirely clear to me why the choices made in this PR.  In particular, we would be gaining protection against infrequent attacks (as they are l=2) by smaller attackers, and would be loosing protection against more frequent attacks than those since the \\beta's are higher for the sandwiches we lose protection. Even if I got my figure of 1/3 wrong in that comment (that I think I didn't). I propose the following hard number to compute: Let us assume that on any succesful l=1 attack costs `x` (call x whatever it is that you want to measure, it could be ETH, or social heat from the community or whatever you want to model). And any succesul l=2 attack costs `y`. It should be easy to model given that the frequencies for a given \\beta attacker are simple, to compute the amount that would be gained or lost by moving from 1/3 to 0.4.",
        "created_at": "2022-05-18T13:38:22.100000+00:00",
        "attachments": null
    },
    {
        "author": "kommstar",
        "category": "general",
        "parent": "",
        "content": "\u003c@648067648038633492\u003e I am responding to your question from \u003c#692062809701482577\u003e , I think the devs are heads down trying to get things ready over there\n\nhttps://discord.com/channels/595666850260713488/692062809701482577/976479304517034086\n\nI believe the consensus chain will continue to run and collect attestations (otherwise how would it know about inactivity) but nothing will finalize until 66% consensus threshold is met again",
        "created_at": "2022-05-18T16:12:26.898000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "\u003c@!425572898787426305\u003e re your comment in Caspar's PR (that I don't want to pollute)\n\u003e I am curious about the intention behind the change introduced in this PR #2878. If on_tick happens before the moment when proposer computes the head for its proposal then proposer boost from the previous slot is reset thus not impacting the head computation that a current slot proposer is performing to obtain the head. If on_tick happens after then it's not clear how attestations from the previous slot could be applied (they couldn't because attestation slot is checked against the current slot in the store which is advanced by on_tick) So, my guess is the former but I think the honest validator spec should be more explicit about it.\nIndeed it is a subtle topic but I believe prysm's implementation is what I think is intended in that PR. When we are about to prospose a block in slot N+1 we count:\n1_ attestations for block N that we saw\n2_ ~~proposer boost for our previous head if it was applied and was not subsequently removed in next slots.~~ I take this back, actually our current implementation after we applied the patch to implement Michael's PR, removes the proposer boost when calling head in this slot.",
        "created_at": "2022-05-18T19:37:03.941000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "cc \u003c@!363800010518822915\u003e",
        "created_at": "2022-05-18T19:37:16.578000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "\u003c@!841217748942979072\u003e Those numbers above were based in my understanding that the `\\beta` would matter and thus giving a `1/3` as equilibrium for `l=1`.  That beta will count for proposals at N+2, but it's irrelevant for the head computation of attesters at N+1 so I agree with you, so there's no actual losing of protection of sandwiches for  `0.2 \u003c \\beta \u003c 0.22`, and I'm OK with the 40% proposed.",
        "created_at": "2022-05-18T20:06:11.593000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "hmm, that's an interesting question.  When running fork choice prior to proposing should we remove the previous proposer boost or not? It kind of feels like we shouldn't because the point was to make it so an ontime block would be more likely to be selected as head when building the next block.  But that's a pretty significant change to proposer boost if it last into the next slot.",
        "created_at": "2022-05-18T21:52:31.434000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I think it's fine to remove it as the spec implies currently, this was my confusion in the reviewing of the proposal: We use proposer boost to select our head in slot N to attest, and after all attestations are set and done, we don't care about it anymore. Taking the proposer boost weight into account to propose a block  will give it too much power: first directly in the weight, and second indirectly cause it influenced the attestations that we just processed",
        "created_at": "2022-05-18T21:58:19.741000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Incidentally and as a side-story: we got spec compliance by chance! I asked Terence before posting my message above just to confirm and we both had understood that PB was still being applied. We removed it by a quirk in how PB is implemented in prysm. This calls for a spec test",
        "created_at": "2022-05-18T22:00:02.488000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "ah yes, of course that makes sense.  We now have attestations from the previous slot in the mix and *they* considered proposer boost so we don't need to.",
        "created_at": "2022-05-18T22:00:18.928000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "how are client teams expecting to use the `prepareBeaconProposer` endpoint that is defined in the API specs currently?\n\nlets put aside external block building for the moment; is this how validators communicate their fee recipient prefs when building locally?",
        "created_at": "2022-05-18T22:27:18.541000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "since we have migrated the external builder part out to a separate endpoint, i have to wonder if there is a significant difference w/ just sending the fee recipient as a parameter to `produceBlockV2`",
        "created_at": "2022-05-18T22:28:22.271000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "i can update the `bellatrix` validator specs with this information once i understand the intent",
        "created_at": "2022-05-18T22:28:57.093000+00:00",
        "attachments": null
    }
]