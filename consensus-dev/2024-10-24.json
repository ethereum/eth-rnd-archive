[
    {
        "author": "francis.li",
        "category": "general",
        "parent": "",
        "content": "Hey y'all, would love some amplification for https://x.com/0xFrancisLi/status/1849469356410839462, asking validators to upgrade their clients so that we could see the real benefits of IDONTWANT messages üôè",
        "created_at": "2024-10-24T15:50:39.003000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "general",
        "parent": "",
        "content": "\u003c@720075860807254059\u003e https://github.com/ethereum/execution-apis/pull/599 question on this, just to reconfirm, we want to add a byte for the type to the ssz list of requests, and we want to exclude requests that are an empty list like no consolidations we would just have deposit and withdrawal requests in the array of data \nthis is not going all the way back to each request has their own type byte right üòÖ  I'm tripping up over this comment \"This is why I changed it back to being a list of requests instead of a list of request_data items.\"",
        "created_at": "2024-10-24T15:50:49.422000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "general",
        "parent": "",
        "content": "To be clear, we've decided to include this change in devnet-5?",
        "created_at": "2024-10-24T15:58:13.752000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "yes, what you describe is the intended change! add the type byte for each ssz list of requests, and skip the empty lists.",
        "created_at": "2024-10-24T16:00:41.585000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "\u003c@194432762315407360\u003e I have no strong opinion about the EL-side hashing, that was strange and janky throughout, but the engine API is simply not coupled to the EL changes. The idea that it has to be \"mirrored\" is, no.",
        "created_at": "2024-10-24T16:02:26.946000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "I understand you have a very different view on this than I have.",
        "created_at": "2024-10-24T16:04:31.518000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "I'm not really personally convinced of how compelling the stable empty hash is of this, but I'll stipulate it's useful. It's also achievable in many ways unrelated to the rest of your proposed engine API changes.",
        "created_at": "2024-10-24T16:05:11.134000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "What I mean is, you look at it from a different perspective, and what we are proposing doesn't make sense to you.",
        "created_at": "2024-10-24T16:05:13.233000+00:00",
        "attachments": null
    },
    {
        "author": "radekkapka",
        "category": "general",
        "parent": "",
        "content": "During the ACDC call we leaned towards ***not*** including it in PectrA at all. But because the view of things changed since the meeting and the PR regained the love, if we don't follow through with having it in devnet-5, it will basically mean that it falls out of the fork's scope, right?",
        "created_at": "2024-10-24T16:05:49.192000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "general",
        "parent": "",
        "content": "thanks for confirming! should have pinged you instead üòÖ saw you were set offline",
        "created_at": "2024-10-24T16:06:30.497000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "it's OK",
        "created_at": "2024-10-24T16:06:36.764000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "\u003c@654267572107083777\u003e we have discussed the two latest PRs on ACD today, and there was support from all EL teams for this. It really does simplify it for us.",
        "created_at": "2024-10-24T16:07:14.752000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "I was honestly hoping we will just find an easy agreement this time.",
        "created_at": "2024-10-24T16:07:31.439000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "Well, as before, I'm indifferent to the EL request commitment hashing",
        "created_at": "2024-10-24T16:07:57.375000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "general",
        "parent": "",
        "content": "During the ACDC call we leaned towards",
        "created_at": "2024-10-24T16:08:34.482000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "The point that I'm trying to make here is that we don't want to treat the list of requests that we use for the commitment differently from the list we use for the engine API. You are arguing from the perspective that they are totally different lists, but they're not, at least not for the EL. We can make them different but it's extra work.",
        "created_at": "2024-10-24T16:09:23.387000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "Right now they aren't different lists, either",
        "created_at": "2024-10-24T16:09:57.349000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "they are though",
        "created_at": "2024-10-24T16:10:04.050000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "we already have bifurcation because the type byte was removed from the engine API",
        "created_at": "2024-10-24T16:10:26.360000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "the hashing method is based on the same sequence-of-request-lists",
        "created_at": "2024-10-24T16:10:32.521000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "with a single request byte at the front, based on index",
        "created_at": "2024-10-24T16:10:43.619000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "I understand that's how you see it",
        "created_at": "2024-10-24T16:10:53.835000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "and here, to get the stable hash, can omit that list (the 0x01 or 0x02 or etc), no need to know the fork",
        "created_at": "2024-10-24T16:11:21.638000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "which for whatever reason is hard in Geth apparently",
        "created_at": "2024-10-24T16:11:28.321000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "the emptiness of the list is a fork-independent property",
        "created_at": "2024-10-24T16:11:40.829000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "But the 'index-is-type' thing does not work anymore when we remove an item.",
        "created_at": "2024-10-24T16:11:53.681000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "And therefore, I want to put the type back.",
        "created_at": "2024-10-24T16:12:05.777000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "in which part? engine API?",
        "created_at": "2024-10-24T16:12:09.028000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "or EL",
        "created_at": "2024-10-24T16:12:12.768000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "I just want to have the same definition of 'list of requests' everywhere",
        "created_at": "2024-10-24T16:12:46.207000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "That's how it is for us in EL.",
        "created_at": "2024-10-24T16:12:55.383000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "We compute this list in one place, then we put it through the commitment, and then we relay it on the engine API.",
        "created_at": "2024-10-24T16:13:15.909000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "In the place where we compute it, we add the type byte.",
        "created_at": "2024-10-24T16:13:41.951000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "So it should just stay in there.",
        "created_at": "2024-10-24T16:13:48.527000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "We also need the type byte on the engine API because empty requests items will be omitted.",
        "created_at": "2024-10-24T16:14:12.296000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "it's still simpler, because each engine API version can/will define some set of salient request lists. so send back lists numbered 3, 7, 9, and 20 in some future version (and accept them from newpayload)",
        "created_at": "2024-10-24T16:14:20.286000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "are we in agreement now?",
        "created_at": "2024-10-24T16:14:44.575000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "do you mean that, in this hypothetical version of the engine API, an `exectionRequests` list of `[0x03..., 0x07..., 0x09..., 0x14...]` is valid? If yes, then we are in agreement.",
        "created_at": "2024-10-24T16:16:21.131000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "well, this is particularly uncompelling to begin with",
        "created_at": "2024-10-24T16:16:22.544000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "ah, no, I mean, for that engine API, it would be predefined that the valid request are 0x03/0x07/0x09/0x14. that's what the \"deprecation\" I would read to mean, that for whatever reason we want a depositsv2 or something",
        "created_at": "2024-10-24T16:17:55.120000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "and it would then be fixed length of 4",
        "created_at": "2024-10-24T16:18:07.737000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "and part of the engine API is that mapping of types/index",
        "created_at": "2024-10-24T16:18:23.463000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "ahh that's what you mean",
        "created_at": "2024-10-24T16:18:29.797000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "Yeah, I wouldn't want that. It's easier if we have the type.",
        "created_at": "2024-10-24T16:18:46.658000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "the point here is that the engine API is recreated anew each time",
        "created_at": "2024-10-24T16:18:50.383000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "Yeah that's how you see it, I understand.",
        "created_at": "2024-10-24T16:19:02.804000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "But it's not really the case for us.",
        "created_at": "2024-10-24T16:19:11.079000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "it doesn't need and never has had extension points where we're still using newPayloadV1 with new parameters or something",
        "created_at": "2024-10-24T16:19:22.084000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "The implementation of the engine API is not created anew every fork.",
        "created_at": "2024-10-24T16:19:28.540000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "no, we're on newpayloadV4 now",
        "created_at": "2024-10-24T16:19:29.571000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "I see the EL part of Nimbus too, incidentally, and it handles things with a single newpayload/fcu each function, I've seen that structure too. it still knows what type it's receiving (V1/V2/V3/V4)",
        "created_at": "2024-10-24T16:20:24.596000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "and getpayload has to know what kind of payload to send back",
        "created_at": "2024-10-24T16:20:49.431000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "it's not and can't be entirely generic",
        "created_at": "2024-10-24T16:21:01.060000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "This index-type mapping you mention, just sounds like another reason to include the type byte on the engine API.",
        "created_at": "2024-10-24T16:21:38.101000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "I feel kind of strongly about it now. There are actually multiple reasons to do this.",
        "created_at": "2024-10-24T16:21:48.881000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "The current devnet-4 state, where the indexes map 1-to-1 with the types, is deceptively simple. If the CL will have to perform a more complicated mapping in a future fork, maybe even the next fork, then we might as well use the type byte. It's same-level complexity.",
        "created_at": "2024-10-24T16:23:47.139000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "it's still fixed in each case, with is the simplicity gain",
        "created_at": "2024-10-24T16:24:30.787000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "the other aspect is also the idea of separate list vs single list of items. this is basically separate from the type byte question, and omitting single items vs omitting empty lists is the same code basically (in your EL PR), and then one can keep the same lists on both side either way.\n\nSo the change from the lists to the individual prefixed items is also just kind of separate and not seemingly motivated by any of the stated reasons in your PRs",
        "created_at": "2024-10-24T16:34:26.699000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "Can you elaborate about this?",
        "created_at": "2024-10-24T16:35:18.817000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "Maybe there is a misunderstanding of the proposed changes.",
        "created_at": "2024-10-24T16:35:31.821000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "I do not propose we change the engine API to return individual request items.",
        "created_at": "2024-10-24T16:35:55.818000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "I only propose adding the type byte to the front of each SSZ requests list.",
        "created_at": "2024-10-24T16:36:24.300000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "general",
        "parent": "",
        "content": "\u003e  we want to add a byte for the type to the ssz list of requests, and we want to exclude requests that are an empty list like no consolidations we would just have deposit and withdrawal requests in the array of data \n\u003e this is not going all the way back to each request has their own type byte \nwhat i mentioned above üòÖ",
        "created_at": "2024-10-24T16:37:05.037000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "So for Pectra, valid `executionRequests` would be `[0x00..., 0x01..., 0x02...]`, or `[0x01..., 0x02...]` or `[0x00..., 0x02...]`",
        "created_at": "2024-10-24T16:37:31.937000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "\u003e My intention here is going back to request_type ++ request_data for each element, i.e. include the type byte. This is why I changed it back to being a list of requests instead of a list of request_data items.",
        "created_at": "2024-10-24T16:37:55.542000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "The first byte (type) of each `executionRequests` item must be `\u003e` the previous",
        "created_at": "2024-10-24T16:38:06.504000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "When I say element there, I mean element in `executionRequests`",
        "created_at": "2024-10-24T16:38:18.682000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "It's confusing because it's a list of lists. But since we don't really consider the inner lists to be 'lists' in the EL (they are just byte strings), when I say element, I mean 'elements of the outer list'.",
        "created_at": "2024-10-24T16:39:11.010000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "So my change proposal is really only about adding the type byte back onto the outer list elements, like we had in a previous iteration just before the final devnet-4 cut.",
        "created_at": "2024-10-24T16:39:44.589000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "ok",
        "created_at": "2024-10-24T16:40:14.304000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "can you agree to that?",
        "created_at": "2024-10-24T16:40:26.445000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "yeah",
        "created_at": "2024-10-24T16:40:31.468000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "nice!",
        "created_at": "2024-10-24T16:40:34.938000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "as you say, it's fairly easy for CLs too",
        "created_at": "2024-10-24T16:41:12.648000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "and this allows relatively straightforward error checking",
        "created_at": "2024-10-24T16:41:52.493000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "general",
        "parent": "",
        "content": "I wonder if there is something we can clarify in the specs to more clearly describe this change üòÖ",
        "created_at": "2024-10-24T16:42:30.204000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "yeah I'll think about it",
        "created_at": "2024-10-24T16:43:23.095000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "\u003c@194432762315407360\u003e I'm not sure the mapping goes away regardless, and in particular, with the more freeform version, the issue becomes, is it valid to send any known type byte-prefixed list even if it's not really supposed to be active during that fork. so for both CL and EL-side error checking, there would seem to have to be some per-fork list of acceptable type bytes",
        "created_at": "2024-10-24T17:23:46.279000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "the two general options here are to just allow it, but that allows potential nonsense through, and to define valid/invalid types prefixes per fork, but then that still becomes this list of, fork 1 allows [0x00, 0x01, 0x02], fork 2 allows [0x00, 0x01, 0x03], fork 3 adds a new one [0x00, 0x01, 0x03, 0x04], etc",
        "created_at": "2024-10-24T17:26:46.142000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "on the CL side, ultimately this gets translated back into a very inflexible state transition function. unless a particular fork's state transition function defines handling that specific kind of request, it can't be handled, and silently dropping entire request types is arguably worse than having an error. so any \"flexibility\" isn't really real here",
        "created_at": "2024-10-24T17:30:44.630000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "and, yeah, thinking through the whole thing -- since whether invalid request types get silently dropped or signal an error has to be a consensus, as far as I can tell, because otherwise different CL/EL pairs will diverge, this means this has to be defined in spec, and the generality of the type prefixes doesn't really help",
        "created_at": "2024-10-24T17:37:43.765000+00:00",
        "attachments": null
    },
    {
        "author": "lucassaldanhaconsensys",
        "category": "general",
        "parent": "",
        "content": "Sorry if I caused confusion. What I meant by my comment is that if we want to remove empty requests we needed to add the type byte back into the lists. And that was exactly what \u003c@194432762315407360\u003e had proposed but when I read it I missed that part (it was late at night when I did it... should't be commenting on PR that late tbh...) üòÖ",
        "created_at": "2024-10-24T20:44:50.929000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "general",
        "parent": "",
        "content": "all good, thanks, i think the explanation should be updated a little in general it took confirmation here to make sure",
        "created_at": "2024-10-24T21:16:06.722000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "Furthermore, the part of the space where it likely makes sense to specify this notion of valid and invalid potential requests plausibly looks to be the engine API (the other place being the consensus API, it's an awkward fit there for many reasons, the main one being that the consensus specs deal with this `ExecutionRequests` object which has already been decoded within that fork's specs, not potentially missing or extra request types, a notion of which it has no and should have no notion, those being an artifact of encoding/decoding them). \n\nSo the engine API strongly should, I'd even argue needs for consensus reasons, to specify a behavior regarding valid/invalid type prefix combinations. But this ends up being basically that \"map\".",
        "created_at": "2024-10-24T21:46:18.089000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "But in a form which creates potential error cases",
        "created_at": "2024-10-24T21:46:42.055000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "general",
        "parent": "",
        "content": "also if all of these are empty we still send an empty 2d byte array right üòÖ",
        "created_at": "2024-10-24T21:48:12.795000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "Well, the empty case is ok here",
        "created_at": "2024-10-24T21:48:39.390000+00:00",
        "attachments": null
    },
    {
        "author": "lucassaldanhaconsensys",
        "category": "general",
        "parent": "",
        "content": "You mean `executionRequests = []` ?",
        "created_at": "2024-10-24T21:49:02.417000+00:00",
        "attachments": null
    },
    {
        "author": "jameshe5018",
        "category": "general",
        "parent": "",
        "content": "right",
        "created_at": "2024-10-24T21:49:08.179000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "Yeah, I mean, empty execution requests is valid",
        "created_at": "2024-10-24T21:49:13.343000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "But this allows representing invalid type prefix sets too, 0x03 when there isn't any",
        "created_at": "2024-10-24T21:49:57.175000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "One can argue that the newPayload part of this is sort of the CL's responsibility -- the EL really wants to be able to able to do this generically, that's part of the point. But `getPayload` is coming from an entity which wants to be generic and wants to send arbitrary sets of type bytes, some of which might not be valid",
        "created_at": "2024-10-24T21:51:47.825000+00:00",
        "attachments": null
    },
    {
        "author": "nc1234",
        "category": "general",
        "parent": "",
        "content": "EL should just ignore 0x03 in this case. Similar (but not exactly same) logic is if you send an ExecutionPayloadV3 in a engine_newPayloadV2, the extra fields get ignored by EL",
        "created_at": "2024-10-24T21:51:48.857000+00:00",
        "attachments": null
    },
    {
        "author": "nc1234",
        "category": "general",
        "parent": "",
        "content": "\u003e But getPayload is coming from an entity which wants to be generic and wants to send arbitrary sets of type bytes, some of which might not be valid\nYea this is a mismatch of expectation between the supplier and consumer",
        "created_at": "2024-10-24T21:53:43.834000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "That's fine, if it's specified, along the lines of what should be (haven't checked if it is) that e.g., this duplicate type byte case which was advocated for as a useful \"flexible\" way of using this is checked for and considered an error. The specs have to be explicit on this point",
        "created_at": "2024-10-24T21:53:51.765000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "And, the fixed mapping resolves this one way, IMO a still better way, because, the engine APIs are not generic and never have been, but if this type byte approach is used, then it must be resolved some other way in the specs in a consistent/consensus way",
        "created_at": "2024-10-24T21:54:53.551000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "So ignore, or error, or whatever else, is fine as long as it's consistent",
        "created_at": "2024-10-24T21:56:01.703000+00:00",
        "attachments": null
    },
    {
        "author": "nc1234",
        "category": "general",
        "parent": "",
        "content": "So this type byte change is fine by you. You are just advocating to update the spec for the sake of consistency if this approach is accepted",
        "created_at": "2024-10-24T21:57:57.959000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "Yeah, more or less. I'm not going to pretend I think it's the best approach, because a protocol representation which doesn't allow invalid states I find superior to one which pretends to be flexible and generic but cannot possibly be and requires error handling and correction (detect/ignore) to achieve this, but sure.",
        "created_at": "2024-10-24T21:59:16.695000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "My still-favored approach is still basically current engine API + whatever hashing commitment allows for the invariants desired, e.g., consistent empty root hash, and it's kind of mystifying to me the pretending that given an EL spec proposal which advocates for adding\n```python\n  if len(requests) \u003e 1\n```\nalready, there's an engine API spec which is nominally justified by stating that it's due to caring about \"If we don't include empty lists, then EL does not have to remove them before calculating the hash, etc\".",
        "created_at": "2024-10-24T22:06:08.178000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "It checks for them right now, the argumentation isn't consistent even by the same person across those two PRs",
        "created_at": "2024-10-24T22:07:18.744000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "general",
        "parent": "",
        "content": "So yeah, I'm ... ok ... more or less with it, but I stand by\n\u003e The only thing it adds is more pointless edge cases and failure modes to check for and detect.",
        "created_at": "2024-10-24T22:08:26.485000+00:00",
        "attachments": null
    }
]