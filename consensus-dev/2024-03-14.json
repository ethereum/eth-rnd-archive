[
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "As \u003c@792822129019584562\u003e is saying the index will be assigned right upon creating a new validator record. But due to the absence of the long follow distance, the block with a deposit transaction can eventually be reorged by another block which will have a different order of deposit transactions in it. Thus, same validator pubkeys can get different indexes assigned to them.\n\nFor this to happen there should be:\n1) multiple deposit transactions at the same time\n2) reorg occurence\n3) reorder of deposit transactions in a new canonical block\n\nI think all this factors are pretty rare to occur at the same time which pushes the indexing changing case towards to edge of all possible cases",
        "created_at": "2024-03-14T05:37:10.858000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "general",
        "parent": "",
        "content": "right, so one can use a combination of finality + depth in canonical chain (in times of non finality) to display the index to the user which is the UX issue you might be going for",
        "created_at": "2024-03-14T06:31:55.606000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Yes, I think so. Once we have the confirmation rule implemented, a confirmed block could be used as a ref point of validator index confirmation too. UPD: but only for UI in block explorers, not by the client code",
        "created_at": "2024-03-14T06:34:55.978000+00:00",
        "attachments": null
    },
    {
        "author": "butta",
        "category": "general",
        "parent": "",
        "content": "How did you guys know why I am asking üòâ üôÇ",
        "created_at": "2024-03-14T08:46:54.833000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "general",
        "parent": "",
        "content": "that was the first thing that popped into my mind when I first saw this EIP üòÜ",
        "created_at": "2024-03-14T09:03:40.186000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "general",
        "parent": "",
        "content": "and we have a ready implementation of it thanks to \u003c@1035747431461167125\u003e üôè üôÇ , 6110 devnet next week \u003c@412614104222531604\u003e ? üòÜ",
        "created_at": "2024-03-14T09:05:12.731000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "general",
        "parent": "",
        "content": "(ethereumjs will soon be ready too, \u003c@682978077793583161\u003e is pushing it on that frontier)",
        "created_at": "2024-03-14T09:06:14.973000+00:00",
        "attachments": null
    },
    {
        "author": "nc1234",
        "category": "general",
        "parent": "",
        "content": "Deprecating eth1 poll is pretty satisfying to say the very least. That's arguably the most unintuitive part of the consensus protocolüòÖ",
        "created_at": "2024-03-14T09:11:55.191000+00:00",
        "attachments": null
    },
    {
        "author": "butta",
        "category": "general",
        "parent": "",
        "content": "nice, where can i find it?\nThis EIP adds a few edge cases on our end (UX wise)",
        "created_at": "2024-03-14T10:53:43.905000+00:00",
        "attachments": null
    },
    {
        "author": "butta",
        "category": "general",
        "parent": "",
        "content": "btw according to https://github.com/ethereum/consensus-specs/issues/3449, EIP-6917 is not in Electra, so probably 1+ year away, right?",
        "created_at": "2024-03-14T10:54:29.955000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I don't think this is an edge case: deposits coming in from two sources is a very common occurrence. Any reorg from such a block can easily cause such a reordering: a lone depositor at the same time as a pool sending thousands, the reorg places the lone's tx in a different place",
        "created_at": "2024-03-14T10:54:30.765000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Why do you need an unfinalized map at all? Top ups is one case where access to such an entry is useful, but is there any other? My intuition would be to simply not record these entries in the pubkey cache until they are final",
        "created_at": "2024-03-14T10:58:33.265000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "most of the blocks are coming without deposits today. there are spikes of course during which the probability of such events will be increased. but it should be rare on average",
        "created_at": "2024-03-14T11:36:15.833000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Definitely, reorgs themselves are rare",
        "created_at": "2024-03-14T13:18:27.700000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "But this is something that *will* happen",
        "created_at": "2024-03-14T13:18:40.314000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "I absolutely agree, clients must handle this case",
        "created_at": "2024-03-14T13:21:20.096000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "general",
        "parent": "",
        "content": "yes, correct we keep it for internal management",
        "created_at": "2024-03-14T13:23:04.759000+00:00",
        "attachments": null
    },
    {
        "author": "g11tech",
        "category": "general",
        "parent": "",
        "content": "this branch carries the work: https://github.com/ChainSafe/lodestar/pull/6352",
        "created_at": "2024-03-14T13:25:25.270000+00:00",
        "attachments": null
    }
]