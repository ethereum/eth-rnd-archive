[
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Would it be possible to make a change to the Era file format so that it was compatible with your need for deduplication?",
        "created_at": "2022-10-12T05:18:48.641000+00:00",
        "attachments": null
    },
    {
        "author": "sproul",
        "category": "general",
        "parent": "",
        "content": "I would be hesitant to do that, because I think it would end up looking too much like Lighthouse's database schema. I'd prefer to keep the two formats separate so we can remain open to future database optimisations, while also keeping the Era format simple.",
        "created_at": "2022-10-12T05:21:34.484000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "That is reasonable.  It sounds like it isn't just \"one little thing missing\" but rather the entire design doesn't line up well with your needs?",
        "created_at": "2022-10-12T05:24:19.882000+00:00",
        "attachments": null
    },
    {
        "author": "sproul",
        "category": "general",
        "parent": "",
        "content": "They're _kind of_ similar in that both store a beacon state every N-slots, however the amount of de-duplication to do is sort of arbitrary (we do some currently, will do more soon) and I wouldn't want us to paint ourselves into a corner. There are also alternative database designs like Teku's tree format which don't map closely to the Era format at all: the historic states are just chunked up and keyed by merkle hash AFAIK.",
        "created_at": "2022-10-12T05:27:48.221000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "general",
        "parent": "",
        "content": "I think the best analogy here is video files (ie mpg) - the state in the era file serves as a \"keyframe\" - ie a full copy - on top of that, you can store more granular state diffs (in an in-app database), but the keyframe is needed to provide a \"starting point\" for the diff.\n\nThe core nimbus database already works the way \u003c@602753420033785856\u003e is describing - ie we store diffs already (which indeed helps keep the db slim) - the downside of this design is that there is no \"keyframe\" - as designed, era files are independent and any era file can be used to construct a history _from that point onwards_ - this is not possible with a diff-based approach.\n\n8192 was chosen because that is the interval where many of the linear arrays are completely replaced (ie there is actually no duplication). \n\nThe biggest duplication in era files comes from the validator set - the pubkey and withdrawal credentials - unfortunately, there's no way around this without sacrificing the ability to start clients from any era file.",
        "created_at": "2022-10-12T09:35:18.946000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "general",
        "parent": "",
        "content": "import / export is indeed the _main_ use case for era files - ie trivial redistribution and archival - it's possible to use them directly as history store in clients (specially block storage), but state storage has a much broader design space in terms of space vs lookup tradeoffs",
        "created_at": "2022-10-12T09:39:56.275000+00:00",
        "attachments": null
    }
]