[
    {
        "author": "arnetheduck",
        "category": "general",
        "parent": "",
        "content": "fwiw, we keep states in db without the block from the same slot applied but with process_slot done, in nimbus - this allows them to be used with any fork that can be built on top of that slot which makes it slightly easier to keep forks in the db when there's long non-finality.. it's a messy part of the spec though in general, with some ambiguity unfortunately :/ specially the RPC apis leave it undefined afair",
        "created_at": "2025-01-15T08:29:07.383000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "general",
        "parent": "",
        "content": "So does that mean /finalized endpoint doesnâ€™t actually provide what you need?",
        "created_at": "2025-01-15T10:53:30.316000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "general",
        "parent": "",
        "content": "well, _our_ finalized endpoint does (I think - it's been a few years since I last looked at it), and then we have \"hacks\" in place to deal with states that also have the block applied (basically, we allow the \"first\" state in the database to have the block applied whether this is genesis or checkpoint)",
        "created_at": "2025-01-15T10:55:08.426000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "general",
        "parent": "",
        "content": "notably, this is correct insofar as the RPC api goes and herein lies the .. ambiguity? the state _becomes_ finalized as part of epoch processing, not block processing, so the argument can be made that `/finalized` should never include the block\n\n_but_ - the state root in the block is not this state without the block, so it makes the system as a whole harder to work with because you now de-facto have two state roots per (finalized) _block_ - and this is the messy part.",
        "created_at": "2025-01-15T10:58:19.118000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "general",
        "parent": "",
        "content": "Weâ€™ll probably be able to start from a checkpoint state initially and then post the following  finalization weâ€™ll have the data we needâ€¦ it does sound like /finalized will return potentially a lot of different things. We used to return anchor state (do currently), lighthouse returns checkpoint state, you sound to be returning a pre-state post epoch transitionâ€¦ what does prysm return I wonder heheâ€¦",
        "created_at": "2025-01-15T11:07:30.586000+00:00",
        "attachments": null
    },
    {
        "author": "arnetheduck",
        "category": "general",
        "parent": "",
        "content": "they're still hoping we'll adopt protobuf and grpc ðŸ˜›",
        "created_at": "2025-01-15T14:25:07.667000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "general",
        "parent": "",
        "content": "i should have seen that one coming ðŸ™‚",
        "created_at": "2025-01-15T20:39:04.913000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "general",
        "parent": "",
        "content": "Ok so a different question. if we hit all the clients endpoint for `/eth/v2/debug/beacon/states/finalized` like checkpointz does, what do clients all return?\nIt sounds like \nlighthouse - checkpoint state (which is strictly the first slot of the epoch finalized, block applied if there was one)\nnimbus - sounds like an anchor-state thats transitioned through the epoch but not yet applied a block\nteku - anchor state currently (which is going to be the block state of the finalized block)\nIs that correct, and what about others?",
        "created_at": "2025-01-15T20:44:29.325000+00:00",
        "attachments": null
    }
]