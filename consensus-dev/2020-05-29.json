[
    {
        "author": "donschoe",
        "category": "general",
        "parent": "",
        "content": "do we have a list of bls libraries that implement draft 7 somewhere?",
        "created_at": "2020-05-29T13:02:42.255000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "Afaik herumi does and so does milagro if I am not wrong",
        "created_at": "2020-05-29T13:03:37.934000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "Pyecc too",
        "created_at": "2020-05-29T13:03:48.475000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "And Milagro also has python bindings if you need something faster than pyecc",
        "created_at": "2020-05-29T13:04:28.714000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "Think the java one is under review. Mentioned on call yesterday",
        "created_at": "2020-05-29T13:05:24.987000+00:00",
        "attachments": null
    },
    {
        "author": "donschoe",
        "category": "general",
        "parent": "",
        "content": "I see. Python would be nice.",
        "created_at": "2020-05-29T13:11:11.328000+00:00",
        "attachments": null
    },
    {
        "author": "donschoe",
        "category": "general",
        "parent": "",
        "content": "Having trouble to find PyECC, mind sharing a link?",
        "created_at": "2020-05-29T13:11:20.560000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "https://github.com/ethereum/py_ecc",
        "created_at": "2020-05-29T13:12:13.507000+00:00",
        "attachments": null
    },
    {
        "author": "donschoe",
        "category": "general",
        "parent": "",
        "content": "Cheers",
        "created_at": "2020-05-29T13:12:21.615000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "We use it in the pyspec tests if you need examples",
        "created_at": "2020-05-29T13:12:32.103000+00:00",
        "attachments": null
    },
    {
        "author": "benjaminion",
        "category": "general",
        "parent": "",
        "content": "\u003e Think the java one is under review. Mentioned on call yesterday\nHere's my PR in review for draft BLS-02/H2C-07 (Java version): https://github.com/PegaSysEng/teku/pull/1895\nWe'll probably swap to something non-JVM for production, but this serves for now.",
        "created_at": "2020-05-29T13:17:50.699000+00:00",
        "attachments": null
    },
    {
        "author": "donschoe",
        "category": "general",
        "parent": "",
        "content": "So, a compressed public key is 48 bytes?",
        "created_at": "2020-05-29T14:53:46.044000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "yes",
        "created_at": "2020-05-29T14:54:06.638000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "and a signature is 96 bytes",
        "created_at": "2020-05-29T14:54:10.287000+00:00",
        "attachments": null
    },
    {
        "author": "donschoe",
        "category": "general",
        "parent": "",
        "content": "that's a lot üôÇ",
        "created_at": "2020-05-29T14:59:40.875000+00:00",
        "attachments": null
    },
    {
        "author": "donschoe",
        "category": "general",
        "parent": "",
        "content": "did you ever consider checksummed addresses for eth2?",
        "created_at": "2020-05-29T14:59:55.035000+00:00",
        "attachments": null
    },
    {
        "author": "donschoe",
        "category": "general",
        "parent": "",
        "content": "will shards also roll with bls?",
        "created_at": "2020-05-29T15:00:14.018000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "user land will likely use ECDSA as today _or_ have moved to the more general/extensible account abstraction. In such a case, they might use ECDSA, BLS, or whatever to verify the account",
        "created_at": "2020-05-29T15:05:19.133000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "\u003e did you ever consider checksummed addresses for eth2?\nThere has been some debate here but the validator pubkey is not really like a normal user address and currently does not have any general actions that users would take against the pubkey. so a checksum on this bls pubkey is not currently implemented",
        "created_at": "2020-05-29T15:06:22.602000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "it is actually much more natural to reference validators with validator index in the event that, say, a  beacon chain transfer were implemented",
        "created_at": "2020-05-29T15:06:45.952000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "tbh, I don't remember all of the debate here, but there's a couple of closed issues lying around",
        "created_at": "2020-05-29T15:07:01.047000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "If using BLS we talked about a bech32-style encoding of the hash of the public key as an address, which would be nice.",
        "created_at": "2020-05-29T15:08:09.758000+00:00",
        "attachments": null
    },
    {
        "author": "s1na",
        "category": "general",
        "parent": "",
        "content": "\u003e currently does not have any general actions that users would take against the pubkey\nhaving validator addresses might help with transferring BETH from shards to beacon chain. Or can indices be used for the purpose?",
        "created_at": "2020-05-29T15:09:38.065000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "I have this discussion (https://github.com/ethereum/eth2.0-specs/issues/1183) on my todo list for the same reason \u003c@!259648573401071617\u003e asked üôÇ",
        "created_at": "2020-05-29T15:12:31.646000+00:00",
        "attachments": null
    },
    {
        "author": "cdetrio",
        "category": "general",
        "parent": "",
        "content": "\u003e There has been some debate here but the validator pubkey is not really like a normal user address and currently does not have any general actions that users would take against the pubkey. so a checksum on this bls pubkey is not currently implemented\n\u003c@291925846556540928\u003e \n\nexcept sending ETH to it via the deposit contract. I guess a checksum wouldn't work as an alternative to verifying the pubkey/privkey pair was constructed correctly though, though",
        "created_at": "2020-05-29T15:19:35.161000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "The deposit contract has a workaround, a different kind of checksum (the hash of the `DepositData` structure).",
        "created_at": "2020-05-29T15:20:16.806000+00:00",
        "attachments": null
    },
    {
        "author": "cdetrio",
        "category": "general",
        "parent": "",
        "content": "how's that used?  been a while since I looked at it",
        "created_at": "2020-05-29T15:21:25.753000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "The `DepositData` consists of pubkey, amount, signature, withdrawal_credentials. The deposit contract however only takes pubkey, signature and withdrawal_credentials as \"Solidity ABI encoded\" inputs and the amount is determined from the amount sent in the transaction. The the contract reconstructs the SSZ serialised DepositData structure from the inputs + the amount sent. The merkle root of the structure must match the `deposit_data_root` also passed in to the contract.",
        "created_at": "2020-05-29T15:23:31.319000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "So one would need to deliberately mess up on the Eth1 side, but there could be malicious tools crafting valid looking, but invalid (where pubkey doesn't match the sig) data.",
        "created_at": "2020-05-29T15:24:10.956000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "\u003e that's a lot üôÇ\n\u003c@!557201004060213248\u003e actually BLS signatures are known for how short they are",
        "created_at": "2020-05-29T15:28:58.035000+00:00",
        "attachments": null
    },
    {
        "author": "cdetrio",
        "category": "general",
        "parent": "",
        "content": "What's passed into the contract? Or a link if it's handy",
        "created_at": "2020-05-29T15:29:25.132000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "\u003e The deposit contract however only takes pubkey, signature and withdrawal_credentials as \"Solidity ABI encoded\" inputs and the amount is determined from the amount sent in the transaction.\n\nAnd it also takes in 4th parameter: `deposit_data_root`.",
        "created_at": "2020-05-29T15:29:44.764000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "You can check the vyper source in the eth2.0-specs repo.",
        "created_at": "2020-05-29T15:30:20.835000+00:00",
        "attachments": null
    },
    {
        "author": "cdetrio",
        "category": "general",
        "parent": "",
        "content": "self-documenting source code",
        "created_at": "2020-05-29T15:30:41.467000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "There's also a spec there in the phase0 directory, but I think it is a bit lacking in detail. I planned to submit a PR improving it, did some minor changes locally, but haven't pushed yet.",
        "created_at": "2020-05-29T15:31:21.156000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "https://www.attestant.io/posts/understanding-ethereum-staking-deposits/ provides a quick overview of the process",
        "created_at": "2020-05-29T15:33:11.577000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Nice! It does seem to describe most of the steps nicely. At least the parts I'm familiar with seem to be there üôÇ",
        "created_at": "2020-05-29T15:38:30.347000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "(And just because we're talking about the deposit contract, I'll flag up again my concern that the withdrawal credentials are totally unchecked so could be any random junk, and not only will depositors lose their Ether they could well spend a year or so happily validating before transfers come in and they find out.)",
        "created_at": "2020-05-29T15:46:31.820000+00:00",
        "attachments": null
    },
    {
        "author": "donschoe",
        "category": "general",
        "parent": "",
        "content": "\u003e the validator pubkey is not really like a normal user address and currently does not have any general actions that users would take against the pubkey\n\u003c@!291925846556540928\u003e thanks, that directly answers my question",
        "created_at": "2020-05-29T15:46:55.722000+00:00",
        "attachments": null
    },
    {
        "author": "hsiaowei",
        "category": "general",
        "parent": "",
        "content": "\u003c@!256103085099712512\u003e deposit contract spec https://github.com/ethereum/eth2.0-specs/blob/dev/specs/phase0/deposit-contract.md",
        "created_at": "2020-05-29T15:56:30.845000+00:00",
        "attachments": null
    },
    {
        "author": "cdetrio",
        "category": "general",
        "parent": "",
        "content": "thanks",
        "created_at": "2020-05-29T16:23:17.041000+00:00",
        "attachments": null
    },
    {
        "author": "cdetrio",
        "category": "general",
        "parent": "",
        "content": "\u003e (And just because we're talking about the deposit contract, I'll flag up again my concern that the withdrawal credentials are totally unchecked so could be any random junk, and not only will depositors lose their Ether they could well spend a year or so happily validating before transfers come in and they find out.)\n\u003c@144468805697929216\u003e \n\nso a \"deposit proxy contract\" should verify both the pubkey and the withdrawal_pubkey.  Does the example/prototype solidity proxy contract verify both? Or is more data needed (a signature for the withdrawal_pubkey) to do that",
        "created_at": "2020-05-29T16:26:38.537000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "You cannot verify the withdrawal_credentials as it is a commitment (hash of the pubkey).",
        "created_at": "2020-05-29T16:27:02.408000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "The deposit proxy only checks that the signature matches the pubkey.",
        "created_at": "2020-05-29T16:27:27.947000+00:00",
        "attachments": null
    },
    {
        "author": "cdetrio",
        "category": "general",
        "parent": "",
        "content": "I see. so yea, ideally the deposit proxy contract would take the additional data (withdrawal_pubkey, withdrawal_signature) and verify the hash == withdrawal_credentials, and the signature/pubkey is valid",
        "created_at": "2020-05-29T16:29:03.168000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "based on my limited understanding the withdrawal_credentials is purposefully hashed so that it is not revealed until used, e.g. it can't be validated",
        "created_at": "2020-05-29T16:29:39.632000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "It isn't really for privacy, as withdrawal credentials aren't exposed until a withdrawal anyway. \n\nThe lack of any way of verifying the credentials before committing Ether is not good. A proxy could help, but proxies are easily bypassed (often unintentionally)",
        "created_at": "2020-05-29T16:33:03.919000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "\u003e I see. so yea, ideally the deposit proxy contract would take the additional data (withdrawal_pubkey, withdrawal_signature) and verify the hash == withdrawal_credentials, and the signature/pubkey is valid\n\nI'm not sure there is any signing whatsoever with the withdrawal key during the deposit process.\n\nThe pubkey+signature to the contract consist of the validator pubkey + signature. And only the hashed withdrawal pubkey is supplied, it is not signing anything.",
        "created_at": "2020-05-29T16:34:51.003000+00:00",
        "attachments": null
    },
    {
        "author": "cdetrio",
        "category": "general",
        "parent": "",
        "content": "I know, I meant that the withdrawal_pubkey/privkey would need to sign some message just for verification purposes in a deposit proxy contract",
        "created_at": "2020-05-29T16:38:53.539000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "There seems little reason to do a proxy on chain if it is not audited and UI tools would do verification anyway. One reason I see on chain verification to be useful if staking pools would use contracts.",
        "created_at": "2020-05-29T16:40:00.807000+00:00",
        "attachments": null
    },
    {
        "author": "cdetrio",
        "category": "general",
        "parent": "",
        "content": "\u003c@144468805697929216\u003e  at this point it seems any kind of proxy contract will be optional. I'd guess that redoing a new deposit contract could delay phase0 launch, but I don't know.  Not sure if you are advocating redoing the deposit contract, or just voicing concern as a reminder that you weren't happy with the original design and remain concerned",
        "created_at": "2020-05-29T16:44:26.704000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "So by that logic UI tools could already do what you suggest on their own accord.",
        "created_at": "2020-05-29T16:44:37.961000+00:00",
        "attachments": null
    },
    {
        "author": "cdetrio",
        "category": "general",
        "parent": "",
        "content": "I think the issue with the \"UI tools\" approach is that there will be many UI tools, some of them will be better audited than others and some will have bugs. Whereas the on-chain contract will be heavily audited/verified, so it's \"easier\" or at least safer to double check things on-chain, versus auditing every UI tool.",
        "created_at": "2020-05-29T16:48:33.777000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "I agree in general, assuming someone would finish the contract, audit the contract, and if it would not require quite big additions to Eth1, so that all of this is done before the launch of phase 0.",
        "created_at": "2020-05-29T16:53:21.147000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Some middle ground could be providing an audited verification tool compiled to wasm and either storing that code or the hash of its code on chain, so that UI tools could be sure what verification tool they are using.",
        "created_at": "2020-05-29T16:54:37.605000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Philosophical question: would you audit the bls12-381 precompiles or just the deposit proxy on eth1? üßê",
        "created_at": "2020-05-29T16:55:36.066000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "Anyone can shed a light on why is there a need for a separate withdrawal key and not use the validator key? I have seen some articles on the topic, but can't find them.",
        "created_at": "2020-05-29T17:06:23.298000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "It's unlikely that the deposit transaction is going to be hand-written, so it comes down to the tools. As you say, they will be of variable quality. \n\nMy preference would be to pass the withdrawal public key and signed message in to the deposit contract, as that would allow some level of checking. Doing this in the proxy is probably as good as we are going to get, though",
        "created_at": "2020-05-29T17:10:22.014000+00:00",
        "attachments": null
    },
    {
        "author": "axic3354",
        "category": "general",
        "parent": "",
        "content": "(Side note: nobody has written bls12-381 signature verification on EVM yet and no accepted precompile exists. This may be somewhat of a complication to the idea.)",
        "created_at": "2020-05-29T17:27:48.753000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Yeah, I was assuming the latter.",
        "created_at": "2020-05-29T17:29:59.186000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "If not, it's going to be hard to do anything but recommended a 1 Ether deposit-confirmation-follow up deposit cycle, which would be ugly",
        "created_at": "2020-05-29T17:32:15.710000+00:00",
        "attachments": null
    }
]