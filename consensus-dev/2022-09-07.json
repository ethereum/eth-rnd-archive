[
    {
        "author": "cheerful_piglet_95568",
        "category": "general",
        "parent": "",
        "content": "Hi Team, we are noticing that RPC calls to the lighthouse end points are taking much longer. Wondering if there are any optimizations that can be done interms of configs/settings etc to improve performance.\n\neg.  The below curl request takes over a minute to come back\n\ncurl http://127.0.0.1:5052/eth/v1/beacon/states/4640096/validators",
        "created_at": "2022-09-07T00:07:22.983000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "general",
        "parent": "",
        "content": "thats a huge amount of data you'll be fetching",
        "created_at": "2022-09-07T00:09:04.080000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "general",
        "parent": "",
        "content": "try the same curl with /root instead `curl http://127.0.0.1:5052/eth/v1/beacon/states/4640096/root` and see how that performs, that still fetches the state, but then will just return the state root... its a more fair representation without the huge volume of data that the validators would return",
        "created_at": "2022-09-07T00:13:19.315000+00:00",
        "attachments": null
    },
    {
        "author": "cheerful_piglet_95568",
        "category": "general",
        "parent": "",
        "content": "Thanks \u003c@680234424037670912\u003e We are looking for the balance and index fields in the output which root doesnt seem to provide.",
        "created_at": "2022-09-07T00:16:50.124000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "general",
        "parent": "",
        "content": "for specific validators?",
        "created_at": "2022-09-07T00:17:07.874000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "general",
        "parent": "",
        "content": "the root was just to demonstrate actual performance ignoring the volume of data you'd be generting",
        "created_at": "2022-09-07T00:17:39.441000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "general",
        "parent": "",
        "content": "there's `/validator_balances`, also possible to pass an `id` list to both those endpoints to restrict the data coming back... I'm not fully across your use case, but restricting data is likely to be the main performance issue... eg you might do `curl http://127.0.0.1:5052/eth/v1/beacon/states/finalized/validators?id=1,2,3` if you just want validators 1-3...",
        "created_at": "2022-09-07T00:22:12.774000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "general",
        "parent": "",
        "content": "also in that i used finalized state which is generally optimised",
        "created_at": "2022-09-07T00:25:04.932000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "general",
        "parent": "",
        "content": "note - not a lighthouse dev, but most clients have immediate access to finalized states afaik",
        "created_at": "2022-09-07T00:25:34.811000+00:00",
        "attachments": null
    },
    {
        "author": "cheerful_piglet_95568",
        "category": "general",
        "parent": "",
        "content": "thanks \u003c@680234424037670912\u003e . checking with the user about this. It looks like they are looking   for a specific slot..4640096 in this case",
        "created_at": "2022-09-07T00:26:09.679000+00:00",
        "attachments": null
    },
    {
        "author": ".paulharris",
        "category": "general",
        "parent": "",
        "content": "yep thats fine, it'll have a performance hit doing that though",
        "created_at": "2022-09-07T00:26:50.132000+00:00",
        "attachments": null
    },
    {
        "author": "samcm",
        "category": "general",
        "parent": "",
        "content": "Have updated the wording in the about section here: https://github.com/samcm/checkpointz/pull/68 üôè",
        "created_at": "2022-09-07T01:11:52.129000+00:00",
        "attachments": null
    },
    {
        "author": "sproul",
        "category": "general",
        "parent": "",
        "content": "Lighthouse doesn't cache the finalized state and will load it from disk. For historic states (like 4640096) we'll replay upto 8192 blocks by default, which is slow. For nodes doing this sort of analysis we recommend lowering the \"slots per restore point\" which reduces the number of blocks that need to be replayed: https://lighthouse-book.sigmaprime.io/advanced_database.html",
        "created_at": "2022-09-07T01:36:34.738000+00:00",
        "attachments": null
    },
    {
        "author": "sproul",
        "category": "general",
        "parent": "",
        "content": "For us the slow part is loading the whole state, which happens regardless of how many validator indices you fetch. So you may as well fetch all the ones you're interested in with a single query",
        "created_at": "2022-09-07T01:37:24.994000+00:00",
        "attachments": null
    },
    {
        "author": "sproul",
        "category": "general",
        "parent": "",
        "content": "^If you run Teku I think they _are_ capable of loading a subset of historic states (which is very cool). So might be worth giving them a look if this is an operation that you want to do a lot",
        "created_at": "2022-09-07T01:42:14.219000+00:00",
        "attachments": null
    },
    {
        "author": "benjaminion",
        "category": "general",
        "parent": "",
        "content": "Yes, tree archive format in Teku provides very swift calculation of subsets of historic states. The db is big, though, well over 1TB I think these days. But it is fast. Unfortunately I think our docs are out of date on how to enable this. Will get onto it...",
        "created_at": "2022-09-07T11:37:09.315000+00:00",
        "attachments": null
    },
    {
        "author": "alexssd7fp",
        "category": "general",
        "parent": "",
        "content": "1 TB for beacon chain DB? o.O",
        "created_at": "2022-09-07T13:19:25.325000+00:00",
        "attachments": null
    },
    {
        "author": "alexssd7fp",
        "category": "general",
        "parent": "",
        "content": "Ah, that‚Äôs archive, right?",
        "created_at": "2022-09-07T13:20:01.672000+00:00",
        "attachments": null
    },
    {
        "author": "benjaminion",
        "category": "general",
        "parent": "",
        "content": "Yes, in special super-fast archive mode giving near instant access to any arbitrary piece of historic state. Normal archives are much smaller, and standard db is just 50GB. You can see MigaLabs' evaluation of it - it is very effective.",
        "created_at": "2022-09-07T13:21:50.530000+00:00",
        "attachments": null
    },
    {
        "author": "alexssd7fp",
        "category": "general",
        "parent": "",
        "content": "Ah, okay. I misread as 1 TB in normal mode üòÖ",
        "created_at": "2022-09-07T13:22:31.376000+00:00",
        "attachments": null
    }
]