[
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Hello \u003c@520034910149410861\u003e and people implementing the consensus changes mentioned above. They are actually non-trivial and pretty invasive on Prysm.  Let me describe the situation in Prysm and you tell me what you think on your client. Prysm's forkchoice keeps track of some states, it has justified, it has the post state of the receiving block, but it does not have the head state. Other packages that depend on forkchoice have this state. \n\nWhen importing a block, we have to decide if we apply PB to it or not, and the new crucial information we need is \"is the proposer the expected one in the head branch\" ? For this, we need to have the head state even possibly advanced to the receiving slot at the time of node insertion. This state may be very different than the parent state. In the happy case of finalization this is not an issue cause the parent state and the head state will have the same dependent root and the lookahead gives us the proposer index. But when we are not finalizing  or on previous forks (as is the case for spectests with long reorgs on phase0) this will require the replay of states. \n\nThe biggest change is that now when inserting a block to forkchoice we need to pass the expected proposer somehow (since the caller to the insertion method is the one that holds the head state) and this ends up being a pretty invasive change in Prysm. Let alone the possible state reply to get the proposer index, which internally would invalidate a bunch of caches that we keep when we process slots, just the signature change on block insertion is already a pain to deal with. I'm sure it's something that Claude can deal in a session cause it's a rather tedious task. But reviewing this is rather scary just for the sake of tests so we'll be skipping those tests for now. \n\nWhat do you guys think of this situation?",
        "created_at": "2026-01-07T13:34:27.522000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "general",
        "parent": "",
        "content": "\u003e For this, we need to have the head state even possibly advanced to the receiving slot at the time of node insertion.\nTo be precise, we need the proposer lookahead of the head branch",
        "created_at": "2026-01-07T14:32:50.140000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "yeah, as long as the dependent root is the right one we're fine, we already deal this way in many validating places for gossip objects for example, but all of the above applies. I'm now skipping these tests and will open a PR with the full application of your PR, but I think it'll be a little invasive in Prysm",
        "created_at": "2026-01-07T15:27:58.854000+00:00",
        "attachments": null
    },
    {
        "author": "fradamt",
        "category": "general",
        "parent": "",
        "content": "We can also skip this since it hasn't been an issue at this point and it's a bit of a niche attack. It doesn't seem right that any random old blocks can deactivate proposer boost though, given that without proposer boost there's all kinds of reorg vectors",
        "created_at": "2026-01-07T15:30:27.801000+00:00",
        "attachments": null
    }
]