[
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Hello, I'm trying to bug \u003c@415109946682769408\u003e the minimum possible, but I keep needing to ping her anyway. I am trying to run the CL spec tests locally so that I don't need to wait for CI to be red to diagnose what's wrong. But I'm getting into all sorts of problems with the python's package manager. I can't for the love of Satan install lru, even though I have installed lru-dict, so I resorted to run the linter and tests directly from the makefile.\nWhen I run `make test` I get \n```\nImportError while loading conftest '/home/potuz/Documents/code/ethereum/consensus-specs/tests/core/pyspec/eth2spec/test/conftest.py'.\neth2spec/test/conftest.py:1: in \u003cmodule\u003e\n    from eth2spec.test import context\neth2spec/test/context.py:6: in \u003cmodule\u003e\n    from eth2spec.utils import bls\neth2spec/utils/bls.py:24: in \u003cmodule\u003e\n    from py_arkworks_bls12381 import (\n../../../venv/lib/python3.12/site-packages/py_arkworks_bls12381/__init__.py:1: in \u003cmodule\u003e\n    from .py_arkworks_bls12381 import *\nE   ImportError: PyO3 modules may only be initialized once per interpreter process\n```",
        "created_at": "2024-07-03T11:12:06.614000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Try `make COVERAGE_SCOPE=\"\" test`, disabling coverage helps in my case",
        "created_at": "2024-07-03T11:20:43.693000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "thanks Misha this brought me to the actual error I needed to see",
        "created_at": "2024-07-03T11:33:45.964000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Another question that I am raising with Hsiao-Wei that seems to be more fundamental:\n\u003e Oh this I think it's a fundamental problem, in \n\u003e build_empty_execution_payload you set the state_root to be the same as the one found in the latest_execution_payload_header. But on ePBS that state root is no longer there in the header, it's not kept anywhere. The state root of the EL is not needed in the CL, is there any reason why we keep it here in tests? Can I just ignore this construction?\nThese functions rely on the fact that the beacon state has the latest EL state in the BeaconState, and I want to effectively remove this cross-layer contamination",
        "created_at": "2024-07-03T14:15:37.616000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "We do not need the EL state anywhere in the CL **except** in the testsuite",
        "created_at": "2024-07-03T14:15:56.669000+00:00",
        "attachments": null
    },
    {
        "author": "hsiaowei",
        "category": "general",
        "parent": "",
        "content": "\u003c@592004585506340885\u003e did you mention that you have used it to check builder tools? Is it still relevant?",
        "created_at": "2024-07-03T14:24:45.670000+00:00",
        "attachments": null
    },
    {
        "author": "jtraglia",
        "category": "general",
        "parent": "",
        "content": "I think I'm missing some context, but yeah we use one of the CL tests to check `ComputeBlockHash` in mev-boost.",
        "created_at": "2024-07-03T14:36:11.174000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "So most of the helpers in that section make an assumption on the beacon state keeping track of execution layer info which severely restrict the way the CL interacts with the EL. I want to remove everything that leaks unnecessarily from the EL to the CL state, so that they are actually independent (as much as possible). I am changing those helpers in my ePBS PR to return bogus information in the case the state is post ePBS, and keep the same behavior before, but I think when I add tests to ePBS all of that section will have to be rewritten if accurate EL info is needed (for example the actual state root)",
        "created_at": "2024-07-03T14:46:32.896000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I don't have a place to give shoutouts, but a huge shoutout to \u003c@415109946682769408\u003e not only for helping me with the spec repo to get the PR to be green finally, but also as a token of respect after spending two full days to fix a stupid PR, I have much more appreciation for the job she does every day.  Incidentally, with all the horrors and hacks and things that I do not like of the python test suite, just by having to pass the already existing tests for previous forks, I found a couple of actual logic errors in the ePBS specification as implemented.",
        "created_at": "2024-07-03T17:50:30.590000+00:00",
        "attachments": null
    }
]