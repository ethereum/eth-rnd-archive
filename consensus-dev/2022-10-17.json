[
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Trying to understand something that I have been attempting to track down for a while on sepolia.  Looking at slot 856181 this block was produced late (\u003e9 seconds in to the slot) and has no attestations for it to be the head of the chain, with all votes in that slot stating that 856180 is the head of the chain.  Given this, shouldn't 856182 build on top of 856180?",
        "created_at": "2022-10-17T14:13:36.863000+00:00",
        "attachments": null
    },
    {
        "author": "pietjepuk",
        "category": "general",
        "parent": "",
        "content": "Isnt this related to the current talkin \u003c#598292067260825641\u003e ?",
        "created_at": "2022-10-17T14:56:22.102000+00:00",
        "attachments": null
    },
    {
        "author": "pietjepuk",
        "category": "general",
        "parent": "",
        "content": "basically clients having the option and financially incentivized of re-orging (not building on top of) a late block, but currently not doing so.",
        "created_at": "2022-10-17T14:56:50.987000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "You mean \u003c#595701173944713277\u003e ?  Possibly, although I thought that the existing system (even pre-proposer boost) would have already addressed this.  Why are nodes building on top of a block that has no attestations, and has attestations (from the same slot as the block) that actively vote against it?",
        "created_at": "2022-10-17T15:00:12.787000+00:00",
        "attachments": null
    },
    {
        "author": "pietjepuk",
        "category": "general",
        "parent": "",
        "content": "Yeh, I also thought they did. But also with your previous observation of rather sub-optimal attestation packing, I'm not so sure current clients' implementation of block proposal aligns with the financial incentives.",
        "created_at": "2022-10-17T15:04:49.706000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "So to confirm: if I'm feeling malicious then I can publish a block for slot _x_ 5 seconds after the beginning of the slot, ruin the head vote of all of the validators of the slot (except my own, which I can withhold until the block is published), and have no consequence (_i.e._ fear of being reorged)?",
        "created_at": "2022-10-17T15:32:17.903000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "No, the current filtering in the spec only considers leaves of the forkchoice tree as viable for head",
        "created_at": "2022-10-17T18:11:38.516000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "The node could act as if it never saw that block, it would be a \"dishonest\" validator, but it would succeed and it would be better for the chain, that's why we're discussing ways of specifying this",
        "created_at": "2022-10-17T18:12:39.823000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Fwiw my only post on ethresear.ch was an early attempt at this: rewarding the proposer for votes received as well.  I didn't know anything about client implementation back then, it's a little awkward to implement but possible and better aligned with the economic incentives of the chain. \u003c@841217748942979072\u003e has better ideas now about this. But anyway the likelihood that the extra MEV you get is higher than proposer rewards make these incentives useless",
        "created_at": "2022-10-17T18:22:21.903000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Thanks. It does seem like a pretty big hole that a dishonest validator can do so much damage without being punished. Is the work in \u003c#595701173944713277\u003e where it's at?",
        "created_at": "2022-10-17T18:23:24.504000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Not sure what to say. Lighthouse has it implemented. Prysm fairly advanced. But the spec PR has just been opened. Prysm will require a bit of testing to get the right parameters",
        "created_at": "2022-10-17T18:24:48.962000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "There's always the risk of backwards social slashing if a pool does this consistently",
        "created_at": "2022-10-17T18:25:39.165000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I would note however that if this becomes a problem we can always ship this immediately and ask big operators to use it. If only lighthouse ships this is already a big bet for the attacker to try this",
        "created_at": "2022-10-17T18:31:45.555000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "I certainly think that this needs to be a spec item rather than some sort of opt-in.  The various revisions of proposer boost and the mess it made were a good example of why not to be opt-in.",
        "created_at": "2022-10-17T18:31:49.851000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I believe that even a 20% of the network runing this makes this attack a no go",
        "created_at": "2022-10-17T18:32:48.835000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "It's not just attacks, it's the day-to-day of having slow validators that end up disrupting the chain.  The example I gave above was a good example: a validator proposes 8-9 seconds in to its slot, has no votes, and yet is included in the canonical chain.",
        "created_at": "2022-10-17T18:36:08.049000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "This will happen nonetheless, we are not changing accounting. The validators in that slot will miss the head vote",
        "created_at": "2022-10-17T19:05:02.111000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "That's disappointing.  Honest validators should not have an incentive to become dishonest.",
        "created_at": "2022-10-17T19:17:57.886000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "There was a bit of research on (block, slot) voting that would cure the accounting by enshrining the \"vote for emptiness\" but that had other issues. I don't think this is a tragedy though: if we implement this reorging then attack is no longer feasible and the few slow validators that still get reorged by simply running on slow hardware will be simply like missing slots",
        "created_at": "2022-10-17T19:22:26.142000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "The whole basis of proof of stake is economically rational actors, though.  If the protocol has holes in it such that an economically rational validator would act against the spec (e.g. holding off on attestations until 6s in to a slot when it hasn't seen a block so far) it suggests that there is an issue with the protocol that needs looking at.",
        "created_at": "2022-10-17T19:25:58.521000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Agreed, but there's no known bullet proof solution afaik for this particular problem",
        "created_at": "2022-10-17T19:26:51.742000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "In any case in this particular issue, after we implement reorging, a rational proposer will not delay block proposal",
        "created_at": "2022-10-17T19:27:47.941000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Sure, but a rational proposer won't delay block proposal _today_.",
        "created_at": "2022-10-17T19:30:39.800000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I think today, or tomorrow, any rational proposer will delay as much as it's allowed.",
        "created_at": "2022-10-17T19:35:51.908000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "The spec requires you to not delay at all",
        "created_at": "2022-10-17T19:36:06.607000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Guess it depends somewhat on the perspective.  The proposer has to attest, as well, so it pays to get the proposal out so it can then attest and obtain broad agreement on the attestation data so that it's attestations are more likely to be included in a high-value aggregate.  May some delay in proposing gain an advantage?  Possibly, especially with execution block building going on.",
        "created_at": "2022-10-17T19:43:23.660000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I think no attestation data will be remotely close to MEV extracted with the extra time.",
        "created_at": "2022-10-17T19:44:41.086000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Perhaps, I have a bunch of data to analyze to see if that's the case but no time to do it unfortunately.",
        "created_at": "2022-10-17T19:49:48.796000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "I suspect that builders are playing their own games.  One seems to be not showing their hand until the last second, as seen by the jump just before the slot time (and just after, for a builder that presumably cut things a little fine).  It seems unlikely that such a large jump would occur naturally by incremental opportunities.",
        "created_at": "2022-10-17T19:54:25.235000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "bids.png",
                "content": "4b8e76a4ee4bf3d29dd8ddb3b38808b7a44a247819bd0a524a67b8a731b70a8f"
            }
        ]
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Oh interesting dynamics! Wtf that's logarithmic scale... The world sucks",
        "created_at": "2022-10-17T19:58:00.285000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Yeah really need to dig in to this to see if it's a common pattern or I just happened to bump in to an outlier when I was testing the graphing code.  Lots to worry about in this brave new world.",
        "created_at": "2022-10-17T19:59:27.200000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "What worries me here is the feedback loop this causes. It seems the builder is reacting to the other's bid. It makes sense for the CL to not take any and wait for a second reaction for a bit.",
        "created_at": "2022-10-17T20:04:44.732000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Yeah, although there are a couple of wrinkles here.  One is that I have been told that relays only take a new block from a given builder at most once per second (although yes that is of course gameable).  The second is that there is some serious clock skew out there (I've seen bids coming in timestamped 50+ seconds ahead of time) so it may be mucking up what is in fact a neat and orderly process.\n\nBut yeah, we need to be good validator clients and not game this system (I have a `bad-evil` branch of Vouch, but it's local only and not leaving my laptop ðŸ™Š )",
        "created_at": "2022-10-17T20:11:23.297000+00:00",
        "attachments": null
    },
    {
        "author": "pietjepuk",
        "category": "general",
        "parent": "",
        "content": "good to know I'm not alone with my evil local branches ðŸ˜‰",
        "created_at": "2022-10-17T20:18:02.873000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "The problem is that validator pools surely have their own... ðŸ˜¦",
        "created_at": "2022-10-17T20:30:47.519000+00:00",
        "attachments": null
    },
    {
        "author": "pietjepuk",
        "category": "general",
        "parent": "",
        "content": "definitely, which is why I think all of us here are talking about how important it is to address these perverse incentives",
        "created_at": "2022-10-17T20:31:30.125000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "The whole thing with MEV boost is horrible, It's not really comforting the rationalization that things would be worse with gas auctions in the open",
        "created_at": "2022-10-17T20:32:07.972000+00:00",
        "attachments": null
    },
    {
        "author": "pietjepuk",
        "category": "general",
        "parent": "",
        "content": "I'm still convinced it's the lesser evil, as even without it the perverse incentives for late proposing are there.",
        "created_at": "2022-10-17T20:35:25.452000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Even at the client level the situation is not nice: for example I talked to \u003c@607055410104500244\u003e that I think LightHouse strategy about calling FCU at 8s an the fact that geth has not released their updating of the block building, I would expect lighthouse blocks to be more valuable than Prysm's today (since EL freezes the mempool and it gives LH about 20 seconds, while Prysm's will have only 4 seconds of tx window). I asked one of the protocol fellows to look into this. But the point is that if we start by looking at these things and we react with an evil mind trying to beat lighthouse's blocks we will be in a pretty bad place soon. It's not a nice place to be.",
        "created_at": "2022-10-17T20:36:06.847000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "If my guess is true though, as soon as geth releases that fix the situation reverses. It would be nice to have hard numbers about this",
        "created_at": "2022-10-17T20:38:02.014000+00:00",
        "attachments": null
    }
]