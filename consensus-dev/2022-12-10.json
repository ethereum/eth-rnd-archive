[
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Wait \u003c@687974325072035882\u003e does fastssz use gohashtree? Is this by default?",
        "created_at": "2022-12-10T14:07:33.422000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I don't see how that's even possible since the hasher in fastssz has the wrong signature. cc \u003c@476250636548308992\u003e",
        "created_at": "2022-12-10T14:08:43.194000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "They probably implemented lists htrs with gohashtree internally? That would be awesome for us, if that's the case we should try to go back to upstream instead of using our fork",
        "created_at": "2022-12-10T14:10:51.093000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "I meant your fork ðŸ™‚",
        "created_at": "2022-12-10T14:20:29.063000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I don't think that's true though I don't think we use gohashtree on generated code, perhaps \u003c@308223150725005322\u003e you added that with that PR with native blocks?",
        "created_at": "2022-12-10T14:21:46.474000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "So the thing is that I don't think we changed the signature of the hasher",
        "created_at": "2022-12-10T14:22:46.252000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "No not on generated code",
        "created_at": "2022-12-10T14:22:53.043000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "Let me show you",
        "created_at": "2022-12-10T14:23:25.084000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Ah ok then yeah we just changed minio-sd for gohashtree, but we still don't exploit the full capability of gohashtree",
        "created_at": "2022-12-10T14:23:46.892000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Yeah I know what you're referring to now",
        "created_at": "2022-12-10T14:24:01.964000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "https://github.com/ledgerwatch/erigon/blob/f512c887dce654e93ad533d6bb910816026ba8c3/cl/cltypes/types_encoding.go#L74",
        "created_at": "2022-12-10T14:24:08.620000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "here for example, eventually you use gohashtree",
        "created_at": "2022-12-10T14:24:21.724000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "if you dig deep enough",
        "created_at": "2022-12-10T14:24:26.851000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "Ah I see",
        "created_at": "2022-12-10T14:26:07.927000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Yeah we do hash with gohashtree most slices but this is internal to a function that takes a `ssz.Hasher` which itself has the wrong signature. It'd be nice to always use the signature of gohashtree's hasher",
        "created_at": "2022-12-10T14:27:14.763000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "That requires moving away from fastssz which is hard for us. Eventually I'll do that",
        "created_at": "2022-12-10T14:28:00.801000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Or perhaps you do that in Erigon and we use it ðŸ™‚",
        "created_at": "2022-12-10T14:28:28.240000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "No, In Erigon I just slap the auto generate hash tree root whenever I can and then just cache depth 5 leaves of the beacon state ðŸ˜„",
        "created_at": "2022-12-10T14:29:40.505000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "Thing is: optimizing is good but if it is just a few ms difference, I would rather prioritize code readability",
        "created_at": "2022-12-10T14:30:15.286000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "in our case hashing was between 20% and 27% of our full state transition, so it's rather non-trivial, and I haven't checked currently with the merge and the extra transactions hashing.",
        "created_at": "2022-12-10T14:44:09.517000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "well if the caching I do is not enough then I will go more hardcore later on, I just dont want to overcomplicate so early on in my prototype",
        "created_at": "2022-12-10T14:48:36.588000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "oh wait you guys are slapping auto-generated HashTreeRoot() on latestExecutionPayloadHeader though",
        "created_at": "2022-12-10T14:49:27.971000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "but I dont think that it is bottleneck as it just contain transaction root and not transaction list, i do not know if that is what you meant",
        "created_at": "2022-12-10T14:50:07.036000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "the header is just the root, but the payload has all transactions, which we need to hash",
        "created_at": "2022-12-10T14:54:42.455000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "you cannot cache blocks, you can cache the state",
        "created_at": "2022-12-10T14:54:59.920000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "general",
        "parent": "",
        "content": "Didnt get there yet but good to know",
        "created_at": "2022-12-10T15:09:38.966000+00:00",
        "attachments": null
    }
]