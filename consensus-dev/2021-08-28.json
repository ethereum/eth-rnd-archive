[
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "You keep saying that you wouldn’t broadcast bad blocks if you aren’t validating. But if your not checking the validity of blocks you can’t know if they’re good or bad so will gossip both good and bad blocks which will get you disconnected. The only other option is to not gossip blocks but that will get you disconnected for censorship.",
        "created_at": "2021-08-28T03:42:31.666000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Also I’m not saying there is t a problem. I’m saying the problem is actually during times when the chain is working. All blocks are valid then so you can get away without validating and that sets up bad behaviour. Then when the chain does split you may suddenly find you don’t have enough people actually validating to maintain network security and ensure the bad chain gets rejected.",
        "created_at": "2021-08-28T03:46:09.162000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "Everyone besides good geth checking is screwed, idk if you're able to follow the convo :)",
        "created_at": "2021-08-28T07:26:43.766000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "Disconnected from peers = screwed",
        "created_at": "2021-08-28T07:26:51.633000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Yeah it seems I'm not able to follow the convo, in part because it seems I'm not understanding prysm peer scoring system (the only implementation I know) nor why would a good geth not checking execution be gossiping blocks that he would deem bad from a consensus protective and wouldn't validate for.",
        "created_at": "2021-08-28T07:32:08.243000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "good geth not checking doesn't know which blocks are good and which are bad",
        "created_at": "2021-08-28T07:32:54.529000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "So it'll gossip both",
        "created_at": "2021-08-28T07:32:58.579000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "Right?",
        "created_at": "2021-08-28T07:33:00.392000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "No, he knows which blocks are bad from consensus because of fork choice",
        "created_at": "2021-08-28T07:33:33.407000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "The difference between the bad geth  checking is that this last one decides that he can only vote for blocks that are not going to be valid",
        "created_at": "2021-08-28T07:34:33.055000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "I didn't understand",
        "created_at": "2021-08-28T07:34:47.229000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Good geth not checking will decide that all execution payload is valid, but bad blocks will be ineligible for voting because of fork choice given the weight of the good chain",
        "created_at": "2021-08-28T07:35:43.359000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "Why does good chain have higher weight?",
        "created_at": "2021-08-28T07:36:07.322000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Because of the assumption as today 75% are good and 25 are bad",
        "created_at": "2021-08-28T07:36:34.934000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "Ohh. But in general the point of nodes is to defend against malicious majoriti of validators",
        "created_at": "2021-08-28T07:36:58.328000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "If you're gonna assume majority is honest then yes can blindly follow",
        "created_at": "2021-08-28T07:37:31.462000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Again come with altruism! This is not about the network, if everyone is not honest we are screwed that's clear",
        "created_at": "2021-08-28T07:37:34.652000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "This is about what's best for the one, not the whole",
        "created_at": "2021-08-28T07:37:47.169000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "Sorry we're talking about nodes or validators?",
        "created_at": "2021-08-28T07:38:09.387000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "And we do assume that the majority is honest anyway",
        "created_at": "2021-08-28T07:38:15.537000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I am saying that for a validator is better to not check execution payload today because there is no punishment for behaving this way. That's it",
        "created_at": "2021-08-28T07:39:14.114000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Adrian says it's not the case",
        "created_at": "2021-08-28T07:39:22.338000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "Got ir",
        "created_at": "2021-08-28T07:39:37.115000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "*it",
        "created_at": "2021-08-28T07:39:39.228000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "So these validators just stall until they know which has majority?",
        "created_at": "2021-08-28T07:40:21.918000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "Higher weight",
        "created_at": "2021-08-28T07:40:25.967000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "They don't stall, they may be unlucky and broadcsst a couple bad blocks, which shouldn't ban then from the entire validator set",
        "created_at": "2021-08-28T07:41:56.509000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "And in this whole discussion there's the thing that you can change your enr and retry to connect. I don't think clients cache anything more than peer id",
        "created_at": "2021-08-28T07:43:10.798000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "How do they know what to attest?",
        "created_at": "2021-08-28T07:43:15.488000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "As they do now, fork choice does not involve execution",
        "created_at": "2021-08-28T07:43:41.582000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "I didn't know that was the case. I'll read up",
        "created_at": "2021-08-28T07:44:03.113000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Wait you mean today? As in voting for eth1 data? In that case yeah the beacon blocks are valid even if they vote for an invalid or nonexistent block. So effectively no beacon validator is checking eth1 blocks when creating attestations. \nI’m talking post merge when the validator would be able to see the execution payload in the beacon block and the whole block is invalid if the execution payload is invalid.",
        "created_at": "2021-08-28T07:44:14.066000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "He's talking post Merge I think",
        "created_at": "2021-08-28T07:44:39.539000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Today= merge proposal today",
        "created_at": "2021-08-28T07:44:57.391000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I would like to have some penalty in place",
        "created_at": "2021-08-28T07:45:24.417000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "For that behavior",
        "created_at": "2021-08-28T07:45:34.062000+00:00",
        "attachments": null
    },
    {
        "author": "ghosts_in_the_code",
        "category": "general",
        "parent": "",
        "content": "Beacon chain doesn't check eth1 today though",
        "created_at": "2021-08-28T07:47:12.879000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I understand, by today I meant after the merge if it is as it's planned today",
        "created_at": "2021-08-28T07:49:48.111000+00:00",
        "attachments": null
    },
    {
        "author": "butta",
        "category": "general",
        "parent": "",
        "content": "\u003ca:wavy:412995058510462979\u003e",
        "created_at": "2021-08-28T07:49:50.936000+00:00",
        "attachments": null
    },
    {
        "author": "butta",
        "category": "general",
        "parent": "",
        "content": "eth1 voting ended up being fine?",
        "created_at": "2021-08-28T07:50:02.426000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "4:30 am here, with a cell in bed :) can probably check the majority hash, just a sec",
        "created_at": "2021-08-28T07:51:55.965000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Oh no, can't from the cell :) won't get out of bed for an hour",
        "created_at": "2021-08-28T07:55:02.653000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "\u003c@203220829473996800\u003e is remerkleable up to date? It can't deserialize my state:\n```\n    beacon_state = spec.BeaconState.decode_bytes(ssz_bytes)\n  File \"/home/heluani/.local/lib/python3.9/site-packages/rem\nerkleable/complex.py\", line 811, in decode_bytes\n    return cls.deserialize(stream, len(bytez))\n  File \"/home/heluani/.local/lib/python3.9/site-packages/rem\nerkleable/complex.py\", line 841, in deserialize\n    raise Exception(f\"offset {i} is invalid, size out of bou\nnds: {foffset}, next {next_offset},\"\nException: offset 1 is invalid, size out of bounds: 2694961,\n next 2787697, implied size: 92736, size bounds: [0, 73728]\n```",
        "created_at": "2021-08-28T08:03:43.652000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Same script I used to post the voting up in this same channel",
        "created_at": "2021-08-28T08:04:17.636000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "\u003c@755590043632140352\u003e Under PoW or PoS, someone can build an invalid block and distribute it.",
        "created_at": "2021-08-28T08:45:07.580000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "It is only by validating the block that you can identify that it is good.",
        "created_at": "2021-08-28T08:45:18.064000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "If someone knew you weren't validating blocks, they could produce an invalid block and give it to you and then you would gossip it and get kicked off the network.",
        "created_at": "2021-08-28T08:45:43.541000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "In the PoS case at least we have the protection that the person's signature will be on the block and they'll get slashed.  This is an improvement over the PoW situation.",
        "created_at": "2021-08-28T08:46:19.090000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "The thing is that under pos, when you get a block, you know that this block will not be in your chain without validating its execution part",
        "created_at": "2021-08-28T08:47:13.136000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Imagine you are the first to receive the block.  How do you know if you should gossip it or not?",
        "created_at": "2021-08-28T08:49:14.209000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "That is, only one other person has seen this block (the one who built it).",
        "created_at": "2021-08-28T08:49:37.006000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "For this mild attack on my validator to succeed you will have to produce a block in your turn, send it to me forfeiting your proposal, and gaining nothing but making me gossip a bad block.",
        "created_at": "2021-08-28T08:50:41.031000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Gossiping a bad block will get you kicked off the network.",
        "created_at": "2021-08-28T08:51:00.713000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "What if it is your turn to build a block next?",
        "created_at": "2021-08-28T08:51:14.167000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "You won't know that was a bad block because you got kicked, so you build on top of it.",
        "created_at": "2021-08-28T08:51:34.902000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Now you get slashed too.",
        "created_at": "2021-08-28T08:51:38.994000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Also, you cannot differentiate between being the first to receive the block and being the `nth`.",
        "created_at": "2021-08-28T08:52:13.403000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "You may have received the block from another person running without an execution client.  Now you two are on a partition.",
        "created_at": "2021-08-28T08:52:41.479000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Maybe there are 100s of you, all partitioned off on a fork.",
        "created_at": "2021-08-28T08:52:54.546000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Gossiping a bad block will not immediately kick you off the network, it will disconnect you from some peers and after the merge the thing of not validating execution implies either not proposing or validating when you are about to propose: you cannot propose blocks without validating",
        "created_at": "2021-08-28T08:53:45.849000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Out of curiosity. What is your goal in this discussion?  I didn't follow the first part closely.",
        "created_at": "2021-08-28T08:54:31.382000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I am pointing to a part of the protocol that relies on validators behaving altruistically when they have an advantage not doing so",
        "created_at": "2021-08-28T08:55:17.336000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Adrian is saying that there's no advantage (when the chain splits) and I maintain that there is",
        "created_at": "2021-08-28T08:55:49.367000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "My goal would be to try to find a way to penalize this behavior but I cannot think of one",
        "created_at": "2021-08-28T08:56:29.335000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "It is kind of the nature of gossip networks that it is possible to leach.  What you are describing is a trust-leaching \"attack\", where you assume that everyone else is behaving correctly and as long as that holds you can be a leach and be safe.",
        "created_at": "2021-08-28T08:57:41.394000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "It breaks down if *everyone* leeches, but it holds if relatively few people leech.",
        "created_at": "2021-08-28T08:57:55.639000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Correct",
        "created_at": "2021-08-28T08:58:18.918000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "The system is designed to try to punish leechers as much as is feasible.  Things like disconnecting peers that look like they are leeching, and aggressively disconnecting peers that are passing around invalid stuff are two such mitigations.",
        "created_at": "2021-08-28T08:58:48.662000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "The biggest mitigation though is just writing clients that don't leech.  This gets you like 99% of the way there.",
        "created_at": "2021-08-28T08:59:09.996000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Most people will just run the stock clients and won't go out of their way to download/install a client that gives them an incredibly tiny sliver of an edge while simultaneously being bad for the network, from some developer that has been excommunicated by the rest of the community.",
        "created_at": "2021-08-28T08:59:51.746000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I can imagine that is the case too",
        "created_at": "2021-08-28T09:01:58.294000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "But given since given a block it is deterministic to decide that the execution part is not consistent with it's parent, I suspect that there may be a way of making this offense slashable, without adding cost to the network",
        "created_at": "2021-08-28T09:06:21.355000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "And I just truly don't understand why there's even an argument about this issue.",
        "created_at": "2021-08-28T09:07:59.577000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "It is deterministic to figure out whether a block is valid or not, but you have to execute the block to figure that out.",
        "created_at": "2021-08-28T09:09:50.692000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Or do you mean slash anyone that gossips a bad block?",
        "created_at": "2021-08-28T09:10:00.484000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I think slashing on gossip would require signed gossip, which would be an anonymity leak.",
        "created_at": "2021-08-28T09:10:25.280000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Oh yeah, I don't know how to make this offense slashable given that we don't sign gossip, but we do sign attestations",
        "created_at": "2021-08-28T09:11:21.422000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "So attesting for such a block might be slashable",
        "created_at": "2021-08-28T09:11:36.113000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "And a non checking validator right at the fork today would have been slashed",
        "created_at": "2021-08-28T09:12:08.258000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "This threat alone might be already a deterrent",
        "created_at": "2021-08-28T09:12:22.608000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I think it is?",
        "created_at": "2021-08-28T09:15:16.971000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Oh I may have missed this in the spec, I thought it was only proposals that got slashed",
        "created_at": "2021-08-28T09:15:59.491000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "If that's the case then it was all moot and I should have stopped at the beginning",
        "created_at": "2021-08-28T09:16:26.959000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "No that is not slashable",
        "created_at": "2021-08-28T09:16:29.031000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "making that slashable would be a terrible idea",
        "created_at": "2021-08-28T09:16:41.276000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "If there is a client bug, all validators of that client gossiping that block would be liable to be \nslashed",
        "created_at": "2021-08-28T09:17:32.632000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I think we're saying attesting",
        "created_at": "2021-08-28T09:18:47.695000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Not gossiping",
        "created_at": "2021-08-28T09:18:53.457000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "same principle still applies",
        "created_at": "2021-08-28T09:19:15.063000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "But I get your point",
        "created_at": "2021-08-28T09:19:29.022000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "taking yesterday's incident as an example, instead of 25% of validators having offline penalties they would instead be slashed",
        "created_at": "2021-08-28T09:20:10.621000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "which would make a bad situation much worse",
        "created_at": "2021-08-28T09:20:21.975000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Today we would have slashed a bunch of validators and then at some point the ones on bad geth would have been stuck",
        "created_at": "2021-08-28T09:20:24.846000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Not being able to attest on anything",
        "created_at": "2021-08-28T09:20:33.581000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "There has to be a better way to guarantee that the execution payload is valid rather than slashing ?",
        "created_at": "2021-08-28T09:21:54.996000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "Using the phase0 or Altair type? And which testnet? Some testing states use a different preset (affects data structure)",
        "created_at": "2021-08-28T09:23:57.073000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "It's mainnet, I was using yesterday the same script to follow eth1 vote",
        "created_at": "2021-08-28T09:24:30.335000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Today it broke",
        "created_at": "2021-08-28T09:24:41.600000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Haven't really woken up yet to debug",
        "created_at": "2021-08-28T09:24:55.243000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I don't think it's a truncated state cause it's the first offset that fails",
        "created_at": "2021-08-28T09:25:34.801000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "Where are you fetching the state ssz from? Some APIs wrap it with the state root data",
        "created_at": "2021-08-28T09:25:59.987000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "Anyway, can debug in DM, let's not spam here",
        "created_at": "2021-08-28T09:26:22.292000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Prysm, my own node, which hasn't changed, and I have been using that script since before rayonism",
        "created_at": "2021-08-28T09:26:43.047000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "so going back to this: in a situation as yesterday, what should a validator do when its execution engine is giving it invalid blocks from the consensus perspective? I think this is the essence of the situation.",
        "created_at": "2021-08-28T09:40:47.252000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I mean, an honest validator on an old geth would have received blocks that he knows he can't vote on, it gets even worse after finalization, but even on the first few slots, not right after the fork, but after  weight is leaning towards the valid chain",
        "created_at": "2021-08-28T09:42:04.747000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "I guess I am very behind the merge spec, but why can't a validator only include attestations which have a valid execution payload into their forkchoice ? Any other attestations referencing invalid execution payloads are instead discarded",
        "created_at": "2021-08-28T09:43:05.209000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "the way it works today is that those validators will cut off the ones on the valid chain",
        "created_at": "2021-08-28T09:43:12.898000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "yeah, but that' s the point, this validator considers valid execution the bad one, and if he kept looking at the consensus p2p network he'd know this",
        "created_at": "2021-08-28T09:44:03.858000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "but since he's been cutting everyone on valid blocks because they were following a chain of invalid blocks (to his view)",
        "created_at": "2021-08-28T09:44:30.406000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "then he would continue on a bad chain",
        "created_at": "2021-08-28T09:44:39.007000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "we do this for beacon-blocks too, only attestations referencing valid beacon blocks are counted",
        "created_at": "2021-08-28T09:44:39.550000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "yes, but here we have an oportunity of weighing both separatedly",
        "created_at": "2021-08-28T09:45:11.852000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "what is wrong with that though ? if you think the invalid execution payload is valid because of a bug you would just be on a minority fork until you update",
        "created_at": "2021-08-28T09:45:27.323000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I think a validator in yesterday' s situation has enough information to guess that either his execution engine is faulty or its consensus network is tampered, and this information may be useful: I mean he knows that the majority of validators are following a wrong chain that couldn't possibly be valid.",
        "created_at": "2021-08-28T09:47:18.644000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "this does not happen in normal forkchoice now: currently the majority of validators are always on the right chain from the validator's perspective",
        "created_at": "2021-08-28T09:48:00.600000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "\u003e this does not happen in normal forkchoice now: currently the majority of validators are always on the right chain from the validator's perspective\nthey can only be on the right chain as long as you count their attestations as valid",
        "created_at": "2021-08-28T09:49:39.920000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "if they have junk execution payload, any resulting attestation referencing that should be discarded",
        "created_at": "2021-08-28T09:50:09.133000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "There is no way for a validator on an invalid fork to 'flip' due to the fact that their execution engine is faulty. Forkchoice relies on attestations to be referencing valid chains, any ones referencing invalid ones would basically be discarded.",
        "created_at": "2021-08-28T09:51:59.413000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Why is this a problem?  Validators who really care should be running their blocks through multiple clients before gossipping them to the broader network.",
        "created_at": "2021-08-28T09:54:53.359000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "We could have a smaller slash, perhaps not the full slash you get for proposing a bad block.",
        "created_at": "2021-08-28T09:55:37.464000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "But I think there *is* value in slashing anyone who gossips a bad block as it strongly incentivizes people to do things that we want them to do like:\n1. Run multiple clients, not just all run geth/prysm.\n2. Run execution clients they strongly trust.",
        "created_at": "2021-08-28T09:56:42.868000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "If you want to make running validators be reasonably viable for non-technical users , something like that wouldnt work. Anyone wanting to do something like that would have to be running a complex setup",
        "created_at": "2021-08-28T09:57:02.419000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I can appreciate that perhaps up to 16 ETH slash is too severe, but perhaps something like 0.1 ETH would be acceptable for those goals (or something in between).",
        "created_at": "2021-08-28T09:57:12.441000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "Users would just choose to stake with a 3rd party then and let them handle the risks",
        "created_at": "2021-08-28T09:57:30.513000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "By that logic we shouldn't slash people who propose bad blocks either, because they may just be running a bugged version of software.",
        "created_at": "2021-08-28T09:58:18.513000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I understand, this is the way it currently is expected to go with the merge: but I am pointing that there is extra information for a validator after the merge: it may happen that he can \"see\"  (if he doesn't cut the validators attesting for bad execution blocks\") that he's on a different, minority fork",
        "created_at": "2021-08-28T09:58:44.210000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "and he could weigh this: he could actually check that the other chain is good assuming that the execution on the other chain is good",
        "created_at": "2021-08-28T09:59:16.298000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I am not saying it should flip, jus that this info is there, is not like currently on pow, that you can see this too in a different manner",
        "created_at": "2021-08-28T09:59:51.044000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "here you have two completely separate fork choices pointing to different chains!",
        "created_at": "2021-08-28T10:00:06.744000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "The current rules of slashing right now are reasonably simple \n- Don't attest twice in the same epoch.\n- Don't Propose block in the same slot.\n- Don't perform a surround vote\n\nAdding in rules regarding block validity to it(execution payload) makes this much more complex. Stakers have accepted that as long as 2 instances of your keys aren't running at the same time you will be fine, now that something like execution payload validity is brought in, it is reasonable that majority of them\nwould perform an exit and simply stake with a 3rd party. No solo staker would be willing to accept \nliability for a client bug.",
        "created_at": "2021-08-28T10:03:22.301000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "If he can verify that the execution on the other chain is good, then there won't be any issue no ?",
        "created_at": "2021-08-28T10:04:27.232000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "just to clarify, right now is the validator running with a faulty execution engine and is on a minority fork ?",
        "created_at": "2021-08-28T10:05:22.998000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "side: eth1 voting seems perfectly fine on mainnet. Thanks \u003c@!203220829473996800\u003e \n```\nVoting summary for slot: 1943416\nVoting period starts:1941504  ends:1943552\n0x3c4f9c9aa837cb128167b74f984079534807df0fedcf459249ab03658d0e887c : 1812\n0x77d9ff94fd5e935b8d77510dd2afb389440a4dc0f44170cd9cc6f57280d159d6 : 19\n0xe3f526f9036d92b2903ea5ada1dd21c03c6afa55b4bcad49853b7219d5555497 : 1\n0x45c39d1d5d3e0aa836db2bd1667217b6f5737eb666fc3b4161b77b6074aff05d : 1\n```\nThe rest are random votes, the first hash seems valid",
        "created_at": "2021-08-28T10:05:33.998000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "yes exactly, the validator is on a faulty execution engine and knows its on a minority fork and knows that if he assumes his execution is wrong, then the other fork is actually good from consensus perspective",
        "created_at": "2021-08-28T10:15:43.669000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "so he knows one of the two things is wrong: his execution engine or the rest",
        "created_at": "2021-08-28T10:16:20.407000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Regarding being on the \"wrong\" chain.  It should be simple enough for the validator to confirm that the execution block it is going to propose is built on the execution block of the previous consensus block head.\n\nBut it should still be fine for the validator to publish the consensus block with a potentially bad (valid but not built on current head) execution block, because you can't be 100% sure either way.  If the block is bad it won't be included in the execution chain and the proposer gets no transaction rewards, so it all seems okay to me.",
        "created_at": "2021-08-28T10:18:29.891000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "Even if the validator does know that , what can it actually do anyway ? It can basically just log that the alternate chain might have a valid/invalid execution payload and vice versa for the fork it is on.",
        "created_at": "2021-08-28T10:19:53.576000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "\u003e But it should still be fine for the validator to publish the consensus block with a potentially bad (valid but not built on current head) execution block, because you can't be 100% sure either way.  \nThis would be fine as the execution block is still valid",
        "created_at": "2021-08-28T10:21:15.473000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Yeah I do not know how to properly use this information, but it's there, perhaps it can be used. In an event like yesterday for example all validators on wrong geth could have setup to get alarms and would have received an email",
        "created_at": "2021-08-28T10:22:48.673000+00:00",
        "attachments": null
    },
    {
        "author": "nishant0",
        "category": "general",
        "parent": "",
        "content": "I guess logging could be configured to handle something like this ?\nYou could alternatively modify forkchoice to rollback to the last stable execution head if there is a split like that. But I am not sure how to do that without deeply modifying lmd ghost and potentially introducing vulnerabilities",
        "created_at": "2021-08-28T10:26:19.741000+00:00",
        "attachments": null
    },
    {
        "author": "yorickdowne",
        "category": "general",
        "parent": "",
        "content": "And right now we don’t. Slashing only for doubling up and surround votes.",
        "created_at": "2021-08-28T12:59:42.735000+00:00",
        "attachments": null
    },
    {
        "author": "yorickdowne",
        "category": "general",
        "parent": "",
        "content": "I hate the idea of slashing for a bad block tbh. You already have missed opportunity cost - no proposal rewards, priority fees or MEV. Plus the missed proposal penalty.\n\nSlashing on a bad block would make me real nervous, and I trust my client and I know I upgrade the moment fixes are available",
        "created_at": "2021-08-28T17:35:24.305000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I think both \u003c@301186049323958275\u003e and myself are using the term \"slash\" too liberally to mean a harsh penalty for misbehavior. I think that the situation where a client bug can result in monetary loses for validators is already accepted. Whether or not this should be the case for certain types of bad blocks (for example not auto consistent) or bad attestations (for example attesting to said blocks)  is debatable. I myself am of a position where if there is any monetary edge to be made by not following the spec, people will find a way, therefore I'm inclined to penalize all bad behavior.",
        "created_at": "2021-08-28T18:39:49.174000+00:00",
        "attachments": null
    },
    {
        "author": "pietjepuk",
        "category": "general",
        "parent": "",
        "content": "If we don't penalize it, do we then end up with a data availability layer? I.e. if someone pays more than EVM execution pays, you just include that blob of data as a proposer?",
        "created_at": "2021-08-28T18:43:46.688000+00:00",
        "attachments": null
    },
    {
        "author": "treyzania",
        "category": "general",
        "parent": "",
        "content": "from the view of fully upgraded nodes (and by extension, any services like exchanges using upgraded versions of the software) absolutely nothing happened",
        "created_at": "2021-08-28T19:03:45.981000+00:00",
        "attachments": null
    },
    {
        "author": "treyzania",
        "category": "general",
        "parent": "",
        "content": "marginally I suppose, but any miners not using the correct version are literally burning cash because the \"old geth\" chain will never be the correct chain, so they have a high incentive to upgrade",
        "created_at": "2021-08-28T19:06:35.949000+00:00",
        "attachments": null
    },
    {
        "author": "treyzania",
        "category": "general",
        "parent": "",
        "content": "if they haven't upgraded it's because they are negligent, not because they want to use the out-of-spec version for some reason",
        "created_at": "2021-08-28T19:07:08.464000+00:00",
        "attachments": null
    },
    {
        "author": "treyzania",
        "category": "general",
        "parent": "",
        "content": "I'm great",
        "created_at": "2021-08-28T19:07:30.318000+00:00",
        "attachments": null
    },
    {
        "author": "treyzania",
        "category": "general",
        "parent": "",
        "content": "atla",
        "created_at": "2021-08-28T19:07:55.731000+00:00",
        "attachments": null
    },
    {
        "author": "treyzania",
        "category": "general",
        "parent": "",
        "content": "is that a widely-held opinion?",
        "created_at": "2021-08-28T19:08:08.255000+00:00",
        "attachments": null
    },
    {
        "author": "treyzania",
        "category": "general",
        "parent": "",
        "content": "miners using the old geth are just producing invalid blocks, that's it",
        "created_at": "2021-08-28T19:09:12.818000+00:00",
        "attachments": null
    },
    {
        "author": "treyzania",
        "category": "general",
        "parent": "",
        "content": "it means pretty little",
        "created_at": "2021-08-28T19:09:39.403000+00:00",
        "attachments": null
    },
    {
        "author": "treyzania",
        "category": "general",
        "parent": "",
        "content": "let's move to \u003c#595721451651465227\u003e",
        "created_at": "2021-08-28T19:09:52.471000+00:00",
        "attachments": null
    }
]