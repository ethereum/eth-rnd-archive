[
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Assuming an individual is running a minority client (25% validator share), what is the worst case loss if there is a critical bug in that client that results in them (and everyone else running the same client) getting slashed?  Is it 16 ETH?",
        "created_at": "2022-07-29T09:17:27.484000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Similarly, if an individual has a bug in their setup that doesn't affect anyone else, what is the worst case loss if there is a critical bug/failure in their setup that results in them getting slashed?  Is it 16 ETH or something less?",
        "created_at": "2022-07-29T09:18:03.511000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "The spec: https://github.com/ethereum/consensus-specs/blob/dev/specs/phase0/beacon-chain.md#slashings\nDescription in English: https://eth2book.info/altair/part2/incentives/slashing#the-correlation-penalty\n\nAltair:\nInitial slashing cost is 1/64 of effective balance\nIf there is 25% correlation then each validator will get additional burn of 1/2 of its effective balance. That is, `1/4 (25%) * PROPORTIONAL_SLASHING_MULTIPLIER_ALTAIR (= 2)`\n\nBellatrix:\nInitial slashing cost is 1/32 of effective balance\nCorrelation burn is 3/4: `1/4 * PROPORTIONAL_SLASHING_MULTIPLIER_BELLATRIX (= 3)`\nSo, each validator balance is slashed by `25 ETH` at max after Bellatrix",
        "created_at": "2022-07-29T09:37:02.108000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Though, it seems correlation penalty is applied after initial penalty had been. In this case it is `24.25 ETH` at max",
        "created_at": "2022-07-29T09:41:09.246000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Hmm, interesting.  That is much higher than I expected for a minority client!",
        "created_at": "2022-07-29T09:49:06.190000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "\u003e `1/4 (25%) * PROPORTIONAL_SLASHING_MULTIPLIER_BELLATRIX (= 3)`\nDoes this mean that a majority client would get over 100% slashed, up to 300% slashed?",
        "created_at": "2022-07-29T09:50:23.573000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Yes, but it's capped by 100%",
        "created_at": "2022-07-29T09:50:51.466000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "And this is all a percentage of 32 ETH, not the validator's current balance, right?",
        "created_at": "2022-07-29T09:51:07.931000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "It is percentage of validator's effective balance which is between 16 and 32 ETH",
        "created_at": "2022-07-29T09:51:28.972000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "So if you are going to do an attack, you lose less if you already have lost a bunch?",
        "created_at": "2022-07-29T09:52:07.213000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "While not a critical problem, that feels like an incentive misalignment as it means someone who has been a poor or bad actor in the past suffers less from bad acting in the future.",
        "created_at": "2022-07-29T09:52:35.854000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "It feels like you should punish an actor with a history of bad behavior the same or worse than you punish an actor with a history of good behavior (I favor \"same\").",
        "created_at": "2022-07-29T09:53:01.268000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "It suffers less but it also a less powerful adversary",
        "created_at": "2022-07-29T09:53:03.322000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I guess it does make the math a bit easier to work out.  And validator signatures are weighted by their \"effective balance\"?",
        "created_at": "2022-07-29T09:53:30.479000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "That is, there is nothing in the protocol that is \"one vote per validator\"?",
        "created_at": "2022-07-29T09:53:48.642000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "You can't be slashed twice, slashed validator is automatically withdrawn. You can leak due to being offline to reduce your balance",
        "created_at": "2022-07-29T09:54:15.326000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Right, leaking meaning \"poor actor\" here, unless they were leaking due to participation in some other attack (in which case they would be \"bad actor\").",
        "created_at": "2022-07-29T09:55:20.337000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "So if I have a bug in my setup that results in double signing and no one else does, then I'll lose 0.5 ETH and be force exited (I can rejoin after I fix my bug).  If there is a bug in the client I use which has 25% share, then I'll lose 24.25 ETH and be force exited (I can rejoin after my client is patched).",
        "created_at": "2022-07-29T09:56:34.705000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I guess this argues pretty strongly for using Lodestar with their 0.02% share.  ðŸ˜†",
        "created_at": "2022-07-29T09:57:04.289000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Even if it has a higher chance of bug, the impact of a critical bug is *way* lower than the impact of a critical bug in Teku even (with 17.22% share).",
        "created_at": "2022-07-29T09:57:31.957000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "And it further incentivizes people writing their own clients even, since failure of those will likely be on the order of epsilon + 0.5 ETH.",
        "created_at": "2022-07-29T09:58:04.067000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "yes, every vote is stick to effective balance",
        "created_at": "2022-07-29T10:01:47.578000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "1 ETH in the first case. And you will have to withdraw and deposit again",
        "created_at": "2022-07-29T10:05:59.727000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Do you *also* suffer from any sort of other penalties (like inactivity leaking) during that time?  Or is 1 ETH the least you could possibly lose in a slashing event?",
        "created_at": "2022-07-29T10:07:00.521000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "This is why there is a slashing protection built into all CL clients. It is simple and efficient, though, a bug in slashing protection may also occur, but having it should substantially reduce the risk",
        "created_at": "2022-07-29T10:07:43.270000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "If you're slashed, ~~you're immediately ejected like if it was a voluntary exit and no other penalties are applied~~ you're subject to exit queue and remain \"active\" until exit epoch is reached, so, penalties are applied",
        "created_at": "2022-07-29T10:08:32.046000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Hmm, the docs you linked above appear to disagree with that.",
        "created_at": "2022-07-29T10:10:19.397000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Under \"Other penalties\" it implies that you also suffer inactivity leak for the 8192 epochs you are out because you can't attest, but you are expected to attest.",
        "created_at": "2022-07-29T10:11:30.906000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "\u003e A validator that is slashed continues to receive attestation penalties until its withdrawable epoch, which is set to 8192 epochs (36 days) after the slashing, and they are unable to receive any attestation rewards during this time. They are also subject for this entire period to any inactivity leak that might be in operation.",
        "created_at": "2022-07-29T10:11:46.414000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Actually, slashed validator goes through exit queue and its exit epoch set according to the churn. As long as network didn't progress beyond the set exit epoch validator is considered active with all outcomes.",
        "created_at": "2022-07-29T10:17:29.777000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "These statements don't seem to align with the docs you linked.  Are they out of date?",
        "created_at": "2022-07-29T10:18:55.687000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "This section in particular: https://eth2book.info/altair/part2/incentives/slashing#other-penalties",
        "created_at": "2022-07-29T10:19:34.019000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "I would like to double check with \u003c@573787335796326400\u003e, as from my point of view this statement diverges from the spec",
        "created_at": "2022-07-29T10:20:18.104000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "NVM, Ben is right on that. The condition we're talking about is as follows:\n`if is_active_validator(v, previous_epoch) or (v.slashed and previous_epoch + 1 \u003c v.withdrawable_epoch)`",
        "created_at": "2022-07-29T10:25:28.933000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "So, slashed validator is receiving penalties until withdrawable epoch. Or in case of mass slashing when the queue is longer than that it will get penalized until exit_epoch",
        "created_at": "2022-07-29T10:32:02.394000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "And withdrawable epoch is 8000 epochs, which is a lot of inactivity leaking right?",
        "created_at": "2022-07-29T10:35:13.104000+00:00",
        "attachments": null
    },
    {
        "author": "benjaminion",
        "category": "general",
        "parent": "",
        "content": "Yes, indeed, as I noted. But we've never had an inactivity leak on mainnet, so it's a bit of an edge case.",
        "created_at": "2022-07-29T10:37:38.382000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I thought even a single validator being inactive for 8000 epochs would result in substantial losses for that validator?",
        "created_at": "2022-07-29T10:38:55.593000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Inactivity leak is only turned on when the chain is not finalizing",
        "created_at": "2022-07-29T10:39:05.404000+00:00",
        "attachments": null
    },
    {
        "author": "benjaminion",
        "category": "general",
        "parent": "",
        "content": "Yes, it's a global property.",
        "created_at": "2022-07-29T10:39:26.849000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Oh, so that penalty *only* applies if the chain is failing to finalize?  Otherwise there are no other penalties associated with a slashing other than the initial penalty and the correlation penalty?",
        "created_at": "2022-07-29T10:39:44.859000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "If I'm understanding this all correctly, then the numbers are something like:\nSolo validator slashed, no correlation, chain continues to finalize: Loss = 1 ETH\nMinority client slashing, 25% of network is slashed, chain continues to finalize: Loss 24.25 ETH\nMinority client slashing, 25% of network is slashed, chain fails to finalize for the full 8192 epochs: Loss 32 ETH",
        "created_at": "2022-07-29T10:41:46.924000+00:00",
        "attachments": null
    },
    {
        "author": "benjaminion",
        "category": "general",
        "parent": "",
        "content": "Three actual penalties and one potential:\n  - Initial punishment (1 ETH post-Merge)\n  - Correlation penalty (up to 32 ETH)\n  - Penalities for 8192 epochs for not making attestations (roughly equivalent to 36 days' normal rewards)\n  - [Potentially] The inactivity leak penalty for 8192 epochs which would be huge",
        "created_at": "2022-07-29T10:42:04.357000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Ah, what is the range of penalties expected for 8192 missed attestations?  Would that just be `4.2% * 36 days / 365 days = ~0.41%`?",
        "created_at": "2022-07-29T10:44:52.106000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "(given current 4.2% yield based on current validator count)",
        "created_at": "2022-07-29T10:45:15.322000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "If inactivity leak is happening a validator will leak out from 32 Ether down to 16.75 (and hence ejected) within about 23 days (or at least it will when the proper values for the penalties are restored).",
        "created_at": "2022-07-29T10:45:54.341000+00:00",
        "attachments": null
    },
    {
        "author": "benjaminion",
        "category": "general",
        "parent": "",
        "content": "Slashed validators are already ejected, so I think they can leak well below 16 ETH. But I haven't checked the code.",
        "created_at": "2022-07-29T10:46:38.813000+00:00",
        "attachments": null
    },
    {
        "author": "benjaminion",
        "category": "general",
        "parent": "",
        "content": "Times 0.84 since 84% of rewards are from attesting. But you also don't get block rewards during those 8192 epochs, so take your pick.",
        "created_at": "2022-07-29T10:47:37.911000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "general",
        "parent": "",
        "content": "Worth noting that these penalties are also a factor of *slashed* effective balance",
        "created_at": "2022-07-29T10:48:24.203000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "But after 23 days the rest of the validators causing the inactivity leak will have been ejected, so the chain will finalize again, I think.",
        "created_at": "2022-07-29T10:50:12.880000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "It would be really cool if someone could write this up in a way that is easy to understand/consumable for the average staker.  I think it would be valuable to help people make decisions around \"should I stake\" by better understanding what the various downside scenarios look like.  They can then factor that into their risk assessment and compare it against the rewards to determine whether it is a risk they think is worth taking.",
        "created_at": "2022-07-29T10:50:14.668000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "\"Don't get slashed.\"",
        "created_at": "2022-07-29T10:50:32.904000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "No one can guarantee that, you can only mitigate chances of it.",
        "created_at": "2022-07-29T10:50:43.751000+00:00",
        "attachments": null
    },
    {
        "author": "killari.",
        "category": "general",
        "parent": "",
        "content": "== don't run validator",
        "created_at": "2022-07-29T10:50:46.246000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Hah!  True, that is one way to guarantee not getting slashed.  ðŸ˜„",
        "created_at": "2022-07-29T10:50:55.845000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Reality is the penalties are too dependent on the state of the network to provide a simple answer to \"what happens if I get slashed?\", I suspect.",
        "created_at": "2022-07-29T10:51:16.112000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "The idea is that someone should be able to say something like, \"I think the chance of a client/configuration bug resulting in me getting slashed is 1% per year\" and then they can look at the reward rate (4.2%) and the various penalty scenarios if they *do* get slashed and find out if staking is EV+ for them.",
        "created_at": "2022-07-29T10:51:55.368000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "More \"don't have your validating keys in more than one (online) place\", assuming we aren't also going to talk about hacks.",
        "created_at": "2022-07-29T10:51:56.482000+00:00",
        "attachments": null
    },
    {
        "author": "killari.",
        "category": "general",
        "parent": "",
        "content": "mostly bugs",
        "created_at": "2022-07-29T10:52:11.786000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "It also may help people better understand how much money they save by using a minority client in the case of a client bug that leads to slashing.",
        "created_at": "2022-07-29T10:52:13.107000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "\"Chance of getting slashed\" is the new Drake equation.",
        "created_at": "2022-07-29T10:52:18.499000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "IIUC, if you run Lighthouse and there is a critical bug in it that results in slashing for all Lighthouse users, you lose orders of magnitude less than if you run Prysm and it has a critical bug that results in slashing for all Prysm users.",
        "created_at": "2022-07-29T10:53:15.630000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Have bugs ever caused a slashing on mainnet?  The operational side of things is far more likely to cause a loss, rather than a bug.",
        "created_at": "2022-07-29T10:53:27.499000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Since we *want* client diversity, putting this into an easy to consume format may help encourage people to spread out across clients more.",
        "created_at": "2022-07-29T10:53:32.497000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Yep this is true, and has been a big part of the validator \"pull\" for client diversity (as opposed to the EF \"push\" for diversity).",
        "created_at": "2022-07-29T10:54:00.211000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Not yet, but the thing has been running for what, 2 years?  I wouldn't say that is enough history to have huge confidence, especially since consensus code *does* change over time as clients receive various performance improvements and bug fixes.",
        "created_at": "2022-07-29T10:54:21.013000+00:00",
        "attachments": null
    },
    {
        "author": "killari.",
        "category": "general",
        "parent": "",
        "content": "I don't know",
        "created_at": "2022-07-29T10:54:21.068000+00:00",
        "attachments": null
    },
    {
        "author": "jgm",
        "category": "general",
        "parent": "",
        "content": "Sure, but I don't see how anyone could provide a value for chance of being slashed based on the potential for future bugs in unwritten code.  We do understand the cause of most (possibly all) of the mainnet slashings, though, and they have all involved having keys being active on multiple machines at the same time.",
        "created_at": "2022-07-29T10:55:54.636000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Someone with a history of software development can at least have a gut feeling about what is a reasonable expectation I think.",
        "created_at": "2022-07-29T10:56:20.993000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "There are also key compromises, and one can certainly *imagine* a bug in a particular validator that allowed remote execution and key exfiltration which functionally results in all validators of that client getting slashed (because the hacker slashed them all).",
        "created_at": "2022-07-29T10:57:26.711000+00:00",
        "attachments": null
    },
    {
        "author": "killari.",
        "category": "general",
        "parent": "",
        "content": "its interesting to see what kind of games the hackers will play with these, as they can just grief",
        "created_at": "2022-07-29T10:58:26.775000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "This is probably good point to move the conversation over to EthStaker Discord as I think my R\u0026D/specification questions have been answered and now this is more about community outreach and documentation.",
        "created_at": "2022-07-29T11:00:51.518000+00:00",
        "attachments": null
    }
]