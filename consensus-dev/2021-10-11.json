[
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Moving here a discussion we had at the prysm Discord. I've tried looking at the spec tests but didn't find anything. I'm interested in testing vectors for  edge cases at the Altair fork. If a validator is slashed in phase0 it may still be active (but leaking) at the fork and be assigned to a sync committee. There are spec tests to check slashing validators' penalties, but I wonder about the fork itself: in principle existing implementations may try to precompute the penalties modulo knowing the base_fee and they would behave differently if the validator was slashed after the fork (covered by the tests) than if the validator was slashed before (and thus not covered). Something similar if lots of exits are started and there's a queue at the fork. Or even more drastically if there's quadratic leaking at the fork since that also changes in Altair",
        "created_at": "2021-10-11T22:26:53.252000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Admittedly those are edge cases, but they actually may cause a consensus failure and it could be as cheap as slashing one validator before the fork",
        "created_at": "2021-10-11T22:27:56.256000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "yeah, nice call on tests. Essentially, take an altair state and make it so a bunch of things happened an epoch or two prior to the altair fork. You're right in that some of this is likely under tested. And you're right that caches and poor assumptions at the fork boundary could cause consensus errors",
        "created_at": "2021-10-11T22:28:59.256000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "pre-fork boundary:\n* slashing\n* in activation queue\n* in exit queue",
        "created_at": "2021-10-11T22:29:43.932000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "might be a few more",
        "created_at": "2021-10-11T22:29:47.422000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "essentially anything that can be triggered in fork A that will have a delayed effect to happen in fork B",
        "created_at": "2021-10-11T22:30:08.305000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "cc: \u003c@!539495253418180618\u003e \n\nYou and I should hammer some of these out asap.",
        "created_at": "2021-10-11T22:30:46.780000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I'll look at the test vector generators but I suppose \u003c@415109946682769408\u003e would know how to do this in 5 minutes",
        "created_at": "2021-10-11T22:31:12.319000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Ah you already pinged alex :)",
        "created_at": "2021-10-11T22:31:34.876000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "yeah, \u003c@!415109946682769408\u003e, \u003c@!539495253418180618\u003e and I have owned them recently",
        "created_at": "2021-10-11T22:31:35.006000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "would you mind dropping this in an issue on the consensus-specs repo? we'll take it from there",
        "created_at": "2021-10-11T22:31:47.867000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "thank you!",
        "created_at": "2021-10-11T22:32:05.764000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "posted \u003chttps://github.com/ethereum/consensus-specs/issues/2662\u003e",
        "created_at": "2021-10-11T22:37:12.740000+00:00",
        "attachments": null
    }
]