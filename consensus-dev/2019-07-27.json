[
    {
        "author": "sorpaas",
        "category": "general",
        "parent": "",
        "content": "Wonder, what are the reasons we put state.balances separate from state.validators? Is it so that certain operations are cheaper? What are those operations?",
        "created_at": "2019-07-27T07:16:44.849000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "General idea is to segregate a high-frequency changing thing from a lower frequency changing thing. By doing this we can save on recomputation during the tree hash",
        "created_at": "2019-07-27T07:27:42.772000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "If balance was a field of validator, then you would have to re-hash a lot more data for every state root",
        "created_at": "2019-07-27T07:28:37.842000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "By separating the balances out, you can cache large parts of the beacon state hash tree root computation",
        "created_at": "2019-07-27T07:29:06.917000+00:00",
        "attachments": null
    },
    {
        "author": "kiwi.eth",
        "category": "general",
        "parent": "",
        "content": "https://notes.ethereum.org/jDcuUp3-T8CeFTv0YpAsHw?view mentions briefly it is to reduce rehashing as well",
        "created_at": "2019-07-27T07:46:42.884000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "So, the new nested structure for tests is nearly complete (completed test gen updating, working on documentation). This includes updating the SSZ-static tests (handler = ssz type, suite = randomization mode, case = variation with RNG seed), this cover all phase 0 types (or at least the valid-encoding case). But I am not sure how to go about the old SSZ-generic tests. We don't really have a way to describe a type between different languages, and the old integer tests are not that great. Does anyone have some ideas how to go about extending/changing  ssz-generic?",
        "created_at": "2019-07-27T12:35:13.849000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "One of the options on the table is porting over the set of SSZ tests the pyspec uses, https://github.com/ethereum/eth2.0-specs/blob/dev/test_libs/pyspec/eth2spec/utils/ssz/test_ssz_impl.py\nAnd then make the types used in that test part of the format spec, since we cannot describe the type dynamically.",
        "created_at": "2019-07-27T12:39:33.089000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "The SSZ specs already define the SSZ types in a language agnostic way though",
        "created_at": "2019-07-27T12:41:27.220000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "Not in a way that the type can be parsed from a test file",
        "created_at": "2019-07-27T12:42:11.692000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "We don't have something like the ABI encoding for SSZ (afaik), just python-esque spec description",
        "created_at": "2019-07-27T12:42:57.265000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "mmmh, we could have {\"kind\": \"Vector\", \"data\": [{\"kind\": \"uint64\", \"value\": 123}, {\"kind\": \"uint64\", \"value\": 456}]}, but that's very noisy",
        "created_at": "2019-07-27T12:46:47.342000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "and error prone, don't want mixed types in a vector or list",
        "created_at": "2019-07-27T12:47:22.752000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "are there still heterogeneous containers?",
        "created_at": "2019-07-27T12:47:43.896000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "Well, container can have mixed fields. But lists/vectors don't have mixed type elements.",
        "created_at": "2019-07-27T12:48:26.008000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "The old ssz-generic generator has a type definition renderer, but it's super outdated",
        "created_at": "2019-07-27T12:49:04.090000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "so a field could be\n\n```\n- field\n  - container: List / Vector / Literal\n  - element: uint64\n  - value: [1, 2, 3] / 123\n```",
        "created_at": "2019-07-27T12:49:42.027000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "Thanks for the input, but it's not trivial. It needs to parse somehow, and nest elegantly somehow.",
        "created_at": "2019-07-27T12:51:42.472000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "Yeah I know, and it complicates the test suite especially for static languages",
        "created_at": "2019-07-27T12:52:16.519000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "I think folder-based types and client hardcode the type deserialization might be simpler, unless we expect lots of new mixed/nested test in the future",
        "created_at": "2019-07-27T12:53:19.279000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "It's tempting to just remove the ssz-generic. Clients are welcome to copy over the cases of `test_ssz_impl.py`, and can do so in their own language/test agnostic way.",
        "created_at": "2019-07-27T12:53:51.249000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "On the other end, fuzzing would be more effective if we can make the fuzzer do any random type, instead of just the phase 0 types.",
        "created_at": "2019-07-27T12:55:43.049000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "The main value of SSZ generics is for client to test and agree on exceptional or invalid serialization/deserialization",
        "created_at": "2019-07-27T12:56:20.448000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "ssz-static is already doing randomization. Just not the invalid cases (e.g. invalid offsets). The fuzzer could do that technically, but the types are still a problem",
        "created_at": "2019-07-27T12:57:13.573000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "We can choose to focus it on just the base types or types + a single container (i.e. non nested)",
        "created_at": "2019-07-27T12:57:22.056000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "general",
        "parent": "",
        "content": "overhauling ssz-generic now, implemented tests for bitvector, bitlist, booleans, and uints. Containers still a bit unclear, but looks like it can be done reasonably with a few pre-defined container types.",
        "created_at": "2019-07-27T14:43:43.587000+00:00",
        "attachments": null
    }
]