[
  {
    "author": "dgusakov",
    "category": "general",
    "parent": "",
    "content": "Gm devs! I have a question regarding EB updates.\nImagine you have a 0x01 validator. You were offline for a while, and your EB is now 31 ETH. Now you are back online. To move back to 32 ETH EB, you need to have 32.25 ETH, but this is impossible since sweep will not allow you to do that, right?",
    "created_at": "2026-01-30T13:17:46.907000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "general",
    "parent": "",
    "content": "Is partially withwabale checks for max eb\n```\n    Check if ``validator`` is partially withdrawable.\n    \"\"\"\n    max_effective_balance = get_max_effective_balance(validator)\n    # [Modified in Electra:EIP7251]\n    has_max_effective_balance = validator.effective_balance == max_effective_balance\n    # [Modified in Electra:EIP7251]\n    has_excess_balance = balance > max_effective_balance\n    return (\n        # [Modified in Electra:EIP7251]\n        has_execution_withdrawal_credential(validator)\n        and has_max_effective_balance\n        and has_excess_balance\n    )\n```",
    "created_at": "2026-01-30T13:36:33.303000+00:00",
    "attachments": []
  },
  {
    "author": "dgusakov",
    "category": "general",
    "parent": "",
    "content": "Yeah, but my question is about effective balance update, and not partial withdrawals",
    "created_at": "2026-01-30T13:38:00.865000+00:00",
    "attachments": []
  },
  {
    "author": "potuz",
    "category": "general",
    "parent": "",
    "content": "But you don't withdraw until you have max EB",
    "created_at": "2026-01-30T13:39:23.686000+00:00",
    "attachments": []
  },
  {
    "author": "tbenr",
    "category": "general",
    "parent": "",
    "content": "even if in teku we implemented PB change, and has not been complicated, I was looking into the changes and i'm a bit uncomfortable with advancing the slot of the head state every time. Maybe we could have a FULU version at least leveraging the lookahead in the state?",
    "created_at": "2026-01-30T13:43:01.522000+00:00",
    "attachments": []
  },
  {
    "author": "tersec",
    "category": "general",
    "parent": "",
    "content": "yeah when I looked at this, it was also one of the things I was wary about. it makes that getHead function more intrinsically side-effectful",
    "created_at": "2026-01-30T13:45:00.730000+00:00",
    "attachments": []
  },
  {
    "author": "tersec",
    "category": "general",
    "parent": "",
    "content": "and I tried a couple of shortcuts (other \"head\"/\"canonical\" chains Nimbus tracks already) and it didn't seem to line up with what the tests wanted",
    "created_at": "2026-01-30T13:45:35.830000+00:00",
    "attachments": []
  },
  {
    "author": "tbenr",
    "category": "general",
    "parent": "",
    "content": "yes.. i initially thought it was a teku implementation issue but it is actually like that in the spec",
    "created_at": "2026-01-30T13:45:42.228000+00:00",
    "attachments": []
  },
  {
    "author": "tersec",
    "category": "general",
    "parent": "",
    "content": "it's literally written that way in specs yes",
    "created_at": "2026-01-30T13:45:57.620000+00:00",
    "attachments": []
  },
  {
    "author": "tbenr",
    "category": "general",
    "parent": "",
    "content": "I think we can have a version that gets it right but I don't like leaving this as an optimization in the clients with a spec implementing a naive version",
    "created_at": "2026-01-30T13:47:30.769000+00:00",
    "attachments": []
  },
  {
    "author": "tersec",
    "category": "general",
    "parent": "",
    "content": "right, this is a case of the fc spec being more-or-less nonimplementable as written",
    "created_at": "2026-01-30T13:47:55.360000+00:00",
    "attachments": []
  },
  {
    "author": "tersec",
    "category": "general",
    "parent": "",
    "content": "or maybe a CL did, I don't know, but significant tradeoffs",
    "created_at": "2026-01-30T13:48:29.759000+00:00",
    "attachments": []
  },
  {
    "author": "tersec",
    "category": "general",
    "parent": "",
    "content": "in particular, in Nimbus, fc never actually advances states/slots",
    "created_at": "2026-01-30T13:49:09.597000+00:00",
    "attachments": []
  },
  {
    "author": "tersec",
    "category": "general",
    "parent": "",
    "content": "(that's obviously Nimbus-specific, but the general idea of just dropping slot-movement and I guess an entirely new state (?!?) being stored to fork choice is ...)",
    "created_at": "2026-01-30T13:49:55.783000+00:00",
    "attachments": []
  }
]