[
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "I'm trying to understand what exactly Builders are going to do in Eth 2.0 PBS. I watched couple of presentations (i.e. about Danksharding) and trying to find some documentation but it is surprisingly difficult to find exact specs (am I looking in the wrong places?). My current understanding is that the Builder will be responsible on processing all data shards streams and generating total execution block from all the data shards (effectively validating and executing everything from every shard). Is this correct? If not, could you please point me to some documentation where can i find the exact responsibilities of a builder (as regards to execution)?",
        "created_at": "2022-06-13T15:28:20.093000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "\u003c@543900561460822016\u003e maybe you know?",
        "created_at": "2022-06-13T15:28:35.545000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "Or builders comprise single execution chain and the transactions in this chain will refer to data shards?",
        "created_at": "2022-06-13T15:35:04.963000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "there is a WIP spec here: https://github.com/ethereum/consensus-specs/pull/2792",
        "created_at": "2022-06-13T15:35:59.205000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "\"shards\" don't need to be executed -- a better way to think about it imo is that builders just collect all of the data they can (e.g. from rollup sequencers) and then make it available",
        "created_at": "2022-06-13T15:37:55.630000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "builders will also be building a full execution block along w/ the data committments from the \"shards\"",
        "created_at": "2022-06-13T15:38:38.649000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "the ground work for all of this would happen in EIP-4844",
        "created_at": "2022-06-13T15:38:54.541000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "\"Add a new type of transaction that can contain additional sharded data as calldata. The block is then constructed by a single block builder (which can be different from the proposer using proposer builder separation), and includes normal transactions as well as transactions with sharded calldata. \" \u003c- this comment from https://notes.ethereum.org/3t5cbN7cQnG6VxjgNMKymA explains it I think",
        "created_at": "2022-06-13T15:39:18.887000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "i'd start by understanding EIP-4844 -- the \"shards\" are just the blobs there",
        "created_at": "2022-06-13T15:39:27.377000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "then danksharding layers more sophisticated techniques on top to improve the trust model",
        "created_at": "2022-06-13T15:39:44.354000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "yeah that's EIP-4844",
        "created_at": "2022-06-13T15:40:05.408000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "so basically  \"Or builders comprise single execution chain and the transactions in this chain will refer to data shards?\" \u003c- this is close to correct understanding",
        "created_at": "2022-06-13T15:40:18.912000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "ok, thanks a lot!",
        "created_at": "2022-06-13T15:40:37.258000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "so there is just one execution chain",
        "created_at": "2022-06-13T16:05:25.382000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "it can contain references to data that is not directly accessible inside the EVM",
        "created_at": "2022-06-13T16:05:46.947000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "those references are basically just stored into the state so that sometime later proofs can be made that a given chunk of data was included or not",
        "created_at": "2022-06-13T16:06:13.879000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "this is enough to build all the various rollup constructions we want on top",
        "created_at": "2022-06-13T16:06:25.121000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "the most direct analogy to \"execution shards\" here are that the rollups are the execution shards",
        "created_at": "2022-06-13T16:07:36.819000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "but wrt to the core L1 i wouldn't try too hard to find \"shards\"",
        "created_at": "2022-06-13T16:07:54.001000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "so zkRollup for instance will publish the proof (as blob) to data shard and send a transaction to Builders that says \"verify and apply the proof from this data shard\" - something like that?",
        "created_at": "2022-06-13T16:08:01.606000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "i can't speak to the exact details but at a high-level: the zkrollup assembles a block along with a zkproof of the state transition\n\nthe sequencer sends to the builder a data commitment to the block, a \"proof of equivalence\" from the zkproof to the data committment and then the zkproof that the transition was valid\n\nif everything verifies then the rollup anchor updates the state root",
        "created_at": "2022-06-13T16:10:31.248000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "at which step in the above the rollup publishes the zkproof to some data shard?",
        "created_at": "2022-06-13T16:12:13.179000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "the rollups publishes the full zk-rollup-block data in the sharded data portion of the protocol and simultaneously publishes the proof in relation to that data commitment to the execution/evm/state portion of the protocol",
        "created_at": "2022-06-13T16:14:01.323000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "ok, I see.",
        "created_at": "2022-06-13T16:14:20.025000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "just to make sure I understand: \n1) rollup publishes zk-rollup-block data to some data shard.\n2) rollup sends a transaction to some Builder with zk-proof that state transitions in the above zk-rollup-block is correct, Builder executes the tx.\n?",
        "created_at": "2022-06-13T16:15:42.280000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "think of it first without the builder.\n\nThe rollup can publish a \"blob carrying TX\" with the data and the proof (referencing the commitment to the data) in one place. Or they can publish the data and then later send a TX that references the data commitment",
        "created_at": "2022-06-13T16:16:56.867000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "when the builder is there, those TXs are just being bundled by a builder instead of a validator",
        "created_at": "2022-06-13T16:17:27.744000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "\"in one place\" - can this place be data shard?",
        "created_at": "2022-06-13T16:17:34.891000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "in one TX",
        "created_at": "2022-06-13T16:17:44.441000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "you mean how it happens currently on Eth 1.0 ?",
        "created_at": "2022-06-13T16:17:58.148000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "don't think about \"shards\". Just think about this large area of data availability to he protocol",
        "created_at": "2022-06-13T16:18:00.082000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "on \"eth1.0\" there is only CALLDATA which can be read by the EVM and is stored forever (unless pruning rules are later added)",
        "created_at": "2022-06-13T16:18:26.172000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "in this data construction, blob-TXs can also affect the EVM but the data is not directly readable by the EVM only the commitments to the data. And this data will likely be pruned on a much more aggressive schedule",
        "created_at": "2022-06-13T16:19:14.683000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "\"shards\" are quite frankly a misnomer. it is just extended data availability. a substrate upon which rollups can self-shard",
        "created_at": "2022-06-13T16:19:46.218000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "when you said \"The rollup can publish a \"blob carrying TX\" with the data and the proof (referencing the commitment to the data) in one place. \" - what is an example of this \"one place\" ?",
        "created_at": "2022-06-13T16:21:13.135000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "a single L1 tx.",
        "created_at": "2022-06-13T16:21:26.602000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "jumping threads for a second --\n\ni'd like to discuss running the external builder network (\"mev-boost\") through the testnet merges on the CL call thursday\n\ni opened an issue if you want to jump in: https://github.com/ethereum/builder-specs/issues/32",
        "created_at": "2022-06-13T16:24:44.046000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "so I guess the preferred approach (more scalable one) would be second, i.e. this one: \"Or they can publish the data and then later send a TX that references the data commitment\" ?",
        "created_at": "2022-06-13T16:24:55.754000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "Or these two are equivalent?\n1) The rollup can publish a \"blob carrying TX\" with the data and the proof (referencing the commitment to the data) in one place. \n2) Or they can publish the data and then later send a TX that references the data commitment.\nSo in 1) the data will be propagated to some data shard, and TX is processed by some Builder?",
        "created_at": "2022-06-13T16:29:38.866000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "they can do them together or separately that isn't relevant wrt the L1",
        "created_at": "2022-06-13T16:30:40.480000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "there is no \"data shard\" to send to",
        "created_at": "2022-06-13T16:31:05.139000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "the builder of a block will receive all the data needed to go into that block",
        "created_at": "2022-06-13T16:31:18.390000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "so if we have 64 data shards, and each shard received some data blobs, and corresponding 64 tx with proofs are sent to some Builder, could Builder just select 32 of these and include into execution block? (i.e. not including all 64, postponing them to next exec block)",
        "created_at": "2022-06-13T16:32:56.425000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "again, there are no concrete shards here",
        "created_at": "2022-06-13T16:34:31.059000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "a builder can include as many data txns as they want and there is a limit per-block (which is roughly the \"shard count\")",
        "created_at": "2022-06-13T16:35:07.959000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "a builder could choose to not include them if they wanted but in general the txns produce profit to the builder so they are incentivized to include them",
        "created_at": "2022-06-13T16:35:42.607000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "yeah, I meant honest builder, i.e. I'm not interested so far in censorship resistance, incentives, etc - just tx/data flow in the system.",
        "created_at": "2022-06-13T16:36:07.943000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "I heard somewhere that builders will be able to provide cross rollup execution.",
        "created_at": "2022-06-13T16:36:35.418000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "so this means that there must be some rules when they must execute some transactions in the same block (i.e. from different rollups so they can communicate with each other within single block)",
        "created_at": "2022-06-13T16:37:04.010000+00:00",
        "attachments": null
    },
    {
        "author": "androbrutal",
        "category": "general",
        "parent": "",
        "content": "anyway, thank you very much for your answers!",
        "created_at": "2022-06-13T16:54:21.763000+00:00",
        "attachments": null
    }
]