[
  {
    "author": "b.hartnett",
    "category": "Cross-layer",
    "parent": "",
    "content": "Is there anything in the spec to prevent a BAL being created with duplicate addresses and/or storageReads, storageChanges, etc? Looks like it might be possible to build a valid block containing a valid BAL according to the rules but having unnecessary duplicated data. The EIP doesn't specify that BALs must not contain duplicates and the data structure is a list so it could in theory contain duplicates as long as they are lexicographicly ordered within the other values.",
    "created_at": "2026-02-20T03:15:15.376000+00:00",
    "attachments": []
  },
  {
    "author": "jwasinger",
    "category": "Cross-layer",
    "parent": "",
    "content": "there are test cases to ensure that BALs with duplicate storage reads, duplicate accounts, duplicate storage writes, etc. are invalid",
    "created_at": "2026-02-20T03:28:52.433000+00:00",
    "attachments": []
  },
  {
    "author": "jwasinger",
    "category": "Cross-layer",
    "parent": "",
    "content": "actually, I'm only seeing that test coverage covers duplicate account entries (cc <@796570016966770688> )",
    "created_at": "2026-02-20T03:38:25.462000+00:00",
    "attachments": []
  },
  {
    "author": "b.hartnett",
    "category": "Cross-layer",
    "parent": "",
    "content": "Nimbus EL passes all the tests and we don't yet verify that there are no duplicates in a BAL during block validation. It looks like there are no test cases covering this specific scenario. Regardless the EIP should be updated in my opinion so that all clients implement the correct validations. Tests covering this would be nice as well.",
    "created_at": "2026-02-20T03:46:50.124000+00:00",
    "attachments": []
  },
  {
    "author": "m0_ox",
    "category": "Cross-layer",
    "parent": "",
    "content": "Yeah not just nice to have imo. We should have more invalid tests in general. I'll look to add these tomorrow. Thanks for flagging.",
    "created_at": "2026-02-20T04:15:52.674000+00:00",
    "attachments": []
  },
  {
    "author": "b.hartnett",
    "category": "Cross-layer",
    "parent": "",
    "content": "Assuming duplicate addresses and storage keys cause the BAL to fail validation then the max item check doesn't need to care about uniqueness. It should just count the number of addresses in the list (regardless of any duplicates) and for each address count the number of storage keys (reads and writes regardless of duplicates). This will be faster than trying to filter out duplicates.",
    "created_at": "2026-02-20T06:26:02.630000+00:00",
    "attachments": []
  },
  {
    "author": "nero_eth",
    "category": "Cross-layer",
    "parent": "",
    "content": "Yeah good points.\nIn the specs, we do guarantee that no duplicated entries (thus BALs with duplicates would run into a hash mismatch:\nFor addresses, we use `Dict[Address, AccountData]`, for storage changes `Dict[U256, List[...]]` and for reads we have `Set[U256]`. Additionally, slots that are changed are excluded from reads:\n```\nstorage_reads = []\nfor slot in changes.storage_reads:\n    if slot not in changes.storage_changes:\n        storage_reads.append(slot)\n```",
    "created_at": "2026-02-20T08:01:33.693000+00:00",
    "attachments": []
  },
  {
    "author": "nero_eth",
    "category": "Cross-layer",
    "parent": "",
    "content": "So, duplicated entries constitute another invalidity condition.",
    "created_at": "2026-02-20T08:02:07.146000+00:00",
    "attachments": []
  },
  {
    "author": "nero_eth",
    "category": "Cross-layer",
    "parent": "",
    "content": "I checked the EIP and agree, this is missing. Will update it now and post the PR as soon as I got it. \nGreat catch <@902806914252021830> !",
    "created_at": "2026-02-20T08:02:53.029000+00:00",
    "attachments": []
  },
  {
    "author": "nero_eth",
    "category": "Cross-layer",
    "parent": "",
    "content": "PR is up here:\nhttps://github.com/ethereum/EIPs/pull/11338",
    "created_at": "2026-02-20T08:13:03.343000+00:00",
    "attachments": []
  },
  {
    "author": "m0_ox",
    "category": "Cross-layer",
    "parent": "",
    "content": "Iterated through some cases [here](https://github.com/ethereum/execution-specs/pull/2261)",
    "created_at": "2026-02-20T21:13:59.576000+00:00",
    "attachments": []
  }
]