[
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "I've made a Kurtosis config with Lodestar and Geth: https://github.com/jihoonsong/local-devnet-bals/blob/main/kurtosis.config.registry.yaml",
        "created_at": "2025-09-19T05:15:05.307000+00:00",
        "attachments": null
    },
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "It seems Geth doesn't support the latest engine APIs change? Lodestar wants to use `engine_getPayloadV6` but Geth doesn't have it yet. cc \u003c@427903869226582018\u003e",
        "created_at": "2025-09-19T05:15:18.754000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "Cross-layer",
        "parent": "",
        "content": "whoops.  I've pushed it to the branch now",
        "created_at": "2025-09-19T06:31:06.232000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@845691100072509460\u003e where is the branch located that I would be able to use to build the lodestar image?  or can you build it and push it to a registry?",
        "created_at": "2025-09-19T06:40:41.879000+00:00",
        "attachments": null
    },
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "Thanks! At slot 32 (the first slot of Gloas), Lodestar produces an error as follow:\n\n```\n[cl-1-lodestar-geth] Sep-19 06:42:44.134[api]              warn: Engine failed to produce the block slot=32, parentSlot=31, parentBlockRoot=0x2d3945c73f4a543c3dec777fc8ee9ed622e9edf14c716015779cb4121a35792f, fork=gloas, builderSelection=executiononly, isBuilderEnabled=false, isEngineEnabled=true, strictFeeRecipientCheck=false, builderBoostFactor=0, durationMs=19 - blockAccessList missing for gloas \u003e= gloas executionPayload number=32 hash=0xbccbc92ec7368b08588ccc0873d98db8cba3e3ab5aa9bab2fb541d67f773946e\n[cl-1-lodestar-geth] Error: blockAccessList missing for gloas \u003e= gloas executionPayload number=32 hash=0xbccbc92ec7368b08588ccc0873d98db8cba3e3ab5aa9bab2fb541d67f773946e\n[cl-1-lodestar-geth]     at parseExecutionPayload (file:///usr/app/packages/beacon-node/src/execution/engine/types.ts:394:13)\n[cl-1-lodestar-geth]     at ExecutionEngineHttp.getPayload (file:///usr/app/packages/beacon-node/src/execution/engine/http.ts:466:12)\n```",
        "created_at": "2025-09-19T06:45:55.035000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "Cross-layer",
        "parent": "",
        "content": "oh it's right above",
        "created_at": "2025-09-19T06:46:46.811000+00:00",
        "attachments": null
    },
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "You can build the Lodestar image based on this [branch](https://github.com/ChainSafe/lodestar/pull/8426) or can use this one \"jihoonsg/lodestar-eip7928:941c102\"",
        "created_at": "2025-09-19T06:46:50.170000+00:00",
        "attachments": null
    },
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "\u003c@427903869226582018\u003e I saw that you want to use Amsterdam time, which ethereum-package doesn't support at the moment. Let me make it work for you :)",
        "created_at": "2025-09-19T06:48:23.072000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "Cross-layer",
        "parent": "",
        "content": "sgtm!",
        "created_at": "2025-09-19T06:48:58.575000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "Cross-layer",
        "parent": "",
        "content": "I just fixed the issue with RLP decoding of BALs and pushed it to my Geth branch.  I'd suggest to rebuild the image based on the changes.\n\nLike I said earlier, probably this issue/fix has no relevance to the devnet use-case, but might as well test against the fix just to be safe.",
        "created_at": "2025-09-19T07:47:05.152000+00:00",
        "attachments": null
    },
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "Nice! But it looks like Geth still returns empty BALs. Maybe `BlockToExecutableData()` needs to set `BlockAccessList` field?",
        "created_at": "2025-09-19T08:03:07.013000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "Cross-layer",
        "parent": "",
        "content": "appears so",
        "created_at": "2025-09-19T08:07:04.976000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "Cross-layer",
        "parent": "",
        "content": "do you have a patch for kurtosis?",
        "created_at": "2025-09-19T08:07:10.210000+00:00",
        "attachments": null
    },
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "~~I've opened a [PR](https://github.com/ethpandaops/ethereum-package/pull/1187) but in the meantime, you could use \"github.com/jihoonsong/ethereum-package@eip7928\". For instance, this Kurtosis command is good:\n\n`kurtosis run github.com/jihoonsong/ethereum-package@eip7928 --enclave eip7928 --args-file ./eip7928.yaml`~~  (This is not needed at all. I was confused with the Lodestar's timestamp issue below. Feel free to ignore this.)",
        "created_at": "2025-09-19T08:09:42.620000+00:00",
        "attachments": null
    },
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "~~Wait, please don't rely on it yet. I'm testing it and it seems it's not done.~~ It turned out the issue was something else. It's good to use",
        "created_at": "2025-09-19T08:13:09.063000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Cross-layer",
        "parent": "",
        "content": "If there‚Äôs no kurtosis package changes, please feel free to add it to the tests folder under .github with .norun at the file ending. We collect all examples there!",
        "created_at": "2025-09-19T08:38:35.107000+00:00",
        "attachments": null
    },
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "Sounds great! Could you give me a pointer where to put it? It seems there is no .yaml.norun example under .github folder",
        "created_at": "2025-09-19T08:41:40.691000+00:00",
        "attachments": null
    },
    {
        "author": "parithosh",
        "category": "Cross-layer",
        "parent": "",
        "content": "Eg: https://github.com/ethpandaops/ethereum-package/blob/main/.github/tests/mainnet-split.yaml.norun",
        "created_at": "2025-09-19T08:49:03.556000+00:00",
        "attachments": null
    },
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "I've opened a PR to your branch that uses Amsterdam time and PayloadV4. Please have a look when you have some time: https://github.com/jwasinger/go-ethereum/pull/16",
        "created_at": "2025-09-19T08:56:27.526000+00:00",
        "attachments": null
    },
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "When calling `forkchoiceUpdatedV3`, does Lodestar set `params.timestamp` to parent block's time? i.e., at the first slot of Gloas, `params.timestamp` equals to the timestamp of the last slot of Fulu (when there is no missed slot). This makes Geth think it's still in Osaka when it just entered Gloas.",
        "created_at": "2025-09-19T08:58:20.760000+00:00",
        "attachments": null
    },
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "Thanks! Let me add some config once we have a working combination.",
        "created_at": "2025-09-19T08:59:16.169000+00:00",
        "attachments": null
    },
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "I'm also getting the same as Jihoon describes. Geth needs to be updated to support engine_getPayloadV6 for the EIP-7928/Gloas fork, correct?",
        "created_at": "2025-09-19T09:56:56.448000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "Cross-layer",
        "parent": "",
        "content": "`engine_getPayloadV6` should be supported now.  did you try it recently?",
        "created_at": "2025-09-19T10:00:20.242000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "Cross-layer",
        "parent": "",
        "content": "also, are you using prysm?  what does your testing workflow look like?",
        "created_at": "2025-09-19T10:04:21.339000+00:00",
        "attachments": null
    },
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "FYI, Prysm doesn't work at the moment. Let me share a Kurtosis config with Prysm soon.",
        "created_at": "2025-09-19T10:07:57.399000+00:00",
        "attachments": null
    },
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "should this be checking for V6:\n\n```\n  func (api *ConsensusAPI) GetPayloadV6(payloadID engine.PayloadID) (*engine.ExecutionPayloadEnvelope, error) {\n      if !payloadID.Is(engine.PayloadV4) {\n          return nil, engine.UnsupportedFork\n      }\n      return api.getPayload(payloadID, false)\n  }\n```",
        "created_at": "2025-09-19T10:11:15.639000+00:00",
        "attachments": null
    },
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "using lodestar",
        "created_at": "2025-09-19T10:11:43.589000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Cross-layer",
        "parent": "",
        "content": "we use the state slot  and since we call `forkchoiceUpdatedV3` with payload attributes in previous slot it will be fulu timestamp since technically it's still fulu",
        "created_at": "2025-09-19T10:13:25.795000+00:00",
        "attachments": null
    },
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "Do you mean `if !payloadID.Is(engine.PayloadV4)`? If so, that's for `ExecutionPayloadV4` so I believe it's correct.",
        "created_at": "2025-09-19T10:13:27.053000+00:00",
        "attachments": null
    },
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "Right, so the first Gloas block (when there is no missed slot) won't have BALs, which would be fine. I think we can update Geth to return BALs and see if there is any remaining issue. In the meantime, I'll be working on making Prysm interop happen.",
        "created_at": "2025-09-19T10:17:34.580000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Cross-layer",
        "parent": "",
        "content": "the problem with this at least right now is that we call `engine_getPayloadV6` for gloas slot 0 and if there is no `blockAccessList` we reject the payload",
        "created_at": "2025-09-19T10:41:01.769000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "Cross-layer",
        "parent": "",
        "content": "(btw, I 'm running a BAL import benchmark on my dev machine but I plan to test out the lodestar/geth local devnet setup once the benchmark finishes)",
        "created_at": "2025-09-19T10:42:13.209000+00:00",
        "attachments": null
    },
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "Very nice, it seems we're all on the same page",
        "created_at": "2025-09-19T11:53:12.317000+00:00",
        "attachments": null
    },
    {
        "author": "nflaig",
        "category": "Cross-layer",
        "parent": "",
        "content": "btw regarding this, there was similar case with deneb since we added `blobGasUsed` and `excessBlobGas` to execution payload RPC response, so might be worth checking how that was handled by EL",
        "created_at": "2025-09-19T11:56:08.267000+00:00",
        "attachments": null
    },
    {
        "author": "jih2nn",
        "category": "Cross-layer",
        "parent": "",
        "content": "Thanks for sharing! Let me study it tomorrow üëç",
        "created_at": "2025-09-19T11:59:32.975000+00:00",
        "attachments": null
    },
    {
        "author": "raxhvl",
        "category": "Cross-layer",
        "parent": "",
        "content": "When a transaction aborts due to an`INVALID` or `REVERT`  operation, will BAL be empty?",
        "created_at": "2025-09-19T13:48:16.510000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "Cross-layer",
        "parent": "",
        "content": "what is an `INVALID`?",
        "created_at": "2025-09-19T13:54:53.752000+00:00",
        "attachments": null
    },
    {
        "author": "raxhvl",
        "category": "Cross-layer",
        "parent": "",
        "content": "https://www.evm.codes/?fork=cancun#fe `0xfe` opcode",
        "created_at": "2025-09-19T13:55:34.849000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "Cross-layer",
        "parent": "",
        "content": "if the transaction is valid for inclusion in the block at its index, regardless of how it terminates its execution the referenced state should be in the BAL",
        "created_at": "2025-09-19T13:56:40.356000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "Cross-layer",
        "parent": "",
        "content": "actually wait... the state is reverted upon failure",
        "created_at": "2025-09-19T13:57:56.244000+00:00",
        "attachments": null
    },
    {
        "author": "jwasinger",
        "category": "Cross-layer",
        "parent": "",
        "content": "Any storage/account reads would still be in the BAL and the tx sender fee payment to coinbase.  That's all.",
        "created_at": "2025-09-19T13:58:38.958000+00:00",
        "attachments": null
    },
    {
        "author": "raxhvl",
        "category": "Cross-layer",
        "parent": "",
        "content": "We should make this explicit in the specs \u003c@792404665068158998\u003e",
        "created_at": "2025-09-19T14:00:15.247000+00:00",
        "attachments": null
    },
    {
        "author": "raxhvl",
        "category": "Cross-layer",
        "parent": "",
        "content": "Agree for coinbase (state change) . What is the rationale behind adding reads / touched accounts in BAL?",
        "created_at": "2025-09-19T14:04:05.288000+00:00",
        "attachments": null
    },
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "what do you mean exactly, could you elaborate?",
        "created_at": "2025-09-19T14:15:15.770000+00:00",
        "attachments": null
    },
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "there is a point on exceptional halts in the eip",
        "created_at": "2025-09-19T14:16:47.634000+00:00",
        "attachments": null
    },
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "Or something like \"if a call reverts, record the addresses and storage keys as if they were read\"",
        "created_at": "2025-09-19T14:18:05.740000+00:00",
        "attachments": null
    },
    {
        "author": "raxhvl",
        "category": "Cross-layer",
        "parent": "",
        "content": "Alice calls a `Contract` which does an `SLOAD(0x01)`, checks `BALANCE` for another account say Bob,  does `SSTORE(0x02,0x03)` and aborts via `REVERT` / `INVALID`. \n\nWill BAL include\n1. `Contract`  in `account_changes`?\n  1. If so will it contain the storage read / write?\n2. `Bob`  in `account_changes`?",
        "created_at": "2025-09-19T14:21:16.400000+00:00",
        "attachments": null
    },
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "1) yes\n1.1) will contain 2 reads ( 0x01, 0x02)\n2) yes",
        "created_at": "2025-09-19T14:22:40+00:00",
        "attachments": null
    },
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "Great scenario! We should definitely have that covered in the test",
        "created_at": "2025-09-19T14:23:18.417000+00:00",
        "attachments": null
    },
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "One could argue we have it in the EIP already:\n```\nAccessed but unchanged: Include the address with empty changes (e.g., targets of EXTCODEHASH, EXTCODESIZE, BALANCE, STATICCALL, etc.).\n```",
        "created_at": "2025-09-19T14:24:40.357000+00:00",
        "attachments": null
    },
    {
        "author": "nero_eth",
        "category": "Cross-layer",
        "parent": "",
        "content": "But will make it more explicit!",
        "created_at": "2025-09-19T14:24:51.415000+00:00",
        "attachments": null
    },
    {
        "author": "terencechain",
        "category": "Cross-layer",
        "parent": "",
        "content": "üëã  if you can share the config, i can quickly debug and make it work on my end, shouldn't take too long",
        "created_at": "2025-09-19T23:42:10.059000+00:00",
        "attachments": null
    }
]