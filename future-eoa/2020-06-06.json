[
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://discordapp.com/channels/595666850260713488/690694646241820682/718569264336076830\n\u003c@278762485497069569\u003e I don't think the proposal of splitting gas payer and nonce incrementor and msg.sender is \"meta transactions at layer 0\".  It is simply decoupling something that should never have been coupled which opens up new possibilities for Ethereum, one of which happens to be \"meta transactions\".",
        "created_at": "2020-06-06T00:42:33.267000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Would a combination of https://github.com/Arachnid/EIPs/blob/richtx/EIPS/EIP-draft-rich-transactions.md and splitting of gas spender and msg.sender fully solve the \"Meta Transaction\" problem, thus freeing us up to UNGAS?",
        "created_at": "2020-06-06T00:48:41.341000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I liked the proposal someone made for splitting the signers by just appending an additional signature, which allows for backward compatibility.  We can just add a second signature on the end of a signed transaction which, if present, indicates the account from which gas fees are deducted.  The outer signature would sign the signed inner transaction *including* the inner transaction's signature.",
        "created_at": "2020-06-06T00:51:08.978000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "With these two proposals, someone could craft a rich transaction that does a sequence of two operations, one of which is to pay the gas spender and the other of which is to do whatever operation they wanted to do.  They would then sign this rich transaction and offer it up to relayers via whatever mechanism they like.  The relayer would then sign that signed transaction, appending their signature to the end of it, which would transform it from a \"msg.sender pays gas\" transaction into a \"outer-signer pays gas\" transaction.",
        "created_at": "2020-06-06T00:53:02.171000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The one caveat with this is that the inner transaction may be valid on its own, un-relayed.  If the inner transaction signer has enough ETH to cover gas, then the relayer could submit the transaction without an outer signature.  Is there a use case for using a relayer when the msg.sender *can* cover gas costs?  Do we want to support some mechanism that prevents the transaction from being valid *unless* it is has a separate gas-payer?",
        "created_at": "2020-06-06T00:54:48.051000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think we will also want (maybe need) to have a new opcode or precompile for getting the gas-payer from inside the transaction.  The transaction that ultimately pays the gas-payer (e.g., the thing that sends DAI to whoever pays gas) needs to be know who to send the DAI to, so it will need access to `gasPayer` from within Solidity.  This also gives the ability for the transaction to fail if it is not wrapped with a simple `require(gasPayer != msg.sender)` check.  That way the relayer cannot send the transaction without wrapping it, thus solving https://discordapp.com/channels/595666850260713488/718596092828057631/718628928570261556.",
        "created_at": "2020-06-06T00:57:25.530000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "1. Rich Transactions.\n2. Gas Payer enveloped transactions.\n3. `gasPayer` opcode or precompile.",
        "created_at": "2020-06-06T00:58:08.939000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My \"gut\" is worried about exposing `GAS_PAYER` for inspection... but I don't need to be convinced right now, just raising very small flag of concern and hoping to see a good justification for why it is truly necessary (and hoping it is just YAGNI)",
        "created_at": "2020-06-06T00:58:59.728000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Without it, the inner transaction will need to hard-code who to send the DAI to.  This would be fine except for the fact that the inner transaction is *valid* unwrapped.  The relayer could choose to just submit the transaction un-wrapped and they would receive the DAI payment without having to pay for gas.",
        "created_at": "2020-06-06T01:00:20.823000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "To prevent this attack, we would need one of 4 things I believe:\n1. Assert that gas payer enveloped transactions **SHOULD NOT** be used if the inner transaction can pay gas itself.\n2. Provide a mechanism to flag a transaction as \"must be enveloped\".\n3. Provide access to `gasPayer` from within the inner transaction.\n4. Provide access to `wasEnveloped` from within the inner transaction.",
        "created_at": "2020-06-06T01:02:45.883000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(thanks for clarification, makes sense now)",
        "created_at": "2020-06-06T01:04:25.539000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "As a non-core dev, each of \u003chttps://discordapp.com/channels/595666850260713488/718596092828057631/718629771155603539\u003e feels like a pretty small change (compared to the alternatives like OIL), and I believe they provide additional value *beyond* just meta-transaction support.",
        "created_at": "2020-06-06T01:04:27.444000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I generally agree.  I think I'm going to stab at v2 of the \"megathread\" to try and tie all of these together into a cohesive picture.  If that comes together, and after some time for discussion, if we're lucky we could get started on one of these first steps pieces very soon and start getting them slated for the next hard fork (all kinds of caveats about technical feasibility, dependencies, and general ACD agreement on path forward)",
        "created_at": "2020-06-06T02:14:49.341000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "cc \u003c@!393833580033474560\u003e ^ this may start to paint a more cohesive picture (and it is an alternate research direction than your previous post about OIL)",
        "created_at": "2020-06-06T02:16:13.511000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Would returning the gas payer as part of `ORIGIN` break existing contracts? Otherwise I agree - weâ€™d need to expose that info",
        "created_at": "2020-06-06T05:46:03.247000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@543900561460822016\u003e What do you mean by `ORIGIN`?",
        "created_at": "2020-06-06T05:47:15.926000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The op code, usually it returns the origination address of a transaction",
        "created_at": "2020-06-06T05:48:07.469000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If you are proposing that it now pushes two values onto the stack then yes, that seems like it would break things.",
        "created_at": "2020-06-06T05:48:40.928000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Iâ€™m proposing that origination address be set equal to the gas payer instead of the inner signee",
        "created_at": "2020-06-06T05:49:11.607000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah, that would break things.",
        "created_at": "2020-06-06T05:49:31.260000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Probably also breaking though",
        "created_at": "2020-06-06T05:49:31.998000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There *has* been talk in the past about removing the `ORIGIN` opcode.",
        "created_at": "2020-06-06T05:49:49.339000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Perhaps this is the opportunity and we just repurpose it?",
        "created_at": "2020-06-06T05:50:05.406000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It seems like it could be an opportunity to give it a new life!",
        "created_at": "2020-06-06T05:50:22.517000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Though, one of the reasons for getting rid of it is that it allows contracts to identify whether the caller is \"human\" or not, which is dumb and should never be done.",
        "created_at": "2020-06-06T05:50:42.022000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This change would make it so now contracts can discriminate on \"is meta transaction\" which seems equally annoying.",
        "created_at": "2020-06-06T05:51:04.900000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think we can't avoid that though with my proposal above?",
        "created_at": "2020-06-06T05:51:20.753000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I believe it is unavoidable",
        "created_at": "2020-06-06T05:52:16.938000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "At least with replacing ORIGIN it is impossible to tell whether itâ€™s a meta tx or just an inner contract call",
        "created_at": "2020-06-06T05:52:55.238000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, contracts would still be able to do `require(msg.sender == tx.origin)` which is annoying.  Contracts shouldn't be discriminating by how the transaction is constructed as it drives people away from using contract wallets, which we want to encourage. (I don't think we can avoid this though, as we need contracts to have the ability to identify the gas payer)",
        "created_at": "2020-06-06T05:56:21.554000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I suppose if we really want to avoid that from happening weâ€™d need to remove ORIGIN and also add support for transaction batching. The relayerâ€™s address could be hard coded into one of the bundled transactions and they would verify it before relaying it on chain",
        "created_at": "2020-06-06T06:00:35.752000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Another option would be maleable transactions.  This feels like a deep dark hole but I figure I would throw it out there.",
        "created_at": "2020-06-06T06:15:57.868000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "A transaction where the gas payer could append a bit of data to a pre-signed transaction and then that bit of data was available to the transaction (e.g., as an extra parameter on the call or something).",
        "created_at": "2020-06-06T06:16:41.030000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ðŸ¤” Another brainstorm-only idea: `ORIGIN` is only accessible from code executed within the context of msg.sender signer.  So `ORIGIN` is only accessible from code executed at the top level of a rich transaction.",
        "created_at": "2020-06-06T06:18:01.875000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And `ORIGIN` here would be `gasPayer`.",
        "created_at": "2020-06-06T06:18:13.188000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Feels bad to scope `ORIGIN` to that context only though.",
        "created_at": "2020-06-06T06:19:04.431000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "this seems less like re-purposing and more like making it actually have a purpose where previously it didn't",
        "created_at": "2020-06-06T17:49:51.211000+00:00",
        "attachments": null
    }
]