[
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "First cut at Meta Transaction EIP: https://eips.ethereum.org/EIPS/eip-2711",
        "created_at": "2020-06-11T05:23:28.437000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I went with the \"the best way to get answers on the internet is to say something wrong\" strategy.  That being said, there is nothing *obviously* wrong about it to me.",
        "created_at": "2020-06-11T05:24:17.232000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I would really like some feedback on the security of it.  I don't *think* there are any risks of transaction malleability or spoofing one transaction type with another.",
        "created_at": "2020-06-11T05:25:27.501000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I also tried to start the conversation of transaction payload format versioning in \u003c#688075293562503241\u003e.  I think it would be *better* to build a general solution to versioned transactions, but I haven't thought deeply on the security implications of that in a backward incompatible way, so I have left it out of this EIP.  If we can solve that, I don't mind submitting another EIP that first addresses transaction versioning, and then have this EIP depend on it.",
        "created_at": "2020-06-11T05:27:04.163000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!301186049323958275\u003e Thinking about 2 different nonces again: The idea would that the miners only need to check once that the gas payer has enough funds to pay the transaction. As the \"outer\" nonce is increased with every transaction there is not risk that the transaction can suddenly not be paid (learning from my superfisial account abstraction understanding). The inner nonce would be an independant replay protection for the sender signature, so any gas payer could actually take the tx and wrap it.",
        "created_at": "2020-06-11T14:21:11.622000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I agree on the inner nonce being necessary.  I'm a little less clear on the necessity of the outer nonce though.  \u003c@317706410680909834\u003e Can you explain a scenario in which a miner would not get paid and why they can't (with current proposal) defend against it?",
        "created_at": "2020-06-11T14:23:12.700000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so if the inner nonce is the nonce of the sender, then this will only increase when the transaction has been mined (if I got the EIP correctly)",
        "created_at": "2020-06-11T14:24:06.556000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "when you submit a tx to a node it checks if there are enough funds in the paying account.",
        "created_at": "2020-06-11T14:24:28.218000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And this is kind of an invariant, since the balance for this account will not change unless there is a new tx with the same nonce",
        "created_at": "2020-06-11T14:24:54.585000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "but if the payer signature only depends on the sender siganture, then the payer could have multiple transaction that are independant of order that change the payer balance",
        "created_at": "2020-06-11T14:25:47.313000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "therefore you might have to reevaluate more transactions (would have to read up on the account abstraction details as there a similar challenge exists)",
        "created_at": "2020-06-11T14:26:24.301000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "for them it was a potential DoS attack vector",
        "created_at": "2020-06-11T14:26:44.073000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Wouldn't the client be able to track that itself without the nonce?",
        "created_at": "2020-06-11T14:26:44.454000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think with a nonce it is easier, as you know an order",
        "created_at": "2020-06-11T14:27:19.356000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm imagining the GAS_PAYER signing 3 different transactions (offering to pay gas for each).  It would order them by gas price, and FIFO as secondary sort.  If the sum of gas paid is higher than the GAS_PAYER can afford, the client is free to drop some transactions.",
        "created_at": "2020-06-11T14:28:20.216000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I can't speak to whether this adds significant complexity inside of clients or not, but in my head it is \"simple\".  üôÇ",
        "created_at": "2020-06-11T14:28:51.947000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yeah, not deep enough into the topic, just remembered that it was discussed in the account abstration channel üòÑ",
        "created_at": "2020-06-11T14:29:18.850000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "By not requiring a second nonce we make the transaction payload a bit smaller, and potentially reduce chatter as the gas payer doesn't have to do replace-by-fee to slide in a higher priced transaction.",
        "created_at": "2020-06-11T14:29:44.999000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "should we document these thought somewhere?",
        "created_at": "2020-06-11T14:30:15.100000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is certainly possible to include 2 nonces.",
        "created_at": "2020-06-11T14:30:20.355000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think also the payload size consideration is important and would be valuable to have in the eip",
        "created_at": "2020-06-11T14:30:50.240000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thinking way too much in the future: do you have a preference on what client/node you would do a test implementation? üòÑ Would totally be up to hack this üòõ",
        "created_at": "2020-06-11T14:32:12.472000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!317706410680909834\u003e my understanding of having a second nonce is that it actually creates more validation overhead as you could have a cycle in your nonce dependencies",
        "created_at": "2020-06-11T14:32:30.269000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Nope, I'm hoping I can convince someone else to do an implementation.  üò¨",
        "created_at": "2020-06-11T14:32:39.436000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so you either need i) check for a cycle in your accepted tx dag or ii) you need to store a thin diff of accounts for each tx",
        "created_at": "2020-06-11T14:33:31.441000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "but how can it create a cycle ü§î",
        "created_at": "2020-06-11T14:33:49.019000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "you can only increase your nonce with a transaction",
        "created_at": "2020-06-11T14:34:01.648000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You could deadlock, in theory.",
        "created_at": "2020-06-11T14:34:20.655000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "did you get a chance to see this post? https://ethresear.ch/t/meta-transactions-oil-and-karma-megathread/7472/24",
        "created_at": "2020-06-11T14:34:25.947000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "will check üëç",
        "created_at": "2020-06-11T14:35:00.069000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`SENDER` nonce: 5; `GAS_PAYER` nonce: 12\n`SENDER` nonce: 6; `GAS_PAYER` nonce: 11",
        "created_at": "2020-06-11T14:35:03.991000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Neither transaction can go first.",
        "created_at": "2020-06-11T14:35:15.327000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Noted some of this discussion, though I'm pretty against `GAS_PAYER` having a nonce now.  üò¨",
        "created_at": "2020-06-11T14:37:21.373000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So the opposite outcome of what you proposed \u003c@317706410680909834\u003e!  Sorry!",
        "created_at": "2020-06-11T14:37:34.669000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003chttps://github.com/ethereum/EIPs/pull/2712\u003e",
        "created_at": "2020-06-11T14:37:41.130000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "how do people feel about the term \"sponsored transaction\"? i think native / protocol meta-transaction is a mouthful and not as accurate since txs aren't \"meta\" anymore",
        "created_at": "2020-06-11T14:37:58.814000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm not against the term.",
        "created_at": "2020-06-11T14:38:22.222000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "really hoping for anything other than native / protocol meta-tx",
        "created_at": "2020-06-11T14:38:39.434000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I will likely be using this for my own transactions, so I can put a small amount of gas-paying ETH into an account so I can't fat-finger a $2.5M gas price.  üòõ",
        "created_at": "2020-06-11T14:38:49.423000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yeah I see the deadlock ... still means if you don'T have the payer nonce that each time a transaction where the payer balance changes is executed you need to evaluate tx that are signed by the payer, right?",
        "created_at": "2020-06-11T14:39:11.242000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "if the order is specified by the payer nonce, you only need to evaluate the next (as far as I understood)",
        "created_at": "2020-06-11T14:39:40.155000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You don't have to re-evaluate the transactions I don't think, you just have to check the gas price, gas limit, and gas payer balance.",
        "created_at": "2020-06-11T14:39:53.573000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "re-evaluate in the sense of checking how much payment is required and is it still enough to be executed with the new balance",
        "created_at": "2020-06-11T14:40:29.077000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If you have a gas payer nonce I think you still have to evaluate all until ETH runs out or you reach the end.",
        "created_at": "2020-06-11T14:40:56.294000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "hmm ok, not sure if my typing skills are failing me. I see why 2 nonce are bad, still think the payer nonce is important üòÑ",
        "created_at": "2020-06-11T14:42:15.954000+00:00",
        "attachments": null
    },
    {
        "author": "rimeissner",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I need to think this up more üôÇ",
        "created_at": "2020-06-11T14:42:32.672000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think about it like this: say the tx pool has some number of txs already accepted (i.e. will be in the next block) and new candidate tx comes in. To validate, the node will do all the standard validation + it will verify that gas_payer can afford the tx. To facilitate this, the tx pool will track the balances of accounts. Geth currently does not do this, but it is cheap to do and will only be a minor increase in memory footprint. Since the node is tracking balance of an account, it will not accept a tx from a gas_payer which spends more ether than they currently have minus the ether already allocated to sponsor txs in the tx pool (i.e. they lose cancellability). If a chain of several txs that are being sponsored by a certain gas_payer are invalidated by a new tx from the signer with a low nonce, its easy to replace the update the gas_payer's account since cost of each tx can be determined in constant time. This logic is very similar to what is already happening in geth.",
        "created_at": "2020-06-11T14:54:52.754000+00:00",
        "attachments": null
    },
    {
        "author": "1n1a5",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "IIUC, no gas payer nonce would mean that a client is free to decide the order of two meta transactions (arriving in quick succession and) originating from different senders but with the same gas payer right?",
        "created_at": "2020-06-11T16:11:15.206000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!701536321381990481\u003e afaict that is correct",
        "created_at": "2020-06-11T16:45:57.466000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e Since the node is tracking balance of an account, it will not accept a tx from a gas_payer which spends more ether than they currently have minus the ether already allocated to sponsor txs in the tx pool (i.e. they lose cancellability).\nWhile this isn't a concensus issue, I think the client should drop the transaction with the lowest gas price if the GAS_PAYER doesn't have enough ETH to cover them all.",
        "created_at": "2020-06-11T16:52:23.002000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Though, perhaps it should first drop transactions with high nonce (not ready to mine)?",
        "created_at": "2020-06-11T16:52:51.433000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My intuition on the subject is that we only need one nonce, and that the `sender` nonce is the appropriate one to include since it is their operation being performed and the nonce enforces ordering of those operations.\n\n- I'm not seeing any reason why the gas payer's nonce would need to be incremented...\n- I think it would be a bad DOS/SPAM vector if there was a 3rd signature for nonce incrementing because it would allow creation of a bunch of junk/spam accounts in the state database.",
        "created_at": "2020-06-11T16:56:08.662000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e While this isn't a concensus issue, I think the client should drop the transaction with the lowest gas price if the GAS_PAYER doesn't have enough ETH to cover them all.\nyeah that makes sense as well",
        "created_at": "2020-06-11T17:05:59.464000+00:00",
        "attachments": null
    }
]