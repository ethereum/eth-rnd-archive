[
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!543900561460822016\u003e not really much more since it's a loose plan that mostly exists in my head.  Is there any specific area that interest you or that you have questions about?",
        "created_at": "2020-06-17T00:11:33.854000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What is the end result youâ€™re hoping for? Simpler clients?",
        "created_at": "2020-06-17T00:26:35.730000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, allowing for more special purpose clients.",
        "created_at": "2020-06-17T01:44:39.684000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What is stopping us from having clients today which only implement the berlin fork and on? E.g. the community decides on a root hash to snapshot against at the hard fork and this special client can only every fully validate from that point on?",
        "created_at": "2020-06-17T01:51:31.695000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We don't have a network that can \"allow\" the tragedy of the commons situation that will arise if clients start forgetting chain history.  The DevP2P `ETH` protocol only remains healthy because to meaningfully participate in it you have to implement all of it which roughly means having the entire chain history available, and the entire state (or syncing towards these goals).  \n\nIf clients start dropping the chain history without us making some significant overhauls to how the network is structured, the ability to reliably sync a new node onto the network will degrade, which will cascade into the few full nodes left on the network being overburdened, and this cycle will continue until there are very few full nodes and syncing a new full node is an arduous ordeal.  The `ETH` protocol *works* because it is built on an *assumption* that all nodes have all of the data.  Once this assumption is no longer true enough it all theoretically falls apart.",
        "created_at": "2020-06-17T01:55:44.239000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My *opinion* starts here.  To remedy this we need:\n\n1. A gossip only network that does transaction and new block propogation (and eventually witness propogation)\n2. A chain history network that allows individual nodes to store a small subset of the chain history and which has good mechanisms for finding the data you need (DHT networks do this well)\n3. A state sync network that has \"swarming\" behavior so that only a very small number of providers can seed the state to a massive number of consumers.\n\nWith these building blocks, you can build a much wider range of clients which implement much smaller swaths of the current node functionality, specific ones that come to mind are:\n\n- Very thin stateless clients\n- Mining nodes that don't store chain history and aren't burdened by connected clients asking them for state or chain data (because they only operate in the gossip network)",
        "created_at": "2020-06-17T02:00:12.438000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!364458974906548225\u003e btw I've written a draft eip based on EIP-2718 Typed Transactions which supports packaging multiple transactions together. The novelty of it is the mechanism which propagates execution information (e.g. total gas spent) of the previous transaction to subsequent ones. This can be used to separate meta-tx actions from their payments in a way that is atomic and compatible with radical changes to the EVM's metering.",
        "created_at": "2020-06-17T12:46:50.022000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://github.com/lightclient/EIPs/blob/transaction-package/EIPS/eip-2733.md",
        "created_at": "2020-06-17T12:46:56.155000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I like it!",
        "created_at": "2020-06-17T13:14:07.689000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Why do you have a size but then constrain to 32 bytes?",
        "created_at": "2020-06-17T13:14:28.083000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Feels like the last parameter should be `bytes` (maybe just a typo)?",
        "created_at": "2020-06-17T13:14:36.628000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e Feels like the last parameter should be `bytes` (maybe just a typo)?\nyou're right, this is a typo",
        "created_at": "2020-06-17T13:15:00.473000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What are your thoughts about having the transaction array signed by a different key than the outer transaction?",
        "created_at": "2020-06-17T13:16:51.447000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Would make the transaction payload bigger, which is unfortunate, but would allow for a separate gas payer.",
        "created_at": "2020-06-17T13:17:34.312000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I would really like to figure out a way to make that happen",
        "created_at": "2020-06-17T13:18:46.920000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I've left it out for now for simplicity, but I believe the right way to do it is work with you and find a general definition for recursive tx types",
        "created_at": "2020-06-17T13:19:30.574000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e An alternative to this would be to hijack RETURNDATASIZE (0x3D) and RETURNDATACOPY (0x3E) in the first frame of the inner transaction's execution and return the RESULT. This was not initially chosen since this would make it possible to determine if a transaction is executing as part of a package.\nI wonder if we are working too hard to stop bad contract behavior?  I agree with the sentiment, that contracts really shouldn't be discriminating like they sometimes do, but I am uncertain that castrating ourselves is worth it.",
        "created_at": "2020-06-17T13:20:08.258000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I also wonder the same",
        "created_at": "2020-06-17T13:21:12.376000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think in this instance it's more okay to hijack the return opcodes because they already exist and the `RESULT` data is really no difference in shape to return values. I don't believe it is common to check the value of `RETURNDATASIZE` when there wasn't an explicit call immediately before",
        "created_at": "2020-06-17T13:23:55.082000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think you would still need a mechanism for indicating failure, unless you wanted to throw a sentinel value into `RETURNDATASIZE`.",
        "created_at": "2020-06-17T13:25:48.323000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Similar problem with gas used.",
        "created_at": "2020-06-17T13:26:09.584000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "failure in the previous transaction or failure in the sense that the tx isn't part of a package?",
        "created_at": "2020-06-17T13:26:41.799000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Solidity now will error if a function receives more calldata than it expects, which will mean that this won't work with any modern Solidity function that wasn't explicitly designed to support this.  ðŸ˜¢",
        "created_at": "2020-06-17T13:26:42.518000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Failure in the previous transaction.",
        "created_at": "2020-06-17T13:26:50.282000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ah, that is what the first 32 bytes of data should represent in the result",
        "created_at": "2020-06-17T13:27:45.267000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So in a way, we don't even really gain any protection against discrimination via the currently proposed mechanism, so we might as well use `RETURNDATASIZE` and `RETURNDATACOPY`.",
        "created_at": "2020-06-17T13:27:49.661000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e Solidity now will error if a function receives more calldata than it expects, which will mean that this won't work with any modern Solidity function that wasn't explicitly designed to support this.  ðŸ˜¢\nthanks for this info, wasn't aware of that",
        "created_at": "2020-06-17T13:28:23.081000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah, you are proposing packing everything into the return data.  Got it.",
        "created_at": "2020-06-17T13:28:25.269000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So you would fetch return data and the first 1 byte would be success/failure boolean, the next 8 bytes (or whatever) would be  gas used, and then the rest would be the previous function's return value?",
        "created_at": "2020-06-17T13:29:11.032000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e Ah, you are proposing packing everything into the return data.  Got it.\nalternatively, there could be a bitfield flag which packages and explicitly state what values they'd like to return",
        "created_at": "2020-06-17T13:29:14.470000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e So you would fetch return data and the first 1 byte would be success/failure boolean, the next 8 bytes (or whatever) would be  gas used, and then the rest would be the previous function's return value?\nfor simplicity i've padded each value to 32 bytes, since they aren't going over the wire they can immediately be brought to the stack and used with `CALLDATALOAD`",
        "created_at": "2020-06-17T13:30:12.296000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Given that Solidity will error on extraneous data, I don't think we can prevent discriminating contracts so we should just go with `RETURNDATASIZE`/`RETURNDATACOPY`.",
        "created_at": "2020-06-17T13:31:01.221000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I will update it",
        "created_at": "2020-06-17T13:31:15.588000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think it will result in cleaner contracts, and Solidity can be updated to support it natively.",
        "created_at": "2020-06-17T13:31:17.270000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I agree, padding to 32 bytes is a good idea.  So you would have `\u003cresult_boolean\u003e\u003cprev_tx_gas_used\u003e\u003ccumulative_gas_used\u003e\u003cprev_tx_return_value\u003e`",
        "created_at": "2020-06-17T13:32:20.319000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think cumulative and previous transaction gas used are both potentially valuable.",
        "created_at": "2020-06-17T13:32:33.047000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah, yes that is a good point",
        "created_at": "2020-06-17T13:33:08.091000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "updated 2733 with your feedback, thanks \u003c@!301186049323958275\u003e",
        "created_at": "2020-06-17T14:05:28.601000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@543900561460822016\u003e You probably should specify what the `gas` opcode returns when inside one of those transactions.  I'm assuming it returns the gas remaining for that transaction, but good to be clear.",
        "created_at": "2020-06-17T14:06:54.246000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I don't think `return_size` is necessary since `return_value` is the last item.  It can be derived from `RETURNDATASIZE - 96`.",
        "created_at": "2020-06-17T14:07:47.587000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "For clarity, it may be valuable to mention that signatures are `secp256k`.  I suspect at some point we'll get non BLS or other signatures in Ethereum, so having TransactionTypes created today be explicit so there isn't confusion when that happens is valuable.",
        "created_at": "2020-06-17T14:08:47.991000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "makes sense",
        "created_at": "2020-06-17T14:09:11.992000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There probably should be a per-transaction gas cost, just to account for the overhead of processing each sub-transaction.",
        "created_at": "2020-06-17T14:09:56.805000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And you should probably carve out a spot in the EIP to specify how much the base gas for a transaction like this is.",
        "created_at": "2020-06-17T14:10:32.232000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e I don't think `return_size` is necessary since `return_value` is the last item.  It can be derived from `RETURNDATASIZE - 96`.\nthis is true, but my concern is if additional return values need to be added in the future, they would need to be appended at the end and `RETURNDATASIZE - 96` will no longer be accurate",
        "created_at": "2020-06-17T14:10:39.481000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e And you should probably carve out a spot in the EIP to specify how much the base gas for a transaction like this is.\nI've listed `INTRINSIC_COST` as a `TBD` constant, I'll need to do more research on this to come up with something accurate",
        "created_at": "2020-06-17T14:12:12.040000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "On the topic of *recursive* transaction types.  It would be ideal to allow \"sponsored\" transactions to the allowed transaction types in the \"batch\" transactions.... but this approach spirals out into very high complexity very quickly and probably is untennable.  So maybe we can do this from within the EVM itself via opcode/precompile.  Sponsored transactions give us a mechanism to initiate a transaction with separate message sender and gas payer.  I can't find the EIP, but I believe it was written by Nick Johnson which allows EOA accounts to execute the `txn.data` as the bytecode on their acccount.  If we had that, combined with another precompile that allowed for changing out `msg.sender` via a signed message then those three things combined with batch transactions give a set of tools to implement meta transactions in a manner that seems to cover all the things.",
        "created_at": "2020-06-17T18:59:37.408000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I guess we don't specifically need the ability for EOA accounts to execute code since the calls could pass through a smart contract interface and achieve the same result.",
        "created_at": "2020-06-17T19:00:26.920000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Rich Transactions I think is what the thing from Nick was called \u003c@364458974906548225\u003e.",
        "created_at": "2020-06-17T19:04:34.063000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My main concern with Rich Transactions is that if gas becomes completely unobservable, it won't resolve the guarded subcall issue",
        "created_at": "2020-06-17T19:05:41.344000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My current thinking is that maybe we should combine \u003c@543900561460822016\u003e's EIP with 2711.  In the case of single-transaction batches, we would waste 1-2 bytes on the wrapping RLP array, but otherwise I don't think it adds any significant overhead/complexity.",
        "created_at": "2020-06-17T19:06:02.559000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "What is the \"guarded subcall issue\"?",
        "created_at": "2020-06-17T19:06:19.919000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "e.g. the inner tx of a meta-tx is atomic with it's payment",
        "created_at": "2020-06-17T19:06:45.298000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "within a single tx",
        "created_at": "2020-06-17T19:06:51.920000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In the case where SENDER == GAS_PAYER, requiring the GAS_PAYER will add ~65 bytes, which is unfortunate.",
        "created_at": "2020-06-17T19:07:26.960000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Maybe 2711 should just include an inner array for batching, and then we can have a separate EIP for transaction type 3 that does batches without a separate GAS_PAYER?",
        "created_at": "2020-06-17T19:08:01.680000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i'm wondering if we can define in 2718 two categories of txs: base txs and wrapper txs",
        "created_at": "2020-06-17T19:09:13.486000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "where a base tx can be transacted with on its own and wrapper txs can wrap base txs",
        "created_at": "2020-06-17T19:09:39.662000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sponsored Transactions and Batch Transactions are both wrappers, and there is benefit to one wrapping the other, so we would need to support wrappers wrapping wrappers.",
        "created_at": "2020-06-17T19:10:28.607000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that's true",
        "created_at": "2020-06-17T19:11:17.679000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And batch transactions as currently authored has a single top-level signature, which doesn't align well with the idea of wrapped transactions in the same way that sponsored transactions do (in sponsored transactions, the child is signed separate from the wrapper).",
        "created_at": "2020-06-17T19:11:28.591000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "at the most basic level, a sponsored transaction is just any valid tx + a sponsor's signature -- so in that sense, a tx package could be sponsored very easily by just appending a sponsor's sig",
        "created_at": "2020-06-17T19:13:57.974000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah, but I don't think that maps well to your current proposal for batch transactions.",
        "created_at": "2020-06-17T19:14:37.378000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Your batch transaction proposal has a single outer signature, and the inner transactions are not fully valid on their own.",
        "created_at": "2020-06-17T19:14:56.017000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also, you have to deal with the fact that the inner transactions need to *not* be executable on their own, else someone could mine them without the wrapping that one might desire.",
        "created_at": "2020-06-17T19:15:23.241000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the tx package is valid and therefore to become sponsored it would just need a sponsor's signature appended",
        "created_at": "2020-06-17T19:15:32.917000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e Also, you have to deal with the fact that the inner transactions need to *not* be executable on their own, else someone could mine them without the wrapping that one might desire\nagreed",
        "created_at": "2020-06-17T19:16:05.335000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "All in all, I tentatively agree with \u003c@364458974906548225\u003e that automagic wrapping of transactions with other transactions is *likely* to be a big can of worms.",
        "created_at": "2020-06-17T19:16:34.514000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is possible we could solve for it, and maybe even without *too* much added complexity, but my gut at the moment is cautioning me away from over-engineering this when I could just throw an array on 2711.",
        "created_at": "2020-06-17T19:17:19.524000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yes, we definitely need to avoid over engineering",
        "created_at": "2020-06-17T19:18:09.430000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "```\n[1, [2, [nonce, to, value, data, chainId, senderV, senderR, senderS, ...], gasLimit, gasPrice, gasPayerV, gasPayerR, gasPayerS]]\n```",
        "created_at": "2020-06-17T19:18:21.192000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Where `...` is any number of `nonce, to, value, data, chainId, senderV, senderR, senderS`.",
        "created_at": "2020-06-17T19:19:21.172000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Where each inner transaction signature is `[1, 2, nonce, to, value, data, chainId]`.",
        "created_at": "2020-06-17T19:20:26.203000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "my concern is that next we're going to have a eip that specifies a new 2718 tx type replacing https://github.com/ethereum/EIPs/blob/af982f1470624791da334b09d3e4f2e4de5e1265/EIPS/eip-1681.md and now we need to figure out how to reconcile that",
        "created_at": "2020-06-17T19:21:16.099000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We could add `valid-until` to 2711 transactions.",
        "created_at": "2020-06-17T19:22:28.871000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Optional values only cost 1 byte if you use `0` as a sentinel.",
        "created_at": "2020-06-17T19:22:48.747000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "sure, we could add everything to 2711 but eventually it needs to be shipped and then how do we introduce features? we'll run into the same issues we face today",
        "created_at": "2020-06-17T19:23:31.108000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "A new transaction type presumably.",
        "created_at": "2020-06-17T19:24:13.086000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i don't want this to be a blocker because obviously these things are immensely valuable, but i think this is a hard problem and we should at least take a crack at it before following the path of least resistance",
        "created_at": "2020-06-17T19:24:47.467000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Though, it sounds like 1681 is trying to solve for account cleanup, which *requires* that legacy transactions stop working at some point.  That is a much harder sell.",
        "created_at": "2020-06-17T19:24:52.971000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'll take a stab at the easy path tomorrow and just add a `valid-until` field and an batch-form to 2711.",
        "created_at": "2020-06-17T19:25:37.153000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If someone is able to come up with a clean solution to arbitrary transaction nesting I can pull some of that stuff out and reduce 2711 to just the GAS_PAYER wrapper.",
        "created_at": "2020-06-17T19:26:29.310000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i'm not sure if this is what you're proposing \u003c@!301186049323958275\u003e, or if this is another solution, but new transaction types could simply define all permutations of existing transactions that make sense. (e.g. sponsored txs is a base unit as defined, tx packages defines base tx type + all variations of sponsored type, valid-util txs defines base tx type + all sponsored tx variations + tx package variations)",
        "created_at": "2020-06-17T19:30:38.688000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "this is much more verbose, but it certainly avoids opening the recursive can of worms",
        "created_at": "2020-06-17T19:31:47.855000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think that is essentially what I'm proposing.  2711 would be a feature superset of all the known things we want in transactions.  Separate gas payer, batches, valid-until, etc.",
        "created_at": "2020-06-17T19:35:15.373000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "will there continue to be a base 2711 transaction that is simply a sponsored tx, or will there be optional fields like valid until?",
        "created_at": "2020-06-17T19:36:17.667000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Currently it has subtypes of its own, and we may end up with a bunch of them (since they are free after the first).",
        "created_at": "2020-06-17T19:36:19.850000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My personal preference is for optional fields rather than a hundred subtypes with all of the various iterations, but I could be argued out of that.",
        "created_at": "2020-06-17T19:37:05+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i don't have a strong preference either way",
        "created_at": "2020-06-17T19:37:32.185000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Also, 1681 is trying to make valid-until required, so I feel like having the spot for it on every transaction is good for working toward that goal, rather than against it.",
        "created_at": "2020-06-17T19:37:55.510000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And for batches, my preference is to just always have an array, and sometimes it is an array of one.",
        "created_at": "2020-06-17T19:38:20.576000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That one is a bit harder of a sell though and I could be talked out of it.",
        "created_at": "2020-06-17T19:38:54.855000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "My current thought is that if you are batching, the gas payer sets gasLimit and gasPrice.",
        "created_at": "2020-06-17T19:39:26.079000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There may be a place for child transactions to set `gasLimit`... but not `gasPrice` IMO.",
        "created_at": "2020-06-17T19:39:51.999000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Here's the \"Rich Transaction\" eip: https://github.com/Arachnid/EIPs/blob/richtx/EIPS/EIP-draft-rich-transactions.md  (thanks for the keyword hint)",
        "created_at": "2020-06-17T19:45:23.166000+00:00",
        "attachments": null
    },
    {
        "author": "_drinkcoffee",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In the Eth1.x call, there was a discussion about cross-contraction function calls that supply a limited amount of gas. The static code analysis code I have developed for the Function Selector / Id analysis for code merklization might be able to be re-used to work out which contracts do these calls, and of those, which supply static amounts of gas. Does that sound useful?",
        "created_at": "2020-06-17T23:53:29.873000+00:00",
        "attachments": null
    }
]