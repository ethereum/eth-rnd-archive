[
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!301186049323958275\u003e regarding having an EOL for the legacy transaction format... I'm starting to think we don't gain much there since:\n\n1. Any client which exposes the option of full history sync will have to retain support for it somewhere in their code.\n2. Web3 (web3.js, ethers.js, web3.py, etc) will need to retain some level of support though they *may* be able to actually drop some level of support over time.\n3. Block explorers will still need to retain support for the legacy format.\n\nIn theory we can convert all of the historical transactions into the new envelope format, but the legacy `TransactionType` will still always have to be special cased in some way since it will derive it's hash differently.",
        "created_at": "2020-06-16T02:28:41.681000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Hmm, good point.",
        "created_at": "2020-06-16T02:29:13.467000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I was actually just typing up a PR to add a type 1 transaction to 2718 that would let us deprecate type 0, but maybe I shouldn't?",
        "created_at": "2020-06-16T02:29:52.970000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e As of `FORK_BLOCK_NUMBER`, `rlp([1, rlp([nonce, gasPrice, gasLimit, to, value, data, chainId, senderV, senderR, senderS])])` will be a valid transaction over the devp2p protocol and in blocks where the signature represented by `senderV, senderR, senderS` is a signature of `rlp([1, rlp([nonce, gasPrice, gasLimit, to, value, data, chainId])])`.  A `chainId` of `0` represents a transaction that is valid for any/all chains.",
        "created_at": "2020-06-16T02:30:09.293000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But if we don't deprecated type 0, I feel like having two transactions that are *basically* the same doesn't add much value.",
        "created_at": "2020-06-16T02:31:04.793000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I **am** in favor of having both a type `0` which is the legacy format with the legacy hashing scheme and same signature scheme, **and** a type `1` which would be somethink closer to what you just posed (all of the transaction parameters we use today (with `chainId` extracted), and the hash  and signature scheme updated to include the full *everything*",
        "created_at": "2020-06-16T02:31:52.886000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Well, the nice thing is that tooling can start using the new format which at least relegates the legacy format to fewer code paths....",
        "created_at": "2020-06-16T02:32:34.851000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Meh, everyone will have to still handle that so I don't know if we gain much of anything.",
        "created_at": "2020-06-16T02:32:53.440000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It would just be more code paths, thus more complexity, thus more potential for bugs.",
        "created_at": "2020-06-16T02:33:22.717000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You may be right, but I'm still leaning towards having both, need to think about the why",
        "created_at": "2020-06-16T02:33:52.035000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thinking it through, if we EOL the legacy format....\n\n- We can stop accepting it at the p2p layer (gossip network)\n- We can stop accepting it at the RPC layer (this one might be tricky)\n- **If** we get the p2p infrastructure built out to allow forgetting chain history which is one of the hills I'm plannign to fight my way up over the next 1-2 years: **then** clients *can* choose to omit support for it if they don't implement full sync which I think is a reasonable thing to expect to happen in this little fabricated/imagined future of mine.",
        "created_at": "2020-06-16T02:37:54.019000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Not sure the gain is that big, but that's what I can think of off the top of my head at the end of a long day.",
        "created_at": "2020-06-16T02:38:24.963000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Are you talking about EOL of the legacy format or the type 0 format in ☝️?",
        "created_at": "2020-06-16T02:40:23.563000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think we should EOL the legacy format as soon as 2718 lands.  What I'm less certain about is EOLing `TransactionType` 0.",
        "created_at": "2020-06-16T02:41:30.845000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'm going to hold off on this PR for now.  While I do like your 1-2 year plan of getting rid of history, I think that planning for that eventuality right now is a bit of over-engineering.  We can always deprecate later if you are successful.",
        "created_at": "2020-06-16T02:44:59.679000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If we decide to bring it back, this is the text I wrote up for it:\n\u003e As of `FORK_BLOCK_NUMBER`, `rlp([1, rlp([nonce, gasPrice, gasLimit, to, value, data, chainId, v, r, s])])` will be a valid transaction over the devp2p protocol and in blocks where the signature represented by `v, r, s` is a signature of `keccak256(rlp([1, rlp([nonce, gasPrice, gasLimit, to, value, data, chainId])]))`.  A `chainId` of `0` represents a transaction that is valid for any/all chains.  `v` is the parity (`0` for even or `1` for odd) of the y-value of the secp256k1 signature represented by `r,s`.",
        "created_at": "2020-06-16T02:45:47.833000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@364458974906548225\u003e I added the **SHOULD** recommendation for including `TransactionType` in any signatures.",
        "created_at": "2020-06-16T03:38:09.263000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e If we get the p2p infrastructure built out to allow forgetting chain history which is one of the hills I'm plannign to fight my way up over the next 1-2 years: then clients can choose to omit support for it if they don't implement full sync which I think is a reasonable thing to expect to happen in this little fabricated/imagined future of mine.\ncurious to hear more about this!",
        "created_at": "2020-06-16T13:16:26.811000+00:00",
        "attachments": null
    }
]