[
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Here's the block:\nhttps://nocturne.rayonism.io/block/3655",
        "created_at": "2021-05-13T00:14:45.085000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But the 120 deposits did not enter",
        "created_at": "2021-05-13T00:14:55.927000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "only 77 transactions.",
        "created_at": "2021-05-13T00:15:11.869000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "because of the gas limit",
        "created_at": "2021-05-13T00:15:26.695000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "thought the string was wrong, but appears fine: here's the input string for one of those deposits",
        "created_at": "2021-05-13T00:25:42.247000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "```\n22895118\n0000000000000000000000000000000000000000000000000000000000000080\n00000000000000000000000000000000000000000000000000000000000000e0\n0000000000000000000000000000000000000000000000000000000000000120\n87bd6de5d920b138ca7fa986218624a6d47848b997ca8ff9c099c42e8c3e3ffe\n0000000000000000000000000000000000000000000000000000000000000030\nae7a8518d7ceb5e0f79db4c1e3eb6a6f9cea39877bcce3f1df7b9d92d7c25684\ne6ddd338fbfe04d61cf655e47e0bf07c\n00000000000000000000000000000000\n0000000000000000000000000000000000000000000000000000000000000020\n00042620e67c4c46785c41536a97ab2dcec14584d9e22d404f3f9c2e7579b6b6\n0000000000000000000000000000000000000000000000000000000000000060\na00d93434ecad82e2b403fd95ac47a81a0dfbaabd48f210528ad48e3e3644e69b691ceab28ee8de2531f30b17378001f0a7ca8cce63623383745f2cbe4cee9ac11c057ba9ce2b9779f398aa4572d5e2065221222dc11fba49cb1498133931cc9\n```",
        "created_at": "2021-05-13T00:28:24.013000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "HereÂ´s the corresponding entry in the deposit data generated by eth2-val-tools:\n```\n{\"account\":\"m/12381/3600/242/0/0\",\"deposit_data_root\":\"87bd6de5d920b138ca7fa986218624a6d47848b997ca8ff9c099c42e8c3e3ffe\",\"pubkey\":\"ae7a8518d7ceb5e0f79db4c1e3eb6a6f9cea39877bcce3f1df7b9d92d7c25684e6ddd338fbfe04d61cf655e47e0bf07c\",\"signature\":\"a00d93434ecad82e2b403fd95ac47a81a0dfbaabd48f210528ad48e3e3644e69b691ceab28ee8de2531f30b17378001f0a7ca8cce63623383745f2cbe4cee9ac11c057ba9ce2b9779f398aa4572d5e2065221222dc11fba49cb1498133931cc9\",\"value\":32000000000,\"version\":1,\"withdrawal_credentials\":\"00042620e67c4c46785c41536a97ab2dcec14584d9e22d404f3f9c2e7579b6b6\"}\n```",
        "created_at": "2021-05-13T00:29:23.856000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And here's the command that I used to generate the deposit data:\n```\neth2-val-tools deposit-data --source-min 240 --source-max 360   --fork-version 0x00000702   --validators-mnemonic \"the mnemonic proto gave me\"   --withdrawals-mnemonic=\"some randon mnemonic cause devnet eth can be thrown\"   \u003e \"$TESTNET_NAME\"/private/$VALIDATOR_NODE_NAME/depositdata\n```",
        "created_at": "2021-05-13T00:31:07.578000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That string seems ok to me...",
        "created_at": "2021-05-13T00:31:51.449000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So it beats me, why these deposits are being considered invalid",
        "created_at": "2021-05-13T00:32:08.359000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Sorry that I keep flooding the channel, but I just sent those deposits, those were the only transactions this epoch, and now we are not finalizing, even with participation \u003e 80%",
        "created_at": "2021-05-13T00:38:14.496000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "and back to finalizing. Seems like any transaction causes reorgs on the eth1 chain",
        "created_at": "2021-05-13T00:54:57.208000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I cannot find any mistake in those deposits.",
        "created_at": "2021-05-13T00:55:10.149000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ok, I promise is the last one, but I just do not understand at all that block that included the deposits. it contains 77 transactions all with `\"gas\": \"0x17318\"`, and `Â¨gasPrice\": \"0x4\"`, now 77 times `0x17318` is `0x6F9E38` which is way more than the gas limit of `0x400000`, if I multiply by 4 it's even more. so how can those transactions be included in the first place? It claims that the gas used was `0x3ef173` which is way less than the sum of the `gas`  entry on each transaction, with or without multiplying by the gas price. I'd love to be enligtened. But to the risk of noone checking the deposit up there: that one seems more important, that deposit is right as far as I can tell, and is still considered invalid by the network.",
        "created_at": "2021-05-13T01:11:33.960000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Thanks for looking into this, seems strange indeed. Deposits have a variable gas cost though, the gas limit per tx isn't the same thing. If you look at the gas_used field in the execution payload, it's under the block gas limit",
        "created_at": "2021-05-13T01:50:39.235000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'll help debug and make some test deposits myself tomorrow. Afk currently",
        "created_at": "2021-05-13T01:52:38.435000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ah that shows my lack of knowledge of eth1, I thought the block would have the actual gas used",
        "created_at": "2021-05-13T01:55:46.975000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Thanks that explains it",
        "created_at": "2021-05-13T01:55:54.991000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But the deposits I still don't understand why they aren't included. I do have a theory though, will test if this last batch enters before",
        "created_at": "2021-05-13T01:58:20.232000+00:00",
        "attachments": null
    },
    {
        "author": "terence0083",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Fyi i brought the prysm validators down for a good hour to debug a syncing error. I just fixed it and they are operational again",
        "created_at": "2021-05-13T02:18:00.367000+00:00",
        "attachments": null
    },
    {
        "author": "chrishobcroft",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Failures reported when trying to register at https://nocturne.rayonism.io/register and https://nocturne.rayonism.io/resend - I think it's some issue with mail server sending validation links.",
        "created_at": "2021-05-13T07:52:28.910000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "unknown.png",
                "content": "e9fcb61abcf514ac932782bc0284e7db20292c3ce027eff1ab6db75cf5a5b0f1"
            }
        ]
    },
    {
        "author": "raphael1234",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "pretty sure it is not supposed to work after all ðŸ˜†",
        "created_at": "2021-05-13T09:16:10.062000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We have non-zero `genesis_validators_root` for the devnet. Could it be the problem for `eth2-vals-tool` that does not take real `genesis_validators_root` in account and uses `Bytes32()` instead?",
        "created_at": "2021-05-13T09:22:06.045000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Related question: is `genesis_validators_root` always zero for deposits?",
        "created_at": "2021-05-13T09:42:38.289000+00:00",
        "attachments": null
    },
    {
        "author": "dkdkdkdkdkdk",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "could the links in https://fork.nocturne.rayonism.io/#nav-block-tree lead to https://nocturne.rayonism.io/?",
        "created_at": "2021-05-13T09:46:28.198000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I don't think so, the deposit does very simple checks then packs the data given and hashes it to check against the provided root\n```\n        // Compute deposit data root (`DepositData` hash tree root)\n        bytes32 pubkey_root = sha256(abi.encodePacked(pubkey, bytes16(0)));\n        bytes32 signature_root = sha256(abi.encodePacked(\n            sha256(abi.encodePacked(signature[:64])),\n            sha256(abi.encodePacked(signature[64:], bytes32(0)))\n        ));\n        bytes32 node = sha256(abi.encodePacked(\n            sha256(abi.encodePacked(pubkey_root, withdrawal_credentials)),\n            sha256(abi.encodePacked(amount, bytes24(0), signature_root))\n        ));\n\n        // Verify computed and expected deposit data roots match\n        require(node == deposit_data_root, \"DepositContract: reconstructed DepositData does not match supplied \n```\nIf anything, the `genesis_validators_root` would play a role in the way clients handle deposits, but prater is working fine (by the way, I deposited to prater with a version of this script and worked fine)",
        "created_at": "2021-05-13T09:58:57.643000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!203220829473996800\u003e we released new version with receipt fix: https://github.com/NethermindEth/nethermind/releases/tag/1.10.70 \u0026\u0026 https://hub.docker.com/r/nethermind/nethermind/tags?page=1\u0026ordering=last_updated\u0026name=1.10.70",
        "created_at": "2021-05-13T09:59:52.609000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It's an explorer for a devnet, meant to run for just a week. So yeah, no registrations",
        "created_at": "2021-05-13T10:01:07.871000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Agree. I've been checking the state and deposit index is zero, likewise deposit count in eth1 data. So, it must be eth1 related issue. First thought was it's been on eth2 because we saw logs in one of deposit transaction receipts that signifies that deposit is valid, or maybe not? ðŸ¤”",
        "created_at": "2021-05-13T10:02:24.663000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Could you, please, give me a hash of one of your valid deposit transactions?",
        "created_at": "2021-05-13T10:02:42.380000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This transaction went in the last batch of 120 deposits I made. Just waking up here, I see the eth2 side saw those deposits already, haven't checked if they are cosnidered valid or not",
        "created_at": "2021-05-13T10:06:13.798000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "https://discord.com/channels/595666850260713488/826479341784662056/842186752919601154",
        "created_at": "2021-05-13T10:06:24.416000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The one thing I did that is non-canonical is that I sent the same deposits with the same nonces on two different Catalysts here, one connected to Teku and one connected to Prysm. To increase the chances that they will be included faster. The first node proposing them was Teku on block 374. Then Prysm sent its share when it got to propose a block. My understanding is that those transactions would have been rendered invalid by the prysm Catalyst when assembling the block later on, since by then, it had already included the eth1 block from the first batch of deposits. The block that prysm proposed first after that is 393. It included 100 regular transactions and 4 remaining deposits that hadn't fit in the block proposed by Teku. Then I sent 60 invalid deposits (wrong fork) in block 904 and finally 120 good ones that were spit in 77 in block 3655 and block 4250,",
        "created_at": "2021-05-13T10:15:04.021000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I extracted the data of the transaction that went through my node from the ETH1 block with hash `0xee883bc0b4885f50af201fe1e9f86e5928d022082e176b96f5f7549fed0b944a`",
        "created_at": "2021-05-13T10:16:40.169000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "FWIW, just to make sure it's not the way that Teku packs the transactions, I am just sending again the same 120 deposits from prysm. This is the last of them. \n```\nSent deposit for pubkey: 9813e6ee4dcecd6b4daca2d712c356f6b1e59ceed5b36d279ae719bc00e2eee31d4f59e753eeb6543990778fd144958d\ntx hash: 0x22a31f522c9443b72a2c9e24299eb9f65556b65373067cdcf6dc732e0c9592f1\n```\nWill be in the next Prysm block I propose.",
        "created_at": "2021-05-13T10:21:06.011000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I am restarting my local geth in archive mode to grab the trace of this old transaction",
        "created_at": "2021-05-13T10:22:13.794000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "There was no `REVERT` in that transaction which would be the case if one of `require` checks that are triggered after `DepositEvent` emission failed. So, it should be deposited successfully",
        "created_at": "2021-05-13T10:28:49.465000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This is one of the latest eth1 data votes from Teku: https://nocturne.rayonism.io/block/6754",
        "created_at": "2021-05-13T10:32:28.899000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And I see a lot of votes with 0 deposits, eth1 data haven't been updated since genesis due to issues with eth1 data poll. It explains why no deposits are reflected in the state",
        "created_at": "2021-05-13T10:34:40.922000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yeah that I would understand",
        "created_at": "2021-05-13T10:41:04.280000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but they rendering invalid is a different beast. Perhaps I have a ghost problem, and is Prysm showing me the 60 invalid deposits on every slot, instead of all the other ones",
        "created_at": "2021-05-13T10:41:46.710000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "what bugs me is that I should have seen the logs in slot 2048+`slotN` where `slotN` is when I included the deposits",
        "created_at": "2021-05-13T10:43:00.411000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "and I didn't get any logs by then",
        "created_at": "2021-05-13T10:43:06.700000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "What logs have you expected to see?",
        "created_at": "2021-05-13T10:44:19.628000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "debug logs showing that a deposit was processed, the index number and the merkle tree root",
        "created_at": "2021-05-13T10:45:48.476000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So regardless of inclusion in the chain, when a deposit is received after the `ETH1_FOLLOW_DISTANCE` has passed, I should have seen the log of the deposit being processed",
        "created_at": "2021-05-13T10:46:38.729000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "eth1 data hasn't been updated in the state ever, there is no deposits to the beacon chain observation, nothing to process",
        "created_at": "2021-05-13T10:48:01.506000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah it may well be that I had a shift of one entire voting period of thinking. Eth1 Data contains the vote for the block hash of the block up to the end of the previous to the previous voting period (I was thinking the previous) so still you process deposits and see those logs of deposits even regardless of eth1 data being changed or not",
        "created_at": "2021-05-13T10:52:48.425000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "my point is that those logs of processing deposits should be there independently of eth1 data having changed or the beaconchain having reached a majority vote on eth1. as long as the deposits are older than the follow distance I should see them",
        "created_at": "2021-05-13T10:53:53.149000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but it's true that I may have been expecting them too early. Then I went on a bike ride in the next period when they probably appeared and I didn't see them",
        "created_at": "2021-05-13T10:55:21.213000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "and lost them",
        "created_at": "2021-05-13T10:55:31.930000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "you mean logs of deposits being fetched from eth1 endpoint?",
        "created_at": "2021-05-13T10:57:08.452000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Fyi, currently I'm running some of the deposit tooling that I wrote for debugging the prysm incident to take a look at eth1 data voting, the deposit tree, and deposit validity",
        "created_at": "2021-05-13T10:57:21.879000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Thanks \u003c@!203220829473996800\u003e It just occurred to me that I'm being very silly, it should be trivial to check this from the client",
        "created_at": "2021-05-13T10:59:20.493000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "~~ok, indeed this is stupid the metric of the deposit count only updates with valid deposits~~",
        "created_at": "2021-05-13T11:00:18.385000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "so the clients are seeing the right amount of valid deposits, both my nodes are reporting 270 deposits",
        "created_at": "2021-05-13T11:01:23.799000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I may be wrong there, will check prysm code",
        "created_at": "2021-05-13T11:02:37.715000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ok, it's not wrong, `powchain_valid_deposits_received 270`",
        "created_at": "2021-05-13T11:03:26.431000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "however I cannot account for that number ðŸ™‚",
        "created_at": "2021-05-13T11:05:59.141000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!755590043632140352\u003e the first voting period is just a lot of votes for 0 deposits (not enough distance to deposits I think): https://gist.github.com/protolambda/750eb8f68cd58d6748dcd055a0e16b6a\nNote that all the Prysm nodes fail to vote for valid eth1 data, and just vote random instead.\nRunning it on the other 3 periods next",
        "created_at": "2021-05-13T11:10:07.178000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yeah I don't mind validators not being included, I worried about the deposits being considered invalid",
        "created_at": "2021-05-13T11:11:32.254000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "which I am not sure now. I am getting lots of \n```\n[2021-05-13 08:11:48]  WARN rpc/validator: Invalid Eth1 deposit\n```\nFrom my node",
        "created_at": "2021-05-13T11:12:06.187000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but I did send 60 invalid deposits",
        "created_at": "2021-05-13T11:12:12.072000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I grabbed data from the recent finalized state and there are `246/593` of non-zero deposit votes. Not that representative though, but the state at the end of the previous voting period seems to be unreachable. Also, there are missed slots and total votes count must be `736` instead of `593`. So, `246/736` correct votes seems to be too low",
        "created_at": "2021-05-13T11:15:01.880000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "btw, Do we have a representation of eth1 data voting in the explorer?",
        "created_at": "2021-05-13T11:18:24.091000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "My confusion boils down to this: I sent 200 valid deposits and 60 invalid. \u003c@!489217181104734219\u003e sent 10 valid, my node reports 270 valid. Anyway, we'll find out if we ever achieve a majority",
        "created_at": "2021-05-13T11:18:38.619000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We need to do something to get to this majority.  At least, it worth restarting nethermind nodes with the recent fix which should allow for correct receipts processing",
        "created_at": "2021-05-13T11:20:20.152000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the first 2 periods had a majority, but voted for 0 deposits. I'm debugging the 3rd now",
        "created_at": "2021-05-13T11:21:34.275000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "that's already wrong there ðŸ˜¦",
        "created_at": "2021-05-13T11:23:42.566000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Oh crap my own scripts do not work to analyze voting periods because of `from eth2spec.spec0 import spec`",
        "created_at": "2021-05-13T11:28:25.479000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "is there a merge version of that \u003c@!203220829473996800\u003e ?",
        "created_at": "2021-05-13T11:28:36.431000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the beacon state otherwise appears as invalid",
        "created_at": "2021-05-13T11:28:44.792000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "`from eth2spec.merge import spec`",
        "created_at": "2021-05-13T11:29:45.744000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "and use the latest dev eth2spec as git dependency",
        "created_at": "2021-05-13T11:30:00.392000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "didn't work from my pip installed version of the",
        "created_at": "2021-05-13T11:30:05.127000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ahh ok",
        "created_at": "2021-05-13T11:30:14.513000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "`pip install \"git+https://github.com/ethereum/eth2.0-specs@dev\"`",
        "created_at": "2021-05-13T11:30:35.078000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "FYI, added the other voting periods to my gist. Will now add the last ongoing period. The 3rd didn't reach 50%+",
        "created_at": "2021-05-13T11:31:33.885000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "```\npython ~/votes.py  \nVoting summary for slot: 7056\nVoting period starts:6144  ends:8192\n0x52a5c3b122dedd6d77f48b8597da1b0bd15c1a19ae5b393e02365dc8b49b07d3 : 1\n0x7a464c534f601c885b56fc2feac66a82c2d6fd5706cf76ec3e05cca3160949a2 : 150\n0xf936f4395596714b84f731c2aec62047547c77fecc786b71ce587c628f0e51a4 : 241\n0xcc33243c96e018d263eaa63e63a1fb162b5275f86eaf04dba7418edcd08994d8 : 292\n0xe2c45fb77b90b85f682efff288d6662710a10d91a00968de72d6bb99f3661a81 : 1\n0x14addae055ee2188666d351eaba322fb5af1028132800809b5af181da01bede9 : 1\n0x64751cabe19ee4e7e6d1d177affae2bfb776238f5e4d27d31781e1ac53a9fdb6 : 1\n0x1c4c0e7697db815eb95aa99f976499f9a03407670b0e4bf74c78245838a987e4 : 1\n0x95fc54d900e1\n```",
        "created_at": "2021-05-13T11:31:39.514000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I am getting three hashes and then a lot of random votes",
        "created_at": "2021-05-13T11:31:52.415000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "One of the largest hashes is genesis",
        "created_at": "2021-05-13T11:32:17.984000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "is it deposit count to the right?",
        "created_at": "2021-05-13T11:33:14.331000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "or is it votes?",
        "created_at": "2021-05-13T11:33:30.612000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "```\nError: invalid merkle root (remote: c83d75753f6fd3eccee45373b4cfb9f2a1c4cab7861b815445d40e61b49c0c1a local: 13fbad4f6e51fb0aed0fbc5943cdde7cd5514e1395a334ad190a2c5269b9ee62)\n##############################\n \n````",
        "created_at": "2021-05-13T11:33:38.121000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "```\nWARN [05-13|08:31:31.241] Served consensus_newBlock                conn=127.0.0.1:57616 reqid=2027  t=14.823168ms err=\"invalid merkle root (remote: c83d75753f6fd3eccee45373b4cfb9f2a1c4cab7861b815445d40e61b49c0c1a local: 13fbad4f6e51fb0aed0fbc5943cdde7cd5514e1395a334ad190a2c5269b9ee62)\"\n```",
        "created_at": "2021-05-13T11:34:10.470000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That's my Catalyst",
        "created_at": "2021-05-13T11:34:14.156000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It's votes",
        "created_at": "2021-05-13T11:34:30.903000+00:00",
        "attachments": null
    },
    {
        "author": "dkdkdkdkdkdk",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "what do you mean by random? they aren't valid eth1 blocks?",
        "created_at": "2021-05-13T11:35:04.923000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "that's what honest nodes vote for when they can't get a working eth1 connection, which is weird, since the eth1 connection is definitely working. It's some prysm bug specific to the merge prototype I think",
        "created_at": "2021-05-13T11:36:00.445000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "```\nERROR[05-13|08:31:31.241] \n########## BAD BLOCK #########\nChain config: {ChainID: 702 Homestead: 0 DAO: \u003cnil\u003e DAOSupport: false EIP150: 0 EIP155: 0 EIP158: 0 Byzantium: 0 Constantinople: 0 Petersburg: 0 Istanbul: 0, Muir Glacier: \u003cnil\u003e, Berlin: 0, YOLO v3: \u003cnil\u003e, Engine: unknown}\nNumber: 5437\nHash: 0x96583221bcb0a13476a5706739690d88c27126e225fd108d614e23e51f3034ba\n     0: cumulative: 50646 gas: 50646 contract: 0x0000000000000000000000000000000000000000 status: 1 tx: 0x6d45dc9d968ceea591fee362778475df121b87c2eb9f60ff317b94414064359b logs: [0xc001f86160] bloom: 10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000 state:\n```",
        "created_at": "2021-05-13T11:36:12.544000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "prysm should be voting correctly though",
        "created_at": "2021-05-13T11:36:28.799000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "at least I tested it thoroughly with Catalyst",
        "created_at": "2021-05-13T11:36:46.765000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "the ongoing voting period",
        "created_at": "2021-05-13T11:37:32.011000+00:00",
        "attachments": [
            {
                "type": "text/plain; charset=utf-8",
                "origin_name": "message.txt",
                "content": "e3cb149f61f84137e0ae2919e59f825cde129fb512aa3f84a561edf10a21c596"
            }
        ]
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "that seemed to be yours, https://nocturne.rayonism.io/block/7053",
        "created_at": "2021-05-13T11:37:36.093000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yeah I was supposed to send the deposits",
        "created_at": "2021-05-13T11:37:54.195000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "in that block",
        "created_at": "2021-05-13T11:37:57.206000+00:00",
        "attachments": null
    },
    {
        "author": "dkdkdkdkdkdk",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "shouldn't they vote for `state.eth1_data` per the spec?",
        "created_at": "2021-05-13T11:38:22.194000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "it's an error when trying to serve the block to the beacon chain",
        "created_at": "2021-05-13T11:38:24.298000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "this is weird, was it the same catalyst that has produced this block?",
        "created_at": "2021-05-13T11:41:47.225000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "that's the catalyst connected to my prysm node...",
        "created_at": "2021-05-13T11:42:30.321000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "`0x7a464c534f601c885b56fc2feac66a82c2d6fd5706cf76ec3e05cca3160949a2` = exec block hash of slot 4096\n`0xf936f4395596714b84f731c2aec62047547c77fecc786b71ce587c628f0e51a4` = exec block hash of genesis\n`0xcc33243c96e018d263eaa63e63a1fb162b5275f86eaf04dba7418edcd08994d8` = slot 3509",
        "created_at": "2021-05-13T11:42:43.740000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "To me it looks like some prysm and nimbus nodes have wrong deposit contract configuration (wrong address or wrong deployment block, or maybe even different seconds-per-eth1-block)",
        "created_at": "2021-05-13T11:46:29.193000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Anyway, that's the voting part. Is there a bug with individual deposits as well?",
        "created_at": "2021-05-13T11:47:18.732000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "hard to know now, we'll figure out when we reach majority. \u003c@!363800010518822915\u003e did you launch the prysm team's nodes with `--contract-deployment-block 0`? it looks like your nodes are voting incorrectly, and mine is voting correctly (I launched with that flag)",
        "created_at": "2021-05-13T11:55:53.391000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!755590043632140352\u003e are you sure? See gist, your prysm+catalyst node is voting for ~~random block hashes~~. Edit, not completely random, but not majority either",
        "created_at": "2021-05-13T11:59:49.607000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Actually, it looks like you have two different votes for the `0x0fac32e8e3560aa258d71e2c672138332d0ae1bb7ba157aeb239e17bebbc13a4` block hash in eth1 data, but with different deposit tree roots",
        "created_at": "2021-05-13T12:02:02.020000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Did the Prysm merge prototype include the fix for the mainnet deposit incident?",
        "created_at": "2021-05-13T12:02:36.938000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "seens allright to me, by the end of the period https://gist.github.com/protolambda/750eb8f68cd58d6748dcd055a0e16b6a#file-nocturne_voters_period2-txt-L1514",
        "created_at": "2021-05-13T12:02:39.335000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "How about the one right above?",
        "created_at": "2021-05-13T12:03:12.705000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "10 deposit difference, but same block hash",
        "created_at": "2021-05-13T12:03:53.398000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Interesting, missed that, let me check if they happened between my deposits and \u003c@489217181104734219\u003e's",
        "created_at": "2021-05-13T12:04:45.962000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The blocks that voted for  140 deposits are 4325,4190,4177",
        "created_at": "2021-05-13T12:06:32.541000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The blocks for 150 deposits are 4491,4828,4837,5017,...",
        "created_at": "2021-05-13T12:08:08.350000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "now my last round of deposits for that period came in slot 904 where I send the ones I think are invalid",
        "created_at": "2021-05-13T12:09:40.738000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Maybe it's some bug with the voting period boundaries. The `SECONDS_PER_ETH1_BLOCK` is set to 12, unlike mainnet/prater.",
        "created_at": "2021-05-13T12:10:00.269000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!489217181104734219\u003e went to 1872",
        "created_at": "2021-05-13T12:10:22.100000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So notice that the difference is really at the boundary: all proposers after the 2048*2 mark voted for 150 deposits, while all before that boundary voted for 140",
        "created_at": "2021-05-13T12:12:13.567000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "so it seems to me that my node is voting consistently",
        "created_at": "2021-05-13T12:12:26.005000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Given that \u003c@!363800010518822915\u003e has 110 votes for the genesis block I would go ahead and bet that he forgot to pass the deployment block 0 flag",
        "created_at": "2021-05-13T12:13:04.383000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "https://gist.github.com/protolambda/84d07e12e7e0cea94a15df723919b227\nIndividual slot-by-slot votes for ongoing voting period",
        "created_at": "2021-05-13T12:13:16.999000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ok, so in this period I think the right deposit count should be 227",
        "created_at": "2021-05-13T12:14:55.463000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I passed that deployment block 0 flag to all my prysm nodes. Combined with Geth it votes for genesis, and combined with nethermind/besu it votes random",
        "created_at": "2021-05-13T12:16:58.056000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Something is very very off! after relaunching my prysm node, it went from 270 valid to \n```\npowchain_valid_deposits_received 69\n```\nBut still reports a total of 270",
        "created_at": "2021-05-13T12:18:08.663000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "nethermin has this update for block receipts now",
        "created_at": "2021-05-13T12:18:33.486000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "oh right, would that affect the deposit voting?",
        "created_at": "2021-05-13T12:19:01.030000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It's hard to know what's going on, my last sucessful prysm proposal was voting for the right number of deposits and the right hash to my mind: https://nocturne.rayonism.io/block/6690",
        "created_at": "2021-05-13T12:19:43.155000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think yes. Here is the message from Luk, https://discord.com/channels/595666850260713488/826479341784662056/842340363598561291",
        "created_at": "2021-05-13T12:20:12.703000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yes, all nethermind running nodes should be voting wrong I think since they weren't keeping receipts",
        "created_at": "2021-05-13T12:20:18.274000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "rolling out nethermind updates now ðŸ™‚",
        "created_at": "2021-05-13T12:22:12.249000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I guess you will need to wipe out db",
        "created_at": "2021-05-13T12:23:39.743000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm going to try `--deposit-contract \"0x4242424242424242424242424242424242424242\"` in prysm. The CLI flag is duplicate with the chain config. I wouldn't be surprised if it's yet another config initialization bug.\nEdit: checked with `eth/v1alpha1/node/genesis` api, and deposit contract was correct",
        "created_at": "2021-05-13T12:23:52.440000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Sure, will resync nethermind nodes first",
        "created_at": "2021-05-13T12:24:31.372000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ok, resynced lighthouse and prysm, teku about to finish, and nimbus is going (slower, due to nethermind websocket interaction issue I guess).",
        "created_at": "2021-05-13T12:33:08.115000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "https://nocturne.rayonism.io/block/7388 The nethermind update helped, my lighthouse-nethermind node is voting correctly now",
        "created_at": "2021-05-13T12:39:51.858000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yay!",
        "created_at": "2021-05-13T12:40:47.835000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If we can solve the remaining prysm eth1 data voting issue, we can have deposits. But if not, no problem, it was a prototype and we'll separate the consensus API from the use JSON-RPC, so this bug may not exist anymore then.",
        "created_at": "2021-05-13T12:42:18.923000+00:00",
        "attachments": null
    },
    {
        "author": "terence0083",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "No i did not. I will do that in a bit",
        "created_at": "2021-05-13T12:42:31.567000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yeah that was a safe bet, I guess we'll see the deposits coming in in the next periods then",
        "created_at": "2021-05-13T12:43:09.757000+00:00",
        "attachments": null
    },
    {
        "author": "schone_wizard",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Guys sorry Iâ€™m out of the convo. Just had to pull an all nighter for work. Iâ€™ll be here later today",
        "created_at": "2021-05-13T12:50:53.069000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'd wait for deposits to get inducted and try to peer execution engines tomorrow, wdyt?",
        "created_at": "2021-05-13T14:13:29.211000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Voting hasn't gotten any better this period. Hopefully next one that starts soon:\n```\nVoting summary for slot: 7862\nVoting period starts:6144  ends:8192\n0x7a464c534f601c885b56fc2feac66a82c2d6fd5706cf76ec3e05cca3160949a2 : 257 (slot 4096)\n0xf936f4395596714b84f731c2aec62047547c77fecc786b71ce587c628f0e51a4 : 456  (genesis)\n0xcc33243c96e018d263eaa63e63a1fb162b5275f86eaf04dba7418edcd08994d8 : 556  (slot 3509)\n```",
        "created_at": "2021-05-13T14:14:59.322000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Just got my prysm-nethermind node back in sync after tweaking the `isEth1NodeSynced` function. Let's see if it's able to produce valid eth1 data votes. It's all due some weird race condition(s) between the sync and eth1-deposit services.",
        "created_at": "2021-05-13T14:15:29.625000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "btw, \u003c@!203220829473996800\u003e do you run your prysm nodes with `--contract-deployment-block 0`?",
        "created_at": "2021-05-13T14:17:45.028000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yes, since the start",
        "created_at": "2021-05-13T14:18:55.611000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!363800010518822915\u003e I'm in trouble, I'm stuck with my prysm node that can't propose. I submitted a bunch of deposits today, and whenever prysm wants to propose needs to send those deposits, but Catalyst complains of a bad block as in the message above and it doesn't allow the block to go through, This is on a vanilla merge as well. This shouldn't happen",
        "created_at": "2021-05-13T14:18:56.550000+00:00",
        "attachments": [
            {
                "type": "image/jpeg",
                "origin_name": "beac.jpg",
                "content": "4ec5d28f6613d33c34b71f2c199790edb41e2c3d9b44b2b2aea0448156eb9563"
            }
        ]
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "will not be able to look into this until very late tonight",
        "created_at": "2021-05-13T14:19:29.867000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So, Prysm asks Catalyst to assembled a block. And then this block is not accepted by the Catalyst instance that has assembled it?",
        "created_at": "2021-05-13T14:20:18.662000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yes",
        "created_at": "2021-05-13T14:20:31.732000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "alway the same error message:\n```\nWARN [05-13|10:49:36.281] Served consensus_newBlock                conn=127.0.0.1:57616 reqid=4356  t=12.546509ms err=\"invalid merkle root (remote: c83d75753f6fd3eccee45373b4cfb9f2a1c4cab7861b815445d40e61b49c0c1a local: 13fbad4f6e51fb0aed0fbc5943cdde7cd5514e1395a334ad190a2c5269b9ee62)\"\n```",
        "created_at": "2021-05-13T14:21:27.553000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Nothing in the beacon side",
        "created_at": "2021-05-13T14:21:32.825000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "and this block seems to be sent to the wire as well as I can see it in my logs",
        "created_at": "2021-05-13T14:21:36.199000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yeah the beacon is sending it fine and it is not being accepted by Catalyst",
        "created_at": "2021-05-13T14:22:23.762000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm running with the wrong setup with logs in the foreground so I'm loosing a lot of logs quickly from the validator/beacon. Will fix this later tonight by the end of the day",
        "created_at": "2021-05-13T14:23:11.452000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think if we peer the eth1 side this should be resolved hopefully",
        "created_at": "2021-05-13T14:25:09.646000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I would assume it would not be sent to the wire if execution engine didn't accept corresponding execution payload",
        "created_at": "2021-05-13T14:25:42.649000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yes the validator checks the block before sending it, I do not know what is going on. Even worse: I tried to do this purposedly and couldn't yet ðŸ˜“",
        "created_at": "2021-05-13T14:26:52.807000+00:00",
        "attachments": null
    },
    {
        "author": "terence0083",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!755590043632140352\u003e To recover, I think you can start fresh beacon node and catalyst. To debug and fix this issue live, i dont know how to do it yet",
        "created_at": "2021-05-13T14:29:54.310000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yeah, I'm worried if I do this you mean wiping all the dbases right? This should also clear the mempool of catalyst and then those deposits will be effectively gone right?",
        "created_at": "2021-05-13T14:30:49.566000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But whatever it is, this should not be happening, we should not send blocks we ourselves do not accept",
        "created_at": "2021-05-13T14:31:13.317000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I am also wondering what happens with Catalyst in this case",
        "created_at": "2021-05-13T14:31:50.459000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'll wait to see if I am proposing in the next couple of minutes before I bring my kid to daycare, to check the logs",
        "created_at": "2021-05-13T14:31:59.669000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "There's a chain reorg right after the next block is accepted",
        "created_at": "2021-05-13T14:32:15.980000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "do you have logs of this reorg? can you share them?",
        "created_at": "2021-05-13T14:38:10.799000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "To debug this weird case we would need to grab a trace of a block from Catalyst when it assembles block and compare it with the trace of block processing. Which sounds like nearly infeasible thing",
        "created_at": "2021-05-13T14:46:06.004000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Coming back from school, will send you the next one.",
        "created_at": "2021-05-13T15:01:52.799000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It would be much easier to read had I sent only one deposit :)",
        "created_at": "2021-05-13T15:02:17.213000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It could not appear if you did one",
        "created_at": "2021-05-13T15:02:44.708000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Could this have to do with my restarting the beacon node? Since the beacon is the only connection of Catalyst with the outside world, although  it's true that on resyncing, the beacon will send the application blocks to my Catalyst.",
        "created_at": "2021-05-13T15:05:17.217000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Voting is looking just as bad:\n```\nVoting summary for slot: 8247\nVoting period starts:8192  ends:10240\n0xa9dfb3183215750d5d04481e1dbb388f4d0fe4133410e74d44991a9acc75f358 : 10 (right vote: slot 6144)\n0xf936f4395596714b84f731c2aec62047547c77fecc786b71ce587c628f0e51a4 : 9 (genesis hash)\n0x334bbb2ccd45f1bd29cd2aa9f0a07eef37cffc152acb2a3b86ee2228aacb8935 : 18 (Who understands this one? block 5602)?\n```",
        "created_at": "2021-05-13T15:38:36.002000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!425572898787426305\u003e you are the first one int the period voting for that weird hash that wants to become a majority",
        "created_at": "2021-05-13T15:42:16.848000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "in block 8196",
        "created_at": "2021-05-13T15:42:28.434000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "is the Besu team running Teku or something else? seems Teku with all combinations is voting for that hash",
        "created_at": "2021-05-13T15:44:00.049000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Then after a majority is formed, it's hard to say",
        "created_at": "2021-05-13T15:44:51.680000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!203220829473996800\u003e \u003c@!425572898787426305\u003e This does look like a `SECONDS_PER_ETH1_BLOCK`  issue:\n```\n$ echo 5602*12/11  | bc\n6111\n```\nwhich is awfully close to 6144, can anyone confirm if Teku is not using 11 seconds instead of 12?",
        "created_at": "2021-05-13T16:07:07.481000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "all teku nodes regardless of eth1 client are voting for the hash at slot 5602",
        "created_at": "2021-05-13T16:07:31.403000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "that matches an 11 seconds setup",
        "created_at": "2021-05-13T16:07:37.304000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "hmmm, let me take a look",
        "created_at": "2021-05-13T16:17:08.892000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "so deposit data looks good in the vote, while the hash isn't",
        "created_at": "2021-05-13T16:23:08.312000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But deposit data is not that good of a measure cause deposits were really sporadic",
        "created_at": "2021-05-13T16:24:28.830000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm putting my money in the 11 seconds",
        "created_at": "2021-05-13T16:24:43.279000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "If that's the root, joining the two highest voted hashes will solve majority",
        "created_at": "2021-05-13T16:25:11.472000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "What do you get from `/eth/v1/config/spec`? That should list the active configuration, and it's `SECONDS_PER_ETH1_BLOCK: 12` for me",
        "created_at": "2021-05-13T16:32:15.420000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Here are the Catalyst logs and the validator log, I'm a bit surprised that you get these blocks, since the validator claimed it couldn't propose:\n```\n[2021-05-13 13:28:48] ERROR validator: Failed to propose block error=rpc error: code = Internal desc = Could not process beacon block: could not process block: invalid merkle root (remote: c83d75753f6fd3eccee45373b4cfb9f2a1c4cab7861b815445d40e61b49c0c1a local: 13fbad4f6e51fb0aed0fbc5943cdde7cd5514e1395a334ad190a2c5269b9ee62) pubKey=0xabf18d74ee18\n```\nhttps://gist.github.com/potuz/b8df0bacecd8bc347fd3a532d290e820",
        "created_at": "2021-05-13T16:36:41.729000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "it's 12 on my nodes",
        "created_at": "2021-05-13T16:37:12.244000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It's 12 here, as well, but that's what's stated in the config yaml as well. The question was if this was implemented within Teku correctly",
        "created_at": "2021-05-13T16:37:49.895000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yep",
        "created_at": "2021-05-13T16:38:01.710000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I am seeing this one in the trace of catalyst that is being run on my local machine",
        "created_at": "2021-05-13T16:38:36.741000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "voting for 5602 is a very odd hash to vote, and it would be a fine hash if the slots were 11 seconds",
        "created_at": "2021-05-13T16:38:40.739000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "could you please add logs of reorg that happens after this bad block",
        "created_at": "2021-05-13T16:39:17.350000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "oh yeah forgot to mention, no reorgs this time",
        "created_at": "2021-05-13T16:39:57.784000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I have different block numbers:\n```\nblock lighthouse: 4697, 0xa9dfb3183215750d5d04481e1dbb388f4d0fe4133410e74d44991a9acc75f358\nblock teku: 4288, 0x334bbb2ccd45f1bd29cd2aa9f0a07eef37cffc152acb2a3b86ee2228aacb8935\n```",
        "created_at": "2021-05-13T16:39:59.318000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "continues like so\n```\nINFO [05-13|13:29:00.597] Imported new chain segment               blocks=1 txs=0   mgas=0.000 elapsed=\"421.393Âµs\" mgasps=0.000   number=6614 hash=b2c6c1..65c6c1 dirty=23.48KiB\nINFO [05-13|13:29:24.162] Imported new chain segment               blocks=1 txs=0   mgas=0.000 elapsed=\"362.785Âµs\" mgasps=0.000   number=6615 hash=d07dbc..9fe637 dirty=23.48KiB\nINFO [05-13|13:29:36.213] Imported new chain segment               blocks=1 txs=0   mgas=0.000 elapsed=\"384.493Âµs\" mgasps=0.000   number=6616 hash=cf34f1..c43e1e dirty=23.48KiB\nINFO [05-13|13:29:48.132] Imported new chain segment               blocks=1 txs=0   mgas=0.000 elapsed=\"278.58Âµs\"  mgasps=0.000   number=6617 hash=cff6f8..35cb45 dirty=23.48KiB\nINFO [05-13|13:30:12.396] Imported new chain segment               blocks=1 txs=0   mgas=0.000 elapsed=\"270.752Âµs\" mgasps=0.000   number=6618 hash=a475cc..087b57 dirty=23.48KiB\nINFO [05-13|13:30:24.244] Imported new chain segment               blocks=1 txs=0   mgas=0.000 elapsed=\"313.785Âµs\" mgasps=0.000   number=6619 hash=d5d013..c21699 dirty=23.48KiB\nINFO [05-13|13:30:36.220] Imported new chain segment               blocks=1 txs=0   mgas=0.000 elapsed=\"304.864Âµs\" mgasps=0.000   number=6620 hash=79177d..e6cb9b dirty=23.48KiB\n```",
        "created_at": "2021-05-13T16:40:26.184000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Those seem valid hashes",
        "created_at": "2021-05-13T16:40:31.569000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "btw, eth1 block timestamps might not work correct for the voting process as we have missed slots and time diff between blocks isn't always a constant",
        "created_at": "2021-05-13T16:41:52.855000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "```\nVoting summary for slot: 8605\nVoting period starts:8192  ends:10240\n0xa9dfb3183215750d5d04481e1dbb388f4d0fe4133410e74d44991a9acc75f358 : 57 (6144)\n0xf936f4395596714b84f731c2aec62047547c77fecc786b71ce587c628f0e51a4 : 92   (genesis)\n0x334bbb2ccd45f1bd29cd2aa9f0a07eef37cffc152acb2a3b86ee2228aacb8935 : 140  (5602)\n```",
        "created_at": "2021-05-13T16:42:16.696000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I am posting the eth2 block that included them, not the eth1 height",
        "created_at": "2021-05-13T16:42:25.898000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "found the teku bug I think: https://github.com/txrx-research/teku/blob/8b2d8fa7e6021de2fa360e391304d7b4258c9510/pow/src/main/java/tech/pegasys/teku/pow/api/Eth1DataCachePeriodCalculator.java#L35",
        "created_at": "2021-05-13T16:42:25.948000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It's loading the `SECONDS_PER_ETH1_BLOCK` from a deprecated global static variable, that is set to 14, and doesn't seem to be changed anywhere in the codebase",
        "created_at": "2021-05-13T16:43:15.856000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "great work Proto!",
        "created_at": "2021-05-13T16:45:06.653000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "let me make a fix",
        "created_at": "2021-05-13T16:45:25.264000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "nice!",
        "created_at": "2021-05-13T16:46:08.375000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "At least, I think that's it. It's not the `11` we were looking for though",
        "created_at": "2021-05-13T16:46:11.650000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "it's fine because then you need to multiply the eth1 block number",
        "created_at": "2021-05-13T16:46:32.469000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "hmm still doesn't match",
        "created_at": "2021-05-13T16:47:07.271000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ðŸ˜¦",
        "created_at": "2021-05-13T16:47:08.662000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ahh, and with missed blocks it then makes sense that it's higher than 12, not lower",
        "created_at": "2021-05-13T16:47:14.079000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Actually, it reads block by time frames, right? that are computed with this 12 seconds and these frames should match slot timestamps.",
        "created_at": "2021-05-13T16:48:21.343000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I mean, it doesn't count eth1 block numbers but their timestamps instead",
        "created_at": "2021-05-13T16:48:50.392000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "and if we have 2048 or 1024 blocks between in the time frames it doesn't matter much except for the follow distance that is off in this case but we're ok with that",
        "created_at": "2021-05-13T16:49:56.864000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The `14` might just be some default. It uses reflection to quietly overwrite the constants based on the config file",
        "created_at": "2021-05-13T16:51:23.760000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "there's another in line 45, but that's irrelevant if they are overwritten",
        "created_at": "2021-05-13T16:52:09.586000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "yep, digging into this",
        "created_at": "2021-05-13T16:52:09.797000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "ok, so I don't think I can provide more info about the catalyst problem I am facing so perhaps the best is if I wipe out the dbases and resync prysm",
        "created_at": "2021-05-13T16:54:12.115000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "will try to reboot so that I can block that peer that is bugging my logs",
        "created_at": "2021-05-13T16:54:33.738000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "sure, go ahead!",
        "created_at": "2021-05-13T16:55:41.058000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "checked in debug mode, it's set to `12` by reflection mechanism",
        "created_at": "2021-05-13T17:08:16.514000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I am looking at my local teku instance which has `0xa9dfb3183215750d5d04481e1dbb388f4d0fe4133410e74d44991a9acc75f358` as the default vote meaning that this is the most relevant vote by timestamp. While it votes for `0x334bbb2ccd45f1bd29cd2aa9f0a07eef37cffc152acb2a3b86ee2228aacb8935` because it already has more votes ðŸ¤” . But at slot `8196` that was not the case, more votes was for the first block",
        "created_at": "2021-05-13T17:59:25.068000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "exactly, this was my comment: you started this\nhttps://discord.com/channels/595666850260713488/826479341784662056/842426532383162409",
        "created_at": "2021-05-13T18:00:33.278000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "It's not an issue with timeframes on Teku side as `0xa9dfb3...` block is at the upper boundary of this voting period and Teku has it among votes to consider",
        "created_at": "2021-05-13T18:17:33.715000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yes so the real question is why your node decided to vote for `0x334bbb2...` in the first place and since the very few votes when there wasn't a majority still, show Teku paired with the three Eth1 clients, I believe this one is on Teku",
        "created_at": "2021-05-13T18:22:07.383000+00:00",
        "attachments": null
    },
    {
        "author": "m.kalinin",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I believe so. Because Proto's teku+besu and teku+nethermind both voted for this block while votes for this block was less than for the correct one when teku+nethermind was proposing",
        "created_at": "2021-05-13T18:24:32.634000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Explorer may be down for a bit, doing some maintenance",
        "created_at": "2021-05-13T18:48:22.576000+00:00",
        "attachments": null
    },
    {
        "author": "tersec",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "some brief downtime on the nimbus nodes soon, doing maintenance. Goal is to address the failure to propose when the same node gets two or more proposals in a row.",
        "created_at": "2021-05-13T18:50:54.882000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Just to add confirmation that the deposits are indeed seen as valid by the node: resyncing prysm I found the log messages\n```\n[2021-05-13 16:08:46] DEBUG powchain: Deposit registered from deposit contract eth1Block=3213 merkleTreeIndex=266 publicKey=0xa63b46430fbb5fec68a2c1d95963a335c41fb8ed782924b7c54a38312c29423c1c42e23ff32d8b165e09fd81c9ad0c7b\n```",
        "created_at": "2021-05-13T19:09:41.763000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!363800010518822915\u003e prysm-k8s are still voting on the genesis hash, I think they should only do that if they got the `--contract-deployment-block 0` missing. Notice that if you had been running without this flag you need to wipe both ETH1 and ETH2 dbases an run again since you will have the entire deposit trie wrong",
        "created_at": "2021-05-13T20:43:04.195000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "This applies to \u003c@!203220829473996800\u003e  as well, who may have been running catalyst before he added the flag cause your `prysm geth`  nodes are voting for the genesis hash as well. Not the Besu ones, but i do not know if this is because of Besu or prysm",
        "created_at": "2021-05-13T20:44:44.752000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "One more, validator exits are processed correctly",
        "created_at": "2021-05-13T20:56:54.921000+00:00",
        "attachments": null
    },
    {
        "author": "dkdkdkdkdkdk",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "have you tried slashing?",
        "created_at": "2021-05-13T21:05:06.422000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I haven't yet, but I have already set the keys for it. I want to see one thing at a time ðŸ™‚ We probably want to check deposits and understand if there's a bug about eth1 data tracking that is relevant for the merge. After all, majority is still an important part. I also managed to get my validator to submit a bad block, so I can test that as soon as we get validators onboarded",
        "created_at": "2021-05-13T21:08:05.756000+00:00",
        "attachments": null
    },
    {
        "author": "terence0083",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I did apply the flag but didnt wipe the databases. Must be it then, I will fix this in 30 mins",
        "created_at": "2021-05-13T21:51:14.698000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I already applied the flag, and resynced prysm nodes multiple times since. If you still see votes for bad data from the prysm nodes, then there is a different bug",
        "created_at": "2021-05-13T22:07:58.060000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We'll find out now since the prysm k8s were consistently voting for the genesis hash. Mine is voting for the right hash, even after resyncing.",
        "created_at": "2021-05-13T22:36:34.534000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Oh crap, prysm is still voting on the genesis hash ðŸ˜¦ https://nocturne.rayonism.io/block/10371",
        "created_at": "2021-05-13T22:38:26.790000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Why isn't mine voting for it?",
        "created_at": "2021-05-13T22:39:11.203000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And we are divided again into three hashes:\n```\n$ python ~/votes.py \nVoting summary for slot: 10396\nVoting period starts:10240  ends:12288\n0xf936f4395596714b84f731c2aec62047547c77fecc786b71ce587c628f0e51a4 : 36   (genesis)\n0xf7825c6a12b9f59184630ae79b7bd5d58c5a65e2cfbfb7349a14a3661212016b : 24    (eth2 block: 8192, eth1 block: 6332)\n0xe128aa0184a6027bab05a2aef8f28b07a9431f5d73a63a3915dd334cb18defe9 : 57     (eth2 block: 7674, eth1 block: 5916)\n```",
        "created_at": "2021-05-13T22:44:38.910000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "and again is Teku voting first for the previous hash: https://nocturne.rayonism.io/block/10248",
        "created_at": "2021-05-13T22:47:03.026000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That's the first block that included it, when there were already a few blocks voting for the right hash",
        "created_at": "2021-05-13T22:47:28.825000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!755590043632140352\u003e thanks for the relentless debugging of this issue, I hope we find it, but also remember that it's a prototype, and an issue that we might never see in prysm outside of rayonism.",
        "created_at": "2021-05-13T22:48:13.984000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Understood, but there are a few issues here: I'm kind of convinced there's a bug in Teku's choosing of the eth1 data. Will try to read Java here tonight (although I had sworn never ever to read Java a few years back ðŸ™‚ ), and then there's the mistery why prysm is still voting for the genesis hash which is surprising: it took me a few days to find about the deployment block issue on my own local testnet and that immediately solved it.",
        "created_at": "2021-05-13T22:50:10.773000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Great, I appreciate that, let me know how I can help debugging, and we can open a group with Terence/Mikhail to focus on this. At the same time, it's time to focus on the next things soon, and I am sure your debugging help is more valuable for the next client updates (Altair, Merge transition, sharding)",
        "created_at": "2021-05-13T23:00:04.032000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Just realized that I leaked my name and the fact that I'm an alcoholic and named my laptop \"rye\"  in this Discord ðŸ˜„",
        "created_at": "2021-05-13T23:15:05.013000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That `rye kernel` looked odd indeed, haaa",
        "created_at": "2021-05-13T23:22:21.745000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "So if I understand correctly Teku's actually caching logs for the last 20 hours, it's a huge over calculation",
        "created_at": "2021-05-13T23:24:43.571000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We only start retrieving logs once they reach the follow distance, so from follow distance back to start of voting period would be about 20 hours I think.",
        "created_at": "2021-05-13T23:26:42.755000+00:00",
        "attachments": null
    },
    {
        "author": "protolambda",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "`2048*2*14 seconds = ~16 hours`",
        "created_at": "2021-05-13T23:27:12.738000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "In the very worst of possible scenarios is 16 hours",
        "created_at": "2021-05-13T23:27:18.703000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "which is 2 follow distances",
        "created_at": "2021-05-13T23:27:25.897000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "and should be less than the computation being made there:\n```\n$ echo 12 + 64*32*12 + 12*2048 + 32*12 + 2048*12 | bc\n74124\n```",
        "created_at": "2021-05-13T23:27:57.395000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That' s the number of seconds that's being returned from `calculateEth1DataCacheDurationPriorToCurrentTime`",
        "created_at": "2021-05-13T23:28:26.764000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "which is about 20.6 hours",
        "created_at": "2021-05-13T23:28:32.239000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I mean it shouldn't make any difference",
        "created_at": "2021-05-13T23:29:05.539000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but it's counting the worst on top of the worst ðŸ™‚",
        "created_at": "2021-05-13T23:29:21.790000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "hmm, I haven't looked at that code for quite a while so not sure how all the logic fits together.",
        "created_at": "2021-05-13T23:29:55.800000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think you are counting there 2*follow distance plus a voting period",
        "created_at": "2021-05-13T23:30:49.998000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "essentially",
        "created_at": "2021-05-13T23:30:53.037000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "but the size of that cache seems to be irrelevant to the issue at hand, my own node is voting incorrectly and it seems that I can run it with a lot of pretty detailed logs, so I may find it even without knowing the code.",
        "created_at": "2021-05-13T23:32:24.710000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I'm going to log a ticket for later I think.  That part of the spec is just not going to fit into my head again this morning. ðŸ™‚",
        "created_at": "2021-05-13T23:37:53.324000+00:00",
        "attachments": null
    }
]