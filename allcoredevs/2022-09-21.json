[
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "Timestamps are the only sane way for  an EL+CL combined upgrade, imo\n\nFor EL only upgrades, blocks are fine but timestamp will be more precise in forecasting and because the functionality has to be there for EL+CL, I'd just suggest all EL forks are on timestamp from here out",
        "created_at": "2022-09-21T03:09:24.856000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "general",
        "parent": "",
        "content": "Working with timestamp related consensus methods like AuRa I would say anything but timestamp please",
        "created_at": "2022-09-21T11:28:47.816000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "general",
        "parent": "",
        "content": "If we need to fork CL+EL I would say CL should be driving it some way, so built it in engine API",
        "created_at": "2022-09-21T11:29:35.503000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "general",
        "parent": "",
        "content": "Maybe build in some versioning into block header itself?",
        "created_at": "2022-09-21T11:33:45.737000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Interesting… Why is timestamp so different to block number? \nThe CL effectively does it in timestamp since that’s what drives slots and epochs and it’s not an issue.",
        "created_at": "2022-09-21T11:36:04.632000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "general",
        "parent": "",
        "content": "Or keep it as block number on EL and CL can adjust to it? (EL blocknumber dictates the fork)",
        "created_at": "2022-09-21T11:38:09.608000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "general",
        "parent": "",
        "content": "I've always found timestamps unreliable",
        "created_at": "2022-09-21T11:42:45.061000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "Time stamps post merge are always fixed to slots so not at all unpredictable. \n\nIt would cause a lot of chaos for the CL to try and fork in the middle of an epoch.",
        "created_at": "2022-09-21T11:45:21.793000+00:00",
        "attachments": null
    },
    {
        "author": "ralexstokes",
        "category": "general",
        "parent": "",
        "content": "another withdrawals update: \n\ni've updated the engine API spec PR here and this should be stable enough to use for implementation: https://github.com/ethereum/execution-apis/pull/195\n\nthere is a general open question around presentation of the specification, how different variants of each method map to which forks, etc -- please chime in on that PR if you have anything to add there",
        "created_at": "2022-09-21T13:11:17.270000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Can we fork on odd number timestamps?  Just to remove the \u003e= vs \u003e complexity.",
        "created_at": "2022-09-21T13:16:28.165000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "For EL this means first block produced after time X, and for CL it would be first slot after time X.",
        "created_at": "2022-09-21T13:17:29.859000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "I have trouble imagining in the ethereum pos system how this could cause any issue. Timestamps as \u003c@340345049063882753\u003e mentioned are a fundamental component of the protocol and validated as such.\n\nwhat is unreliable about timestamps in AuRa?",
        "created_at": "2022-09-21T13:40:45.735000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "general",
        "parent": "",
        "content": "It's not unusual for local node time to drift a lot from the network without mitigation strategies. Maybe it's not big deal in one time upgrades though.",
        "created_at": "2022-09-21T16:31:19.127000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003cdankrad\u003e The beacon chain already assumes synchronized clocks.",
        "created_at": "2022-09-21T16:33:04.092000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "This is time wrt the timestamp in the message\n\nIf your clock drifts, you might be delayed incorporating such a message in your view, but once you do, it will still trigger the upgrade\n\nyou aren't using your local clock to trigger the upgrade. the datastructure of the blockchain progresses in 12-second time intervals (similar to how the blockchain progresses in height). thus you are doing this upgrade trigger on the blockchain datastructure timestamps on those branches. rather than just changing your node's logic when your local clock hits a time",
        "created_at": "2022-09-21T16:35:44.232000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "general",
        "parent": "",
        "content": "For clarity, when CL devs use the term \"timestamp\" you effectively mean the epoch/slot number? For example the Bellatrix fork happened at \"timestamp\" `Epoch(144896)`?  If you local clock is off a couple seconds, and you received the first block of epoch 144896 before `Sept 6, 2022, 11:34:47am UTC` localtime, you'd still enable the fork logic on that epoch/slot, right?",
        "created_at": "2022-09-21T19:55:00.716000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "The fork logic is enabled at blocks at that slot/epoch. Local clock is used to decide when to important an stuff but it's logic at a certain time height in the block tree\n\nEpoch is the number we spec in but epochs are just an abstraction on top of timestamp\n\nWe say timestamp here because EL doesn't know about slots or epoch abstractions but does know about time (which has slot correctness validations from CL)",
        "created_at": "2022-09-21T20:35:56.111000+00:00",
        "attachments": null
    },
    {
        "author": "ajsutton",
        "category": "general",
        "parent": "",
        "content": "No because then it wouldn’t align with the epoch transition. It will always be \u003e= because the upgrade timestamp will be the epoch start time (as Danny mentioned in the CL it will just be the epoch number). The equals part will be tested heavily because absent an empty slot the block timestamp will be equal to the upgrade time since they have to be set to the slot start time.",
        "created_at": "2022-09-21T21:11:31.770000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "Still I'm a little puzzled how this works for forks where the EL/CL pair is on different machines with different clocks if the EL is to assume only timestamp and not be triggered by the CL",
        "created_at": "2022-09-21T21:58:46.963000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "I'm unsure I understand the question. For all branches in the block tree, if a block meets or exceeds the timestamp, EL applies the new rules",
        "created_at": "2022-09-21T21:59:41.330000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "(same as with block-height but now with timestamp)",
        "created_at": "2022-09-21T21:59:55.499000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "important note -- EL payloads have timestamps. also EL validates that timestamps strictly increase in their block tree (even independent of CL timestamp correctness validations)",
        "created_at": "2022-09-21T22:02:43.677000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "the problem I see is if the EL is being fed a block that is deemed in the new fork given the CL's clock already advanced the clock, but the clock of the EL is drifted and doesn't think the new logic applies. But I see what you mean perhaps in this case the pair is not functioning anyway because either the CL or the EL would be failing the timestamp check on the payloads",
        "created_at": "2022-09-21T22:05:14.981000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctimbeiko\u003e Does the EL actually need a \"clock\" though?",
        "created_at": "2022-09-21T22:05:49.369000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "general",
        "parent": "",
        "content": "\u003ctimbeiko\u003e Can't it 100% rely on the CL and treat the timestamp as a \"block\"?",
        "created_at": "2022-09-21T22:06:01.031000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "also important to note that unlike the merge where we only wanted the upgrade to happen on one branch, this can happen on any and all branches",
        "created_at": "2022-09-21T22:06:02.463000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I don't see how since the CL does not give it a slot number",
        "created_at": "2022-09-21T22:07:01.024000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "I think what Danny's saying is that it can trust the payload timestamp",
        "created_at": "2022-09-21T22:07:23.165000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "and not base in its clock",
        "created_at": "2022-09-21T22:07:36.046000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "it's okay if on branch A, the EVM logic changes and on branch B, it hasn't yet",
        "created_at": "2022-09-21T22:07:40.575000+00:00",
        "attachments": null
    },
    {
        "author": "potuz",
        "category": "general",
        "parent": "",
        "content": "That is fine since in each branch the payload timestamp has to be coherent within the slot timestamp. Yeah I think I understood, sorry for the noise",
        "created_at": "2022-09-21T22:08:47.446000+00:00",
        "attachments": null
    }
]