[
    {
        "author": "sunce86.",
        "category": "general",
        "parent": "",
        "content": "\u003c@\u0026595684226221735986\u003e has stopped on block #10679538 on ropsten. \nError is: Block import failed for #10679538 (0x1252ï¿½ï¿½ï¿½25f1)\nError: Error(Execution(NotEnoughCash { required: 1840000000000000, got: 1556899999118000 })\n\nIn our codebase this error is raised here:\n```\nlet balance = self.state.balance(\u0026sender)?;\nlet gas_cost_effective = t\n            .tx()\n            .gas\n            .full_mul(t.effective_gas_price(self.info.base_fee));\nlet gas_cost_max = t.tx().gas.full_mul(t.tx().gas_price);\nlet needed_balance = U512::from(t.tx().value) + gas_cost_max;\n\n// avoid unaffordable transactions\nlet balance512 = U512::from(balance);\nif balance512 \u003c needed_balance {\n   return Err(ExecutionError::NotEnoughCash {\n        required: needed_balance,\n        got: balance512,\n});\n}\n```",
        "created_at": "2021-07-21T14:03:02.647000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "general",
        "parent": "",
        "content": "Can other clients check their logic?",
        "created_at": "2021-07-21T14:03:11.847000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "Do you have a trace of that block?",
        "created_at": "2021-07-21T14:03:57.681000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "(Or anyone else ðŸ˜„?)",
        "created_at": "2021-07-21T14:04:05.669000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "general",
        "parent": "",
        "content": "Here is a full trace.",
        "created_at": "2021-07-21T14:04:43.560000+00:00",
        "attachments": [
            {
                "type": "text/plain; charset=utf-8",
                "origin_name": "20120721-openethereum-ropsten-issue.log",
                "content": "dbb212d88cd0d30cc7f2db07119b0f89243044adb3e25ef8261b7181a5cf52e1"
            }
        ]
    },
    {
        "author": "mariusvanderwijden",
        "category": "general",
        "parent": "",
        "content": "\u003c@\u0026652918665943056397\u003e Are you forked off too?",
        "created_at": "2021-07-21T14:16:23.066000+00:00",
        "attachments": null
    },
    {
        "author": "matkt0",
        "category": "general",
        "parent": "",
        "content": "The same for Besu on the same block",
        "created_at": "2021-07-21T14:36:10.722000+00:00",
        "attachments": null
    },
    {
        "author": "matkt0",
        "category": "general",
        "parent": "",
        "content": "on this transaction https://ropsten.etherscan.io/tx/0xdfa858a98cab341e540fc2da8abfd0b298df22a9ee9eff0c6e1edf4828ab9b84 with this issue \"transaction up-front cost exceeds transaction sender account balance\",",
        "created_at": "2021-07-21T14:36:53.963000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "general",
        "parent": "",
        "content": "I think Nethermind is using effective_gas_price instead of maxFeePerGas (as oe, geth, besu):\nhttps://github.com/NethermindEth/nethermind/blob/d9cf10afc27a9aead4413b3aed94d54bb66c73e7/src/Nethermind/Nethermind.Evm/TransactionProcessor.cs#L176",
        "created_at": "2021-07-21T14:40:39.984000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "general",
        "parent": "",
        "content": "If miner is on Nethermind node that would explain the fork?",
        "created_at": "2021-07-21T14:41:02.659000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "Itâ€™s more likely the miner is Geth, no? Iâ€™m not aware that Nethermind supports PoW. Can we see in the extraData of the block?",
        "created_at": "2021-07-21T14:47:23.008000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "general",
        "parent": "",
        "content": "```\n\u003e eth.getBlock(\"0x1252a34c4f2b061adc609e909d958c02e1ac39043e2e60c0ec47e565e3f625f1\")\n{\n  baseFeePerGas: 11,\n  difficulty: 1124214874,\n  extraData: \"0xd883010a05846765746888676f312e31352e36856c696e7578\",\n  gasLimit: 8000000,\n  gasUsed: 1762587,\n  hash: \"0x1252a34c4f2b061adc609e909d958c02e1ac39043e2e60c0ec47e565e3f625f1\",\n  logsBloom: \"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\",\n  miner: \"0xfbb61b8b98a59fbc4bd79c23212addbefaeb289f\",\n  mixHash: \"0x178c542ebd5b730aa141b3e07fce663b81d7f5485011cca55b5cd55dc39b2550\",\n  nonce: \"0x98728302c513a677\",\n  number: 10679538,\n  parentHash: \"0xe936ee0e5a915b9c163a7a1ff67269dd5f1ccb981f91b269a2130711e6a62598\",\n  receiptsRoot: \"0x09a6eb2bf38000dd934b2cdc66f7f7923397ddd6d9cd1ac69379aaed73d00f1e\",\n  sha3Uncles: \"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347\",\n  size: 5175,\nstateRoot: \"0xa942f7462d923a5e292627b64e1b20cc314bac31f7e72ecb02b65d954d12f758\",\n  timestamp: 1626863988,\n  totalDifficulty: 34224959923696599,\n  transactions: [\"0x07ca8f5634d634e2eb67a9af6f9d510d73d3c2f0393f0e0490e7c0b4c18fdf0e\", \"0x9dbef6da5331b085d1dcc70eaa028376fd0452c49992e5ddccc132f4d42467cc\", \"0xdfa858a98cab341e540fc2da8abfd0b298df22a9ee9eff0c6e1edf4828ab9b84\", \"0x01bdfaba318f4c0b2878db0d413a20d3a2669ebbaa5c4e8f6901bdc9a01a99ec\", \"0xd9d2aa19f747b04863eb13a2698cd8a3c96b2463d2cf7eb60d7ca3ea8e2d45e3\", \"0xf5ee17e9bf8bc4fe3325860d91535d1eb98bc1d83f39fe998e0b6c4706c581c5\"],\ntransactionsRoot: \"0x6e6f39318ad2e60969e2422977deffd42dc34ac7bdbb6fb1934541c044f18774\",\nuncles: []\n}\n```",
        "created_at": "2021-07-21T14:49:29.230000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "general",
        "parent": "",
        "content": "Nethermind is not mining at ropsten",
        "created_at": "2021-07-21T14:50:48.517000+00:00",
        "attachments": null
    },
    {
        "author": "matkt0",
        "category": "general",
        "parent": "",
        "content": "so regarding the extra data is geth : gethË†go1.15.6â€¦linux",
        "created_at": "2021-07-21T14:51:20.994000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "general",
        "parent": "",
        "content": "This might be misleading, but kept there for old-naming as there are legacy tx's, actual calculation is here: https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.Core/TransactionExtensions.cs#L58-L61",
        "created_at": "2021-07-21T14:52:18.821000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "So it seems that Geth mined the block and both OE and Besu reject it, but I assume there are only Geth miners on Ropsten so the network is not progressing? Could this be checked by spinning up a Besu miner (which would re-org Ropsten if true)?",
        "created_at": "2021-07-21T14:54:39.624000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "general",
        "parent": "",
        "content": "My chain is progressing, so geth is just continuing the chain",
        "created_at": "2021-07-21T14:55:07.708000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "Yeah, and I donâ€™t think other clients are still mining Ropsten",
        "created_at": "2021-07-21T14:55:29.257000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "Besu was around the fork, but it likely isnâ€™t anymore?",
        "created_at": "2021-07-21T14:55:48.746000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "general",
        "parent": "",
        "content": "Nethermind accepted the block",
        "created_at": "2021-07-21T14:56:43.618000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "general",
        "parent": "",
        "content": "",
        "created_at": "2021-07-21T14:57:14.957000+00:00",
        "attachments": [
            {
                "type": "image/png",
                "origin_name": "unknown.png",
                "content": "f6abed158baebc7cd4ff8e9fa1f7ba09bc23d49251bc10da0da931cfd377eec5"
            }
        ]
    },
    {
        "author": "matkt0",
        "category": "general",
        "parent": "",
        "content": "Yes we are not mining",
        "created_at": "2021-07-21T14:57:35.147000+00:00",
        "attachments": null
    },
    {
        "author": "matkt0",
        "category": "general",
        "parent": "",
        "content": "I can restart the miner",
        "created_at": "2021-07-21T14:57:43.444000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "So Nethermind + Geth agree and OE + Besu disagree ?",
        "created_at": "2021-07-21T14:57:45.762000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "Iâ€™m not sure if this will help or not yet.",
        "created_at": "2021-07-21T14:58:16.393000+00:00",
        "attachments": null
    },
    {
        "author": "pietjepuk",
        "category": "general",
        "parent": "",
        "content": "Wasn't there a discussion a few months back on whether it should be `maxFeePerGas * gasLimit` or `effectiveGasPrice * gasLimit`? (the criterion of rejecting a tx for insufficient funds that is)",
        "created_at": "2021-07-21T14:59:47.808000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "general",
        "parent": "",
        "content": "It was a discussion on a tx pool level as i remember...",
        "created_at": "2021-07-21T15:01:06.469000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "This was added to the spec: https://github.com/ethereum/EIPs/pull/3594/files",
        "created_at": "2021-07-21T15:03:56.965000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "Specifically: \n```\nassert transaction.max_fee_per_gas \u003e= transaction.max_priority_fee_per_gas      # The total must be the larger of the two\nassert sender.balance \u003e= gasLimit * transaction.max_fee_per_gas\n```",
        "created_at": "2021-07-21T15:04:40.734000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "general",
        "parent": "",
        "content": "OE does \n```\nassert sender.balance \u003e= transaction.value + gasLimit * transaction.max_fee_per_gas\n```",
        "created_at": "2021-07-21T15:07:19.460000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "general",
        "parent": "",
        "content": "Yeah I think that's the problem",
        "created_at": "2021-07-21T15:08:17.268000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "general",
        "parent": "",
        "content": "We substract the value after checking the assertions, which means that the value is not part of the assert",
        "created_at": "2021-07-21T15:08:46.005000+00:00",
        "attachments": null
    },
    {
        "author": "vorot93",
        "category": "general",
        "parent": "",
        "content": "but this is invalid tx in any case, no?",
        "created_at": "2021-07-21T15:10:43.519000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "general",
        "parent": "",
        "content": "\u003c@!439883507406340126\u003e you actually linked to older version, this is newest in Nethermind: https://github.com/NethermindEth/nethermind/blob/a6e7a02a6c02fbea8c5f3b7a7cf5d033d2650433/src/Nethermind/Nethermind.Evm/TransactionProcessing/TransactionProcessor.cs#L215-L225",
        "created_at": "2021-07-21T15:12:03.449000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad3303",
        "category": "general",
        "parent": "",
        "content": "yes, this is invalid for insufficient funds. here is the sender:  https://ropsten.etherscan.io/address/0xcba9f09e7e6b4a41a9d11f347416b75ee100344f",
        "created_at": "2021-07-21T15:13:42.941000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "Funny how we have not caught this situation earlier, it seems a situation which should be rather common, right?",
        "created_at": "2021-07-21T15:26:09.321000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "general",
        "parent": "",
        "content": "It's weird because even before 1559 changes this assert existed as \n ```\nassert sender.balance \u003e= transaction.value + gasLimit * transaction.gas_price\n```\nat least in OE",
        "created_at": "2021-07-21T15:39:18.553000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "general",
        "parent": "",
        "content": "I think the assert was not required before a new constraint was introduced in Calaveras",
        "created_at": "2021-07-21T15:41:03.705000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "general",
        "parent": "",
        "content": "Before 1559 we checked basically had the following flow:\n```\nassert sender.balance \u003e= gasLimit * transaction.gas_price\nsender.balance -= gasLimit * transaction.gas_price\nassert sender.balance \u003e= transaction.value\nsender.balance -= transaction.value\n```\nThis flow is broken by 1559 though, since we need to assert with the gasFeeCap not the effectiveGas.",
        "created_at": "2021-07-21T15:43:01.885000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "general",
        "parent": "",
        "content": "We have a PR to fix it: https://github.com/ethereum/go-ethereum/pull/23244/files",
        "created_at": "2021-07-21T15:43:19.534000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "general",
        "parent": "",
        "content": "https://github.com/ledgerwatch/erigon/pull/2415",
        "created_at": "2021-07-21T15:46:16.626000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "general",
        "parent": "",
        "content": "Now the question is - what do we do with Ropsten?",
        "created_at": "2021-07-21T15:48:46.296000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "general",
        "parent": "",
        "content": "do we reorg it?",
        "created_at": "2021-07-21T15:49:00.209000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "I think we should? If Besu can mine?",
        "created_at": "2021-07-21T15:50:32.099000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "general",
        "parent": "",
        "content": "or perhaps we do double-HF like with Petersbourg",
        "created_at": "2021-07-21T15:50:36.202000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "If we do that, won't clients who followed the spec be unable to sync past the bad block which Geth allowed?",
        "created_at": "2021-07-21T15:51:06.125000+00:00",
        "attachments": null
    },
    {
        "author": "Deleted User",
        "category": "general",
        "parent": "",
        "content": "I would prefer if we reorged all the testnets, but this requires some work",
        "created_at": "2021-07-21T15:51:56.406000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "Well, this hasn't been triggered on other networks yet, right?",
        "created_at": "2021-07-21T15:52:24.484000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "(Maybe Rinkeby...?)",
        "created_at": "2021-07-21T15:52:30.409000+00:00",
        "attachments": null
    },
    {
        "author": "_shemnon",
        "category": "general",
        "parent": "",
        "content": "For Constantinople/Petersburg all clients agreed on the outcome, so a fix HF does not apply to this situation.",
        "created_at": "2021-07-21T15:52:31.804000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "general",
        "parent": "",
        "content": "We would need to reorg 10,680,803 - 10679537  so roughly 1000 blocks",
        "created_at": "2021-07-21T15:54:07.167000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "general",
        "parent": "",
        "content": "Testnets have seen worse imo",
        "created_at": "2021-07-21T15:54:24.416000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "Yeah, I think we should do it for Ropsten. We just need to spin up extra miners. How quickly does the difficulty adjust?",
        "created_at": "2021-07-21T15:54:50.932000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "Also, we should make sure to reach out to all Geth-based Goerli validators to make sure they update ASAP after the patch.",
        "created_at": "2021-07-21T15:55:16.632000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "general",
        "parent": "",
        "content": "I have a cpu miner running on ropsten now, don't know how difficult it is rn though",
        "created_at": "2021-07-21T16:01:04.839000+00:00",
        "attachments": null
    },
    {
        "author": "matkt0",
        "category": "general",
        "parent": "",
        "content": "I also restarted the Besu Miner",
        "created_at": "2021-07-21T16:02:06.995000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "\u003c@!680337202521440470\u003e is the Besu miner mining from block 10679537?",
        "created_at": "2021-07-21T16:02:42.008000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "Just need to be sure we're extending the right chain ðŸ˜…",
        "created_at": "2021-07-21T16:02:49.126000+00:00",
        "attachments": null
    },
    {
        "author": "matkt0",
        "category": "general",
        "parent": "",
        "content": "yes from this block ðŸ˜„",
        "created_at": "2021-07-21T16:03:10.056000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "general",
        "parent": "",
        "content": "Have a gpu miner running now, can you dm me your enode \u003c@!680337202521440470\u003e ?",
        "created_at": "2021-07-21T16:07:05.719000+00:00",
        "attachments": null
    },
    {
        "author": "mariusvanderwijden",
        "category": "general",
        "parent": "",
        "content": "Already found 3 blocks",
        "created_at": "2021-07-21T16:07:39.440000+00:00",
        "attachments": null
    },
    {
        "author": "matkt0",
        "category": "general",
        "parent": "",
        "content": "yes",
        "created_at": "2021-07-21T16:23:08.848000+00:00",
        "attachments": null
    },
    {
        "author": "jochembrouwer",
        "category": "general",
        "parent": "",
        "content": "FYI, JS also has this bug.",
        "created_at": "2021-07-21T16:43:40.168000+00:00",
        "attachments": null
    },
    {
        "author": "tkstanczak",
        "category": "general",
        "parent": "",
        "content": "I know that Neth team was on it, I am available now, do we need anybody else from Nethermind now?",
        "created_at": "2021-07-21T16:46:23.247000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad3303",
        "category": "general",
        "parent": "",
        "content": "Do we keep a collective document of consensus issues? I was making sure we have test coverage to make sure Besu is checking for this one, and now I'm wondering what other consensus issues have we found and fixed...",
        "created_at": "2021-07-21T17:07:55.085000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "We've had some post-mortems yes, see: https://github.com/ethereum/eth1.0-specs/blob/master/network-upgrades/retrospectives/berlin.md as an example",
        "created_at": "2021-07-21T17:09:36.633000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "I can create a similar one for this afterwards.",
        "created_at": "2021-07-21T17:09:49.967000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "general",
        "parent": "",
        "content": "Most importantly, these things should be turned into reference tests. I've added a repro example to our fix-PR, at https://github.com/ethereum/go-ethereum/pull/23244, which can easily be turned into a statetest",
        "created_at": "2021-07-21T17:10:55.810000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad3303",
        "category": "general",
        "parent": "",
        "content": "yes, next suggestion was going to be to add them to Hive",
        "created_at": "2021-07-21T17:11:32.900000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "general",
        "parent": "",
        "content": "Can't really add it to hive though ðŸ˜¦",
        "created_at": "2021-07-21T17:11:47.012000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "general",
        "parent": "",
        "content": "In general, when the testcase needs to demonstrate that a tx is _rejected_, blockchain tests doesn't work. Because then we'd have to add an invalid block to the blocktest, and see that the client rejects it. And normally. we can't generate a \"valid invalid\" block, so it's usually impossible to construct a block and know _why_ it was rejected, if the tx is invalid. \n\nIn this particular instance, it would be possible though, since we know exactly what fault we want to trigger, and what kind of invalidness we want to catch",
        "created_at": "2021-07-21T17:13:49.433000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "general",
        "parent": "",
        "content": "But statetests are the only ones that can _generally_ test scenarios of the type: have a state, try to apply tx `A`, see that it is rejected.",
        "created_at": "2021-07-21T17:14:47.180000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "general",
        "parent": "",
        "content": "(and hive is just a blackbox way to run blockchain tests, not statetests)",
        "created_at": "2021-07-21T17:15:28.180000+00:00",
        "attachments": null
    },
    {
        "author": "robocopsgonemad3303",
        "category": "general",
        "parent": "",
        "content": "makes sense, thanks for clarifying",
        "created_at": "2021-07-21T17:16:15.635000+00:00",
        "attachments": null
    },
    {
        "author": "sunce86.",
        "category": "general",
        "parent": "",
        "content": "This issue seems like the perfect one for unit test to cover (IMO)",
        "created_at": "2021-07-21T17:18:59.962000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "general",
        "parent": "",
        "content": "fix in Nethermind: https://github.com/NethermindEth/nethermind/pull/3238\n\nI think the confusing part was: https://github.com/ethereum/EIPs/commit/ee7053ead7fb730a3f9178e7c7ad9e1b8cf3ee6c#diff-c7a67afc8ee3b0ff2a29ddb3cecd13fe0ce30f3c96def22f117456987f6a50a2\n\nwhile just a tad above: signer.balance -= transaction.amount\nconfusing way to write an assert on just modified value, on same object\n\nso if someone looked at recent spec changes he will miss that this is not the base sender.balance, but already modified one",
        "created_at": "2021-07-21T17:57:45.465000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "Should we rename the fields in the EIP to make it clearer? i.e. use something like \n```\nsigner.effectiveBalance = signer.balance - transaction.amount\n[...]\nassert sender.effectiveBalance \u003e= gasLimit * transaction.max_fee_per_gas\n``` \nAlternatively, we can maybe move both statements closer to one another in the EIP?",
        "created_at": "2021-07-21T18:03:45.514000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "We already have another `assert` right below the update to the balance, so it may make sense to move that last one up there as well?",
        "created_at": "2021-07-21T18:04:25.030000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "general",
        "parent": "",
        "content": "so in order not to underflow our checks are:\nassert sender.balance \u003e= gasLimit * transaction.max_fee_per_gas + transaction.amount",
        "created_at": "2021-07-21T18:11:35.132000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "general",
        "parent": "",
        "content": "and I think asserts like that would be clearer on non-modified state",
        "created_at": "2021-07-21T18:11:55.779000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "general",
        "parent": "",
        "content": "So assert before excexution",
        "created_at": "2021-07-21T18:13:40.130000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I'm just tuning in, but those asserts linked https://discord.com/channels/595666850260713488/745077610685661265/867465389000097803 are on unmodified state aren't they?",
        "created_at": "2021-07-21T18:21:58.833000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "At least, they are before deduction of fees or execution of transaction I believe?",
        "created_at": "2021-07-21T18:22:24.123000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Oh, it isn't... you are right.",
        "created_at": "2021-07-21T18:22:56.903000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Hmm, I tend to agree.",
        "created_at": "2021-07-21T18:23:02.028000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Exception for asserts like the one immediately after `signer.balance -= transaciton.amount` I think, which is basically asserting an invariant after a specific execution.",
        "created_at": "2021-07-21T18:23:35.956000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I support adjusting and moving those asserts above the state mutation for clarity.  I suspect it was just overlooked that they came after balance mutation.",
        "created_at": "2021-07-21T18:25:43.566000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "WIP postmortem: https://notes.ethereum.org/@timbeiko/ropsten-postmortem",
        "created_at": "2021-07-21T18:31:06.492000+00:00",
        "attachments": null
    },
    {
        "author": "ryanleeschneider",
        "category": "general",
        "parent": "",
        "content": "Do we have an ETA of geth and nethermind releases with the fix?",
        "created_at": "2021-07-21T19:26:08.025000+00:00",
        "attachments": null
    },
    {
        "author": "lukaszrozmej",
        "category": "general",
        "parent": "",
        "content": "tomorrow",
        "created_at": "2021-07-21T21:04:59.028000+00:00",
        "attachments": null
    }
]