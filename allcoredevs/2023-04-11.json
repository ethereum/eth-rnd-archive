[
    {
        "author": "chfast",
        "category": "general",
        "parent": "",
        "content": "Does withdrawal processing touch the given accounts before block finalization? https://eips.ethereum.org/EIPS/eip-4895#state-transition",
        "created_at": "2023-04-11T15:55:41.388000+00:00",
        "attachments": null
    },
    {
        "author": "djrtwo",
        "category": "general",
        "parent": "",
        "content": "yes",
        "created_at": "2023-04-11T16:06:51.138000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "general",
        "parent": "",
        "content": "I'm discussing this in more details in \u003c#753271902520213625\u003e but: \n\n1. it is specified than the withdrawal amount cannot be 0. I assume EL should reject such withdrawal submission (and this is tested).\n2. There are execution tests with withdrawal amount 0. And the EIP does not specify if this mean an account is touched or not.",
        "created_at": "2023-04-11T20:03:57.859000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "withdrawals are processed after user transactions and there is no distinction between whether the account was already touched or not -- and since they're processed after, it wouldn't be observable by the gas rules that the account was touched",
        "created_at": "2023-04-11T20:05:36.763000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "general",
        "parent": "",
        "content": "Clearing empty touched accounts also happens after user transactions so you can argue that an 0 withdrawal is a touch and such account should be removed if empty.",
        "created_at": "2023-04-11T20:08:16.138000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "~~I see, so I would say that the spec is ambiguous in the fact that it operates on the state _after_ all user related operations complete, including clearing empty accounts?~~ actually i think this is wrong",
        "created_at": "2023-04-11T20:17:10.615000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "the state clearing does happen after the withdrawals are added, so i think you are correct",
        "created_at": "2023-04-11T20:20:22.669000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "general",
        "parent": "",
        "content": "hm... seems that YP defines empty account clearing as a part of individual transaction execution. So in theory this is fine, but clearing empty accounts after all transactions is valid implementation so far.",
        "created_at": "2023-04-11T20:20:53.954000+00:00",
        "attachments": null
    },
    {
        "author": "peter.davies",
        "category": "general",
        "parent": "",
        "content": "EELS implements that a zero value withdrawal is a touch that clears empty accounts.",
        "created_at": "2023-04-11T20:26:54.108000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "general",
        "parent": "",
        "content": "Oh boy, this is so fucked up. Even block reward application is implemented as a touch although YP says otherwise.",
        "created_at": "2023-04-11T20:28:07.888000+00:00",
        "attachments": null
    },
    {
        "author": "peter.davies",
        "category": "general",
        "parent": "",
        "content": "Every single empty account has been deleted on Mainnet. No other testnet still in use has ever had empty accounts. The issue is entirely academic.",
        "created_at": "2023-04-11T20:29:40.305000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "general",
        "parent": "",
        "content": "Sure, but I'd like to be able to implement this correctly based on any spec. Not by asking random people on discord how they implemented this.",
        "created_at": "2023-04-11T20:31:29.757000+00:00",
        "attachments": null
    },
    {
        "author": "peter.davies",
        "category": "general",
        "parent": "",
        "content": "Would you be satisfied if we had an EIP in Final state that said \"Empty accounts are not allowed on post-merge networks, the post-merge state transition function is not defined for pre-states that contain them\"? I'd much rather do that have to hash out academic questions about empty accounts every time a new potential touch is introduced.",
        "created_at": "2023-04-11T20:36:28.263000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "general",
        "parent": "",
        "content": "I only care about it because tests do test it.",
        "created_at": "2023-04-11T20:37:51.282000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "general",
        "parent": "",
        "content": "Sounds like good idea although these usually end at this stage. Do you volunteer to write the EIP?",
        "created_at": "2023-04-11T20:47:06.417000+00:00",
        "attachments": null
    },
    {
        "author": "peter.davies",
        "category": "general",
        "parent": "",
        "content": "I actually wrote one before, but it is way over-complicated by the fact it tries to identify every unused edgecase of state clearing rather than just saying \"no empty accounts on post-merge networks\". http://eips.ethereum.org/EIPS/eip-4747",
        "created_at": "2023-04-11T20:50:23.627000+00:00",
        "attachments": null
    },
    {
        "author": "peter.davies",
        "category": "general",
        "parent": "",
        "content": "I will rewrite EIP 4747 to remove the excess.",
        "created_at": "2023-04-11T20:50:55.641000+00:00",
        "attachments": null
    }
]