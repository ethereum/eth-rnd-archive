[
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "So what is the progress on 2930? Seems like it's worth prioritizing?",
        "created_at": "2020-12-01T08:43:01.433000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "general",
        "parent": "",
        "content": "Yes I think so. I think the 2930 EIP is going to get some update from \u003c@!301186049323958275\u003e to clarify the last parts(?).",
        "created_at": "2020-12-01T08:51:04.873000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "general",
        "parent": "",
        "content": "See also typed-transactions for some discussion",
        "created_at": "2020-12-01T08:51:42.033000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Current debate is on whether to split the signature out or not.  Care to play tie breaker on that \u003c@!273808422753796097\u003e?  ðŸ˜¬",
        "created_at": "2020-12-01T08:51:44.179000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "general",
        "parent": "",
        "content": "exactly^",
        "created_at": "2020-12-01T08:51:50.861000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "What's the latest writeup on the distinction?",
        "created_at": "2020-12-01T08:52:07.513000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I get the impression that neither Martin nor I is willing to die on the hill, but we both have a preference that differs.",
        "created_at": "2020-12-01T08:52:07.693000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "Or can you quickly write out the RLP or SSZ or whatever for both formats?",
        "created_at": "2020-12-01T08:52:17.706000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "RLP is decided.",
        "created_at": "2020-12-01T08:52:24.294000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "ok",
        "created_at": "2020-12-01T08:52:36.287000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Sec, let me grab a link or copy/paste...",
        "created_at": "2020-12-01T08:52:42.306000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "general",
        "parent": "",
        "content": "I'll roll with either, I just had a slight preference to stay with the \"closes to status quo\", but that needn't be taken to seriously",
        "created_at": "2020-12-01T08:53:22.564000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "```py\n# RLP multi-pass\n1 || rlp([chainId, nonce, gasPrice, gasLimit, to, value, data, access_list, sendrV, senderR, senderS])\n# RLP single-pass\n1 || rlp([[senderV, senderR, senderS], rlp([1, chainId, nonce, gasPrice, gasLimit, to, value, data, access_list])])\n```\nRLP Multi-Pass\n    Advantages\n        No data duplication\n    Disadvantages\n        Requires an RLP encoder to validate\n        Validation has decode-split-encode-validate flow\n\nRLP Single-Pass\n    Advantages\n        Can validate signature without needing an RLP encoder\n        Supports decode-validate flow\n    Disadvantages\n        Duplicates the transaction type byte\n        Have to call rlp decode twice when encoding/decoding (outer and then inner)",
        "created_at": "2020-12-01T08:53:47.449000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Can swap signature and transaction payload order if desired, doesn't really make a big difference.",
        "created_at": "2020-12-01T08:55:10.624000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "The arguments in favor and against each are pretty minor, so really we just need to make a call.",
        "created_at": "2020-12-01T08:55:24.780000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "Any reason why the signature is at the front and not the end for single-pass?",
        "created_at": "2020-12-01T08:58:19.890000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "No.",
        "created_at": "2020-12-01T08:58:27.464000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "However, you still need to duplicate the byte to get the advantages of splitting.",
        "created_at": "2020-12-01T08:58:34.270000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "My instinct says at the end feels more natural ðŸ˜†",
        "created_at": "2020-12-01T08:58:44.299000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "right I see",
        "created_at": "2020-12-01T08:58:50.344000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "```py\n1 || rlp([rlp([1, chainId, nonce, gasPrice, gasLimit, to, value, data, access_list]), [senderV, senderR, senderS]])\n```",
        "created_at": "2020-12-01T08:59:06.443000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "Single-pass looks uglier in the short term but less ugly in the long term",
        "created_at": "2020-12-01T08:59:40.228000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "That said, in the long term we may want to replace RLP anyway",
        "created_at": "2020-12-01T08:59:52.024000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Yeah, I *think* we generally have buy-in from ACD on moving to SSZ long term.",
        "created_at": "2020-12-01T09:00:13.657000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Just not \"before Berlin\".",
        "created_at": "2020-12-01T09:00:19.838000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "right",
        "created_at": "2020-12-01T09:00:22.867000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Given that, whatever we do will *probably* be replaced at some point.",
        "created_at": "2020-12-01T09:00:31.440000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "The \"normal way\" to do this for SSZ data structures is (i) signature at the end, (ii) DON'T duplicate the 1 byte; when signing, the algorithm is explicitly to sign hash(root(signing_data) + domain) instead of hashing signing_root directly",
        "created_at": "2020-12-01T09:01:09.339000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "That creates some other complexities.  ðŸ˜¢",
        "created_at": "2020-12-01T09:01:24.603000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "like what?",
        "created_at": "2020-12-01T09:01:31.196000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "In particular, the way the transaction handling code is most likely to be written is to strip off the first byte for discrimination on type and then pass the *remaining* bytes to some processing function.",
        "created_at": "2020-12-01T09:01:58.289000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "oh no ðŸ˜¢",
        "created_at": "2020-12-01T09:02:07.992000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "hmm",
        "created_at": "2020-12-01T09:02:45.141000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Also, that wouldn't be a valid SSZ payload I think.",
        "created_at": "2020-12-01T09:02:49.775000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "Honestly pretty much all ways of handling typed data with multiple options for the type are horrible",
        "created_at": "2020-12-01T09:02:58.672000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "I am inclined to say do multi-pass because it's better for the short term, and then we can rip everything up and make \"one transaction type to rule them all\" later?",
        "created_at": "2020-12-01T09:03:48.085000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "```py\n1 || chainId || nonce || gasPrice || gasLimit || to || value || data_pointer || access_list_pointer || data || access_list || yParity || r || s\n```",
        "created_at": "2020-12-01T09:03:56.823000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Note in particular that the variable width data is in the *middle* of the payload here.",
        "created_at": "2020-12-01T09:04:10.530000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "If you move the variable width data to the end so it is a valid SSZ payload, then you no longer have a contiguous chunk to sign over (because the signature breaks it apart).",
        "created_at": "2020-12-01T09:04:27.680000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "right I see",
        "created_at": "2020-12-01T09:04:40.244000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "If the signature is in the front, and you duplicate the type byte, then you can get SSZ for the whole thing, plus fixed width items all up front (fixed position) which makes for easy plucking, plus contiguous signed data.",
        "created_at": "2020-12-01T09:05:26.869000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I accept the tie breaker.  ðŸ™‚",
        "created_at": "2020-12-01T09:05:54.570000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Last question for 2930 then is whether we switch over to `yParity` instead of `v` for the signature.",
        "created_at": "2020-12-01T09:06:11.466000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "oh fun",
        "created_at": "2020-12-01T09:06:18.217000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "Because the `v` is an ugly mix of yParity and chainid at the moment?",
        "created_at": "2020-12-01T09:06:29.383000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "And some Bitcoin cruft too.  ðŸ™‚",
        "created_at": "2020-12-01T09:06:37.903000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "The argument for yParity is, it's \"theoretically more correct\", the argument for v is, it fits into the ECRECOVER precompile better?",
        "created_at": "2020-12-01T09:06:53.829000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "As someone who has written a transaction validator/signer, I am pretty confident in saying that `yParity` will be much easier for *new* tooling.  `v` is easier for *existing* tooling (especially Bitcoin tooling).",
        "created_at": "2020-12-01T09:07:37.478000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "I'm inclined to lean slightly toward `yParity`",
        "created_at": "2020-12-01T09:07:50.967000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I would *like* to one day get to a place where we are using `yParity` everywhere, as I do think it results in cleaner code that is easier to understand and harder to get wrong.  But at the moment many tools bake the `+28` stuff into the signing library, rather than the encoding library.  ðŸ˜–",
        "created_at": "2020-12-01T09:08:36.233000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "Existing tooling will have to do new work to support the signing data anyway; doing `ecrecover(get_sig_hash(tx), (yParity + 27, r, s))` will not be hard for them",
        "created_at": "2020-12-01T09:08:42.784000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Like there are `secp256k1` libraries that spits out a `v` value (`yParity + 27`), rather than a `yParity` boolean.",
        "created_at": "2020-12-01T09:08:52.508000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "Isn't it + 27? Or am I misremembering?",
        "created_at": "2020-12-01T09:09:35.438000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Oh, maybe.",
        "created_at": "2020-12-01T09:09:38.816000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "(27, 28) are what I recall the original possible v values being",
        "created_at": "2020-12-01T09:09:45.523000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "It is a magic number so I routinely get it wrong.  ðŸ˜›",
        "created_at": "2020-12-01T09:09:47.216000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "Well ok originally it was (27, 28, 29, 30) but then I made the decision to ban (29, 30) because it's a dumb edge case that only occurs 1/2**128 of the time",
        "created_at": "2020-12-01T09:10:08.077000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "ah bitcoin",
        "created_at": "2020-12-01T09:10:20.985000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "ok I lean slightly toward yParity",
        "created_at": "2020-12-01T09:10:42.456000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Testing this particular edge case is quite difficult.  ðŸ™‚",
        "created_at": "2020-12-01T09:11:04.300000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Back when I was figuring all of this stuff out I wasted some time trying to find a test case for 29/30.  I eventually realized that such a test case probably doesn't exist and won't ever exist.  ðŸ˜¬",
        "created_at": "2020-12-01T09:11:36.939000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "Also RLP itself was originally inspired by bitcoin encoding being incredibly stupid and arbitrary (gaaaaah why are some things varints and other things ints, and what the heck is DER, and do I need to worry about negative numbers??!)",
        "created_at": "2020-12-01T09:12:06.153000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "\"As soon as you can write a test for this, you have far bigger problems than anything a test will solve.\"",
        "created_at": "2020-12-01T09:12:17.673000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "ðŸ˜†",
        "created_at": "2020-12-01T09:12:25.687000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "\u003c@!211091239112671234\u003e Do you have anything against `yParity` instead of `v` for 2930?  If not I'll get a PR together to update with both changes.",
        "created_at": "2020-12-01T09:13:00.472000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "If so, we should discuss further.  ðŸ™‚",
        "created_at": "2020-12-01T09:13:06.792000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "Watching the shadow of bitcoin slowly recede from ethereum is interesting. Today is a major milestone on that road in fact, but it exists in the small as well as the large",
        "created_at": "2020-12-01T09:14:27.776000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "Arguably we're not quite out of the shadow until we move beyond ECDSA itself",
        "created_at": "2020-12-01T09:14:42.678000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "At least Ethereum's codebase isn't a Bitcoin fork like a lot of projects (e.g., ZCash).",
        "created_at": "2020-12-01T09:15:00.523000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "ZCash has a *very* long road to get away from its Bitcoin roots.",
        "created_at": "2020-12-01T09:15:12.596000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "indeed",
        "created_at": "2020-12-01T09:15:18.814000+00:00",
        "attachments": null
    },
    {
        "author": "ethdreamer",
        "category": "general",
        "parent": "",
        "content": "\u003c@273808422753796097\u003e I just wanna say hi and I'm really glad ethereum exists. Thanks for everything :D",
        "created_at": "2020-12-01T09:16:48.706000+00:00",
        "attachments": null
    },
    {
        "author": "fridgemagnet5882",
        "category": "general",
        "parent": "",
        "content": "Glad to be with you on the journey \u003c@!273808422753796097\u003e",
        "created_at": "2020-12-01T09:17:07.883000+00:00",
        "attachments": null
    },
    {
        "author": "holiman",
        "category": "general",
        "parent": "",
        "content": "Nope",
        "created_at": "2020-12-01T12:54:56.785000+00:00",
        "attachments": null
    },
    {
        "author": "shamatar",
        "category": "general",
        "parent": "",
        "content": "\u003c@!301186049323958275\u003e in # RLP multi-pass how do you defined hash that is signed? Replace V/R/S with zeroes (or chain id), hash and sign?",
        "created_at": "2020-12-01T13:57:56.634000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "The signing hash would be the hash of the RLP of the entire data structure but popping the last three items representing the signature, and prepending the transaction type: `rlp([1, chainId, nonce, gasPrice, gasLimit, to, value, data, access_list])`.",
        "created_at": "2020-12-01T13:58:52.301000+00:00",
        "attachments": null
    },
    {
        "author": "shamatar",
        "category": "general",
        "parent": "",
        "content": "Ok, thank you",
        "created_at": "2020-12-01T14:02:21.933000+00:00",
        "attachments": null
    },
    {
        "author": "timbeiko",
        "category": "general",
        "parent": "",
        "content": "Cross-posting here: Tim Roughgarden just published a report analyzing EIP-1559, and a TL;DR on Twitter: https://twitter.com/algo_class/status/1333828688916439041",
        "created_at": "2020-12-01T17:48:49.958000+00:00",
        "attachments": null
    }
]