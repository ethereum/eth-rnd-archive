[
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "What are people's general feelings about sponsored transactions?  They add a little bit of complexity to the pending pool logic as the nonce comes from account A while the gas money comes from account B.  If the temperature is generally warm, then I would like to push for their inclusion (maybe London).",
        "created_at": "2021-02-23T03:53:24.612000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Perhaps an important question is whether or not sponsored transactions are *useful* without batch transactions?  Batch transactions add more complexity and may be more contentious.",
        "created_at": "2021-02-23T04:05:00.257000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Maybe Rich Transactions + Sponsored Transactions is a more viable alternative?",
        "created_at": "2021-02-23T04:06:29.448000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "I think i prefer 3074 for sponsored + batch transactions now",
        "created_at": "2021-02-23T04:06:49.197000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "https://eips.ethereum.org/EIPS/eip-3074",
        "created_at": "2021-02-23T04:07:11.567000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Is that the one that creates a precompile that accepts an Ethereum transaction as input and will then execute it in a nested context?",
        "created_at": "2021-02-23T04:08:06.808000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "i think it accepts a slightly different signed format, but yes",
        "created_at": "2021-02-23T04:08:32.824000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "my thinking is that adding a new tx type for sponsored txs is not worth it unless relayers can bundle together txs from multiple users and pay all at once",
        "created_at": "2021-02-23T04:09:40.779000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I'm still not particularly sold on that argument.  The gas savings for bundling *should* be negligible at best.",
        "created_at": "2021-02-23T04:10:11.488000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "amortizing the intrinsic cost across the batch should be a significant saving?",
        "created_at": "2021-02-23T04:11:02.217000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "All you are really saving is a cold read of the sponsor's balance per transaction in the collection.",
        "created_at": "2021-02-23T04:11:06.266000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "e.g. a relayer with 10 txs from different accounts that are all transfers could relay them all for 210k gas or could batch them together for `21k + 10*2k + 10*5k= ~90k gas` (forgot sig verification)",
        "created_at": "2021-02-23T04:11:51.450000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Only if we misprice things I think.  ðŸ™‚",
        "created_at": "2021-02-23T04:12:09.463000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "You have to do 10 signature checks, 10 account reads (nonce + balance), 10 more account reads (balance + codehash), 20 balance writes.",
        "created_at": "2021-02-23T04:13:34.219000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "The difference between batched and unbatched is that you do 1 instead of 10 sponsor signature checks, 1 instead of 10 account reads (balance), 1 instead of 10 balance updates.",
        "created_at": "2021-02-23T04:14:20.478000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "sponsored vs. non-sponsored batches?",
        "created_at": "2021-02-23T04:15:08.440000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Fixed.",
        "created_at": "2021-02-23T04:16:51.929000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Rough totals:\nsignature checks: 11 vs 20\naccount reads: 21 vs 30\naccount writes: 21 vs 30",
        "created_at": "2021-02-23T04:18:35.921000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "So I would expect around a 30% cost decrease for batching.",
        "created_at": "2021-02-23T04:18:56.490000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Maybe a *tiny* bit more for saving bytes on the wire and in block bodies.",
        "created_at": "2021-02-23T04:19:06.943000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Sponsored Transactions + EVM Executed Transactions + Rich Transactions?",
        "created_at": "2021-02-23T04:19:49.204000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "What are your thoughts on 3074? I believe it supports both use cases that we want",
        "created_at": "2021-02-23T04:19:53.239000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I'm pretty warm on it (EVM Executed Transactions).",
        "created_at": "2021-02-23T04:21:13.532000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "The idea is that it means we don't need sponsors at all?",
        "created_at": "2021-02-23T04:21:34.182000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Because they can be implemented in the form of EVM Executed Transactions?",
        "created_at": "2021-02-23T04:21:49.370000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "sponsors would pay for the outer tx which would directly call the precompile or call a contract to process a batch, individually calling the precompile",
        "created_at": "2021-02-23T04:22:11.351000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I'm not a big fan of the nonce magic stuff.",
        "created_at": "2021-02-23T04:23:39.897000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I'm not currently convinced that sponsee invalidating their nonce is a problem we need to solve in layer 1.",
        "created_at": "2021-02-23T04:24:13.664000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "what do you think of removing the nonce completely and rely on the caller of the precompile to handle replay protection?",
        "created_at": "2021-02-23T04:24:50.281000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "How would a caller deal with replay protection such that the sponsee doesn't need to trust the sponsor?",
        "created_at": "2021-02-23T04:25:28.630000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "if the sponsor uses a standardized contract that does a nonce check and increment, then the sponsee is safe",
        "created_at": "2021-02-23T04:26:18.180000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "the cool thing is it opens the door for different nonce mechanisms, like parallel nonces - the downside is it opens the door for bugs in the replay protection",
        "created_at": "2021-02-23T04:26:49.613000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "The sponsee doesn't have a view into *who* called them though?",
        "created_at": "2021-02-23T04:26:57.206000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "So some *other* contract could replay the sponsee's transaction later.",
        "created_at": "2021-02-23T04:27:17.559000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "sorry, the sponsee would need to sign over the invoker of the precompile",
        "created_at": "2021-02-23T04:28:32.739000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Oh, it looks like they already do (I missed that).",
        "created_at": "2021-02-23T04:29:00.184000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I feel like we should use a transaction type number here and follow 2718 signature scheme.  That way we don't have to worry about the signature colliding with some other future transaction.",
        "created_at": "2021-02-23T04:30:15.431000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "general",
        "parent": "",
        "content": "seems reasonable",
        "created_at": "2021-02-23T04:30:47.185000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "So we would drop the nonce from the signed data and the `CALL_PRECOMPILE` arguments?",
        "created_at": "2021-02-23T04:33:56.130000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "And leave it up to the invoker to do nonce management?",
        "created_at": "2021-02-23T04:34:11.796000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "That makes me a *much* bigger fan of the change.",
        "created_at": "2021-02-23T04:34:42.351000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "cc \u003c@689161464829050960\u003e",
        "created_at": "2021-02-23T04:34:48.819000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Hmm, does the transaction need a `chainId`?",
        "created_at": "2021-02-23T04:44:15.337000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I think it might...",
        "created_at": "2021-02-23T04:44:30.266000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Is there a way to guarantee that a contract only exists on one chain?",
        "created_at": "2021-02-23T04:44:59.776000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I think you could achieve this via CREATE2 with CHAIN_ID as the salt?",
        "created_at": "2021-02-23T04:45:43.637000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Removal of nonce and chainID *does* mean that only explicitly trusted invokers can be used.  This either means a contract (fine) or a trusted human.  You cannot be sponsored by a human you don't explicitly trust to not replay you.",
        "created_at": "2021-02-23T04:49:22.484000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I think I'm okay with this, what are your thoughts \u003c@543900561460822016\u003e?",
        "created_at": "2021-02-23T04:49:37.014000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Why do we have a signature over gas limit?",
        "created_at": "2021-02-23T04:51:49.097000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Was it just because we didn't want the sponsor to be able to nonce bump without actually executing the transaction?",
        "created_at": "2021-02-23T04:52:38.400000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Or is this to support the situation where someone wants to be able to differentiate differentiate between an internal call failing because it didn't execute properly and an internal call not being supplied enough gas by the caller?",
        "created_at": "2021-02-23T04:54:09.910000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I think \u003c@619357961923330051\u003e has argued for stuff like that in the past, but I still don't fully grok the use case.",
        "created_at": "2021-02-23T04:54:27.158000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "https://github.com/quilt/EIPs/blob/eip-3074-replay-party/EIPS/eip-3074.md\n\n^ version without nonces",
        "created_at": "2021-02-23T05:02:47.068000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Why is `nextra` required?",
        "created_at": "2021-02-23T05:03:20.607000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "It might not be ðŸ˜› I haven't finished thinking through it. My thinking was that if the signature doesn't contain the nonce, an attacker could replay it and trick the sponsoring contract. If you sign over `nextra`, the contract can still implement replay protection.",
        "created_at": "2021-02-23T05:04:25.927000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I don't think it is necessary.  The invoker contract can just track \"used signatures\".",
        "created_at": "2021-02-23T05:05:16.877000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "If you don't sign over the minimum gas limit, the sponsor could make your inner transaction fail by setting a low gas price, while still consuming your nonce.",
        "created_at": "2021-02-23T05:05:48.691000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I suppose that is a bit more space inefficient though.",
        "created_at": "2021-02-23T05:05:50.637000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "This is only a problem if nonces are used.  ðŸ˜„",
        "created_at": "2021-02-23T05:06:07.329000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "I thought you could transform one ecdsa signature into another valid one.",
        "created_at": "2021-02-23T05:06:08.638000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "You can hand craft valid ECDSA signatures, but you don't know what they sign over *or* you don't know what account they were signed with in advance.",
        "created_at": "2021-02-23T05:07:11.393000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I want to remove `nextra`, `gaslimit`, `chainid` and leave it up to the invoker to deal with those.  I would like someone to convince me otherwise.  ðŸ˜„",
        "created_at": "2021-02-23T05:08:53.861000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "I'm preeeeetty sure that you can transform an ecdsa signature into another valid ecdsa signature over the same data",
        "created_at": "2021-02-23T05:09:30.111000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "ECDSA malleability",
        "created_at": "2021-02-23T05:09:42.842000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I thought Ethereum solved that by only supporting one of the two points on the curve?",
        "created_at": "2021-02-23T05:10:02.244000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "https://github.com/Zoltu/ethereum-crypto/blob/ac297681be5fd6a77b97f074a333883dc052c45a/library/source/secp256k1.ts#L114-L116",
        "created_at": "2021-02-23T05:10:43.244000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "The recover precompile accepts both, apparently",
        "created_at": "2021-02-23T05:10:48.732000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Or did at one time",
        "created_at": "2021-02-23T05:10:52.257000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Hmm...",
        "created_at": "2021-02-23T05:11:01.573000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "https://github.com/ethereum/EIPs/blob/master/EIPS/eip-2.md",
        "created_at": "2021-02-23T05:11:08.416000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "So not a problem.  ðŸ™‚",
        "created_at": "2021-02-23T05:11:26.587000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "So for this precompile, you'd reject signatures with s greater than some curve-dependent value?",
        "created_at": "2021-02-23T05:13:43.214000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "And have the sponsor contract just track signature hashes?",
        "created_at": "2021-02-23T05:14:14.759000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "That seems horrible for state growth ðŸ˜‰",
        "created_at": "2021-02-23T05:14:35.601000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "And you want to remove chainid because a trusted contract would be written in a way so that it can't be deployed at the same address on different chains? What if the contract was deployed before the fork?",
        "created_at": "2021-02-23T05:16:32.845000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "In Ethereum (as of homestead) such transactions are invalid.  We wouldn't break that invariant here.",
        "created_at": "2021-02-23T05:17:15.157000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Probably worth mentioning in the security considerations section, but I don't think we need to state it in the specification section itself, just like we don't need to redefine secp256k1 in this spec.  ðŸ™‚",
        "created_at": "2021-02-23T05:17:48.904000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Transactions are invalid, but ecrecovers wouldn't be.",
        "created_at": "2021-02-23T05:18:01.481000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I think we can safely assume that all secp256k1 implementations in Ethereum follow the same set of rules.",
        "created_at": "2021-02-23T05:18:03.325000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Hmm, you are saying that EIP-2 didn't fix ecrecover?",
        "created_at": "2021-02-23T05:18:18.011000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "It explicitly left it untouched",
        "created_at": "2021-02-23T05:18:31.738000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "https://github.com/ethereum/go-ethereum/blob/3ecfdccd9a0065365a00e7c8b60de7ee2df4e40b/core/vm/contracts.go#L164",
        "created_at": "2021-02-23T05:19:12.286000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "1a. Create EIP to make `ecrecover` reject transactions with a large `s`\n1b. Specify that `s` cannot be greater than `secp256k1n/2`.\n2. sign over `nextra` but don't pass it to `CALL_PRECOMPILE`.\n3. Remove `gaslimit`\n4. Remove `chainid`",
        "created_at": "2021-02-23T05:20:52.787000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "A contract deployed today could be constrained to one chain.",
        "created_at": "2021-02-23T05:21:16.858000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Any contract handling these will almost certainly need to be coded *specifically* for handling them, which can include cross-chain protections like a `CREATE2` with `CHAINID` salt.",
        "created_at": "2021-02-23T05:21:40.295000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Right, but if you had an ethereum cash (or 1559 fork) scenario",
        "created_at": "2021-02-23T05:22:58.255000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Or the contract would check chain id and fail...",
        "created_at": "2021-02-23T05:23:25.616000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Hm, yeah, that could work.",
        "created_at": "2021-02-23T05:23:29.698000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I have long argued that every hard fork should change the chain ID...",
        "created_at": "2021-02-23T05:23:31.651000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Even if it did, the contract would remain at the same address.",
        "created_at": "2021-02-23T05:23:45.735000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "But yeah, the contract can check `CHAIN_ID` before execution.",
        "created_at": "2021-02-23T05:23:47.793000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "So you would need to redeploy on the fork with the new `CHAIN_ID`.",
        "created_at": "2021-02-23T05:24:03.857000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "You could even have a factory you go through so the process is somewhat automated if desired.",
        "created_at": "2021-02-23T05:24:20.547000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Yeah, I suppose you could remove chain id. I'm not a huge fan of removing it, but it is doable.\n\nI still don't think removing `nextra` is efficient, and removing gas limit would be griefable",
        "created_at": "2021-02-23T05:26:04.292000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "We should keep `nextra` in the signature, but not in the call.",
        "created_at": "2021-02-23T05:26:41.386000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "How would you check the signature without it?",
        "created_at": "2021-02-23T05:26:57.481000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I would like to better understand the use case where gas limit is griefable.",
        "created_at": "2021-02-23T05:27:03.677000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Oh, I see why it has to be part of the call.  OK, my bad.",
        "created_at": "2021-02-23T05:27:33.678000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Hmm, means we also would need `gas` (along with `gaslimit`) if we retain that.",
        "created_at": "2021-02-23T05:28:22.558000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Why would you need gas?",
        "created_at": "2021-02-23T05:29:02.984000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I have a weak preference for re-ordering things so the variable length data is at the end:\n```\ncallprecompile(yParity, r, s, nextra, gaslimit, invoker, gas, to, value, dataoffset, datalength)\n```",
        "created_at": "2021-02-23T05:29:10.445000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Oh!  I see my mistake in thinking!",
        "created_at": "2021-02-23T05:29:30.247000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Say you have a sponsor that receives an ERC-20 in exchange for ETH to pay for gas.\n\nThe invoker contract takes enough ERC-20 to cover the limit plus a fee for the sponsor.\n\nThe sponsor sets the transaction-like package's gas limit to some tiny value.\n\nThe inner transaction never completes, but the sponsor gets the fee.",
        "created_at": "2021-02-23T05:35:50.160000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Feels like that can be solved by trusting the sponsors contract code (same as the chainID and nonce protection stuff).",
        "created_at": "2021-02-23T05:36:40.948000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "The invoker contract can't tell if the sponsor lied about the gas limit unless it's signed.",
        "created_at": "2021-02-23T05:37:23.087000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I mean that you don't give a transaction to a sponsor whose *contract* you don't trust.",
        "created_at": "2021-02-23T05:37:41.478000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "And the contract is what is dishing out gas to calls.",
        "created_at": "2021-02-23T05:37:49.089000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "I think I, as a sponsee, would want to set my gas limit, no?",
        "created_at": "2021-02-23T05:38:11.325000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Since we have no nonces, if your transaction fails it was like it never was included in the chain.",
        "created_at": "2021-02-23T05:39:04.577000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "You are essentially delegating gas limits to the sponsor, which has a slightly better visibility into gas needs anyway.",
        "created_at": "2021-02-23T05:39:29.282000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "In this example, is the idea that the sponsee would approve the sponsor to withdraw ERC-20 tokens from them?",
        "created_at": "2021-02-23T05:41:07.534000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "I think that's how it would work.",
        "created_at": "2021-02-23T05:41:21.695000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "And the sponsor in this example may be batching multiple transactions together, and giving each a different amount of gas (so the sponsee cannot grief the sponsor)?",
        "created_at": "2021-02-23T05:41:45.628000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "I'm not sure I follow",
        "created_at": "2021-02-23T05:42:31.347000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "A naive sponsor contract would give all gas to the call_precompile.  If the transaction fails, it won't have enough gas to withdraw the ERC-20 at the end so the sponsor doesn't get paid.  In this scenario, it is the sponsor's job to deal with gas limits.",
        "created_at": "2021-02-23T05:42:55.988000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Sure, yeah",
        "created_at": "2021-02-23T05:43:11.927000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "The sponsor absolutely needs to set the outer gas limit",
        "created_at": "2021-02-23T05:44:10.851000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Like the \"real\" transaction limit",
        "created_at": "2021-02-23T05:44:18.763000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "In such a scenario, a malicious sponsee could make a transaction that looks like it will succeed within a constrained gas limit, but then once it lands on chain it actually burns all (sponsor) gas.",
        "created_at": "2021-02-23T05:44:40.733000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "So we cannot do the naive approach because malicious sponsees can damage the sponsor.",
        "created_at": "2021-02-23T05:45:16.742000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Right",
        "created_at": "2021-02-23T05:45:21.437000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "I'm coming around to including `gaslimit`.",
        "created_at": "2021-02-23T05:46:35.737000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Is there any reason to *not* have `CALL_PRECOMPILE` forward any attached value?",
        "created_at": "2021-02-23T05:46:49.717000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Spec doesn't mention it, but I feel like we should as that may open up future use cases.",
        "created_at": "2021-02-23T05:47:00.602000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "As opposed to the exact value as specified?",
        "created_at": "2021-02-23T05:47:30.699000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "I'd be hard pressed if you asked me to come up with a scenario where sending too much ether would be a problem though ðŸ˜›",
        "created_at": "2021-02-23T05:48:20.617000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "We should probably move this discussion to the sponsored tx channel or something.",
        "created_at": "2021-02-23T05:48:50.051000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "oh... it's in the graveyard",
        "created_at": "2021-02-23T05:48:59.720000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "nvm",
        "created_at": "2021-02-23T05:49:00.750000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "\u003c#779922457631916064\u003e seems to be where everyone talks about new transaction types these days.",
        "created_at": "2021-02-23T05:49:15.046000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "And this is *sort of* that.  ðŸ˜¬",
        "created_at": "2021-02-23T05:49:35.516000+00:00",
        "attachments": null
    },
    {
        "author": "samwilsn",
        "category": "general",
        "parent": "",
        "content": "Sorta ðŸ˜‰ Let's go there.",
        "created_at": "2021-02-23T05:49:42.317000+00:00",
        "attachments": null
    },
    {
        "author": "prestwich",
        "category": "general",
        "parent": "",
        "content": "while you're moving in this direction, removing it also breaks optimism I believe",
        "created_at": "2021-02-23T16:50:36.922000+00:00",
        "attachments": null
    }
]