[
    {
        "author": "wjmelements",
        "category": "general",
        "parent": "",
        "content": "This would be a good reason to remove refunds, since it would remove any shared benefit for immediate cleanup. When state expiry is scheduled for a fork, refund removal could be part of the many gas adjustments that should come with that change.",
        "created_at": "2021-04-17T00:45:00.083000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Hmm, I thought we were able to avoid that with the latest epoch based state expiry scheme?",
        "created_at": "2021-04-17T04:16:45.580000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "No, the latest scheme keeps that property",
        "created_at": "2021-04-17T04:22:29.104000+00:00",
        "attachments": null
    },
    {
        "author": ".vbuterin",
        "category": "general",
        "parent": "",
        "content": "I think any state expiry scheme has to",
        "created_at": "2021-04-17T04:22:38.301000+00:00",
        "attachments": null
    },
    {
        "author": "sky.cactus",
        "category": "general",
        "parent": "",
        "content": "Ah, setting to 0 *within* an epoch leaves it as \"set to 0\" rather than \"unset\", but something that is expired goes away entirely*.",
        "created_at": "2021-04-17T04:48:54.996000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "general",
        "parent": "",
        "content": "Taking a few minutes to clear up some old confusion.  EIP-2315 *would in fact* reduce the number and gas cost of instructions needed to write and call subroutines.\n\nThis is how you write a subroutine with EIP-2315. 10 gas.\n```\nDIVIDE:\n   beginsub\n   div\n   returnsub\n```\nThis is how you call it. 19 gas.\n```\n   0x02\n   0x03\n   DIVIDE\n   jumpsub\n```\n7 instructions, 39 gas total, including for the division itself.\n\nThis is how you can write a subroutine now. 17 gas.\n\n```\nDIVIDE:\n   jumpdest\n   div\n   swap1\n   jump\n```\nThis is how you call it.  ~~32~~ 29 gas.\n```\n   RTN_DIV\n   0x02\n   0x03\n   DIVIDE\n   jump\nRTN_DIV:\n   jumpdest\n   ~~swap1~~\n```\n~~11~~ 10 instructions, ~~50~~ 47 gas total.",
        "created_at": "2021-04-17T15:32:11.560000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "general",
        "parent": "",
        "content": "Why the last `swap1` is needed?",
        "created_at": "2021-04-17T17:25:11.589000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "general",
        "parent": "",
        "content": "I think you are right - in this case the jump from DIVIDE has consumed the RTN_DIV address, so the result of the DIV is already on top.  Thanks.  One instruction and 3 gas saved, good.",
        "created_at": "2021-04-17T17:32:34.624000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "I actually dont understand why we didn't include it so far",
        "created_at": "2021-04-17T17:51:17.193000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "(Talking about eip-2315)",
        "created_at": "2021-04-17T17:51:35.713000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "I wrote some EVM assembly contracts a while ago and it's super annoying to call subroutines in the current way",
        "created_at": "2021-04-17T17:52:19.660000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "general",
        "parent": "",
        "content": "I don't think ease of hand-written assembly was given much weight as a \"use case\", \u003c@!194432762315407360\u003e.  I think performance and safety gains, and whether Solidity planned to use it, were  given the most weight.  The performance numbers I heard go by were wrong, so I'm trying to get them right.",
        "created_at": "2021-04-17T18:06:33.986000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "Yeah, it's fine to not care about handwritten assembly, just wanted to say it's an improvement from that point of view also.",
        "created_at": "2021-04-17T18:27:44.471000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "general",
        "parent": "",
        "content": "The return stack is also present in Forth, where it is used for all kinds of crazy magic. Compared to Forth, the EIP-2315 is really tame because the return stack cannot be manipulated in arbitrary ways.",
        "created_at": "2021-04-17T18:29:38.985000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "general",
        "parent": "",
        "content": "Right.  You have to use memory.",
        "created_at": "2021-04-17T18:37:09.629000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "general",
        "parent": "",
        "content": "\u003c@!194433073394352129\u003e 's \"EIP-3337: Frame pointer support for memory load and store operations\" https://eips.ethereum.org/EIPS/eip-3337 allows for a disciplined approach to using memory for locals.",
        "created_at": "2021-04-17T18:40:25.329000+00:00",
        "attachments": null
    },
    {
        "author": "gcolvin",
        "category": "general",
        "parent": "",
        "content": "I think it's important to care about handwritten assembly \u003c@!194432762315407360\u003e - people use it to write the most critical code.",
        "created_at": "2021-04-17T18:42:16.796000+00:00",
        "attachments": null
    }
]