[
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "Worth noting that MCL has a WASM backend: https://github.com/herumi/mcl#how-to-build-for-wasmwebassembly and is undergoing a security audit sponsored by the EF as we speak. It is also state-of-the-art in native code.",
        "created_at": "2020-09-21T06:06:16.042000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "general",
        "parent": "",
        "content": "\u003c@!570268431522201601\u003e I still don't get why they include compiler output in the source code: https://github.com/herumi/mcl/blob/master/src/asm/x86-64.s",
        "created_at": "2020-09-21T06:23:54.747000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "It's not compiler output, it's generated LLVM IR that is compiled to ARM/x86 or anything else",
        "created_at": "2020-09-21T06:25:01.334000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "you can see an old generator script: https://github.com/herumi/mie/blob/master/src/mul.txt",
        "created_at": "2020-09-21T06:25:42.654000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "and the new one: https://github.com/herumi/mcl/blob/master/src/llvm_gen.hpp",
        "created_at": "2020-09-21T06:26:09.789000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "traditional compilers are very poor at bigint (but you know it from intx) so it's a workaround to that",
        "created_at": "2020-09-21T06:26:45.689000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "additionally, since LLVM 4.0, LLVM has a register renaming bug and doesn't use the full register capacity on x86 (example on another project https://github.com/libmir/mir-glas/blob/fd9adb0750c23db4c3948f79b63384b8082f3601/source/glas/internal/config.d#L133-L146)",
        "created_at": "2020-09-21T06:28:12.467000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "so Herumi's generate the ASM code with many LLVM versions and checks in the repo the fastest.",
        "created_at": "2020-09-21T06:28:41.649000+00:00",
        "attachments": null
    },
    {
        "author": "mratsim",
        "category": "general",
        "parent": "",
        "content": "See comment here: https://github.com/herumi/mcl/commit/3b8caf72bcc4c427f1cfc4d608d792d487708645#diff-b67911656ef5d18c4ae36cb6741b7965R74",
        "created_at": "2020-09-21T06:29:07.396000+00:00",
        "attachments": null
    },
    {
        "author": "chfast",
        "category": "general",
        "parent": "",
        "content": "Thanks. BTW, Clang now exposes all the LLVM IR `iN` types as `_ExtInt(N)`.",
        "created_at": "2020-09-21T06:31:11.178000+00:00",
        "attachments": null
    },
    {
        "author": "pauld.9606",
        "category": "general",
        "parent": "",
        "content": "\u003e doesn't use the full register capacity on x86\n\nLast time I checked, compilers like GCC and LLVM don't allow using the full register capacity on x86. For example, they won't use the stack pointer for general purpose computation.",
        "created_at": "2020-09-21T21:37:02.343000+00:00",
        "attachments": null
    },
    {
        "author": "pauld.9606",
        "category": "general",
        "parent": "",
        "content": "If you hand-write, you can use registers like rsp and rbp as general purpose registers, but you have to save/recover their values to maintain c-abi calling conventions. But there are always gotchas with x86, like rsp isn't quite general purpose because it can't be used as an index in addressing mode e.g. can't do `mov edx, [eax + esp*4]`.",
        "created_at": "2020-09-21T21:40:10.674000+00:00",
        "attachments": null
    },
    {
        "author": "pauld.9606",
        "category": "general",
        "parent": "",
        "content": "But I know that people are using this trick in practice to relieve register pressure, if that is a bottleneck.",
        "created_at": "2020-09-21T21:41:25.041000+00:00",
        "attachments": null
    }
]