[
    {
        "author": "yorickdowne",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I am looking through PRs and chatting, and I see different views of what \"pre-merge\" is. I am keen that there's a \"right\" answer that all clients use\n\nI see it as:\nSepolia: Terminal PoW block \u003chttps://sepolia.etherscan.io/block/1450408\u003e, PoS transition block \u003chttps://sepolia.etherscan.io/block/1450409\u003e\nMainnet: Terminal PoW block \u003chttps://etherscan.io/block/15537393\u003e, PoS transition block \u003chttps://etherscan.io/block/15537394\u003e\n\n\u003c@341574016160497665\u003e has been kind enough to indulge me on this and dug out the relevant bits of the EIP:\n\n\u003chttps://eips.ethereum.org/EIPS/eip-3675\u003e\n\nTerminal PoW block: A PoW block that satisfies the following conditions ‚Äì pow_block.total_difficulty \u003e= TERMINAL_TOTAL_DIFFICULTY and pow_block.parent_block.total_difficulty \u003c TERMINAL_TOTAL_DIFFICULTY. There can be more than one terminal PoW block in the network, e.g. multiple children of the same pre-terminal block.\n\nTRANSITION_BLOCK The earliest PoS block of the canonical chain, i.e. the PoS block with the lowest block height.\n\nThe blocks above fit that spec, from what I can see",
        "created_at": "2025-05-15T12:46:32.443000+00:00",
        "attachments": null
    },
    {
        "author": "yorickdowne",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Therefore, to expire all PoW block history:\nSepolia, expire `1450408` and earlier\nMainnet, expire `15537393` and earlier\n\nOf course it's also fine to keep the Terminal PoW block. I'm just looking to see that all clients handle it the same way.",
        "created_at": "2025-05-15T12:52:27.505000+00:00",
        "attachments": null
    },
    {
        "author": "yorickdowne",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Updating official docs for the merge with terminal PoW block and PoS transition block numbers for at least the networks that are still live - Sepolia and mainnet - would be gravy",
        "created_at": "2025-05-15T13:11:01.476000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We are using these blocks: https://github.com/ethereum/go-ethereum/blob/master/core/history/historymode.go#L79",
        "created_at": "2025-05-15T17:24:41.318000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So your definition of ‚Äúmerge block‚Äù is the terminal pow block?",
        "created_at": "2025-05-15T19:43:01.628000+00:00",
        "attachments": null
    },
    {
        "author": "kolbyml",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Era1 only supports 0-15537393 as it is a format for Pre-merge blocks. Era1 one is based off the HistoricalAccumulators Portal made for proving pre-merge headers",
        "created_at": "2025-05-15T19:44:09.902000+00:00",
        "attachments": null
    },
    {
        "author": "kolbyml",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "HistoricalRoots from the BeaconState are used to prove headers from 15537394 to pre-capella, etc",
        "created_at": "2025-05-15T19:44:45.802000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Sounds like ‚Ä¶394 is the _second_ PoS block according to fjl ü§î",
        "created_at": "2025-05-15T19:47:18.150000+00:00",
        "attachments": null
    },
    {
        "author": "kolbyml",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh yeah looks like his comment is off by 1, is that what you are pointing out?",
        "created_at": "2025-05-15T19:48:58.866000+00:00",
        "attachments": null
    },
    {
        "author": "kolbyml",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The code looks right though",
        "created_at": "2025-05-15T19:49:59.275000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You and \u003c@219015859182632960\u003e agree. As long as we‚Äôre starting from `last era1 block + 1` then should be fine",
        "created_at": "2025-05-15T19:50:19.356000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Just trying to confirm the correct block üôÇ",
        "created_at": "2025-05-15T19:53:48.301000+00:00",
        "attachments": null
    },
    {
        "author": "kolbyml",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It looks like geth expires 0 to 15537392, if I understand their comment right. Which is fine, but it is also fine if clients prune 0 to 15537393.",
        "created_at": "2025-05-15T19:54:50.446000+00:00",
        "attachments": null
    },
    {
        "author": "kolbyml",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "As longer as 15537394 and after isn't pruned I think it is fine",
        "created_at": "2025-05-15T19:55:17.694000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeh one potential issue is if you full sync and bootstrap from era1 but there‚Äôs a gap. Pruning one less than you could might be fine depending on how the code handles it",
        "created_at": "2025-05-15T19:56:35.929000+00:00",
        "attachments": null
    },
    {
        "author": "kolbyml",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yeah pruning less should always be fine üëç. \n\n\u003e Yeh one potential issue is if you full sync and bootstrap from era1 but there‚Äôs a gap\nI am a little confused what you are referring to here, what do you mean by gap. As in if 15537394 wasn't avaliable on Devp2p? so like a gap between what is available from Era1 and Devp2p then a full sync wouldn't be possible. Is that the concern you are pointing out?",
        "created_at": "2025-05-15T19:57:46.213000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Think I'm getting into implementation details here so should be fine. Agree devp2p will have block 15537394. Just need to ensure your client doesn't try to start its requests from the wrong  block (+2 instead of +1) is what I meant. \n\nKnowing the last era1 block was the important info for me üëç",
        "created_at": "2025-05-15T20:13:50.870000+00:00",
        "attachments": null
    },
    {
        "author": "yorickdowne",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Right that‚Äôs where I‚Äôm confused \n\n```\n\n    params.MainnetGenesisHash: {\n        BlockNumber: 15537393,\n        BlockHash:   common.HexToHash(\"0x55b11b918355b1ef9c5db810302ebad0bf2544255b530cdce90674d5887bb286\"),\n    },\n    // sepolia\n    params.SepoliaGenesisHash: {\n        BlockNumber: 1450409,\n        BlockHash:   common.HexToHash(\"0x229f6b18ca1552f1d5146deceb5387333f40dc6275aebee3f2c5c4ece07d02db\"),\n    },\n}\n```\n\nOn Sepolia this prunes up to the transition block (first pos block) and prunes the terminal pow block.\n\nWhereas on Mainnet that number prunes up to the terminal pow block and doesn‚Äôt prune the terminal pow block.\n\nI‚Äôm not deep enough in the protocol to say whether that‚Äôs an issue. To prune less on mainnet seems fine; I don‚Äôt know whether era1 in Sepolia contains the terminal pow block - if it does it‚Äôs also fine.\n\nThere‚Äôs a part of me that really likes consistency across chains and clients - do or do not prune the terminal pow block. And, not a hill I‚Äôm defending particularly strongly.",
        "created_at": "2025-05-15T20:27:19.426000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "we can change this still",
        "created_at": "2025-05-15T20:34:45.450000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "as noted in the comment, the block should be the \"first post-merge block\", and we prune \"up to but excluding\" that block",
        "created_at": "2025-05-15T20:36:17.853000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so this means we have the intention of pruning the terminal PoW block as well",
        "created_at": "2025-05-15T20:36:27.855000+00:00",
        "attachments": null
    },
    {
        "author": "kolbyml",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Would you guys be able to add your Java Era1 library to our list of E2store format library/implementations list \u003chttps://github.com/eth-clients/e2store-format-specs\u003e",
        "created_at": "2025-05-15T20:49:19.744000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think the spec might have been -1 out as well. Have tried to clarify https://github.com/ethereum/EIPs/pull/9779/files",
        "created_at": "2025-05-15T20:51:13.465000+00:00",
        "attachments": null
    },
    {
        "author": "siladu",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Your configured sepolia block is the first PoS one which makes the comment correct, but mainnet is configured as terminal PoW block, so mainnet should be  `15537394` according to the comment.",
        "created_at": "2025-05-15T20:56:02.837000+00:00",
        "attachments": null
    }
]