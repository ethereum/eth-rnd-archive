[
    {
        "author": "ak4222",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@543900561460822016\u003edo you know why using framed snappy for pre-merge data was selected?",
        "created_at": "2024-01-08T22:13:23.434000+00:00",
        "attachments": null
    },
    {
        "author": "ak4222",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I mean the execution p2p network does not use framed snappy, and i don't think there is ever a reason for pre-merge data to be served on the CL side",
        "created_at": "2024-01-08T22:17:04.085000+00:00",
        "attachments": null
    },
    {
        "author": "ak4222",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I also  dont think there is any specification for compression used in portal network yet, so could it make sense to use \"normal\" snappy, which should be able to be checksummed across implementations, as long as you use the same version of snappy",
        "created_at": "2024-01-08T22:25:54.962000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the nimbus era spec uses framed snappy so it seemed correct to use the same compression: https://github.com/status-im/nimbus-eth2/blob/613f4a9a50c9c4bd8568844eaffb3ac15d067e56/docs/e2store.md#why-snappy-sz-framed-compression",
        "created_at": "2024-01-08T22:43:03.346000+00:00",
        "attachments": null
    },
    {
        "author": "ak4222",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "but do you think it could make sense to use \"normal\" snappy instead?",
        "created_at": "2024-01-08T22:44:37.563000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "does framed snappy and unframed snappy not both have the issue of having implementation differences?",
        "created_at": "2024-01-08T22:52:48.019000+00:00",
        "attachments": null
    },
    {
        "author": "ak4222",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "unframed snappy would not be deterministic across versions, but should be deterministic across implementations",
        "created_at": "2024-01-08T22:54:16.310000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "and framed is not deterministic ?",
        "created_at": "2024-01-08T22:56:08.780000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "is this information listed on the project somewhere? just curious",
        "created_at": "2024-01-08T22:56:27.872000+00:00",
        "attachments": null
    },
    {
        "author": "ak4222",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "framed allows implementations freedom, eg. whether to compress a block of data or not",
        "created_at": "2024-01-08T22:57:59.212000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i see",
        "created_at": "2024-01-08T22:59:10.665000+00:00",
        "attachments": null
    },
    {
        "author": "ak4222",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "https://github.com/google/snappy/blob/main/framing_format.txt",
        "created_at": "2024-01-08T22:59:27.295000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ultimately i don't think era1 should deviate from the era format and afaik, \u003c@449019668296892420\u003e would like to keep using framed snappy as it gives guarantees on the max amount of memory compression can use (pls correct me if wrong)",
        "created_at": "2024-01-08T23:01:03.853000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so we're at a bit of a stand still, I think you'll need to convince him of a change",
        "created_at": "2024-01-08T23:01:21.286000+00:00",
        "attachments": null
    },
    {
        "author": "lightclient",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the only path forward it for era1 it seems is to 1) completely drop the simple checksums and/or 2) come up with another checksum format that works on a different serialized version of the data",
        "created_at": "2024-01-08T23:02:19.959000+00:00",
        "attachments": null
    },
    {
        "author": "ak4222",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "hm yes that is true. Snappy does specifically limit the size of chunks for buffering purposes.",
        "created_at": "2024-01-08T23:02:54.613000+00:00",
        "attachments": null
    },
    {
        "author": "ak4222",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@543900561460822016\u003e thanks for the input",
        "created_at": "2024-01-08T23:11:23.687000+00:00",
        "attachments": null
    }
]