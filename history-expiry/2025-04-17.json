[
    {
        "author": "gtrintinalia",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I changed the configuration to be less strict with peers when syncing so It should not be rejected now. Also, The block range message was implemented to send blocks every 32 blocks but skip when actively syncing. I have changed it to send a block range update every minute for now for testing so your nodes should expect some block range updates.",
        "created_at": "2025-04-17T05:31:58.892000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "btw, we still need to figure out the precise semantics of BlockRangeUpdate",
        "created_at": "2025-04-17T09:55:17.100000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "in Geth, we wanted use this message to announce also the 'intent' of the node",
        "created_at": "2025-04-17T09:55:30.337000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "when the node is syncing in pruned mode, i.e. the earliest block is \u003e 0, the initial updates will all look like `[earliest: 16M, latest: 0]`",
        "created_at": "2025-04-17T09:56:20.811000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "this was kind of the point of the previous proposal, to announce the intended earliest block in status",
        "created_at": "2025-04-17T09:56:53.936000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "or should we change it to always report with `earliest \u003c= latest`?",
        "created_at": "2025-04-17T09:59:12.467000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "in that case, it would report `[earliest: 0, latest: 0]` initially, until the sync has started",
        "created_at": "2025-04-17T09:59:27.517000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I guess it's better that way",
        "created_at": "2025-04-17T10:03:14.736000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "eth/69 spec update: https://github.com/ethereum/devp2p/pull/262",
        "created_at": "2025-04-17T10:18:35.730000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "circling back to this, it doesn't really answer my question",
        "created_at": "2025-04-17T12:01:27.409000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think we really need to agree on the semantics of BlockRangeUpdate here, like when does it lead to a disconnect",
        "created_at": "2025-04-17T12:01:51.304000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "otherwise we may end up splitting the network",
        "created_at": "2025-04-17T12:02:10.639000+00:00",
        "attachments": null
    },
    {
        "author": "gtrintinalia",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Right, the pruning part is not finalized yet, so at this moment we are sending 0, but the plan is to also send the intent of the node. So we would send the pre-merge block as the earliest block regardless of the latest.",
        "created_at": "2025-04-17T13:35:44.044000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "thing is, I am kind of arguing against this now.",
        "created_at": "2025-04-17T14:00:05.199000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I want to have the validation condition that `earliest \u003c= latest`",
        "created_at": "2025-04-17T14:00:32.793000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "this only matters for a short time anyway. as soon as the client has synced some blocks, it will announce a more useful range",
        "created_at": "2025-04-17T14:01:13.569000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "also there is value in defining the 'available range' to be what the client can serve with GetBlockBodies, etc.",
        "created_at": "2025-04-17T14:01:49.412000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that's how I have defined it in the spec now",
        "created_at": "2025-04-17T14:01:56.209000+00:00",
        "attachments": null
    },
    {
        "author": "gtrintinalia",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It makes sense to me. No objections. How do the other clients feel about it?",
        "created_at": "2025-04-17T14:23:02.470000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@\u0026652918665943056397\u003e and \u003c@\u0026688101493978562687\u003e can we get an opinion from either of your teams on this?",
        "created_at": "2025-04-17T14:39:07.453000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Mostly care during sync; so would prefer range to be what the peer has, not what it desires to have\n\nAlso then it makes it easier for detection as can sample anything in that range and tell if its lying.\n\nIf its what it desires to have, then is less helpful both from finding a peer that has what you need to sync and also to tell if its lying",
        "created_at": "2025-04-17T14:42:41.119000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Then can disconnect if peer says it has \"range\", and doesn't give you back something when you ask for it and it is in \"range\" as it is lying or very poor performing",
        "created_at": "2025-04-17T14:45:28.339000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Is a question on whther to do actual head block, vs safe vs finalized as top range",
        "created_at": "2025-04-17T15:08:24.052000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(due to reorgs); I think head is fine? Assuming reorg'd blocks can still be served by hash?",
        "created_at": "2025-04-17T15:08:54.329000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It's a good question",
        "created_at": "2025-04-17T15:19:35.643000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I would say, if you really want to start sampling blocks out of the range, maybe don't do it at the very top of the range",
        "created_at": "2025-04-17T15:20:04.405000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Announcing head is more useful",
        "created_at": "2025-04-17T15:20:18.414000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ok so it seems we agree",
        "created_at": "2025-04-17T15:20:31.409000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "can anyone ack the spec changes?",
        "created_at": "2025-04-17T15:26:30.037000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "one thing that is still unclear, is how much history we should allow clients to drop",
        "created_at": "2025-04-17T15:26:58.495000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I left it a bit vague in the spec update",
        "created_at": "2025-04-17T15:27:07.952000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "pre-merge is what is defined in the EIP...  maybe I'm misunderstanding this statement...",
        "created_at": "2025-04-17T15:27:39.626000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yeah",
        "created_at": "2025-04-17T15:27:49.052000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "but what I mean is, should we add a hard disconnect rule such that any peer on mainnet announcing a history range with `earliest \u003e merge` is immediately disconnected?",
        "created_at": "2025-04-17T15:28:27.740000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I feel like peers who do that should be at a disadvantage somehow",
        "created_at": "2025-04-17T15:28:48.744000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "we don't have the framework for it yet in Geth, but I think how we'll handle this is to keep some room in the peerset for ones like this",
        "created_at": "2025-04-17T15:29:21.938000+00:00",
        "attachments": null
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I generally agree... though I think we should focus on the main fix for this which is allowing them to drop it by keeping moving forward with full 4444s over the next year.",
        "created_at": "2025-04-17T15:29:24.945000+00:00",
        "attachments": null
    },
    {
        "author": "smartprogrammer",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "this wouldnt be useful, unless we deprecate all pre eth/69 protocols",
        "created_at": "2025-04-17T15:29:31.100000+00:00",
        "attachments": null
    },
    {
        "author": ".fjl",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I'll think about it some more and leave it vague for now",
        "created_at": "2025-04-17T15:30:15.257000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If you are announcing what you have; and syncing backwards then earliest is likely to be `earliest \u003e merge`? \n\nSo would disconnect people syncing",
        "created_at": "2025-04-17T23:36:14.832000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Disconnect peers that advertise a range and if you ask them for a random block in that range don't give it back (i.e. lying peers)",
        "created_at": "2025-04-17T23:39:02.708000+00:00",
        "attachments": null
    },
    {
        "author": "ben_a_adams",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "TaS = Trustiness availably Sampling ðŸ˜…\n\nCan you trust the range they say?",
        "created_at": "2025-04-17T23:41:47.159000+00:00",
        "attachments": null
    }
]