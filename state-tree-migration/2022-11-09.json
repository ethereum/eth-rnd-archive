[
    {
        "author": "kevaundray",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yep this makes sense, seems inverse is still comparatively slow, so benefits start at 2",
        "created_at": "2022-11-09T00:23:38.845000+00:00",
        "attachments": null
    },
    {
        "author": "kevaundray",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I‚Äôm on mobile, so I can‚Äôt parse this at the moment üòÖ",
        "created_at": "2022-11-09T00:25:10.296000+00:00",
        "attachments": null
    },
    {
        "author": "kevaundray",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There is ns/op and ns/value , is the latter something you added? Trying to figure out the performance gain when you use batch trick with 2",
        "created_at": "2022-11-09T00:29:02.920000+00:00",
        "attachments": null
    },
    {
        "author": "kevaundray",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "No worries, we are nocturnal üò¨",
        "created_at": "2022-11-09T00:30:31.553000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yes, the `ns/value` is a custom metric I added.",
        "created_at": "2022-11-09T00:30:33.501000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It's basically `ns/op` divided by the sub-test case N batched values",
        "created_at": "2022-11-09T00:30:53.290000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So for example, when batching for 64 points, it takes 35094 ns, which \"per value\" is ~548.4ns (35094/64)",
        "created_at": "2022-11-09T00:32:00.473000+00:00",
        "attachments": null
    },
    {
        "author": "kevaundray",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So I compare 1506 ns/op to the ns/value for the multiple benchmarks?",
        "created_at": "2022-11-09T00:32:13.953000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, that's the idea",
        "created_at": "2022-11-09T00:32:25.701000+00:00",
        "attachments": null
    },
    {
        "author": "kevaundray",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Okay makes sense üôè",
        "created_at": "2022-11-09T00:32:43.445000+00:00",
        "attachments": null
    },
    {
        "author": "kevaundray",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So for 2 it‚Äôs 1125 ns per value versus 1506 ns per value without the batch trick ‚Äî about 23% diff",
        "created_at": "2022-11-09T00:34:50.397000+00:00",
        "attachments": null
    },
    {
        "author": "kevaundray",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Eager to see the overall diff from this üò¨",
        "created_at": "2022-11-09T00:35:37.651000+00:00",
        "attachments": null
    },
    {
        "author": "kevaundray",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "PR looks good to me, changing the api to receive the slice instead of allocating in the function seems like a minor stylistic change, unless the common code path already has a slice allocated. Thank you for pointing that out in the PR though üôè",
        "created_at": "2022-11-09T00:38:55.898000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Haven't tried MultiMapToField yet, I am finishing a big refactor before I can roll it in",
        "created_at": "2022-11-09T05:57:44.050000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "sounds too good to be true, I'm going to run it on the block replay a bit later today",
        "created_at": "2022-11-09T05:58:38.826000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It makes no sense to apply it now, as I have this big refactor in the pipe. I'll ping you when it's ready. A couple days at most. My refactor includes using `MultiMapToField` in one location, but I'm sure that you will be able to squeeze even more.",
        "created_at": "2022-11-09T06:06:59.421000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You go to bed late and I rise up early... the sun never sets on the verkle empire ü§£",
        "created_at": "2022-11-09T06:10:24.168000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This is consistent with what Gotti announced, and that's great because there are quite a few use cases in which two `toFr` are called in a row.",
        "created_at": "2022-11-09T06:46:44.885000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@427491045308235776\u003e `MultiMapoToBaseFieldBytes` isn't quite what is needed, I think, because it returns a slice of byte arrays, when, to be useful when computing a node's commitment, it needs to calculate the base field proper, not get its bytes. So what I'd like to have is something along the lines of`MultiMapToBaseField(elements []*Element) []*Fr`, which shouldn't be too hard to write looking at the code.",
        "created_at": "2022-11-09T18:58:18.108000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Incidentally, there's a ~10% speedup using the new inverse method and my refactor",
        "created_at": "2022-11-09T18:59:14.318000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I want to try a couple more things (including `MultiMapToBaseField`) before I merge it to master.",
        "created_at": "2022-11-09T19:00:09.894000+00:00",
        "attachments": null
    },
    {
        "author": "kevaundray",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Oh, why do you need the Field and not the bytes? \n\nI didn‚Äôt expose it because its seemed not necessary and having the base field (Fp) alongside the scalar field (Fr) is sometimes confusing üòÖ",
        "created_at": "2022-11-09T20:17:46.652000+00:00",
        "attachments": null
    },
    {
        "author": "kevaundray",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Will check again to see the code path!",
        "created_at": "2022-11-09T20:17:57.397000+00:00",
        "attachments": null
    },
    {
        "author": "kevaundray",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If you had it on hand, how much did the inverse method save?\n\nWould be good to see the relationship between a x% increase in inverse leading to a y% increase in the overall code for example. (If you had it beforehand, no worries if not)",
        "created_at": "2022-11-09T20:41:14.523000+00:00",
        "attachments": null
    }
]