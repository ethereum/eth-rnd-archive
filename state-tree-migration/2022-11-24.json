[
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "`MAIN_STORAGE_OFFSET` and `offset` are not field elements, they are just an (integer) offset in a linear, \"logical\" space. The value is aligned on `VERKLE_NODE_WIDTH` because we don't want to mix leaves corresponding to code chunks, with leaves corresponding to storage slots. But the offset is just used as an additional input to a hash function, so there is no risk \"wrapping around\" or any other type of collision (otherwise, the hash function is not a good one)",
        "created_at": "2022-11-24T13:25:07.250000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes `(MAIN_STORAGE_OFFSET + storage_key) // VERKLE_NODE_WIDTH`  is an integer in a logical space, but while calculating the trie key that is eventually mapped to a field element. I'm not sure yet if it can wrap around at the vector level since we do 16 byte splits... but `(MAIN_STORAGE_OFFSET + storage_key) // VERKLE_NODE_WIDTH` should be a number that should fit into `uint256.Int`.",
        "created_at": "2022-11-24T13:34:42.425000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If `MAIN_STORAGE_OFFSET` doesn't have an upper bound, the `GetTreeKeyStorageSlot(...) ` calculation could maybe produce a `GetTreeKey(address, 0, ...)` call?",
        "created_at": "2022-11-24T13:36:47.479000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "oh I think that I see what you mean, but even then there's no wrapping. It's true that the pedersen hash will be a field element, but the MSB (the one in which not all the bits are used) is chopped off, to make a 31-byte stem. The last byte is coming from the `(MAIN_STORAGE_OFFSET + storage_key) % VERKLE_NODE_WIDTH` part. So the tree is balanced and there is no wraparound.",
        "created_at": "2022-11-24T14:10:10.058000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yep. But now I was thinking again, couldn't this line overflow https://github.com/gballet/go-ethereum/blob/beverly-hills-head/trie/utils/verkle.go#L148 ?\nSince we first do the addition and then the ` // VERKLE_NODE_WIDTH`.",
        "created_at": "2022-11-24T14:13:10.424000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Probably we'd want to use arbitrary precision big.Int for that math to be safe I think, instead of uint256.Int",
        "created_at": "2022-11-24T14:15:22.758000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "true",
        "created_at": "2022-11-24T14:18:28.113000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Let me know if you want some help with a PR. But since you're in a middle of a refactor, I want to avoid potential conflicts for you.",
        "created_at": "2022-11-24T14:25:07.453000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "thanks, indeed it's better to wait for the refactor. It shouldn't be much longer and I have a couple ideas of PRs for you to do afterwards.",
        "created_at": "2022-11-24T14:52:25.285000+00:00",
        "attachments": null
    }
]