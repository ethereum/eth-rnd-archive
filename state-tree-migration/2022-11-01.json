[
    {
        "author": "ghost.marshmallow",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Made another PR to verkle.dev writing up the Why Verkle Trees section, want to focus on writing content to make the topic more accessible\n\nhttps://github.com/ethereum/verkle-dev-website/pull/16",
        "created_at": "2022-11-01T09:53:25.532000+00:00",
        "attachments": null
    },
    {
        "author": "kevaundray",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "LGTM, linking to the server might be less resistance to breakage, if the channel moves or the name changes. Though I’m not sure how discord references channels, so it could be fine.",
        "created_at": "2022-11-01T10:02:13.611000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003cdankrad\u003e \u003e Inv(x) takes 1314 ns/op\nMul(a,b) takes 73 ns/op\n\nThis is 381 bit or 255 bit mul/inv?",
        "created_at": "2022-11-01T11:26:52.409000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the latter",
        "created_at": "2022-11-01T12:16:23.475000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003cdankrad\u003e that's crazy! So our field ops at 27 ns are really fast then?",
        "created_at": "2022-11-01T12:17:06.427000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003cdankrad\u003e their inv seems really good though",
        "created_at": "2022-11-01T12:17:18.136000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, here's my opinion of why: https://github.com/jsign/verkle-vs-patricia/pull/1/files#r1009912729",
        "created_at": "2022-11-01T12:18:32.893000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003cdankrad\u003e BenchmarkFpMul/go-ipa-16                        78093471                14.87 ns/op            0 B/op          0 allocs/op\nBenchmarkFpMul/go-blst-16                       10473631",
        "created_at": "2022-11-01T12:20:45.551000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003cdankrad\u003e sorry what are these and what are the units here?",
        "created_at": "2022-11-01T12:20:53.773000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The only one that you'd probably want to look at is the `ns/op`, which is the average number of nanoseconds per operation (in this case, calculating the inverse of the scalar).\nThe first column is the name of the test. The second is how many iterations were done to calculate the average (e.g: 78093471 inverses). Third is ns/op. Forth is how many bytes of memory a single inverse allocates. And the fifth is how many memory allocations were made (usually relevant since asking for memory takes time)",
        "created_at": "2022-11-01T12:23:46.819000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "A clarification that might not be obvious if you don't program in Go: the `go-blst` flavor is calling blst from Go (usually called CGO; calling C from Go has a known overhead). The separate `blst` ones (the C program) is the \"pure\" one.",
        "created_at": "2022-11-01T12:25:44.438000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003cdankrad\u003e 14.87 ns/op seems very fast",
        "created_at": "2022-11-01T12:28:28.150000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003cdankrad\u003e how is that even possible?",
        "created_at": "2022-11-01T12:28:33.945000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003cdankrad\u003e what exactly does BenchmarkFpMul/go-ipa-16 test?",
        "created_at": "2022-11-01T12:28:50.381000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Multiplication of random field elements, quite short impl: https://github.com/jsign/verkle-vs-patricia/blob/main/invmul_test.go#L65LL75",
        "created_at": "2022-11-01T12:33:08.327000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003cdankrad\u003e Are you sure it's correct? It seems very fast",
        "created_at": "2022-11-01T12:34:02.099000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I was doubtful too... that's why I created this extra test that does the multiplication of two random field elements with go-ipa and blst and check that the result matches https://github.com/jsign/verkle-vs-patricia/blob/main/invmul_test.go#L96-L122\nI'd love to have someone else see in detail these tests, but I did that test because seemed incredibly fast to me too.",
        "created_at": "2022-11-01T12:37:02.557000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003cdankrad\u003e cool, would someone be able to double check this test maybe?",
        "created_at": "2022-11-01T12:37:42.534000+00:00",
        "attachments": null
    },
    {
        "author": "frangio_",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "hi, this looks like the right channel for my question but let me know if i'm mistaken\n\nhas there ever been a proposal to add a precompile to prove parts of the state given a block hash (or state root)? this can obviously be created as a smart contract today, but not in a forward compatible way that would automatically work with verkle state in the future\n\nis this something we would be interested in? (and is it feasible anyway?) i think there could be some interesting applications",
        "created_at": "2022-11-01T15:46:21.868000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003cdankrad\u003e Yes I am a big fan of introducing this",
        "created_at": "2022-11-01T17:09:46.730000+00:00",
        "attachments": null
    },
    {
        "author": "bridge-bot",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003cdankrad\u003e basically versioning the state root and a precompile that can verify a state proof for any version",
        "created_at": "2022-11-01T17:10:06.956000+00:00",
        "attachments": null
    },
    {
        "author": "frangio_",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "if the input to the precompile is the state root, i think there's a remaining problem of verifying that a state root corresponds to a block. i believe this would also need to be done in a versioned way. could the block be versioned instead (or in addition to) the state root?",
        "created_at": "2022-11-01T18:26:38.552000+00:00",
        "attachments": null
    },
    {
        "author": "frangio_",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "alternatively could pass the block number to the precompile for versioning, so something like `verify_state(block_hash, block_number, ...)`",
        "created_at": "2022-11-01T19:40:27.163000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@555483069038198827\u003e, I think I found why `Mul` is so fast (~15ns). My benchmark still looks fine to me, but the explanation lies elsewhere.\n\nThe `go-ipa` implementation has the ability to detect if the underlying CPU has Intel ADX, which is support for some special CPU instructions that allow to have native large integer arithmetic support (in modern CPUs).\n(More about this: https://en.wikipedia.org/wiki/Intel_ADX)\n\nIf I run exactly the same benchmark with a build tag `noadx` to disable this optimization, then I get (note that `-tags noadx` flag):\n```\n$ go test -tags noadx . -run=none -bench=BenchmarkFp -benchmem \ngoos: linux\ngoarch: amd64\npkg: github.com/jsign/verkle-vs-patricia\ncpu: AMD Ryzen 7 3800XT 8-Core Processor            \nBenchmarkFpInverse/go-ipa-16              705946              1629 ns/op               0 B/op          0 allocs/op\nBenchmarkFpInverse/go-blst-16             714726              1427 ns/op              32 B/op          1 allocs/op\nBenchmarkFpMul/go-ipa-16                41319416                24.52 ns/op            0 B/op          0 allocs/op\nBenchmarkFpMul/go-blst-16               10759808               110.6 ns/op  \n```",
        "created_at": "2022-11-01T21:59:12.294000+00:00",
        "attachments": null
    },
    {
        "author": "jsign",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So, disabling leveraging these special CPU instructions, it’s still fast ~24ns but not that fast as with the special CPU instructions. Also, looks like it’s only used for Mul since the rest of the benchmarks have similar numbers as we’ve seen before.\n\nTo triple-check, I also included a benchmark using arkworks-rs (https://github.com/arkworks-rs) which is a known Rust library usually used for zkSNARKs that have their own implementation of finite field algebra:\n```\n$ cargo bench -q\ninverse                 time:   [2.1805 µs 2.1830 µs 2.1864 µs]                     \nmul                     time:   [16.552 ns 16.559 ns 16.567 ns]                 \n```\nSo getting a similar fast number as we saw before.\n\nThis makes me feel more comfortable with what we’ve seen (i.e: ~15ns, in ~modern CPUs). The flag to disallow the special CPU optimization clearly changes the number, plus the Rust benchmark validating that also 15ns is possible.\n\nDespite all these interesting confirmations and explanations, the doors are still open for reviewers!\n\n(I added both (running with noadx, and the Rust benchmark) in the benchmark repo: https://github.com/jsign/verkle-vs-patricia/pull/2/files. You can see again the README where I put these two new set of results for my desktop and laptop)",
        "created_at": "2022-11-01T21:59:14.474000+00:00",
        "attachments": null
    }
]