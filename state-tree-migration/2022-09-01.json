[
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I mean taking the values in the MPT, and computing the verkle root, but also the internal nodes if possible, so that they could be downloaded by other clients e.g. through snap sync(doesn't have to be snap sync).\nFor context, given the large amount of data that needs to be converted and, consequently, the resources needed to perform the conversion, we are leaning for an approach where the conversion is performed by only a handful of nodes, and other clients will download the data from those nodes. I have a prototype implementation of this in geth in this branch https://github.com/gballet/go-ethereum/tree/verkle-conversion-goroutine-flush-rebased. This works but is very slow, and it can run out of memory if the machine doesn't have enough RAM.",
        "created_at": "2022-09-01T08:52:15.710000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That's indeed where Erigon shines and it could use its ETL feature not to run out of memory, as Peter Davies suggested. The second step would be to allow other clients to sync from it, somehow.",
        "created_at": "2022-09-01T08:52:24.995000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Btw \u003c@353136597522448385\u003e I added a comment on your PR",
        "created_at": "2022-09-01T14:18:53.055000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If that is actually an issue mind if I make the commit fixing it?",
        "created_at": "2022-09-01T14:19:11.075000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "ah no i see",
        "created_at": "2022-09-01T14:25:15.754000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Btw is it expected for Pedersen hash function to take long?",
        "created_at": "2022-09-01T15:22:37.539000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it is really slow but I am unsure if it is my fault or not",
        "created_at": "2022-09-01T15:22:59.045000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "no it's not your fault",
        "created_at": "2022-09-01T15:23:22.679000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "it takes a long time",
        "created_at": "2022-09-01T15:23:31.012000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "well, it depends on how much time it takes, but it is much slower than a regular hash",
        "created_at": "2022-09-01T15:24:03.492000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "which is one of the reasons that we're leaning towards leaving the conversion to a reduced set of nodes",
        "created_at": "2022-09-01T15:24:53.584000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Would 6 hours to convert plainstate to pedersen sounds okay?",
        "created_at": "2022-09-01T15:26:59.680000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "With that include storage + accounts keys",
        "created_at": "2022-09-01T15:27:19.951000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "yes",
        "created_at": "2022-09-01T15:27:27.907000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "current estimate with my PR is 6 days, if you can do 6 hours it's definitely fine",
        "created_at": "2022-09-01T15:27:51.332000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Wow",
        "created_at": "2022-09-01T15:28:03.046000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Well, maybe I am doing something wrong because it is too fast",
        "created_at": "2022-09-01T15:28:16.927000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Erigon regular hashing is 1 hour",
        "created_at": "2022-09-01T15:28:25.024000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thats why I asked",
        "created_at": "2022-09-01T15:28:28.948000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But I have ETL which should make it faster now thinking about it",
        "created_at": "2022-09-01T15:28:55.921000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "not necessarily, most of the time is spent looking for preimages because geth stores them in a way that is very inefficient for this application",
        "created_at": "2022-09-01T15:28:56.158000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah okay",
        "created_at": "2022-09-01T15:29:04.003000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Makes sense",
        "created_at": "2022-09-01T15:29:06.173000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Well, I will see about that, let's see if I can produce a valid VT",
        "created_at": "2022-09-01T15:30:14.190000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I am not expecting it to be right immediately",
        "created_at": "2022-09-01T15:30:33.683000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I can help verify at the end of the conversion",
        "created_at": "2022-09-01T15:32:29.365000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "if you can indeed to it in 6 hours, you're welcome to err along the way ðŸ™‚",
        "created_at": "2022-09-01T15:32:50.077000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "that would be an awesome result",
        "created_at": "2022-09-01T15:33:04.405000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I do not know if Go-Ethereum has this optimization but what could be done is having a mapping of `address` =\u003e `versionKey` and `address + storage slot` =\u003e `storage key`",
        "created_at": "2022-09-01T15:42:17.507000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "so that on chain tip(or while catching up) this problematic may be less noticeable for already existing addresses and storage slots",
        "created_at": "2022-09-01T15:42:40.923000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "also I have a question for this https://notes.ethereum.org/@vbuterin/verkle_tree_eip#Code",
        "created_at": "2022-09-01T16:09:23.179000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We have got code hashes for account address in tree already",
        "created_at": "2022-09-01T16:09:47.893000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "why repeating addresses and not just use code hash",
        "created_at": "2022-09-01T16:10:01.020000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "would there not be repetion of the same code over and over",
        "created_at": "2022-09-01T16:10:11.570000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "not sure I understand what you mean here, but if you're talking about caching the evaluation of `versionkey` from the address and the evaluation of the first storage group, we do. You have to, really, otherwise performance craters.",
        "created_at": "2022-09-01T17:30:35.550000+00:00",
        "attachments": null
    },
    {
        "author": "gballet",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "by this, do you mean that if only the code hash was used, instead of the address + code chunk, then there would be a de-duplication of all the contract using the same code? That is correct, however the catch is that you would either need to use the keccak of the code, or pedersen-hash the code. The first approach is not zk-friendly, the second means evaluating a potentially very high-order polynomial, which would be a performance killer.",
        "created_at": "2022-09-01T17:38:34.889000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "should every account have assigned a size code value? and if it does, do we make account with empty code hash set to 32 blank bytes?",
        "created_at": "2022-09-01T19:45:30.178000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "also should the code hash be the empty code hash or a code hash made of 32 void bytes",
        "created_at": "2022-09-01T19:47:09.414000+00:00",
        "attachments": null
    },
    {
        "author": "funnygiulio",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "also are storage values in little endian?",
        "created_at": "2022-09-01T20:06:03.273000+00:00",
        "attachments": null
    }
]