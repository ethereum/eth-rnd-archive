[
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "One thing I don't like about all of this is that gas metering will depend on storage layout. Erigon family of nodes has reveled in the fact that merkle tree layout only matters for state root - and we worked our way around it with intermediate hashes. Tying verkle trees and gas seems rather unwise in the long term.",
        "created_at": "2021-10-30T12:13:48.082000+00:00",
        "attachments": []
    },
    {
        "author": "pietjepuk",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I thought it was about tying gas metering to the cost of witnesses? Or are you saying to forget about efficient witnesses/statelessness?",
        "created_at": "2021-10-30T12:47:17.047000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Statelessness is a solution in search for a problem. Forget about it if it brings additional complexity to full nodes.",
        "created_at": "2021-10-30T13:05:46.002000+00:00",
        "attachments": []
    },
    {
        "author": "pietjepuk",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Your proposed alternative being to just accept the state growing to infinity?",
        "created_at": "2021-10-30T13:09:48.878000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "State table is very small actually, it can easily fit on modern phonesâ€™ internal memory.",
        "created_at": "2021-10-30T13:11:25.836000+00:00",
        "attachments": []
    },
    {
        "author": "pietjepuk",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That's not what I said",
        "created_at": "2021-10-30T13:11:46.773000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Well, itâ€™s about it. Solve problems when they arise, especially if it involves making tradeoffs",
        "created_at": "2021-10-30T13:12:30.966000+00:00",
        "attachments": []
    },
    {
        "author": "pietjepuk",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "OK. So if the state size was a problem according to you at some hypothetical size, statelessness would be a solution?",
        "created_at": "2021-10-30T13:13:31.048000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Would building shelters help against next extinction event caused by big asteroid?",
        "created_at": "2021-10-30T13:15:10.927000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The answer is yes but it completely misses the point",
        "created_at": "2021-10-30T13:15:23.186000+00:00",
        "attachments": []
    },
    {
        "author": "pietjepuk",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Imo it does matter. I'm trying to figure out if you have objections to the proposed implementation of statelessness (and the storage incentives around reducing witness sizes), or if you just don't think it's time for statelessness yet (because state is small enough in your opinion).",
        "created_at": "2021-10-30T13:17:06.129000+00:00",
        "attachments": []
    },
    {
        "author": "pietjepuk",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "From what I can gather, it's more the second than the first.",
        "created_at": "2021-10-30T13:17:14.669000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Itâ€™s both. State size is a non-issue for the foreseeable future. And even if it were an issue, complexifying gas metering which is _under consensus_ is an absolute no go.",
        "created_at": "2021-10-30T13:18:54.953000+00:00",
        "attachments": []
    },
    {
        "author": "pietjepuk",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Fair enough. I would say state size and growth very much _is_ an issue, but my thresholds for what size is acceptable are apparently substantially lower. And I'm fairly certain I'm not the only one that thinks statelessness is overdue (nor are you the only one that thinks it is not the time yet).\nComplexifying gas metering something I know little about (as far as it pertains to the implementation details, the incentives make sense to me), and therefore don't have much to say on.",
        "created_at": "2021-10-30T13:22:56.371000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Unfortunately every _want_ has to be counterbalanced by _implementation complexity_ that it brings. Gas metering is already very complex as is - the most complex part of execution actually - and therefore any gas changes that are not strictly required to prevent DoS should not become part of protocol at this time.",
        "created_at": "2021-10-30T13:29:15.897000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And tying this to storage layout which we at Erigon donâ€™t even have is absolute no go.",
        "created_at": "2021-10-30T13:30:11.751000+00:00",
        "attachments": []
    },
    {
        "author": "pietjepuk",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We come back to the point of thresholds. I'd be curious to see if there are core devs who feel the opposite (i.e. apparent implemention complexity well worth it for the gains of statelessness).",
        "created_at": "2021-10-30T13:43:10.926000+00:00",
        "attachments": []
    },
    {
        "author": "pietjepuk",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Still not quite sure what you mean. Does Erigon need to overhaul its internal storage layout/scheme for the proposed gas metering changes?",
        "created_at": "2021-10-30T13:46:42.724000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It may handcuff all clients to actually storing state as Verkle tree even if itâ€™s suboptimal, and completely break Erigon staged sync",
        "created_at": "2021-10-30T13:52:04.222000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Am I understanding your problem with stateless/verkle roadmap correctly here?  The gas metering, which requires monitoring which paths into the verkle trie get accessed is expected to enforce a specific database architecture, which you \u003c@!329594653097721856\u003e expect to break Erigon's storage model?",
        "created_at": "2021-10-30T14:02:05.924000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Both storage model and staged sync approach",
        "created_at": "2021-10-30T14:02:42.566000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We rely very much on merklization being separate from execution",
        "created_at": "2021-10-30T14:03:06.235000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Now, if the gas costs were not affected by Verkle EIP, only state root computation, it should be fine I think",
        "created_at": "2021-10-30T14:04:06.064000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "In the call I asked about this (thinking of Erigon) and the claim was that you can calculate the gas costs without actually building/maintaining a verkle tree.",
        "created_at": "2021-10-30T14:04:19.547000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "If however gas costs become involved, at least AFAIUI, then it becomes bone breaking",
        "created_at": "2021-10-30T14:04:55.155000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "All you need is the key IIUC and you can calculate the gas cost from that key.  Well, from that key plus the key of other storage reads within the same transaction.",
        "created_at": "2021-10-30T14:05:00.986000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "(since gas metering is a function of the distance from previously read keys more or less)",
        "created_at": "2021-10-30T14:05:35.522000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "_At the very least_ it will mean a lot more complex EVM glue and lower execution performance",
        "created_at": "2021-10-30T14:06:05.352000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And the reason for this isn't because of assumed storage costs, but rather because it affects proof size which, in a stateless world, is what starts to matter more than disk access.",
        "created_at": "2021-10-30T14:06:23.694000+00:00",
        "attachments": []
    },
    {
        "author": "gottfriedherold",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Well, the gas cost dependency on storage takes *only* the last layer into account (in the language of the EIP draft: stem vs. extension)",
        "created_at": "2021-10-30T14:07:00.939000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Even in a non-stateless world, but a world where lightclients exist, small proof size is valuable and incentivizing contracts to be authored in a way that results in small proof sizes there is value in this type of metering.",
        "created_at": "2021-10-30T14:07:10.513000+00:00",
        "attachments": []
    },
    {
        "author": "gottfriedherold",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This is rather orthogonal to the actual internal database layout for the stem.\\",
        "created_at": "2021-10-30T14:07:42.921000+00:00",
        "attachments": []
    },
    {
        "author": "gottfriedherold",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "i.e. the is no need to store a verkle tree for the gas cost change.",
        "created_at": "2021-10-30T14:08:04.469000+00:00",
        "attachments": []
    },
    {
        "author": "gottfriedherold",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The only thing is that accesses to the key-value store that share the same last byte should be cheaper. But that may be a good idea anyway in terms of caching...",
        "created_at": "2021-10-30T14:09:13.410000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, I believe Gotti and Micah are both pointing at the thing I was going towards.  I believe the current plans for gas metering under the new verkle trie layout do not actually have any ties to actually storing anything \"like a verkle trie\" or even enforce any computation of the verkle trie.  They are all strictly based on the key under which the value is stored in the database.",
        "created_at": "2021-10-30T14:10:36.171000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "does this still break Erigon's architecture?",
        "created_at": "2021-10-30T14:10:56.908000+00:00",
        "attachments": []
    },
    {
        "author": "gottfriedherold",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Accesses that share internal nodes farther towards the root are not considered. In fact, the proposal actively tries to make it hard to control what internal nodes a given key end up with (for sync reasons).",
        "created_at": "2021-10-30T14:11:30.825000+00:00",
        "attachments": []
    },
    {
        "author": "gottfriedherold",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "At any rate: Since subsequent accesses to neighbouring keys (i.e. sharing the same stem) are fairly common, in particular for code, making these cheap for db access is probably a good idea anyway.",
        "created_at": "2021-10-30T14:12:45.561000+00:00",
        "attachments": []
    },
    {
        "author": "gottfriedherold",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "irresprective of any gas cost.",
        "created_at": "2021-10-30T14:13:00.234000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003c@!329594653097721856\u003e your other reason was stating that statelessness is a solution looking for a problem.  Are you stating that large proof sizes are not something you consider to be a problem and that you don't see value in stateless block execution to allow verification of the state root without having the full state on hand?",
        "created_at": "2021-10-30T14:13:16.316000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Correct, I donâ€™t see much value in this. State table in Erigon v1 is rather small for modern hardware (50gb) and Erigon v2 shows potential for compression of that by 2 times or more.",
        "created_at": "2021-10-30T14:21:13.023000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "From what I gather, stateless is a concept from 2018/2019, right? Before Erigon managed to compress state by a lot. Right now thereâ€™s a feeling that the whole direction needs to be rethought in light of these improvements.",
        "created_at": "2021-10-30T14:27:35.451000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Like state table _was_ a problem 3 years ago, and stateless was a promising research direction _at that time_\n\nBut since then the problem itself has subsided if not evaporated.",
        "created_at": "2021-10-30T14:29:23.345000+00:00",
        "attachments": []
    },
    {
        "author": "gottfriedherold",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I think we have different ideas what \"small\" size is... 50GB is not \"evaporated\". I would not want to use that on my smartphone.",
        "created_at": "2021-10-30T14:31:32.740000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "compressed state table still doesn't allow for block execution without actually having the full state...  so I wouldn't say that you guys solved this problem",
        "created_at": "2021-10-30T14:31:39.161000+00:00",
        "attachments": []
    },
    {
        "author": "gottfriedherold",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Compressed state is still extremely valuable for full clients, tho.",
        "created_at": "2021-10-30T14:32:17.349000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "iPhones ship with 128GB of internal memory or more",
        "created_at": "2021-10-30T14:32:59.988000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And thatâ€™s _if_ you want to run a P2P node on your phone, which is a battery killer",
        "created_at": "2021-10-30T14:33:40.056000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "if the only way to execute blocks is to have the full state, then you either have to execute all blocks, or re-download a full copy each time you want to verify a state root.  Statelessness allows for such a device to do block execution without incurring large storage or computation costs either up-front or ongoing.",
        "created_at": "2021-10-30T14:35:13.861000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "stateless block execution changes the equation from what it is now which is that you have to **both** download lots of data *and* do ongoing computation to keep that data up to do.  The new stateless world doesn't require either of these.  Small data download to get the witness.  Small computation cost of individual block execution against the witness.",
        "created_at": "2021-10-30T14:37:15.219000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I point all of this out to highlight that it isn't just about total state size (though that matters too).  It's about the combination of state size and the requirement that one must continually keep the state up-to-date once it has been acquired",
        "created_at": "2021-10-30T14:39:59.125000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "iPhones have monster CPUs now and Qualcomm will catch up, so I donâ€™t see block reexecution as a big problem either",
        "created_at": "2021-10-30T14:57:42.125000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "At least itâ€™s no more of a pain than scanning Monero blockchain for new outputs belonging to wallet key",
        "created_at": "2021-10-30T14:58:33.795000+00:00",
        "attachments": []
    },
    {
        "author": "cheng_wang",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "agree with this. the pros and cons of stateless node are both huge",
        "created_at": "2021-10-30T15:02:26.010000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "For mobile devices specifically, constantly tracking head when you only occasionally need head is a pretty huge waste of bandwidth.",
        "created_at": "2021-10-30T15:02:33.427000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "No different than Monero for example\n\nYou donâ€™t _constantly_ track head, only when you need to transact",
        "created_at": "2021-10-30T15:05:32.890000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Thatâ€™s where staged sync is so useful by the way",
        "created_at": "2021-10-30T15:05:50.936000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "With Monero, you have to re-sync from where you left off to head (at least, that is what happens to me when I use it).",
        "created_at": "2021-10-30T15:05:57.565000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Syncing in bulk is very fast",
        "created_at": "2021-10-30T15:05:59.354000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes",
        "created_at": "2021-10-30T15:06:07.120000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is still a lot of bandiwdith and execution that could be avoided if you had small block witnesses.",
        "created_at": "2021-10-30T15:06:14.290000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There is a huge difference between a couple MB of witness data and execution of a single block and execution of `n` blocks and downloading of `n` blocks worth of headers and bodies.",
        "created_at": "2021-10-30T15:06:43.497000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "But it involves complexifying and slowing down full nodes which are the backbone of this network",
        "created_at": "2021-10-30T15:06:57.578000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "By the way, itâ€™s not like blocks are that big either\n\nhttps://etherscan.io/chart/blocksize",
        "created_at": "2021-10-30T15:08:46.232000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "70 kb every 13s seems rather feasible to me",
        "created_at": "2021-10-30T15:09:32.874000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Plus full execution of every block, on a power constrained device (potentially).",
        "created_at": "2021-10-30T15:09:42.192000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Monster CPUs in phones",
        "created_at": "2021-10-30T15:09:55.879000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It isn't that the phone can't do it.  It is that you don't want your phone's battery to be spent on maintaining sync all day.",
        "created_at": "2021-10-30T15:10:12.612000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Devices are power constrained not by what you do when you use them\n\nDevices are constrained by how well they can sleep",
        "created_at": "2021-10-30T15:10:26.976000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Especially when you just want to interact with a dapp once in the middle of the day.",
        "created_at": "2021-10-30T15:10:32.776000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Which is why P2P phone node is rather utopian anyway",
        "created_at": "2021-10-30T15:11:02.503000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Right.  So either you are constantly waking and syncing in the background so you are ready to go when the user wants it, or you *don't* maintain sync with the phone and you \"sync\" when you want to use it, which means having to wait a while for your node to sync when you open your app.",
        "created_at": "2021-10-30T15:11:32.507000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Itâ€™s devp2p that will kill your battery, not block reexecution",
        "created_at": "2021-10-30T15:11:43.830000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Witness or not witness",
        "created_at": "2021-10-30T15:12:13.183000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "With stateless clients, you can *not* sync your client at all, and then when you want to interact with the blockchain you can open up the app and it is immediately available and can track head.",
        "created_at": "2021-10-30T15:12:15.143000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I would not propose for a mobile light client to sync via devp2p.",
        "created_at": "2021-10-30T15:12:34.956000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "At the cost of slower full nodes",
        "created_at": "2021-10-30T15:12:43.628000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Bad bargain if you ask me",
        "created_at": "2021-10-30T15:12:57.005000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Epsilon slower, yes.  That is a trade I personally think is worth it.",
        "created_at": "2021-10-30T15:13:43.745000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Where the slowness comes from having to calculate the block witnesses.",
        "created_at": "2021-10-30T15:14:12.289000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Itâ€™s not epsilon. If you wrote an EVM youâ€™d know it",
        "created_at": "2021-10-30T15:14:24.898000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "You are of the belief that calculating witnesses is going to become a significant cost of running a full node, even when compared to disk access costs, actual EVM execution costs, etc.?",
        "created_at": "2021-10-30T15:15:08.293000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Disk access is rather cheap, Erigon is actually bottlenecked by EVM jnterpreter speed",
        "created_at": "2021-10-30T15:15:38.735000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So every single gas manipulation can show up on profiler",
        "created_at": "2021-10-30T15:16:19.383000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I agree that gas accounting is an expensive part of the EVM.  What I contest is that the *change* in gas accounting in this particular set of cases (storage reads/writes) will be significant.",
        "created_at": "2021-10-30T15:17:28.329000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Akula is already twice as fast as Erigon on my machine simply because evmodin is written in Rust",
        "created_at": "2021-10-30T15:17:28.787000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There are both direct costs and indirect costs.\n\nDirect costs is when you actually have to compute gas to be subtracted on instruction X or Y.\n\nIndirect costs is when complex gas schedule forces you to write the whole execution module in some particular way, and you cannot explore alternative because you canâ€™t calculate gas properly otherwise",
        "created_at": "2021-10-30T15:20:11.705000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Would you prefer it if we just used a flat amount for gas cost and chose the worst case scenario?",
        "created_at": "2021-10-30T15:21:15.702000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "One big example of such indirect cost was when I wanted to implement REVERT without hand rolling state journalling like Erigon and geth have",
        "created_at": "2021-10-30T15:21:16.434000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That is, would you rather most operations cost more than they need to in exchange for having simpler gas accounting?",
        "created_at": "2021-10-30T15:21:44.859000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Average case + network of tx pools safeguarding against attacks",
        "created_at": "2021-10-30T15:21:48.440000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Bu tin principle, yes",
        "created_at": "2021-10-30T15:22:06.346000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Average case doesn't work because someone can submit a block that is worst case.",
        "created_at": "2021-10-30T15:22:10.836000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Cost more and compensate by simply raising the gas limit",
        "created_at": "2021-10-30T15:22:16.702000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "We have to set the gas limit and gas costs for the worst case scenario, not best case scenario.",
        "created_at": "2021-10-30T15:22:42.605000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Otherwise we end up with the Shanghai attacks (or similar) all over again.",
        "created_at": "2021-10-30T15:22:54.427000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It can be submitted, and other miners have the right to mine on another chain",
        "created_at": "2021-10-30T15:22:59.440000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "No.",
        "created_at": "2021-10-30T15:23:07.331000+00:00",
        "attachments": []
    },
    {
        "author": "cheng_wang",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "AFAIK, the stateless trie proof needs to be updated for every block ? This can make many txs fail in block assembly if they are not included in time",
        "created_at": "2021-10-30T15:23:22.969000+00:00",
        "attachments": []
    },
    {
        "author": "cheng_wang",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "maybe I missed something here",
        "created_at": "2021-10-30T15:23:58.948000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I assumed that a block would be invalid if it didn't contain a witness in the hypothetical stateless future.",
        "created_at": "2021-10-30T15:24:06.409000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "How would the fork choice rule for this be setup?  Maybe one client is able to process blocks from chain A quickly, and another client executes blocks from chain A slowly, so it prefers chain B.",
        "created_at": "2021-10-30T15:25:25.431000+00:00",
        "attachments": []
    },
    {
        "author": "cheng_wang",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Letâ€™s say if I submit a tx with proof based on block 1000. If my tx is not included in block 1001. I need to resubmit my tx, right ?",
        "created_at": "2021-10-30T15:25:45.226000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah, in this particular brand of stateless future it is not transaction submitters that provide the witness, it is block producers.",
        "created_at": "2021-10-30T15:26:15.383000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This makes it so only block producers need to actually have all state available (so they can calculate the block witness).  Everyone else can, in theory, run stateless (though they are some advantages to running full state).",
        "created_at": "2021-10-30T15:27:10.187000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Well, then the chain A is not that slow after all",
        "created_at": "2021-10-30T15:27:34.299000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The definition of slowness is subjective",
        "created_at": "2021-10-30T15:27:42.648000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Agreed!  Which is why we have gas limits and gas costs that tend to cater to the slowest client.",
        "created_at": "2021-10-30T15:27:59.457000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Otherwise we would end up with subjective processing times causing forks.",
        "created_at": "2021-10-30T15:28:10.221000+00:00",
        "attachments": []
    },
    {
        "author": "cheng_wang",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It means block producer needs to maintain and update all of the proofs for every key. This is too much in my opinion",
        "created_at": "2021-10-30T15:28:21.379000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "\u003e to the shittiest client\nFTFY",
        "created_at": "2021-10-30T15:28:24.866000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Rewarding the inferiority, how nice",
        "created_at": "2021-10-30T15:28:49.902000+00:00",
        "attachments": []
    },
    {
        "author": "vorot93",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Current gas prices reflect that",
        "created_at": "2021-10-30T15:28:58.285000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Every time a block producer produces a block, they need to compute a full witness for that block, yes.  I don't know what you mean by \"proofs for every key\" here?",
        "created_at": "2021-10-30T15:29:20.387000+00:00",
        "attachments": []
    },
    {
        "author": "cheng_wang",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the trie root changes for every block, so the proof changes for every account even if the account is not touched",
        "created_at": "2021-10-30T15:30:36.670000+00:00",
        "attachments": []
    },
    {
        "author": "cheng_wang",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I am assuming the proof system works similar to merkle tree proof. If not, I might be wrong",
        "created_at": "2021-10-30T15:31:08.350000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah, yes.  The verkle tree would replace the merkle tree, and the root would need to be calculated every block (just like today).",
        "created_at": "2021-10-30T15:32:58.451000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "And all full nodes would need to maintain this, just like they do today.",
        "created_at": "2021-10-30T15:33:16.056000+00:00",
        "attachments": []
    },
    {
        "author": "cheng_wang",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "So if I have some asset with proof P at block 1000, and after block 1001 my proof needs to be updated even if I donâ€™t use my asset in block 1001",
        "created_at": "2021-10-30T15:34:57.918000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Stateless clients would *validate* proofs, not *generate* proofs.",
        "created_at": "2021-10-30T15:36:05.306000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Proof generation is solely done by block producers.",
        "created_at": "2021-10-30T15:36:14.585000+00:00",
        "attachments": []
    },
    {
        "author": "cheng_wang",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "This is what I meant that block producer will need to update all of the proofs for everyone for every block",
        "created_at": "2021-10-30T15:36:21.177000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Well, and full nodes serving light client data.",
        "created_at": "2021-10-30T15:36:27.479000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Yes, the verkle tree needs to be maintained just like the merkle tree is maintained today.",
        "created_at": "2021-10-30T15:36:43.714000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "That isn't a new concept or cost, it is just a change from merkle maintenance to verkle maintenance.",
        "created_at": "2021-10-30T15:36:55.433000+00:00",
        "attachments": []
    },
    {
        "author": "cheng_wang",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "I know the client side is okay. But the work load for block producer will be insane",
        "created_at": "2021-10-30T15:37:03.997000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Verkle maintenance may be a bit more expensive than merkle maintenance, but it *replaces* it, so the difference is what we care about here.",
        "created_at": "2021-10-30T15:37:14.316000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "The effort to generate a block witness is non zero, but it should be under 1 second on \"modern hardware\".",
        "created_at": "2021-10-30T15:37:31.173000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "At least, that is the hope/target I think.",
        "created_at": "2021-10-30T15:37:49.508000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Check out the PeepAnEip presentation by Dankrad, he talks about the witness generation cost estimates.",
        "created_at": "2021-10-30T15:38:26.006000+00:00",
        "attachments": []
    },
    {
        "author": "cheng_wang",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "thanks, will check later",
        "created_at": "2021-10-30T15:38:47.785000+00:00",
        "attachments": []
    },
    {
        "author": "cheng_wang",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "the verkle trie migration is for ETH1 or ETH2 ?",
        "created_at": "2021-10-30T15:42:41.554000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "There is no ETH2.  There is only The Merge.  This migration would happen after The Merge.",
        "created_at": "2021-10-30T15:51:06.334000+00:00",
        "attachments": []
    },
    {
        "author": "cheng_wang",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "got you ðŸ˜‚",
        "created_at": "2021-10-30T15:51:33.560000+00:00",
        "attachments": []
    },
    {
        "author": "dankrad.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "No the proofs are per block and not per transactions. So any inclusion of transactions does not change the validity of other transactions in the mempools, other than what is already happening (same account same nonce)",
        "created_at": "2021-10-30T23:12:11.381000+00:00",
        "attachments": []
    },
    {
        "author": "dankrad.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "It is not insane. The proof computation is sub-second in typical cases, and a few seconds in the worst. I think it is very manageable.\n\nOf course they need the actual state but this is no worse than now.",
        "created_at": "2021-10-30T23:13:17.684000+00:00",
        "attachments": []
    },
    {
        "author": "dankrad.eth",
        "category": "Execution R\u0026D",
        "parent": "",
        "content": "Ah Micah already answered these ðŸ™‚ Was just scrolling down and answering what I saw ...",
        "created_at": "2021-10-30T23:13:57.364000+00:00",
        "attachments": []
    }
]