[
    {
        "author": "__lithp__",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Okay, this took longer than I expected but I think I have an answer \u003c@364458974906548225\u003e !\n\nI patched TurboGeth enough to convince it to build the trie for me and emit the hash and size of each node. If I sum up every node (so, if I do no deduplication) I find 715M trie nodes, which cumulatively consume ~52GB of space. When you store nodes by (key, value) you effectively double-count each hash, so adding in all 715M 32-byte hashes gives me a total trie size of ~73GB of space. I believe this covers everything!\n\nWhen I group all nodes by hash and then sum, to emulate deduplication, I get 675M trie nodes which collectively consume 50.2GB of space (70GB of space once you double-count the hashes)\n\nIt seems that like duplication does make a difference but not a very large one, it only removes about 40M trie nodes, or about 3GB of space, we don't have to pay a high price for not deduplicating state.\n\nI'm not sure why these numbers are much lower than what your geth node is telling you. Has your node been running for a while, maybe longer than a few weeks? If the geth node is also storing a bunch of outdated-and-not-garbage-collected-nodes that could explain the difference. It's also possible Geth is storing something slightly bigger than the raw RLP on disk, or that it's counting the size of files on disk and catching leveldb internals.",
        "created_at": "2021-02-21T06:37:20.575000+00:00",
        "attachments": null
    }
]