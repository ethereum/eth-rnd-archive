[
    {
        "author": "rjdrost",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Thanks to all who attended today's Stateless Ethereum Call #11 for a great discussion! \nHere is the video recording link and password for it:\nhttps://consensysmesh.zoom.us/rec/share/k942Ns_Q0dyNZ1rBktYU9kcWfyAvHAcRfSxf6VL61v7ZJwsJ52og7CfIU3eTWsGV.sjH_gMYvOOSPlZVB Passcode: j7=dgWQ!",
        "created_at": "2021-01-27T03:05:27.500000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e 3. Brian's work on accessing cold state shows that blocks regularly reach deeply into the history.  I believe these results are preliminary and need to be validated, but they match our intuition.  That means that either the network must be big enough to be an archive node  or we need some kind of garbage collection so that the cold state doesn't get evicted since we've found that cold state gets touched quite regularly....\nWhy would you need an arcchive node because people are accessing cold state?  Cold state would just need a full node I would think?",
        "created_at": "2021-01-27T04:11:18.400000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@364458974906548225\u003e",
        "created_at": "2021-01-27T04:11:21.235000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Archive node is simpler to build but the more I think about it the more I think we're going to have to launch with \"full node\" version of the state which only holds the most recent N state roots and lowers the storage requirements by something like 2 orders of magnitude.",
        "created_at": "2021-01-27T04:14:39.156000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Reading more, I'm starting to think you are using the term \"archive node\" differently than Ethereum 1 uses it?",
        "created_at": "2021-01-27T04:14:48.966000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Archive node == can access all historical state tries",
        "created_at": "2021-01-27T04:15:11.797000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "That seems unrelated to accessing cold state?",
        "created_at": "2021-01-27T04:15:23.573000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "For example, a genesis account that has never been touched is part of the *current* state trie.  No need for an archive node to access it.",
        "created_at": "2021-01-27T04:15:50.029000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Correct, they are mostly orthogonal.",
        "created_at": "2021-01-27T04:15:55.977000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I would consider that the most cold state possible.",
        "created_at": "2021-01-27T04:15:56.640000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e That means that either the network must be big enough to be an archive node\nThis is the piece of what you said above that has me confused.",
        "created_at": "2021-01-27T04:16:22.598000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "We went from talking about cold state access to \"this means we need an archive node\".",
        "created_at": "2021-01-27T04:16:38.660000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "They are related in the context of what happens when the total data stored in the network approaches and exceeds the total storage capacity of the network",
        "created_at": "2021-01-27T04:17:24.416000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "*if* your network has enough capacity, then designing it as an archive node simplifies the design.",
        "created_at": "2021-01-27T04:18:45.575000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ah, I think you are saying that things are simpler if you have *no* eviction policy?",
        "created_at": "2021-01-27T04:19:45.013000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "But otherwise, when the network has less capacity than is needed for an archive node, you need to implement garbage collection to ensure child state is not the first thing dropped when the network is operating at capacity",
        "created_at": "2021-01-27T04:19:51.422000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yes, things are simpler when you don't need a eviction policy more complex than radius",
        "created_at": "2021-01-27T04:20:26.375000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Okay, I think I get it.  If we have no eviction policy, everything is fine.  If we have an eviction policy, LRU is easy but it is wrong, so we need something hard.",
        "created_at": "2021-01-27T04:20:32.982000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yes!",
        "created_at": "2021-01-27T04:20:47.201000+00:00",
        "attachments": []
    },
    {
        "author": "samwilsn",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I suppose the approach we kind of thought of originally, where the state network is more of a CDN for actual archive nodes, is unworkable?",
        "created_at": "2021-01-27T04:32:20.011000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "No, not unworkable, it needs a large network. So we start with the other thing, and then later we can simplify the protocol at whatever point the network grows sufficiently large",
        "created_at": "2021-01-27T04:40:30.663000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@364458974906548225\u003e Is your general thought on the non-incentivized state network that if you give people desktop app that is relatively easy to use/simple to run and has low requirements that people will just altruistically run it and help the network because it is easy?",
        "created_at": "2021-01-27T04:50:46.324000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Kind of like how if you give people a BitTorrent client which lets them download files, they'll generally leave it running to *serve* those files because it requires essentially no extra work on their part.",
        "created_at": "2021-01-27T04:51:21.539000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Yes, that's the idea, you need the networks to make that type of client and you need that type of client to hold up the networks.",
        "created_at": "2021-01-27T04:57:56.556000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "And once you have them, the chain history network may look really appealing to current mainnet clients as an easy way to drop 150gb of disk footprint, or the state network as an easy way do garbage collect really cold state and just look out up on demand when you occasionally need it.",
        "created_at": "2021-01-27T05:00:42.264000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "They are powerful tools that can make clients way more diverse and way better in numerous ways.",
        "created_at": "2021-01-27T05:01:48.966000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@364458974906548225\u003e This may be answered later in your blog posts, but couldn't we address the data indexing problem by just having two new state roots, one for transactions and one for blocks combined with SSZification of block headers and transaction trie within a block?  These state roots would just be the root of a merkle tree that simply maps `blockNumber =\u003e ssz_merkle_path_to_block` and `transactionHash =\u003e ssz_merkle_path_to_transaction`.",
        "created_at": "2021-01-27T05:47:09.700000+00:00",
        "attachments": []
    },
    {
        "author": "nick.ghita",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003e speak up if you're going to continue working to measure something like this.\n\u003c@!364458974906548225\u003e yup, I'll keep on working on it!",
        "created_at": "2021-01-27T08:22:49.934000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "\u003c@!301186049323958275\u003e IIUC, you are proposing two new pieces of global state.  There would be two new merkle tries.  Miners would need to maintain these tries.  Each block, the transaction hashes and block number would be be inserted into these tries.  The tries would grow larger at each block.\n\nMaybe I'm missing something.  But it seems like given a transaction hash, a light client would either A) need to have their own copy of this trie to do the lookup themselves or B) they would need to ask someone who has the whole trie to look it up and provide them with a proof.\n\n- A: puts too high a load on the light client since managing a copy of these tries would take of many GB of disk\n- B: Follows the same flaw that LES suffers from, with light nodes depending on the benevolence of full nodes to serve data",
        "created_at": "2021-01-27T15:16:52.707000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Whatever mechanism you find to distribute data across light nodes (e.g., distributing by node ID hash or whatever) you could distribute this data as well (for B).",
        "created_at": "2021-01-27T15:25:46.634000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "I think this approach takes the consensus part of the protocol in the opposite direction that we want.  It would add 500MB for the block index and 32GB for the transaction index into the total \"state\" necessary to validate and execute blocks.  I *think* that this effectively doubles the total amount of state that any node would need to hold.",
        "created_at": "2021-01-27T16:39:19.470000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Hmm, is it really that big?",
        "created_at": "2021-01-27T16:41:45.510000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Just for transaction_hash =\u003e 32 bytes and block_number =\u003e 32 bytes?",
        "created_at": "2021-01-27T16:42:40.082000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "(assuming a tree path is 32 bytes)",
        "created_at": "2021-01-27T16:42:49.145000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Ballpark numbers.  1 billion transactions, absolute minimal data storage is roughly 64 bytes to map `txn_hash -\u003e block_hash`,  1e9 * 64 bytes -\u003e 59GB if I'm doing correct maths.",
        "created_at": "2021-01-27T16:47:33.712000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "The 32GB is from a level DB database used by geth, I expect there's some compression or maybe its mapping `txn_hash -\u003e block_number` and block number is being efficiently encoded?  dunno.",
        "created_at": "2021-01-27T16:48:23.511000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Actual number of transactions is in the high 100's of millions but we're closing in on 1 billion fast.",
        "created_at": "2021-01-27T16:49:10.648000+00:00",
        "attachments": []
    },
    {
        "author": "sky.cactus",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "Huh, your numbers do seem correct, assuming the 1B is reasonable (I have no clue on that).",
        "created_at": "2021-01-27T17:37:05.224000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "https://gist.github.com/pipermerriam/c93a2975fb91d35b12003a87b5443a9c",
        "created_at": "2021-01-27T17:37:44.517000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "```\n| Key-Value store | Transaction index  | 31.83 GiB  | 949230978 |\n```",
        "created_at": "2021-01-27T17:37:53.142000+00:00",
        "attachments": []
    },
    {
        "author": "pipermerriam",
        "category": "Channel Graveyard",
        "parent": "",
        "content": "that last item is \"number of items\"",
        "created_at": "2021-01-27T17:38:06.546000+00:00",
        "attachments": []
    }
]